(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const b of p.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&s(b)}).observe(document,{childList:!0,subtree:!0});function r(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerPolicy&&(p.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?p.credentials="include":h.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function s(h){if(h.ep)return;h.ep=!0;const p=r(h);fetch(h.href,p)}})();var Os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ub(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function DM(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var h=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(r,s,h.get?h:{enumerable:!0,get:function(){return t[s]}})}),r}var E5={exports:{}};/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */(function(t,e){(function(r,s){t.exports=s()})(Os,function(){const r=new Map,s={set(Ie,$,ce){r.has(Ie)||r.set(Ie,new Map);const Ue=r.get(Ie);Ue.has($)||Ue.size===0?Ue.set($,ce):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(Ue.keys())[0]}.`)},get:(Ie,$)=>r.has(Ie)&&r.get(Ie).get($)||null,remove(Ie,$){if(!r.has(Ie))return;const ce=r.get(Ie);ce.delete($),ce.size===0&&r.delete(Ie)}},h="transitionend",p=Ie=>(Ie&&window.CSS&&window.CSS.escape&&(Ie=Ie.replace(/#([^\s"#']+)/g,($,ce)=>`#${CSS.escape(ce)}`)),Ie),b=Ie=>{Ie.dispatchEvent(new Event(h))},E=Ie=>!(!Ie||typeof Ie!="object")&&(Ie.jquery!==void 0&&(Ie=Ie[0]),Ie.nodeType!==void 0),o=Ie=>E(Ie)?Ie.jquery?Ie[0]:Ie:typeof Ie=="string"&&Ie.length>0?document.querySelector(p(Ie)):null,O=Ie=>{if(!E(Ie)||Ie.getClientRects().length===0)return!1;const $=getComputedStyle(Ie).getPropertyValue("visibility")==="visible",ce=Ie.closest("details:not([open])");if(!ce)return $;if(ce!==Ie){const Ue=Ie.closest("summary");if(Ue&&Ue.parentNode!==ce||Ue===null)return!1}return $},z=Ie=>!Ie||Ie.nodeType!==Node.ELEMENT_NODE||!!Ie.classList.contains("disabled")||(Ie.disabled!==void 0?Ie.disabled:Ie.hasAttribute("disabled")&&Ie.getAttribute("disabled")!=="false"),U=Ie=>{if(!document.documentElement.attachShadow)return null;if(typeof Ie.getRootNode=="function"){const $=Ie.getRootNode();return $ instanceof ShadowRoot?$:null}return Ie instanceof ShadowRoot?Ie:Ie.parentNode?U(Ie.parentNode):null},H=()=>{},Y=Ie=>{Ie.offsetHeight},Q=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,ge=[],ye=()=>document.documentElement.dir==="rtl",ke=Ie=>{var $;$=()=>{const ce=Q();if(ce){const Ue=Ie.NAME,It=ce.fn[Ue];ce.fn[Ue]=Ie.jQueryInterface,ce.fn[Ue].Constructor=Ie,ce.fn[Ue].noConflict=()=>(ce.fn[Ue]=It,Ie.jQueryInterface)}},document.readyState==="loading"?(ge.length||document.addEventListener("DOMContentLoaded",()=>{for(const ce of ge)ce()}),ge.push($)):$()},he=(Ie,$=[],ce=Ie)=>typeof Ie=="function"?Ie(...$):ce,oe=(Ie,$,ce=!0)=>{if(!ce)return void he(Ie);const Ue=(Jt=>{if(!Jt)return 0;let{transitionDuration:br,transitionDelay:Ar}=window.getComputedStyle(Jt);const Kr=Number.parseFloat(br),Gt=Number.parseFloat(Ar);return Kr||Gt?(br=br.split(",")[0],Ar=Ar.split(",")[0],1e3*(Number.parseFloat(br)+Number.parseFloat(Ar))):0})($)+5;let It=!1;const et=({target:Jt})=>{Jt===$&&(It=!0,$.removeEventListener(h,et),he(Ie))};$.addEventListener(h,et),setTimeout(()=>{It||b($)},Ue)},ve=(Ie,$,ce,Ue)=>{const It=Ie.length;let et=Ie.indexOf($);return et===-1?!ce&&Ue?Ie[It-1]:Ie[0]:(et+=ce?1:-1,Ue&&(et=(et+It)%It),Ie[Math.max(0,Math.min(et,It-1))])},be=/[^.]*(?=\..*)\.|.*/,ze=/\..*/,Te=/::\d+$/,ie={};let ne=1;const te={mouseenter:"mouseover",mouseleave:"mouseout"},re=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function me(Ie,$){return $&&`${$}::${ne++}`||Ie.uidEvent||ne++}function we(Ie){const $=me(Ie);return Ie.uidEvent=$,ie[$]=ie[$]||{},ie[$]}function tt(Ie,$,ce=null){return Object.values(Ie).find(Ue=>Ue.callable===$&&Ue.delegationSelector===ce)}function Et(Ie,$,ce){const Ue=typeof $=="string",It=Ue?ce:$||ce;let et=Fr(Ie);return re.has(et)||(et=Ie),[Ue,It,et]}function ft(Ie,$,ce,Ue,It){if(typeof $!="string"||!Ie)return;let[et,Jt,br]=Et($,ce,Ue);$ in te&&(Jt=(Mn=>function(En){if(!En.relatedTarget||En.relatedTarget!==En.delegateTarget&&!En.delegateTarget.contains(En.relatedTarget))return Mn.call(this,En)})(Jt));const Ar=we(Ie),Kr=Ar[br]||(Ar[br]={}),Gt=tt(Kr,Jt,et?ce:null);if(Gt)return void(Gt.oneOff=Gt.oneOff&&It);const Gr=me(Jt,$.replace(be,"")),Hn=et?function(bn,Mn,En){return function Bn(ro){const po=bn.querySelectorAll(Mn);for(let{target:$n}=ro;$n&&$n!==this;$n=$n.parentNode)for(const _i of po)if(_i===$n)return jr(ro,{delegateTarget:$n}),Bn.oneOff&&gt.off(bn,ro.type,Mn,En),En.apply($n,[ro])}}(Ie,ce,Jt):function(bn,Mn){return function En(Bn){return jr(Bn,{delegateTarget:bn}),En.oneOff&&gt.off(bn,Bn.type,Mn),Mn.apply(bn,[Bn])}}(Ie,Jt);Hn.delegationSelector=et?ce:null,Hn.callable=Jt,Hn.oneOff=It,Hn.uidEvent=Gr,Kr[Gr]=Hn,Ie.addEventListener(br,Hn,et)}function rr(Ie,$,ce,Ue,It){const et=tt($[ce],Ue,It);et&&(Ie.removeEventListener(ce,et,!!It),delete $[ce][et.uidEvent])}function or(Ie,$,ce,Ue){const It=$[ce]||{};for(const[et,Jt]of Object.entries(It))et.includes(Ue)&&rr(Ie,$,ce,Jt.callable,Jt.delegationSelector)}function Fr(Ie){return Ie=Ie.replace(ze,""),te[Ie]||Ie}const gt={on(Ie,$,ce,Ue){ft(Ie,$,ce,Ue,!1)},one(Ie,$,ce,Ue){ft(Ie,$,ce,Ue,!0)},off(Ie,$,ce,Ue){if(typeof $!="string"||!Ie)return;const[It,et,Jt]=Et($,ce,Ue),br=Jt!==$,Ar=we(Ie),Kr=Ar[Jt]||{},Gt=$.startsWith(".");if(et===void 0){if(Gt)for(const Gr of Object.keys(Ar))or(Ie,Ar,Gr,$.slice(1));for(const[Gr,Hn]of Object.entries(Kr)){const bn=Gr.replace(Te,"");br&&!$.includes(bn)||rr(Ie,Ar,Jt,Hn.callable,Hn.delegationSelector)}}else{if(!Object.keys(Kr).length)return;rr(Ie,Ar,Jt,et,It?ce:null)}},trigger(Ie,$,ce){if(typeof $!="string"||!Ie)return null;const Ue=Q();let It=null,et=!0,Jt=!0,br=!1;$!==Fr($)&&Ue&&(It=Ue.Event($,ce),Ue(Ie).trigger(It),et=!It.isPropagationStopped(),Jt=!It.isImmediatePropagationStopped(),br=It.isDefaultPrevented());const Ar=jr(new Event($,{bubbles:et,cancelable:!0}),ce);return br&&Ar.preventDefault(),Jt&&Ie.dispatchEvent(Ar),Ar.defaultPrevented&&It&&It.preventDefault(),Ar}};function jr(Ie,$={}){for(const[ce,Ue]of Object.entries($))try{Ie[ce]=Ue}catch{Object.defineProperty(Ie,ce,{configurable:!0,get:()=>Ue})}return Ie}function Ur(Ie){if(Ie==="true")return!0;if(Ie==="false")return!1;if(Ie===Number(Ie).toString())return Number(Ie);if(Ie===""||Ie==="null")return null;if(typeof Ie!="string")return Ie;try{return JSON.parse(decodeURIComponent(Ie))}catch{return Ie}}function Xr(Ie){return Ie.replace(/[A-Z]/g,$=>`-${$.toLowerCase()}`)}const pr={setDataAttribute(Ie,$,ce){Ie.setAttribute(`data-bs-${Xr($)}`,ce)},removeDataAttribute(Ie,$){Ie.removeAttribute(`data-bs-${Xr($)}`)},getDataAttributes(Ie){if(!Ie)return{};const $={},ce=Object.keys(Ie.dataset).filter(Ue=>Ue.startsWith("bs")&&!Ue.startsWith("bsConfig"));for(const Ue of ce){let It=Ue.replace(/^bs/,"");It=It.charAt(0).toLowerCase()+It.slice(1,It.length),$[It]=Ur(Ie.dataset[Ue])}return $},getDataAttribute:(Ie,$)=>Ur(Ie.getAttribute(`data-bs-${Xr($)}`))};class Dt{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig($){return $=this._mergeConfigObj($),$=this._configAfterMerge($),this._typeCheckConfig($),$}_configAfterMerge($){return $}_mergeConfigObj($,ce){const Ue=E(ce)?pr.getDataAttribute(ce,"config"):{};return{...this.constructor.Default,...typeof Ue=="object"?Ue:{},...E(ce)?pr.getDataAttributes(ce):{},...typeof $=="object"?$:{}}}_typeCheckConfig($,ce=this.constructor.DefaultType){for(const[It,et]of Object.entries(ce)){const Jt=$[It],br=E(Jt)?"element":(Ue=Jt)==null?`${Ue}`:Object.prototype.toString.call(Ue).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(et).test(br))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${It}" provided type "${br}" but expected type "${et}".`)}var Ue}}class ar extends Dt{constructor($,ce){super(),($=o($))&&(this._element=$,this._config=this._getConfig(ce),s.set(this._element,this.constructor.DATA_KEY,this))}dispose(){s.remove(this._element,this.constructor.DATA_KEY),gt.off(this._element,this.constructor.EVENT_KEY);for(const $ of Object.getOwnPropertyNames(this))this[$]=null}_queueCallback($,ce,Ue=!0){oe($,ce,Ue)}_getConfig($){return $=this._mergeConfigObj($,this._element),$=this._configAfterMerge($),this._typeCheckConfig($),$}static getInstance($){return s.get(o($),this.DATA_KEY)}static getOrCreateInstance($,ce={}){return this.getInstance($)||new this($,typeof ce=="object"?ce:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName($){return`${$}${this.EVENT_KEY}`}}const vt=Ie=>{let $=Ie.getAttribute("data-bs-target");if(!$||$==="#"){let ce=Ie.getAttribute("href");if(!ce||!ce.includes("#")&&!ce.startsWith("."))return null;ce.includes("#")&&!ce.startsWith("#")&&(ce=`#${ce.split("#")[1]}`),$=ce&&ce!=="#"?ce.trim():null}return $?$.split(",").map(ce=>p(ce)).join(","):null},Pt={find:(Ie,$=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call($,Ie)),findOne:(Ie,$=document.documentElement)=>Element.prototype.querySelector.call($,Ie),children:(Ie,$)=>[].concat(...Ie.children).filter(ce=>ce.matches($)),parents(Ie,$){const ce=[];let Ue=Ie.parentNode.closest($);for(;Ue;)ce.push(Ue),Ue=Ue.parentNode.closest($);return ce},prev(Ie,$){let ce=Ie.previousElementSibling;for(;ce;){if(ce.matches($))return[ce];ce=ce.previousElementSibling}return[]},next(Ie,$){let ce=Ie.nextElementSibling;for(;ce;){if(ce.matches($))return[ce];ce=ce.nextElementSibling}return[]},focusableChildren(Ie){const $=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(ce=>`${ce}:not([tabindex^="-"])`).join(",");return this.find($,Ie).filter(ce=>!z(ce)&&O(ce))},getSelectorFromElement(Ie){const $=vt(Ie);return $&&Pt.findOne($)?$:null},getElementFromSelector(Ie){const $=vt(Ie);return $?Pt.findOne($):null},getMultipleElementsFromSelector(Ie){const $=vt(Ie);return $?Pt.find($):[]}},Ot=(Ie,$="hide")=>{const ce=`click.dismiss${Ie.EVENT_KEY}`,Ue=Ie.NAME;gt.on(document,ce,`[data-bs-dismiss="${Ue}"]`,function(It){if(["A","AREA"].includes(this.tagName)&&It.preventDefault(),z(this))return;const et=Pt.getElementFromSelector(this)||this.closest(`.${Ue}`);Ie.getOrCreateInstance(et)[$]()})},lr=".bs.alert",Se=`close${lr}`,Kt=`closed${lr}`;class Fe extends ar{static get NAME(){return"alert"}close(){if(gt.trigger(this._element,Se).defaultPrevented)return;this._element.classList.remove("show");const $=this._element.classList.contains("fade");this._queueCallback(()=>this._destroyElement(),this._element,$)}_destroyElement(){this._element.remove(),gt.trigger(this._element,Kt),this.dispose()}static jQueryInterface($){return this.each(function(){const ce=Fe.getOrCreateInstance(this);if(typeof $=="string"){if(ce[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ce[$](this)}})}}Ot(Fe,"close"),ke(Fe);const $e='[data-bs-toggle="button"]';class We extends ar{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface($){return this.each(function(){const ce=We.getOrCreateInstance(this);$==="toggle"&&ce[$]()})}}gt.on(document,"click.bs.button.data-api",$e,Ie=>{Ie.preventDefault();const $=Ie.target.closest($e);We.getOrCreateInstance($).toggle()}),ke(We);const zt=".bs.swipe",$t=`touchstart${zt}`,_r=`touchmove${zt}`,Wt=`touchend${zt}`,mr=`pointerdown${zt}`,Tr=`pointerup${zt}`,yr={endCallback:null,leftCallback:null,rightCallback:null},Lr={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class qr extends Dt{constructor($,ce){super(),this._element=$,$&&qr.isSupported()&&(this._config=this._getConfig(ce),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return yr}static get DefaultType(){return Lr}static get NAME(){return"swipe"}dispose(){gt.off(this._element,zt)}_start($){this._supportPointerEvents?this._eventIsPointerPenTouch($)&&(this._deltaX=$.clientX):this._deltaX=$.touches[0].clientX}_end($){this._eventIsPointerPenTouch($)&&(this._deltaX=$.clientX-this._deltaX),this._handleSwipe(),he(this._config.endCallback)}_move($){this._deltaX=$.touches&&$.touches.length>1?0:$.touches[0].clientX-this._deltaX}_handleSwipe(){const $=Math.abs(this._deltaX);if($<=40)return;const ce=$/this._deltaX;this._deltaX=0,ce&&he(ce>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(gt.on(this._element,mr,$=>this._start($)),gt.on(this._element,Tr,$=>this._end($)),this._element.classList.add("pointer-event")):(gt.on(this._element,$t,$=>this._start($)),gt.on(this._element,_r,$=>this._move($)),gt.on(this._element,Wt,$=>this._end($)))}_eventIsPointerPenTouch($){return this._supportPointerEvents&&($.pointerType==="pen"||$.pointerType==="touch")}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const nr=".bs.carousel",Wr=".data-api",Zr="next",Rn="prev",ln="left",jn="right",uo=`slide${nr}`,ho=`slid${nr}`,vs=`keydown${nr}`,Ai=`mouseenter${nr}`,ns=`mouseleave${nr}`,ki=`dragstart${nr}`,Oi=`load${nr}${Wr}`,Zo=`click${nr}${Wr}`,en="carousel",Do="active",bs=".active",Lo=".carousel-item",jo=bs+Lo,is={ArrowLeft:jn,ArrowRight:ln},Is={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Ks={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class $o extends ar{constructor($,ce){super($,ce),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Pt.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===en&&this.cycle()}static get Default(){return Is}static get DefaultType(){return Ks}static get NAME(){return"carousel"}next(){this._slide(Zr)}nextWhenVisible(){!document.hidden&&O(this._element)&&this.next()}prev(){this._slide(Rn)}pause(){this._isSliding&&b(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?gt.one(this._element,ho,()=>this.cycle()):this.cycle())}to($){const ce=this._getItems();if($>ce.length-1||$<0)return;if(this._isSliding)return void gt.one(this._element,ho,()=>this.to($));const Ue=this._getItemIndex(this._getActive());if(Ue===$)return;const It=$>Ue?Zr:Rn;this._slide(It,ce[$])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge($){return $.defaultInterval=$.interval,$}_addEventListeners(){this._config.keyboard&&gt.on(this._element,vs,$=>this._keydown($)),this._config.pause==="hover"&&(gt.on(this._element,Ai,()=>this.pause()),gt.on(this._element,ns,()=>this._maybeEnableCycle())),this._config.touch&&qr.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const ce of Pt.find(".carousel-item img",this._element))gt.on(ce,ki,Ue=>Ue.preventDefault());const $={leftCallback:()=>this._slide(this._directionToOrder(ln)),rightCallback:()=>this._slide(this._directionToOrder(jn)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),500+this._config.interval))}};this._swipeHelper=new qr(this._element,$)}_keydown($){if(/input|textarea/i.test($.target.tagName))return;const ce=is[$.key];ce&&($.preventDefault(),this._slide(this._directionToOrder(ce)))}_getItemIndex($){return this._getItems().indexOf($)}_setActiveIndicatorElement($){if(!this._indicatorsElement)return;const ce=Pt.findOne(bs,this._indicatorsElement);ce.classList.remove(Do),ce.removeAttribute("aria-current");const Ue=Pt.findOne(`[data-bs-slide-to="${$}"]`,this._indicatorsElement);Ue&&(Ue.classList.add(Do),Ue.setAttribute("aria-current","true"))}_updateInterval(){const $=this._activeElement||this._getActive();if(!$)return;const ce=Number.parseInt($.getAttribute("data-bs-interval"),10);this._config.interval=ce||this._config.defaultInterval}_slide($,ce=null){if(this._isSliding)return;const Ue=this._getActive(),It=$===Zr,et=ce||ve(this._getItems(),Ue,It,this._config.wrap);if(et===Ue)return;const Jt=this._getItemIndex(et),br=Gr=>gt.trigger(this._element,Gr,{relatedTarget:et,direction:this._orderToDirection($),from:this._getItemIndex(Ue),to:Jt});if(br(uo).defaultPrevented||!Ue||!et)return;const Ar=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(Jt),this._activeElement=et;const Kr=It?"carousel-item-start":"carousel-item-end",Gt=It?"carousel-item-next":"carousel-item-prev";et.classList.add(Gt),Y(et),Ue.classList.add(Kr),et.classList.add(Kr),this._queueCallback(()=>{et.classList.remove(Kr,Gt),et.classList.add(Do),Ue.classList.remove(Do,Gt,Kr),this._isSliding=!1,br(ho)},Ue,this._isAnimated()),Ar&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return Pt.findOne(jo,this._element)}_getItems(){return Pt.find(Lo,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder($){return ye()?$===ln?Rn:Zr:$===ln?Zr:Rn}_orderToDirection($){return ye()?$===Rn?ln:jn:$===Rn?jn:ln}static jQueryInterface($){return this.each(function(){const ce=$o.getOrCreateInstance(this,$);if(typeof $!="number"){if(typeof $=="string"){if(ce[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ce[$]()}}else ce.to($)})}}gt.on(document,Zo,"[data-bs-slide], [data-bs-slide-to]",function(Ie){const $=Pt.getElementFromSelector(this);if(!$||!$.classList.contains(en))return;Ie.preventDefault();const ce=$o.getOrCreateInstance($),Ue=this.getAttribute("data-bs-slide-to");return Ue?(ce.to(Ue),void ce._maybeEnableCycle()):pr.getDataAttribute(this,"slide")==="next"?(ce.next(),void ce._maybeEnableCycle()):(ce.prev(),void ce._maybeEnableCycle())}),gt.on(window,Oi,()=>{const Ie=Pt.find('[data-bs-ride="carousel"]');for(const $ of Ie)$o.getOrCreateInstance($)}),ke($o);const pt=".bs.collapse",fe=`show${pt}`,xe=`shown${pt}`,Ne=`hide${pt}`,Ke=`hidden${pt}`,Ge=`click${pt}.data-api`,st="show",_t="collapse",at="collapsing",bt=`:scope .${_t} .${_t}`,St='[data-bs-toggle="collapse"]',xt={parent:null,toggle:!0},jt={parent:"(null|element)",toggle:"boolean"};class ur extends ar{constructor($,ce){super($,ce),this._isTransitioning=!1,this._triggerArray=[];const Ue=Pt.find(St);for(const It of Ue){const et=Pt.getSelectorFromElement(It),Jt=Pt.find(et).filter(br=>br===this._element);et!==null&&Jt.length&&this._triggerArray.push(It)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return xt}static get DefaultType(){return jt}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let $=[];if(this._config.parent&&($=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter(It=>It!==this._element).map(It=>ur.getOrCreateInstance(It,{toggle:!1}))),$.length&&$[0]._isTransitioning||gt.trigger(this._element,fe).defaultPrevented)return;for(const It of $)It.hide();const ce=this._getDimension();this._element.classList.remove(_t),this._element.classList.add(at),this._element.style[ce]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const Ue=`scroll${ce[0].toUpperCase()+ce.slice(1)}`;this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(at),this._element.classList.add(_t,st),this._element.style[ce]="",gt.trigger(this._element,xe)},this._element,!0),this._element.style[ce]=`${this._element[Ue]}px`}hide(){if(this._isTransitioning||!this._isShown()||gt.trigger(this._element,Ne).defaultPrevented)return;const $=this._getDimension();this._element.style[$]=`${this._element.getBoundingClientRect()[$]}px`,Y(this._element),this._element.classList.add(at),this._element.classList.remove(_t,st);for(const ce of this._triggerArray){const Ue=Pt.getElementFromSelector(ce);Ue&&!this._isShown(Ue)&&this._addAriaAndCollapsedClass([ce],!1)}this._isTransitioning=!0,this._element.style[$]="",this._queueCallback(()=>{this._isTransitioning=!1,this._element.classList.remove(at),this._element.classList.add(_t),gt.trigger(this._element,Ke)},this._element,!0)}_isShown($=this._element){return $.classList.contains(st)}_configAfterMerge($){return $.toggle=!!$.toggle,$.parent=o($.parent),$}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const $=this._getFirstLevelChildren(St);for(const ce of $){const Ue=Pt.getElementFromSelector(ce);Ue&&this._addAriaAndCollapsedClass([ce],this._isShown(Ue))}}_getFirstLevelChildren($){const ce=Pt.find(bt,this._config.parent);return Pt.find($,this._config.parent).filter(Ue=>!ce.includes(Ue))}_addAriaAndCollapsedClass($,ce){if($.length)for(const Ue of $)Ue.classList.toggle("collapsed",!ce),Ue.setAttribute("aria-expanded",ce)}static jQueryInterface($){const ce={};return typeof $=="string"&&/show|hide/.test($)&&(ce.toggle=!1),this.each(function(){const Ue=ur.getOrCreateInstance(this,ce);if(typeof $=="string"){if(Ue[$]===void 0)throw new TypeError(`No method named "${$}"`);Ue[$]()}})}}gt.on(document,Ge,St,function(Ie){(Ie.target.tagName==="A"||Ie.delegateTarget&&Ie.delegateTarget.tagName==="A")&&Ie.preventDefault();for(const $ of Pt.getMultipleElementsFromSelector(this))ur.getOrCreateInstance($,{toggle:!1}).toggle()}),ke(ur);var ir="top",Rr="bottom",Br="right",kr="left",zr="auto",yn=[ir,Rr,Br,kr],Tn="start",Yr="end",On="clippingParents",Qn="viewport",Kn="popper",Di="reference",Li=yn.reduce(function(Ie,$){return Ie.concat([$+"-"+Tn,$+"-"+Yr])},[]),mo=[].concat(yn,[zr]).reduce(function(Ie,$){return Ie.concat([$,$+"-"+Tn,$+"-"+Yr])},[]),os="beforeRead",Ka="read",As="afterRead",Xs="beforeMain",Ma="main",Bo="afterMain",ka="beforeWrite",la="write",ca="afterWrite",Ys=[os,Ka,As,Xs,Ma,Bo,ka,la,ca];function Xi(Ie){return Ie?(Ie.nodeName||"").toLowerCase():null}function ji(Ie){if(Ie==null)return window;if(Ie.toString()!=="[object Window]"){var $=Ie.ownerDocument;return $&&$.defaultView||window}return Ie}function eo(Ie){return Ie instanceof ji(Ie).Element||Ie instanceof Element}function Ci(Ie){return Ie instanceof ji(Ie).HTMLElement||Ie instanceof HTMLElement}function Yi(Ie){return typeof ShadowRoot<"u"&&(Ie instanceof ji(Ie).ShadowRoot||Ie instanceof ShadowRoot)}const go={name:"applyStyles",enabled:!0,phase:"write",fn:function(Ie){var $=Ie.state;Object.keys($.elements).forEach(function(ce){var Ue=$.styles[ce]||{},It=$.attributes[ce]||{},et=$.elements[ce];Ci(et)&&Xi(et)&&(Object.assign(et.style,Ue),Object.keys(It).forEach(function(Jt){var br=It[Jt];br===!1?et.removeAttribute(Jt):et.setAttribute(Jt,br===!0?"":br)}))})},effect:function(Ie){var $=Ie.state,ce={popper:{position:$.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign($.elements.popper.style,ce.popper),$.styles=ce,$.elements.arrow&&Object.assign($.elements.arrow.style,ce.arrow),function(){Object.keys($.elements).forEach(function(Ue){var It=$.elements[Ue],et=$.attributes[Ue]||{},Jt=Object.keys($.styles.hasOwnProperty(Ue)?$.styles[Ue]:ce[Ue]).reduce(function(br,Ar){return br[Ar]="",br},{});Ci(It)&&Xi(It)&&(Object.assign(It.style,Jt),Object.keys(et).forEach(function(br){It.removeAttribute(br)}))})}},requires:["computeStyles"]};function io(Ie){return Ie.split("-")[0]}var _s=Math.max,Ko=Math.min,ei=Math.round;function ua(){var Ie=navigator.userAgentData;return Ie!=null&&Ie.brands&&Array.isArray(Ie.brands)?Ie.brands.map(function($){return $.brand+"/"+$.version}).join(" "):navigator.userAgent}function Js(){return!/^((?!chrome|android).)*safari/i.test(ua())}function Ji(Ie,$,ce){$===void 0&&($=!1),ce===void 0&&(ce=!1);var Ue=Ie.getBoundingClientRect(),It=1,et=1;$&&Ci(Ie)&&(It=Ie.offsetWidth>0&&ei(Ue.width)/Ie.offsetWidth||1,et=Ie.offsetHeight>0&&ei(Ue.height)/Ie.offsetHeight||1);var Jt=(eo(Ie)?ji(Ie):window).visualViewport,br=!Js()&&ce,Ar=(Ue.left+(br&&Jt?Jt.offsetLeft:0))/It,Kr=(Ue.top+(br&&Jt?Jt.offsetTop:0))/et,Gt=Ue.width/It,Gr=Ue.height/et;return{width:Gt,height:Gr,top:Kr,right:Ar+Gt,bottom:Kr+Gr,left:Ar,x:Ar,y:Kr}}function Cs(Ie){var $=Ji(Ie),ce=Ie.offsetWidth,Ue=Ie.offsetHeight;return Math.abs($.width-ce)<=1&&(ce=$.width),Math.abs($.height-Ue)<=1&&(Ue=$.height),{x:Ie.offsetLeft,y:Ie.offsetTop,width:ce,height:Ue}}function Qs(Ie,$){var ce=$.getRootNode&&$.getRootNode();if(Ie.contains($))return!0;if(ce&&Yi(ce)){var Ue=$;do{if(Ue&&Ie.isSameNode(Ue))return!0;Ue=Ue.parentNode||Ue.host}while(Ue)}return!1}function Ao(Ie){return ji(Ie).getComputedStyle(Ie)}function ea(Ie){return["table","td","th"].indexOf(Xi(Ie))>=0}function Xo(Ie){return((eo(Ie)?Ie.ownerDocument:Ie.document)||window.document).documentElement}function Oa(Ie){return Xi(Ie)==="html"?Ie:Ie.assignedSlot||Ie.parentNode||(Yi(Ie)?Ie.host:null)||Xo(Ie)}function it(Ie){return Ci(Ie)&&Ao(Ie).position!=="fixed"?Ie.offsetParent:null}function Ht(Ie){for(var $=ji(Ie),ce=it(Ie);ce&&ea(ce)&&Ao(ce).position==="static";)ce=it(ce);return ce&&(Xi(ce)==="html"||Xi(ce)==="body"&&Ao(ce).position==="static")?$:ce||function(Ue){var It=/firefox/i.test(ua());if(/Trident/i.test(ua())&&Ci(Ue)&&Ao(Ue).position==="fixed")return null;var et=Oa(Ue);for(Yi(et)&&(et=et.host);Ci(et)&&["html","body"].indexOf(Xi(et))<0;){var Jt=Ao(et);if(Jt.transform!=="none"||Jt.perspective!=="none"||Jt.contain==="paint"||["transform","perspective"].indexOf(Jt.willChange)!==-1||It&&Jt.willChange==="filter"||It&&Jt.filter&&Jt.filter!=="none")return et;et=et.parentNode}return null}(Ie)||$}function Zt(Ie){return["top","bottom"].indexOf(Ie)>=0?"x":"y"}function vn(Ie,$,ce){return _s(Ie,Ko($,ce))}function vr(Ie){return Object.assign({},{top:0,right:0,bottom:0,left:0},Ie)}function pi(Ie,$){return $.reduce(function(ce,Ue){return ce[Ue]=Ie,ce},{})}const Bi={name:"arrow",enabled:!0,phase:"main",fn:function(Ie){var $,ce=Ie.state,Ue=Ie.name,It=Ie.options,et=ce.elements.arrow,Jt=ce.modifiersData.popperOffsets,br=io(ce.placement),Ar=Zt(br),Kr=[kr,Br].indexOf(br)>=0?"height":"width";if(et&&Jt){var Gt=function(yi,Gi){return vr(typeof(yi=typeof yi=="function"?yi(Object.assign({},Gi.rects,{placement:Gi.placement})):yi)!="number"?yi:pi(yi,yn))}(It.padding,ce),Gr=Cs(et),Hn=Ar==="y"?ir:kr,bn=Ar==="y"?Rr:Br,Mn=ce.rects.reference[Kr]+ce.rects.reference[Ar]-Jt[Ar]-ce.rects.popper[Kr],En=Jt[Ar]-ce.rects.reference[Ar],Bn=Ht(et),ro=Bn?Ar==="y"?Bn.clientHeight||0:Bn.clientWidth||0:0,po=Mn/2-En/2,$n=Gt[Hn],_i=ro-Gr[Kr]-Gt[bn],Vn=ro/2-Gr[Kr]/2+po,Xn=vn($n,Vn,_i),kn=Ar;ce.modifiersData[Ue]=(($={})[kn]=Xn,$.centerOffset=Xn-Vn,$)}},effect:function(Ie){var $=Ie.state,ce=Ie.options.element,Ue=ce===void 0?"[data-popper-arrow]":ce;Ue!=null&&(typeof Ue!="string"||(Ue=$.elements.popper.querySelector(Ue)))&&Qs($.elements.popper,Ue)&&($.elements.arrow=Ue)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ai(Ie){return Ie.split("-")[1]}var _o={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ri(Ie){var $,ce=Ie.popper,Ue=Ie.popperRect,It=Ie.placement,et=Ie.variation,Jt=Ie.offsets,br=Ie.position,Ar=Ie.gpuAcceleration,Kr=Ie.adaptive,Gt=Ie.roundOffsets,Gr=Ie.isFixed,Hn=Jt.x,bn=Hn===void 0?0:Hn,Mn=Jt.y,En=Mn===void 0?0:Mn,Bn=typeof Gt=="function"?Gt({x:bn,y:En}):{x:bn,y:En};bn=Bn.x,En=Bn.y;var ro=Jt.hasOwnProperty("x"),po=Jt.hasOwnProperty("y"),$n=kr,_i=ir,Vn=window;if(Kr){var Xn=Ht(ce),kn="clientHeight",yi="clientWidth";Xn===ji(ce)&&Ao(Xn=Xo(ce)).position!=="static"&&br==="absolute"&&(kn="scrollHeight",yi="scrollWidth"),(It===ir||(It===kr||It===Br)&&et===Yr)&&(_i=Rr,En-=(Gr&&Xn===Vn&&Vn.visualViewport?Vn.visualViewport.height:Xn[kn])-Ue.height,En*=Ar?1:-1),It!==kr&&(It!==ir&&It!==Rr||et!==Yr)||($n=Br,bn-=(Gr&&Xn===Vn&&Vn.visualViewport?Vn.visualViewport.width:Xn[yi])-Ue.width,bn*=Ar?1:-1)}var Gi,Po=Object.assign({position:br},Kr&&_o),Us=Gt===!0?function(ba,xs){var vo=ba.x,li=ba.y,bo=xs.devicePixelRatio||1;return{x:ei(vo*bo)/bo||0,y:ei(li*bo)/bo||0}}({x:bn,y:En},ji(ce)):{x:bn,y:En};return bn=Us.x,En=Us.y,Ar?Object.assign({},Po,((Gi={})[_i]=po?"0":"",Gi[$n]=ro?"0":"",Gi.transform=(Vn.devicePixelRatio||1)<=1?"translate("+bn+"px, "+En+"px)":"translate3d("+bn+"px, "+En+"px, 0)",Gi)):Object.assign({},Po,(($={})[_i]=po?En+"px":"",$[$n]=ro?bn+"px":"",$.transform="",$))}const Yo={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(Ie){var $=Ie.state,ce=Ie.options,Ue=ce.gpuAcceleration,It=Ue===void 0||Ue,et=ce.adaptive,Jt=et===void 0||et,br=ce.roundOffsets,Ar=br===void 0||br,Kr={placement:io($.placement),variation:ai($.placement),popper:$.elements.popper,popperRect:$.rects.popper,gpuAcceleration:It,isFixed:$.options.strategy==="fixed"};$.modifiersData.popperOffsets!=null&&($.styles.popper=Object.assign({},$.styles.popper,Ri(Object.assign({},Kr,{offsets:$.modifiersData.popperOffsets,position:$.options.strategy,adaptive:Jt,roundOffsets:Ar})))),$.modifiersData.arrow!=null&&($.styles.arrow=Object.assign({},$.styles.arrow,Ri(Object.assign({},Kr,{offsets:$.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Ar})))),$.attributes.popper=Object.assign({},$.attributes.popper,{"data-popper-placement":$.placement})},data:{}};var cr={passive:!0};const cn={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(Ie){var $=Ie.state,ce=Ie.instance,Ue=Ie.options,It=Ue.scroll,et=It===void 0||It,Jt=Ue.resize,br=Jt===void 0||Jt,Ar=ji($.elements.popper),Kr=[].concat($.scrollParents.reference,$.scrollParents.popper);return et&&Kr.forEach(function(Gt){Gt.addEventListener("scroll",ce.update,cr)}),br&&Ar.addEventListener("resize",ce.update,cr),function(){et&&Kr.forEach(function(Gt){Gt.removeEventListener("scroll",ce.update,cr)}),br&&Ar.removeEventListener("resize",ce.update,cr)}},data:{}};var fn={left:"right",right:"left",bottom:"top",top:"bottom"};function oo(Ie){return Ie.replace(/left|right|bottom|top/g,function($){return fn[$]})}var $i={start:"end",end:"start"};function on(Ie){return Ie.replace(/start|end/g,function($){return $i[$]})}function Bs(Ie){var $=ji(Ie);return{scrollLeft:$.pageXOffset,scrollTop:$.pageYOffset}}function ss(Ie){return Ji(Xo(Ie)).left+Bs(Ie).scrollLeft}function mi(Ie){var $=Ao(Ie),ce=$.overflow,Ue=$.overflowX,It=$.overflowY;return/auto|scroll|overlay|hidden/.test(ce+It+Ue)}function Co(Ie){return["html","body","#document"].indexOf(Xi(Ie))>=0?Ie.ownerDocument.body:Ci(Ie)&&mi(Ie)?Ie:Co(Oa(Ie))}function Xe(Ie,$){var ce;$===void 0&&($=[]);var Ue=Co(Ie),It=Ue===((ce=Ie.ownerDocument)==null?void 0:ce.body),et=ji(Ue),Jt=It?[et].concat(et.visualViewport||[],mi(Ue)?Ue:[]):Ue,br=$.concat(Jt);return It?br:br.concat(Xe(Oa(Jt)))}function Rt(Ie){return Object.assign({},Ie,{left:Ie.x,top:Ie.y,right:Ie.x+Ie.width,bottom:Ie.y+Ie.height})}function gr(Ie,$,ce){return $===Qn?Rt(function(Ue,It){var et=ji(Ue),Jt=Xo(Ue),br=et.visualViewport,Ar=Jt.clientWidth,Kr=Jt.clientHeight,Gt=0,Gr=0;if(br){Ar=br.width,Kr=br.height;var Hn=Js();(Hn||!Hn&&It==="fixed")&&(Gt=br.offsetLeft,Gr=br.offsetTop)}return{width:Ar,height:Kr,x:Gt+ss(Ue),y:Gr}}(Ie,ce)):eo($)?function(Ue,It){var et=Ji(Ue,!1,It==="fixed");return et.top=et.top+Ue.clientTop,et.left=et.left+Ue.clientLeft,et.bottom=et.top+Ue.clientHeight,et.right=et.left+Ue.clientWidth,et.width=Ue.clientWidth,et.height=Ue.clientHeight,et.x=et.left,et.y=et.top,et}($,ce):Rt(function(Ue){var It,et=Xo(Ue),Jt=Bs(Ue),br=(It=Ue.ownerDocument)==null?void 0:It.body,Ar=_s(et.scrollWidth,et.clientWidth,br?br.scrollWidth:0,br?br.clientWidth:0),Kr=_s(et.scrollHeight,et.clientHeight,br?br.scrollHeight:0,br?br.clientHeight:0),Gt=-Jt.scrollLeft+ss(Ue),Gr=-Jt.scrollTop;return Ao(br||et).direction==="rtl"&&(Gt+=_s(et.clientWidth,br?br.clientWidth:0)-Ar),{width:Ar,height:Kr,x:Gt,y:Gr}}(Xo(Ie)))}function $r(Ie){var $,ce=Ie.reference,Ue=Ie.element,It=Ie.placement,et=It?io(It):null,Jt=It?ai(It):null,br=ce.x+ce.width/2-Ue.width/2,Ar=ce.y+ce.height/2-Ue.height/2;switch(et){case ir:$={x:br,y:ce.y-Ue.height};break;case Rr:$={x:br,y:ce.y+ce.height};break;case Br:$={x:ce.x+ce.width,y:Ar};break;case kr:$={x:ce.x-Ue.width,y:Ar};break;default:$={x:ce.x,y:ce.y}}var Kr=et?Zt(et):null;if(Kr!=null){var Gt=Kr==="y"?"height":"width";switch(Jt){case Tn:$[Kr]=$[Kr]-(ce[Gt]/2-Ue[Gt]/2);break;case Yr:$[Kr]=$[Kr]+(ce[Gt]/2-Ue[Gt]/2)}}return $}function Dn(Ie,$){$===void 0&&($={});var ce=$,Ue=ce.placement,It=Ue===void 0?Ie.placement:Ue,et=ce.strategy,Jt=et===void 0?Ie.strategy:et,br=ce.boundary,Ar=br===void 0?On:br,Kr=ce.rootBoundary,Gt=Kr===void 0?Qn:Kr,Gr=ce.elementContext,Hn=Gr===void 0?Kn:Gr,bn=ce.altBoundary,Mn=bn!==void 0&&bn,En=ce.padding,Bn=En===void 0?0:En,ro=vr(typeof Bn!="number"?Bn:pi(Bn,yn)),po=Hn===Kn?Di:Kn,$n=Ie.rects.popper,_i=Ie.elements[Mn?po:Hn],Vn=function(xs,vo,li,bo){var Da=vo==="clippingParents"?function(ao){var Qo=Xe(Oa(ao)),ws=["absolute","fixed"].indexOf(Ao(ao).position)>=0&&Ci(ao)?Ht(ao):ao;return eo(ws)?Qo.filter(function(Xt){return eo(Xt)&&Qs(Xt,ws)&&Xi(Xt)!=="body"}):[]}(xs):[].concat(vo),el=[].concat(Da,[li]),pc=el[0],ls=el.reduce(function(ao,Qo){var ws=gr(xs,Qo,bo);return ao.top=_s(ws.top,ao.top),ao.right=Ko(ws.right,ao.right),ao.bottom=Ko(ws.bottom,ao.bottom),ao.left=_s(ws.left,ao.left),ao},gr(xs,pc,bo));return ls.width=ls.right-ls.left,ls.height=ls.bottom-ls.top,ls.x=ls.left,ls.y=ls.top,ls}(eo(_i)?_i:_i.contextElement||Xo(Ie.elements.popper),Ar,Gt,Jt),Xn=Ji(Ie.elements.reference),kn=$r({reference:Xn,element:$n,strategy:"absolute",placement:It}),yi=Rt(Object.assign({},$n,kn)),Gi=Hn===Kn?yi:Xn,Po={top:Vn.top-Gi.top+ro.top,bottom:Gi.bottom-Vn.bottom+ro.bottom,left:Vn.left-Gi.left+ro.left,right:Gi.right-Vn.right+ro.right},Us=Ie.modifiersData.offset;if(Hn===Kn&&Us){var ba=Us[It];Object.keys(Po).forEach(function(xs){var vo=[Br,Rr].indexOf(xs)>=0?1:-1,li=[ir,Rr].indexOf(xs)>=0?"y":"x";Po[xs]+=ba[li]*vo})}return Po}function An(Ie,$){$===void 0&&($={});var ce=$,Ue=ce.placement,It=ce.boundary,et=ce.rootBoundary,Jt=ce.padding,br=ce.flipVariations,Ar=ce.allowedAutoPlacements,Kr=Ar===void 0?mo:Ar,Gt=ai(Ue),Gr=Gt?br?Li:Li.filter(function(Mn){return ai(Mn)===Gt}):yn,Hn=Gr.filter(function(Mn){return Kr.indexOf(Mn)>=0});Hn.length===0&&(Hn=Gr);var bn=Hn.reduce(function(Mn,En){return Mn[En]=Dn(Ie,{placement:En,boundary:It,rootBoundary:et,padding:Jt})[io(En)],Mn},{});return Object.keys(bn).sort(function(Mn,En){return bn[Mn]-bn[En]})}const Pn={name:"flip",enabled:!0,phase:"main",fn:function(Ie){var $=Ie.state,ce=Ie.options,Ue=Ie.name;if(!$.modifiersData[Ue]._skip){for(var It=ce.mainAxis,et=It===void 0||It,Jt=ce.altAxis,br=Jt===void 0||Jt,Ar=ce.fallbackPlacements,Kr=ce.padding,Gt=ce.boundary,Gr=ce.rootBoundary,Hn=ce.altBoundary,bn=ce.flipVariations,Mn=bn===void 0||bn,En=ce.allowedAutoPlacements,Bn=$.options.placement,ro=io(Bn),po=Ar||(ro!==Bn&&Mn?function(ao){if(io(ao)===zr)return[];var Qo=oo(ao);return[on(ao),Qo,on(Qo)]}(Bn):[oo(Bn)]),$n=[Bn].concat(po).reduce(function(ao,Qo){return ao.concat(io(Qo)===zr?An($,{placement:Qo,boundary:Gt,rootBoundary:Gr,padding:Kr,flipVariations:Mn,allowedAutoPlacements:En}):Qo)},[]),_i=$.rects.reference,Vn=$.rects.popper,Xn=new Map,kn=!0,yi=$n[0],Gi=0;Gi<$n.length;Gi++){var Po=$n[Gi],Us=io(Po),ba=ai(Po)===Tn,xs=[ir,Rr].indexOf(Us)>=0,vo=xs?"width":"height",li=Dn($,{placement:Po,boundary:Gt,rootBoundary:Gr,altBoundary:Hn,padding:Kr}),bo=xs?ba?Br:kr:ba?Rr:ir;_i[vo]>Vn[vo]&&(bo=oo(bo));var Da=oo(bo),el=[];if(et&&el.push(li[Us]<=0),br&&el.push(li[bo]<=0,li[Da]<=0),el.every(function(ao){return ao})){yi=Po,kn=!1;break}Xn.set(Po,el)}if(kn)for(var pc=function(ao){var Qo=$n.find(function(ws){var Xt=Xn.get(ws);if(Xt)return Xt.slice(0,ao).every(function(Mr){return Mr})});if(Qo)return yi=Qo,"break"},ls=Mn?3:1;ls>0&&pc(ls)!=="break";ls--);$.placement!==yi&&($.modifiersData[Ue]._skip=!0,$.placement=yi,$.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function ti(Ie,$,ce){return ce===void 0&&(ce={x:0,y:0}),{top:Ie.top-$.height-ce.y,right:Ie.right-$.width+ce.x,bottom:Ie.bottom-$.height+ce.y,left:Ie.left-$.width-ce.x}}function hi(Ie){return[ir,Br,Rr,kr].some(function($){return Ie[$]>=0})}const xi={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(Ie){var $=Ie.state,ce=Ie.name,Ue=$.rects.reference,It=$.rects.popper,et=$.modifiersData.preventOverflow,Jt=Dn($,{elementContext:"reference"}),br=Dn($,{altBoundary:!0}),Ar=ti(Jt,Ue),Kr=ti(br,It,et),Gt=hi(Ar),Gr=hi(Kr);$.modifiersData[ce]={referenceClippingOffsets:Ar,popperEscapeOffsets:Kr,isReferenceHidden:Gt,hasPopperEscaped:Gr},$.attributes.popper=Object.assign({},$.attributes.popper,{"data-popper-reference-hidden":Gt,"data-popper-escaped":Gr})}},fo={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(Ie){var $=Ie.state,ce=Ie.options,Ue=Ie.name,It=ce.offset,et=It===void 0?[0,0]:It,Jt=mo.reduce(function(Gt,Gr){return Gt[Gr]=function(Hn,bn,Mn){var En=io(Hn),Bn=[kr,ir].indexOf(En)>=0?-1:1,ro=typeof Mn=="function"?Mn(Object.assign({},bn,{placement:Hn})):Mn,po=ro[0],$n=ro[1];return po=po||0,$n=($n||0)*Bn,[kr,Br].indexOf(En)>=0?{x:$n,y:po}:{x:po,y:$n}}(Gr,$.rects,et),Gt},{}),br=Jt[$.placement],Ar=br.x,Kr=br.y;$.modifiersData.popperOffsets!=null&&($.modifiersData.popperOffsets.x+=Ar,$.modifiersData.popperOffsets.y+=Kr),$.modifiersData[Ue]=Jt}},qn={name:"popperOffsets",enabled:!0,phase:"read",fn:function(Ie){var $=Ie.state,ce=Ie.name;$.modifiersData[ce]=$r({reference:$.rects.reference,element:$.rects.popper,strategy:"absolute",placement:$.placement})},data:{}},ni={name:"preventOverflow",enabled:!0,phase:"main",fn:function(Ie){var $=Ie.state,ce=Ie.options,Ue=Ie.name,It=ce.mainAxis,et=It===void 0||It,Jt=ce.altAxis,br=Jt!==void 0&&Jt,Ar=ce.boundary,Kr=ce.rootBoundary,Gt=ce.altBoundary,Gr=ce.padding,Hn=ce.tether,bn=Hn===void 0||Hn,Mn=ce.tetherOffset,En=Mn===void 0?0:Mn,Bn=Dn($,{boundary:Ar,rootBoundary:Kr,padding:Gr,altBoundary:Gt}),ro=io($.placement),po=ai($.placement),$n=!po,_i=Zt(ro),Vn=_i==="x"?"y":"x",Xn=$.modifiersData.popperOffsets,kn=$.rects.reference,yi=$.rects.popper,Gi=typeof En=="function"?En(Object.assign({},$.rects,{placement:$.placement})):En,Po=typeof Gi=="number"?{mainAxis:Gi,altAxis:Gi}:Object.assign({mainAxis:0,altAxis:0},Gi),Us=$.modifiersData.offset?$.modifiersData.offset[$.placement]:null,ba={x:0,y:0};if(Xn){if(et){var xs,vo=_i==="y"?ir:kr,li=_i==="y"?Rr:Br,bo=_i==="y"?"height":"width",Da=Xn[_i],el=Da+Bn[vo],pc=Da-Bn[li],ls=bn?-yi[bo]/2:0,ao=po===Tn?kn[bo]:yi[bo],Qo=po===Tn?-yi[bo]:-kn[bo],ws=$.elements.arrow,Xt=bn&&ws?Cs(ws):{width:0,height:0},Mr=$.modifiersData["arrow#persistent"]?$.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},La=Mr[vo],qi=Mr[li],mt=vn(0,kn[bo],Xt[bo]),Vu=$n?kn[bo]/2-ls-mt-La-Po.mainAxis:ao-mt-La-Po.mainAxis,jh=$n?-kn[bo]/2+ls+mt+qi+Po.mainAxis:Qo+mt+qi+Po.mainAxis,Uu=$.elements.arrow&&Ht($.elements.arrow),tl=Uu?_i==="y"?Uu.clientTop||0:Uu.clientLeft||0:0,$h=(xs=Us==null?void 0:Us[_i])!=null?xs:0,mc=Da+jh-$h,gc=vn(bn?Ko(el,Da+Vu-$h-tl):el,Da,bn?_s(pc,mc):pc);Xn[_i]=gc,ba[_i]=gc-Da}if(br){var Lp,_g=_i==="x"?ir:kr,Bp=_i==="x"?Rr:Br,dl=Xn[Vn],_c=Vn==="y"?"height":"width",ju=dl+Bn[_g],Qc=dl-Bn[Bp],yc=[ir,kr].indexOf(ro)!==-1,vc=(Lp=Us==null?void 0:Us[Vn])!=null?Lp:0,pf=yc?ju:dl-kn[_c]-yi[_c]-vc+Po.altAxis,Ba=yc?dl+kn[_c]+yi[_c]-vc-Po.altAxis:Qc,zp=bn&&yc?function(Ps,yg,bc){var Pi=vn(Ps,yg,bc);return Pi>bc?bc:Pi}(pf,dl,Ba):vn(bn?pf:ju,dl,bn?Ba:Qc);Xn[Vn]=zp,ba[Vn]=zp-dl}$.modifiersData[Ue]=ba}},requiresIfExists:["offset"]};function so(Ie,$,ce){ce===void 0&&(ce=!1);var Ue,It,et=Ci($),Jt=Ci($)&&function(Gr){var Hn=Gr.getBoundingClientRect(),bn=ei(Hn.width)/Gr.offsetWidth||1,Mn=ei(Hn.height)/Gr.offsetHeight||1;return bn!==1||Mn!==1}($),br=Xo($),Ar=Ji(Ie,Jt,ce),Kr={scrollLeft:0,scrollTop:0},Gt={x:0,y:0};return(et||!et&&!ce)&&((Xi($)!=="body"||mi(br))&&(Kr=(Ue=$)!==ji(Ue)&&Ci(Ue)?{scrollLeft:(It=Ue).scrollLeft,scrollTop:It.scrollTop}:Bs(Ue)),Ci($)?((Gt=Ji($,!0)).x+=$.clientLeft,Gt.y+=$.clientTop):br&&(Gt.x=ss(br))),{x:Ar.left+Kr.scrollLeft-Gt.x,y:Ar.top+Kr.scrollTop-Gt.y,width:Ar.width,height:Ar.height}}function ii(Ie){var $=new Map,ce=new Set,Ue=[];function It(et){ce.add(et.name),[].concat(et.requires||[],et.requiresIfExists||[]).forEach(function(Jt){if(!ce.has(Jt)){var br=$.get(Jt);br&&It(br)}}),Ue.push(et)}return Ie.forEach(function(et){$.set(et.name,et)}),Ie.forEach(function(et){ce.has(et.name)||It(et)}),Ue}var zs={placement:"bottom",modifiers:[],strategy:"absolute"};function yo(){for(var Ie=arguments.length,$=new Array(Ie),ce=0;ce<Ie;ce++)$[ce]=arguments[ce];return!$.some(function(Ue){return!(Ue&&typeof Ue.getBoundingClientRect=="function")})}function Ro(Ie){Ie===void 0&&(Ie={});var $=Ie,ce=$.defaultModifiers,Ue=ce===void 0?[]:ce,It=$.defaultOptions,et=It===void 0?zs:It;return function(Jt,br,Ar){Ar===void 0&&(Ar=et);var Kr,Gt,Gr={placement:"bottom",orderedModifiers:[],options:Object.assign({},zs,et),modifiersData:{},elements:{reference:Jt,popper:br},attributes:{},styles:{}},Hn=[],bn=!1,Mn={state:Gr,setOptions:function(Bn){var ro=typeof Bn=="function"?Bn(Gr.options):Bn;En(),Gr.options=Object.assign({},et,Gr.options,ro),Gr.scrollParents={reference:eo(Jt)?Xe(Jt):Jt.contextElement?Xe(Jt.contextElement):[],popper:Xe(br)};var po,$n,_i=function(Vn){var Xn=ii(Vn);return Ys.reduce(function(kn,yi){return kn.concat(Xn.filter(function(Gi){return Gi.phase===yi}))},[])}((po=[].concat(Ue,Gr.options.modifiers),$n=po.reduce(function(Vn,Xn){var kn=Vn[Xn.name];return Vn[Xn.name]=kn?Object.assign({},kn,Xn,{options:Object.assign({},kn.options,Xn.options),data:Object.assign({},kn.data,Xn.data)}):Xn,Vn},{}),Object.keys($n).map(function(Vn){return $n[Vn]})));return Gr.orderedModifiers=_i.filter(function(Vn){return Vn.enabled}),Gr.orderedModifiers.forEach(function(Vn){var Xn=Vn.name,kn=Vn.options,yi=kn===void 0?{}:kn,Gi=Vn.effect;if(typeof Gi=="function"){var Po=Gi({state:Gr,name:Xn,instance:Mn,options:yi});Hn.push(Po||function(){})}}),Mn.update()},forceUpdate:function(){if(!bn){var Bn=Gr.elements,ro=Bn.reference,po=Bn.popper;if(yo(ro,po)){Gr.rects={reference:so(ro,Ht(po),Gr.options.strategy==="fixed"),popper:Cs(po)},Gr.reset=!1,Gr.placement=Gr.options.placement,Gr.orderedModifiers.forEach(function(Gi){return Gr.modifiersData[Gi.name]=Object.assign({},Gi.data)});for(var $n=0;$n<Gr.orderedModifiers.length;$n++)if(Gr.reset!==!0){var _i=Gr.orderedModifiers[$n],Vn=_i.fn,Xn=_i.options,kn=Xn===void 0?{}:Xn,yi=_i.name;typeof Vn=="function"&&(Gr=Vn({state:Gr,options:kn,name:yi,instance:Mn})||Gr)}else Gr.reset=!1,$n=-1}}},update:(Kr=function(){return new Promise(function(Bn){Mn.forceUpdate(),Bn(Gr)})},function(){return Gt||(Gt=new Promise(function(Bn){Promise.resolve().then(function(){Gt=void 0,Bn(Kr())})})),Gt}),destroy:function(){En(),bn=!0}};if(!yo(Jt,br))return Mn;function En(){Hn.forEach(function(Bn){return Bn()}),Hn=[]}return Mn.setOptions(Ar).then(function(Bn){!bn&&Ar.onFirstUpdate&&Ar.onFirstUpdate(Bn)}),Mn}}var ha=Ro(),Ns=Ro({defaultModifiers:[cn,qn,Yo,go]}),Fs=Ro({defaultModifiers:[cn,qn,Yo,go,fo,Pn,ni,Bi,xi]});const ta=Object.freeze(Object.defineProperty({__proto__:null,afterMain:Bo,afterRead:As,afterWrite:ca,applyStyles:go,arrow:Bi,auto:zr,basePlacements:yn,beforeMain:Xs,beforeRead:os,beforeWrite:ka,bottom:Rr,clippingParents:On,computeStyles:Yo,createPopper:Fs,createPopperBase:ha,createPopperLite:Ns,detectOverflow:Dn,end:Yr,eventListeners:cn,flip:Pn,hide:xi,left:kr,main:Ma,modifierPhases:Ys,offset:fo,placements:mo,popper:Kn,popperGenerator:Ro,popperOffsets:qn,preventOverflow:ni,read:Ka,reference:Di,right:Br,start:Tn,top:ir,variationPlacements:Li,viewport:Qn,write:la},Symbol.toStringTag,{value:"Module"})),Eu="dropdown",da=".bs.dropdown",as=".data-api",vh="ArrowUp",fa="ArrowDown",Su=`hide${da}`,Rl=`hidden${da}`,Pl=`show${da}`,bh=`shown${da}`,Xa=`click${da}${as}`,zo=`keydown${da}${as}`,xh=`keyup${da}${as}`,ra="show",Vs='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',B=`${Vs}.${ra}`,ee=".dropdown-menu",de=ye()?"top-end":"top-start",Me=ye()?"top-start":"top-end",Bt=ye()?"bottom-end":"bottom-start",wt=ye()?"bottom-start":"bottom-end",Or=ye()?"left-start":"right-start",wi=ye()?"right-start":"left-start",Dr={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},di={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class zi extends ar{constructor($,ce){super($,ce),this._popper=null,this._parent=this._element.parentNode,this._menu=Pt.next(this._element,ee)[0]||Pt.prev(this._element,ee)[0]||Pt.findOne(ee,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Dr}static get DefaultType(){return di}static get NAME(){return Eu}toggle(){return this._isShown()?this.hide():this.show()}show(){if(z(this._element)||this._isShown())return;const $={relatedTarget:this._element};if(!gt.trigger(this._element,Pl,$).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const ce of[].concat(...document.body.children))gt.on(ce,"mouseover",H);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(ra),this._element.classList.add(ra),gt.trigger(this._element,bh,$)}}hide(){if(z(this._element)||!this._isShown())return;const $={relatedTarget:this._element};this._completeHide($)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide($){if(!gt.trigger(this._element,Su,$).defaultPrevented){if("ontouchstart"in document.documentElement)for(const ce of[].concat(...document.body.children))gt.off(ce,"mouseover",H);this._popper&&this._popper.destroy(),this._menu.classList.remove(ra),this._element.classList.remove(ra),this._element.setAttribute("aria-expanded","false"),pr.removeDataAttribute(this._menu,"popper"),gt.trigger(this._element,Rl,$)}}_getConfig($){if(typeof($=super._getConfig($)).reference=="object"&&!E($.reference)&&typeof $.reference.getBoundingClientRect!="function")throw new TypeError(`${Eu.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return $}_createPopper(){if(ta===void 0)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let $=this._element;this._config.reference==="parent"?$=this._parent:E(this._config.reference)?$=o(this._config.reference):typeof this._config.reference=="object"&&($=this._config.reference);const ce=this._getPopperConfig();this._popper=Fs($,this._menu,ce)}_isShown(){return this._menu.classList.contains(ra)}_getPlacement(){const $=this._parent;if($.classList.contains("dropend"))return Or;if($.classList.contains("dropstart"))return wi;if($.classList.contains("dropup-center"))return"top";if($.classList.contains("dropdown-center"))return"bottom";const ce=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return $.classList.contains("dropup")?ce?Me:de:ce?wt:Bt}_detectNavbar(){return this._element.closest(".navbar")!==null}_getOffset(){const{offset:$}=this._config;return typeof $=="string"?$.split(",").map(ce=>Number.parseInt(ce,10)):typeof $=="function"?ce=>$(ce,this._element):$}_getPopperConfig(){const $={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(pr.setDataAttribute(this._menu,"popper","static"),$.modifiers=[{name:"applyStyles",enabled:!1}]),{...$,...he(this._config.popperConfig,[$])}}_selectMenuItem({key:$,target:ce}){const Ue=Pt.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter(It=>O(It));Ue.length&&ve(Ue,ce,$===fa,!Ue.includes(ce)).focus()}static jQueryInterface($){return this.each(function(){const ce=zi.getOrCreateInstance(this,$);if(typeof $=="string"){if(ce[$]===void 0)throw new TypeError(`No method named "${$}"`);ce[$]()}})}static clearMenus($){if($.button===2||$.type==="keyup"&&$.key!=="Tab")return;const ce=Pt.find(B);for(const Ue of ce){const It=zi.getInstance(Ue);if(!It||It._config.autoClose===!1)continue;const et=$.composedPath(),Jt=et.includes(It._menu);if(et.includes(It._element)||It._config.autoClose==="inside"&&!Jt||It._config.autoClose==="outside"&&Jt||It._menu.contains($.target)&&($.type==="keyup"&&$.key==="Tab"||/input|select|option|textarea|form/i.test($.target.tagName)))continue;const br={relatedTarget:It._element};$.type==="click"&&(br.clickEvent=$),It._completeHide(br)}}static dataApiKeydownHandler($){const ce=/input|textarea/i.test($.target.tagName),Ue=$.key==="Escape",It=[vh,fa].includes($.key);if(!It&&!Ue||ce&&!Ue)return;$.preventDefault();const et=this.matches(Vs)?this:Pt.prev(this,Vs)[0]||Pt.next(this,Vs)[0]||Pt.findOne(Vs,$.delegateTarget.parentNode),Jt=zi.getOrCreateInstance(et);if(It)return $.stopPropagation(),Jt.show(),void Jt._selectMenuItem($);Jt._isShown()&&($.stopPropagation(),Jt.hide(),et.focus())}}gt.on(document,zo,Vs,zi.dataApiKeydownHandler),gt.on(document,zo,ee,zi.dataApiKeydownHandler),gt.on(document,Xa,zi.clearMenus),gt.on(document,xh,zi.clearMenus),gt.on(document,Xa,Vs,function(Ie){Ie.preventDefault(),zi.getOrCreateInstance(this).toggle()}),ke(zi);const Go="backdrop",Rs="show",Jo=`mousedown.bs.${Go}`,No={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},ql={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class sc extends Dt{constructor($){super(),this._config=this._getConfig($),this._isAppended=!1,this._element=null}static get Default(){return No}static get DefaultType(){return ql}static get NAME(){return Go}show($){if(!this._config.isVisible)return void he($);this._append();const ce=this._getElement();this._config.isAnimated&&Y(ce),ce.classList.add(Rs),this._emulateAnimation(()=>{he($)})}hide($){this._config.isVisible?(this._getElement().classList.remove(Rs),this._emulateAnimation(()=>{this.dispose(),he($)})):he($)}dispose(){this._isAppended&&(gt.off(this._element,Jo),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const $=document.createElement("div");$.className=this._config.className,this._config.isAnimated&&$.classList.add("fade"),this._element=$}return this._element}_configAfterMerge($){return $.rootElement=o($.rootElement),$}_append(){if(this._isAppended)return;const $=this._getElement();this._config.rootElement.append($),gt.on($,Jo,()=>{he(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation($){oe($,this._getElement(),this._config.isAnimated)}}const Ml=".bs.focustrap",wh=`focusin${Ml}`,kl=`keydown.tab${Ml}`,to="backward",Jd={autofocus:!0,trapElement:null},fr={autofocus:"boolean",trapElement:"element"};class Qd extends Dt{constructor($){super(),this._config=this._getConfig($),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Jd}static get DefaultType(){return fr}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),gt.off(document,Ml),gt.on(document,wh,$=>this._handleFocusin($)),gt.on(document,kl,$=>this._handleKeydown($)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,gt.off(document,Ml))}_handleFocusin($){const{trapElement:ce}=this._config;if($.target===document||$.target===ce||ce.contains($.target))return;const Ue=Pt.focusableChildren(ce);Ue.length===0?ce.focus():this._lastTabNavDirection===to?Ue[Ue.length-1].focus():Ue[0].focus()}_handleKeydown($){$.key==="Tab"&&(this._lastTabNavDirection=$.shiftKey?to:"forward")}}const ac=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Iu=".sticky-top",lc="padding-right",Au="margin-right";class Ya{constructor(){this._element=document.body}getWidth(){const $=document.documentElement.clientWidth;return Math.abs(window.innerWidth-$)}hide(){const $=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,lc,ce=>ce+$),this._setElementAttributes(ac,lc,ce=>ce+$),this._setElementAttributes(Iu,Au,ce=>ce-$)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,lc),this._resetElementAttributes(ac,lc),this._resetElementAttributes(Iu,Au)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes($,ce,Ue){const It=this.getWidth();this._applyManipulationCallback($,et=>{if(et!==this._element&&window.innerWidth>et.clientWidth+It)return;this._saveInitialAttribute(et,ce);const Jt=window.getComputedStyle(et).getPropertyValue(ce);et.style.setProperty(ce,`${Ue(Number.parseFloat(Jt))}px`)})}_saveInitialAttribute($,ce){const Ue=$.style.getPropertyValue(ce);Ue&&pr.setDataAttribute($,ce,Ue)}_resetElementAttributes($,ce){this._applyManipulationCallback($,Ue=>{const It=pr.getDataAttribute(Ue,ce);It!==null?(pr.removeDataAttribute(Ue,ce),Ue.style.setProperty(ce,It)):Ue.style.removeProperty(ce)})}_applyManipulationCallback($,ce){if(E($))ce($);else for(const Ue of Pt.find($,this._element))ce(Ue)}}const na=".bs.modal",pa=`hide${na}`,Th=`hidePrevented${na}`,cc=`hidden${na}`,ef=`show${na}`,mp=`shown${na}`,ma=`resize${na}`,gp=`click.dismiss${na}`,tf=`mousedown.dismiss${na}`,rf=`keydown.dismiss${na}`,Eh=`click${na}.data-api`,nf="modal-open",of="show",Sh="modal-static",_p={backdrop:!0,focus:!0,keyboard:!0},sf={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Hl extends ar{constructor($,ce){super($,ce),this._dialog=Pt.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new Ya,this._addEventListeners()}static get Default(){return _p}static get DefaultType(){return sf}static get NAME(){return"modal"}toggle($){return this._isShown?this.hide():this.show($)}show($){this._isShown||this._isTransitioning||gt.trigger(this._element,ef,{relatedTarget:$}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(nf),this._adjustDialog(),this._backdrop.show(()=>this._showElement($)))}hide(){this._isShown&&!this._isTransitioning&&(gt.trigger(this._element,pa).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(of),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated())))}dispose(){gt.off(window,na),gt.off(this._dialog,na),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new sc({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Qd({trapElement:this._element})}_showElement($){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const ce=Pt.findOne(".modal-body",this._dialog);ce&&(ce.scrollTop=0),Y(this._element),this._element.classList.add(of),this._queueCallback(()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,gt.trigger(this._element,mp,{relatedTarget:$})},this._dialog,this._isAnimated())}_addEventListeners(){gt.on(this._element,rf,$=>{$.key==="Escape"&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())}),gt.on(window,ma,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),gt.on(this._element,tf,$=>{gt.one(this._element,gp,ce=>{this._element===$.target&&this._element===ce.target&&(this._config.backdrop!=="static"?this._config.backdrop&&this.hide():this._triggerBackdropTransition())})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(nf),this._resetAdjustments(),this._scrollBar.reset(),gt.trigger(this._element,cc)})}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(gt.trigger(this._element,Th).defaultPrevented)return;const $=this._element.scrollHeight>document.documentElement.clientHeight,ce=this._element.style.overflowY;ce==="hidden"||this._element.classList.contains(Sh)||($||(this._element.style.overflowY="hidden"),this._element.classList.add(Sh),this._queueCallback(()=>{this._element.classList.remove(Sh),this._queueCallback(()=>{this._element.style.overflowY=ce},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const $=this._element.scrollHeight>document.documentElement.clientHeight,ce=this._scrollBar.getWidth(),Ue=ce>0;if(Ue&&!$){const It=ye()?"paddingLeft":"paddingRight";this._element.style[It]=`${ce}px`}if(!Ue&&$){const It=ye()?"paddingRight":"paddingLeft";this._element.style[It]=`${ce}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface($,ce){return this.each(function(){const Ue=Hl.getOrCreateInstance(this,$);if(typeof $=="string"){if(Ue[$]===void 0)throw new TypeError(`No method named "${$}"`);Ue[$](ce)}})}}gt.on(document,Eh,'[data-bs-toggle="modal"]',function(Ie){const $=Pt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&Ie.preventDefault(),gt.one($,ef,Ue=>{Ue.defaultPrevented||gt.one($,cc,()=>{O(this)&&this.focus()})});const ce=Pt.findOne(".modal.show");ce&&Hl.getInstance(ce).hide(),Hl.getOrCreateInstance($).toggle(this)}),Ot(Hl),ke(Hl);const ga=".bs.offcanvas",Cu=".data-api",Ru=`load${ga}${Cu}`,uc="show",Uc="showing",Pu="hiding",Ol=".offcanvas.show",Wl=`show${ga}`,Ln=`shown${ga}`,jc=`hide${ga}`,$c=`hidePrevented${ga}`,Mu=`hidden${ga}`,Ih=`resize${ga}`,ku=`click${ga}${Cu}`,gi=`keydown.dismiss${ga}`,af={backdrop:!0,keyboard:!0,scroll:!1},yp={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Ja extends ar{constructor($,ce){super($,ce),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return af}static get DefaultType(){return yp}static get NAME(){return"offcanvas"}toggle($){return this._isShown?this.hide():this.show($)}show($){this._isShown||gt.trigger(this._element,Wl,{relatedTarget:$}).defaultPrevented||(this._isShown=!0,this._backdrop.show(),this._config.scroll||new Ya().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Uc),this._queueCallback(()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(uc),this._element.classList.remove(Uc),gt.trigger(this._element,Ln,{relatedTarget:$})},this._element,!0))}hide(){this._isShown&&(gt.trigger(this._element,jc).defaultPrevented||(this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Pu),this._backdrop.hide(),this._queueCallback(()=>{this._element.classList.remove(uc,Pu),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new Ya().reset(),gt.trigger(this._element,Mu)},this._element,!0)))}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const $=!!this._config.backdrop;return new sc({className:"offcanvas-backdrop",isVisible:$,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:$?()=>{this._config.backdrop!=="static"?this.hide():gt.trigger(this._element,$c)}:null})}_initializeFocusTrap(){return new Qd({trapElement:this._element})}_addEventListeners(){gt.on(this._element,gi,$=>{$.key==="Escape"&&(this._config.keyboard?this.hide():gt.trigger(this._element,$c))})}static jQueryInterface($){return this.each(function(){const ce=Ja.getOrCreateInstance(this,$);if(typeof $=="string"){if(ce[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ce[$](this)}})}}gt.on(document,ku,'[data-bs-toggle="offcanvas"]',function(Ie){const $=Pt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&Ie.preventDefault(),z(this))return;gt.one($,Mu,()=>{O(this)&&this.focus()});const ce=Pt.findOne(Ol);ce&&ce!==$&&Ja.getInstance(ce).hide(),Ja.getOrCreateInstance($).toggle(this)}),gt.on(window,Ru,()=>{for(const Ie of Pt.find(Ol))Ja.getOrCreateInstance(Ie).show()}),gt.on(window,Ih,()=>{for(const Ie of Pt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(Ie).position!=="fixed"&&Ja.getOrCreateInstance(Ie).hide()}),Ot(Ja),ke(Ja);const Ou={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Du=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),vp=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,bp=(Ie,$)=>{const ce=Ie.nodeName.toLowerCase();return $.includes(ce)?!Du.has(ce)||!!vp.test(Ie.nodeValue):$.filter(Ue=>Ue instanceof RegExp).some(Ue=>Ue.test(ce))},xp={allowList:Ou,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},Gc={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},wp={entry:"(string|element|function|null)",selector:"(string|element)"};class dg extends Dt{constructor($){super(),this._config=this._getConfig($)}static get Default(){return xp}static get DefaultType(){return Gc}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map($=>this._resolvePossibleFunction($)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent($){return this._checkContent($),this._config.content={...this._config.content,...$},this}toHtml(){const $=document.createElement("div");$.innerHTML=this._maybeSanitize(this._config.template);for(const[It,et]of Object.entries(this._config.content))this._setContent($,et,It);const ce=$.children[0],Ue=this._resolvePossibleFunction(this._config.extraClass);return Ue&&ce.classList.add(...Ue.split(" ")),ce}_typeCheckConfig($){super._typeCheckConfig($),this._checkContent($.content)}_checkContent($){for(const[ce,Ue]of Object.entries($))super._typeCheckConfig({selector:ce,entry:Ue},wp)}_setContent($,ce,Ue){const It=Pt.findOne(Ue,$);It&&((ce=this._resolvePossibleFunction(ce))?E(ce)?this._putElementInTemplate(o(ce),It):this._config.html?It.innerHTML=this._maybeSanitize(ce):It.textContent=ce:It.remove())}_maybeSanitize($){return this._config.sanitize?function(ce,Ue,It){if(!ce.length)return ce;if(It&&typeof It=="function")return It(ce);const et=new window.DOMParser().parseFromString(ce,"text/html"),Jt=[].concat(...et.body.querySelectorAll("*"));for(const br of Jt){const Ar=br.nodeName.toLowerCase();if(!Object.keys(Ue).includes(Ar)){br.remove();continue}const Kr=[].concat(...br.attributes),Gt=[].concat(Ue["*"]||[],Ue[Ar]||[]);for(const Gr of Kr)bp(Gr,Gt)||br.removeAttribute(Gr.nodeName)}return et.body.innerHTML}($,this._config.allowList,this._config.sanitizeFn):$}_resolvePossibleFunction($){return he($,[this])}_putElementInTemplate($,ce){if(this._config.html)return ce.innerHTML="",void ce.append($);ce.textContent=$.textContent}}const fg=new Set(["sanitize","allowList","sanitizeFn"]),lf="fade",qc="show",Ah=".modal",Ch="hide.bs.modal",hc="hover",Rh="focus",Tp={AUTO:"auto",TOP:"top",RIGHT:ye()?"left":"right",BOTTOM:"bottom",LEFT:ye()?"right":"left"},pg={allowList:Ou,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Lu={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Qa extends ar{constructor($,ce){if(ta===void 0)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super($,ce),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return pg}static get DefaultType(){return Lu}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),gt.off(this._element.closest(Ah),Ch,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const $=gt.trigger(this._element,this.constructor.eventName("show")),ce=(U(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if($.defaultPrevented||!ce)return;this._disposePopper();const Ue=this._getTipElement();this._element.setAttribute("aria-describedby",Ue.getAttribute("id"));const{container:It}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(It.append(Ue),gt.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(Ue),Ue.classList.add(qc),"ontouchstart"in document.documentElement)for(const et of[].concat(...document.body.children))gt.on(et,"mouseover",H);this._queueCallback(()=>{gt.trigger(this._element,this.constructor.eventName("shown")),this._isHovered===!1&&this._leave(),this._isHovered=!1},this.tip,this._isAnimated())}hide(){if(this._isShown()&&!gt.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented){if(this._getTipElement().classList.remove(qc),"ontouchstart"in document.documentElement)for(const $ of[].concat(...document.body.children))gt.off($,"mouseover",H);this._activeTrigger.click=!1,this._activeTrigger[Rh]=!1,this._activeTrigger[hc]=!1,this._isHovered=null,this._queueCallback(()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),gt.trigger(this._element,this.constructor.eventName("hidden")))},this.tip,this._isAnimated())}}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement($){const ce=this._getTemplateFactory($).toHtml();if(!ce)return null;ce.classList.remove(lf,qc),ce.classList.add(`bs-${this.constructor.NAME}-auto`);const Ue=(It=>{do It+=Math.floor(1e6*Math.random());while(document.getElementById(It));return It})(this.constructor.NAME).toString();return ce.setAttribute("id",Ue),this._isAnimated()&&ce.classList.add(lf),ce}setContent($){this._newContent=$,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory($){return this._templateFactory?this._templateFactory.changeContent($):this._templateFactory=new dg({...this._config,content:$,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget($){return this.constructor.getOrCreateInstance($.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(lf)}_isShown(){return this.tip&&this.tip.classList.contains(qc)}_createPopper($){const ce=he(this._config.placement,[this,$,this._element]),Ue=Tp[ce.toUpperCase()];return Fs(this._element,$,this._getPopperConfig(Ue))}_getOffset(){const{offset:$}=this._config;return typeof $=="string"?$.split(",").map(ce=>Number.parseInt(ce,10)):typeof $=="function"?ce=>$(ce,this._element):$}_resolvePossibleFunction($){return he($,[this._element])}_getPopperConfig($){const ce={placement:$,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:Ue=>{this._getTipElement().setAttribute("data-popper-placement",Ue.state.placement)}}]};return{...ce,...he(this._config.popperConfig,[ce])}}_setListeners(){const $=this._config.trigger.split(" ");for(const ce of $)if(ce==="click")gt.on(this._element,this.constructor.eventName("click"),this._config.selector,Ue=>{this._initializeOnDelegatedTarget(Ue).toggle()});else if(ce!=="manual"){const Ue=ce===hc?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),It=ce===hc?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");gt.on(this._element,Ue,this._config.selector,et=>{const Jt=this._initializeOnDelegatedTarget(et);Jt._activeTrigger[et.type==="focusin"?Rh:hc]=!0,Jt._enter()}),gt.on(this._element,It,this._config.selector,et=>{const Jt=this._initializeOnDelegatedTarget(et);Jt._activeTrigger[et.type==="focusout"?Rh:hc]=Jt._element.contains(et.relatedTarget),Jt._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},gt.on(this._element.closest(Ah),Ch,this._hideModalHandler)}_fixTitle(){const $=this._element.getAttribute("title");$&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",$),this._element.setAttribute("data-bs-original-title",$),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout($,ce){clearTimeout(this._timeout),this._timeout=setTimeout($,ce)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig($){const ce=pr.getDataAttributes(this._element);for(const Ue of Object.keys(ce))fg.has(Ue)&&delete ce[Ue];return $={...ce,...typeof $=="object"&&$?$:{}},$=this._mergeConfigObj($),$=this._configAfterMerge($),this._typeCheckConfig($),$}_configAfterMerge($){return $.container=$.container===!1?document.body:o($.container),typeof $.delay=="number"&&($.delay={show:$.delay,hide:$.delay}),typeof $.title=="number"&&($.title=$.title.toString()),typeof $.content=="number"&&($.content=$.content.toString()),$}_getDelegateConfig(){const $={};for(const[ce,Ue]of Object.entries(this._config))this.constructor.Default[ce]!==Ue&&($[ce]=Ue);return $.selector=!1,$.trigger="manual",$}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface($){return this.each(function(){const ce=Qa.getOrCreateInstance(this,$);if(typeof $=="string"){if(ce[$]===void 0)throw new TypeError(`No method named "${$}"`);ce[$]()}})}}ke(Qa);const Ep={...Qa.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},_a={...Qa.DefaultType,content:"(null|string|element|function)"};class Hc extends Qa{static get Default(){return Ep}static get DefaultType(){return _a}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface($){return this.each(function(){const ce=Hc.getOrCreateInstance(this,$);if(typeof $=="string"){if(ce[$]===void 0)throw new TypeError(`No method named "${$}"`);ce[$]()}})}}ke(Hc);const Wc=".bs.scrollspy",Ph=`activate${Wc}`,Mh=`click${Wc}`,cf=`load${Wc}.data-api`,Dl="active",Bu="[href]",Zc=".nav-link",kh=`${Zc}, .nav-item > ${Zc}, .list-group-item`,uf={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},Sp={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class cl extends ar{constructor($,ce){super($,ce),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return uf}static get DefaultType(){return Sp}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const $ of this._observableSections.values())this._observer.observe($)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge($){return $.target=o($.target)||document.body,$.rootMargin=$.offset?`${$.offset}px 0px -30%`:$.rootMargin,typeof $.threshold=="string"&&($.threshold=$.threshold.split(",").map(ce=>Number.parseFloat(ce))),$}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(gt.off(this._config.target,Mh),gt.on(this._config.target,Mh,Bu,$=>{const ce=this._observableSections.get($.target.hash);if(ce){$.preventDefault();const Ue=this._rootElement||window,It=ce.offsetTop-this._element.offsetTop;if(Ue.scrollTo)return void Ue.scrollTo({top:It,behavior:"smooth"});Ue.scrollTop=It}}))}_getNewObserver(){const $={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(ce=>this._observerCallback(ce),$)}_observerCallback($){const ce=Jt=>this._targetLinks.get(`#${Jt.target.id}`),Ue=Jt=>{this._previousScrollData.visibleEntryTop=Jt.target.offsetTop,this._process(ce(Jt))},It=(this._rootElement||document.documentElement).scrollTop,et=It>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=It;for(const Jt of $){if(!Jt.isIntersecting){this._activeTarget=null,this._clearActiveClass(ce(Jt));continue}const br=Jt.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(et&&br){if(Ue(Jt),!It)return}else et||br||Ue(Jt)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const $=Pt.find(Bu,this._config.target);for(const ce of $){if(!ce.hash||z(ce))continue;const Ue=Pt.findOne(decodeURI(ce.hash),this._element);O(Ue)&&(this._targetLinks.set(decodeURI(ce.hash),ce),this._observableSections.set(ce.hash,Ue))}}_process($){this._activeTarget!==$&&(this._clearActiveClass(this._config.target),this._activeTarget=$,$.classList.add(Dl),this._activateParents($),gt.trigger(this._element,Ph,{relatedTarget:$}))}_activateParents($){if($.classList.contains("dropdown-item"))Pt.findOne(".dropdown-toggle",$.closest(".dropdown")).classList.add(Dl);else for(const ce of Pt.parents($,".nav, .list-group"))for(const Ue of Pt.prev(ce,kh))Ue.classList.add(Dl)}_clearActiveClass($){$.classList.remove(Dl);const ce=Pt.find(`${Bu}.${Dl}`,$);for(const Ue of ce)Ue.classList.remove(Dl)}static jQueryInterface($){return this.each(function(){const ce=cl.getOrCreateInstance(this,$);if(typeof $=="string"){if(ce[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ce[$]()}})}}gt.on(window,cf,()=>{for(const Ie of Pt.find('[data-bs-spy="scroll"]'))cl.getOrCreateInstance(Ie)}),ke(cl);const dc=".bs.tab",Ip=`hide${dc}`,Ap=`hidden${dc}`,Kc=`show${dc}`,Cp=`shown${dc}`,Rp=`click${dc}`,hf=`keydown${dc}`,zu=`load${dc}`,Oh="ArrowLeft",fc="ArrowRight",Pp="ArrowUp",Dh="ArrowDown",Nu="Home",Lh="End",ya="active",df="fade",ul="show",Bh=".dropdown-toggle",Xc=`:not(${Bh})`,zh='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Nh=`.nav-link${Xc}, .list-group-item${Xc}, [role="tab"]${Xc}, ${zh}`,ff=`.${ya}[data-bs-toggle="tab"], .${ya}[data-bs-toggle="pill"], .${ya}[data-bs-toggle="list"]`;class hl extends ar{constructor($){super($),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),gt.on(this._element,hf,ce=>this._keydown(ce)))}static get NAME(){return"tab"}show(){const $=this._element;if(this._elemIsActive($))return;const ce=this._getActiveElem(),Ue=ce?gt.trigger(ce,Ip,{relatedTarget:$}):null;gt.trigger($,Kc,{relatedTarget:ce}).defaultPrevented||Ue&&Ue.defaultPrevented||(this._deactivate(ce,$),this._activate($,ce))}_activate($,ce){$&&($.classList.add(ya),this._activate(Pt.getElementFromSelector($)),this._queueCallback(()=>{$.getAttribute("role")==="tab"?($.removeAttribute("tabindex"),$.setAttribute("aria-selected",!0),this._toggleDropDown($,!0),gt.trigger($,Cp,{relatedTarget:ce})):$.classList.add(ul)},$,$.classList.contains(df)))}_deactivate($,ce){$&&($.classList.remove(ya),$.blur(),this._deactivate(Pt.getElementFromSelector($)),this._queueCallback(()=>{$.getAttribute("role")==="tab"?($.setAttribute("aria-selected",!1),$.setAttribute("tabindex","-1"),this._toggleDropDown($,!1),gt.trigger($,Ap,{relatedTarget:ce})):$.classList.remove(ul)},$,$.classList.contains(df)))}_keydown($){if(![Oh,fc,Pp,Dh,Nu,Lh].includes($.key))return;$.stopPropagation(),$.preventDefault();const ce=this._getChildren().filter(It=>!z(It));let Ue;if([Nu,Lh].includes($.key))Ue=ce[$.key===Nu?0:ce.length-1];else{const It=[fc,Dh].includes($.key);Ue=ve(ce,$.target,It,!0)}Ue&&(Ue.focus({preventScroll:!0}),hl.getOrCreateInstance(Ue).show())}_getChildren(){return Pt.find(Nh,this._parent)}_getActiveElem(){return this._getChildren().find($=>this._elemIsActive($))||null}_setInitialAttributes($,ce){this._setAttributeIfNotExists($,"role","tablist");for(const Ue of ce)this._setInitialAttributesOnChild(Ue)}_setInitialAttributesOnChild($){$=this._getInnerElement($);const ce=this._elemIsActive($),Ue=this._getOuterElement($);$.setAttribute("aria-selected",ce),Ue!==$&&this._setAttributeIfNotExists(Ue,"role","presentation"),ce||$.setAttribute("tabindex","-1"),this._setAttributeIfNotExists($,"role","tab"),this._setInitialAttributesOnTargetPanel($)}_setInitialAttributesOnTargetPanel($){const ce=Pt.getElementFromSelector($);ce&&(this._setAttributeIfNotExists(ce,"role","tabpanel"),$.id&&this._setAttributeIfNotExists(ce,"aria-labelledby",`${$.id}`))}_toggleDropDown($,ce){const Ue=this._getOuterElement($);if(!Ue.classList.contains("dropdown"))return;const It=(et,Jt)=>{const br=Pt.findOne(et,Ue);br&&br.classList.toggle(Jt,ce)};It(Bh,ya),It(".dropdown-menu",ul),Ue.setAttribute("aria-expanded",ce)}_setAttributeIfNotExists($,ce,Ue){$.hasAttribute(ce)||$.setAttribute(ce,Ue)}_elemIsActive($){return $.classList.contains(ya)}_getInnerElement($){return $.matches(Nh)?$:Pt.findOne(Nh,$)}_getOuterElement($){return $.closest(".nav-item, .list-group-item")||$}static jQueryInterface($){return this.each(function(){const ce=hl.getOrCreateInstance(this);if(typeof $=="string"){if(ce[$]===void 0||$.startsWith("_")||$==="constructor")throw new TypeError(`No method named "${$}"`);ce[$]()}})}}gt.on(document,Rp,zh,function(Ie){["A","AREA"].includes(this.tagName)&&Ie.preventDefault(),z(this)||hl.getOrCreateInstance(this).show()}),gt.on(window,zu,()=>{for(const Ie of Pt.find(ff))hl.getOrCreateInstance(Ie)}),ke(hl);const Ll=".bs.toast",Mp=`mouseover${Ll}`,Fu=`mouseout${Ll}`,mg=`focusin${Ll}`,kp=`focusout${Ll}`,Op=`hide${Ll}`,gg=`hidden${Ll}`,Fh=`show${Ll}`,Vh=`shown${Ll}`,Yc="hide",Jc="show",va="showing",Dp={animation:"boolean",autohide:"boolean",delay:"number"},Uh={animation:!0,autohide:!0,delay:5e3};class Zl extends ar{constructor($,ce){super($,ce),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Uh}static get DefaultType(){return Dp}static get NAME(){return"toast"}show(){gt.trigger(this._element,Fh).defaultPrevented||(this._clearTimeout(),this._config.animation&&this._element.classList.add("fade"),this._element.classList.remove(Yc),Y(this._element),this._element.classList.add(Jc,va),this._queueCallback(()=>{this._element.classList.remove(va),gt.trigger(this._element,Vh),this._maybeScheduleHide()},this._element,this._config.animation))}hide(){this.isShown()&&(gt.trigger(this._element,Op).defaultPrevented||(this._element.classList.add(va),this._queueCallback(()=>{this._element.classList.add(Yc),this._element.classList.remove(va,Jc),gt.trigger(this._element,gg)},this._element,this._config.animation)))}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Jc),super.dispose()}isShown(){return this._element.classList.contains(Jc)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction($,ce){switch($.type){case"mouseover":case"mouseout":this._hasMouseInteraction=ce;break;case"focusin":case"focusout":this._hasKeyboardInteraction=ce}if(ce)return void this._clearTimeout();const Ue=$.relatedTarget;this._element===Ue||this._element.contains(Ue)||this._maybeScheduleHide()}_setListeners(){gt.on(this._element,Mp,$=>this._onInteraction($,!0)),gt.on(this._element,Fu,$=>this._onInteraction($,!1)),gt.on(this._element,mg,$=>this._onInteraction($,!0)),gt.on(this._element,kp,$=>this._onInteraction($,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface($){return this.each(function(){const ce=Zl.getOrCreateInstance(this,$);if(typeof $=="string"){if(ce[$]===void 0)throw new TypeError(`No method named "${$}"`);ce[$](this)}})}}return Ot(Zl),ke(Zl),{Alert:Fe,Button:We,Carousel:$o,Collapse:ur,Dropdown:zi,Modal:Hl,Offcanvas:Ja,Popover:Hc,ScrollSpy:cl,Tab:hl,Toast:Zl,Tooltip:Qa}})})(E5);/**
* @vue/shared v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function hb(t,e){const r=new Set(t.split(","));return s=>r.has(s)}const co={},_m=[],wl=()=>{},S5=()=>!1,py=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),xT=t=>t.startsWith("onUpdate:"),ps=Object.assign,wT=(t,e)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)},I5=Object.prototype.hasOwnProperty,Qi=(t,e)=>I5.call(t,e),an=Array.isArray,ym=t=>Wm(t)==="[object Map]",lp=t=>Wm(t)==="[object Set]",EC=t=>Wm(t)==="[object Date]",A5=t=>Wm(t)==="[object RegExp]",zn=t=>typeof t=="function",rs=t=>typeof t=="string",yu=t=>typeof t=="symbol",So=t=>t!==null&&typeof t=="object",TT=t=>(So(t)||zn(t))&&zn(t.then)&&zn(t.catch),LM=Object.prototype.toString,Wm=t=>LM.call(t),C5=t=>Wm(t).slice(8,-1),BM=t=>Wm(t)==="[object Object]",ET=t=>rs(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,vm=hb(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),db=t=>{const e=Object.create(null);return r=>e[r]||(e[r]=t(r))},R5=/-(\w)/g,Ha=db(t=>t.replace(R5,(e,r)=>r?r.toUpperCase():"")),P5=/\B([A-Z])/g,bl=db(t=>t.replace(P5,"-$1").toLowerCase()),my=db(t=>t.charAt(0).toUpperCase()+t.slice(1)),P_=db(t=>t?`on${my(t)}`:""),al=(t,e)=>!Object.is(t,e),bm=(t,...e)=>{for(let r=0;r<t.length;r++)t[r](...e)},zM=(t,e,r,s=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:s,value:r})},S0=t=>{const e=parseFloat(t);return isNaN(e)?t:e},I0=t=>{const e=rs(t)?Number(t):NaN;return isNaN(e)?t:e};let SC;const NM=()=>SC||(SC=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),M5="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error",k5=hb(M5);function gy(t){if(an(t)){const e={};for(let r=0;r<t.length;r++){const s=t[r],h=rs(s)?B5(s):gy(s);if(h)for(const p in h)e[p]=h[p]}return e}else if(rs(t)||So(t))return t}const O5=/;(?![^(]*\))/g,D5=/:([^]+)/,L5=/\/\*[^]*?\*\//g;function B5(t){const e={};return t.replace(L5,"").split(O5).forEach(r=>{if(r){const s=r.split(D5);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function _y(t){let e="";if(rs(t))e=t;else if(an(t))for(let r=0;r<t.length;r++){const s=_y(t[r]);s&&(e+=s+" ")}else if(So(t))for(const r in t)t[r]&&(e+=r+" ");return e.trim()}function z5(t){if(!t)return null;let{class:e,style:r}=t;return e&&!rs(e)&&(t.class=_y(e)),r&&(t.style=gy(r)),t}const N5="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",F5=hb(N5);function FM(t){return!!t||t===""}function V5(t,e){if(t.length!==e.length)return!1;let r=!0;for(let s=0;r&&s<t.length;s++)r=Od(t[s],e[s]);return r}function Od(t,e){if(t===e)return!0;let r=EC(t),s=EC(e);if(r||s)return r&&s?t.getTime()===e.getTime():!1;if(r=yu(t),s=yu(e),r||s)return t===e;if(r=an(t),s=an(e),r||s)return r&&s?V5(t,e):!1;if(r=So(t),s=So(e),r||s){if(!r||!s)return!1;const h=Object.keys(t).length,p=Object.keys(e).length;if(h!==p)return!1;for(const b in t){const E=t.hasOwnProperty(b),o=e.hasOwnProperty(b);if(E&&!o||!E&&o||!Od(t[b],e[b]))return!1}}return String(t)===String(e)}function fb(t,e){return t.findIndex(r=>Od(r,e))}const VM=t=>!!(t&&t.__v_isRef===!0),Ii=t=>rs(t)?t:t==null?"":an(t)||So(t)&&(t.toString===LM||!zn(t.toString))?VM(t)?Ii(t.value):JSON.stringify(t,UM,2):String(t),UM=(t,e)=>VM(e)?UM(t,e.value):ym(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((r,[s,h],p)=>(r[b1(s,p)+" =>"]=h,r),{})}:lp(e)?{[`Set(${e.size})`]:[...e.values()].map(r=>b1(r))}:yu(e)?b1(e):So(e)&&!an(e)&&!BM(e)?String(e):e,b1=(t,e="")=>{var r;return yu(t)?`Symbol(${(r=t.description)!=null?r:e})`:t};/**
* @vue/reactivity v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Fl;class ST{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Fl,!e&&Fl&&(this.index=(Fl.scopes||(Fl.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const r=Fl;try{return Fl=this,e()}finally{Fl=r}}}on(){Fl=this}off(){Fl=this.parent}stop(e){if(this._active){let r,s;for(r=0,s=this.effects.length;r<s;r++)this.effects[r].stop();for(r=0,s=this.cleanups.length;r<s;r++)this.cleanups[r]();if(this.scopes)for(r=0,s=this.scopes.length;r<s;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!e){const h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0,this._active=!1}}}function U5(t){return new ST(t)}function jM(t,e=Fl){e&&e.active&&e.effects.push(t)}function $M(){return Fl}function j5(t){Fl&&Fl.cleanups.push(t)}let Vf;class Mm{constructor(e,r,s,h){this.fn=e,this.trigger=r,this.scheduler=s,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,jM(this,h)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,qd();for(let e=0;e<this._depsLength;e++){const r=this.deps[e];if(r.computed&&($5(r.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Hd()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Ad,r=Vf;try{return Ad=!0,Vf=this,this._runnings++,IC(this),this.fn()}finally{AC(this),this._runnings--,Vf=r,Ad=e}}stop(){this.active&&(IC(this),AC(this),this.onStop&&this.onStop(),this.active=!1)}}function $5(t){return t.value}function IC(t){t._trackId++,t._depsLength=0}function AC(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)GM(t.deps[e],t);t.deps.length=t._depsLength}}function GM(t,e){const r=t.get(e);r!==void 0&&e._trackId!==r&&(t.delete(e),t.size===0&&t.cleanup())}function G5(t,e){t.effect instanceof Mm&&(t=t.effect.fn);const r=new Mm(t,wl,()=>{r.dirty&&r.run()});e&&(ps(r,e),e.scope&&jM(r,e.scope)),(!e||!e.lazy)&&r.run();const s=r.run.bind(r);return s.effect=r,s}function q5(t){t.effect.stop()}let Ad=!0,fw=0;const qM=[];function qd(){qM.push(Ad),Ad=!1}function Hd(){const t=qM.pop();Ad=t===void 0?!0:t}function IT(){fw++}function AT(){for(fw--;!fw&&pw.length;)pw.shift()()}function HM(t,e,r){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const s=t.deps[t._depsLength];s!==e?(s&&GM(s,t),t.deps[t._depsLength++]=e):t._depsLength++}}const pw=[];function WM(t,e,r){IT();for(const s of t.keys()){let h;s._dirtyLevel<e&&(h??(h=t.get(s)===s._trackId))&&(s._shouldSchedule||(s._shouldSchedule=s._dirtyLevel===0),s._dirtyLevel=e),s._shouldSchedule&&(h??(h=t.get(s)===s._trackId))&&(s.trigger(),(!s._runnings||s.allowRecurse)&&s._dirtyLevel!==2&&(s._shouldSchedule=!1,s.scheduler&&pw.push(s.scheduler)))}AT()}const ZM=(t,e)=>{const r=new Map;return r.cleanup=t,r.computed=e,r},A0=new WeakMap,Uf=Symbol(""),mw=Symbol("");function Il(t,e,r){if(Ad&&Vf){let s=A0.get(t);s||A0.set(t,s=new Map);let h=s.get(r);h||s.set(r,h=ZM(()=>s.delete(r))),HM(Vf,h)}}function lh(t,e,r,s,h,p){const b=A0.get(t);if(!b)return;let E=[];if(e==="clear")E=[...b.values()];else if(r==="length"&&an(t)){const o=Number(s);b.forEach((O,z)=>{(z==="length"||!yu(z)&&z>=o)&&E.push(O)})}else switch(r!==void 0&&E.push(b.get(r)),e){case"add":an(t)?ET(r)&&E.push(b.get("length")):(E.push(b.get(Uf)),ym(t)&&E.push(b.get(mw)));break;case"delete":an(t)||(E.push(b.get(Uf)),ym(t)&&E.push(b.get(mw)));break;case"set":ym(t)&&E.push(b.get(Uf));break}IT();for(const o of E)o&&WM(o,4);AT()}function H5(t,e){const r=A0.get(t);return r&&r.get(e)}const W5=hb("__proto__,__v_isRef,__isVue"),KM=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(yu)),CC=Z5();function Z5(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...r){const s=Ki(this);for(let p=0,b=this.length;p<b;p++)Il(s,"get",p+"");const h=s[e](...r);return h===-1||h===!1?s[e](...r.map(Ki)):h}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...r){qd(),IT();const s=Ki(this)[e].apply(this,r);return AT(),Hd(),s}}),t}function K5(t){yu(t)||(t=String(t));const e=Ki(this);return Il(e,"has",t),e.hasOwnProperty(t)}class XM{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,s){const h=this._isReadonly,p=this._isShallow;if(r==="__v_isReactive")return!h;if(r==="__v_isReadonly")return h;if(r==="__v_isShallow")return p;if(r==="__v_raw")return s===(h?p?rk:tk:p?ek:QM).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const b=an(e);if(!h){if(b&&Qi(CC,r))return Reflect.get(CC,r,s);if(r==="hasOwnProperty")return K5}const E=Reflect.get(e,r,s);return(yu(r)?KM.has(r):W5(r))||(h||Il(e,"get",r),p)?E:Ca(E)?b&&ET(r)?E:E.value:So(E)?h?gb(E):Dd(E):E}}class YM extends XM{constructor(e=!1){super(!1,e)}set(e,r,s,h){let p=e[r];if(!this._isShallow){const o=Ld(p);if(!Xf(s)&&!Ld(s)&&(p=Ki(p),s=Ki(s)),!an(e)&&Ca(p)&&!Ca(s))return o?!1:(p.value=s,!0)}const b=an(e)&&ET(r)?Number(r)<e.length:Qi(e,r),E=Reflect.set(e,r,s,h);return e===Ki(h)&&(b?al(s,p)&&lh(e,"set",r,s):lh(e,"add",r,s)),E}deleteProperty(e,r){const s=Qi(e,r);e[r];const h=Reflect.deleteProperty(e,r);return h&&s&&lh(e,"delete",r,void 0),h}has(e,r){const s=Reflect.has(e,r);return(!yu(r)||!KM.has(r))&&Il(e,"has",r),s}ownKeys(e){return Il(e,"iterate",an(e)?"length":Uf),Reflect.ownKeys(e)}}class JM extends XM{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const X5=new YM,Y5=new JM,J5=new YM(!0),Q5=new JM(!0),CT=t=>t,pb=t=>Reflect.getPrototypeOf(t);function Vv(t,e,r=!1,s=!1){t=t.__v_raw;const h=Ki(t),p=Ki(e);r||(al(e,p)&&Il(h,"get",e),Il(h,"get",p));const{has:b}=pb(h),E=s?CT:r?MT:G_;if(b.call(h,e))return E(t.get(e));if(b.call(h,p))return E(t.get(p));t!==h&&t.get(e)}function Uv(t,e=!1){const r=this.__v_raw,s=Ki(r),h=Ki(t);return e||(al(t,h)&&Il(s,"has",t),Il(s,"has",h)),t===h?r.has(t):r.has(t)||r.has(h)}function jv(t,e=!1){return t=t.__v_raw,!e&&Il(Ki(t),"iterate",Uf),Reflect.get(t,"size",t)}function RC(t,e=!1){!e&&!Xf(t)&&!Ld(t)&&(t=Ki(t));const r=Ki(this);return pb(r).has.call(r,t)||(r.add(t),lh(r,"add",t,t)),this}function PC(t,e,r=!1){!r&&!Xf(e)&&!Ld(e)&&(e=Ki(e));const s=Ki(this),{has:h,get:p}=pb(s);let b=h.call(s,t);b||(t=Ki(t),b=h.call(s,t));const E=p.call(s,t);return s.set(t,e),b?al(e,E)&&lh(s,"set",t,e):lh(s,"add",t,e),this}function MC(t){const e=Ki(this),{has:r,get:s}=pb(e);let h=r.call(e,t);h||(t=Ki(t),h=r.call(e,t)),s&&s.call(e,t);const p=e.delete(t);return h&&lh(e,"delete",t,void 0),p}function kC(){const t=Ki(this),e=t.size!==0,r=t.clear();return e&&lh(t,"clear",void 0,void 0),r}function $v(t,e){return function(s,h){const p=this,b=p.__v_raw,E=Ki(b),o=e?CT:t?MT:G_;return!t&&Il(E,"iterate",Uf),b.forEach((O,z)=>s.call(h,o(O),o(z),p))}}function Gv(t,e,r){return function(...s){const h=this.__v_raw,p=Ki(h),b=ym(p),E=t==="entries"||t===Symbol.iterator&&b,o=t==="keys"&&b,O=h[t](...s),z=r?CT:e?MT:G_;return!e&&Il(p,"iterate",o?mw:Uf),{next(){const{value:U,done:H}=O.next();return H?{value:U,done:H}:{value:E?[z(U[0]),z(U[1])]:z(U),done:H}},[Symbol.iterator](){return this}}}}function ld(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function eF(){const t={get(p){return Vv(this,p)},get size(){return jv(this)},has:Uv,add:RC,set:PC,delete:MC,clear:kC,forEach:$v(!1,!1)},e={get(p){return Vv(this,p,!1,!0)},get size(){return jv(this)},has:Uv,add(p){return RC.call(this,p,!0)},set(p,b){return PC.call(this,p,b,!0)},delete:MC,clear:kC,forEach:$v(!1,!0)},r={get(p){return Vv(this,p,!0)},get size(){return jv(this,!0)},has(p){return Uv.call(this,p,!0)},add:ld("add"),set:ld("set"),delete:ld("delete"),clear:ld("clear"),forEach:$v(!0,!1)},s={get(p){return Vv(this,p,!0,!0)},get size(){return jv(this,!0)},has(p){return Uv.call(this,p,!0)},add:ld("add"),set:ld("set"),delete:ld("delete"),clear:ld("clear"),forEach:$v(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(p=>{t[p]=Gv(p,!1,!1),r[p]=Gv(p,!0,!1),e[p]=Gv(p,!1,!0),s[p]=Gv(p,!0,!0)}),[t,r,e,s]}const[tF,rF,nF,iF]=eF();function mb(t,e){const r=e?t?iF:nF:t?rF:tF;return(s,h,p)=>h==="__v_isReactive"?!t:h==="__v_isReadonly"?t:h==="__v_raw"?s:Reflect.get(Qi(r,h)&&h in s?r:s,h,p)}const oF={get:mb(!1,!1)},sF={get:mb(!1,!0)},aF={get:mb(!0,!1)},lF={get:mb(!0,!0)},QM=new WeakMap,ek=new WeakMap,tk=new WeakMap,rk=new WeakMap;function cF(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function uF(t){return t.__v_skip||!Object.isExtensible(t)?0:cF(C5(t))}function Dd(t){return Ld(t)?t:_b(t,!1,X5,oF,QM)}function RT(t){return _b(t,!1,J5,sF,ek)}function gb(t){return _b(t,!0,Y5,aF,tk)}function hF(t){return _b(t,!0,Q5,lF,rk)}function _b(t,e,r,s,h){if(!So(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const p=h.get(t);if(p)return p;const b=uF(t);if(b===0)return t;const E=new Proxy(t,b===2?s:r);return h.set(t,E),E}function jf(t){return Ld(t)?jf(t.__v_raw):!!(t&&t.__v_isReactive)}function Ld(t){return!!(t&&t.__v_isReadonly)}function Xf(t){return!!(t&&t.__v_isShallow)}function PT(t){return t?!!t.__v_raw:!1}function Ki(t){const e=t&&t.__v_raw;return e?Ki(e):t}function nk(t){return Object.isExtensible(t)&&zM(t,"__v_skip",!0),t}const G_=t=>So(t)?Dd(t):t,MT=t=>So(t)?gb(t):t;class ik{constructor(e,r,s,h){this.getter=e,this._setter=r,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new Mm(()=>e(this._value),()=>xm(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!h,this.__v_isReadonly=s}get value(){const e=Ki(this);return(!e._cacheable||e.effect.dirty)&&al(e._value,e._value=e.effect.run())&&xm(e,4),kT(e),e.effect._dirtyLevel>=2&&xm(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function dF(t,e,r=!1){let s,h;const p=zn(t);return p?(s=t,h=wl):(s=t.get,h=t.set),new ik(s,h,p||!h,r)}function kT(t){var e;Ad&&Vf&&(t=Ki(t),HM(Vf,(e=t.dep)!=null?e:t.dep=ZM(()=>t.dep=void 0,t instanceof ik?t:void 0)))}function xm(t,e=4,r,s){t=Ki(t);const h=t.dep;h&&WM(h,e)}function Ca(t){return!!(t&&t.__v_isRef===!0)}function Qr(t){return sk(t,!1)}function ok(t){return sk(t,!0)}function sk(t,e){return Ca(t)?t:new fF(t,e)}class fF{constructor(e,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?e:Ki(e),this._value=r?e:G_(e)}get value(){return kT(this),this._value}set value(e){const r=this.__v_isShallow||Xf(e)||Ld(e);e=r?e:Ki(e),al(e,this._rawValue)&&(this._rawValue,this._rawValue=e,this._value=r?e:G_(e),xm(this,4))}}function pF(t){xm(t,4)}function Ws(t){return Ca(t)?t.value:t}function mF(t){return zn(t)?t():Ws(t)}const gF={get:(t,e,r)=>Ws(Reflect.get(t,e,r)),set:(t,e,r,s)=>{const h=t[e];return Ca(h)&&!Ca(r)?(h.value=r,!0):Reflect.set(t,e,r,s)}};function OT(t){return jf(t)?t:new Proxy(t,gF)}class _F{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:r,set:s}=e(()=>kT(this),()=>xm(this));this._get=r,this._set=s}get value(){return this._get()}set value(e){this._set(e)}}function ak(t){return new _F(t)}function yF(t){const e=an(t)?new Array(t.length):{};for(const r in t)e[r]=lk(t,r);return e}class vF{constructor(e,r,s){this._object=e,this._key=r,this._defaultValue=s,this.__v_isRef=!0}get value(){const e=this._object[this._key];return e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return H5(Ki(this._object),this._key)}}class bF{constructor(e){this._getter=e,this.__v_isRef=!0,this.__v_isReadonly=!0}get value(){return this._getter()}}function xF(t,e,r){return Ca(t)?t:zn(t)?new bF(t):So(t)&&arguments.length>1?lk(t,e,r):Qr(t)}function lk(t,e,r){const s=t[e];return Ca(s)?s:new vF(t,e,r)}const wF={GET:"get",HAS:"has",ITERATE:"iterate"},TF={SET:"set",ADD:"add",DELETE:"delete",CLEAR:"clear"};/**
* @vue/runtime-core v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function EF(t,e){}const SF={SETUP_FUNCTION:0,0:"SETUP_FUNCTION",RENDER_FUNCTION:1,1:"RENDER_FUNCTION",WATCH_GETTER:2,2:"WATCH_GETTER",WATCH_CALLBACK:3,3:"WATCH_CALLBACK",WATCH_CLEANUP:4,4:"WATCH_CLEANUP",NATIVE_EVENT_HANDLER:5,5:"NATIVE_EVENT_HANDLER",COMPONENT_EVENT_HANDLER:6,6:"COMPONENT_EVENT_HANDLER",VNODE_HOOK:7,7:"VNODE_HOOK",DIRECTIVE_HOOK:8,8:"DIRECTIVE_HOOK",TRANSITION_HOOK:9,9:"TRANSITION_HOOK",APP_ERROR_HANDLER:10,10:"APP_ERROR_HANDLER",APP_WARN_HANDLER:11,11:"APP_WARN_HANDLER",FUNCTION_REF:12,12:"FUNCTION_REF",ASYNC_COMPONENT_LOADER:13,13:"ASYNC_COMPONENT_LOADER",SCHEDULER:14,14:"SCHEDULER",COMPONENT_UPDATE:15,15:"COMPONENT_UPDATE"},IF={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update"};function ch(t,e,r,s){try{return s?t(...s):t()}catch(h){cp(h,e,r)}}function jl(t,e,r,s){if(zn(t)){const h=ch(t,e,r,s);return h&&TT(h)&&h.catch(p=>{cp(p,e,r)}),h}if(an(t)){const h=[];for(let p=0;p<t.length;p++)h.push(jl(t[p],e,r,s));return h}}function cp(t,e,r,s=!0){const h=e?e.vnode:null;if(e){let p=e.parent;const b=e.proxy,E=`https://vuejs.org/error-reference/#runtime-${r}`;for(;p;){const O=p.ec;if(O){for(let z=0;z<O.length;z++)if(O[z](t,b,E)===!1)return}p=p.parent}const o=e.appContext.config.errorHandler;if(o){qd(),ch(o,null,10,[t,b,E]),Hd();return}}AF(t,r,h,s)}function AF(t,e,r,s=!0){console.error(t)}let q_=!1,gw=!1;const Ga=[];let hu=0;const wm=[];let md=null,Bf=0;const ck=Promise.resolve();let DT=null;function up(t){const e=DT||ck;return t?e.then(this?t.bind(this):t):e}function CF(t){let e=hu+1,r=Ga.length;for(;e<r;){const s=e+r>>>1,h=Ga[s],p=H_(h);p<t||p===t&&h.pre?e=s+1:r=s}return e}function yb(t){(!Ga.length||!Ga.includes(t,q_&&t.allowRecurse?hu+1:hu))&&(t.id==null?Ga.push(t):Ga.splice(CF(t.id),0,t),uk())}function uk(){!q_&&!gw&&(gw=!0,DT=ck.then(hk))}function RF(t){const e=Ga.indexOf(t);e>hu&&Ga.splice(e,1)}function C0(t){an(t)?wm.push(...t):(!md||!md.includes(t,t.allowRecurse?Bf+1:Bf))&&wm.push(t),uk()}function OC(t,e,r=q_?hu+1:0){for(;r<Ga.length;r++){const s=Ga[r];if(s&&s.pre){if(t&&s.id!==t.uid)continue;Ga.splice(r,1),r--,s()}}}function R0(t){if(wm.length){const e=[...new Set(wm)].sort((r,s)=>H_(r)-H_(s));if(wm.length=0,md){md.push(...e);return}for(md=e,Bf=0;Bf<md.length;Bf++){const r=md[Bf];r.active!==!1&&r()}md=null,Bf=0}}const H_=t=>t.id==null?1/0:t.id,PF=(t,e)=>{const r=H_(t)-H_(e);if(r===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return r};function hk(t){gw=!1,q_=!0,Ga.sort(PF);try{for(hu=0;hu<Ga.length;hu++){const e=Ga[hu];e&&e.active!==!1&&ch(e,e.i,e.i?15:14)}}finally{hu=0,Ga.length=0,R0(),q_=!1,DT=null,(Ga.length||wm.length)&&hk()}}let um,qv=[];function dk(t,e){var r,s;um=t,um?(um.enabled=!0,qv.forEach(({event:h,args:p})=>um.emit(h,...p)),qv=[]):typeof window<"u"&&window.HTMLElement&&!((s=(r=window.navigator)==null?void 0:r.userAgent)!=null&&s.includes("jsdom"))?((e.__VUE_DEVTOOLS_HOOK_REPLAY__=e.__VUE_DEVTOOLS_HOOK_REPLAY__||[]).push(p=>{dk(p,e)}),setTimeout(()=>{um||(e.__VUE_DEVTOOLS_HOOK_REPLAY__=null,qv=[])},3e3)):qv=[]}let Hs=null,vb=null;function W_(t){const e=Hs;return Hs=t,vb=t&&t.type.__scopeId||null,e}function xu(t){vb=t}function wu(){vb=null}const MF=t=>sl;function sl(t,e=Hs,r){if(!e||t._n)return t;const s=(...h)=>{s._d&&Sw(-1);const p=W_(e);let b;try{b=t(...h)}finally{W_(p),s._d&&Sw(1)}return b};return s._n=!0,s._c=!0,s._d=!0,s}function ds(t,e){if(Hs===null)return t;const r=xy(Hs),s=t.dirs||(t.dirs=[]);for(let h=0;h<e.length;h++){let[p,b,E,o=co]=e[h];p&&(zn(p)&&(p={mounted:p,updated:p}),p.deep&&bd(b),s.push({dir:p,instance:r,value:b,oldValue:void 0,arg:E,modifiers:o}))}return t}function cu(t,e,r,s){const h=t.dirs,p=e&&e.dirs;for(let b=0;b<h.length;b++){const E=h[b];p&&(E.oldValue=p[b].value);let o=E.dir[s];o&&(qd(),jl(o,r,8,[t.el,E,t,e]),Hd())}}const gd=Symbol("_leaveCb"),Hv=Symbol("_enterCb");function LT(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ic(()=>{t.isMounted=!0}),Km(()=>{t.isUnmounting=!0}),t}const rc=[Function,Array],BT={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:rc,onEnter:rc,onAfterEnter:rc,onEnterCancelled:rc,onBeforeLeave:rc,onLeave:rc,onAfterLeave:rc,onLeaveCancelled:rc,onBeforeAppear:rc,onAppear:rc,onAfterAppear:rc,onAppearCancelled:rc},fk=t=>{const e=t.subTree;return e.component?fk(e.component):e},kF={name:"BaseTransition",props:BT,setup(t,{slots:e}){const r=Tu(),s=LT();return()=>{const h=e.default&&bb(e.default(),!0);if(!h||!h.length)return;let p=h[0];if(h.length>1){for(const H of h)if(H.type!==Gs){p=H;break}}const b=Ki(t),{mode:E}=b;if(s.isLeaving)return x1(p);const o=DC(p);if(!o)return x1(p);let O=km(o,b,s,r,H=>O=H);Bd(o,O);const z=r.subTree,U=z&&DC(z);if(U&&U.type!==Gs&&!Dc(o,U)&&fk(r).type!==Gs){const H=km(U,b,s,r);if(Bd(U,H),E==="out-in"&&o.type!==Gs)return s.isLeaving=!0,H.afterLeave=()=>{s.isLeaving=!1,r.update.active!==!1&&(r.effect.dirty=!0,r.update())},x1(p);E==="in-out"&&o.type!==Gs&&(H.delayLeave=(Y,Q,ge)=>{const ye=mk(s,U);ye[String(U.key)]=U,Y[gd]=()=>{Q(),Y[gd]=void 0,delete O.delayedLeave},O.delayedLeave=ge})}return p}}},pk=kF;function mk(t,e){const{leavingVNodes:r}=t;let s=r.get(e.type);return s||(s=Object.create(null),r.set(e.type,s)),s}function km(t,e,r,s,h){const{appear:p,mode:b,persisted:E=!1,onBeforeEnter:o,onEnter:O,onAfterEnter:z,onEnterCancelled:U,onBeforeLeave:H,onLeave:Y,onAfterLeave:Q,onLeaveCancelled:ge,onBeforeAppear:ye,onAppear:ke,onAfterAppear:he,onAppearCancelled:oe}=e,ve=String(t.key),be=mk(r,t),ze=(ne,te)=>{ne&&jl(ne,s,9,te)},Te=(ne,te)=>{const re=te[1];ze(ne,te),an(ne)?ne.every(me=>me.length<=1)&&re():ne.length<=1&&re()},ie={mode:b,persisted:E,beforeEnter(ne){let te=o;if(!r.isMounted)if(p)te=ye||o;else return;ne[gd]&&ne[gd](!0);const re=be[ve];re&&Dc(t,re)&&re.el[gd]&&re.el[gd](),ze(te,[ne])},enter(ne){let te=O,re=z,me=U;if(!r.isMounted)if(p)te=ke||O,re=he||z,me=oe||U;else return;let we=!1;const tt=ne[Hv]=Et=>{we||(we=!0,Et?ze(me,[ne]):ze(re,[ne]),ie.delayedLeave&&ie.delayedLeave(),ne[Hv]=void 0)};te?Te(te,[ne,tt]):tt()},leave(ne,te){const re=String(t.key);if(ne[Hv]&&ne[Hv](!0),r.isUnmounting)return te();ze(H,[ne]);let me=!1;const we=ne[gd]=tt=>{me||(me=!0,te(),tt?ze(ge,[ne]):ze(Q,[ne]),ne[gd]=void 0,be[re]===t&&delete be[re])};be[re]=t,Y?Te(Y,[ne,we]):we()},clone(ne){const te=km(ne,e,r,s,h);return h&&h(te),te}};return ie}function x1(t){if(yy(t))return t=vu(t),t.children=null,t}function DC(t){if(!yy(t))return t;const{shapeFlag:e,children:r}=t;if(r){if(e&16)return r[0];if(e&32&&zn(r.default))return r.default()}}function Bd(t,e){t.shapeFlag&6&&t.component?Bd(t.component.subTree,e):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function bb(t,e=!1,r){let s=[],h=0;for(let p=0;p<t.length;p++){let b=t[p];const E=r==null?b.key:String(r)+String(b.key!=null?b.key:p);b.type===ts?(b.patchFlag&128&&h++,s=s.concat(bb(b.children,e,E))):(e||b.type!==Gs)&&s.push(E!=null?vu(b,{key:E}):b)}if(h>1)for(let p=0;p<s.length;p++)s[p].patchFlag=-2;return s}/*! #__NO_SIDE_EFFECTS__ */function Wd(t,e){return zn(t)?ps({name:t.name},e,{setup:t}):t}const $f=t=>!!t.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function OF(t){zn(t)&&(t={loader:t});const{loader:e,loadingComponent:r,errorComponent:s,delay:h=200,timeout:p,suspensible:b=!0,onError:E}=t;let o=null,O,z=0;const U=()=>(z++,o=null,H()),H=()=>{let Y;return o||(Y=o=e().catch(Q=>{if(Q=Q instanceof Error?Q:new Error(String(Q)),E)return new Promise((ge,ye)=>{E(Q,()=>ge(U()),()=>ye(Q),z+1)});throw Q}).then(Q=>Y!==o&&o?o:(Q&&(Q.__esModule||Q[Symbol.toStringTag]==="Module")&&(Q=Q.default),O=Q,Q)))};return Wd({name:"AsyncComponentWrapper",__asyncLoader:H,get __asyncResolved(){return O},setup(){const Y=qs;if(O)return()=>w1(O,Y);const Q=he=>{o=null,cp(he,Y,13,!s)};if(b&&Y.suspense||by)return H().then(he=>()=>w1(he,Y)).catch(he=>(Q(he),()=>s?Un(s,{error:he}):null));const ge=Qr(!1),ye=Qr(),ke=Qr(!!h);return h&&setTimeout(()=>{ke.value=!1},h),p!=null&&setTimeout(()=>{if(!ge.value&&!ye.value){const he=new Error(`Async component timed out after ${p}ms.`);Q(he),ye.value=he}},p),H().then(()=>{ge.value=!0,Y.parent&&yy(Y.parent.vnode)&&(Y.parent.effect.dirty=!0,yb(Y.parent.update))}).catch(he=>{Q(he),ye.value=he}),()=>{if(ge.value&&O)return w1(O,Y);if(ye.value&&s)return Un(s,{error:ye.value});if(r&&!ke.value)return Un(r)}}})}function w1(t,e){const{ref:r,props:s,children:h,ce:p}=e.vnode,b=Un(t,s,h);return b.ref=r,b.ce=p,delete e.vnode.ce,b}const yy=t=>t.type.__isKeepAlive,DF={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(t,{slots:e}){const r=Tu(),s=r.ctx;if(!s.renderer)return()=>{const he=e.default&&e.default();return he&&he.length===1?he[0]:he};const h=new Map,p=new Set;let b=null;const E=r.suspense,{renderer:{p:o,m:O,um:z,o:{createElement:U}}}=s,H=U("div");s.activate=(he,oe,ve,be,ze)=>{const Te=he.component;O(he,oe,ve,0,E),o(Te.vnode,he,oe,ve,Te,E,be,he.slotScopeIds,ze),oa(()=>{Te.isDeactivated=!1,Te.a&&bm(Te.a);const ie=he.props&&he.props.onVnodeMounted;ie&&yl(ie,Te.parent,he)},E)},s.deactivate=he=>{const oe=he.component;k0(oe.m),k0(oe.a),O(he,H,null,1,E),oa(()=>{oe.da&&bm(oe.da);const ve=he.props&&he.props.onVnodeUnmounted;ve&&yl(ve,oe.parent,he),oe.isDeactivated=!0},E)};function Y(he){T1(he),z(he,r,E,!0)}function Q(he){h.forEach((oe,ve)=>{const be=Pw(oe.type);be&&(!he||!he(be))&&ge(ve)})}function ge(he){const oe=h.get(he);oe&&(!b||!Dc(oe,b))?Y(oe):b&&T1(b),h.delete(he),p.delete(he)}ll(()=>[t.include,t.exclude],([he,oe])=>{he&&Q(ve=>x_(he,ve)),oe&&Q(ve=>!x_(oe,ve))},{flush:"post",deep:!0});let ye=null;const ke=()=>{ye!=null&&(Tw(r.subTree.type)?oa(()=>{h.set(ye,Wv(r.subTree))},r.subTree.suspense):h.set(ye,Wv(r.subTree)))};return ic(ke),Zm(ke),Km(()=>{h.forEach(he=>{const{subTree:oe,suspense:ve}=r,be=Wv(oe);if(he.type===be.type&&he.key===be.key){T1(be);const ze=be.component.da;ze&&oa(ze,ve);return}Y(he)})}),()=>{if(ye=null,!e.default)return null;const he=e.default(),oe=he[0];if(he.length>1)return b=null,he;if(!zd(oe)||!(oe.shapeFlag&4)&&!(oe.shapeFlag&128))return b=null,oe;let ve=Wv(oe);if(ve.type===Gs)return b=null,ve;const be=ve.type,ze=Pw($f(ve)?ve.type.__asyncResolved||{}:be),{include:Te,exclude:ie,max:ne}=t;if(Te&&(!ze||!x_(Te,ze))||ie&&ze&&x_(ie,ze))return b=ve,oe;const te=ve.key==null?be:ve.key,re=h.get(te);return ve.el&&(ve=vu(ve),oe.shapeFlag&128&&(oe.ssContent=ve)),ye=te,re?(ve.el=re.el,ve.component=re.component,ve.transition&&Bd(ve,ve.transition),ve.shapeFlag|=512,p.delete(te),p.add(te)):(p.add(te),ne&&p.size>parseInt(ne,10)&&ge(p.values().next().value)),ve.shapeFlag|=256,b=ve,Tw(oe.type)?oe:ve}}},LF=DF;function x_(t,e){return an(t)?t.some(r=>x_(r,e)):rs(t)?t.split(",").includes(e):A5(t)?t.test(e):!1}function gk(t,e){yk(t,"a",e)}function _k(t,e){yk(t,"da",e)}function yk(t,e,r=qs){const s=t.__wdc||(t.__wdc=()=>{let h=r;for(;h;){if(h.isDeactivated)return;h=h.parent}return t()});if(xb(e,s,r),r){let h=r.parent;for(;h&&h.parent;)yy(h.parent.vnode)&&BF(s,e,r,h),h=h.parent}}function BF(t,e,r,s){const h=xb(e,t,s,!0);wb(()=>{wT(s[e],h)},r)}function T1(t){t.shapeFlag&=-257,t.shapeFlag&=-513}function Wv(t){return t.shapeFlag&128?t.ssContent:t}function xb(t,e,r=qs,s=!1){if(r){const h=r[t]||(r[t]=[]),p=e.__weh||(e.__weh=(...b)=>{qd();const E=Jf(r),o=jl(e,r,t,b);return E(),Hd(),o});return s?h.unshift(p):h.push(p),p}}const gh=t=>(e,r=qs)=>{(!by||t==="sp")&&xb(t,(...s)=>e(...s),r)},zT=gh("bm"),ic=gh("m"),NT=gh("bu"),Zm=gh("u"),Km=gh("bum"),wb=gh("um"),vk=gh("sp"),bk=gh("rtg"),xk=gh("rtc");function wk(t,e=qs){xb("ec",t,e)}const FT="components",zF="directives";function Z_(t,e){return VT(FT,t,!0,e)||t}const Tk=Symbol.for("v-ndc");function vd(t){return rs(t)?VT(FT,t,!1)||t:t||Tk}function NF(t){return VT(zF,t)}function VT(t,e,r=!0,s=!1){const h=Hs||qs;if(h){const p=h.type;if(t===FT){const E=Pw(p,!1);if(E&&(E===e||E===Ha(e)||E===my(Ha(e))))return p}const b=LC(h[t]||p[t],e)||LC(h.appContext[t],e);return!b&&s?p:b}}function LC(t,e){return t&&(t[e]||t[Ha(e)]||t[my(Ha(e))])}function Gf(t,e,r,s){let h;const p=r&&r[s];if(an(t)||rs(t)){h=new Array(t.length);for(let b=0,E=t.length;b<E;b++)h[b]=e(t[b],b,void 0,p&&p[b])}else if(typeof t=="number"){h=new Array(t);for(let b=0;b<t;b++)h[b]=e(b+1,b,void 0,p&&p[b])}else if(So(t))if(t[Symbol.iterator])h=Array.from(t,(b,E)=>e(b,E,void 0,p&&p[E]));else{const b=Object.keys(t);h=new Array(b.length);for(let E=0,o=b.length;E<o;E++){const O=b[E];h[E]=e(t[O],O,E,p&&p[E])}}else h=[];return r&&(r[s]=h),h}function FF(t,e){for(let r=0;r<e.length;r++){const s=e[r];if(an(s))for(let h=0;h<s.length;h++)t[s[h].name]=s[h].fn;else s&&(t[s.name]=s.key?(...h)=>{const p=s.fn(...h);return p&&(p.key=s.key),p}:s.fn)}return t}function VF(t,e,r={},s,h){if(Hs.isCE||Hs.parent&&$f(Hs.parent)&&Hs.parent.isCE)return e!=="default"&&(r.name=e),Un("slot",r,s&&s());let p=t[e];p&&p._c&&(p._d=!1),sn();const b=p&&UT(p(r)),E=Oc(ts,{key:(r.key||b&&b.key||`_${e}`)+(!b&&s?"_fb":"")},b||(s?s():[]),b&&t._===1?64:-2);return!h&&E.scopeId&&(E.slotScopeIds=[E.scopeId+"-s"]),p&&p._c&&(p._d=!0),E}function UT(t){return t.some(e=>zd(e)?!(e.type===Gs||e.type===ts&&!UT(e.children)):!0)?t:null}function UF(t,e){const r={};for(const s in t)r[e&&/[A-Z]/.test(s)?`on:${s}`:P_(s)]=t[s];return r}const _w=t=>t?sO(t)?xy(t):_w(t.parent):null,M_=ps(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>_w(t.parent),$root:t=>_w(t.root),$emit:t=>t.emit,$options:t=>jT(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,yb(t.update)}),$nextTick:t=>t.n||(t.n=up.bind(t.proxy)),$watch:t=>SV.bind(t)}),E1=(t,e)=>t!==co&&!t.__isScriptSetup&&Qi(t,e),yw={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:r,setupState:s,data:h,props:p,accessCache:b,type:E,appContext:o}=t;let O;if(e[0]!=="$"){const Y=b[e];if(Y!==void 0)switch(Y){case 1:return s[e];case 2:return h[e];case 4:return r[e];case 3:return p[e]}else{if(E1(s,e))return b[e]=1,s[e];if(h!==co&&Qi(h,e))return b[e]=2,h[e];if((O=t.propsOptions[0])&&Qi(O,e))return b[e]=3,p[e];if(r!==co&&Qi(r,e))return b[e]=4,r[e];vw&&(b[e]=0)}}const z=M_[e];let U,H;if(z)return e==="$attrs"&&Il(t.attrs,"get",""),z(t);if((U=E.__cssModules)&&(U=U[e]))return U;if(r!==co&&Qi(r,e))return b[e]=4,r[e];if(H=o.config.globalProperties,Qi(H,e))return H[e]},set({_:t},e,r){const{data:s,setupState:h,ctx:p}=t;return E1(h,e)?(h[e]=r,!0):s!==co&&Qi(s,e)?(s[e]=r,!0):Qi(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(p[e]=r,!0)},has({_:{data:t,setupState:e,accessCache:r,ctx:s,appContext:h,propsOptions:p}},b){let E;return!!r[b]||t!==co&&Qi(t,b)||E1(e,b)||(E=p[0])&&Qi(E,b)||Qi(s,b)||Qi(M_,b)||Qi(h.config.globalProperties,b)},defineProperty(t,e,r){return r.get!=null?t._.accessCache[e]=0:Qi(r,"value")&&this.set(t,e,r.value,null),Reflect.defineProperty(t,e,r)}},jF=ps({},yw,{get(t,e){if(e!==Symbol.unscopables)return yw.get(t,e,t)},has(t,e){return e[0]!=="_"&&!k5(e)}});function $F(){return null}function GF(){return null}function qF(t){}function HF(t){}function WF(){return null}function ZF(){}function KF(t,e){return null}function XF(){return Ek().slots}function YF(){return Ek().attrs}function Ek(){const t=Tu();return t.setupContext||(t.setupContext=cO(t))}function K_(t){return an(t)?t.reduce((e,r)=>(e[r]=null,e),{}):t}function JF(t,e){const r=K_(t);for(const s in e){if(s.startsWith("__skip"))continue;let h=r[s];h?an(h)||zn(h)?h=r[s]={type:h,default:e[s]}:h.default=e[s]:h===null&&(h=r[s]={default:e[s]}),h&&e[`__skip_${s}`]&&(h.skipFactory=!0)}return r}function QF(t,e){return!t||!e?t||e:an(t)&&an(e)?t.concat(e):ps({},K_(t),K_(e))}function eV(t,e){const r={};for(const s in t)e.includes(s)||Object.defineProperty(r,s,{enumerable:!0,get:()=>t[s]});return r}function tV(t){const e=Tu();let r=t();return Aw(),TT(r)&&(r=r.catch(s=>{throw Jf(e),s})),[r,()=>Jf(e)]}let vw=!0;function rV(t){const e=jT(t),r=t.proxy,s=t.ctx;vw=!1,e.beforeCreate&&BC(e.beforeCreate,t,"bc");const{data:h,computed:p,methods:b,watch:E,provide:o,inject:O,created:z,beforeMount:U,mounted:H,beforeUpdate:Y,updated:Q,activated:ge,deactivated:ye,beforeDestroy:ke,beforeUnmount:he,destroyed:oe,unmounted:ve,render:be,renderTracked:ze,renderTriggered:Te,errorCaptured:ie,serverPrefetch:ne,expose:te,inheritAttrs:re,components:me,directives:we,filters:tt}=e;if(O&&nV(O,s,null),b)for(const rr in b){const or=b[rr];zn(or)&&(s[rr]=or.bind(r))}if(h){const rr=h.call(r,r);So(rr)&&(t.data=Dd(rr))}if(vw=!0,p)for(const rr in p){const or=p[rr],Fr=zn(or)?or.bind(r,r):zn(or.get)?or.get.bind(r,r):wl,gt=!zn(or)&&zn(or.set)?or.set.bind(r):wl,jr=Ds({get:Fr,set:gt});Object.defineProperty(s,rr,{enumerable:!0,configurable:!0,get:()=>jr.value,set:Ur=>jr.value=Ur})}if(E)for(const rr in E)Sk(E[rr],s,r,rr);if(o){const rr=zn(o)?o.call(r):o;Reflect.ownKeys(rr).forEach(or=>{Hf(or,rr[or])})}z&&BC(z,t,"c");function ft(rr,or){an(or)?or.forEach(Fr=>rr(Fr.bind(r))):or&&rr(or.bind(r))}if(ft(zT,U),ft(ic,H),ft(NT,Y),ft(Zm,Q),ft(gk,ge),ft(_k,ye),ft(wk,ie),ft(xk,ze),ft(bk,Te),ft(Km,he),ft(wb,ve),ft(vk,ne),an(te))if(te.length){const rr=t.exposed||(t.exposed={});te.forEach(or=>{Object.defineProperty(rr,or,{get:()=>r[or],set:Fr=>r[or]=Fr})})}else t.exposed||(t.exposed={});be&&t.render===wl&&(t.render=be),re!=null&&(t.inheritAttrs=re),me&&(t.components=me),we&&(t.directives=we)}function nV(t,e,r=wl){an(t)&&(t=bw(t));for(const s in t){const h=t[s];let p;So(h)?"default"in h?p=Lc(h.from||s,h.default,!0):p=Lc(h.from||s):p=Lc(h),Ca(p)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>p.value,set:b=>p.value=b}):e[s]=p}}function BC(t,e,r){jl(an(t)?t.map(s=>s.bind(e.proxy)):t.bind(e.proxy),e,r)}function Sk(t,e,r,s){const h=s.includes(".")?Zk(r,s):()=>r[s];if(rs(t)){const p=e[t];zn(p)&&ll(h,p)}else if(zn(t))ll(h,t.bind(r));else if(So(t))if(an(t))t.forEach(p=>Sk(p,e,r,s));else{const p=zn(t.handler)?t.handler.bind(r):e[t.handler];zn(p)&&ll(h,p,t)}}function jT(t){const e=t.type,{mixins:r,extends:s}=e,{mixins:h,optionsCache:p,config:{optionMergeStrategies:b}}=t.appContext,E=p.get(e);let o;return E?o=E:!h.length&&!r&&!s?o=e:(o={},h.length&&h.forEach(O=>P0(o,O,b,!0)),P0(o,e,b)),So(e)&&p.set(e,o),o}function P0(t,e,r,s=!1){const{mixins:h,extends:p}=e;p&&P0(t,p,r,!0),h&&h.forEach(b=>P0(t,b,r,!0));for(const b in e)if(!(s&&b==="expose")){const E=iV[b]||r&&r[b];t[b]=E?E(t[b],e[b]):e[b]}return t}const iV={data:zC,props:NC,emits:NC,methods:w_,computed:w_,beforeCreate:ol,created:ol,beforeMount:ol,mounted:ol,beforeUpdate:ol,updated:ol,beforeDestroy:ol,beforeUnmount:ol,destroyed:ol,unmounted:ol,activated:ol,deactivated:ol,errorCaptured:ol,serverPrefetch:ol,components:w_,directives:w_,watch:sV,provide:zC,inject:oV};function zC(t,e){return e?t?function(){return ps(zn(t)?t.call(this,this):t,zn(e)?e.call(this,this):e)}:e:t}function oV(t,e){return w_(bw(t),bw(e))}function bw(t){if(an(t)){const e={};for(let r=0;r<t.length;r++)e[t[r]]=t[r];return e}return t}function ol(t,e){return t?[...new Set([].concat(t,e))]:e}function w_(t,e){return t?ps(Object.create(null),t,e):e}function NC(t,e){return t?an(t)&&an(e)?[...new Set([...t,...e])]:ps(Object.create(null),K_(t),K_(e??{})):e}function sV(t,e){if(!t)return e;if(!e)return t;const r=ps(Object.create(null),t);for(const s in e)r[s]=ol(t[s],e[s]);return r}function Ik(){return{app:null,config:{isNativeTag:S5,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let aV=0;function lV(t,e){return function(s,h=null){zn(s)||(s=ps({},s)),h!=null&&!So(h)&&(h=null);const p=Ik(),b=new WeakSet;let E=!1;const o=p.app={_uid:aV++,_component:s,_props:h,_container:null,_context:p,_instance:null,version:hO,get config(){return p.config},set config(O){},use(O,...z){return b.has(O)||(O&&zn(O.install)?(b.add(O),O.install(o,...z)):zn(O)&&(b.add(O),O(o,...z))),o},mixin(O){return p.mixins.includes(O)||p.mixins.push(O),o},component(O,z){return z?(p.components[O]=z,o):p.components[O]},directive(O,z){return z?(p.directives[O]=z,o):p.directives[O]},mount(O,z,U){if(!E){const H=Un(s,h);return H.appContext=p,U===!0?U="svg":U===!1&&(U=void 0),z&&e?e(H,O):t(H,O,U),E=!0,o._container=O,O.__vue_app__=o,xy(H.component)}},unmount(){E&&(t(null,o._container),delete o._container.__vue_app__)},provide(O,z){return p.provides[O]=z,o},runWithContext(O){const z=qf;qf=o;try{return O()}finally{qf=z}}};return o}}let qf=null;function Hf(t,e){if(qs){let r=qs.provides;const s=qs.parent&&qs.parent.provides;s===r&&(r=qs.provides=Object.create(s)),r[t]=e}}function Lc(t,e,r=!1){const s=qs||Hs;if(s||qf){const h=qf?qf._context.provides:s?s.parent==null?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(h&&t in h)return h[t];if(arguments.length>1)return r&&zn(e)?e.call(s&&s.proxy):e}}function cV(){return!!(qs||Hs||qf)}const Ak={},Ck=()=>Object.create(Ak),Rk=t=>Object.getPrototypeOf(t)===Ak;function uV(t,e,r,s=!1){const h={},p=Ck();t.propsDefaults=Object.create(null),Pk(t,e,h,p);for(const b in t.propsOptions[0])b in h||(h[b]=void 0);r?t.props=s?h:RT(h):t.type.props?t.props=h:t.props=p,t.attrs=p}function hV(t,e,r,s){const{props:h,attrs:p,vnode:{patchFlag:b}}=t,E=Ki(h),[o]=t.propsOptions;let O=!1;if((s||b>0)&&!(b&16)){if(b&8){const z=t.vnode.dynamicProps;for(let U=0;U<z.length;U++){let H=z[U];if(Tb(t.emitsOptions,H))continue;const Y=e[H];if(o)if(Qi(p,H))Y!==p[H]&&(p[H]=Y,O=!0);else{const Q=Ha(H);h[Q]=xw(o,E,Q,Y,t,!1)}else Y!==p[H]&&(p[H]=Y,O=!0)}}}else{Pk(t,e,h,p)&&(O=!0);let z;for(const U in E)(!e||!Qi(e,U)&&((z=bl(U))===U||!Qi(e,z)))&&(o?r&&(r[U]!==void 0||r[z]!==void 0)&&(h[U]=xw(o,E,U,void 0,t,!0)):delete h[U]);if(p!==E)for(const U in p)(!e||!Qi(e,U))&&(delete p[U],O=!0)}O&&lh(t.attrs,"set","")}function Pk(t,e,r,s){const[h,p]=t.propsOptions;let b=!1,E;if(e)for(let o in e){if(vm(o))continue;const O=e[o];let z;h&&Qi(h,z=Ha(o))?!p||!p.includes(z)?r[z]=O:(E||(E={}))[z]=O:Tb(t.emitsOptions,o)||(!(o in s)||O!==s[o])&&(s[o]=O,b=!0)}if(p){const o=Ki(r),O=E||co;for(let z=0;z<p.length;z++){const U=p[z];r[U]=xw(h,o,U,O[U],t,!Qi(O,U))}}return b}function xw(t,e,r,s,h,p){const b=t[r];if(b!=null){const E=Qi(b,"default");if(E&&s===void 0){const o=b.default;if(b.type!==Function&&!b.skipFactory&&zn(o)){const{propsDefaults:O}=h;if(r in O)s=O[r];else{const z=Jf(h);s=O[r]=o.call(null,e),z()}}else s=o}b[0]&&(p&&!E?s=!1:b[1]&&(s===""||s===bl(r))&&(s=!0))}return s}const dV=new WeakMap;function Mk(t,e,r=!1){const s=r?dV:e.propsCache,h=s.get(t);if(h)return h;const p=t.props,b={},E=[];let o=!1;if(!zn(t)){const z=U=>{o=!0;const[H,Y]=Mk(U,e,!0);ps(b,H),Y&&E.push(...Y)};!r&&e.mixins.length&&e.mixins.forEach(z),t.extends&&z(t.extends),t.mixins&&t.mixins.forEach(z)}if(!p&&!o)return So(t)&&s.set(t,_m),_m;if(an(p))for(let z=0;z<p.length;z++){const U=Ha(p[z]);FC(U)&&(b[U]=co)}else if(p)for(const z in p){const U=Ha(z);if(FC(U)){const H=p[z],Y=b[U]=an(H)||zn(H)?{type:H}:ps({},H),Q=Y.type;let ge=!1,ye=!0;if(an(Q))for(let ke=0;ke<Q.length;++ke){const he=Q[ke],oe=zn(he)&&he.name;if(oe==="Boolean"){ge=!0;break}else oe==="String"&&(ye=!1)}else ge=zn(Q)&&Q.name==="Boolean";Y[0]=ge,Y[1]=ye,(ge||Qi(Y,"default"))&&E.push(U)}}const O=[b,E];return So(t)&&s.set(t,O),O}function FC(t){return t[0]!=="$"&&!vm(t)}const kk=t=>t[0]==="_"||t==="$stable",$T=t=>an(t)?t.map(vl):[vl(t)],fV=(t,e,r)=>{if(e._n)return e;const s=sl((...h)=>$T(e(...h)),r);return s._c=!1,s},Ok=(t,e,r)=>{const s=t._ctx;for(const h in t){if(kk(h))continue;const p=t[h];if(zn(p))e[h]=fV(h,p,s);else if(p!=null){const b=$T(p);e[h]=()=>b}}},Dk=(t,e)=>{const r=$T(e);t.slots.default=()=>r},Lk=(t,e,r)=>{for(const s in e)(r||s!=="_")&&(t[s]=e[s])},pV=(t,e,r)=>{const s=t.slots=Ck();if(t.vnode.shapeFlag&32){const h=e._;h?(Lk(s,e,r),r&&zM(s,"_",h,!0)):Ok(e,s)}else e&&Dk(t,e)},mV=(t,e,r)=>{const{vnode:s,slots:h}=t;let p=!0,b=co;if(s.shapeFlag&32){const E=e._;E?r&&E===1?p=!1:Lk(h,e,r):(p=!e.$stable,Ok(e,h)),b=e}else e&&(Dk(t,e),b={default:1});if(p)for(const E in h)!kk(E)&&b[E]==null&&delete h[E]};function M0(t,e,r,s,h=!1){if(an(t)){t.forEach((H,Y)=>M0(H,e&&(an(e)?e[Y]:e),r,s,h));return}if($f(s)&&!h)return;const p=s.shapeFlag&4?xy(s.component):s.el,b=h?null:p,{i:E,r:o}=t,O=e&&e.r,z=E.refs===co?E.refs={}:E.refs,U=E.setupState;if(O!=null&&O!==o&&(rs(O)?(z[O]=null,Qi(U,O)&&(U[O]=null)):Ca(O)&&(O.value=null)),zn(o))ch(o,E,12,[b,z]);else{const H=rs(o),Y=Ca(o);if(H||Y){const Q=()=>{if(t.f){const ge=H?Qi(U,o)?U[o]:z[o]:o.value;h?an(ge)&&wT(ge,p):an(ge)?ge.includes(p)||ge.push(p):H?(z[o]=[p],Qi(U,o)&&(U[o]=z[o])):(o.value=[p],t.k&&(z[t.k]=o.value))}else H?(z[o]=b,Qi(U,o)&&(U[o]=b)):Y&&(o.value=b,t.k&&(z[t.k]=b))};b?(Q.id=-1,oa(Q,r)):Q()}}}const Bk=Symbol("_vte"),gV=t=>t.__isTeleport,k_=t=>t&&(t.disabled||t.disabled===""),VC=t=>typeof SVGElement<"u"&&t instanceof SVGElement,UC=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,ww=(t,e)=>{const r=t&&t.to;return rs(r)?e?e(r):null:r},_V={name:"Teleport",__isTeleport:!0,process(t,e,r,s,h,p,b,E,o,O){const{mc:z,pc:U,pbc:H,o:{insert:Y,querySelector:Q,createText:ge,createComment:ye}}=O,ke=k_(e.props);let{shapeFlag:he,children:oe,dynamicChildren:ve}=e;if(t==null){const be=e.el=ge(""),ze=e.anchor=ge("");Y(be,r,s),Y(ze,r,s);const Te=e.target=ww(e.props,Q),ie=Nk(Te,e,ge,Y);Te&&(b==="svg"||VC(Te)?b="svg":(b==="mathml"||UC(Te))&&(b="mathml"));const ne=(te,re)=>{he&16&&z(oe,te,re,h,p,b,E,o)};ke?ne(r,ze):Te&&ne(Te,ie)}else{e.el=t.el,e.targetStart=t.targetStart;const be=e.anchor=t.anchor,ze=e.target=t.target,Te=e.targetAnchor=t.targetAnchor,ie=k_(t.props),ne=ie?r:ze,te=ie?be:Te;if(b==="svg"||VC(ze)?b="svg":(b==="mathml"||UC(ze))&&(b="mathml"),ve?(H(t.dynamicChildren,ve,ne,h,p,b,E),GT(t,e,!0)):o||U(t,e,ne,te,h,p,b,E,!1),ke)ie?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Zv(e,r,be,O,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const re=e.target=ww(e.props,Q);re&&Zv(e,re,null,O,0)}else ie&&Zv(e,ze,Te,O,1)}zk(e)},remove(t,e,r,{um:s,o:{remove:h}},p){const{shapeFlag:b,children:E,anchor:o,targetStart:O,targetAnchor:z,target:U,props:H}=t;if(U&&(h(O),h(z)),p&&h(o),b&16){const Y=p||!k_(H);for(let Q=0;Q<E.length;Q++){const ge=E[Q];s(ge,e,r,Y,!!ge.dynamicChildren)}}},move:Zv,hydrate:yV};function Zv(t,e,r,{o:{insert:s},m:h},p=2){p===0&&s(t.targetAnchor,e,r);const{el:b,anchor:E,shapeFlag:o,children:O,props:z}=t,U=p===2;if(U&&s(b,e,r),(!U||k_(z))&&o&16)for(let H=0;H<O.length;H++)h(O[H],e,r,2);U&&s(E,e,r)}function yV(t,e,r,s,h,p,{o:{nextSibling:b,parentNode:E,querySelector:o,insert:O,createText:z}},U){const H=e.target=ww(e.props,o);if(H){const Y=H._lpa||H.firstChild;if(e.shapeFlag&16)if(k_(e.props))e.anchor=U(b(t),e,E(t),r,s,h,p),e.targetStart=Y,e.targetAnchor=Y&&b(Y);else{e.anchor=b(t);let Q=Y;for(;Q;){if(Q&&Q.nodeType===8){if(Q.data==="teleport start anchor")e.targetStart=Q;else if(Q.data==="teleport anchor"){e.targetAnchor=Q,H._lpa=e.targetAnchor&&b(e.targetAnchor);break}}Q=b(Q)}e.targetAnchor||Nk(H,e,z,O),U(Y&&b(Y),e,H,r,s,h,p)}zk(e)}return e.anchor&&b(e.anchor)}const vV=_V;function zk(t){const e=t.ctx;if(e&&e.ut){let r=t.children[0].el;for(;r&&r!==t.targetAnchor;)r.nodeType===1&&r.setAttribute("data-v-owner",e.uid),r=r.nextSibling;e.ut()}}function Nk(t,e,r,s){const h=e.targetStart=r(""),p=e.targetAnchor=r("");return h[Bk]=p,t&&(s(h,t),s(p,t)),p}let jC=!1;const cm=()=>{jC||(console.error("Hydration completed but contains mismatches."),jC=!0)},bV=t=>t.namespaceURI.includes("svg")&&t.tagName!=="foreignObject",xV=t=>t.namespaceURI.includes("MathML"),Kv=t=>{if(bV(t))return"svg";if(xV(t))return"mathml"},Xv=t=>t.nodeType===8;function wV(t){const{mt:e,p:r,o:{patchProp:s,createText:h,nextSibling:p,parentNode:b,remove:E,insert:o,createComment:O}}=t,z=(oe,ve)=>{if(!ve.hasChildNodes()){r(null,oe,ve),R0(),ve._vnode=oe;return}U(ve.firstChild,oe,null,null,null),R0(),ve._vnode=oe},U=(oe,ve,be,ze,Te,ie=!1)=>{ie=ie||!!ve.dynamicChildren;const ne=Xv(oe)&&oe.data==="[",te=()=>ge(oe,ve,be,ze,Te,ne),{type:re,ref:me,shapeFlag:we,patchFlag:tt}=ve;let Et=oe.nodeType;ve.el=oe,tt===-2&&(ie=!1,ve.dynamicChildren=null);let ft=null;switch(re){case Cd:Et!==3?ve.children===""?(o(ve.el=h(""),b(oe),oe),ft=oe):ft=te():(oe.data!==ve.children&&(cm(),oe.data=ve.children),ft=p(oe));break;case Gs:he(oe)?(ft=p(oe),ke(ve.el=oe.content.firstChild,oe,be)):Et!==8||ne?ft=te():ft=p(oe);break;case Wf:if(ne&&(oe=p(oe),Et=oe.nodeType),Et===1||Et===3){ft=oe;const rr=!ve.children.length;for(let or=0;or<ve.staticCount;or++)rr&&(ve.children+=ft.nodeType===1?ft.outerHTML:ft.data),or===ve.staticCount-1&&(ve.anchor=ft),ft=p(ft);return ne?p(ft):ft}else te();break;case ts:ne?ft=Q(oe,ve,be,ze,Te,ie):ft=te();break;default:if(we&1)(Et!==1||ve.type.toLowerCase()!==oe.tagName.toLowerCase())&&!he(oe)?ft=te():ft=H(oe,ve,be,ze,Te,ie);else if(we&6){ve.slotScopeIds=Te;const rr=b(oe);if(ne?ft=ye(oe):Xv(oe)&&oe.data==="teleport start"?ft=ye(oe,oe.data,"teleport end"):ft=p(oe),e(ve,rr,null,be,ze,Kv(rr),ie),$f(ve)){let or;ne?(or=Un(ts),or.anchor=ft?ft.previousSibling:rr.lastChild):or=oe.nodeType===3?Es(""):Un("div"),or.el=oe,ve.component.subTree=or}}else we&64?Et!==8?ft=te():ft=ve.type.hydrate(oe,ve,be,ze,Te,ie,t,Y):we&128&&(ft=ve.type.hydrate(oe,ve,be,ze,Kv(b(oe)),Te,ie,t,U))}return me!=null&&M0(me,null,ze,ve),ft},H=(oe,ve,be,ze,Te,ie)=>{ie=ie||!!ve.dynamicChildren;const{type:ne,props:te,patchFlag:re,shapeFlag:me,dirs:we,transition:tt}=ve,Et=ne==="input"||ne==="option";if(Et||re!==-1){we&&cu(ve,null,be,"created");let ft=!1;if(he(oe)){ft=jk(ze,tt)&&be&&be.vnode.props&&be.vnode.props.appear;const or=oe.content.firstChild;ft&&tt.beforeEnter(or),ke(or,oe,be),ve.el=oe=or}if(me&16&&!(te&&(te.innerHTML||te.textContent))){let or=Y(oe.firstChild,ve,oe,be,ze,Te,ie);for(;or;){cm();const Fr=or;or=or.nextSibling,E(Fr)}}else me&8&&oe.textContent!==ve.children&&(cm(),oe.textContent=ve.children);if(te){if(Et||!ie||re&48){const or=oe.tagName.includes("-");for(const Fr in te)(Et&&(Fr.endsWith("value")||Fr==="indeterminate")||py(Fr)&&!vm(Fr)||Fr[0]==="."||or)&&s(oe,Fr,null,te[Fr],void 0,be)}else if(te.onClick)s(oe,"onClick",null,te.onClick,void 0,be);else if(re&4&&jf(te.style))for(const or in te.style)te.style[or]}let rr;(rr=te&&te.onVnodeBeforeMount)&&yl(rr,be,ve),we&&cu(ve,null,be,"beforeMount"),((rr=te&&te.onVnodeMounted)||we||ft)&&Jk(()=>{rr&&yl(rr,be,ve),ft&&tt.enter(oe),we&&cu(ve,null,be,"mounted")},ze)}return oe.nextSibling},Y=(oe,ve,be,ze,Te,ie,ne)=>{ne=ne||!!ve.dynamicChildren;const te=ve.children,re=te.length;for(let me=0;me<re;me++){const we=ne?te[me]:te[me]=vl(te[me]),tt=we.type===Cd;if(oe){if(tt&&!ne){let Et=te[me+1];Et&&(Et=vl(Et)).type===Cd&&(o(h(oe.data.slice(we.children.length)),be,p(oe)),oe.data=we.children)}oe=U(oe,we,ze,Te,ie,ne)}else tt&&!we.children?o(we.el=h(""),be):(cm(),r(null,we,be,null,ze,Te,Kv(be),ie))}return oe},Q=(oe,ve,be,ze,Te,ie)=>{const{slotScopeIds:ne}=ve;ne&&(Te=Te?Te.concat(ne):ne);const te=b(oe),re=Y(p(oe),ve,te,be,ze,Te,ie);return re&&Xv(re)&&re.data==="]"?p(ve.anchor=re):(cm(),o(ve.anchor=O("]"),te,re),re)},ge=(oe,ve,be,ze,Te,ie)=>{if(cm(),ve.el=null,ie){const re=ye(oe);for(;;){const me=p(oe);if(me&&me!==re)E(me);else break}}const ne=p(oe),te=b(oe);return E(oe),r(null,ve,te,ne,be,ze,Kv(te),Te),ne},ye=(oe,ve="[",be="]")=>{let ze=0;for(;oe;)if(oe=p(oe),oe&&Xv(oe)&&(oe.data===ve&&ze++,oe.data===be)){if(ze===0)return p(oe);ze--}return oe},ke=(oe,ve,be)=>{const ze=ve.parentNode;ze&&ze.replaceChild(oe,ve);let Te=be;for(;Te;)Te.vnode.el===ve&&(Te.vnode.el=Te.subTree.el=oe),Te=Te.parent},he=oe=>oe.nodeType===1&&oe.tagName.toLowerCase()==="template";return[z,U]}const oa=Jk;function Fk(t){return Uk(t)}function Vk(t){return Uk(t,wV)}function Uk(t,e){const r=NM();r.__VUE__=!0;const{insert:s,remove:h,patchProp:p,createElement:b,createText:E,createComment:o,setText:O,setElementText:z,parentNode:U,nextSibling:H,setScopeId:Y=wl,insertStaticContent:Q}=t,ge=(Fe,$e,We,zt=null,$t=null,_r=null,Wt=void 0,mr=null,Tr=!!$e.dynamicChildren)=>{if(Fe===$e)return;Fe&&!Dc(Fe,$e)&&(zt=vt(Fe),Ur(Fe,$t,_r,!0),Fe=null),$e.patchFlag===-2&&(Tr=!1,$e.dynamicChildren=null);const{type:yr,ref:Lr,shapeFlag:qr}=$e;switch(yr){case Cd:ye(Fe,$e,We,zt);break;case Gs:ke(Fe,$e,We,zt);break;case Wf:Fe==null&&he($e,We,zt,Wt);break;case ts:me(Fe,$e,We,zt,$t,_r,Wt,mr,Tr);break;default:qr&1?be(Fe,$e,We,zt,$t,_r,Wt,mr,Tr):qr&6?we(Fe,$e,We,zt,$t,_r,Wt,mr,Tr):(qr&64||qr&128)&&yr.process(Fe,$e,We,zt,$t,_r,Wt,mr,Tr,lr)}Lr!=null&&$t&&M0(Lr,Fe&&Fe.ref,_r,$e||Fe,!$e)},ye=(Fe,$e,We,zt)=>{if(Fe==null)s($e.el=E($e.children),We,zt);else{const $t=$e.el=Fe.el;$e.children!==Fe.children&&O($t,$e.children)}},ke=(Fe,$e,We,zt)=>{Fe==null?s($e.el=o($e.children||""),We,zt):$e.el=Fe.el},he=(Fe,$e,We,zt)=>{[Fe.el,Fe.anchor]=Q(Fe.children,$e,We,zt,Fe.el,Fe.anchor)},oe=({el:Fe,anchor:$e},We,zt)=>{let $t;for(;Fe&&Fe!==$e;)$t=H(Fe),s(Fe,We,zt),Fe=$t;s($e,We,zt)},ve=({el:Fe,anchor:$e})=>{let We;for(;Fe&&Fe!==$e;)We=H(Fe),h(Fe),Fe=We;h($e)},be=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr)=>{$e.type==="svg"?Wt="svg":$e.type==="math"&&(Wt="mathml"),Fe==null?ze($e,We,zt,$t,_r,Wt,mr,Tr):ne(Fe,$e,$t,_r,Wt,mr,Tr)},ze=(Fe,$e,We,zt,$t,_r,Wt,mr)=>{let Tr,yr;const{props:Lr,shapeFlag:qr,transition:nr,dirs:Wr}=Fe;if(Tr=Fe.el=b(Fe.type,_r,Lr&&Lr.is,Lr),qr&8?z(Tr,Fe.children):qr&16&&ie(Fe.children,Tr,null,zt,$t,S1(Fe,_r),Wt,mr),Wr&&cu(Fe,null,zt,"created"),Te(Tr,Fe,Fe.scopeId,Wt,zt),Lr){for(const Rn in Lr)Rn!=="value"&&!vm(Rn)&&p(Tr,Rn,null,Lr[Rn],_r,zt);"value"in Lr&&p(Tr,"value",null,Lr.value,_r),(yr=Lr.onVnodeBeforeMount)&&yl(yr,zt,Fe)}Wr&&cu(Fe,null,zt,"beforeMount");const Zr=jk($t,nr);Zr&&nr.beforeEnter(Tr),s(Tr,$e,We),((yr=Lr&&Lr.onVnodeMounted)||Zr||Wr)&&oa(()=>{yr&&yl(yr,zt,Fe),Zr&&nr.enter(Tr),Wr&&cu(Fe,null,zt,"mounted")},$t)},Te=(Fe,$e,We,zt,$t)=>{if(We&&Y(Fe,We),zt)for(let _r=0;_r<zt.length;_r++)Y(Fe,zt[_r]);if($t){let _r=$t.subTree;if($e===_r){const Wt=$t.vnode;Te(Fe,Wt,Wt.scopeId,Wt.slotScopeIds,$t.parent)}}},ie=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr=0)=>{for(let yr=Tr;yr<Fe.length;yr++){const Lr=Fe[yr]=mr?_d(Fe[yr]):vl(Fe[yr]);ge(null,Lr,$e,We,zt,$t,_r,Wt,mr)}},ne=(Fe,$e,We,zt,$t,_r,Wt)=>{const mr=$e.el=Fe.el;let{patchFlag:Tr,dynamicChildren:yr,dirs:Lr}=$e;Tr|=Fe.patchFlag&16;const qr=Fe.props||co,nr=$e.props||co;let Wr;if(We&&Mf(We,!1),(Wr=nr.onVnodeBeforeUpdate)&&yl(Wr,We,$e,Fe),Lr&&cu($e,Fe,We,"beforeUpdate"),We&&Mf(We,!0),(qr.innerHTML&&nr.innerHTML==null||qr.textContent&&nr.textContent==null)&&z(mr,""),yr?te(Fe.dynamicChildren,yr,mr,We,zt,S1($e,$t),_r):Wt||or(Fe,$e,mr,null,We,zt,S1($e,$t),_r,!1),Tr>0){if(Tr&16)re(mr,qr,nr,We,$t);else if(Tr&2&&qr.class!==nr.class&&p(mr,"class",null,nr.class,$t),Tr&4&&p(mr,"style",qr.style,nr.style,$t),Tr&8){const Zr=$e.dynamicProps;for(let Rn=0;Rn<Zr.length;Rn++){const ln=Zr[Rn],jn=qr[ln],uo=nr[ln];(uo!==jn||ln==="value")&&p(mr,ln,jn,uo,$t,We)}}Tr&1&&Fe.children!==$e.children&&z(mr,$e.children)}else!Wt&&yr==null&&re(mr,qr,nr,We,$t);((Wr=nr.onVnodeUpdated)||Lr)&&oa(()=>{Wr&&yl(Wr,We,$e,Fe),Lr&&cu($e,Fe,We,"updated")},zt)},te=(Fe,$e,We,zt,$t,_r,Wt)=>{for(let mr=0;mr<$e.length;mr++){const Tr=Fe[mr],yr=$e[mr],Lr=Tr.el&&(Tr.type===ts||!Dc(Tr,yr)||Tr.shapeFlag&70)?U(Tr.el):We;ge(Tr,yr,Lr,null,zt,$t,_r,Wt,!0)}},re=(Fe,$e,We,zt,$t)=>{if($e!==We){if($e!==co)for(const _r in $e)!vm(_r)&&!(_r in We)&&p(Fe,_r,$e[_r],null,$t,zt);for(const _r in We){if(vm(_r))continue;const Wt=We[_r],mr=$e[_r];Wt!==mr&&_r!=="value"&&p(Fe,_r,mr,Wt,$t,zt)}"value"in We&&p(Fe,"value",$e.value,We.value,$t)}},me=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr)=>{const yr=$e.el=Fe?Fe.el:E(""),Lr=$e.anchor=Fe?Fe.anchor:E("");let{patchFlag:qr,dynamicChildren:nr,slotScopeIds:Wr}=$e;Wr&&(mr=mr?mr.concat(Wr):Wr),Fe==null?(s(yr,We,zt),s(Lr,We,zt),ie($e.children||[],We,Lr,$t,_r,Wt,mr,Tr)):qr>0&&qr&64&&nr&&Fe.dynamicChildren?(te(Fe.dynamicChildren,nr,We,$t,_r,Wt,mr),($e.key!=null||$t&&$e===$t.subTree)&&GT(Fe,$e,!0)):or(Fe,$e,We,Lr,$t,_r,Wt,mr,Tr)},we=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr)=>{$e.slotScopeIds=mr,Fe==null?$e.shapeFlag&512?$t.ctx.activate($e,We,zt,Wt,Tr):tt($e,We,zt,$t,_r,Wt,Tr):Et(Fe,$e,Tr)},tt=(Fe,$e,We,zt,$t,_r,Wt)=>{const mr=Fe.component=oO(Fe,zt,$t);if(yy(Fe)&&(mr.ctx.renderer=lr),aO(mr,!1,Wt),mr.asyncDep){if($t&&$t.registerDep(mr,ft,Wt),!Fe.el){const Tr=mr.subTree=Un(Gs);ke(null,Tr,$e,We)}}else ft(mr,Fe,$e,We,$t,_r,Wt)},Et=(Fe,$e,We)=>{const zt=$e.component=Fe.component;if(MV(Fe,$e,We))if(zt.asyncDep&&!zt.asyncResolved){rr(zt,$e,We);return}else zt.next=$e,RF(zt.update),zt.effect.dirty=!0,zt.update();else $e.el=Fe.el,zt.vnode=$e},ft=(Fe,$e,We,zt,$t,_r,Wt)=>{const mr=()=>{if(Fe.isMounted){let{next:Lr,bu:qr,u:nr,parent:Wr,vnode:Zr}=Fe;{const ho=$k(Fe);if(ho){Lr&&(Lr.el=Zr.el,rr(Fe,Lr,Wt)),ho.asyncDep.then(()=>{Fe.isUnmounted||mr()});return}}let Rn=Lr,ln;Mf(Fe,!1),Lr?(Lr.el=Zr.el,rr(Fe,Lr,Wt)):Lr=Zr,qr&&bm(qr),(ln=Lr.props&&Lr.props.onVnodeBeforeUpdate)&&yl(ln,Wr,Lr,Zr),Mf(Fe,!0);const jn=c0(Fe),uo=Fe.subTree;Fe.subTree=jn,ge(uo,jn,U(uo.el),vt(uo),Fe,$t,_r),Lr.el=jn.el,Rn===null&&qT(Fe,jn.el),nr&&oa(nr,$t),(ln=Lr.props&&Lr.props.onVnodeUpdated)&&oa(()=>yl(ln,Wr,Lr,Zr),$t)}else{let Lr;const{el:qr,props:nr}=$e,{bm:Wr,m:Zr,parent:Rn}=Fe,ln=$f($e);if(Mf(Fe,!1),Wr&&bm(Wr),!ln&&(Lr=nr&&nr.onVnodeBeforeMount)&&yl(Lr,Rn,$e),Mf(Fe,!0),qr&&Kt){const jn=()=>{Fe.subTree=c0(Fe),Kt(qr,Fe.subTree,Fe,$t,null)};ln?$e.type.__asyncLoader().then(()=>!Fe.isUnmounted&&jn()):jn()}else{const jn=Fe.subTree=c0(Fe);ge(null,jn,We,zt,Fe,$t,_r),$e.el=jn.el}if(Zr&&oa(Zr,$t),!ln&&(Lr=nr&&nr.onVnodeMounted)){const jn=$e;oa(()=>yl(Lr,Rn,jn),$t)}($e.shapeFlag&256||Rn&&$f(Rn.vnode)&&Rn.vnode.shapeFlag&256)&&Fe.a&&oa(Fe.a,$t),Fe.isMounted=!0,$e=We=zt=null}},Tr=Fe.effect=new Mm(mr,wl,()=>yb(yr),Fe.scope),yr=Fe.update=()=>{Tr.dirty&&Tr.run()};yr.i=Fe,yr.id=Fe.uid,Mf(Fe,!0),yr()},rr=(Fe,$e,We)=>{$e.component=Fe;const zt=Fe.vnode.props;Fe.vnode=$e,Fe.next=null,hV(Fe,$e.props,zt,We),mV(Fe,$e.children,We),qd(),OC(Fe),Hd()},or=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr=!1)=>{const yr=Fe&&Fe.children,Lr=Fe?Fe.shapeFlag:0,qr=$e.children,{patchFlag:nr,shapeFlag:Wr}=$e;if(nr>0){if(nr&128){gt(yr,qr,We,zt,$t,_r,Wt,mr,Tr);return}else if(nr&256){Fr(yr,qr,We,zt,$t,_r,Wt,mr,Tr);return}}Wr&8?(Lr&16&&ar(yr,$t,_r),qr!==yr&&z(We,qr)):Lr&16?Wr&16?gt(yr,qr,We,zt,$t,_r,Wt,mr,Tr):ar(yr,$t,_r,!0):(Lr&8&&z(We,""),Wr&16&&ie(qr,We,zt,$t,_r,Wt,mr,Tr))},Fr=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr)=>{Fe=Fe||_m,$e=$e||_m;const yr=Fe.length,Lr=$e.length,qr=Math.min(yr,Lr);let nr;for(nr=0;nr<qr;nr++){const Wr=$e[nr]=Tr?_d($e[nr]):vl($e[nr]);ge(Fe[nr],Wr,We,null,$t,_r,Wt,mr,Tr)}yr>Lr?ar(Fe,$t,_r,!0,!1,qr):ie($e,We,zt,$t,_r,Wt,mr,Tr,qr)},gt=(Fe,$e,We,zt,$t,_r,Wt,mr,Tr)=>{let yr=0;const Lr=$e.length;let qr=Fe.length-1,nr=Lr-1;for(;yr<=qr&&yr<=nr;){const Wr=Fe[yr],Zr=$e[yr]=Tr?_d($e[yr]):vl($e[yr]);if(Dc(Wr,Zr))ge(Wr,Zr,We,null,$t,_r,Wt,mr,Tr);else break;yr++}for(;yr<=qr&&yr<=nr;){const Wr=Fe[qr],Zr=$e[nr]=Tr?_d($e[nr]):vl($e[nr]);if(Dc(Wr,Zr))ge(Wr,Zr,We,null,$t,_r,Wt,mr,Tr);else break;qr--,nr--}if(yr>qr){if(yr<=nr){const Wr=nr+1,Zr=Wr<Lr?$e[Wr].el:zt;for(;yr<=nr;)ge(null,$e[yr]=Tr?_d($e[yr]):vl($e[yr]),We,Zr,$t,_r,Wt,mr,Tr),yr++}}else if(yr>nr)for(;yr<=qr;)Ur(Fe[yr],$t,_r,!0),yr++;else{const Wr=yr,Zr=yr,Rn=new Map;for(yr=Zr;yr<=nr;yr++){const ki=$e[yr]=Tr?_d($e[yr]):vl($e[yr]);ki.key!=null&&Rn.set(ki.key,yr)}let ln,jn=0;const uo=nr-Zr+1;let ho=!1,vs=0;const Ai=new Array(uo);for(yr=0;yr<uo;yr++)Ai[yr]=0;for(yr=Wr;yr<=qr;yr++){const ki=Fe[yr];if(jn>=uo){Ur(ki,$t,_r,!0);continue}let Oi;if(ki.key!=null)Oi=Rn.get(ki.key);else for(ln=Zr;ln<=nr;ln++)if(Ai[ln-Zr]===0&&Dc(ki,$e[ln])){Oi=ln;break}Oi===void 0?Ur(ki,$t,_r,!0):(Ai[Oi-Zr]=yr+1,Oi>=vs?vs=Oi:ho=!0,ge(ki,$e[Oi],We,null,$t,_r,Wt,mr,Tr),jn++)}const ns=ho?TV(Ai):_m;for(ln=ns.length-1,yr=uo-1;yr>=0;yr--){const ki=Zr+yr,Oi=$e[ki],Zo=ki+1<Lr?$e[ki+1].el:zt;Ai[yr]===0?ge(null,Oi,We,Zo,$t,_r,Wt,mr,Tr):ho&&(ln<0||yr!==ns[ln]?jr(Oi,We,Zo,2):ln--)}}},jr=(Fe,$e,We,zt,$t=null)=>{const{el:_r,type:Wt,transition:mr,children:Tr,shapeFlag:yr}=Fe;if(yr&6){jr(Fe.component.subTree,$e,We,zt);return}if(yr&128){Fe.suspense.move($e,We,zt);return}if(yr&64){Wt.move(Fe,$e,We,lr);return}if(Wt===ts){s(_r,$e,We);for(let qr=0;qr<Tr.length;qr++)jr(Tr[qr],$e,We,zt);s(Fe.anchor,$e,We);return}if(Wt===Wf){oe(Fe,$e,We);return}if(zt!==2&&yr&1&&mr)if(zt===0)mr.beforeEnter(_r),s(_r,$e,We),oa(()=>mr.enter(_r),$t);else{const{leave:qr,delayLeave:nr,afterLeave:Wr}=mr,Zr=()=>s(_r,$e,We),Rn=()=>{qr(_r,()=>{Zr(),Wr&&Wr()})};nr?nr(_r,Zr,Rn):Rn()}else s(_r,$e,We)},Ur=(Fe,$e,We,zt=!1,$t=!1)=>{const{type:_r,props:Wt,ref:mr,children:Tr,dynamicChildren:yr,shapeFlag:Lr,patchFlag:qr,dirs:nr,cacheIndex:Wr}=Fe;if(qr===-2&&($t=!1),mr!=null&&M0(mr,null,We,Fe,!0),Wr!=null&&($e.renderCache[Wr]=void 0),Lr&256){$e.ctx.deactivate(Fe);return}const Zr=Lr&1&&nr,Rn=!$f(Fe);let ln;if(Rn&&(ln=Wt&&Wt.onVnodeBeforeUnmount)&&yl(ln,$e,Fe),Lr&6)Dt(Fe.component,We,zt);else{if(Lr&128){Fe.suspense.unmount(We,zt);return}Zr&&cu(Fe,null,$e,"beforeUnmount"),Lr&64?Fe.type.remove(Fe,$e,We,lr,zt):yr&&!yr.hasOnce&&(_r!==ts||qr>0&&qr&64)?ar(yr,$e,We,!1,!0):(_r===ts&&qr&384||!$t&&Lr&16)&&ar(Tr,$e,We),zt&&Xr(Fe)}(Rn&&(ln=Wt&&Wt.onVnodeUnmounted)||Zr)&&oa(()=>{ln&&yl(ln,$e,Fe),Zr&&cu(Fe,null,$e,"unmounted")},We)},Xr=Fe=>{const{type:$e,el:We,anchor:zt,transition:$t}=Fe;if($e===ts){pr(We,zt);return}if($e===Wf){ve(Fe);return}const _r=()=>{h(We),$t&&!$t.persisted&&$t.afterLeave&&$t.afterLeave()};if(Fe.shapeFlag&1&&$t&&!$t.persisted){const{leave:Wt,delayLeave:mr}=$t,Tr=()=>Wt(We,_r);mr?mr(Fe.el,_r,Tr):Tr()}else _r()},pr=(Fe,$e)=>{let We;for(;Fe!==$e;)We=H(Fe),h(Fe),Fe=We;h($e)},Dt=(Fe,$e,We)=>{const{bum:zt,scope:$t,update:_r,subTree:Wt,um:mr,m:Tr,a:yr}=Fe;k0(Tr),k0(yr),zt&&bm(zt),$t.stop(),_r&&(_r.active=!1,Ur(Wt,Fe,$e,We)),mr&&oa(mr,$e),oa(()=>{Fe.isUnmounted=!0},$e),$e&&$e.pendingBranch&&!$e.isUnmounted&&Fe.asyncDep&&!Fe.asyncResolved&&Fe.suspenseId===$e.pendingId&&($e.deps--,$e.deps===0&&$e.resolve())},ar=(Fe,$e,We,zt=!1,$t=!1,_r=0)=>{for(let Wt=_r;Wt<Fe.length;Wt++)Ur(Fe[Wt],$e,We,zt,$t)},vt=Fe=>{if(Fe.shapeFlag&6)return vt(Fe.component.subTree);if(Fe.shapeFlag&128)return Fe.suspense.next();const $e=H(Fe.anchor||Fe.el),We=$e&&$e[Bk];return We?H(We):$e};let Pt=!1;const Ot=(Fe,$e,We)=>{Fe==null?$e._vnode&&Ur($e._vnode,null,null,!0):ge($e._vnode||null,Fe,$e,null,null,null,We),$e._vnode=Fe,Pt||(Pt=!0,OC(),R0(),Pt=!1)},lr={p:ge,um:Ur,m:jr,r:Xr,mt:tt,mc:ie,pc:or,pbc:te,n:vt,o:t};let Se,Kt;return e&&([Se,Kt]=e(lr)),{render:Ot,hydrate:Se,createApp:lV(Ot,Se)}}function S1({type:t,props:e},r){return r==="svg"&&t==="foreignObject"||r==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:r}function Mf({effect:t,update:e},r){t.allowRecurse=e.allowRecurse=r}function jk(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function GT(t,e,r=!1){const s=t.children,h=e.children;if(an(s)&&an(h))for(let p=0;p<s.length;p++){const b=s[p];let E=h[p];E.shapeFlag&1&&!E.dynamicChildren&&((E.patchFlag<=0||E.patchFlag===32)&&(E=h[p]=_d(h[p]),E.el=b.el),!r&&E.patchFlag!==-2&&GT(b,E)),E.type===Cd&&(E.el=b.el)}}function TV(t){const e=t.slice(),r=[0];let s,h,p,b,E;const o=t.length;for(s=0;s<o;s++){const O=t[s];if(O!==0){if(h=r[r.length-1],t[h]<O){e[s]=h,r.push(s);continue}for(p=0,b=r.length-1;p<b;)E=p+b>>1,t[r[E]]<O?p=E+1:b=E;O<t[r[p]]&&(p>0&&(e[s]=r[p-1]),r[p]=s)}}for(p=r.length,b=r[p-1];p-- >0;)r[p]=b,b=e[b];return r}function $k(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:$k(e)}function k0(t){if(t)for(let e=0;e<t.length;e++)t[e].active=!1}const Gk=Symbol.for("v-scx"),qk=()=>Lc(Gk);function EV(t,e){return vy(t,null,e)}function Hk(t,e){return vy(t,null,{flush:"post"})}function Wk(t,e){return vy(t,null,{flush:"sync"})}const Yv={};function ll(t,e,r){return vy(t,e,r)}function vy(t,e,{immediate:r,deep:s,flush:h,once:p,onTrack:b,onTrigger:E}=co){if(e&&p){const ze=e;e=(...Te)=>{ze(...Te),be()}}const o=qs,O=ze=>s===!0?ze:bd(ze,s===!1?1:void 0);let z,U=!1,H=!1;if(Ca(t)?(z=()=>t.value,U=Xf(t)):jf(t)?(z=()=>O(t),U=!0):an(t)?(H=!0,U=t.some(ze=>jf(ze)||Xf(ze)),z=()=>t.map(ze=>{if(Ca(ze))return ze.value;if(jf(ze))return O(ze);if(zn(ze))return ch(ze,o,2)})):zn(t)?e?z=()=>ch(t,o,2):z=()=>(Y&&Y(),jl(t,o,3,[Q])):z=wl,e&&s){const ze=z;z=()=>bd(ze())}let Y,Q=ze=>{Y=oe.onStop=()=>{ch(ze,o,4),Y=oe.onStop=void 0}},ge;if(by)if(Q=wl,e?r&&jl(e,o,3,[z(),H?[]:void 0,Q]):z(),h==="sync"){const ze=qk();ge=ze.__watcherHandles||(ze.__watcherHandles=[])}else return wl;let ye=H?new Array(t.length).fill(Yv):Yv;const ke=()=>{if(!(!oe.active||!oe.dirty))if(e){const ze=oe.run();(s||U||(H?ze.some((Te,ie)=>al(Te,ye[ie])):al(ze,ye)))&&(Y&&Y(),jl(e,o,3,[ze,ye===Yv?void 0:H&&ye[0]===Yv?[]:ye,Q]),ye=ze)}else oe.run()};ke.allowRecurse=!!e;let he;h==="sync"?he=ke:h==="post"?he=()=>oa(ke,o&&o.suspense):(ke.pre=!0,o&&(ke.id=o.uid),he=()=>yb(ke));const oe=new Mm(z,wl,he),ve=$M(),be=()=>{oe.stop(),ve&&wT(ve.effects,oe)};return e?r?ke():ye=oe.run():h==="post"?oa(oe.run.bind(oe),o&&o.suspense):oe.run(),ge&&ge.push(be),be}function SV(t,e,r){const s=this.proxy,h=rs(t)?t.includes(".")?Zk(s,t):()=>s[t]:t.bind(s,s);let p;zn(e)?p=e:(p=e.handler,r=e);const b=Jf(this),E=vy(h,p.bind(s),r);return b(),E}function Zk(t,e){const r=e.split(".");return()=>{let s=t;for(let h=0;h<r.length&&s;h++)s=s[r[h]];return s}}function bd(t,e=1/0,r){if(e<=0||!So(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),e--,Ca(t))bd(t.value,e,r);else if(an(t))for(let s=0;s<t.length;s++)bd(t[s],e,r);else if(lp(t)||ym(t))t.forEach(s=>{bd(s,e,r)});else if(BM(t)){for(const s in t)bd(t[s],e,r);for(const s of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,s)&&bd(t[s],e,r)}return t}function IV(t,e,r=co){const s=Tu(),h=Ha(e),p=bl(e),b=Kk(t,e),E=ak((o,O)=>{let z,U=co,H;return Wk(()=>{const Y=t[e];al(z,Y)&&(z=Y,O())}),{get(){return o(),r.get?r.get(z):z},set(Y){const Q=r.set?r.set(Y):Y;if(!al(Q,z)&&!(U!==co&&al(Y,U)))return;const ge=s.vnode.props;ge&&(e in ge||h in ge||p in ge)&&(`onUpdate:${e}`in ge||`onUpdate:${h}`in ge||`onUpdate:${p}`in ge)||(z=Y,O()),s.emit(`update:${e}`,Q),al(Y,Q)&&al(Y,U)&&!al(Q,H)&&O(),U=Y,H=Q}}});return E[Symbol.iterator]=()=>{let o=0;return{next(){return o<2?{value:o++?b||co:E,done:!1}:{done:!0}}}},E}const Kk=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${Ha(e)}Modifiers`]||t[`${bl(e)}Modifiers`];function AV(t,e,...r){if(t.isUnmounted)return;const s=t.vnode.props||co;let h=r;const p=e.startsWith("update:"),b=p&&Kk(s,e.slice(7));b&&(b.trim&&(h=r.map(z=>rs(z)?z.trim():z)),b.number&&(h=r.map(S0)));let E,o=s[E=P_(e)]||s[E=P_(Ha(e))];!o&&p&&(o=s[E=P_(bl(e))]),o&&jl(o,t,6,h);const O=s[E+"Once"];if(O){if(!t.emitted)t.emitted={};else if(t.emitted[E])return;t.emitted[E]=!0,jl(O,t,6,h)}}function Xk(t,e,r=!1){const s=e.emitsCache,h=s.get(t);if(h!==void 0)return h;const p=t.emits;let b={},E=!1;if(!zn(t)){const o=O=>{const z=Xk(O,e,!0);z&&(E=!0,ps(b,z))};!r&&e.mixins.length&&e.mixins.forEach(o),t.extends&&o(t.extends),t.mixins&&t.mixins.forEach(o)}return!p&&!E?(So(t)&&s.set(t,null),null):(an(p)?p.forEach(o=>b[o]=null):ps(b,p),So(t)&&s.set(t,b),b)}function Tb(t,e){return!t||!py(e)?!1:(e=e.slice(2).replace(/Once$/,""),Qi(t,e[0].toLowerCase()+e.slice(1))||Qi(t,bl(e))||Qi(t,e))}function c0(t){const{type:e,vnode:r,proxy:s,withProxy:h,propsOptions:[p],slots:b,attrs:E,emit:o,render:O,renderCache:z,props:U,data:H,setupState:Y,ctx:Q,inheritAttrs:ge}=t,ye=W_(t);let ke,he;try{if(r.shapeFlag&4){const ve=h||s,be=ve;ke=vl(O.call(be,ve,z,U,Y,H,Q)),he=E}else{const ve=e;ke=vl(ve.length>1?ve(U,{attrs:E,slots:b,emit:o}):ve(U,null)),he=e.props?E:RV(E)}}catch(ve){O_.length=0,cp(ve,t,1),ke=Un(Gs)}let oe=ke;if(he&&ge!==!1){const ve=Object.keys(he),{shapeFlag:be}=oe;ve.length&&be&7&&(p&&ve.some(xT)&&(he=PV(he,p)),oe=vu(oe,he,!1,!0))}return r.dirs&&(oe=vu(oe,null,!1,!0),oe.dirs=oe.dirs?oe.dirs.concat(r.dirs):r.dirs),r.transition&&(oe.transition=r.transition),ke=oe,W_(ye),ke}function CV(t,e=!0){let r;for(let s=0;s<t.length;s++){const h=t[s];if(zd(h)){if(h.type!==Gs||h.children==="v-if"){if(r)return;r=h}}else return}return r}const RV=t=>{let e;for(const r in t)(r==="class"||r==="style"||py(r))&&((e||(e={}))[r]=t[r]);return e},PV=(t,e)=>{const r={};for(const s in t)(!xT(s)||!(s.slice(9)in e))&&(r[s]=t[s]);return r};function MV(t,e,r){const{props:s,children:h,component:p}=t,{props:b,children:E,patchFlag:o}=e,O=p.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&o>=0){if(o&1024)return!0;if(o&16)return s?$C(s,b,O):!!b;if(o&8){const z=e.dynamicProps;for(let U=0;U<z.length;U++){const H=z[U];if(b[H]!==s[H]&&!Tb(O,H))return!0}}}else return(h||E)&&(!E||!E.$stable)?!0:s===b?!1:s?b?$C(s,b,O):!0:!!b;return!1}function $C(t,e,r){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let h=0;h<s.length;h++){const p=s[h];if(e[p]!==t[p]&&!Tb(r,p))return!0}return!1}function qT({vnode:t,parent:e},r){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===t&&(s.el=t.el),s===t)(t=e.vnode).el=r,e=e.parent;else break}}const Tw=t=>t.__isSuspense;let Ew=0;const kV={name:"Suspense",__isSuspense:!0,process(t,e,r,s,h,p,b,E,o,O){if(t==null)DV(e,r,s,h,p,b,E,o,O);else{if(p&&p.deps>0&&!t.suspense.isInFallback){e.suspense=t.suspense,e.suspense.vnode=e,e.el=t.el;return}LV(t,e,r,s,h,b,E,o,O)}},hydrate:BV,normalize:zV},OV=kV;function X_(t,e){const r=t.props&&t.props[e];zn(r)&&r()}function DV(t,e,r,s,h,p,b,E,o){const{p:O,o:{createElement:z}}=o,U=z("div"),H=t.suspense=Yk(t,h,s,e,U,r,p,b,E,o);O(null,H.pendingBranch=t.ssContent,U,null,s,H,p,b),H.deps>0?(X_(t,"onPending"),X_(t,"onFallback"),O(null,t.ssFallback,e,r,s,null,p,b),Tm(H,t.ssFallback)):H.resolve(!1,!0)}function LV(t,e,r,s,h,p,b,E,{p:o,um:O,o:{createElement:z}}){const U=e.suspense=t.suspense;U.vnode=e,e.el=t.el;const H=e.ssContent,Y=e.ssFallback,{activeBranch:Q,pendingBranch:ge,isInFallback:ye,isHydrating:ke}=U;if(ge)U.pendingBranch=H,Dc(H,ge)?(o(ge,H,U.hiddenContainer,null,h,U,p,b,E),U.deps<=0?U.resolve():ye&&(ke||(o(Q,Y,r,s,h,null,p,b,E),Tm(U,Y)))):(U.pendingId=Ew++,ke?(U.isHydrating=!1,U.activeBranch=ge):O(ge,h,U),U.deps=0,U.effects.length=0,U.hiddenContainer=z("div"),ye?(o(null,H,U.hiddenContainer,null,h,U,p,b,E),U.deps<=0?U.resolve():(o(Q,Y,r,s,h,null,p,b,E),Tm(U,Y))):Q&&Dc(H,Q)?(o(Q,H,r,s,h,U,p,b,E),U.resolve(!0)):(o(null,H,U.hiddenContainer,null,h,U,p,b,E),U.deps<=0&&U.resolve()));else if(Q&&Dc(H,Q))o(Q,H,r,s,h,U,p,b,E),Tm(U,H);else if(X_(e,"onPending"),U.pendingBranch=H,H.shapeFlag&512?U.pendingId=H.component.suspenseId:U.pendingId=Ew++,o(null,H,U.hiddenContainer,null,h,U,p,b,E),U.deps<=0)U.resolve();else{const{timeout:he,pendingId:oe}=U;he>0?setTimeout(()=>{U.pendingId===oe&&U.fallback(Y)},he):he===0&&U.fallback(Y)}}function Yk(t,e,r,s,h,p,b,E,o,O,z=!1){const{p:U,m:H,um:Y,n:Q,o:{parentNode:ge,remove:ye}}=O;let ke;const he=NV(t);he&&e&&e.pendingBranch&&(ke=e.pendingId,e.deps++);const oe=t.props?I0(t.props.timeout):void 0,ve=p,be={vnode:t,parent:e,parentComponent:r,namespace:b,container:s,hiddenContainer:h,deps:0,pendingId:Ew++,timeout:typeof oe=="number"?oe:-1,activeBranch:null,pendingBranch:null,isInFallback:!z,isHydrating:z,isUnmounted:!1,effects:[],resolve(ze=!1,Te=!1){const{vnode:ie,activeBranch:ne,pendingBranch:te,pendingId:re,effects:me,parentComponent:we,container:tt}=be;let Et=!1;be.isHydrating?be.isHydrating=!1:ze||(Et=ne&&te.transition&&te.transition.mode==="out-in",Et&&(ne.transition.afterLeave=()=>{re===be.pendingId&&(H(te,tt,p===ve?Q(ne):p,0),C0(me))}),ne&&(ge(ne.el)!==be.hiddenContainer&&(p=Q(ne)),Y(ne,we,be,!0)),Et||H(te,tt,p,0)),Tm(be,te),be.pendingBranch=null,be.isInFallback=!1;let ft=be.parent,rr=!1;for(;ft;){if(ft.pendingBranch){ft.effects.push(...me),rr=!0;break}ft=ft.parent}!rr&&!Et&&C0(me),be.effects=[],he&&e&&e.pendingBranch&&ke===e.pendingId&&(e.deps--,e.deps===0&&!Te&&e.resolve()),X_(ie,"onResolve")},fallback(ze){if(!be.pendingBranch)return;const{vnode:Te,activeBranch:ie,parentComponent:ne,container:te,namespace:re}=be;X_(Te,"onFallback");const me=Q(ie),we=()=>{be.isInFallback&&(U(null,ze,te,me,ne,null,re,E,o),Tm(be,ze))},tt=ze.transition&&ze.transition.mode==="out-in";tt&&(ie.transition.afterLeave=we),be.isInFallback=!0,Y(ie,ne,null,!0),tt||we()},move(ze,Te,ie){be.activeBranch&&H(be.activeBranch,ze,Te,ie),be.container=ze},next(){return be.activeBranch&&Q(be.activeBranch)},registerDep(ze,Te,ie){const ne=!!be.pendingBranch;ne&&be.deps++;const te=ze.vnode.el;ze.asyncDep.catch(re=>{cp(re,ze,0)}).then(re=>{if(ze.isUnmounted||be.isUnmounted||be.pendingId!==ze.suspenseId)return;ze.asyncResolved=!0;const{vnode:me}=ze;Cw(ze,re,!1),te&&(me.el=te);const we=!te&&ze.subTree.el;Te(ze,me,ge(te||ze.subTree.el),te?null:Q(ze.subTree),be,b,ie),we&&ye(we),qT(ze,me.el),ne&&--be.deps===0&&be.resolve()})},unmount(ze,Te){be.isUnmounted=!0,be.activeBranch&&Y(be.activeBranch,r,ze,Te),be.pendingBranch&&Y(be.pendingBranch,r,ze,Te)}};return be}function BV(t,e,r,s,h,p,b,E,o){const O=e.suspense=Yk(e,s,r,t.parentNode,document.createElement("div"),null,h,p,b,E,!0),z=o(t,O.pendingBranch=e.ssContent,r,O,p,b);return O.deps===0&&O.resolve(!1,!0),z}function zV(t){const{shapeFlag:e,children:r}=t,s=e&32;t.ssContent=GC(s?r.default:r),t.ssFallback=s?GC(r.fallback):Un(Gs)}function GC(t){let e;if(zn(t)){const r=Yf&&t._c;r&&(t._d=!1,sn()),t=t(),r&&(t._d=!0,e=qa,Qk())}return an(t)&&(t=CV(t)),t=vl(t),e&&!t.dynamicChildren&&(t.dynamicChildren=e.filter(r=>r!==t)),t}function Jk(t,e){e&&e.pendingBranch?an(t)?e.effects.push(...t):e.effects.push(t):C0(t)}function Tm(t,e){t.activeBranch=e;const{vnode:r,parentComponent:s}=t;let h=e.el;for(;!h&&e.component;)e=e.component.subTree,h=e.el;r.el=h,s&&s.subTree===r&&(s.vnode.el=h,qT(s,h))}function NV(t){const e=t.props&&t.props.suspensible;return e!=null&&e!==!1}const ts=Symbol.for("v-fgt"),Cd=Symbol.for("v-txt"),Gs=Symbol.for("v-cmt"),Wf=Symbol.for("v-stc"),O_=[];let qa=null;function sn(t=!1){O_.push(qa=t?null:[])}function Qk(){O_.pop(),qa=O_[O_.length-1]||null}let Yf=1;function Sw(t){Yf+=t,t<0&&qa&&(qa.hasOnce=!0)}function eO(t){return t.dynamicChildren=Yf>0?qa||_m:null,Qk(),Yf>0&&qa&&qa.push(t),t}function Sn(t,e,r,s,h,p){return eO(ct(t,e,r,s,h,p,!0))}function Oc(t,e,r,s,h){return eO(Un(t,e,r,s,h,!0))}function zd(t){return t?t.__v_isVNode===!0:!1}function Dc(t,e){return t.type===e.type&&t.key===e.key}function FV(t){}const tO=({key:t})=>t??null,u0=({ref:t,ref_key:e,ref_for:r})=>(typeof t=="number"&&(t=""+t),t!=null?rs(t)||Ca(t)||zn(t)?{i:Hs,r:t,k:e,f:!!r}:t:null);function ct(t,e=null,r=null,s=0,h=null,p=t===ts?0:1,b=!1,E=!1){const o={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&tO(e),ref:e&&u0(e),scopeId:vb,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:p,patchFlag:s,dynamicProps:h,dynamicChildren:null,appContext:null,ctx:Hs};return E?(HT(o,r),p&128&&t.normalize(o)):r&&(o.shapeFlag|=rs(r)?8:16),Yf>0&&!b&&qa&&(o.patchFlag>0||p&6)&&o.patchFlag!==32&&qa.push(o),o}const Un=VV;function VV(t,e=null,r=null,s=0,h=null,p=!1){if((!t||t===Tk)&&(t=Gs),zd(t)){const E=vu(t,e,!0);return r&&HT(E,r),Yf>0&&!p&&qa&&(E.shapeFlag&6?qa[qa.indexOf(t)]=E:qa.push(E)),E.patchFlag=-2,E}if(WV(t)&&(t=t.__vccOpts),e){e=rO(e);let{class:E,style:o}=e;E&&!rs(E)&&(e.class=_y(E)),So(o)&&(PT(o)&&!an(o)&&(o=ps({},o)),e.style=gy(o))}const b=rs(t)?1:Tw(t)?128:gV(t)?64:So(t)?4:zn(t)?2:0;return ct(t,e,r,s,h,b,p,!0)}function rO(t){return t?PT(t)||Rk(t)?ps({},t):t:null}function vu(t,e,r=!1,s=!1){const{props:h,ref:p,patchFlag:b,children:E,transition:o}=t,O=e?iO(h||{},e):h,z={__v_isVNode:!0,__v_skip:!0,type:t.type,props:O,key:O&&tO(O),ref:e&&e.ref?r&&p?an(p)?p.concat(u0(e)):[p,u0(e)]:u0(e):p,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:E,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ts?b===-1?16:b|16:b,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:o,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&vu(t.ssContent),ssFallback:t.ssFallback&&vu(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return o&&s&&Bd(z,o.clone(z)),z}function Es(t=" ",e=0){return Un(Cd,null,t,e)}function nO(t,e){const r=Un(Wf,null,t);return r.staticCount=e,r}function aa(t="",e=!1){return e?(sn(),Oc(Gs,null,t)):Un(Gs,null,t)}function vl(t){return t==null||typeof t=="boolean"?Un(Gs):an(t)?Un(ts,null,t.slice()):typeof t=="object"?_d(t):Un(Cd,null,String(t))}function _d(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:vu(t)}function HT(t,e){let r=0;const{shapeFlag:s}=t;if(e==null)e=null;else if(an(e))r=16;else if(typeof e=="object")if(s&65){const h=e.default;h&&(h._c&&(h._d=!1),HT(t,h()),h._c&&(h._d=!0));return}else{r=32;const h=e._;!h&&!Rk(e)?e._ctx=Hs:h===3&&Hs&&(Hs.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else zn(e)?(e={default:e,_ctx:Hs},r=32):(e=String(e),s&64?(r=16,e=[Es(e)]):r=8);t.children=e,t.shapeFlag|=r}function iO(...t){const e={};for(let r=0;r<t.length;r++){const s=t[r];for(const h in s)if(h==="class")e.class!==s.class&&(e.class=_y([e.class,s.class]));else if(h==="style")e.style=gy([e.style,s.style]);else if(py(h)){const p=e[h],b=s[h];b&&p!==b&&!(an(p)&&p.includes(b))&&(e[h]=p?[].concat(p,b):b)}else h!==""&&(e[h]=s[h])}return e}function yl(t,e,r,s=null){jl(t,e,7,[r,s])}const UV=Ik();let jV=0;function oO(t,e,r){const s=t.type,h=(e?e.appContext:t.appContext)||UV,p={uid:jV++,vnode:t,type:s,parent:e,appContext:h,root:null,next:null,subTree:null,effect:null,update:null,scope:new ST(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(h.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Mk(s,h),emitsOptions:Xk(s,h),emit:null,emitted:null,propsDefaults:co,inheritAttrs:s.inheritAttrs,ctx:co,data:co,props:co,attrs:co,slots:co,refs:co,setupState:co,setupContext:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return p.ctx={_:p},p.root=e?e.root:p,p.emit=AV.bind(null,p),t.ce&&t.ce(p),p}let qs=null;const Tu=()=>qs||Hs;let O0,Iw;{const t=NM(),e=(r,s)=>{let h;return(h=t[r])||(h=t[r]=[]),h.push(s),p=>{h.length>1?h.forEach(b=>b(p)):h[0](p)}};O0=e("__VUE_INSTANCE_SETTERS__",r=>qs=r),Iw=e("__VUE_SSR_SETTERS__",r=>by=r)}const Jf=t=>{const e=qs;return O0(t),t.scope.on(),()=>{t.scope.off(),O0(e)}},Aw=()=>{qs&&qs.scope.off(),O0(null)};function sO(t){return t.vnode.shapeFlag&4}let by=!1;function aO(t,e=!1,r=!1){e&&Iw(e);const{props:s,children:h}=t.vnode,p=sO(t);uV(t,s,p,e),pV(t,h,r);const b=p?$V(t,e):void 0;return e&&Iw(!1),b}function $V(t,e){const r=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,yw);const{setup:s}=r;if(s){const h=t.setupContext=s.length>1?cO(t):null,p=Jf(t);qd();const b=ch(s,t,0,[t.props,h]);if(Hd(),p(),TT(b)){if(b.then(Aw,Aw),e)return b.then(E=>{Cw(t,E,e)}).catch(E=>{cp(E,t,0)});t.asyncDep=b}else Cw(t,b,e)}else lO(t,e)}function Cw(t,e,r){zn(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:So(e)&&(t.setupState=OT(e)),lO(t,r)}let D0,Rw;function GV(t){D0=t,Rw=e=>{e.render._rc&&(e.withProxy=new Proxy(e.ctx,jF))}}const qV=()=>!D0;function lO(t,e,r){const s=t.type;if(!t.render){if(!e&&D0&&!s.render){const h=s.template||jT(t).template;if(h){const{isCustomElement:p,compilerOptions:b}=t.appContext.config,{delimiters:E,compilerOptions:o}=s,O=ps(ps({isCustomElement:p,delimiters:E},b),o);s.render=D0(h,O)}}t.render=s.render||wl,Rw&&Rw(t)}{const h=Jf(t);qd();try{rV(t)}finally{Hd(),h()}}}const HV={get(t,e){return Il(t,"get",""),t[e]}};function cO(t){const e=r=>{t.exposed=r||{}};return{attrs:new Proxy(t.attrs,HV),slots:t.slots,emit:t.emit,expose:e}}function xy(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(OT(nk(t.exposed)),{get(e,r){if(r in e)return e[r];if(r in M_)return M_[r](t)},has(e,r){return r in e||r in M_}})):t.proxy}function Pw(t,e=!0){return zn(t)?t.displayName||t.name:t.name||e&&t.__name}function WV(t){return zn(t)&&"__vccOpts"in t}const Ds=(t,e)=>dF(t,e,by);function ja(t,e,r){const s=arguments.length;return s===2?So(e)&&!an(e)?zd(e)?Un(t,null,[e]):Un(t,e):Un(t,null,e):(s>3?r=Array.prototype.slice.call(arguments,2):s===3&&zd(r)&&(r=[r]),Un(t,e,r))}function ZV(){}function KV(t,e,r,s){const h=r[s];if(h&&uO(h,t))return h;const p=e();return p.memo=t.slice(),p.cacheIndex=s,r[s]=p}function uO(t,e){const r=t.memo;if(r.length!=e.length)return!1;for(let s=0;s<r.length;s++)if(al(r[s],e[s]))return!1;return Yf>0&&qa&&qa.push(t),!0}const hO="3.4.38",XV=wl,YV=IF,JV=um,QV=dk,e2={createComponentInstance:oO,setupComponent:aO,renderComponentRoot:c0,setCurrentRenderingInstance:W_,isVNode:zd,normalizeVNode:vl,getComponentPublicInstance:xy,ensureValidVNode:UT},t2=e2,r2=null,n2=null,i2=null;/**
* @vue/runtime-dom v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const o2="http://www.w3.org/2000/svg",s2="http://www.w3.org/1998/Math/MathML",eh=typeof document<"u"?document:null,qC=eh&&eh.createElement("template"),a2={insert:(t,e,r)=>{e.insertBefore(t,r||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,r,s)=>{const h=e==="svg"?eh.createElementNS(o2,t):e==="mathml"?eh.createElementNS(s2,t):r?eh.createElement(t,{is:r}):eh.createElement(t);return t==="select"&&s&&s.multiple!=null&&h.setAttribute("multiple",s.multiple),h},createText:t=>eh.createTextNode(t),createComment:t=>eh.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>eh.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,r,s,h,p){const b=r?r.previousSibling:e.lastChild;if(h&&(h===p||h.nextSibling))for(;e.insertBefore(h.cloneNode(!0),r),!(h===p||!(h=h.nextSibling)););else{qC.innerHTML=s==="svg"?`<svg>${t}</svg>`:s==="mathml"?`<math>${t}</math>`:t;const E=qC.content;if(s==="svg"||s==="mathml"){const o=E.firstChild;for(;o.firstChild;)E.appendChild(o.firstChild);E.removeChild(o)}e.insertBefore(E,r)}return[b?b.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}},cd="transition",f_="animation",Om=Symbol("_vtc"),WT=(t,{slots:e})=>ja(pk,fO(t),e);WT.displayName="Transition";const dO={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},l2=WT.props=ps({},BT,dO),kf=(t,e=[])=>{an(t)?t.forEach(r=>r(...e)):t&&t(...e)},HC=t=>t?an(t)?t.some(e=>e.length>1):t.length>1:!1;function fO(t){const e={};for(const me in t)me in dO||(e[me]=t[me]);if(t.css===!1)return e;const{name:r="v",type:s,duration:h,enterFromClass:p=`${r}-enter-from`,enterActiveClass:b=`${r}-enter-active`,enterToClass:E=`${r}-enter-to`,appearFromClass:o=p,appearActiveClass:O=b,appearToClass:z=E,leaveFromClass:U=`${r}-leave-from`,leaveActiveClass:H=`${r}-leave-active`,leaveToClass:Y=`${r}-leave-to`}=t,Q=c2(h),ge=Q&&Q[0],ye=Q&&Q[1],{onBeforeEnter:ke,onEnter:he,onEnterCancelled:oe,onLeave:ve,onLeaveCancelled:be,onBeforeAppear:ze=ke,onAppear:Te=he,onAppearCancelled:ie=oe}=e,ne=(me,we,tt)=>{pd(me,we?z:E),pd(me,we?O:b),tt&&tt()},te=(me,we)=>{me._isLeaving=!1,pd(me,U),pd(me,Y),pd(me,H),we&&we()},re=me=>(we,tt)=>{const Et=me?Te:he,ft=()=>ne(we,me,tt);kf(Et,[we,ft]),WC(()=>{pd(we,me?o:p),Ju(we,me?z:E),HC(Et)||ZC(we,s,ge,ft)})};return ps(e,{onBeforeEnter(me){kf(ke,[me]),Ju(me,p),Ju(me,b)},onBeforeAppear(me){kf(ze,[me]),Ju(me,o),Ju(me,O)},onEnter:re(!1),onAppear:re(!0),onLeave(me,we){me._isLeaving=!0;const tt=()=>te(me,we);Ju(me,U),Ju(me,H),mO(),WC(()=>{me._isLeaving&&(pd(me,U),Ju(me,Y),HC(ve)||ZC(me,s,ye,tt))}),kf(ve,[me,tt])},onEnterCancelled(me){ne(me,!1),kf(oe,[me])},onAppearCancelled(me){ne(me,!0),kf(ie,[me])},onLeaveCancelled(me){te(me),kf(be,[me])}})}function c2(t){if(t==null)return null;if(So(t))return[I1(t.enter),I1(t.leave)];{const e=I1(t);return[e,e]}}function I1(t){return I0(t)}function Ju(t,e){e.split(/\s+/).forEach(r=>r&&t.classList.add(r)),(t[Om]||(t[Om]=new Set)).add(e)}function pd(t,e){e.split(/\s+/).forEach(s=>s&&t.classList.remove(s));const r=t[Om];r&&(r.delete(e),r.size||(t[Om]=void 0))}function WC(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let u2=0;function ZC(t,e,r,s){const h=t._endId=++u2,p=()=>{h===t._endId&&s()};if(r)return setTimeout(p,r);const{type:b,timeout:E,propCount:o}=pO(t,e);if(!b)return s();const O=b+"end";let z=0;const U=()=>{t.removeEventListener(O,H),p()},H=Y=>{Y.target===t&&++z>=o&&U()};setTimeout(()=>{z<o&&U()},E+1),t.addEventListener(O,H)}function pO(t,e){const r=window.getComputedStyle(t),s=Q=>(r[Q]||"").split(", "),h=s(`${cd}Delay`),p=s(`${cd}Duration`),b=KC(h,p),E=s(`${f_}Delay`),o=s(`${f_}Duration`),O=KC(E,o);let z=null,U=0,H=0;e===cd?b>0&&(z=cd,U=b,H=p.length):e===f_?O>0&&(z=f_,U=O,H=o.length):(U=Math.max(b,O),z=U>0?b>O?cd:f_:null,H=z?z===cd?p.length:o.length:0);const Y=z===cd&&/\b(transform|all)(,|$)/.test(s(`${cd}Property`).toString());return{type:z,timeout:U,propCount:H,hasTransform:Y}}function KC(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((r,s)=>XC(r)+XC(t[s])))}function XC(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function mO(){return document.body.offsetHeight}function h2(t,e,r){const s=t[Om];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?t.removeAttribute("class"):r?t.setAttribute("class",e):t.className=e}const L0=Symbol("_vod"),gO=Symbol("_vsh"),_O={beforeMount(t,{value:e},{transition:r}){t[L0]=t.style.display==="none"?"":t.style.display,r&&e?r.beforeEnter(t):p_(t,e)},mounted(t,{value:e},{transition:r}){r&&e&&r.enter(t)},updated(t,{value:e,oldValue:r},{transition:s}){!e!=!r&&(s?e?(s.beforeEnter(t),p_(t,!0),s.enter(t)):s.leave(t,()=>{p_(t,!1)}):p_(t,e))},beforeUnmount(t,{value:e}){p_(t,e)}};function p_(t,e){t.style.display=e?t[L0]:"none",t[gO]=!e}function d2(){_O.getSSRProps=({value:t})=>{if(!t)return{style:{display:"none"}}}}const yO=Symbol("");function f2(t){const e=Tu();if(!e)return;const r=e.ut=(h=t(e.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${e.uid}"]`)).forEach(p=>kw(p,h))},s=()=>{const h=t(e.proxy);Mw(e.subTree,h),r(h)};zT(()=>{Hk(s)}),ic(()=>{const h=new MutationObserver(s);h.observe(e.subTree.el.parentNode,{childList:!0}),wb(()=>h.disconnect())})}function Mw(t,e){if(t.shapeFlag&128){const r=t.suspense;t=r.activeBranch,r.pendingBranch&&!r.isHydrating&&r.effects.push(()=>{Mw(r.activeBranch,e)})}for(;t.component;)t=t.component.subTree;if(t.shapeFlag&1&&t.el)kw(t.el,e);else if(t.type===ts)t.children.forEach(r=>Mw(r,e));else if(t.type===Wf){let{el:r,anchor:s}=t;for(;r&&(kw(r,e),r!==s);)r=r.nextSibling}}function kw(t,e){if(t.nodeType===1){const r=t.style;let s="";for(const h in e)r.setProperty(`--${h}`,e[h]),s+=`--${h}: ${e[h]};`;r[yO]=s}}const p2=/(^|;)\s*display\s*:/;function m2(t,e,r){const s=t.style,h=rs(r);let p=!1;if(r&&!h){if(e)if(rs(e))for(const b of e.split(";")){const E=b.slice(0,b.indexOf(":")).trim();r[E]==null&&h0(s,E,"")}else for(const b in e)r[b]==null&&h0(s,b,"");for(const b in r)b==="display"&&(p=!0),h0(s,b,r[b])}else if(h){if(e!==r){const b=s[yO];b&&(r+=";"+b),s.cssText=r,p=p2.test(r)}}else e&&t.removeAttribute("style");L0 in t&&(t[L0]=p?s.display:"",t[gO]&&(s.display="none"))}const YC=/\s*!important$/;function h0(t,e,r){if(an(r))r.forEach(s=>h0(t,e,s));else if(r==null&&(r=""),e.startsWith("--"))t.setProperty(e,r);else{const s=g2(t,e);YC.test(r)?t.setProperty(bl(s),r.replace(YC,""),"important"):t[s]=r}}const JC=["Webkit","Moz","ms"],A1={};function g2(t,e){const r=A1[e];if(r)return r;let s=Ha(e);if(s!=="filter"&&s in t)return A1[e]=s;s=my(s);for(let h=0;h<JC.length;h++){const p=JC[h]+s;if(p in t)return A1[e]=p}return e}const QC="http://www.w3.org/1999/xlink";function eR(t,e,r,s,h,p=F5(e)){s&&e.startsWith("xlink:")?r==null?t.removeAttributeNS(QC,e.slice(6,e.length)):t.setAttributeNS(QC,e,r):r==null||p&&!FM(r)?t.removeAttribute(e):t.setAttribute(e,p?"":yu(r)?String(r):r)}function _2(t,e,r,s){if(e==="innerHTML"||e==="textContent"){if(r==null)return;t[e]=r;return}const h=t.tagName;if(e==="value"&&h!=="PROGRESS"&&!h.includes("-")){const b=h==="OPTION"?t.getAttribute("value")||"":t.value,E=r==null?"":String(r);(b!==E||!("_value"in t))&&(t.value=E),r==null&&t.removeAttribute(e),t._value=r;return}let p=!1;if(r===""||r==null){const b=typeof t[e];b==="boolean"?r=FM(r):r==null&&b==="string"?(r="",p=!0):b==="number"&&(r=0,p=!0)}try{t[e]=r}catch{}p&&t.removeAttribute(e)}function rh(t,e,r,s){t.addEventListener(e,r,s)}function y2(t,e,r,s){t.removeEventListener(e,r,s)}const tR=Symbol("_vei");function v2(t,e,r,s,h=null){const p=t[tR]||(t[tR]={}),b=p[e];if(s&&b)b.value=s;else{const[E,o]=b2(e);if(s){const O=p[e]=T2(s,h);rh(t,E,O,o)}else b&&(y2(t,E,b,o),p[e]=void 0)}}const rR=/(?:Once|Passive|Capture)$/;function b2(t){let e;if(rR.test(t)){e={};let s;for(;s=t.match(rR);)t=t.slice(0,t.length-s[0].length),e[s[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):bl(t.slice(2)),e]}let C1=0;const x2=Promise.resolve(),w2=()=>C1||(x2.then(()=>C1=0),C1=Date.now());function T2(t,e){const r=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=r.attached)return;jl(E2(s,r.value),e,5,[s])};return r.value=t,r.attached=w2(),r}function E2(t,e){if(an(e)){const r=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{r.call(t),t._stopped=!0},e.map(s=>h=>!h._stopped&&s&&s(h))}else return e}const nR=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,S2=(t,e,r,s,h,p)=>{const b=h==="svg";e==="class"?h2(t,s,b):e==="style"?m2(t,r,s):py(e)?xT(e)||v2(t,e,r,s,p):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):I2(t,e,s,b))?(_2(t,e,s),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&eR(t,e,s,b,p,e!=="value")):(e==="true-value"?t._trueValue=s:e==="false-value"&&(t._falseValue=s),eR(t,e,s,b))};function I2(t,e,r,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in t&&nR(e)&&zn(r));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const h=t.tagName;if(h==="IMG"||h==="VIDEO"||h==="CANVAS"||h==="SOURCE")return!1}return nR(e)&&rs(r)?!1:e in t}/*! #__NO_SIDE_EFFECTS__ */function vO(t,e,r){const s=Wd(t,e);class h extends Eb{constructor(b){super(s,b,r)}}return h.def=s,h}/*! #__NO_SIDE_EFFECTS__ */const A2=(t,e)=>vO(t,e,PO),C2=typeof HTMLElement<"u"?HTMLElement:class{};class Eb extends C2{constructor(e,r={},s){super(),this._def=e,this._props=r,this._instance=null,this._connected=!1,this._resolved=!1,this._numberProps=null,this._ob=null,this.shadowRoot&&s?s(this._createVNode(),this.shadowRoot):(this.attachShadow({mode:"open"}),this._def.__asyncLoader||this._resolveProps(this._def))}connectedCallback(){this._connected=!0,this._instance||(this._resolved?this._update():this._resolveDef())}disconnectedCallback(){this._connected=!1,up(()=>{this._connected||(this._ob&&(this._ob.disconnect(),this._ob=null),Ow(null,this.shadowRoot),this._instance=null)})}_resolveDef(){this._resolved=!0;for(let s=0;s<this.attributes.length;s++)this._setAttr(this.attributes[s].name);this._ob=new MutationObserver(s=>{for(const h of s)this._setAttr(h.attributeName)}),this._ob.observe(this,{attributes:!0});const e=(s,h=!1)=>{const{props:p,styles:b}=s;let E;if(p&&!an(p))for(const o in p){const O=p[o];(O===Number||O&&O.type===Number)&&(o in this._props&&(this._props[o]=I0(this._props[o])),(E||(E=Object.create(null)))[Ha(o)]=!0)}this._numberProps=E,h&&this._resolveProps(s),this._applyStyles(b),this._update()},r=this._def.__asyncLoader;r?r().then(s=>e(s,!0)):e(this._def)}_resolveProps(e){const{props:r}=e,s=an(r)?r:Object.keys(r||{});for(const h of Object.keys(this))h[0]!=="_"&&s.includes(h)&&this._setProp(h,this[h],!0,!1);for(const h of s.map(Ha))Object.defineProperty(this,h,{get(){return this._getProp(h)},set(p){this._setProp(h,p)}})}_setAttr(e){let r=this.hasAttribute(e)?this.getAttribute(e):void 0;const s=Ha(e);this._numberProps&&this._numberProps[s]&&(r=I0(r)),this._setProp(s,r,!1)}_getProp(e){return this._props[e]}_setProp(e,r,s=!0,h=!0){r!==this._props[e]&&(this._props[e]=r,h&&this._instance&&this._update(),s&&(r===!0?this.setAttribute(bl(e),""):typeof r=="string"||typeof r=="number"?this.setAttribute(bl(e),r+""):r||this.removeAttribute(bl(e))))}_update(){Ow(this._createVNode(),this.shadowRoot)}_createVNode(){const e=Un(this._def,ps({},this._props));return this._instance||(e.ce=r=>{this._instance=r,r.isCE=!0;const s=(p,b)=>{this.dispatchEvent(new CustomEvent(p,{detail:b}))};r.emit=(p,...b)=>{s(p,b),bl(p)!==p&&s(bl(p),b)};let h=this;for(;h=h&&(h.parentNode||h.host);)if(h instanceof Eb){r.parent=h._instance,r.provides=h._instance.provides;break}}),e}_applyStyles(e){e&&e.forEach(r=>{const s=document.createElement("style");s.textContent=r,this.shadowRoot.appendChild(s)})}}function R2(t="$style"){{const e=Tu();if(!e)return co;const r=e.type.__cssModules;if(!r)return co;const s=r[t];return s||co}}const bO=new WeakMap,xO=new WeakMap,B0=Symbol("_moveCb"),iR=Symbol("_enterCb"),wO={name:"TransitionGroup",props:ps({},l2,{tag:String,moveClass:String}),setup(t,{slots:e}){const r=Tu(),s=LT();let h,p;return Zm(()=>{if(!h.length)return;const b=t.moveClass||`${t.name||"v"}-move`;if(!L2(h[0].el,r.vnode.el,b))return;h.forEach(k2),h.forEach(O2);const E=h.filter(D2);mO(),E.forEach(o=>{const O=o.el,z=O.style;Ju(O,b),z.transform=z.webkitTransform=z.transitionDuration="";const U=O[B0]=H=>{H&&H.target!==O||(!H||/transform$/.test(H.propertyName))&&(O.removeEventListener("transitionend",U),O[B0]=null,pd(O,b))};O.addEventListener("transitionend",U)})}),()=>{const b=Ki(t),E=fO(b);let o=b.tag||ts;if(h=[],p)for(let O=0;O<p.length;O++){const z=p[O];z.el&&z.el instanceof Element&&(h.push(z),Bd(z,km(z,E,s,r)),bO.set(z,z.el.getBoundingClientRect()))}p=e.default?bb(e.default()):[];for(let O=0;O<p.length;O++){const z=p[O];z.key!=null&&Bd(z,km(z,E,s,r))}return Un(o,null,p)}}},P2=t=>delete t.mode;wO.props;const M2=wO;function k2(t){const e=t.el;e[B0]&&e[B0](),e[iR]&&e[iR]()}function O2(t){xO.set(t,t.el.getBoundingClientRect())}function D2(t){const e=bO.get(t),r=xO.get(t),s=e.left-r.left,h=e.top-r.top;if(s||h){const p=t.el.style;return p.transform=p.webkitTransform=`translate(${s}px,${h}px)`,p.transitionDuration="0s",t}}function L2(t,e,r){const s=t.cloneNode(),h=t[Om];h&&h.forEach(E=>{E.split(/\s+/).forEach(o=>o&&s.classList.remove(o))}),r.split(/\s+/).forEach(E=>E&&s.classList.add(E)),s.style.display="none";const p=e.nodeType===1?e:e.parentNode;p.appendChild(s);const{hasTransform:b}=pO(s);return p.removeChild(s),b}const Nd=t=>{const e=t.props["onUpdate:modelValue"]||!1;return an(e)?r=>bm(e,r):e};function B2(t){t.target.composing=!0}function oR(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const nc=Symbol("_assign"),fs={created(t,{modifiers:{lazy:e,trim:r,number:s}},h){t[nc]=Nd(h);const p=s||h.props&&h.props.type==="number";rh(t,e?"change":"input",b=>{if(b.target.composing)return;let E=t.value;r&&(E=E.trim()),p&&(E=S0(E)),t[nc](E)}),r&&rh(t,"change",()=>{t.value=t.value.trim()}),e||(rh(t,"compositionstart",B2),rh(t,"compositionend",oR),rh(t,"change",oR))},mounted(t,{value:e}){t.value=e??""},beforeUpdate(t,{value:e,oldValue:r,modifiers:{lazy:s,trim:h,number:p}},b){if(t[nc]=Nd(b),t.composing)return;const E=(p||t.type==="number")&&!/^0\d/.test(t.value)?S0(t.value):t.value,o=e??"";E!==o&&(document.activeElement===t&&t.type!=="range"&&(s&&e===r||h&&t.value.trim()===o)||(t.value=o))}},ZT={deep:!0,created(t,e,r){t[nc]=Nd(r),rh(t,"change",()=>{const s=t._modelValue,h=Dm(t),p=t.checked,b=t[nc];if(an(s)){const E=fb(s,h),o=E!==-1;if(p&&!o)b(s.concat(h));else if(!p&&o){const O=[...s];O.splice(E,1),b(O)}}else if(lp(s)){const E=new Set(s);p?E.add(h):E.delete(h),b(E)}else b(TO(t,p))})},mounted:sR,beforeUpdate(t,e,r){t[nc]=Nd(r),sR(t,e,r)}};function sR(t,{value:e,oldValue:r},s){t._modelValue=e,an(e)?t.checked=fb(e,s.props.value)>-1:lp(e)?t.checked=e.has(s.props.value):e!==r&&(t.checked=Od(e,TO(t,!0)))}const KT={created(t,{value:e},r){t.checked=Od(e,r.props.value),t[nc]=Nd(r),rh(t,"change",()=>{t[nc](Dm(t))})},beforeUpdate(t,{value:e,oldValue:r},s){t[nc]=Nd(s),e!==r&&(t.checked=Od(e,s.props.value))}},wy={deep:!0,created(t,{value:e,modifiers:{number:r}},s){const h=lp(e);rh(t,"change",()=>{const p=Array.prototype.filter.call(t.options,b=>b.selected).map(b=>r?S0(Dm(b)):Dm(b));t[nc](t.multiple?h?new Set(p):p:p[0]),t._assigning=!0,up(()=>{t._assigning=!1})}),t[nc]=Nd(s)},mounted(t,{value:e,modifiers:{number:r}}){aR(t,e)},beforeUpdate(t,e,r){t[nc]=Nd(r)},updated(t,{value:e,modifiers:{number:r}}){t._assigning||aR(t,e)}};function aR(t,e,r){const s=t.multiple,h=an(e);if(!(s&&!h&&!lp(e))){for(let p=0,b=t.options.length;p<b;p++){const E=t.options[p],o=Dm(E);if(s)if(h){const O=typeof o;O==="string"||O==="number"?E.selected=e.some(z=>String(z)===String(o)):E.selected=fb(e,o)>-1}else E.selected=e.has(o);else if(Od(Dm(E),e)){t.selectedIndex!==p&&(t.selectedIndex=p);return}}!s&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function Dm(t){return"_value"in t?t._value:t.value}function TO(t,e){const r=e?"_trueValue":"_falseValue";return r in t?t[r]:e}const EO={created(t,e,r){Jv(t,e,r,null,"created")},mounted(t,e,r){Jv(t,e,r,null,"mounted")},beforeUpdate(t,e,r,s){Jv(t,e,r,s,"beforeUpdate")},updated(t,e,r,s){Jv(t,e,r,s,"updated")}};function SO(t,e){switch(t){case"SELECT":return wy;case"TEXTAREA":return fs;default:switch(e){case"checkbox":return ZT;case"radio":return KT;default:return fs}}}function Jv(t,e,r,s,h){const b=SO(t.tagName,r.props&&r.props.type)[h];b&&b(t,e,r,s)}function z2(){fs.getSSRProps=({value:t})=>({value:t}),KT.getSSRProps=({value:t},e)=>{if(e.props&&Od(e.props.value,t))return{checked:!0}},ZT.getSSRProps=({value:t},e)=>{if(an(t)){if(e.props&&fb(t,e.props.value)>-1)return{checked:!0}}else if(lp(t)){if(e.props&&t.has(e.props.value))return{checked:!0}}else if(t)return{checked:!0}},EO.getSSRProps=(t,e)=>{if(typeof e.type!="string")return;const r=SO(e.type.toUpperCase(),e.props&&e.props.type);if(r.getSSRProps)return r.getSSRProps(t,e)}}const N2=["ctrl","shift","alt","meta"],F2={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>N2.some(r=>t[`${r}Key`]&&!e.includes(r))},zf=(t,e)=>{const r=t._withMods||(t._withMods={}),s=e.join(".");return r[s]||(r[s]=(h,...p)=>{for(let b=0;b<e.length;b++){const E=F2[e[b]];if(E&&E(h,e))return}return t(h,...p)})},V2={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},IO=(t,e)=>{const r=t._withKeys||(t._withKeys={}),s=e.join(".");return r[s]||(r[s]=h=>{if(!("key"in h))return;const p=bl(h.key);if(e.some(b=>b===p||V2[b]===p))return t(h)})},AO=ps({patchProp:S2},a2);let D_,lR=!1;function CO(){return D_||(D_=Fk(AO))}function RO(){return D_=lR?D_:Vk(AO),lR=!0,D_}const Ow=(...t)=>{CO().render(...t)},PO=(...t)=>{RO().hydrate(...t)},MO=(...t)=>{const e=CO().createApp(...t),{mount:r}=e;return e.mount=s=>{const h=OO(s);if(!h)return;const p=e._component;!zn(p)&&!p.render&&!p.template&&(p.template=h.innerHTML),h.innerHTML="";const b=r(h,!1,kO(h));return h instanceof Element&&(h.removeAttribute("v-cloak"),h.setAttribute("data-v-app","")),b},e},U2=(...t)=>{const e=RO().createApp(...t),{mount:r}=e;return e.mount=s=>{const h=OO(s);if(h)return r(h,!0,kO(h))},e};function kO(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function OO(t){return rs(t)?document.querySelector(t):t}let cR=!1;const j2=()=>{cR||(cR=!0,z2(),d2())};/**
* vue v3.4.38
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const $2=()=>{},G2=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition:pk,BaseTransitionPropsValidators:BT,Comment:Gs,DeprecationTypes:i2,EffectScope:ST,ErrorCodes:SF,ErrorTypeStrings:YV,Fragment:ts,KeepAlive:LF,ReactiveEffect:Mm,Static:Wf,Suspense:OV,Teleport:vV,Text:Cd,TrackOpTypes:wF,Transition:WT,TransitionGroup:M2,TriggerOpTypes:TF,VueElement:Eb,assertNumber:EF,callWithAsyncErrorHandling:jl,callWithErrorHandling:ch,camelize:Ha,capitalize:my,cloneVNode:vu,compatUtils:n2,compile:$2,computed:Ds,createApp:MO,createBlock:Oc,createCommentVNode:aa,createElementBlock:Sn,createElementVNode:ct,createHydrationRenderer:Vk,createPropsRestProxy:eV,createRenderer:Fk,createSSRApp:U2,createSlots:FF,createStaticVNode:nO,createTextVNode:Es,createVNode:Un,customRef:ak,defineAsyncComponent:OF,defineComponent:Wd,defineCustomElement:vO,defineEmits:GF,defineExpose:qF,defineModel:ZF,defineOptions:HF,defineProps:$F,defineSSRCustomElement:A2,defineSlots:WF,devtools:JV,effect:G5,effectScope:U5,getCurrentInstance:Tu,getCurrentScope:$M,getTransitionRawChildren:bb,guardReactiveProps:rO,h:ja,handleError:cp,hasInjectionContext:cV,hydrate:PO,initCustomFormatter:ZV,initDirectivesForSSR:j2,inject:Lc,isMemoSame:uO,isProxy:PT,isReactive:jf,isReadonly:Ld,isRef:Ca,isRuntimeOnly:qV,isShallow:Xf,isVNode:zd,markRaw:nk,mergeDefaults:JF,mergeModels:QF,mergeProps:iO,nextTick:up,normalizeClass:_y,normalizeProps:z5,normalizeStyle:gy,onActivated:gk,onBeforeMount:zT,onBeforeUnmount:Km,onBeforeUpdate:NT,onDeactivated:_k,onErrorCaptured:wk,onMounted:ic,onRenderTracked:xk,onRenderTriggered:bk,onScopeDispose:j5,onServerPrefetch:vk,onUnmounted:wb,onUpdated:Zm,openBlock:sn,popScopeId:wu,provide:Hf,proxyRefs:OT,pushScopeId:xu,queuePostFlushCb:C0,reactive:Dd,readonly:gb,ref:Qr,registerRuntimeCompiler:GV,render:Ow,renderList:Gf,renderSlot:VF,resolveComponent:Z_,resolveDirective:NF,resolveDynamicComponent:vd,resolveFilter:r2,resolveTransitionHooks:km,setBlockTracking:Sw,setDevtoolsHook:QV,setTransitionHooks:Bd,shallowReactive:RT,shallowReadonly:hF,shallowRef:ok,ssrContextKey:Gk,ssrUtils:t2,stop:q5,toDisplayString:Ii,toHandlerKey:P_,toHandlers:UF,toRaw:Ki,toRef:xF,toRefs:yF,toValue:mF,transformVNodeArgs:FV,triggerRef:pF,unref:Ws,useAttrs:YF,useCssModule:R2,useCssVars:f2,useModel:IV,useSSRContext:qk,useSlots:XF,useTransitionState:LT,vModelCheckbox:ZT,vModelDynamic:EO,vModelRadio:KT,vModelSelect:wy,vModelText:fs,vShow:_O,version:hO,warn:XV,watch:ll,watchEffect:EV,watchPostEffect:Hk,watchSyncEffect:Wk,withAsyncContext:tV,withCtx:sl,withDefaults:KF,withDirectives:ds,withKeys:IO,withMemo:KV,withModifiers:zf,withScopeId:MF},Symbol.toStringTag,{value:"Module"}));/*!
  * vue-router v4.4.3
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const hm=typeof document<"u";function q2(t){return t.__esModule||t[Symbol.toStringTag]==="Module"}const wo=Object.assign;function R1(t,e){const r={};for(const s in e){const h=e[s];r[s]=Bc(h)?h.map(t):t(h)}return r}const L_=()=>{},Bc=Array.isArray,DO=/#/g,H2=/&/g,W2=/\//g,Z2=/=/g,K2=/\?/g,LO=/\+/g,X2=/%5B/g,Y2=/%5D/g,BO=/%5E/g,J2=/%60/g,zO=/%7B/g,Q2=/%7C/g,NO=/%7D/g,e6=/%20/g;function XT(t){return encodeURI(""+t).replace(Q2,"|").replace(X2,"[").replace(Y2,"]")}function t6(t){return XT(t).replace(zO,"{").replace(NO,"}").replace(BO,"^")}function Dw(t){return XT(t).replace(LO,"%2B").replace(e6,"+").replace(DO,"%23").replace(H2,"%26").replace(J2,"`").replace(zO,"{").replace(NO,"}").replace(BO,"^")}function r6(t){return Dw(t).replace(Z2,"%3D")}function n6(t){return XT(t).replace(DO,"%23").replace(K2,"%3F")}function i6(t){return t==null?"":n6(t).replace(W2,"%2F")}function Y_(t){try{return decodeURIComponent(""+t)}catch{}return""+t}const o6=/\/$/,s6=t=>t.replace(o6,"");function P1(t,e,r="/"){let s,h={},p="",b="";const E=e.indexOf("#");let o=e.indexOf("?");return E<o&&E>=0&&(o=-1),o>-1&&(s=e.slice(0,o),p=e.slice(o+1,E>-1?E:e.length),h=t(p)),E>-1&&(s=s||e.slice(0,E),b=e.slice(E,e.length)),s=u6(s??e,r),{fullPath:s+(p&&"?")+p+b,path:s,query:h,hash:Y_(b)}}function a6(t,e){const r=e.query?t(e.query):"";return e.path+(r&&"?")+r+(e.hash||"")}function uR(t,e){return!e||!t.toLowerCase().startsWith(e.toLowerCase())?t:t.slice(e.length)||"/"}function l6(t,e,r){const s=e.matched.length-1,h=r.matched.length-1;return s>-1&&s===h&&Lm(e.matched[s],r.matched[h])&&FO(e.params,r.params)&&t(e.query)===t(r.query)&&e.hash===r.hash}function Lm(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function FO(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const r in t)if(!c6(t[r],e[r]))return!1;return!0}function c6(t,e){return Bc(t)?hR(t,e):Bc(e)?hR(e,t):t===e}function hR(t,e){return Bc(e)?t.length===e.length&&t.every((r,s)=>r===e[s]):t.length===1&&t[0]===e}function u6(t,e){if(t.startsWith("/"))return t;if(!t)return e;const r=e.split("/"),s=t.split("/"),h=s[s.length-1];(h===".."||h===".")&&s.push("");let p=r.length-1,b,E;for(b=0;b<s.length;b++)if(E=s[b],E!==".")if(E==="..")p>1&&p--;else break;return r.slice(0,p).join("/")+"/"+s.slice(b).join("/")}const ud={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var J_;(function(t){t.pop="pop",t.push="push"})(J_||(J_={}));var B_;(function(t){t.back="back",t.forward="forward",t.unknown=""})(B_||(B_={}));function h6(t){if(!t)if(hm){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return t[0]!=="/"&&t[0]!=="#"&&(t="/"+t),s6(t)}const d6=/^[^#]+#/;function f6(t,e){return t.replace(d6,"#")+e}function p6(t,e){const r=document.documentElement.getBoundingClientRect(),s=t.getBoundingClientRect();return{behavior:e.behavior,left:s.left-r.left-(e.left||0),top:s.top-r.top-(e.top||0)}}const Sb=()=>({left:window.scrollX,top:window.scrollY});function m6(t){let e;if("el"in t){const r=t.el,s=typeof r=="string"&&r.startsWith("#"),h=typeof r=="string"?s?document.getElementById(r.slice(1)):document.querySelector(r):r;if(!h)return;e=p6(h,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function dR(t,e){return(history.state?history.state.position-e:-1)+t}const Lw=new Map;function g6(t,e){Lw.set(t,e)}function _6(t){const e=Lw.get(t);return Lw.delete(t),e}let y6=()=>location.protocol+"//"+location.host;function VO(t,e){const{pathname:r,search:s,hash:h}=e,p=t.indexOf("#");if(p>-1){let E=h.includes(t.slice(p))?t.slice(p).length:1,o=h.slice(E);return o[0]!=="/"&&(o="/"+o),uR(o,"")}return uR(r,t)+s+h}function v6(t,e,r,s){let h=[],p=[],b=null;const E=({state:H})=>{const Y=VO(t,location),Q=r.value,ge=e.value;let ye=0;if(H){if(r.value=Y,e.value=H,b&&b===Q){b=null;return}ye=ge?H.position-ge.position:0}else s(Y);h.forEach(ke=>{ke(r.value,Q,{delta:ye,type:J_.pop,direction:ye?ye>0?B_.forward:B_.back:B_.unknown})})};function o(){b=r.value}function O(H){h.push(H);const Y=()=>{const Q=h.indexOf(H);Q>-1&&h.splice(Q,1)};return p.push(Y),Y}function z(){const{history:H}=window;H.state&&H.replaceState(wo({},H.state,{scroll:Sb()}),"")}function U(){for(const H of p)H();p=[],window.removeEventListener("popstate",E),window.removeEventListener("beforeunload",z)}return window.addEventListener("popstate",E),window.addEventListener("beforeunload",z,{passive:!0}),{pauseListeners:o,listen:O,destroy:U}}function fR(t,e,r,s=!1,h=!1){return{back:t,current:e,forward:r,replaced:s,position:window.history.length,scroll:h?Sb():null}}function b6(t){const{history:e,location:r}=window,s={value:VO(t,r)},h={value:e.state};h.value||p(s.value,{back:null,current:s.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function p(o,O,z){const U=t.indexOf("#"),H=U>-1?(r.host&&document.querySelector("base")?t:t.slice(U))+o:y6()+t+o;try{e[z?"replaceState":"pushState"](O,"",H),h.value=O}catch(Y){console.error(Y),r[z?"replace":"assign"](H)}}function b(o,O){const z=wo({},e.state,fR(h.value.back,o,h.value.forward,!0),O,{position:h.value.position});p(o,z,!0),s.value=o}function E(o,O){const z=wo({},h.value,e.state,{forward:o,scroll:Sb()});p(z.current,z,!0);const U=wo({},fR(s.value,o,null),{position:z.position+1},O);p(o,U,!1),s.value=o}return{location:s,state:h,push:E,replace:b}}function x6(t){t=h6(t);const e=b6(t),r=v6(t,e.state,e.location,e.replace);function s(p,b=!0){b||r.pauseListeners(),history.go(p)}const h=wo({location:"",base:t,go:s,createHref:f6.bind(null,t)},e,r);return Object.defineProperty(h,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(h,"state",{enumerable:!0,get:()=>e.state.value}),h}function w6(t){return typeof t=="string"||t&&typeof t=="object"}function UO(t){return typeof t=="string"||typeof t=="symbol"}const jO=Symbol("");var pR;(function(t){t[t.aborted=4]="aborted",t[t.cancelled=8]="cancelled",t[t.duplicated=16]="duplicated"})(pR||(pR={}));function Bm(t,e){return wo(new Error,{type:t,[jO]:!0},e)}function Xu(t,e){return t instanceof Error&&jO in t&&(e==null||!!(t.type&e))}const mR="[^/]+?",T6={sensitive:!1,strict:!1,start:!0,end:!0},E6=/[.+*?^${}()[\]/\\]/g;function S6(t,e){const r=wo({},T6,e),s=[];let h=r.start?"^":"";const p=[];for(const O of t){const z=O.length?[]:[90];r.strict&&!O.length&&(h+="/");for(let U=0;U<O.length;U++){const H=O[U];let Y=40+(r.sensitive?.25:0);if(H.type===0)U||(h+="/"),h+=H.value.replace(E6,"\\$&"),Y+=40;else if(H.type===1){const{value:Q,repeatable:ge,optional:ye,regexp:ke}=H;p.push({name:Q,repeatable:ge,optional:ye});const he=ke||mR;if(he!==mR){Y+=10;try{new RegExp(`(${he})`)}catch(ve){throw new Error(`Invalid custom RegExp for param "${Q}" (${he}): `+ve.message)}}let oe=ge?`((?:${he})(?:/(?:${he}))*)`:`(${he})`;U||(oe=ye&&O.length<2?`(?:/${oe})`:"/"+oe),ye&&(oe+="?"),h+=oe,Y+=20,ye&&(Y+=-8),ge&&(Y+=-20),he===".*"&&(Y+=-50)}z.push(Y)}s.push(z)}if(r.strict&&r.end){const O=s.length-1;s[O][s[O].length-1]+=.7000000000000001}r.strict||(h+="/?"),r.end?h+="$":r.strict&&(h+="(?:/|$)");const b=new RegExp(h,r.sensitive?"":"i");function E(O){const z=O.match(b),U={};if(!z)return null;for(let H=1;H<z.length;H++){const Y=z[H]||"",Q=p[H-1];U[Q.name]=Y&&Q.repeatable?Y.split("/"):Y}return U}function o(O){let z="",U=!1;for(const H of t){(!U||!z.endsWith("/"))&&(z+="/"),U=!1;for(const Y of H)if(Y.type===0)z+=Y.value;else if(Y.type===1){const{value:Q,repeatable:ge,optional:ye}=Y,ke=Q in O?O[Q]:"";if(Bc(ke)&&!ge)throw new Error(`Provided param "${Q}" is an array but it is not repeatable (* or + modifiers)`);const he=Bc(ke)?ke.join("/"):ke;if(!he)if(ye)H.length<2&&(z.endsWith("/")?z=z.slice(0,-1):U=!0);else throw new Error(`Missing required param "${Q}"`);z+=he}}return z||"/"}return{re:b,score:s,keys:p,parse:E,stringify:o}}function I6(t,e){let r=0;for(;r<t.length&&r<e.length;){const s=e[r]-t[r];if(s)return s;r++}return t.length<e.length?t.length===1&&t[0]===80?-1:1:t.length>e.length?e.length===1&&e[0]===80?1:-1:0}function $O(t,e){let r=0;const s=t.score,h=e.score;for(;r<s.length&&r<h.length;){const p=I6(s[r],h[r]);if(p)return p;r++}if(Math.abs(h.length-s.length)===1){if(gR(s))return 1;if(gR(h))return-1}return h.length-s.length}function gR(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const A6={type:0,value:""},C6=/[a-zA-Z0-9_]/;function R6(t){if(!t)return[[]];if(t==="/")return[[A6]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(Y){throw new Error(`ERR (${r})/"${O}": ${Y}`)}let r=0,s=r;const h=[];let p;function b(){p&&h.push(p),p=[]}let E=0,o,O="",z="";function U(){O&&(r===0?p.push({type:0,value:O}):r===1||r===2||r===3?(p.length>1&&(o==="*"||o==="+")&&e(`A repeatable param (${O}) must be alone in its segment. eg: '/:ids+.`),p.push({type:1,value:O,regexp:z,repeatable:o==="*"||o==="+",optional:o==="*"||o==="?"})):e("Invalid state to consume buffer"),O="")}function H(){O+=o}for(;E<t.length;){if(o=t[E++],o==="\\"&&r!==2){s=r,r=4;continue}switch(r){case 0:o==="/"?(O&&U(),b()):o===":"?(U(),r=1):H();break;case 4:H(),r=s;break;case 1:o==="("?r=2:C6.test(o)?H():(U(),r=0,o!=="*"&&o!=="?"&&o!=="+"&&E--);break;case 2:o===")"?z[z.length-1]=="\\"?z=z.slice(0,-1)+o:r=3:z+=o;break;case 3:U(),r=0,o!=="*"&&o!=="?"&&o!=="+"&&E--,z="";break;default:e("Unknown state");break}}return r===2&&e(`Unfinished custom RegExp for param "${O}"`),U(),b(),h}function P6(t,e,r){const s=S6(R6(t.path),r),h=wo(s,{record:t,parent:e,children:[],alias:[]});return e&&!h.record.aliasOf==!e.record.aliasOf&&e.children.push(h),h}function M6(t,e){const r=[],s=new Map;e=vR({strict:!1,end:!0,sensitive:!1},e);function h(U){return s.get(U)}function p(U,H,Y){const Q=!Y,ge=k6(U);ge.aliasOf=Y&&Y.record;const ye=vR(e,U),ke=[ge];if("alias"in U){const ve=typeof U.alias=="string"?[U.alias]:U.alias;for(const be of ve)ke.push(wo({},ge,{components:Y?Y.record.components:ge.components,path:be,aliasOf:Y?Y.record:ge}))}let he,oe;for(const ve of ke){const{path:be}=ve;if(H&&be[0]!=="/"){const ze=H.record.path,Te=ze[ze.length-1]==="/"?"":"/";ve.path=H.record.path+(be&&Te+be)}if(he=P6(ve,H,ye),Y?Y.alias.push(he):(oe=oe||he,oe!==he&&oe.alias.push(he),Q&&U.name&&!yR(he)&&b(U.name)),GO(he)&&o(he),ge.children){const ze=ge.children;for(let Te=0;Te<ze.length;Te++)p(ze[Te],he,Y&&Y.children[Te])}Y=Y||he}return oe?()=>{b(oe)}:L_}function b(U){if(UO(U)){const H=s.get(U);H&&(s.delete(U),r.splice(r.indexOf(H),1),H.children.forEach(b),H.alias.forEach(b))}else{const H=r.indexOf(U);H>-1&&(r.splice(H,1),U.record.name&&s.delete(U.record.name),U.children.forEach(b),U.alias.forEach(b))}}function E(){return r}function o(U){const H=L6(U,r);r.splice(H,0,U),U.record.name&&!yR(U)&&s.set(U.record.name,U)}function O(U,H){let Y,Q={},ge,ye;if("name"in U&&U.name){if(Y=s.get(U.name),!Y)throw Bm(1,{location:U});ye=Y.record.name,Q=wo(_R(H.params,Y.keys.filter(oe=>!oe.optional).concat(Y.parent?Y.parent.keys.filter(oe=>oe.optional):[]).map(oe=>oe.name)),U.params&&_R(U.params,Y.keys.map(oe=>oe.name))),ge=Y.stringify(Q)}else if(U.path!=null)ge=U.path,Y=r.find(oe=>oe.re.test(ge)),Y&&(Q=Y.parse(ge),ye=Y.record.name);else{if(Y=H.name?s.get(H.name):r.find(oe=>oe.re.test(H.path)),!Y)throw Bm(1,{location:U,currentLocation:H});ye=Y.record.name,Q=wo({},H.params,U.params),ge=Y.stringify(Q)}const ke=[];let he=Y;for(;he;)ke.unshift(he.record),he=he.parent;return{name:ye,path:ge,params:Q,matched:ke,meta:D6(ke)}}t.forEach(U=>p(U));function z(){r.length=0,s.clear()}return{addRoute:p,resolve:O,removeRoute:b,clearRoutes:z,getRoutes:E,getRecordMatcher:h}}function _R(t,e){const r={};for(const s of e)s in t&&(r[s]=t[s]);return r}function k6(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:O6(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function O6(t){const e={},r=t.props||!1;if("component"in t)e.default=r;else for(const s in t.components)e[s]=typeof r=="object"?r[s]:r;return e}function yR(t){for(;t;){if(t.record.aliasOf)return!0;t=t.parent}return!1}function D6(t){return t.reduce((e,r)=>wo(e,r.meta),{})}function vR(t,e){const r={};for(const s in t)r[s]=s in e?e[s]:t[s];return r}function L6(t,e){let r=0,s=e.length;for(;r!==s;){const p=r+s>>1;$O(t,e[p])<0?s=p:r=p+1}const h=B6(t);return h&&(s=e.lastIndexOf(h,s-1)),s}function B6(t){let e=t;for(;e=e.parent;)if(GO(e)&&$O(t,e)===0)return e}function GO({record:t}){return!!(t.name||t.components&&Object.keys(t.components).length||t.redirect)}function z6(t){const e={};if(t===""||t==="?")return e;const s=(t[0]==="?"?t.slice(1):t).split("&");for(let h=0;h<s.length;++h){const p=s[h].replace(LO," "),b=p.indexOf("="),E=Y_(b<0?p:p.slice(0,b)),o=b<0?null:Y_(p.slice(b+1));if(E in e){let O=e[E];Bc(O)||(O=e[E]=[O]),O.push(o)}else e[E]=o}return e}function bR(t){let e="";for(let r in t){const s=t[r];if(r=r6(r),s==null){s!==void 0&&(e+=(e.length?"&":"")+r);continue}(Bc(s)?s.map(p=>p&&Dw(p)):[s&&Dw(s)]).forEach(p=>{p!==void 0&&(e+=(e.length?"&":"")+r,p!=null&&(e+="="+p))})}return e}function N6(t){const e={};for(const r in t){const s=t[r];s!==void 0&&(e[r]=Bc(s)?s.map(h=>h==null?null:""+h):s==null?s:""+s)}return e}const F6=Symbol(""),xR=Symbol(""),Ib=Symbol(""),qO=Symbol(""),Bw=Symbol("");function m_(){let t=[];function e(s){return t.push(s),()=>{const h=t.indexOf(s);h>-1&&t.splice(h,1)}}function r(){t=[]}return{add:e,list:()=>t.slice(),reset:r}}function yd(t,e,r,s,h,p=b=>b()){const b=s&&(s.enterCallbacks[h]=s.enterCallbacks[h]||[]);return()=>new Promise((E,o)=>{const O=H=>{H===!1?o(Bm(4,{from:r,to:e})):H instanceof Error?o(H):w6(H)?o(Bm(2,{from:e,to:H})):(b&&s.enterCallbacks[h]===b&&typeof H=="function"&&b.push(H),E())},z=p(()=>t.call(s&&s.instances[h],e,r,O));let U=Promise.resolve(z);t.length<3&&(U=U.then(O)),U.catch(H=>o(H))})}function M1(t,e,r,s,h=p=>p()){const p=[];for(const b of t)for(const E in b.components){let o=b.components[E];if(!(e!=="beforeRouteEnter"&&!b.instances[E]))if(V6(o)){const z=(o.__vccOpts||o)[e];z&&p.push(yd(z,r,s,b,E,h))}else{let O=o();p.push(()=>O.then(z=>{if(!z)return Promise.reject(new Error(`Couldn't resolve component "${E}" at "${b.path}"`));const U=q2(z)?z.default:z;b.components[E]=U;const Y=(U.__vccOpts||U)[e];return Y&&yd(Y,r,s,b,E,h)()}))}}return p}function V6(t){return typeof t=="object"||"displayName"in t||"props"in t||"__vccOpts"in t}function wR(t){const e=Lc(Ib),r=Lc(qO),s=Ds(()=>{const o=Ws(t.to);return e.resolve(o)}),h=Ds(()=>{const{matched:o}=s.value,{length:O}=o,z=o[O-1],U=r.matched;if(!z||!U.length)return-1;const H=U.findIndex(Lm.bind(null,z));if(H>-1)return H;const Y=TR(o[O-2]);return O>1&&TR(z)===Y&&U[U.length-1].path!==Y?U.findIndex(Lm.bind(null,o[O-2])):H}),p=Ds(()=>h.value>-1&&G6(r.params,s.value.params)),b=Ds(()=>h.value>-1&&h.value===r.matched.length-1&&FO(r.params,s.value.params));function E(o={}){return $6(o)?e[Ws(t.replace)?"replace":"push"](Ws(t.to)).catch(L_):Promise.resolve()}return{route:s,href:Ds(()=>s.value.href),isActive:p,isExactActive:b,navigate:E}}const U6=Wd({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:wR,setup(t,{slots:e}){const r=Dd(wR(t)),{options:s}=Lc(Ib),h=Ds(()=>({[ER(t.activeClass,s.linkActiveClass,"router-link-active")]:r.isActive,[ER(t.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:r.isExactActive}));return()=>{const p=e.default&&e.default(r);return t.custom?p:ja("a",{"aria-current":r.isExactActive?t.ariaCurrentValue:null,href:r.href,onClick:r.navigate,class:h.value},p)}}}),j6=U6;function $6(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&!(t.button!==void 0&&t.button!==0)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function G6(t,e){for(const r in e){const s=e[r],h=t[r];if(typeof s=="string"){if(s!==h)return!1}else if(!Bc(h)||h.length!==s.length||s.some((p,b)=>p!==h[b]))return!1}return!0}function TR(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const ER=(t,e,r)=>t??e??r,q6=Wd({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:r}){const s=Lc(Bw),h=Ds(()=>t.route||s.value),p=Lc(xR,0),b=Ds(()=>{let O=Ws(p);const{matched:z}=h.value;let U;for(;(U=z[O])&&!U.components;)O++;return O}),E=Ds(()=>h.value.matched[b.value]);Hf(xR,Ds(()=>b.value+1)),Hf(F6,E),Hf(Bw,h);const o=Qr();return ll(()=>[o.value,E.value,t.name],([O,z,U],[H,Y,Q])=>{z&&(z.instances[U]=O,Y&&Y!==z&&O&&O===H&&(z.leaveGuards.size||(z.leaveGuards=Y.leaveGuards),z.updateGuards.size||(z.updateGuards=Y.updateGuards))),O&&z&&(!Y||!Lm(z,Y)||!H)&&(z.enterCallbacks[U]||[]).forEach(ge=>ge(O))},{flush:"post"}),()=>{const O=h.value,z=t.name,U=E.value,H=U&&U.components[z];if(!H)return SR(r.default,{Component:H,route:O});const Y=U.props[z],Q=Y?Y===!0?O.params:typeof Y=="function"?Y(O):Y:null,ye=ja(H,wo({},Q,e,{onVnodeUnmounted:ke=>{ke.component.isUnmounted&&(U.instances[z]=null)},ref:o}));return SR(r.default,{Component:ye,route:O})||ye}}});function SR(t,e){if(!t)return null;const r=t(e);return r.length===1?r[0]:r}const H6=q6;function W6(t){const e=M6(t.routes,t),r=t.parseQuery||z6,s=t.stringifyQuery||bR,h=t.history,p=m_(),b=m_(),E=m_(),o=ok(ud);let O=ud;hm&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const z=R1.bind(null,vt=>""+vt),U=R1.bind(null,i6),H=R1.bind(null,Y_);function Y(vt,Pt){let Ot,lr;return UO(vt)?(Ot=e.getRecordMatcher(vt),lr=Pt):lr=vt,e.addRoute(lr,Ot)}function Q(vt){const Pt=e.getRecordMatcher(vt);Pt&&e.removeRoute(Pt)}function ge(){return e.getRoutes().map(vt=>vt.record)}function ye(vt){return!!e.getRecordMatcher(vt)}function ke(vt,Pt){if(Pt=wo({},Pt||o.value),typeof vt=="string"){const $e=P1(r,vt,Pt.path),We=e.resolve({path:$e.path},Pt),zt=h.createHref($e.fullPath);return wo($e,We,{params:H(We.params),hash:Y_($e.hash),redirectedFrom:void 0,href:zt})}let Ot;if(vt.path!=null)Ot=wo({},vt,{path:P1(r,vt.path,Pt.path).path});else{const $e=wo({},vt.params);for(const We in $e)$e[We]==null&&delete $e[We];Ot=wo({},vt,{params:U($e)}),Pt.params=U(Pt.params)}const lr=e.resolve(Ot,Pt),Se=vt.hash||"";lr.params=z(H(lr.params));const Kt=a6(s,wo({},vt,{hash:t6(Se),path:lr.path})),Fe=h.createHref(Kt);return wo({fullPath:Kt,hash:Se,query:s===bR?N6(vt.query):vt.query||{}},lr,{redirectedFrom:void 0,href:Fe})}function he(vt){return typeof vt=="string"?P1(r,vt,o.value.path):wo({},vt)}function oe(vt,Pt){if(O!==vt)return Bm(8,{from:Pt,to:vt})}function ve(vt){return Te(vt)}function be(vt){return ve(wo(he(vt),{replace:!0}))}function ze(vt){const Pt=vt.matched[vt.matched.length-1];if(Pt&&Pt.redirect){const{redirect:Ot}=Pt;let lr=typeof Ot=="function"?Ot(vt):Ot;return typeof lr=="string"&&(lr=lr.includes("?")||lr.includes("#")?lr=he(lr):{path:lr},lr.params={}),wo({query:vt.query,hash:vt.hash,params:lr.path!=null?{}:vt.params},lr)}}function Te(vt,Pt){const Ot=O=ke(vt),lr=o.value,Se=vt.state,Kt=vt.force,Fe=vt.replace===!0,$e=ze(Ot);if($e)return Te(wo(he($e),{state:typeof $e=="object"?wo({},Se,$e.state):Se,force:Kt,replace:Fe}),Pt||Ot);const We=Ot;We.redirectedFrom=Pt;let zt;return!Kt&&l6(s,lr,Ot)&&(zt=Bm(16,{to:We,from:lr}),jr(lr,lr,!0,!1)),(zt?Promise.resolve(zt):te(We,lr)).catch($t=>Xu($t)?Xu($t,2)?$t:gt($t):or($t,We,lr)).then($t=>{if($t){if(Xu($t,2))return Te(wo({replace:Fe},he($t.to),{state:typeof $t.to=="object"?wo({},Se,$t.to.state):Se,force:Kt}),Pt||We)}else $t=me(We,lr,!0,Fe,Se);return re(We,lr,$t),$t})}function ie(vt,Pt){const Ot=oe(vt,Pt);return Ot?Promise.reject(Ot):Promise.resolve()}function ne(vt){const Pt=pr.values().next().value;return Pt&&typeof Pt.runWithContext=="function"?Pt.runWithContext(vt):vt()}function te(vt,Pt){let Ot;const[lr,Se,Kt]=Z6(vt,Pt);Ot=M1(lr.reverse(),"beforeRouteLeave",vt,Pt);for(const $e of lr)$e.leaveGuards.forEach(We=>{Ot.push(yd(We,vt,Pt))});const Fe=ie.bind(null,vt,Pt);return Ot.push(Fe),ar(Ot).then(()=>{Ot=[];for(const $e of p.list())Ot.push(yd($e,vt,Pt));return Ot.push(Fe),ar(Ot)}).then(()=>{Ot=M1(Se,"beforeRouteUpdate",vt,Pt);for(const $e of Se)$e.updateGuards.forEach(We=>{Ot.push(yd(We,vt,Pt))});return Ot.push(Fe),ar(Ot)}).then(()=>{Ot=[];for(const $e of Kt)if($e.beforeEnter)if(Bc($e.beforeEnter))for(const We of $e.beforeEnter)Ot.push(yd(We,vt,Pt));else Ot.push(yd($e.beforeEnter,vt,Pt));return Ot.push(Fe),ar(Ot)}).then(()=>(vt.matched.forEach($e=>$e.enterCallbacks={}),Ot=M1(Kt,"beforeRouteEnter",vt,Pt,ne),Ot.push(Fe),ar(Ot))).then(()=>{Ot=[];for(const $e of b.list())Ot.push(yd($e,vt,Pt));return Ot.push(Fe),ar(Ot)}).catch($e=>Xu($e,8)?$e:Promise.reject($e))}function re(vt,Pt,Ot){E.list().forEach(lr=>ne(()=>lr(vt,Pt,Ot)))}function me(vt,Pt,Ot,lr,Se){const Kt=oe(vt,Pt);if(Kt)return Kt;const Fe=Pt===ud,$e=hm?history.state:{};Ot&&(lr||Fe?h.replace(vt.fullPath,wo({scroll:Fe&&$e&&$e.scroll},Se)):h.push(vt.fullPath,Se)),o.value=vt,jr(vt,Pt,Ot,Fe),gt()}let we;function tt(){we||(we=h.listen((vt,Pt,Ot)=>{if(!Dt.listening)return;const lr=ke(vt),Se=ze(lr);if(Se){Te(wo(Se,{replace:!0}),lr).catch(L_);return}O=lr;const Kt=o.value;hm&&g6(dR(Kt.fullPath,Ot.delta),Sb()),te(lr,Kt).catch(Fe=>Xu(Fe,12)?Fe:Xu(Fe,2)?(Te(Fe.to,lr).then($e=>{Xu($e,20)&&!Ot.delta&&Ot.type===J_.pop&&h.go(-1,!1)}).catch(L_),Promise.reject()):(Ot.delta&&h.go(-Ot.delta,!1),or(Fe,lr,Kt))).then(Fe=>{Fe=Fe||me(lr,Kt,!1),Fe&&(Ot.delta&&!Xu(Fe,8)?h.go(-Ot.delta,!1):Ot.type===J_.pop&&Xu(Fe,20)&&h.go(-1,!1)),re(lr,Kt,Fe)}).catch(L_)}))}let Et=m_(),ft=m_(),rr;function or(vt,Pt,Ot){gt(vt);const lr=ft.list();return lr.length?lr.forEach(Se=>Se(vt,Pt,Ot)):console.error(vt),Promise.reject(vt)}function Fr(){return rr&&o.value!==ud?Promise.resolve():new Promise((vt,Pt)=>{Et.add([vt,Pt])})}function gt(vt){return rr||(rr=!vt,tt(),Et.list().forEach(([Pt,Ot])=>vt?Ot(vt):Pt()),Et.reset()),vt}function jr(vt,Pt,Ot,lr){const{scrollBehavior:Se}=t;if(!hm||!Se)return Promise.resolve();const Kt=!Ot&&_6(dR(vt.fullPath,0))||(lr||!Ot)&&history.state&&history.state.scroll||null;return up().then(()=>Se(vt,Pt,Kt)).then(Fe=>Fe&&m6(Fe)).catch(Fe=>or(Fe,vt,Pt))}const Ur=vt=>h.go(vt);let Xr;const pr=new Set,Dt={currentRoute:o,listening:!0,addRoute:Y,removeRoute:Q,clearRoutes:e.clearRoutes,hasRoute:ye,getRoutes:ge,resolve:ke,options:t,push:ve,replace:be,go:Ur,back:()=>Ur(-1),forward:()=>Ur(1),beforeEach:p.add,beforeResolve:b.add,afterEach:E.add,onError:ft.add,isReady:Fr,install(vt){const Pt=this;vt.component("RouterLink",j6),vt.component("RouterView",H6),vt.config.globalProperties.$router=Pt,Object.defineProperty(vt.config.globalProperties,"$route",{enumerable:!0,get:()=>Ws(o)}),hm&&!Xr&&o.value===ud&&(Xr=!0,ve(h.location).catch(Se=>{}));const Ot={};for(const Se in ud)Object.defineProperty(Ot,Se,{get:()=>o.value[Se],enumerable:!0});vt.provide(Ib,Pt),vt.provide(qO,RT(Ot)),vt.provide(Bw,o);const lr=vt.unmount;pr.add(vt),vt.unmount=function(){pr.delete(vt),pr.size<1&&(O=ud,we&&we(),we=null,o.value=ud,Xr=!1,rr=!1),lr()}}};function ar(vt){return vt.reduce((Pt,Ot)=>Pt.then(()=>ne(Ot)),Promise.resolve())}return Dt}function Z6(t,e){const r=[],s=[],h=[],p=Math.max(e.matched.length,t.matched.length);for(let b=0;b<p;b++){const E=e.matched[b];E&&(t.matched.find(O=>Lm(O,E))?s.push(E):r.push(E));const o=t.matched[b];o&&(e.matched.find(O=>Lm(O,o))||h.push(o))}return[r,s,h]}function K6(){return Lc(Ib)}const X6="/FIT5032-SoulClam/assets/p1-D7SlsjVK.jpeg",Y6="/FIT5032-SoulClam/assets/p2-DpJIa_Us.jpeg",J6="/FIT5032-SoulClam/assets/p3-CVoWYlep.jpeg";function IR(t){return t!==null&&typeof t=="object"&&"constructor"in t&&t.constructor===Object}function YT(t,e){t===void 0&&(t={}),e===void 0&&(e={}),Object.keys(e).forEach(r=>{typeof t[r]>"u"?t[r]=e[r]:IR(e[r])&&IR(t[r])&&Object.keys(e[r]).length>0&&YT(t[r],e[r])})}const HO={body:{},addEventListener(){},removeEventListener(){},activeElement:{blur(){},nodeName:""},querySelector(){return null},querySelectorAll(){return[]},getElementById(){return null},createEvent(){return{initEvent(){}}},createElement(){return{children:[],childNodes:[],style:{},setAttribute(){},getElementsByTagName(){return[]}}},createElementNS(){return{}},importNode(){return null},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""}};function Xm(){const t=typeof document<"u"?document:{};return YT(t,HO),t}const Q6={document:HO,navigator:{userAgent:""},location:{hash:"",host:"",hostname:"",href:"",origin:"",pathname:"",protocol:"",search:""},history:{replaceState(){},pushState(){},go(){},back(){}},CustomEvent:function(){return this},addEventListener(){},removeEventListener(){},getComputedStyle(){return{getPropertyValue(){return""}}},Image(){},Date(){},screen:{},setTimeout(){},clearTimeout(){},matchMedia(){return{}},requestAnimationFrame(t){return typeof setTimeout>"u"?(t(),null):setTimeout(t,0)},cancelAnimationFrame(t){typeof setTimeout>"u"||clearTimeout(t)}};function Gl(){const t=typeof window<"u"?window:{};return YT(t,Q6),t}function eU(t){return t===void 0&&(t=""),t.trim().split(" ").filter(e=>!!e.trim())}function tU(t){const e=t;Object.keys(e).forEach(r=>{try{e[r]=null}catch{}try{delete e[r]}catch{}})}function zw(t,e){return e===void 0&&(e=0),setTimeout(t,e)}function z0(){return Date.now()}function rU(t){const e=Gl();let r;return e.getComputedStyle&&(r=e.getComputedStyle(t,null)),!r&&t.currentStyle&&(r=t.currentStyle),r||(r=t.style),r}function nU(t,e){e===void 0&&(e="x");const r=Gl();let s,h,p;const b=rU(t);return r.WebKitCSSMatrix?(h=b.transform||b.webkitTransform,h.split(",").length>6&&(h=h.split(", ").map(E=>E.replace(",",".")).join(", ")),p=new r.WebKitCSSMatrix(h==="none"?"":h)):(p=b.MozTransform||b.OTransform||b.MsTransform||b.msTransform||b.transform||b.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),s=p.toString().split(",")),e==="x"&&(r.WebKitCSSMatrix?h=p.m41:s.length===16?h=parseFloat(s[12]):h=parseFloat(s[4])),e==="y"&&(r.WebKitCSSMatrix?h=p.m42:s.length===16?h=parseFloat(s[13]):h=parseFloat(s[5])),h||0}function Qv(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"}function iU(t){return typeof window<"u"&&typeof window.HTMLElement<"u"?t instanceof HTMLElement:t&&(t.nodeType===1||t.nodeType===11)}function Vl(){const t=Object(arguments.length<=0?void 0:arguments[0]),e=["__proto__","constructor","prototype"];for(let r=1;r<arguments.length;r+=1){const s=r<0||arguments.length<=r?void 0:arguments[r];if(s!=null&&!iU(s)){const h=Object.keys(Object(s)).filter(p=>e.indexOf(p)<0);for(let p=0,b=h.length;p<b;p+=1){const E=h[p],o=Object.getOwnPropertyDescriptor(s,E);o!==void 0&&o.enumerable&&(Qv(t[E])&&Qv(s[E])?s[E].__swiper__?t[E]=s[E]:Vl(t[E],s[E]):!Qv(t[E])&&Qv(s[E])?(t[E]={},s[E].__swiper__?t[E]=s[E]:Vl(t[E],s[E])):t[E]=s[E])}}}return t}function e0(t,e,r){t.style.setProperty(e,r)}function WO(t){let{swiper:e,targetPosition:r,side:s}=t;const h=Gl(),p=-e.translate;let b=null,E;const o=e.params.speed;e.wrapperEl.style.scrollSnapType="none",h.cancelAnimationFrame(e.cssModeFrameID);const O=r>p?"next":"prev",z=(H,Y)=>O==="next"&&H>=Y||O==="prev"&&H<=Y,U=()=>{E=new Date().getTime(),b===null&&(b=E);const H=Math.max(Math.min((E-b)/o,1),0),Y=.5-Math.cos(H*Math.PI)/2;let Q=p+Y*(r-p);if(z(Q,r)&&(Q=r),e.wrapperEl.scrollTo({[s]:Q}),z(Q,r)){e.wrapperEl.style.overflow="hidden",e.wrapperEl.style.scrollSnapType="",setTimeout(()=>{e.wrapperEl.style.overflow="",e.wrapperEl.scrollTo({[s]:Q})}),h.cancelAnimationFrame(e.cssModeFrameID);return}e.cssModeFrameID=h.requestAnimationFrame(U)};U()}function nh(t,e){e===void 0&&(e="");const r=[...t.children];return t instanceof HTMLSlotElement&&r.push(...t.assignedElements()),e?r.filter(s=>s.matches(e)):r}function oU(t,e){const r=e.contains(t);return!r&&e instanceof HTMLSlotElement?[...e.assignedElements()].includes(t):r}function N0(t){try{console.warn(t);return}catch{}}function Nw(t,e){e===void 0&&(e=[]);const r=document.createElement(t);return r.classList.add(...Array.isArray(e)?e:eU(e)),r}function sU(t,e){const r=[];for(;t.previousElementSibling;){const s=t.previousElementSibling;e?s.matches(e)&&r.push(s):r.push(s),t=s}return r}function aU(t,e){const r=[];for(;t.nextElementSibling;){const s=t.nextElementSibling;e?s.matches(e)&&r.push(s):r.push(s),t=s}return r}function Sd(t,e){return Gl().getComputedStyle(t,null).getPropertyValue(e)}function AR(t){let e=t,r;if(e){for(r=0;(e=e.previousSibling)!==null;)e.nodeType===1&&(r+=1);return r}}function lU(t,e){const r=[];let s=t.parentElement;for(;s;)r.push(s),s=s.parentElement;return r}function CR(t,e,r){const s=Gl();return t[e==="width"?"offsetWidth":"offsetHeight"]+parseFloat(s.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-right":"margin-top"))+parseFloat(s.getComputedStyle(t,null).getPropertyValue(e==="width"?"margin-left":"margin-bottom"))}let k1;function cU(){const t=Gl(),e=Xm();return{smoothScroll:e.documentElement&&e.documentElement.style&&"scrollBehavior"in e.documentElement.style,touch:!!("ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch)}}function ZO(){return k1||(k1=cU()),k1}let O1;function uU(t){let{userAgent:e}=t===void 0?{}:t;const r=ZO(),s=Gl(),h=s.navigator.platform,p=e||s.navigator.userAgent,b={ios:!1,android:!1},E=s.screen.width,o=s.screen.height,O=p.match(/(Android);?[\s\/]+([\d.]+)?/);let z=p.match(/(iPad).*OS\s([\d_]+)/);const U=p.match(/(iPod)(.*OS\s([\d_]+))?/),H=!z&&p.match(/(iPhone\sOS|iOS)\s([\d_]+)/),Y=h==="Win32";let Q=h==="MacIntel";const ge=["1024x1366","1366x1024","834x1194","1194x834","834x1112","1112x834","768x1024","1024x768","820x1180","1180x820","810x1080","1080x810"];return!z&&Q&&r.touch&&ge.indexOf(`${E}x${o}`)>=0&&(z=p.match(/(Version)\/([\d.]+)/),z||(z=[0,1,"13_0_0"]),Q=!1),O&&!Y&&(b.os="android",b.android=!0),(z||H||U)&&(b.os="ios",b.ios=!0),b}function KO(t){return t===void 0&&(t={}),O1||(O1=uU(t)),O1}let D1;function hU(){const t=Gl(),e=KO();let r=!1;function s(){const E=t.navigator.userAgent.toLowerCase();return E.indexOf("safari")>=0&&E.indexOf("chrome")<0&&E.indexOf("android")<0}if(s()){const E=String(t.navigator.userAgent);if(E.includes("Version/")){const[o,O]=E.split("Version/")[1].split(" ")[0].split(".").map(z=>Number(z));r=o<16||o===16&&O<2}}const h=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(t.navigator.userAgent),p=s(),b=p||h&&e.ios;return{isSafari:r||p,needPerspectiveFix:r,need3dFix:b,isWebView:h}}function dU(){return D1||(D1=hU()),D1}function fU(t){let{swiper:e,on:r,emit:s}=t;const h=Gl();let p=null,b=null;const E=()=>{!e||e.destroyed||!e.initialized||(s("beforeResize"),s("resize"))},o=()=>{!e||e.destroyed||!e.initialized||(p=new ResizeObserver(U=>{b=h.requestAnimationFrame(()=>{const{width:H,height:Y}=e;let Q=H,ge=Y;U.forEach(ye=>{let{contentBoxSize:ke,contentRect:he,target:oe}=ye;oe&&oe!==e.el||(Q=he?he.width:(ke[0]||ke).inlineSize,ge=he?he.height:(ke[0]||ke).blockSize)}),(Q!==H||ge!==Y)&&E()})}),p.observe(e.el))},O=()=>{b&&h.cancelAnimationFrame(b),p&&p.unobserve&&e.el&&(p.unobserve(e.el),p=null)},z=()=>{!e||e.destroyed||!e.initialized||s("orientationchange")};r("init",()=>{if(e.params.resizeObserver&&typeof h.ResizeObserver<"u"){o();return}h.addEventListener("resize",E),h.addEventListener("orientationchange",z)}),r("destroy",()=>{O(),h.removeEventListener("resize",E),h.removeEventListener("orientationchange",z)})}function pU(t){let{swiper:e,extendParams:r,on:s,emit:h}=t;const p=[],b=Gl(),E=function(z,U){U===void 0&&(U={});const H=b.MutationObserver||b.WebkitMutationObserver,Y=new H(Q=>{if(e.__preventObserver__)return;if(Q.length===1){h("observerUpdate",Q[0]);return}const ge=function(){h("observerUpdate",Q[0])};b.requestAnimationFrame?b.requestAnimationFrame(ge):b.setTimeout(ge,0)});Y.observe(z,{attributes:typeof U.attributes>"u"?!0:U.attributes,childList:e.isElement||(typeof U.childList>"u"?!0:U).childList,characterData:typeof U.characterData>"u"?!0:U.characterData}),p.push(Y)},o=()=>{if(e.params.observer){if(e.params.observeParents){const z=lU(e.hostEl);for(let U=0;U<z.length;U+=1)E(z[U])}E(e.hostEl,{childList:e.params.observeSlideChildren}),E(e.wrapperEl,{attributes:!1})}},O=()=>{p.forEach(z=>{z.disconnect()}),p.splice(0,p.length)};r({observer:!1,observeParents:!1,observeSlideChildren:!1}),s("init",o),s("destroy",O)}var mU={on(t,e,r){const s=this;if(!s.eventsListeners||s.destroyed||typeof e!="function")return s;const h=r?"unshift":"push";return t.split(" ").forEach(p=>{s.eventsListeners[p]||(s.eventsListeners[p]=[]),s.eventsListeners[p][h](e)}),s},once(t,e,r){const s=this;if(!s.eventsListeners||s.destroyed||typeof e!="function")return s;function h(){s.off(t,h),h.__emitterProxy&&delete h.__emitterProxy;for(var p=arguments.length,b=new Array(p),E=0;E<p;E++)b[E]=arguments[E];e.apply(s,b)}return h.__emitterProxy=e,s.on(t,h,r)},onAny(t,e){const r=this;if(!r.eventsListeners||r.destroyed||typeof t!="function")return r;const s=e?"unshift":"push";return r.eventsAnyListeners.indexOf(t)<0&&r.eventsAnyListeners[s](t),r},offAny(t){const e=this;if(!e.eventsListeners||e.destroyed||!e.eventsAnyListeners)return e;const r=e.eventsAnyListeners.indexOf(t);return r>=0&&e.eventsAnyListeners.splice(r,1),e},off(t,e){const r=this;return!r.eventsListeners||r.destroyed||!r.eventsListeners||t.split(" ").forEach(s=>{typeof e>"u"?r.eventsListeners[s]=[]:r.eventsListeners[s]&&r.eventsListeners[s].forEach((h,p)=>{(h===e||h.__emitterProxy&&h.__emitterProxy===e)&&r.eventsListeners[s].splice(p,1)})}),r},emit(){const t=this;if(!t.eventsListeners||t.destroyed||!t.eventsListeners)return t;let e,r,s;for(var h=arguments.length,p=new Array(h),b=0;b<h;b++)p[b]=arguments[b];return typeof p[0]=="string"||Array.isArray(p[0])?(e=p[0],r=p.slice(1,p.length),s=t):(e=p[0].events,r=p[0].data,s=p[0].context||t),r.unshift(s),(Array.isArray(e)?e:e.split(" ")).forEach(o=>{t.eventsAnyListeners&&t.eventsAnyListeners.length&&t.eventsAnyListeners.forEach(O=>{O.apply(s,[o,...r])}),t.eventsListeners&&t.eventsListeners[o]&&t.eventsListeners[o].forEach(O=>{O.apply(s,r)})}),t}};function gU(){const t=this;let e,r;const s=t.el;typeof t.params.width<"u"&&t.params.width!==null?e=t.params.width:e=s.clientWidth,typeof t.params.height<"u"&&t.params.height!==null?r=t.params.height:r=s.clientHeight,!(e===0&&t.isHorizontal()||r===0&&t.isVertical())&&(e=e-parseInt(Sd(s,"padding-left")||0,10)-parseInt(Sd(s,"padding-right")||0,10),r=r-parseInt(Sd(s,"padding-top")||0,10)-parseInt(Sd(s,"padding-bottom")||0,10),Number.isNaN(e)&&(e=0),Number.isNaN(r)&&(r=0),Object.assign(t,{width:e,height:r,size:t.isHorizontal()?e:r}))}function _U(){const t=this;function e(te,re){return parseFloat(te.getPropertyValue(t.getDirectionLabel(re))||0)}const r=t.params,{wrapperEl:s,slidesEl:h,size:p,rtlTranslate:b,wrongRTL:E}=t,o=t.virtual&&r.virtual.enabled,O=o?t.virtual.slides.length:t.slides.length,z=nh(h,`.${t.params.slideClass}, swiper-slide`),U=o?t.virtual.slides.length:z.length;let H=[];const Y=[],Q=[];let ge=r.slidesOffsetBefore;typeof ge=="function"&&(ge=r.slidesOffsetBefore.call(t));let ye=r.slidesOffsetAfter;typeof ye=="function"&&(ye=r.slidesOffsetAfter.call(t));const ke=t.snapGrid.length,he=t.slidesGrid.length;let oe=r.spaceBetween,ve=-ge,be=0,ze=0;if(typeof p>"u")return;typeof oe=="string"&&oe.indexOf("%")>=0?oe=parseFloat(oe.replace("%",""))/100*p:typeof oe=="string"&&(oe=parseFloat(oe)),t.virtualSize=-oe,z.forEach(te=>{b?te.style.marginLeft="":te.style.marginRight="",te.style.marginBottom="",te.style.marginTop=""}),r.centeredSlides&&r.cssMode&&(e0(s,"--swiper-centered-offset-before",""),e0(s,"--swiper-centered-offset-after",""));const Te=r.grid&&r.grid.rows>1&&t.grid;Te?t.grid.initSlides(z):t.grid&&t.grid.unsetSlides();let ie;const ne=r.slidesPerView==="auto"&&r.breakpoints&&Object.keys(r.breakpoints).filter(te=>typeof r.breakpoints[te].slidesPerView<"u").length>0;for(let te=0;te<U;te+=1){ie=0;let re;if(z[te]&&(re=z[te]),Te&&t.grid.updateSlide(te,re,z),!(z[te]&&Sd(re,"display")==="none")){if(r.slidesPerView==="auto"){ne&&(z[te].style[t.getDirectionLabel("width")]="");const me=getComputedStyle(re),we=re.style.transform,tt=re.style.webkitTransform;if(we&&(re.style.transform="none"),tt&&(re.style.webkitTransform="none"),r.roundLengths)ie=t.isHorizontal()?CR(re,"width"):CR(re,"height");else{const Et=e(me,"width"),ft=e(me,"padding-left"),rr=e(me,"padding-right"),or=e(me,"margin-left"),Fr=e(me,"margin-right"),gt=me.getPropertyValue("box-sizing");if(gt&&gt==="border-box")ie=Et+or+Fr;else{const{clientWidth:jr,offsetWidth:Ur}=re;ie=Et+ft+rr+or+Fr+(Ur-jr)}}we&&(re.style.transform=we),tt&&(re.style.webkitTransform=tt),r.roundLengths&&(ie=Math.floor(ie))}else ie=(p-(r.slidesPerView-1)*oe)/r.slidesPerView,r.roundLengths&&(ie=Math.floor(ie)),z[te]&&(z[te].style[t.getDirectionLabel("width")]=`${ie}px`);z[te]&&(z[te].swiperSlideSize=ie),Q.push(ie),r.centeredSlides?(ve=ve+ie/2+be/2+oe,be===0&&te!==0&&(ve=ve-p/2-oe),te===0&&(ve=ve-p/2-oe),Math.abs(ve)<1/1e3&&(ve=0),r.roundLengths&&(ve=Math.floor(ve)),ze%r.slidesPerGroup===0&&H.push(ve),Y.push(ve)):(r.roundLengths&&(ve=Math.floor(ve)),(ze-Math.min(t.params.slidesPerGroupSkip,ze))%t.params.slidesPerGroup===0&&H.push(ve),Y.push(ve),ve=ve+ie+oe),t.virtualSize+=ie+oe,be=ie,ze+=1}}if(t.virtualSize=Math.max(t.virtualSize,p)+ye,b&&E&&(r.effect==="slide"||r.effect==="coverflow")&&(s.style.width=`${t.virtualSize+oe}px`),r.setWrapperSize&&(s.style[t.getDirectionLabel("width")]=`${t.virtualSize+oe}px`),Te&&t.grid.updateWrapperSize(ie,H),!r.centeredSlides){const te=[];for(let re=0;re<H.length;re+=1){let me=H[re];r.roundLengths&&(me=Math.floor(me)),H[re]<=t.virtualSize-p&&te.push(me)}H=te,Math.floor(t.virtualSize-p)-Math.floor(H[H.length-1])>1&&H.push(t.virtualSize-p)}if(o&&r.loop){const te=Q[0]+oe;if(r.slidesPerGroup>1){const re=Math.ceil((t.virtual.slidesBefore+t.virtual.slidesAfter)/r.slidesPerGroup),me=te*r.slidesPerGroup;for(let we=0;we<re;we+=1)H.push(H[H.length-1]+me)}for(let re=0;re<t.virtual.slidesBefore+t.virtual.slidesAfter;re+=1)r.slidesPerGroup===1&&H.push(H[H.length-1]+te),Y.push(Y[Y.length-1]+te),t.virtualSize+=te}if(H.length===0&&(H=[0]),oe!==0){const te=t.isHorizontal()&&b?"marginLeft":t.getDirectionLabel("marginRight");z.filter((re,me)=>!r.cssMode||r.loop?!0:me!==z.length-1).forEach(re=>{re.style[te]=`${oe}px`})}if(r.centeredSlides&&r.centeredSlidesBounds){let te=0;Q.forEach(me=>{te+=me+(oe||0)}),te-=oe;const re=te>p?te-p:0;H=H.map(me=>me<=0?-ge:me>re?re+ye:me)}if(r.centerInsufficientSlides){let te=0;Q.forEach(me=>{te+=me+(oe||0)}),te-=oe;const re=(r.slidesOffsetBefore||0)+(r.slidesOffsetAfter||0);if(te+re<p){const me=(p-te-re)/2;H.forEach((we,tt)=>{H[tt]=we-me}),Y.forEach((we,tt)=>{Y[tt]=we+me})}}if(Object.assign(t,{slides:z,snapGrid:H,slidesGrid:Y,slidesSizesGrid:Q}),r.centeredSlides&&r.cssMode&&!r.centeredSlidesBounds){e0(s,"--swiper-centered-offset-before",`${-H[0]}px`),e0(s,"--swiper-centered-offset-after",`${t.size/2-Q[Q.length-1]/2}px`);const te=-t.snapGrid[0],re=-t.slidesGrid[0];t.snapGrid=t.snapGrid.map(me=>me+te),t.slidesGrid=t.slidesGrid.map(me=>me+re)}if(U!==O&&t.emit("slidesLengthChange"),H.length!==ke&&(t.params.watchOverflow&&t.checkOverflow(),t.emit("snapGridLengthChange")),Y.length!==he&&t.emit("slidesGridLengthChange"),r.watchSlidesProgress&&t.updateSlidesOffset(),t.emit("slidesUpdated"),!o&&!r.cssMode&&(r.effect==="slide"||r.effect==="fade")){const te=`${r.containerModifierClass}backface-hidden`,re=t.el.classList.contains(te);U<=r.maxBackfaceHiddenSlides?re||t.el.classList.add(te):re&&t.el.classList.remove(te)}}function yU(t){const e=this,r=[],s=e.virtual&&e.params.virtual.enabled;let h=0,p;typeof t=="number"?e.setTransition(t):t===!0&&e.setTransition(e.params.speed);const b=E=>s?e.slides[e.getSlideIndexByData(E)]:e.slides[E];if(e.params.slidesPerView!=="auto"&&e.params.slidesPerView>1)if(e.params.centeredSlides)(e.visibleSlides||[]).forEach(E=>{r.push(E)});else for(p=0;p<Math.ceil(e.params.slidesPerView);p+=1){const E=e.activeIndex+p;if(E>e.slides.length&&!s)break;r.push(b(E))}else r.push(b(e.activeIndex));for(p=0;p<r.length;p+=1)if(typeof r[p]<"u"){const E=r[p].offsetHeight;h=E>h?E:h}(h||h===0)&&(e.wrapperEl.style.height=`${h}px`)}function vU(){const t=this,e=t.slides,r=t.isElement?t.isHorizontal()?t.wrapperEl.offsetLeft:t.wrapperEl.offsetTop:0;for(let s=0;s<e.length;s+=1)e[s].swiperSlideOffset=(t.isHorizontal()?e[s].offsetLeft:e[s].offsetTop)-r-t.cssOverflowAdjustment()}const RR=(t,e,r)=>{e&&!t.classList.contains(r)?t.classList.add(r):!e&&t.classList.contains(r)&&t.classList.remove(r)};function bU(t){t===void 0&&(t=this&&this.translate||0);const e=this,r=e.params,{slides:s,rtlTranslate:h,snapGrid:p}=e;if(s.length===0)return;typeof s[0].swiperSlideOffset>"u"&&e.updateSlidesOffset();let b=-t;h&&(b=t),e.visibleSlidesIndexes=[],e.visibleSlides=[];let E=r.spaceBetween;typeof E=="string"&&E.indexOf("%")>=0?E=parseFloat(E.replace("%",""))/100*e.size:typeof E=="string"&&(E=parseFloat(E));for(let o=0;o<s.length;o+=1){const O=s[o];let z=O.swiperSlideOffset;r.cssMode&&r.centeredSlides&&(z-=s[0].swiperSlideOffset);const U=(b+(r.centeredSlides?e.minTranslate():0)-z)/(O.swiperSlideSize+E),H=(b-p[0]+(r.centeredSlides?e.minTranslate():0)-z)/(O.swiperSlideSize+E),Y=-(b-z),Q=Y+e.slidesSizesGrid[o],ge=Y>=0&&Y<=e.size-e.slidesSizesGrid[o],ye=Y>=0&&Y<e.size-1||Q>1&&Q<=e.size||Y<=0&&Q>=e.size;ye&&(e.visibleSlides.push(O),e.visibleSlidesIndexes.push(o)),RR(O,ye,r.slideVisibleClass),RR(O,ge,r.slideFullyVisibleClass),O.progress=h?-U:U,O.originalProgress=h?-H:H}}function xU(t){const e=this;if(typeof t>"u"){const z=e.rtlTranslate?-1:1;t=e&&e.translate&&e.translate*z||0}const r=e.params,s=e.maxTranslate()-e.minTranslate();let{progress:h,isBeginning:p,isEnd:b,progressLoop:E}=e;const o=p,O=b;if(s===0)h=0,p=!0,b=!0;else{h=(t-e.minTranslate())/s;const z=Math.abs(t-e.minTranslate())<1,U=Math.abs(t-e.maxTranslate())<1;p=z||h<=0,b=U||h>=1,z&&(h=0),U&&(h=1)}if(r.loop){const z=e.getSlideIndexByData(0),U=e.getSlideIndexByData(e.slides.length-1),H=e.slidesGrid[z],Y=e.slidesGrid[U],Q=e.slidesGrid[e.slidesGrid.length-1],ge=Math.abs(t);ge>=H?E=(ge-H)/Q:E=(ge+Q-Y)/Q,E>1&&(E-=1)}Object.assign(e,{progress:h,progressLoop:E,isBeginning:p,isEnd:b}),(r.watchSlidesProgress||r.centeredSlides&&r.autoHeight)&&e.updateSlidesProgress(t),p&&!o&&e.emit("reachBeginning toEdge"),b&&!O&&e.emit("reachEnd toEdge"),(o&&!p||O&&!b)&&e.emit("fromEdge"),e.emit("progress",h)}const L1=(t,e,r)=>{e&&!t.classList.contains(r)?t.classList.add(r):!e&&t.classList.contains(r)&&t.classList.remove(r)};function wU(){const t=this,{slides:e,params:r,slidesEl:s,activeIndex:h}=t,p=t.virtual&&r.virtual.enabled,b=t.grid&&r.grid&&r.grid.rows>1,E=U=>nh(s,`.${r.slideClass}${U}, swiper-slide${U}`)[0];let o,O,z;if(p)if(r.loop){let U=h-t.virtual.slidesBefore;U<0&&(U=t.virtual.slides.length+U),U>=t.virtual.slides.length&&(U-=t.virtual.slides.length),o=E(`[data-swiper-slide-index="${U}"]`)}else o=E(`[data-swiper-slide-index="${h}"]`);else b?(o=e.filter(U=>U.column===h)[0],z=e.filter(U=>U.column===h+1)[0],O=e.filter(U=>U.column===h-1)[0]):o=e[h];o&&(b||(z=aU(o,`.${r.slideClass}, swiper-slide`)[0],r.loop&&!z&&(z=e[0]),O=sU(o,`.${r.slideClass}, swiper-slide`)[0],r.loop&&!O===0&&(O=e[e.length-1]))),e.forEach(U=>{L1(U,U===o,r.slideActiveClass),L1(U,U===z,r.slideNextClass),L1(U,U===O,r.slidePrevClass)}),t.emitSlidesClasses()}const d0=(t,e)=>{if(!t||t.destroyed||!t.params)return;const r=()=>t.isElement?"swiper-slide":`.${t.params.slideClass}`,s=e.closest(r());if(s){let h=s.querySelector(`.${t.params.lazyPreloaderClass}`);!h&&t.isElement&&(s.shadowRoot?h=s.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`):requestAnimationFrame(()=>{s.shadowRoot&&(h=s.shadowRoot.querySelector(`.${t.params.lazyPreloaderClass}`),h&&h.remove())})),h&&h.remove()}},B1=(t,e)=>{if(!t.slides[e])return;const r=t.slides[e].querySelector('[loading="lazy"]');r&&r.removeAttribute("loading")},Fw=t=>{if(!t||t.destroyed||!t.params)return;let e=t.params.lazyPreloadPrevNext;const r=t.slides.length;if(!r||!e||e<0)return;e=Math.min(e,r);const s=t.params.slidesPerView==="auto"?t.slidesPerViewDynamic():Math.ceil(t.params.slidesPerView),h=t.activeIndex;if(t.params.grid&&t.params.grid.rows>1){const b=h,E=[b-e];E.push(...Array.from({length:e}).map((o,O)=>b+s+O)),t.slides.forEach((o,O)=>{E.includes(o.column)&&B1(t,O)});return}const p=h+s-1;if(t.params.rewind||t.params.loop)for(let b=h-e;b<=p+e;b+=1){const E=(b%r+r)%r;(E<h||E>p)&&B1(t,E)}else for(let b=Math.max(h-e,0);b<=Math.min(p+e,r-1);b+=1)b!==h&&(b>p||b<h)&&B1(t,b)};function TU(t){const{slidesGrid:e,params:r}=t,s=t.rtlTranslate?t.translate:-t.translate;let h;for(let p=0;p<e.length;p+=1)typeof e[p+1]<"u"?s>=e[p]&&s<e[p+1]-(e[p+1]-e[p])/2?h=p:s>=e[p]&&s<e[p+1]&&(h=p+1):s>=e[p]&&(h=p);return r.normalizeSlideIndex&&(h<0||typeof h>"u")&&(h=0),h}function EU(t){const e=this,r=e.rtlTranslate?e.translate:-e.translate,{snapGrid:s,params:h,activeIndex:p,realIndex:b,snapIndex:E}=e;let o=t,O;const z=Y=>{let Q=Y-e.virtual.slidesBefore;return Q<0&&(Q=e.virtual.slides.length+Q),Q>=e.virtual.slides.length&&(Q-=e.virtual.slides.length),Q};if(typeof o>"u"&&(o=TU(e)),s.indexOf(r)>=0)O=s.indexOf(r);else{const Y=Math.min(h.slidesPerGroupSkip,o);O=Y+Math.floor((o-Y)/h.slidesPerGroup)}if(O>=s.length&&(O=s.length-1),o===p&&!e.params.loop){O!==E&&(e.snapIndex=O,e.emit("snapIndexChange"));return}if(o===p&&e.params.loop&&e.virtual&&e.params.virtual.enabled){e.realIndex=z(o);return}const U=e.grid&&h.grid&&h.grid.rows>1;let H;if(e.virtual&&h.virtual.enabled&&h.loop)H=z(o);else if(U){const Y=e.slides.filter(ge=>ge.column===o)[0];let Q=parseInt(Y.getAttribute("data-swiper-slide-index"),10);Number.isNaN(Q)&&(Q=Math.max(e.slides.indexOf(Y),0)),H=Math.floor(Q/h.grid.rows)}else if(e.slides[o]){const Y=e.slides[o].getAttribute("data-swiper-slide-index");Y?H=parseInt(Y,10):H=o}else H=o;Object.assign(e,{previousSnapIndex:E,snapIndex:O,previousRealIndex:b,realIndex:H,previousIndex:p,activeIndex:o}),e.initialized&&Fw(e),e.emit("activeIndexChange"),e.emit("snapIndexChange"),(e.initialized||e.params.runCallbacksOnInit)&&(b!==H&&e.emit("realIndexChange"),e.emit("slideChange"))}function SU(t,e){const r=this,s=r.params;let h=t.closest(`.${s.slideClass}, swiper-slide`);!h&&r.isElement&&e&&e.length>1&&e.includes(t)&&[...e.slice(e.indexOf(t)+1,e.length)].forEach(E=>{!h&&E.matches&&E.matches(`.${s.slideClass}, swiper-slide`)&&(h=E)});let p=!1,b;if(h){for(let E=0;E<r.slides.length;E+=1)if(r.slides[E]===h){p=!0,b=E;break}}if(h&&p)r.clickedSlide=h,r.virtual&&r.params.virtual.enabled?r.clickedIndex=parseInt(h.getAttribute("data-swiper-slide-index"),10):r.clickedIndex=b;else{r.clickedSlide=void 0,r.clickedIndex=void 0;return}s.slideToClickedSlide&&r.clickedIndex!==void 0&&r.clickedIndex!==r.activeIndex&&r.slideToClickedSlide()}var IU={updateSize:gU,updateSlides:_U,updateAutoHeight:yU,updateSlidesOffset:vU,updateSlidesProgress:bU,updateProgress:xU,updateSlidesClasses:wU,updateActiveIndex:EU,updateClickedSlide:SU};function AU(t){t===void 0&&(t=this.isHorizontal()?"x":"y");const e=this,{params:r,rtlTranslate:s,translate:h,wrapperEl:p}=e;if(r.virtualTranslate)return s?-h:h;if(r.cssMode)return h;let b=nU(p,t);return b+=e.cssOverflowAdjustment(),s&&(b=-b),b||0}function CU(t,e){const r=this,{rtlTranslate:s,params:h,wrapperEl:p,progress:b}=r;let E=0,o=0;const O=0;r.isHorizontal()?E=s?-t:t:o=t,h.roundLengths&&(E=Math.floor(E),o=Math.floor(o)),r.previousTranslate=r.translate,r.translate=r.isHorizontal()?E:o,h.cssMode?p[r.isHorizontal()?"scrollLeft":"scrollTop"]=r.isHorizontal()?-E:-o:h.virtualTranslate||(r.isHorizontal()?E-=r.cssOverflowAdjustment():o-=r.cssOverflowAdjustment(),p.style.transform=`translate3d(${E}px, ${o}px, ${O}px)`);let z;const U=r.maxTranslate()-r.minTranslate();U===0?z=0:z=(t-r.minTranslate())/U,z!==b&&r.updateProgress(t),r.emit("setTranslate",r.translate,e)}function RU(){return-this.snapGrid[0]}function PU(){return-this.snapGrid[this.snapGrid.length-1]}function MU(t,e,r,s,h){t===void 0&&(t=0),e===void 0&&(e=this.params.speed),r===void 0&&(r=!0),s===void 0&&(s=!0);const p=this,{params:b,wrapperEl:E}=p;if(p.animating&&b.preventInteractionOnTransition)return!1;const o=p.minTranslate(),O=p.maxTranslate();let z;if(s&&t>o?z=o:s&&t<O?z=O:z=t,p.updateProgress(z),b.cssMode){const U=p.isHorizontal();if(e===0)E[U?"scrollLeft":"scrollTop"]=-z;else{if(!p.support.smoothScroll)return WO({swiper:p,targetPosition:-z,side:U?"left":"top"}),!0;E.scrollTo({[U?"left":"top"]:-z,behavior:"smooth"})}return!0}return e===0?(p.setTransition(0),p.setTranslate(z),r&&(p.emit("beforeTransitionStart",e,h),p.emit("transitionEnd"))):(p.setTransition(e),p.setTranslate(z),r&&(p.emit("beforeTransitionStart",e,h),p.emit("transitionStart")),p.animating||(p.animating=!0,p.onTranslateToWrapperTransitionEnd||(p.onTranslateToWrapperTransitionEnd=function(H){!p||p.destroyed||H.target===this&&(p.wrapperEl.removeEventListener("transitionend",p.onTranslateToWrapperTransitionEnd),p.onTranslateToWrapperTransitionEnd=null,delete p.onTranslateToWrapperTransitionEnd,p.animating=!1,r&&p.emit("transitionEnd"))}),p.wrapperEl.addEventListener("transitionend",p.onTranslateToWrapperTransitionEnd))),!0}var kU={getTranslate:AU,setTranslate:CU,minTranslate:RU,maxTranslate:PU,translateTo:MU};function OU(t,e){const r=this;r.params.cssMode||(r.wrapperEl.style.transitionDuration=`${t}ms`,r.wrapperEl.style.transitionDelay=t===0?"0ms":""),r.emit("setTransition",t,e)}function XO(t){let{swiper:e,runCallbacks:r,direction:s,step:h}=t;const{activeIndex:p,previousIndex:b}=e;let E=s;if(E||(p>b?E="next":p<b?E="prev":E="reset"),e.emit(`transition${h}`),r&&p!==b){if(E==="reset"){e.emit(`slideResetTransition${h}`);return}e.emit(`slideChangeTransition${h}`),E==="next"?e.emit(`slideNextTransition${h}`):e.emit(`slidePrevTransition${h}`)}}function DU(t,e){t===void 0&&(t=!0);const r=this,{params:s}=r;s.cssMode||(s.autoHeight&&r.updateAutoHeight(),XO({swiper:r,runCallbacks:t,direction:e,step:"Start"}))}function LU(t,e){t===void 0&&(t=!0);const r=this,{params:s}=r;r.animating=!1,!s.cssMode&&(r.setTransition(0),XO({swiper:r,runCallbacks:t,direction:e,step:"End"}))}var BU={setTransition:OU,transitionStart:DU,transitionEnd:LU};function zU(t,e,r,s,h){t===void 0&&(t=0),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const p=this;let b=t;b<0&&(b=0);const{params:E,snapGrid:o,slidesGrid:O,previousIndex:z,activeIndex:U,rtlTranslate:H,wrapperEl:Y,enabled:Q}=p;if(!Q&&!s&&!h||p.destroyed||p.animating&&E.preventInteractionOnTransition)return!1;typeof e>"u"&&(e=p.params.speed);const ge=Math.min(p.params.slidesPerGroupSkip,b);let ye=ge+Math.floor((b-ge)/p.params.slidesPerGroup);ye>=o.length&&(ye=o.length-1);const ke=-o[ye];if(E.normalizeSlideIndex)for(let be=0;be<O.length;be+=1){const ze=-Math.floor(ke*100),Te=Math.floor(O[be]*100),ie=Math.floor(O[be+1]*100);typeof O[be+1]<"u"?ze>=Te&&ze<ie-(ie-Te)/2?b=be:ze>=Te&&ze<ie&&(b=be+1):ze>=Te&&(b=be)}if(p.initialized&&b!==U&&(!p.allowSlideNext&&(H?ke>p.translate&&ke>p.minTranslate():ke<p.translate&&ke<p.minTranslate())||!p.allowSlidePrev&&ke>p.translate&&ke>p.maxTranslate()&&(U||0)!==b))return!1;b!==(z||0)&&r&&p.emit("beforeSlideChangeStart"),p.updateProgress(ke);let he;b>U?he="next":b<U?he="prev":he="reset";const oe=p.virtual&&p.params.virtual.enabled;if(!(oe&&h)&&(H&&-ke===p.translate||!H&&ke===p.translate))return p.updateActiveIndex(b),E.autoHeight&&p.updateAutoHeight(),p.updateSlidesClasses(),E.effect!=="slide"&&p.setTranslate(ke),he!=="reset"&&(p.transitionStart(r,he),p.transitionEnd(r,he)),!1;if(E.cssMode){const be=p.isHorizontal(),ze=H?ke:-ke;if(e===0)oe&&(p.wrapperEl.style.scrollSnapType="none",p._immediateVirtual=!0),oe&&!p._cssModeVirtualInitialSet&&p.params.initialSlide>0?(p._cssModeVirtualInitialSet=!0,requestAnimationFrame(()=>{Y[be?"scrollLeft":"scrollTop"]=ze})):Y[be?"scrollLeft":"scrollTop"]=ze,oe&&requestAnimationFrame(()=>{p.wrapperEl.style.scrollSnapType="",p._immediateVirtual=!1});else{if(!p.support.smoothScroll)return WO({swiper:p,targetPosition:ze,side:be?"left":"top"}),!0;Y.scrollTo({[be?"left":"top"]:ze,behavior:"smooth"})}return!0}return p.setTransition(e),p.setTranslate(ke),p.updateActiveIndex(b),p.updateSlidesClasses(),p.emit("beforeTransitionStart",e,s),p.transitionStart(r,he),e===0?p.transitionEnd(r,he):p.animating||(p.animating=!0,p.onSlideToWrapperTransitionEnd||(p.onSlideToWrapperTransitionEnd=function(ze){!p||p.destroyed||ze.target===this&&(p.wrapperEl.removeEventListener("transitionend",p.onSlideToWrapperTransitionEnd),p.onSlideToWrapperTransitionEnd=null,delete p.onSlideToWrapperTransitionEnd,p.transitionEnd(r,he))}),p.wrapperEl.addEventListener("transitionend",p.onSlideToWrapperTransitionEnd)),!0}function NU(t,e,r,s){t===void 0&&(t=0),r===void 0&&(r=!0),typeof t=="string"&&(t=parseInt(t,10));const h=this;if(h.destroyed)return;typeof e>"u"&&(e=h.params.speed);const p=h.grid&&h.params.grid&&h.params.grid.rows>1;let b=t;if(h.params.loop)if(h.virtual&&h.params.virtual.enabled)b=b+h.virtual.slidesBefore;else{let E;if(p){const H=b*h.params.grid.rows;E=h.slides.filter(Y=>Y.getAttribute("data-swiper-slide-index")*1===H)[0].column}else E=h.getSlideIndexByData(b);const o=p?Math.ceil(h.slides.length/h.params.grid.rows):h.slides.length,{centeredSlides:O}=h.params;let z=h.params.slidesPerView;z==="auto"?z=h.slidesPerViewDynamic():(z=Math.ceil(parseFloat(h.params.slidesPerView,10)),O&&z%2===0&&(z=z+1));let U=o-E<z;if(O&&(U=U||E<Math.ceil(z/2)),s&&O&&h.params.slidesPerView!=="auto"&&!p&&(U=!1),U){const H=O?E<h.activeIndex?"prev":"next":E-h.activeIndex-1<h.params.slidesPerView?"next":"prev";h.loopFix({direction:H,slideTo:!0,activeSlideIndex:H==="next"?E+1:E-o+1,slideRealIndex:H==="next"?h.realIndex:void 0})}if(p){const H=b*h.params.grid.rows;b=h.slides.filter(Y=>Y.getAttribute("data-swiper-slide-index")*1===H)[0].column}else b=h.getSlideIndexByData(b)}return requestAnimationFrame(()=>{h.slideTo(b,e,r,s)}),h}function FU(t,e,r){e===void 0&&(e=!0);const s=this,{enabled:h,params:p,animating:b}=s;if(!h||s.destroyed)return s;typeof t>"u"&&(t=s.params.speed);let E=p.slidesPerGroup;p.slidesPerView==="auto"&&p.slidesPerGroup===1&&p.slidesPerGroupAuto&&(E=Math.max(s.slidesPerViewDynamic("current",!0),1));const o=s.activeIndex<p.slidesPerGroupSkip?1:E,O=s.virtual&&p.virtual.enabled;if(p.loop){if(b&&!O&&p.loopPreventsSliding)return!1;if(s.loopFix({direction:"next"}),s._clientLeft=s.wrapperEl.clientLeft,s.activeIndex===s.slides.length-1&&p.cssMode)return requestAnimationFrame(()=>{s.slideTo(s.activeIndex+o,t,e,r)}),!0}return p.rewind&&s.isEnd?s.slideTo(0,t,e,r):s.slideTo(s.activeIndex+o,t,e,r)}function VU(t,e,r){e===void 0&&(e=!0);const s=this,{params:h,snapGrid:p,slidesGrid:b,rtlTranslate:E,enabled:o,animating:O}=s;if(!o||s.destroyed)return s;typeof t>"u"&&(t=s.params.speed);const z=s.virtual&&h.virtual.enabled;if(h.loop){if(O&&!z&&h.loopPreventsSliding)return!1;s.loopFix({direction:"prev"}),s._clientLeft=s.wrapperEl.clientLeft}const U=E?s.translate:-s.translate;function H(ke){return ke<0?-Math.floor(Math.abs(ke)):Math.floor(ke)}const Y=H(U),Q=p.map(ke=>H(ke));let ge=p[Q.indexOf(Y)-1];if(typeof ge>"u"&&h.cssMode){let ke;p.forEach((he,oe)=>{Y>=he&&(ke=oe)}),typeof ke<"u"&&(ge=p[ke>0?ke-1:ke])}let ye=0;if(typeof ge<"u"&&(ye=b.indexOf(ge),ye<0&&(ye=s.activeIndex-1),h.slidesPerView==="auto"&&h.slidesPerGroup===1&&h.slidesPerGroupAuto&&(ye=ye-s.slidesPerViewDynamic("previous",!0)+1,ye=Math.max(ye,0))),h.rewind&&s.isBeginning){const ke=s.params.virtual&&s.params.virtual.enabled&&s.virtual?s.virtual.slides.length-1:s.slides.length-1;return s.slideTo(ke,t,e,r)}else if(h.loop&&s.activeIndex===0&&h.cssMode)return requestAnimationFrame(()=>{s.slideTo(ye,t,e,r)}),!0;return s.slideTo(ye,t,e,r)}function UU(t,e,r){e===void 0&&(e=!0);const s=this;if(!s.destroyed)return typeof t>"u"&&(t=s.params.speed),s.slideTo(s.activeIndex,t,e,r)}function jU(t,e,r,s){e===void 0&&(e=!0),s===void 0&&(s=.5);const h=this;if(h.destroyed)return;typeof t>"u"&&(t=h.params.speed);let p=h.activeIndex;const b=Math.min(h.params.slidesPerGroupSkip,p),E=b+Math.floor((p-b)/h.params.slidesPerGroup),o=h.rtlTranslate?h.translate:-h.translate;if(o>=h.snapGrid[E]){const O=h.snapGrid[E],z=h.snapGrid[E+1];o-O>(z-O)*s&&(p+=h.params.slidesPerGroup)}else{const O=h.snapGrid[E-1],z=h.snapGrid[E];o-O<=(z-O)*s&&(p-=h.params.slidesPerGroup)}return p=Math.max(p,0),p=Math.min(p,h.slidesGrid.length-1),h.slideTo(p,t,e,r)}function $U(){const t=this;if(t.destroyed)return;const{params:e,slidesEl:r}=t,s=e.slidesPerView==="auto"?t.slidesPerViewDynamic():e.slidesPerView;let h=t.clickedIndex,p;const b=t.isElement?"swiper-slide":`.${e.slideClass}`;if(e.loop){if(t.animating)return;p=parseInt(t.clickedSlide.getAttribute("data-swiper-slide-index"),10),e.centeredSlides?h<t.loopedSlides-s/2||h>t.slides.length-t.loopedSlides+s/2?(t.loopFix(),h=t.getSlideIndex(nh(r,`${b}[data-swiper-slide-index="${p}"]`)[0]),zw(()=>{t.slideTo(h)})):t.slideTo(h):h>t.slides.length-s?(t.loopFix(),h=t.getSlideIndex(nh(r,`${b}[data-swiper-slide-index="${p}"]`)[0]),zw(()=>{t.slideTo(h)})):t.slideTo(h)}else t.slideTo(h)}var GU={slideTo:zU,slideToLoop:NU,slideNext:FU,slidePrev:VU,slideReset:UU,slideToClosest:jU,slideToClickedSlide:$U};function qU(t){const e=this,{params:r,slidesEl:s}=e;if(!r.loop||e.virtual&&e.params.virtual.enabled)return;const h=()=>{nh(s,`.${r.slideClass}, swiper-slide`).forEach((U,H)=>{U.setAttribute("data-swiper-slide-index",H)})},p=e.grid&&r.grid&&r.grid.rows>1,b=r.slidesPerGroup*(p?r.grid.rows:1),E=e.slides.length%b!==0,o=p&&e.slides.length%r.grid.rows!==0,O=z=>{for(let U=0;U<z;U+=1){const H=e.isElement?Nw("swiper-slide",[r.slideBlankClass]):Nw("div",[r.slideClass,r.slideBlankClass]);e.slidesEl.append(H)}};if(E){if(r.loopAddBlankSlides){const z=b-e.slides.length%b;O(z),e.recalcSlides(),e.updateSlides()}else N0("Swiper Loop Warning: The number of slides is not even to slidesPerGroup, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");h()}else if(o){if(r.loopAddBlankSlides){const z=r.grid.rows-e.slides.length%r.grid.rows;O(z),e.recalcSlides(),e.updateSlides()}else N0("Swiper Loop Warning: The number of slides is not even to grid.rows, loop mode may not function properly. You need to add more slides (or make duplicates, or empty slides)");h()}else h();e.loopFix({slideRealIndex:t,direction:r.centeredSlides?void 0:"next"})}function HU(t){let{slideRealIndex:e,slideTo:r=!0,direction:s,setTranslate:h,activeSlideIndex:p,byController:b,byMousewheel:E}=t===void 0?{}:t;const o=this;if(!o.params.loop)return;o.emit("beforeLoopFix");const{slides:O,allowSlidePrev:z,allowSlideNext:U,slidesEl:H,params:Y}=o,{centeredSlides:Q}=Y;if(o.allowSlidePrev=!0,o.allowSlideNext=!0,o.virtual&&Y.virtual.enabled){r&&(!Y.centeredSlides&&o.snapIndex===0?o.slideTo(o.virtual.slides.length,0,!1,!0):Y.centeredSlides&&o.snapIndex<Y.slidesPerView?o.slideTo(o.virtual.slides.length+o.snapIndex,0,!1,!0):o.snapIndex===o.snapGrid.length-1&&o.slideTo(o.virtual.slidesBefore,0,!1,!0)),o.allowSlidePrev=z,o.allowSlideNext=U,o.emit("loopFix");return}let ge=Y.slidesPerView;ge==="auto"?ge=o.slidesPerViewDynamic():(ge=Math.ceil(parseFloat(Y.slidesPerView,10)),Q&&ge%2===0&&(ge=ge+1));const ye=Y.slidesPerGroupAuto?ge:Y.slidesPerGroup;let ke=ye;ke%ye!==0&&(ke+=ye-ke%ye),ke+=Y.loopAdditionalSlides,o.loopedSlides=ke;const he=o.grid&&Y.grid&&Y.grid.rows>1;O.length<ge+ke?N0("Swiper Loop Warning: The number of slides is not enough for loop mode, it will be disabled and not function properly. You need to add more slides (or make duplicates) or lower the values of slidesPerView and slidesPerGroup parameters"):he&&Y.grid.fill==="row"&&N0("Swiper Loop Warning: Loop mode is not compatible with grid.fill = `row`");const oe=[],ve=[];let be=o.activeIndex;typeof p>"u"?p=o.getSlideIndex(O.filter(we=>we.classList.contains(Y.slideActiveClass))[0]):be=p;const ze=s==="next"||!s,Te=s==="prev"||!s;let ie=0,ne=0;const te=he?Math.ceil(O.length/Y.grid.rows):O.length,me=(he?O[p].column:p)+(Q&&typeof h>"u"?-ge/2+.5:0);if(me<ke){ie=Math.max(ke-me,ye);for(let we=0;we<ke-me;we+=1){const tt=we-Math.floor(we/te)*te;if(he){const Et=te-tt-1;for(let ft=O.length-1;ft>=0;ft-=1)O[ft].column===Et&&oe.push(ft)}else oe.push(te-tt-1)}}else if(me+ge>te-ke){ne=Math.max(me-(te-ke*2),ye);for(let we=0;we<ne;we+=1){const tt=we-Math.floor(we/te)*te;he?O.forEach((Et,ft)=>{Et.column===tt&&ve.push(ft)}):ve.push(tt)}}if(o.__preventObserver__=!0,requestAnimationFrame(()=>{o.__preventObserver__=!1}),Te&&oe.forEach(we=>{O[we].swiperLoopMoveDOM=!0,H.prepend(O[we]),O[we].swiperLoopMoveDOM=!1}),ze&&ve.forEach(we=>{O[we].swiperLoopMoveDOM=!0,H.append(O[we]),O[we].swiperLoopMoveDOM=!1}),o.recalcSlides(),Y.slidesPerView==="auto"?o.updateSlides():he&&(oe.length>0&&Te||ve.length>0&&ze)&&o.slides.forEach((we,tt)=>{o.grid.updateSlide(tt,we,o.slides)}),Y.watchSlidesProgress&&o.updateSlidesOffset(),r){if(oe.length>0&&Te){if(typeof e>"u"){const we=o.slidesGrid[be],Et=o.slidesGrid[be+ie]-we;E?o.setTranslate(o.translate-Et):(o.slideTo(be+Math.ceil(ie),0,!1,!0),h&&(o.touchEventsData.startTranslate=o.touchEventsData.startTranslate-Et,o.touchEventsData.currentTranslate=o.touchEventsData.currentTranslate-Et))}else if(h){const we=he?oe.length/Y.grid.rows:oe.length;o.slideTo(o.activeIndex+we,0,!1,!0),o.touchEventsData.currentTranslate=o.translate}}else if(ve.length>0&&ze)if(typeof e>"u"){const we=o.slidesGrid[be],Et=o.slidesGrid[be-ne]-we;E?o.setTranslate(o.translate-Et):(o.slideTo(be-ne,0,!1,!0),h&&(o.touchEventsData.startTranslate=o.touchEventsData.startTranslate-Et,o.touchEventsData.currentTranslate=o.touchEventsData.currentTranslate-Et))}else{const we=he?ve.length/Y.grid.rows:ve.length;o.slideTo(o.activeIndex-we,0,!1,!0)}}if(o.allowSlidePrev=z,o.allowSlideNext=U,o.controller&&o.controller.control&&!b){const we={slideRealIndex:e,direction:s,setTranslate:h,activeSlideIndex:p,byController:!0};Array.isArray(o.controller.control)?o.controller.control.forEach(tt=>{!tt.destroyed&&tt.params.loop&&tt.loopFix({...we,slideTo:tt.params.slidesPerView===Y.slidesPerView?r:!1})}):o.controller.control instanceof o.constructor&&o.controller.control.params.loop&&o.controller.control.loopFix({...we,slideTo:o.controller.control.params.slidesPerView===Y.slidesPerView?r:!1})}o.emit("loopFix")}function WU(){const t=this,{params:e,slidesEl:r}=t;if(!e.loop||t.virtual&&t.params.virtual.enabled)return;t.recalcSlides();const s=[];t.slides.forEach(h=>{const p=typeof h.swiperSlideIndex>"u"?h.getAttribute("data-swiper-slide-index")*1:h.swiperSlideIndex;s[p]=h}),t.slides.forEach(h=>{h.removeAttribute("data-swiper-slide-index")}),s.forEach(h=>{r.append(h)}),t.recalcSlides(),t.slideTo(t.realIndex,0)}var ZU={loopCreate:qU,loopFix:HU,loopDestroy:WU};function KU(t){const e=this;if(!e.params.simulateTouch||e.params.watchOverflow&&e.isLocked||e.params.cssMode)return;const r=e.params.touchEventsTarget==="container"?e.el:e.wrapperEl;e.isElement&&(e.__preventObserver__=!0),r.style.cursor="move",r.style.cursor=t?"grabbing":"grab",e.isElement&&requestAnimationFrame(()=>{e.__preventObserver__=!1})}function XU(){const t=this;t.params.watchOverflow&&t.isLocked||t.params.cssMode||(t.isElement&&(t.__preventObserver__=!0),t[t.params.touchEventsTarget==="container"?"el":"wrapperEl"].style.cursor="",t.isElement&&requestAnimationFrame(()=>{t.__preventObserver__=!1}))}var YU={setGrabCursor:KU,unsetGrabCursor:XU};function JU(t,e){e===void 0&&(e=this);function r(s){if(!s||s===Xm()||s===Gl())return null;s.assignedSlot&&(s=s.assignedSlot);const h=s.closest(t);return!h&&!s.getRootNode?null:h||r(s.getRootNode().host)}return r(e)}function PR(t,e,r){const s=Gl(),{params:h}=t,p=h.edgeSwipeDetection,b=h.edgeSwipeThreshold;return p&&(r<=b||r>=s.innerWidth-b)?p==="prevent"?(e.preventDefault(),!0):!1:!0}function QU(t){const e=this,r=Xm();let s=t;s.originalEvent&&(s=s.originalEvent);const h=e.touchEventsData;if(s.type==="pointerdown"){if(h.pointerId!==null&&h.pointerId!==s.pointerId)return;h.pointerId=s.pointerId}else s.type==="touchstart"&&s.targetTouches.length===1&&(h.touchId=s.targetTouches[0].identifier);if(s.type==="touchstart"){PR(e,s,s.targetTouches[0].pageX);return}const{params:p,touches:b,enabled:E}=e;if(!E||!p.simulateTouch&&s.pointerType==="mouse"||e.animating&&p.preventInteractionOnTransition)return;!e.animating&&p.cssMode&&p.loop&&e.loopFix();let o=s.target;if(p.touchEventsTarget==="wrapper"&&!oU(o,e.wrapperEl)||"which"in s&&s.which===3||"button"in s&&s.button>0||h.isTouched&&h.isMoved)return;const O=!!p.noSwipingClass&&p.noSwipingClass!=="",z=s.composedPath?s.composedPath():s.path;O&&s.target&&s.target.shadowRoot&&z&&(o=z[0]);const U=p.noSwipingSelector?p.noSwipingSelector:`.${p.noSwipingClass}`,H=!!(s.target&&s.target.shadowRoot);if(p.noSwiping&&(H?JU(U,o):o.closest(U))){e.allowClick=!0;return}if(p.swipeHandler&&!o.closest(p.swipeHandler))return;b.currentX=s.pageX,b.currentY=s.pageY;const Y=b.currentX,Q=b.currentY;if(!PR(e,s,Y))return;Object.assign(h,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),b.startX=Y,b.startY=Q,h.touchStartTime=z0(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,p.threshold>0&&(h.allowThresholdMove=!1);let ge=!0;o.matches(h.focusableElements)&&(ge=!1,o.nodeName==="SELECT"&&(h.isTouched=!1)),r.activeElement&&r.activeElement.matches(h.focusableElements)&&r.activeElement!==o&&r.activeElement.blur();const ye=ge&&e.allowTouchMove&&p.touchStartPreventDefault;(p.touchStartForcePreventDefault||ye)&&!o.isContentEditable&&s.preventDefault(),p.freeMode&&p.freeMode.enabled&&e.freeMode&&e.animating&&!p.cssMode&&e.freeMode.onTouchStart(),e.emit("touchStart",s)}function ej(t){const e=Xm(),r=this,s=r.touchEventsData,{params:h,touches:p,rtlTranslate:b,enabled:E}=r;if(!E||!h.simulateTouch&&t.pointerType==="mouse")return;let o=t;if(o.originalEvent&&(o=o.originalEvent),o.type==="pointermove"&&(s.touchId!==null||o.pointerId!==s.pointerId))return;let O;if(o.type==="touchmove"){if(O=[...o.changedTouches].filter(ze=>ze.identifier===s.touchId)[0],!O||O.identifier!==s.touchId)return}else O=o;if(!s.isTouched){s.startMoving&&s.isScrolling&&r.emit("touchMoveOpposite",o);return}const z=O.pageX,U=O.pageY;if(o.preventedByNestedSwiper){p.startX=z,p.startY=U;return}if(!r.allowTouchMove){o.target.matches(s.focusableElements)||(r.allowClick=!1),s.isTouched&&(Object.assign(p,{startX:z,startY:U,currentX:z,currentY:U}),s.touchStartTime=z0());return}if(h.touchReleaseOnEdges&&!h.loop){if(r.isVertical()){if(U<p.startY&&r.translate<=r.maxTranslate()||U>p.startY&&r.translate>=r.minTranslate()){s.isTouched=!1,s.isMoved=!1;return}}else if(z<p.startX&&r.translate<=r.maxTranslate()||z>p.startX&&r.translate>=r.minTranslate())return}if(e.activeElement&&o.target===e.activeElement&&o.target.matches(s.focusableElements)){s.isMoved=!0,r.allowClick=!1;return}s.allowTouchCallbacks&&r.emit("touchMove",o),p.previousX=p.currentX,p.previousY=p.currentY,p.currentX=z,p.currentY=U;const H=p.currentX-p.startX,Y=p.currentY-p.startY;if(r.params.threshold&&Math.sqrt(H**2+Y**2)<r.params.threshold)return;if(typeof s.isScrolling>"u"){let ze;r.isHorizontal()&&p.currentY===p.startY||r.isVertical()&&p.currentX===p.startX?s.isScrolling=!1:H*H+Y*Y>=25&&(ze=Math.atan2(Math.abs(Y),Math.abs(H))*180/Math.PI,s.isScrolling=r.isHorizontal()?ze>h.touchAngle:90-ze>h.touchAngle)}if(s.isScrolling&&r.emit("touchMoveOpposite",o),typeof s.startMoving>"u"&&(p.currentX!==p.startX||p.currentY!==p.startY)&&(s.startMoving=!0),s.isScrolling||o.type==="touchmove"&&s.preventTouchMoveFromPointerMove){s.isTouched=!1;return}if(!s.startMoving)return;r.allowClick=!1,!h.cssMode&&o.cancelable&&o.preventDefault(),h.touchMoveStopPropagation&&!h.nested&&o.stopPropagation();let Q=r.isHorizontal()?H:Y,ge=r.isHorizontal()?p.currentX-p.previousX:p.currentY-p.previousY;h.oneWayMovement&&(Q=Math.abs(Q)*(b?1:-1),ge=Math.abs(ge)*(b?1:-1)),p.diff=Q,Q*=h.touchRatio,b&&(Q=-Q,ge=-ge);const ye=r.touchesDirection;r.swipeDirection=Q>0?"prev":"next",r.touchesDirection=ge>0?"prev":"next";const ke=r.params.loop&&!h.cssMode,he=r.touchesDirection==="next"&&r.allowSlideNext||r.touchesDirection==="prev"&&r.allowSlidePrev;if(!s.isMoved){if(ke&&he&&r.loopFix({direction:r.swipeDirection}),s.startTranslate=r.getTranslate(),r.setTransition(0),r.animating){const ze=new window.CustomEvent("transitionend",{bubbles:!0,cancelable:!0,detail:{bySwiperTouchMove:!0}});r.wrapperEl.dispatchEvent(ze)}s.allowMomentumBounce=!1,h.grabCursor&&(r.allowSlideNext===!0||r.allowSlidePrev===!0)&&r.setGrabCursor(!0),r.emit("sliderFirstMove",o)}let oe;if(new Date().getTime(),s.isMoved&&s.allowThresholdMove&&ye!==r.touchesDirection&&ke&&he&&Math.abs(Q)>=1){Object.assign(p,{startX:z,startY:U,currentX:z,currentY:U,startTranslate:s.currentTranslate}),s.loopSwapReset=!0,s.startTranslate=s.currentTranslate;return}r.emit("sliderMove",o),s.isMoved=!0,s.currentTranslate=Q+s.startTranslate;let ve=!0,be=h.resistanceRatio;if(h.touchReleaseOnEdges&&(be=0),Q>0?(ke&&he&&!oe&&s.allowThresholdMove&&s.currentTranslate>(h.centeredSlides?r.minTranslate()-r.slidesSizesGrid[r.activeIndex+1]-(h.slidesPerView!=="auto"&&r.slides.length-h.slidesPerView>=2?r.slidesSizesGrid[r.activeIndex+1]+r.params.spaceBetween:0)-r.params.spaceBetween:r.minTranslate())&&r.loopFix({direction:"prev",setTranslate:!0,activeSlideIndex:0}),s.currentTranslate>r.minTranslate()&&(ve=!1,h.resistance&&(s.currentTranslate=r.minTranslate()-1+(-r.minTranslate()+s.startTranslate+Q)**be))):Q<0&&(ke&&he&&!oe&&s.allowThresholdMove&&s.currentTranslate<(h.centeredSlides?r.maxTranslate()+r.slidesSizesGrid[r.slidesSizesGrid.length-1]+r.params.spaceBetween+(h.slidesPerView!=="auto"&&r.slides.length-h.slidesPerView>=2?r.slidesSizesGrid[r.slidesSizesGrid.length-1]+r.params.spaceBetween:0):r.maxTranslate())&&r.loopFix({direction:"next",setTranslate:!0,activeSlideIndex:r.slides.length-(h.slidesPerView==="auto"?r.slidesPerViewDynamic():Math.ceil(parseFloat(h.slidesPerView,10)))}),s.currentTranslate<r.maxTranslate()&&(ve=!1,h.resistance&&(s.currentTranslate=r.maxTranslate()+1-(r.maxTranslate()-s.startTranslate-Q)**be))),ve&&(o.preventedByNestedSwiper=!0),!r.allowSlideNext&&r.swipeDirection==="next"&&s.currentTranslate<s.startTranslate&&(s.currentTranslate=s.startTranslate),!r.allowSlidePrev&&r.swipeDirection==="prev"&&s.currentTranslate>s.startTranslate&&(s.currentTranslate=s.startTranslate),!r.allowSlidePrev&&!r.allowSlideNext&&(s.currentTranslate=s.startTranslate),h.threshold>0)if(Math.abs(Q)>h.threshold||s.allowThresholdMove){if(!s.allowThresholdMove){s.allowThresholdMove=!0,p.startX=p.currentX,p.startY=p.currentY,s.currentTranslate=s.startTranslate,p.diff=r.isHorizontal()?p.currentX-p.startX:p.currentY-p.startY;return}}else{s.currentTranslate=s.startTranslate;return}!h.followFinger||h.cssMode||((h.freeMode&&h.freeMode.enabled&&r.freeMode||h.watchSlidesProgress)&&(r.updateActiveIndex(),r.updateSlidesClasses()),h.freeMode&&h.freeMode.enabled&&r.freeMode&&r.freeMode.onTouchMove(),r.updateProgress(s.currentTranslate),r.setTranslate(s.currentTranslate))}function tj(t){const e=this,r=e.touchEventsData;let s=t;s.originalEvent&&(s=s.originalEvent);let h;if(s.type==="touchend"||s.type==="touchcancel"){if(h=[...s.changedTouches].filter(be=>be.identifier===r.touchId)[0],!h||h.identifier!==r.touchId)return}else{if(r.touchId!==null||s.pointerId!==r.pointerId)return;h=s}if(["pointercancel","pointerout","pointerleave","contextmenu"].includes(s.type)&&!(["pointercancel","contextmenu"].includes(s.type)&&(e.browser.isSafari||e.browser.isWebView)))return;r.pointerId=null,r.touchId=null;const{params:b,touches:E,rtlTranslate:o,slidesGrid:O,enabled:z}=e;if(!z||!b.simulateTouch&&s.pointerType==="mouse")return;if(r.allowTouchCallbacks&&e.emit("touchEnd",s),r.allowTouchCallbacks=!1,!r.isTouched){r.isMoved&&b.grabCursor&&e.setGrabCursor(!1),r.isMoved=!1,r.startMoving=!1;return}b.grabCursor&&r.isMoved&&r.isTouched&&(e.allowSlideNext===!0||e.allowSlidePrev===!0)&&e.setGrabCursor(!1);const U=z0(),H=U-r.touchStartTime;if(e.allowClick){const be=s.path||s.composedPath&&s.composedPath();e.updateClickedSlide(be&&be[0]||s.target,be),e.emit("tap click",s),H<300&&U-r.lastClickTime<300&&e.emit("doubleTap doubleClick",s)}if(r.lastClickTime=z0(),zw(()=>{e.destroyed||(e.allowClick=!0)}),!r.isTouched||!r.isMoved||!e.swipeDirection||E.diff===0&&!r.loopSwapReset||r.currentTranslate===r.startTranslate&&!r.loopSwapReset){r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;return}r.isTouched=!1,r.isMoved=!1,r.startMoving=!1;let Y;if(b.followFinger?Y=o?e.translate:-e.translate:Y=-r.currentTranslate,b.cssMode)return;if(b.freeMode&&b.freeMode.enabled){e.freeMode.onTouchEnd({currentPos:Y});return}const Q=Y>=-e.maxTranslate()&&!e.params.loop;let ge=0,ye=e.slidesSizesGrid[0];for(let be=0;be<O.length;be+=be<b.slidesPerGroupSkip?1:b.slidesPerGroup){const ze=be<b.slidesPerGroupSkip-1?1:b.slidesPerGroup;typeof O[be+ze]<"u"?(Q||Y>=O[be]&&Y<O[be+ze])&&(ge=be,ye=O[be+ze]-O[be]):(Q||Y>=O[be])&&(ge=be,ye=O[O.length-1]-O[O.length-2])}let ke=null,he=null;b.rewind&&(e.isBeginning?he=b.virtual&&b.virtual.enabled&&e.virtual?e.virtual.slides.length-1:e.slides.length-1:e.isEnd&&(ke=0));const oe=(Y-O[ge])/ye,ve=ge<b.slidesPerGroupSkip-1?1:b.slidesPerGroup;if(H>b.longSwipesMs){if(!b.longSwipes){e.slideTo(e.activeIndex);return}e.swipeDirection==="next"&&(oe>=b.longSwipesRatio?e.slideTo(b.rewind&&e.isEnd?ke:ge+ve):e.slideTo(ge)),e.swipeDirection==="prev"&&(oe>1-b.longSwipesRatio?e.slideTo(ge+ve):he!==null&&oe<0&&Math.abs(oe)>b.longSwipesRatio?e.slideTo(he):e.slideTo(ge))}else{if(!b.shortSwipes){e.slideTo(e.activeIndex);return}e.navigation&&(s.target===e.navigation.nextEl||s.target===e.navigation.prevEl)?s.target===e.navigation.nextEl?e.slideTo(ge+ve):e.slideTo(ge):(e.swipeDirection==="next"&&e.slideTo(ke!==null?ke:ge+ve),e.swipeDirection==="prev"&&e.slideTo(he!==null?he:ge))}}function MR(){const t=this,{params:e,el:r}=t;if(r&&r.offsetWidth===0)return;e.breakpoints&&t.setBreakpoint();const{allowSlideNext:s,allowSlidePrev:h,snapGrid:p}=t,b=t.virtual&&t.params.virtual.enabled;t.allowSlideNext=!0,t.allowSlidePrev=!0,t.updateSize(),t.updateSlides(),t.updateSlidesClasses();const E=b&&e.loop;(e.slidesPerView==="auto"||e.slidesPerView>1)&&t.isEnd&&!t.isBeginning&&!t.params.centeredSlides&&!E?t.slideTo(t.slides.length-1,0,!1,!0):t.params.loop&&!b?t.slideToLoop(t.realIndex,0,!1,!0):t.slideTo(t.activeIndex,0,!1,!0),t.autoplay&&t.autoplay.running&&t.autoplay.paused&&(clearTimeout(t.autoplay.resizeTimeout),t.autoplay.resizeTimeout=setTimeout(()=>{t.autoplay&&t.autoplay.running&&t.autoplay.paused&&t.autoplay.resume()},500)),t.allowSlidePrev=h,t.allowSlideNext=s,t.params.watchOverflow&&p!==t.snapGrid&&t.checkOverflow()}function rj(t){const e=this;e.enabled&&(e.allowClick||(e.params.preventClicks&&t.preventDefault(),e.params.preventClicksPropagation&&e.animating&&(t.stopPropagation(),t.stopImmediatePropagation())))}function nj(){const t=this,{wrapperEl:e,rtlTranslate:r,enabled:s}=t;if(!s)return;t.previousTranslate=t.translate,t.isHorizontal()?t.translate=-e.scrollLeft:t.translate=-e.scrollTop,t.translate===0&&(t.translate=0),t.updateActiveIndex(),t.updateSlidesClasses();let h;const p=t.maxTranslate()-t.minTranslate();p===0?h=0:h=(t.translate-t.minTranslate())/p,h!==t.progress&&t.updateProgress(r?-t.translate:t.translate),t.emit("setTranslate",t.translate,!1)}function ij(t){const e=this;d0(e,t.target),!(e.params.cssMode||e.params.slidesPerView!=="auto"&&!e.params.autoHeight)&&e.update()}function oj(){const t=this;t.documentTouchHandlerProceeded||(t.documentTouchHandlerProceeded=!0,t.params.touchReleaseOnEdges&&(t.el.style.touchAction="auto"))}const YO=(t,e)=>{const r=Xm(),{params:s,el:h,wrapperEl:p,device:b}=t,E=!!s.nested,o=e==="on"?"addEventListener":"removeEventListener",O=e;!h||typeof h=="string"||(r[o]("touchstart",t.onDocumentTouchStart,{passive:!1,capture:E}),h[o]("touchstart",t.onTouchStart,{passive:!1}),h[o]("pointerdown",t.onTouchStart,{passive:!1}),r[o]("touchmove",t.onTouchMove,{passive:!1,capture:E}),r[o]("pointermove",t.onTouchMove,{passive:!1,capture:E}),r[o]("touchend",t.onTouchEnd,{passive:!0}),r[o]("pointerup",t.onTouchEnd,{passive:!0}),r[o]("pointercancel",t.onTouchEnd,{passive:!0}),r[o]("touchcancel",t.onTouchEnd,{passive:!0}),r[o]("pointerout",t.onTouchEnd,{passive:!0}),r[o]("pointerleave",t.onTouchEnd,{passive:!0}),r[o]("contextmenu",t.onTouchEnd,{passive:!0}),(s.preventClicks||s.preventClicksPropagation)&&h[o]("click",t.onClick,!0),s.cssMode&&p[o]("scroll",t.onScroll),s.updateOnWindowResize?t[O](b.ios||b.android?"resize orientationchange observerUpdate":"resize observerUpdate",MR,!0):t[O]("observerUpdate",MR,!0),h[o]("load",t.onLoad,{capture:!0}))};function sj(){const t=this,{params:e}=t;t.onTouchStart=QU.bind(t),t.onTouchMove=ej.bind(t),t.onTouchEnd=tj.bind(t),t.onDocumentTouchStart=oj.bind(t),e.cssMode&&(t.onScroll=nj.bind(t)),t.onClick=rj.bind(t),t.onLoad=ij.bind(t),YO(t,"on")}function aj(){YO(this,"off")}var lj={attachEvents:sj,detachEvents:aj};const kR=(t,e)=>t.grid&&e.grid&&e.grid.rows>1;function cj(){const t=this,{realIndex:e,initialized:r,params:s,el:h}=t,p=s.breakpoints;if(!p||p&&Object.keys(p).length===0)return;const b=t.getBreakpoint(p,t.params.breakpointsBase,t.el);if(!b||t.currentBreakpoint===b)return;const o=(b in p?p[b]:void 0)||t.originalParams,O=kR(t,s),z=kR(t,o),U=t.params.grabCursor,H=o.grabCursor,Y=s.enabled;O&&!z?(h.classList.remove(`${s.containerModifierClass}grid`,`${s.containerModifierClass}grid-column`),t.emitContainerClasses()):!O&&z&&(h.classList.add(`${s.containerModifierClass}grid`),(o.grid.fill&&o.grid.fill==="column"||!o.grid.fill&&s.grid.fill==="column")&&h.classList.add(`${s.containerModifierClass}grid-column`),t.emitContainerClasses()),U&&!H?t.unsetGrabCursor():!U&&H&&t.setGrabCursor(),["navigation","pagination","scrollbar"].forEach(oe=>{if(typeof o[oe]>"u")return;const ve=s[oe]&&s[oe].enabled,be=o[oe]&&o[oe].enabled;ve&&!be&&t[oe].disable(),!ve&&be&&t[oe].enable()});const Q=o.direction&&o.direction!==s.direction,ge=s.loop&&(o.slidesPerView!==s.slidesPerView||Q),ye=s.loop;Q&&r&&t.changeDirection(),Vl(t.params,o);const ke=t.params.enabled,he=t.params.loop;Object.assign(t,{allowTouchMove:t.params.allowTouchMove,allowSlideNext:t.params.allowSlideNext,allowSlidePrev:t.params.allowSlidePrev}),Y&&!ke?t.disable():!Y&&ke&&t.enable(),t.currentBreakpoint=b,t.emit("_beforeBreakpoint",o),r&&(ge?(t.loopDestroy(),t.loopCreate(e),t.updateSlides()):!ye&&he?(t.loopCreate(e),t.updateSlides()):ye&&!he&&t.loopDestroy()),t.emit("breakpoint",o)}function uj(t,e,r){if(e===void 0&&(e="window"),!t||e==="container"&&!r)return;let s=!1;const h=Gl(),p=e==="window"?h.innerHeight:r.clientHeight,b=Object.keys(t).map(E=>{if(typeof E=="string"&&E.indexOf("@")===0){const o=parseFloat(E.substr(1));return{value:p*o,point:E}}return{value:E,point:E}});b.sort((E,o)=>parseInt(E.value,10)-parseInt(o.value,10));for(let E=0;E<b.length;E+=1){const{point:o,value:O}=b[E];e==="window"?h.matchMedia(`(min-width: ${O}px)`).matches&&(s=o):O<=r.clientWidth&&(s=o)}return s||"max"}var hj={setBreakpoint:cj,getBreakpoint:uj};function dj(t,e){const r=[];return t.forEach(s=>{typeof s=="object"?Object.keys(s).forEach(h=>{s[h]&&r.push(e+h)}):typeof s=="string"&&r.push(e+s)}),r}function fj(){const t=this,{classNames:e,params:r,rtl:s,el:h,device:p}=t,b=dj(["initialized",r.direction,{"free-mode":t.params.freeMode&&r.freeMode.enabled},{autoheight:r.autoHeight},{rtl:s},{grid:r.grid&&r.grid.rows>1},{"grid-column":r.grid&&r.grid.rows>1&&r.grid.fill==="column"},{android:p.android},{ios:p.ios},{"css-mode":r.cssMode},{centered:r.cssMode&&r.centeredSlides},{"watch-progress":r.watchSlidesProgress}],r.containerModifierClass);e.push(...b),h.classList.add(...e),t.emitContainerClasses()}function pj(){const t=this,{el:e,classNames:r}=t;!e||typeof e=="string"||(e.classList.remove(...r),t.emitContainerClasses())}var mj={addClasses:fj,removeClasses:pj};function gj(){const t=this,{isLocked:e,params:r}=t,{slidesOffsetBefore:s}=r;if(s){const h=t.slides.length-1,p=t.slidesGrid[h]+t.slidesSizesGrid[h]+s*2;t.isLocked=t.size>p}else t.isLocked=t.snapGrid.length===1;r.allowSlideNext===!0&&(t.allowSlideNext=!t.isLocked),r.allowSlidePrev===!0&&(t.allowSlidePrev=!t.isLocked),e&&e!==t.isLocked&&(t.isEnd=!1),e!==t.isLocked&&t.emit(t.isLocked?"lock":"unlock")}var _j={checkOverflow:gj},Vw={init:!0,direction:"horizontal",oneWayMovement:!1,swiperElementNodeName:"SWIPER-CONTAINER",touchEventsTarget:"wrapper",initialSlide:0,speed:300,cssMode:!1,updateOnWindowResize:!0,resizeObserver:!0,nested:!1,createElements:!1,eventsPrefix:"swiper",enabled:!0,focusableElements:"input, select, option, textarea, button, video, label",width:null,height:null,preventInteractionOnTransition:!1,userAgent:null,url:null,edgeSwipeDetection:!1,edgeSwipeThreshold:20,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",breakpoints:void 0,breakpointsBase:"window",spaceBetween:0,slidesPerView:1,slidesPerGroup:1,slidesPerGroupSkip:0,slidesPerGroupAuto:!1,centeredSlides:!1,centeredSlidesBounds:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,normalizeSlideIndex:!0,centerInsufficientSlides:!1,watchOverflow:!0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,allowTouchMove:!0,threshold:5,touchMoveStopPropagation:!1,touchStartPreventDefault:!0,touchStartForcePreventDefault:!1,touchReleaseOnEdges:!1,uniqueNavElements:!0,resistance:!0,resistanceRatio:.85,watchSlidesProgress:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,loop:!1,loopAddBlankSlides:!0,loopAdditionalSlides:0,loopPreventsSliding:!0,rewind:!1,allowSlidePrev:!0,allowSlideNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",noSwipingSelector:null,passiveListeners:!0,maxBackfaceHiddenSlides:10,containerModifierClass:"swiper-",slideClass:"swiper-slide",slideBlankClass:"swiper-slide-blank",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideFullyVisibleClass:"swiper-slide-fully-visible",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",lazyPreloaderClass:"swiper-lazy-preloader",lazyPreloadPrevNext:0,runCallbacksOnInit:!0,_emitClasses:!1};function yj(t,e){return function(s){s===void 0&&(s={});const h=Object.keys(s)[0],p=s[h];if(typeof p!="object"||p===null){Vl(e,s);return}if(t[h]===!0&&(t[h]={enabled:!0}),h==="navigation"&&t[h]&&t[h].enabled&&!t[h].prevEl&&!t[h].nextEl&&(t[h].auto=!0),["pagination","scrollbar"].indexOf(h)>=0&&t[h]&&t[h].enabled&&!t[h].el&&(t[h].auto=!0),!(h in t&&"enabled"in p)){Vl(e,s);return}typeof t[h]=="object"&&!("enabled"in t[h])&&(t[h].enabled=!0),t[h]||(t[h]={enabled:!1}),Vl(e,s)}}const z1={eventsEmitter:mU,update:IU,translate:kU,transition:BU,slide:GU,loop:ZU,grabCursor:YU,events:lj,breakpoints:hj,checkOverflow:_j,classes:mj},N1={};let JT=class Qu{constructor(){let e,r;for(var s=arguments.length,h=new Array(s),p=0;p<s;p++)h[p]=arguments[p];h.length===1&&h[0].constructor&&Object.prototype.toString.call(h[0]).slice(8,-1)==="Object"?r=h[0]:[e,r]=h,r||(r={}),r=Vl({},r),e&&!r.el&&(r.el=e);const b=Xm();if(r.el&&typeof r.el=="string"&&b.querySelectorAll(r.el).length>1){const z=[];return b.querySelectorAll(r.el).forEach(U=>{const H=Vl({},r,{el:U});z.push(new Qu(H))}),z}const E=this;E.__swiper__=!0,E.support=ZO(),E.device=KO({userAgent:r.userAgent}),E.browser=dU(),E.eventsListeners={},E.eventsAnyListeners=[],E.modules=[...E.__modules__],r.modules&&Array.isArray(r.modules)&&E.modules.push(...r.modules);const o={};E.modules.forEach(z=>{z({params:r,swiper:E,extendParams:yj(r,o),on:E.on.bind(E),once:E.once.bind(E),off:E.off.bind(E),emit:E.emit.bind(E)})});const O=Vl({},Vw,o);return E.params=Vl({},O,N1,r),E.originalParams=Vl({},E.params),E.passedParams=Vl({},r),E.params&&E.params.on&&Object.keys(E.params.on).forEach(z=>{E.on(z,E.params.on[z])}),E.params&&E.params.onAny&&E.onAny(E.params.onAny),Object.assign(E,{enabled:E.params.enabled,el:e,classNames:[],slides:[],slidesGrid:[],snapGrid:[],slidesSizesGrid:[],isHorizontal(){return E.params.direction==="horizontal"},isVertical(){return E.params.direction==="vertical"},activeIndex:0,realIndex:0,isBeginning:!0,isEnd:!1,translate:0,previousTranslate:0,progress:0,velocity:0,animating:!1,cssOverflowAdjustment(){return Math.trunc(this.translate/2**23)*2**23},allowSlideNext:E.params.allowSlideNext,allowSlidePrev:E.params.allowSlidePrev,touchEventsData:{isTouched:void 0,isMoved:void 0,allowTouchCallbacks:void 0,touchStartTime:void 0,isScrolling:void 0,currentTranslate:void 0,startTranslate:void 0,allowThresholdMove:void 0,focusableElements:E.params.focusableElements,lastClickTime:0,clickTimeout:void 0,velocities:[],allowMomentumBounce:void 0,startMoving:void 0,pointerId:null,touchId:null},allowClick:!0,allowTouchMove:E.params.allowTouchMove,touches:{startX:0,startY:0,currentX:0,currentY:0,diff:0},imagesToLoad:[],imagesLoaded:0}),E.emit("_swiper"),E.params.init&&E.init(),E}getDirectionLabel(e){return this.isHorizontal()?e:{width:"height","margin-top":"margin-left","margin-bottom ":"margin-right","margin-left":"margin-top","margin-right":"margin-bottom","padding-left":"padding-top","padding-right":"padding-bottom",marginRight:"marginBottom"}[e]}getSlideIndex(e){const{slidesEl:r,params:s}=this,h=nh(r,`.${s.slideClass}, swiper-slide`),p=AR(h[0]);return AR(e)-p}getSlideIndexByData(e){return this.getSlideIndex(this.slides.filter(r=>r.getAttribute("data-swiper-slide-index")*1===e)[0])}recalcSlides(){const e=this,{slidesEl:r,params:s}=e;e.slides=nh(r,`.${s.slideClass}, swiper-slide`)}enable(){const e=this;e.enabled||(e.enabled=!0,e.params.grabCursor&&e.setGrabCursor(),e.emit("enable"))}disable(){const e=this;e.enabled&&(e.enabled=!1,e.params.grabCursor&&e.unsetGrabCursor(),e.emit("disable"))}setProgress(e,r){const s=this;e=Math.min(Math.max(e,0),1);const h=s.minTranslate(),b=(s.maxTranslate()-h)*e+h;s.translateTo(b,typeof r>"u"?0:r),s.updateActiveIndex(),s.updateSlidesClasses()}emitContainerClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=e.el.className.split(" ").filter(s=>s.indexOf("swiper")===0||s.indexOf(e.params.containerModifierClass)===0);e.emit("_containerClasses",r.join(" "))}getSlideClasses(e){const r=this;return r.destroyed?"":e.className.split(" ").filter(s=>s.indexOf("swiper-slide")===0||s.indexOf(r.params.slideClass)===0).join(" ")}emitSlidesClasses(){const e=this;if(!e.params._emitClasses||!e.el)return;const r=[];e.slides.forEach(s=>{const h=e.getSlideClasses(s);r.push({slideEl:s,classNames:h}),e.emit("_slideClass",s,h)}),e.emit("_slideClasses",r)}slidesPerViewDynamic(e,r){e===void 0&&(e="current"),r===void 0&&(r=!1);const s=this,{params:h,slides:p,slidesGrid:b,slidesSizesGrid:E,size:o,activeIndex:O}=s;let z=1;if(typeof h.slidesPerView=="number")return h.slidesPerView;if(h.centeredSlides){let U=p[O]?Math.ceil(p[O].swiperSlideSize):0,H;for(let Y=O+1;Y<p.length;Y+=1)p[Y]&&!H&&(U+=Math.ceil(p[Y].swiperSlideSize),z+=1,U>o&&(H=!0));for(let Y=O-1;Y>=0;Y-=1)p[Y]&&!H&&(U+=p[Y].swiperSlideSize,z+=1,U>o&&(H=!0))}else if(e==="current")for(let U=O+1;U<p.length;U+=1)(r?b[U]+E[U]-b[O]<o:b[U]-b[O]<o)&&(z+=1);else for(let U=O-1;U>=0;U-=1)b[O]-b[U]<o&&(z+=1);return z}update(){const e=this;if(!e||e.destroyed)return;const{snapGrid:r,params:s}=e;s.breakpoints&&e.setBreakpoint(),[...e.el.querySelectorAll('[loading="lazy"]')].forEach(b=>{b.complete&&d0(e,b)}),e.updateSize(),e.updateSlides(),e.updateProgress(),e.updateSlidesClasses();function h(){const b=e.rtlTranslate?e.translate*-1:e.translate,E=Math.min(Math.max(b,e.maxTranslate()),e.minTranslate());e.setTranslate(E),e.updateActiveIndex(),e.updateSlidesClasses()}let p;if(s.freeMode&&s.freeMode.enabled&&!s.cssMode)h(),s.autoHeight&&e.updateAutoHeight();else{if((s.slidesPerView==="auto"||s.slidesPerView>1)&&e.isEnd&&!s.centeredSlides){const b=e.virtual&&s.virtual.enabled?e.virtual.slides:e.slides;p=e.slideTo(b.length-1,0,!1,!0)}else p=e.slideTo(e.activeIndex,0,!1,!0);p||h()}s.watchOverflow&&r!==e.snapGrid&&e.checkOverflow(),e.emit("update")}changeDirection(e,r){r===void 0&&(r=!0);const s=this,h=s.params.direction;return e||(e=h==="horizontal"?"vertical":"horizontal"),e===h||e!=="horizontal"&&e!=="vertical"||(s.el.classList.remove(`${s.params.containerModifierClass}${h}`),s.el.classList.add(`${s.params.containerModifierClass}${e}`),s.emitContainerClasses(),s.params.direction=e,s.slides.forEach(p=>{e==="vertical"?p.style.width="":p.style.height=""}),s.emit("changeDirection"),r&&s.update()),s}changeLanguageDirection(e){const r=this;r.rtl&&e==="rtl"||!r.rtl&&e==="ltr"||(r.rtl=e==="rtl",r.rtlTranslate=r.params.direction==="horizontal"&&r.rtl,r.rtl?(r.el.classList.add(`${r.params.containerModifierClass}rtl`),r.el.dir="rtl"):(r.el.classList.remove(`${r.params.containerModifierClass}rtl`),r.el.dir="ltr"),r.update())}mount(e){const r=this;if(r.mounted)return!0;let s=e||r.params.el;if(typeof s=="string"&&(s=document.querySelector(s)),!s)return!1;s.swiper=r,s.parentNode&&s.parentNode.host&&s.parentNode.host.nodeName===r.params.swiperElementNodeName.toUpperCase()&&(r.isElement=!0);const h=()=>`.${(r.params.wrapperClass||"").trim().split(" ").join(".")}`;let b=s&&s.shadowRoot&&s.shadowRoot.querySelector?s.shadowRoot.querySelector(h()):nh(s,h())[0];return!b&&r.params.createElements&&(b=Nw("div",r.params.wrapperClass),s.append(b),nh(s,`.${r.params.slideClass}`).forEach(E=>{b.append(E)})),Object.assign(r,{el:s,wrapperEl:b,slidesEl:r.isElement&&!s.parentNode.host.slideSlots?s.parentNode.host:b,hostEl:r.isElement?s.parentNode.host:s,mounted:!0,rtl:s.dir.toLowerCase()==="rtl"||Sd(s,"direction")==="rtl",rtlTranslate:r.params.direction==="horizontal"&&(s.dir.toLowerCase()==="rtl"||Sd(s,"direction")==="rtl"),wrongRTL:Sd(b,"display")==="-webkit-box"}),!0}init(e){const r=this;if(r.initialized||r.mount(e)===!1)return r;r.emit("beforeInit"),r.params.breakpoints&&r.setBreakpoint(),r.addClasses(),r.updateSize(),r.updateSlides(),r.params.watchOverflow&&r.checkOverflow(),r.params.grabCursor&&r.enabled&&r.setGrabCursor(),r.params.loop&&r.virtual&&r.params.virtual.enabled?r.slideTo(r.params.initialSlide+r.virtual.slidesBefore,0,r.params.runCallbacksOnInit,!1,!0):r.slideTo(r.params.initialSlide,0,r.params.runCallbacksOnInit,!1,!0),r.params.loop&&r.loopCreate(),r.attachEvents();const h=[...r.el.querySelectorAll('[loading="lazy"]')];return r.isElement&&h.push(...r.hostEl.querySelectorAll('[loading="lazy"]')),h.forEach(p=>{p.complete?d0(r,p):p.addEventListener("load",b=>{d0(r,b.target)})}),Fw(r),r.initialized=!0,Fw(r),r.emit("init"),r.emit("afterInit"),r}destroy(e,r){e===void 0&&(e=!0),r===void 0&&(r=!0);const s=this,{params:h,el:p,wrapperEl:b,slides:E}=s;return typeof s.params>"u"||s.destroyed||(s.emit("beforeDestroy"),s.initialized=!1,s.detachEvents(),h.loop&&s.loopDestroy(),r&&(s.removeClasses(),p&&typeof p!="string"&&p.removeAttribute("style"),b&&b.removeAttribute("style"),E&&E.length&&E.forEach(o=>{o.classList.remove(h.slideVisibleClass,h.slideFullyVisibleClass,h.slideActiveClass,h.slideNextClass,h.slidePrevClass),o.removeAttribute("style"),o.removeAttribute("data-swiper-slide-index")})),s.emit("destroy"),Object.keys(s.eventsListeners).forEach(o=>{s.off(o)}),e!==!1&&(s.el&&typeof s.el!="string"&&(s.el.swiper=null),tU(s)),s.destroyed=!0),null}static extendDefaults(e){Vl(N1,e)}static get extendedDefaults(){return N1}static get defaults(){return Vw}static installModule(e){Qu.prototype.__modules__||(Qu.prototype.__modules__=[]);const r=Qu.prototype.__modules__;typeof e=="function"&&r.indexOf(e)<0&&r.push(e)}static use(e){return Array.isArray(e)?(e.forEach(r=>Qu.installModule(r)),Qu):(Qu.installModule(e),Qu)}};Object.keys(z1).forEach(t=>{Object.keys(z1[t]).forEach(e=>{JT.prototype[e]=z1[t][e]})});JT.use([fU,pU]);const JO=["eventsPrefix","injectStyles","injectStylesUrls","modules","init","_direction","oneWayMovement","swiperElementNodeName","touchEventsTarget","initialSlide","_speed","cssMode","updateOnWindowResize","resizeObserver","nested","focusableElements","_enabled","_width","_height","preventInteractionOnTransition","userAgent","url","_edgeSwipeDetection","_edgeSwipeThreshold","_freeMode","_autoHeight","setWrapperSize","virtualTranslate","_effect","breakpoints","breakpointsBase","_spaceBetween","_slidesPerView","maxBackfaceHiddenSlides","_grid","_slidesPerGroup","_slidesPerGroupSkip","_slidesPerGroupAuto","_centeredSlides","_centeredSlidesBounds","_slidesOffsetBefore","_slidesOffsetAfter","normalizeSlideIndex","_centerInsufficientSlides","_watchOverflow","roundLengths","touchRatio","touchAngle","simulateTouch","_shortSwipes","_longSwipes","longSwipesRatio","longSwipesMs","_followFinger","allowTouchMove","_threshold","touchMoveStopPropagation","touchStartPreventDefault","touchStartForcePreventDefault","touchReleaseOnEdges","uniqueNavElements","_resistance","_resistanceRatio","_watchSlidesProgress","_grabCursor","preventClicks","preventClicksPropagation","_slideToClickedSlide","_loop","loopAdditionalSlides","loopAddBlankSlides","loopPreventsSliding","_rewind","_allowSlidePrev","_allowSlideNext","_swipeHandler","_noSwiping","noSwipingClass","noSwipingSelector","passiveListeners","containerModifierClass","slideClass","slideActiveClass","slideVisibleClass","slideFullyVisibleClass","slideNextClass","slidePrevClass","slideBlankClass","wrapperClass","lazyPreloaderClass","lazyPreloadPrevNext","runCallbacksOnInit","observer","observeParents","observeSlideChildren","a11y","_autoplay","_controller","coverflowEffect","cubeEffect","fadeEffect","flipEffect","creativeEffect","cardsEffect","hashNavigation","history","keyboard","mousewheel","_navigation","_pagination","parallax","_scrollbar","_thumbs","virtual","zoom","control"];function Qf(t){return typeof t=="object"&&t!==null&&t.constructor&&Object.prototype.toString.call(t).slice(8,-1)==="Object"&&!t.__swiper__}function Em(t,e){const r=["__proto__","constructor","prototype"];Object.keys(e).filter(s=>r.indexOf(s)<0).forEach(s=>{typeof t[s]>"u"?t[s]=e[s]:Qf(e[s])&&Qf(t[s])&&Object.keys(e[s]).length>0?e[s].__swiper__?t[s]=e[s]:Em(t[s],e[s]):t[s]=e[s]})}function QO(t){return t===void 0&&(t={}),t.navigation&&typeof t.navigation.nextEl>"u"&&typeof t.navigation.prevEl>"u"}function eD(t){return t===void 0&&(t={}),t.pagination&&typeof t.pagination.el>"u"}function tD(t){return t===void 0&&(t={}),t.scrollbar&&typeof t.scrollbar.el>"u"}function rD(t){t===void 0&&(t="");const e=t.split(" ").map(s=>s.trim()).filter(s=>!!s),r=[];return e.forEach(s=>{r.indexOf(s)<0&&r.push(s)}),r.join(" ")}function vj(t){return t===void 0&&(t=""),t?t.includes("swiper-wrapper")?t:`swiper-wrapper ${t}`:"swiper-wrapper"}function bj(t){let{swiper:e,slides:r,passedParams:s,changedParams:h,nextEl:p,prevEl:b,scrollbarEl:E,paginationEl:o}=t;const O=h.filter(ne=>ne!=="children"&&ne!=="direction"&&ne!=="wrapperClass"),{params:z,pagination:U,navigation:H,scrollbar:Y,virtual:Q,thumbs:ge}=e;let ye,ke,he,oe,ve,be,ze,Te;h.includes("thumbs")&&s.thumbs&&s.thumbs.swiper&&z.thumbs&&!z.thumbs.swiper&&(ye=!0),h.includes("controller")&&s.controller&&s.controller.control&&z.controller&&!z.controller.control&&(ke=!0),h.includes("pagination")&&s.pagination&&(s.pagination.el||o)&&(z.pagination||z.pagination===!1)&&U&&!U.el&&(he=!0),h.includes("scrollbar")&&s.scrollbar&&(s.scrollbar.el||E)&&(z.scrollbar||z.scrollbar===!1)&&Y&&!Y.el&&(oe=!0),h.includes("navigation")&&s.navigation&&(s.navigation.prevEl||b)&&(s.navigation.nextEl||p)&&(z.navigation||z.navigation===!1)&&H&&!H.prevEl&&!H.nextEl&&(ve=!0);const ie=ne=>{e[ne]&&(e[ne].destroy(),ne==="navigation"?(e.isElement&&(e[ne].prevEl.remove(),e[ne].nextEl.remove()),z[ne].prevEl=void 0,z[ne].nextEl=void 0,e[ne].prevEl=void 0,e[ne].nextEl=void 0):(e.isElement&&e[ne].el.remove(),z[ne].el=void 0,e[ne].el=void 0))};h.includes("loop")&&e.isElement&&(z.loop&&!s.loop?be=!0:!z.loop&&s.loop?ze=!0:Te=!0),O.forEach(ne=>{if(Qf(z[ne])&&Qf(s[ne]))Object.assign(z[ne],s[ne]),(ne==="navigation"||ne==="pagination"||ne==="scrollbar")&&"enabled"in s[ne]&&!s[ne].enabled&&ie(ne);else{const te=s[ne];(te===!0||te===!1)&&(ne==="navigation"||ne==="pagination"||ne==="scrollbar")?te===!1&&ie(ne):z[ne]=s[ne]}}),O.includes("controller")&&!ke&&e.controller&&e.controller.control&&z.controller&&z.controller.control&&(e.controller.control=z.controller.control),h.includes("children")&&r&&Q&&z.virtual.enabled?(Q.slides=r,Q.update(!0)):h.includes("virtual")&&Q&&z.virtual.enabled&&(r&&(Q.slides=r),Q.update(!0)),h.includes("children")&&r&&z.loop&&(Te=!0),ye&&ge.init()&&ge.update(!0),ke&&(e.controller.control=z.controller.control),he&&(e.isElement&&(!o||typeof o=="string")&&(o=document.createElement("div"),o.classList.add("swiper-pagination"),o.part.add("pagination"),e.el.appendChild(o)),o&&(z.pagination.el=o),U.init(),U.render(),U.update()),oe&&(e.isElement&&(!E||typeof E=="string")&&(E=document.createElement("div"),E.classList.add("swiper-scrollbar"),E.part.add("scrollbar"),e.el.appendChild(E)),E&&(z.scrollbar.el=E),Y.init(),Y.updateSize(),Y.setTranslate()),ve&&(e.isElement&&((!p||typeof p=="string")&&(p=document.createElement("div"),p.classList.add("swiper-button-next"),p.innerHTML=e.hostEl.constructor.nextButtonSvg,p.part.add("button-next"),e.el.appendChild(p)),(!b||typeof b=="string")&&(b=document.createElement("div"),b.classList.add("swiper-button-prev"),b.innerHTML=e.hostEl.constructor.prevButtonSvg,b.part.add("button-prev"),e.el.appendChild(b))),p&&(z.navigation.nextEl=p),b&&(z.navigation.prevEl=b),H.init(),H.update()),h.includes("allowSlideNext")&&(e.allowSlideNext=s.allowSlideNext),h.includes("allowSlidePrev")&&(e.allowSlidePrev=s.allowSlidePrev),h.includes("direction")&&e.changeDirection(s.direction,!1),(be||Te)&&e.loopDestroy(),(ze||Te)&&e.loopCreate(),e.update()}function OR(t,e){t===void 0&&(t={});const r={on:{}},s={},h={};Em(r,Vw),r._emitClasses=!0,r.init=!1;const p={},b=JO.map(o=>o.replace(/_/,"")),E=Object.assign({},t);return Object.keys(E).forEach(o=>{typeof t[o]>"u"||(b.indexOf(o)>=0?Qf(t[o])?(r[o]={},h[o]={},Em(r[o],t[o]),Em(h[o],t[o])):(r[o]=t[o],h[o]=t[o]):o.search(/on[A-Z]/)===0&&typeof t[o]=="function"?r.on[`${o[2].toLowerCase()}${o.substr(3)}`]=t[o]:p[o]=t[o])}),["navigation","pagination","scrollbar"].forEach(o=>{r[o]===!0&&(r[o]={}),r[o]===!1&&delete r[o]}),{params:r,passedParams:h,rest:p,events:s}}function xj(t,e){let{el:r,nextEl:s,prevEl:h,paginationEl:p,scrollbarEl:b,swiper:E}=t;QO(e)&&s&&h&&(E.params.navigation.nextEl=s,E.originalParams.navigation.nextEl=s,E.params.navigation.prevEl=h,E.originalParams.navigation.prevEl=h),eD(e)&&p&&(E.params.pagination.el=p,E.originalParams.pagination.el=p),tD(e)&&b&&(E.params.scrollbar.el=b,E.originalParams.scrollbar.el=b),E.init(r)}function wj(t,e,r,s,h){const p=[];if(!e)return p;const b=o=>{p.indexOf(o)<0&&p.push(o)};if(r&&s){const o=s.map(h),O=r.map(h);o.join("")!==O.join("")&&b("children"),s.length!==r.length&&b("children")}return JO.filter(o=>o[0]==="_").map(o=>o.replace(/_/,"")).forEach(o=>{if(o in t&&o in e)if(Qf(t[o])&&Qf(e[o])){const O=Object.keys(t[o]),z=Object.keys(e[o]);O.length!==z.length?b(o):(O.forEach(U=>{t[o][U]!==e[o][U]&&b(o)}),z.forEach(U=>{t[o][U]!==e[o][U]&&b(o)}))}else t[o]!==e[o]&&b(o)}),p}const Tj=t=>{!t||t.destroyed||!t.params.virtual||t.params.virtual&&!t.params.virtual.enabled||(t.updateSlides(),t.updateProgress(),t.updateSlidesClasses(),t.parallax&&t.params.parallax&&t.params.parallax.enabled&&t.parallax.setTranslate())};function F1(t,e,r){t===void 0&&(t={});const s=[],h={"container-start":[],"container-end":[],"wrapper-start":[],"wrapper-end":[]},p=(b,E)=>{Array.isArray(b)&&b.forEach(o=>{const O=typeof o.type=="symbol";E==="default"&&(E="container-end"),O&&o.children?p(o.children,E):o.type&&(o.type.name==="SwiperSlide"||o.type.name==="AsyncComponentWrapper")||o.componentOptions&&o.componentOptions.tag==="SwiperSlide"?s.push(o):h[E]&&h[E].push(o)})};return Object.keys(t).forEach(b=>{if(typeof t[b]!="function")return;const E=t[b]();p(E,b)}),r.value=e.value,e.value=s,{slides:s,slots:h}}function Ej(t,e,r){if(!r)return null;const s=z=>{let U=z;return z<0?U=e.length+z:U>=e.length&&(U=U-e.length),U},h=t.value.isHorizontal()?{[t.value.rtlTranslate?"right":"left"]:`${r.offset}px`}:{top:`${r.offset}px`},{from:p,to:b}=r,E=t.value.params.loop?-e.length:0,o=t.value.params.loop?e.length*2:e.length,O=[];for(let z=E;z<o;z+=1)z>=p&&z<=b&&O.length<e.length&&O.push(e[s(z)]);return O.map(z=>{if(z.props||(z.props={}),z.props.style||(z.props.style={}),z.props.swiperRef=t,z.props.style=h,z.type)return ja(z.type,{...z.props},z.children);if(z.componentOptions)return ja(z.componentOptions.Ctor,{...z.props},z.componentOptions.children)})}const Sj={name:"Swiper",props:{tag:{type:String,default:"div"},wrapperTag:{type:String,default:"div"},modules:{type:Array,default:void 0},init:{type:Boolean,default:void 0},direction:{type:String,default:void 0},oneWayMovement:{type:Boolean,default:void 0},swiperElementNodeName:{type:String,default:"SWIPER-CONTAINER"},touchEventsTarget:{type:String,default:void 0},initialSlide:{type:Number,default:void 0},speed:{type:Number,default:void 0},cssMode:{type:Boolean,default:void 0},updateOnWindowResize:{type:Boolean,default:void 0},resizeObserver:{type:Boolean,default:void 0},nested:{type:Boolean,default:void 0},focusableElements:{type:String,default:void 0},width:{type:Number,default:void 0},height:{type:Number,default:void 0},preventInteractionOnTransition:{type:Boolean,default:void 0},userAgent:{type:String,default:void 0},url:{type:String,default:void 0},edgeSwipeDetection:{type:[Boolean,String],default:void 0},edgeSwipeThreshold:{type:Number,default:void 0},autoHeight:{type:Boolean,default:void 0},setWrapperSize:{type:Boolean,default:void 0},virtualTranslate:{type:Boolean,default:void 0},effect:{type:String,default:void 0},breakpoints:{type:Object,default:void 0},breakpointsBase:{type:String,default:void 0},spaceBetween:{type:[Number,String],default:void 0},slidesPerView:{type:[Number,String],default:void 0},maxBackfaceHiddenSlides:{type:Number,default:void 0},slidesPerGroup:{type:Number,default:void 0},slidesPerGroupSkip:{type:Number,default:void 0},slidesPerGroupAuto:{type:Boolean,default:void 0},centeredSlides:{type:Boolean,default:void 0},centeredSlidesBounds:{type:Boolean,default:void 0},slidesOffsetBefore:{type:Number,default:void 0},slidesOffsetAfter:{type:Number,default:void 0},normalizeSlideIndex:{type:Boolean,default:void 0},centerInsufficientSlides:{type:Boolean,default:void 0},watchOverflow:{type:Boolean,default:void 0},roundLengths:{type:Boolean,default:void 0},touchRatio:{type:Number,default:void 0},touchAngle:{type:Number,default:void 0},simulateTouch:{type:Boolean,default:void 0},shortSwipes:{type:Boolean,default:void 0},longSwipes:{type:Boolean,default:void 0},longSwipesRatio:{type:Number,default:void 0},longSwipesMs:{type:Number,default:void 0},followFinger:{type:Boolean,default:void 0},allowTouchMove:{type:Boolean,default:void 0},threshold:{type:Number,default:void 0},touchMoveStopPropagation:{type:Boolean,default:void 0},touchStartPreventDefault:{type:Boolean,default:void 0},touchStartForcePreventDefault:{type:Boolean,default:void 0},touchReleaseOnEdges:{type:Boolean,default:void 0},uniqueNavElements:{type:Boolean,default:void 0},resistance:{type:Boolean,default:void 0},resistanceRatio:{type:Number,default:void 0},watchSlidesProgress:{type:Boolean,default:void 0},grabCursor:{type:Boolean,default:void 0},preventClicks:{type:Boolean,default:void 0},preventClicksPropagation:{type:Boolean,default:void 0},slideToClickedSlide:{type:Boolean,default:void 0},loop:{type:Boolean,default:void 0},loopedSlides:{type:Number,default:void 0},loopPreventsSliding:{type:Boolean,default:void 0},rewind:{type:Boolean,default:void 0},allowSlidePrev:{type:Boolean,default:void 0},allowSlideNext:{type:Boolean,default:void 0},swipeHandler:{type:Boolean,default:void 0},noSwiping:{type:Boolean,default:void 0},noSwipingClass:{type:String,default:void 0},noSwipingSelector:{type:String,default:void 0},passiveListeners:{type:Boolean,default:void 0},containerModifierClass:{type:String,default:void 0},slideClass:{type:String,default:void 0},slideActiveClass:{type:String,default:void 0},slideVisibleClass:{type:String,default:void 0},slideFullyVisibleClass:{type:String,default:void 0},slideBlankClass:{type:String,default:void 0},slideNextClass:{type:String,default:void 0},slidePrevClass:{type:String,default:void 0},wrapperClass:{type:String,default:void 0},lazyPreloaderClass:{type:String,default:void 0},lazyPreloadPrevNext:{type:Number,default:void 0},runCallbacksOnInit:{type:Boolean,default:void 0},observer:{type:Boolean,default:void 0},observeParents:{type:Boolean,default:void 0},observeSlideChildren:{type:Boolean,default:void 0},a11y:{type:[Boolean,Object],default:void 0},autoplay:{type:[Boolean,Object],default:void 0},controller:{type:Object,default:void 0},coverflowEffect:{type:Object,default:void 0},cubeEffect:{type:Object,default:void 0},fadeEffect:{type:Object,default:void 0},flipEffect:{type:Object,default:void 0},creativeEffect:{type:Object,default:void 0},cardsEffect:{type:Object,default:void 0},hashNavigation:{type:[Boolean,Object],default:void 0},history:{type:[Boolean,Object],default:void 0},keyboard:{type:[Boolean,Object],default:void 0},mousewheel:{type:[Boolean,Object],default:void 0},navigation:{type:[Boolean,Object],default:void 0},pagination:{type:[Boolean,Object],default:void 0},parallax:{type:[Boolean,Object],default:void 0},scrollbar:{type:[Boolean,Object],default:void 0},thumbs:{type:Object,default:void 0},virtual:{type:[Boolean,Object],default:void 0},zoom:{type:[Boolean,Object],default:void 0},grid:{type:[Object],default:void 0},freeMode:{type:[Boolean,Object],default:void 0},enabled:{type:Boolean,default:void 0}},emits:["_beforeBreakpoint","_containerClasses","_slideClass","_slideClasses","_swiper","_freeModeNoMomentumRelease","activeIndexChange","afterInit","autoplay","autoplayStart","autoplayStop","autoplayPause","autoplayResume","autoplayTimeLeft","beforeDestroy","beforeInit","beforeLoopFix","beforeResize","beforeSlideChangeStart","beforeTransitionStart","breakpoint","changeDirection","click","disable","doubleTap","doubleClick","destroy","enable","fromEdge","hashChange","hashSet","init","keyPress","lock","loopFix","momentumBounce","navigationHide","navigationShow","navigationPrev","navigationNext","observerUpdate","orientationchange","paginationHide","paginationRender","paginationShow","paginationUpdate","progress","reachBeginning","reachEnd","realIndexChange","resize","scroll","scrollbarDragEnd","scrollbarDragMove","scrollbarDragStart","setTransition","setTranslate","slidesUpdated","slideChange","slideChangeTransitionEnd","slideChangeTransitionStart","slideNextTransitionEnd","slideNextTransitionStart","slidePrevTransitionEnd","slidePrevTransitionStart","slideResetTransitionStart","slideResetTransitionEnd","sliderMove","sliderFirstMove","slidesLengthChange","slidesGridLengthChange","snapGridLengthChange","snapIndexChange","swiper","tap","toEdge","touchEnd","touchMove","touchMoveOpposite","touchStart","transitionEnd","transitionStart","unlock","update","virtualUpdate","zoomChange"],setup(t,e){let{slots:r,emit:s}=e;const{tag:h,wrapperTag:p}=t,b=Qr("swiper"),E=Qr(null),o=Qr(!1),O=Qr(!1),z=Qr(null),U=Qr(null),H=Qr(null),Y={value:[]},Q={value:[]},ge=Qr(null),ye=Qr(null),ke=Qr(null),he=Qr(null),{params:oe,passedParams:ve}=OR(t);F1(r,Y,Q),H.value=ve,Q.value=Y.value;const be=()=>{F1(r,Y,Q),o.value=!0};oe.onAny=function(ie){for(var ne=arguments.length,te=new Array(ne>1?ne-1:0),re=1;re<ne;re++)te[re-1]=arguments[re];s(ie,...te)},Object.assign(oe.on,{_beforeBreakpoint:be,_containerClasses(ie,ne){b.value=ne}});const ze={...oe};if(delete ze.wrapperClass,U.value=new JT(ze),U.value.virtual&&U.value.params.virtual.enabled){U.value.virtual.slides=Y.value;const ie={cache:!1,slides:Y.value,renderExternal:ne=>{E.value=ne},renderExternalUpdate:!1};Em(U.value.params.virtual,ie),Em(U.value.originalParams.virtual,ie)}Zm(()=>{!O.value&&U.value&&(U.value.emitSlidesClasses(),O.value=!0);const{passedParams:ie}=OR(t),ne=wj(ie,H.value,Y.value,Q.value,te=>te.props&&te.props.key);H.value=ie,(ne.length||o.value)&&U.value&&!U.value.destroyed&&bj({swiper:U.value,slides:Y.value,passedParams:ie,changedParams:ne,nextEl:ge.value,prevEl:ye.value,scrollbarEl:he.value,paginationEl:ke.value}),o.value=!1}),Hf("swiper",U),ll(E,()=>{up(()=>{Tj(U.value)})}),ic(()=>{z.value&&(xj({el:z.value,nextEl:ge.value,prevEl:ye.value,paginationEl:ke.value,scrollbarEl:he.value,swiper:U.value},oe),s("swiper",U.value))}),Km(()=>{U.value&&!U.value.destroyed&&U.value.destroy(!0,!1)});function Te(ie){return oe.virtual?Ej(U,ie,E.value):(ie.forEach((ne,te)=>{ne.props||(ne.props={}),ne.props.swiperRef=U,ne.props.swiperSlideIndex=te}),ie)}return()=>{const{slides:ie,slots:ne}=F1(r,Y,Q);return ja(h,{ref:z,class:rD(b.value)},[ne["container-start"],ja(p,{class:vj(oe.wrapperClass)},[ne["wrapper-start"],Te(ie),ne["wrapper-end"]]),QO(t)&&[ja("div",{ref:ye,class:"swiper-button-prev"}),ja("div",{ref:ge,class:"swiper-button-next"})],tD(t)&&ja("div",{ref:he,class:"swiper-scrollbar"}),eD(t)&&ja("div",{ref:ke,class:"swiper-pagination"}),ne["container-end"]])}}},Ij={name:"SwiperSlide",props:{tag:{type:String,default:"div"},swiperRef:{type:Object,required:!1},swiperSlideIndex:{type:Number,default:void 0,required:!1},zoom:{type:Boolean,default:void 0,required:!1},lazy:{type:Boolean,default:!1,required:!1},virtualIndex:{type:[String,Number],default:void 0}},setup(t,e){let{slots:r}=e,s=!1;const{swiperRef:h}=t,p=Qr(null),b=Qr("swiper-slide"),E=Qr(!1);function o(U,H,Y){H===p.value&&(b.value=Y)}ic(()=>{!h||!h.value||(h.value.on("_slideClass",o),s=!0)}),NT(()=>{s||!h||!h.value||(h.value.on("_slideClass",o),s=!0)}),Zm(()=>{!p.value||!h||!h.value||(typeof t.swiperSlideIndex<"u"&&(p.value.swiperSlideIndex=t.swiperSlideIndex),h.value.destroyed&&b.value!=="swiper-slide"&&(b.value="swiper-slide"))}),Km(()=>{!h||!h.value||h.value.off("_slideClass",o)});const O=Ds(()=>({isActive:b.value.indexOf("swiper-slide-active")>=0,isVisible:b.value.indexOf("swiper-slide-visible")>=0,isPrev:b.value.indexOf("swiper-slide-prev")>=0,isNext:b.value.indexOf("swiper-slide-next")>=0}));Hf("swiperSlide",O);const z=()=>{E.value=!0};return()=>ja(t.tag,{class:rD(`${b.value}`),ref:p,"data-swiper-slide-index":typeof t.virtualIndex>"u"&&h&&h.value&&h.value.params.loop?t.swiperSlideIndex:t.virtualIndex,onLoadCapture:z},t.zoom?ja("div",{class:"swiper-zoom-container","data-swiper-zoom":typeof t.zoom=="number"?t.zoom:void 0},[r.default&&r.default(O.value),t.lazy&&!E.value&&ja("div",{class:"swiper-lazy-preloader"})]):[r.default&&r.default(O.value),t.lazy&&!E.value&&ja("div",{class:"swiper-lazy-preloader"})])}};var nD={exports:{}};(function(t,e){var r={};(function(s,h){t.exports=h()})(Os,function(){var s,h,p;function b(o,O){if(!s)s=O;else if(!h)h=O;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",U={};s(U),p=O(U),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}b(["exports"],function(o){function O(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var z,U={},H={};function Y(){if(z)return H;z=1,Object.defineProperty(H,"__esModule",{value:!0}),H.setMatrixArrayType=function(_){H.ARRAY_TYPE=n=_},H.toRadian=function(_){return _*d},H.equals=function(_,f){return Math.abs(_-f)<=u*Math.max(1,Math.abs(_),Math.abs(f))},H.RANDOM=H.ARRAY_TYPE=H.EPSILON=void 0;var u=1e-6;H.EPSILON=u;var n=typeof Float32Array<"u"?Float32Array:Array;H.ARRAY_TYPE=n;var a=Math.random;H.RANDOM=a;var d=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var _=0,f=arguments.length;f--;)_+=arguments[f]*arguments[f];return Math.sqrt(_)}),H}var Q,ge={};function ye(){if(Q)return ge;function u(f){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},u(f)}Q=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.create=function(){var f=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f},ge.clone=function(f){var y=new n.ARRAY_TYPE(4);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y},ge.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f},ge.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f},ge.fromValues=function(f,y,T,C){var M=new n.ARRAY_TYPE(4);return M[0]=f,M[1]=y,M[2]=T,M[3]=C,M},ge.set=function(f,y,T,C,M){return f[0]=y,f[1]=T,f[2]=C,f[3]=M,f},ge.transpose=function(f,y){if(f===y){var T=y[1];f[1]=y[2],f[2]=T}else f[0]=y[0],f[1]=y[2],f[2]=y[1],f[3]=y[3];return f},ge.invert=function(f,y){var T=y[0],C=y[1],M=y[2],x=y[3],I=T*x-M*C;return I?(f[0]=x*(I=1/I),f[1]=-C*I,f[2]=-M*I,f[3]=T*I,f):null},ge.adjoint=function(f,y){var T=y[0];return f[0]=y[3],f[1]=-y[1],f[2]=-y[2],f[3]=T,f},ge.determinant=function(f){return f[0]*f[3]-f[2]*f[1]},ge.multiply=d,ge.rotate=function(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=Math.sin(T),A=Math.cos(T);return f[0]=C*A+x*P,f[1]=M*A+I*P,f[2]=C*-P+x*A,f[3]=M*-P+I*A,f},ge.scale=function(f,y,T){var C=y[1],M=y[2],x=y[3],I=T[0],P=T[1];return f[0]=y[0]*I,f[1]=C*I,f[2]=M*P,f[3]=x*P,f},ge.fromRotation=function(f,y){var T=Math.sin(y),C=Math.cos(y);return f[0]=C,f[1]=T,f[2]=-T,f[3]=C,f},ge.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=y[1],f},ge.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},ge.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3])},ge.LDU=function(f,y,T,C){return f[2]=C[2]/C[0],T[0]=C[0],T[1]=C[1],T[3]=C[3]-f[2]*T[1],[f,y,T]},ge.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f},ge.subtract=_,ge.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]},ge.equals=function(f,y){var T=f[0],C=f[1],M=f[2],x=f[3],I=y[0],P=y[1],A=y[2],R=y[3];return Math.abs(T-I)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(I))&&Math.abs(C-P)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(P))&&Math.abs(M-A)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(A))&&Math.abs(x-R)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(R))},ge.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f},ge.multiplyScalarAndAdd=function(f,y,T,C){return f[0]=y[0]+T[0]*C,f[1]=y[1]+T[1]*C,f[2]=y[2]+T[2]*C,f[3]=y[3]+T[3]*C,f},ge.sub=ge.mul=void 0;var n=function(f,y){if(f&&f.__esModule)return f;if(f===null||u(f)!=="object"&&typeof f!="function")return{default:f};var T=a(void 0);if(T&&T.has(f))return T.get(f);var C={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if(x!=="default"&&Object.prototype.hasOwnProperty.call(f,x)){var I=M?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(C,x,I):C[x]=f[x]}return C.default=f,T&&T.set(f,C),C}(Y());function a(f){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(a=function(C){return C?T:y})(f)}function d(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=T[0],A=T[1],R=T[2],D=T[3];return f[0]=C*P+x*A,f[1]=M*P+I*A,f[2]=C*R+x*D,f[3]=M*R+I*D,f}function _(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f}return ge.mul=d,ge.sub=_,ge}var ke,he={};function oe(){if(ke)return he;function u(f){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},u(f)}ke=1,Object.defineProperty(he,"__esModule",{value:!0}),he.create=function(){var f=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0),f[0]=1,f[3]=1,f},he.clone=function(f){var y=new n.ARRAY_TYPE(6);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y[4]=f[4],y[5]=f[5],y},he.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f[4]=y[4],f[5]=y[5],f},he.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=0,f[5]=0,f},he.fromValues=function(f,y,T,C,M,x){var I=new n.ARRAY_TYPE(6);return I[0]=f,I[1]=y,I[2]=T,I[3]=C,I[4]=M,I[5]=x,I},he.set=function(f,y,T,C,M,x,I){return f[0]=y,f[1]=T,f[2]=C,f[3]=M,f[4]=x,f[5]=I,f},he.invert=function(f,y){var T=y[0],C=y[1],M=y[2],x=y[3],I=y[4],P=y[5],A=T*x-C*M;return A?(f[0]=x*(A=1/A),f[1]=-C*A,f[2]=-M*A,f[3]=T*A,f[4]=(M*P-x*I)*A,f[5]=(C*I-T*P)*A,f):null},he.determinant=function(f){return f[0]*f[3]-f[1]*f[2]},he.multiply=d,he.rotate=function(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=y[4],A=y[5],R=Math.sin(T),D=Math.cos(T);return f[0]=C*D+x*R,f[1]=M*D+I*R,f[2]=C*-R+x*D,f[3]=M*-R+I*D,f[4]=P,f[5]=A,f},he.scale=function(f,y,T){var C=y[1],M=y[2],x=y[3],I=y[4],P=y[5],A=T[0],R=T[1];return f[0]=y[0]*A,f[1]=C*A,f[2]=M*R,f[3]=x*R,f[4]=I,f[5]=P,f},he.translate=function(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=y[4],A=y[5],R=T[0],D=T[1];return f[0]=C,f[1]=M,f[2]=x,f[3]=I,f[4]=C*R+x*D+P,f[5]=M*R+I*D+A,f},he.fromRotation=function(f,y){var T=Math.sin(y),C=Math.cos(y);return f[0]=C,f[1]=T,f[2]=-T,f[3]=C,f[4]=0,f[5]=0,f},he.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=y[1],f[4]=0,f[5]=0,f},he.fromTranslation=function(f,y){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=y[0],f[5]=y[1],f},he.str=function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},he.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],1)},he.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f[4]=y[4]+T[4],f[5]=y[5]+T[5],f},he.subtract=_,he.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f[4]=y[4]*T,f[5]=y[5]*T,f},he.multiplyScalarAndAdd=function(f,y,T,C){return f[0]=y[0]+T[0]*C,f[1]=y[1]+T[1]*C,f[2]=y[2]+T[2]*C,f[3]=y[3]+T[3]*C,f[4]=y[4]+T[4]*C,f[5]=y[5]+T[5]*C,f},he.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]&&f[4]===y[4]&&f[5]===y[5]},he.equals=function(f,y){var T=f[0],C=f[1],M=f[2],x=f[3],I=f[4],P=f[5],A=y[0],R=y[1],D=y[2],N=y[3],j=y[4],Z=y[5];return Math.abs(T-A)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(A))&&Math.abs(C-R)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(R))&&Math.abs(M-D)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(D))&&Math.abs(x-N)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))&&Math.abs(I-j)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(j))&&Math.abs(P-Z)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(Z))},he.sub=he.mul=void 0;var n=function(f,y){if(f&&f.__esModule)return f;if(f===null||u(f)!=="object"&&typeof f!="function")return{default:f};var T=a(void 0);if(T&&T.has(f))return T.get(f);var C={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if(x!=="default"&&Object.prototype.hasOwnProperty.call(f,x)){var I=M?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(C,x,I):C[x]=f[x]}return C.default=f,T&&T.set(f,C),C}(Y());function a(f){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(a=function(C){return C?T:y})(f)}function d(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=y[4],A=y[5],R=T[0],D=T[1],N=T[2],j=T[3],Z=T[4],X=T[5];return f[0]=C*R+x*D,f[1]=M*R+I*D,f[2]=C*N+x*j,f[3]=M*N+I*j,f[4]=C*Z+x*X+P,f[5]=M*Z+I*X+A,f}function _(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f[4]=y[4]-T[4],f[5]=y[5]-T[5],f}return he.mul=d,he.sub=_,he}var ve,be={};function ze(){if(ve)return be;function u(f){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},u(f)}ve=1,Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var f=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f},be.fromMat4=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[4],f[4]=y[5],f[5]=y[6],f[6]=y[8],f[7]=y[9],f[8]=y[10],f},be.clone=function(f){var y=new n.ARRAY_TYPE(9);return y[0]=f[0],y[1]=f[1],y[2]=f[2],y[3]=f[3],y[4]=f[4],y[5]=f[5],y[6]=f[6],y[7]=f[7],y[8]=f[8],y},be.copy=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=y[2],f[3]=y[3],f[4]=y[4],f[5]=y[5],f[6]=y[6],f[7]=y[7],f[8]=y[8],f},be.fromValues=function(f,y,T,C,M,x,I,P,A){var R=new n.ARRAY_TYPE(9);return R[0]=f,R[1]=y,R[2]=T,R[3]=C,R[4]=M,R[5]=x,R[6]=I,R[7]=P,R[8]=A,R},be.set=function(f,y,T,C,M,x,I,P,A,R){return f[0]=y,f[1]=T,f[2]=C,f[3]=M,f[4]=x,f[5]=I,f[6]=P,f[7]=A,f[8]=R,f},be.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},be.transpose=function(f,y){if(f===y){var T=y[1],C=y[2],M=y[5];f[1]=y[3],f[2]=y[6],f[3]=T,f[5]=y[7],f[6]=C,f[7]=M}else f[0]=y[0],f[1]=y[3],f[2]=y[6],f[3]=y[1],f[4]=y[4],f[5]=y[7],f[6]=y[2],f[7]=y[5],f[8]=y[8];return f},be.invert=function(f,y){var T=y[0],C=y[1],M=y[2],x=y[3],I=y[4],P=y[5],A=y[6],R=y[7],D=y[8],N=D*I-P*R,j=-D*x+P*A,Z=R*x-I*A,X=T*N+C*j+M*Z;return X?(f[0]=N*(X=1/X),f[1]=(-D*C+M*R)*X,f[2]=(P*C-M*I)*X,f[3]=j*X,f[4]=(D*T-M*A)*X,f[5]=(-P*T+M*x)*X,f[6]=Z*X,f[7]=(-R*T+C*A)*X,f[8]=(I*T-C*x)*X,f):null},be.adjoint=function(f,y){var T=y[0],C=y[1],M=y[2],x=y[3],I=y[4],P=y[5],A=y[6],R=y[7],D=y[8];return f[0]=I*D-P*R,f[1]=M*R-C*D,f[2]=C*P-M*I,f[3]=P*A-x*D,f[4]=T*D-M*A,f[5]=M*x-T*P,f[6]=x*R-I*A,f[7]=C*A-T*R,f[8]=T*I-C*x,f},be.determinant=function(f){var y=f[3],T=f[4],C=f[5],M=f[6],x=f[7],I=f[8];return f[0]*(I*T-C*x)+f[1]*(-I*y+C*M)+f[2]*(x*y-T*M)},be.multiply=d,be.translate=function(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=y[4],A=y[5],R=y[6],D=y[7],N=y[8],j=T[0],Z=T[1];return f[0]=C,f[1]=M,f[2]=x,f[3]=I,f[4]=P,f[5]=A,f[6]=j*C+Z*I+R,f[7]=j*M+Z*P+D,f[8]=j*x+Z*A+N,f},be.rotate=function(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=y[4],A=y[5],R=y[6],D=y[7],N=y[8],j=Math.sin(T),Z=Math.cos(T);return f[0]=Z*C+j*I,f[1]=Z*M+j*P,f[2]=Z*x+j*A,f[3]=Z*I-j*C,f[4]=Z*P-j*M,f[5]=Z*A-j*x,f[6]=R,f[7]=D,f[8]=N,f},be.scale=function(f,y,T){var C=T[0],M=T[1];return f[0]=C*y[0],f[1]=C*y[1],f[2]=C*y[2],f[3]=M*y[3],f[4]=M*y[4],f[5]=M*y[5],f[6]=y[6],f[7]=y[7],f[8]=y[8],f},be.fromTranslation=function(f,y){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=y[0],f[7]=y[1],f[8]=1,f},be.fromRotation=function(f,y){var T=Math.sin(y),C=Math.cos(y);return f[0]=C,f[1]=T,f[2]=0,f[3]=-T,f[4]=C,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},be.fromScaling=function(f,y){return f[0]=y[0],f[1]=0,f[2]=0,f[3]=0,f[4]=y[1],f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},be.fromMat2d=function(f,y){return f[0]=y[0],f[1]=y[1],f[2]=0,f[3]=y[2],f[4]=y[3],f[5]=0,f[6]=y[4],f[7]=y[5],f[8]=1,f},be.fromQuat=function(f,y){var T=y[0],C=y[1],M=y[2],x=y[3],I=T+T,P=C+C,A=M+M,R=T*I,D=C*I,N=C*P,j=M*I,Z=M*P,X=M*A,G=x*I,J=x*P,se=x*A;return f[0]=1-N-X,f[3]=D-se,f[6]=j+J,f[1]=D+se,f[4]=1-R-X,f[7]=Z-G,f[2]=j-J,f[5]=Z+G,f[8]=1-R-N,f},be.normalFromMat4=function(f,y){var T=y[0],C=y[1],M=y[2],x=y[3],I=y[4],P=y[5],A=y[6],R=y[7],D=y[8],N=y[9],j=y[10],Z=y[11],X=y[12],G=y[13],J=y[14],se=y[15],_e=T*P-C*I,Ce=T*A-M*I,Pe=T*R-x*I,Ee=C*A-M*P,Ve=C*R-x*P,De=M*R-x*A,qe=D*G-N*X,Qe=D*J-j*X,nt=D*se-Z*X,ot=N*J-j*G,lt=N*se-Z*G,yt=j*se-Z*J,ut=_e*yt-Ce*lt+Pe*ot+Ee*nt-Ve*Qe+De*qe;return ut?(f[0]=(P*yt-A*lt+R*ot)*(ut=1/ut),f[1]=(A*nt-I*yt-R*Qe)*ut,f[2]=(I*lt-P*nt+R*qe)*ut,f[3]=(M*lt-C*yt-x*ot)*ut,f[4]=(T*yt-M*nt+x*Qe)*ut,f[5]=(C*nt-T*lt-x*qe)*ut,f[6]=(G*De-J*Ve+se*Ee)*ut,f[7]=(J*Pe-X*De-se*Ce)*ut,f[8]=(X*Ve-G*Pe+se*_e)*ut,f):null},be.projection=function(f,y,T){return f[0]=2/y,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/T,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,f},be.str=function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},be.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},be.add=function(f,y,T){return f[0]=y[0]+T[0],f[1]=y[1]+T[1],f[2]=y[2]+T[2],f[3]=y[3]+T[3],f[4]=y[4]+T[4],f[5]=y[5]+T[5],f[6]=y[6]+T[6],f[7]=y[7]+T[7],f[8]=y[8]+T[8],f},be.subtract=_,be.multiplyScalar=function(f,y,T){return f[0]=y[0]*T,f[1]=y[1]*T,f[2]=y[2]*T,f[3]=y[3]*T,f[4]=y[4]*T,f[5]=y[5]*T,f[6]=y[6]*T,f[7]=y[7]*T,f[8]=y[8]*T,f},be.multiplyScalarAndAdd=function(f,y,T,C){return f[0]=y[0]+T[0]*C,f[1]=y[1]+T[1]*C,f[2]=y[2]+T[2]*C,f[3]=y[3]+T[3]*C,f[4]=y[4]+T[4]*C,f[5]=y[5]+T[5]*C,f[6]=y[6]+T[6]*C,f[7]=y[7]+T[7]*C,f[8]=y[8]+T[8]*C,f},be.exactEquals=function(f,y){return f[0]===y[0]&&f[1]===y[1]&&f[2]===y[2]&&f[3]===y[3]&&f[4]===y[4]&&f[5]===y[5]&&f[6]===y[6]&&f[7]===y[7]&&f[8]===y[8]},be.equals=function(f,y){var T=f[0],C=f[1],M=f[2],x=f[3],I=f[4],P=f[5],A=f[6],R=f[7],D=f[8],N=y[0],j=y[1],Z=y[2],X=y[3],G=y[4],J=y[5],se=y[6],_e=y[7],Ce=y[8];return Math.abs(T-N)<=n.EPSILON*Math.max(1,Math.abs(T),Math.abs(N))&&Math.abs(C-j)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(j))&&Math.abs(M-Z)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(Z))&&Math.abs(x-X)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(X))&&Math.abs(I-G)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(G))&&Math.abs(P-J)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(J))&&Math.abs(A-se)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(se))&&Math.abs(R-_e)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(_e))&&Math.abs(D-Ce)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ce))},be.sub=be.mul=void 0;var n=function(f,y){if(f&&f.__esModule)return f;if(f===null||u(f)!=="object"&&typeof f!="function")return{default:f};var T=a(void 0);if(T&&T.has(f))return T.get(f);var C={},M=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if(x!=="default"&&Object.prototype.hasOwnProperty.call(f,x)){var I=M?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(C,x,I):C[x]=f[x]}return C.default=f,T&&T.set(f,C),C}(Y());function a(f){if(typeof WeakMap!="function")return null;var y=new WeakMap,T=new WeakMap;return(a=function(C){return C?T:y})(f)}function d(f,y,T){var C=y[0],M=y[1],x=y[2],I=y[3],P=y[4],A=y[5],R=y[6],D=y[7],N=y[8],j=T[0],Z=T[1],X=T[2],G=T[3],J=T[4],se=T[5],_e=T[6],Ce=T[7],Pe=T[8];return f[0]=j*C+Z*I+X*R,f[1]=j*M+Z*P+X*D,f[2]=j*x+Z*A+X*N,f[3]=G*C+J*I+se*R,f[4]=G*M+J*P+se*D,f[5]=G*x+J*A+se*N,f[6]=_e*C+Ce*I+Pe*R,f[7]=_e*M+Ce*P+Pe*D,f[8]=_e*x+Ce*A+Pe*N,f}function _(f,y,T){return f[0]=y[0]-T[0],f[1]=y[1]-T[1],f[2]=y[2]-T[2],f[3]=y[3]-T[3],f[4]=y[4]-T[4],f[5]=y[5]-T[5],f[6]=y[6]-T[6],f[7]=y[7]-T[7],f[8]=y[8]-T[8],f}return be.mul=d,be.sub=_,be}var Te,ie={};function ne(){if(Te)return ie;function u(x){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},u(x)}Te=1,Object.defineProperty(ie,"__esModule",{value:!0}),ie.create=function(){var x=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},ie.clone=function(x){var I=new n.ARRAY_TYPE(16);return I[0]=x[0],I[1]=x[1],I[2]=x[2],I[3]=x[3],I[4]=x[4],I[5]=x[5],I[6]=x[6],I[7]=x[7],I[8]=x[8],I[9]=x[9],I[10]=x[10],I[11]=x[11],I[12]=x[12],I[13]=x[13],I[14]=x[14],I[15]=x[15],I},ie.copy=function(x,I){return x[0]=I[0],x[1]=I[1],x[2]=I[2],x[3]=I[3],x[4]=I[4],x[5]=I[5],x[6]=I[6],x[7]=I[7],x[8]=I[8],x[9]=I[9],x[10]=I[10],x[11]=I[11],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15],x},ie.fromValues=function(x,I,P,A,R,D,N,j,Z,X,G,J,se,_e,Ce,Pe){var Ee=new n.ARRAY_TYPE(16);return Ee[0]=x,Ee[1]=I,Ee[2]=P,Ee[3]=A,Ee[4]=R,Ee[5]=D,Ee[6]=N,Ee[7]=j,Ee[8]=Z,Ee[9]=X,Ee[10]=G,Ee[11]=J,Ee[12]=se,Ee[13]=_e,Ee[14]=Ce,Ee[15]=Pe,Ee},ie.set=function(x,I,P,A,R,D,N,j,Z,X,G,J,se,_e,Ce,Pe,Ee){return x[0]=I,x[1]=P,x[2]=A,x[3]=R,x[4]=D,x[5]=N,x[6]=j,x[7]=Z,x[8]=X,x[9]=G,x[10]=J,x[11]=se,x[12]=_e,x[13]=Ce,x[14]=Pe,x[15]=Ee,x},ie.identity=d,ie.transpose=function(x,I){if(x===I){var P=I[1],A=I[2],R=I[3],D=I[6],N=I[7],j=I[11];x[1]=I[4],x[2]=I[8],x[3]=I[12],x[4]=P,x[6]=I[9],x[7]=I[13],x[8]=A,x[9]=D,x[11]=I[14],x[12]=R,x[13]=N,x[14]=j}else x[0]=I[0],x[1]=I[4],x[2]=I[8],x[3]=I[12],x[4]=I[1],x[5]=I[5],x[6]=I[9],x[7]=I[13],x[8]=I[2],x[9]=I[6],x[10]=I[10],x[11]=I[14],x[12]=I[3],x[13]=I[7],x[14]=I[11],x[15]=I[15];return x},ie.invert=function(x,I){var P=I[0],A=I[1],R=I[2],D=I[3],N=I[4],j=I[5],Z=I[6],X=I[7],G=I[8],J=I[9],se=I[10],_e=I[11],Ce=I[12],Pe=I[13],Ee=I[14],Ve=I[15],De=P*j-A*N,qe=P*Z-R*N,Qe=P*X-D*N,nt=A*Z-R*j,ot=A*X-D*j,lt=R*X-D*Z,yt=G*Pe-J*Ce,ut=G*Ee-se*Ce,Mt=G*Ve-_e*Ce,Vt=J*Ee-se*Pe,Tt=J*Ve-_e*Pe,wr=se*Ve-_e*Ee,dr=De*wr-qe*Tt+Qe*Vt+nt*Mt-ot*ut+lt*yt;return dr?(x[0]=(j*wr-Z*Tt+X*Vt)*(dr=1/dr),x[1]=(R*Tt-A*wr-D*Vt)*dr,x[2]=(Pe*lt-Ee*ot+Ve*nt)*dr,x[3]=(se*ot-J*lt-_e*nt)*dr,x[4]=(Z*Mt-N*wr-X*ut)*dr,x[5]=(P*wr-R*Mt+D*ut)*dr,x[6]=(Ee*Qe-Ce*lt-Ve*qe)*dr,x[7]=(G*lt-se*Qe+_e*qe)*dr,x[8]=(N*Tt-j*Mt+X*yt)*dr,x[9]=(A*Mt-P*Tt-D*yt)*dr,x[10]=(Ce*ot-Pe*Qe+Ve*De)*dr,x[11]=(J*Qe-G*ot-_e*De)*dr,x[12]=(j*ut-N*Vt-Z*yt)*dr,x[13]=(P*Vt-A*ut+R*yt)*dr,x[14]=(Pe*qe-Ce*nt-Ee*De)*dr,x[15]=(G*nt-J*qe+se*De)*dr,x):null},ie.adjoint=function(x,I){var P=I[0],A=I[1],R=I[2],D=I[3],N=I[4],j=I[5],Z=I[6],X=I[7],G=I[8],J=I[9],se=I[10],_e=I[11],Ce=I[12],Pe=I[13],Ee=I[14],Ve=I[15];return x[0]=j*(se*Ve-_e*Ee)-J*(Z*Ve-X*Ee)+Pe*(Z*_e-X*se),x[1]=-(A*(se*Ve-_e*Ee)-J*(R*Ve-D*Ee)+Pe*(R*_e-D*se)),x[2]=A*(Z*Ve-X*Ee)-j*(R*Ve-D*Ee)+Pe*(R*X-D*Z),x[3]=-(A*(Z*_e-X*se)-j*(R*_e-D*se)+J*(R*X-D*Z)),x[4]=-(N*(se*Ve-_e*Ee)-G*(Z*Ve-X*Ee)+Ce*(Z*_e-X*se)),x[5]=P*(se*Ve-_e*Ee)-G*(R*Ve-D*Ee)+Ce*(R*_e-D*se),x[6]=-(P*(Z*Ve-X*Ee)-N*(R*Ve-D*Ee)+Ce*(R*X-D*Z)),x[7]=P*(Z*_e-X*se)-N*(R*_e-D*se)+G*(R*X-D*Z),x[8]=N*(J*Ve-_e*Pe)-G*(j*Ve-X*Pe)+Ce*(j*_e-X*J),x[9]=-(P*(J*Ve-_e*Pe)-G*(A*Ve-D*Pe)+Ce*(A*_e-D*J)),x[10]=P*(j*Ve-X*Pe)-N*(A*Ve-D*Pe)+Ce*(A*X-D*j),x[11]=-(P*(j*_e-X*J)-N*(A*_e-D*J)+G*(A*X-D*j)),x[12]=-(N*(J*Ee-se*Pe)-G*(j*Ee-Z*Pe)+Ce*(j*se-Z*J)),x[13]=P*(J*Ee-se*Pe)-G*(A*Ee-R*Pe)+Ce*(A*se-R*J),x[14]=-(P*(j*Ee-Z*Pe)-N*(A*Ee-R*Pe)+Ce*(A*Z-R*j)),x[15]=P*(j*se-Z*J)-N*(A*se-R*J)+G*(A*Z-R*j),x},ie.determinant=function(x){var I=x[0],P=x[1],A=x[2],R=x[3],D=x[4],N=x[5],j=x[6],Z=x[7],X=x[8],G=x[9],J=x[10],se=x[11],_e=x[12],Ce=x[13],Pe=x[14],Ee=x[15];return(I*N-P*D)*(J*Ee-se*Pe)-(I*j-A*D)*(G*Ee-se*Ce)+(I*Z-R*D)*(G*Pe-J*Ce)+(P*j-A*N)*(X*Ee-se*_e)-(P*Z-R*N)*(X*Pe-J*_e)+(A*Z-R*j)*(X*Ce-G*_e)},ie.multiply=_,ie.translate=function(x,I,P){var A,R,D,N,j,Z,X,G,J,se,_e,Ce,Pe=P[0],Ee=P[1],Ve=P[2];return I===x?(x[12]=I[0]*Pe+I[4]*Ee+I[8]*Ve+I[12],x[13]=I[1]*Pe+I[5]*Ee+I[9]*Ve+I[13],x[14]=I[2]*Pe+I[6]*Ee+I[10]*Ve+I[14],x[15]=I[3]*Pe+I[7]*Ee+I[11]*Ve+I[15]):(R=I[1],D=I[2],N=I[3],j=I[4],Z=I[5],X=I[6],G=I[7],J=I[8],se=I[9],_e=I[10],Ce=I[11],x[0]=A=I[0],x[1]=R,x[2]=D,x[3]=N,x[4]=j,x[5]=Z,x[6]=X,x[7]=G,x[8]=J,x[9]=se,x[10]=_e,x[11]=Ce,x[12]=A*Pe+j*Ee+J*Ve+I[12],x[13]=R*Pe+Z*Ee+se*Ve+I[13],x[14]=D*Pe+X*Ee+_e*Ve+I[14],x[15]=N*Pe+G*Ee+Ce*Ve+I[15]),x},ie.scale=function(x,I,P){var A=P[0],R=P[1],D=P[2];return x[0]=I[0]*A,x[1]=I[1]*A,x[2]=I[2]*A,x[3]=I[3]*A,x[4]=I[4]*R,x[5]=I[5]*R,x[6]=I[6]*R,x[7]=I[7]*R,x[8]=I[8]*D,x[9]=I[9]*D,x[10]=I[10]*D,x[11]=I[11]*D,x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15],x},ie.rotate=function(x,I,P,A){var R,D,N,j,Z,X,G,J,se,_e,Ce,Pe,Ee,Ve,De,qe,Qe,nt,ot,lt,yt,ut,Mt,Vt,Tt=A[0],wr=A[1],dr=A[2],er=Math.hypot(Tt,wr,dr);return er<n.EPSILON?null:(Tt*=er=1/er,wr*=er,dr*=er,R=Math.sin(P),D=Math.cos(P),Z=I[1],X=I[2],G=I[3],se=I[5],_e=I[6],Ce=I[7],Ee=I[9],Ve=I[10],De=I[11],qe=Tt*Tt*(N=1-D)+D,ot=Tt*wr*N-dr*R,lt=wr*wr*N+D,yt=dr*wr*N+Tt*R,ut=Tt*dr*N+wr*R,Mt=wr*dr*N-Tt*R,Vt=dr*dr*N+D,x[0]=(j=I[0])*qe+(J=I[4])*(Qe=wr*Tt*N+dr*R)+(Pe=I[8])*(nt=dr*Tt*N-wr*R),x[1]=Z*qe+se*Qe+Ee*nt,x[2]=X*qe+_e*Qe+Ve*nt,x[3]=G*qe+Ce*Qe+De*nt,x[4]=j*ot+J*lt+Pe*yt,x[5]=Z*ot+se*lt+Ee*yt,x[6]=X*ot+_e*lt+Ve*yt,x[7]=G*ot+Ce*lt+De*yt,x[8]=j*ut+J*Mt+Pe*Vt,x[9]=Z*ut+se*Mt+Ee*Vt,x[10]=X*ut+_e*Mt+Ve*Vt,x[11]=G*ut+Ce*Mt+De*Vt,I!==x&&(x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x)},ie.rotateX=function(x,I,P){var A=Math.sin(P),R=Math.cos(P),D=I[4],N=I[5],j=I[6],Z=I[7],X=I[8],G=I[9],J=I[10],se=I[11];return I!==x&&(x[0]=I[0],x[1]=I[1],x[2]=I[2],x[3]=I[3],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[4]=D*R+X*A,x[5]=N*R+G*A,x[6]=j*R+J*A,x[7]=Z*R+se*A,x[8]=X*R-D*A,x[9]=G*R-N*A,x[10]=J*R-j*A,x[11]=se*R-Z*A,x},ie.rotateY=function(x,I,P){var A=Math.sin(P),R=Math.cos(P),D=I[0],N=I[1],j=I[2],Z=I[3],X=I[8],G=I[9],J=I[10],se=I[11];return I!==x&&(x[4]=I[4],x[5]=I[5],x[6]=I[6],x[7]=I[7],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[0]=D*R-X*A,x[1]=N*R-G*A,x[2]=j*R-J*A,x[3]=Z*R-se*A,x[8]=D*A+X*R,x[9]=N*A+G*R,x[10]=j*A+J*R,x[11]=Z*A+se*R,x},ie.rotateZ=function(x,I,P){var A=Math.sin(P),R=Math.cos(P),D=I[0],N=I[1],j=I[2],Z=I[3],X=I[4],G=I[5],J=I[6],se=I[7];return I!==x&&(x[8]=I[8],x[9]=I[9],x[10]=I[10],x[11]=I[11],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[0]=D*R+X*A,x[1]=N*R+G*A,x[2]=j*R+J*A,x[3]=Z*R+se*A,x[4]=X*R-D*A,x[5]=G*R-N*A,x[6]=J*R-j*A,x[7]=se*R-Z*A,x},ie.fromTranslation=function(x,I){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x},ie.fromScaling=function(x,I){return x[0]=I[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=I[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=I[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ie.fromRotation=function(x,I,P){var A,R,D,N=P[0],j=P[1],Z=P[2],X=Math.hypot(N,j,Z);return X<n.EPSILON?null:(N*=X=1/X,j*=X,Z*=X,A=Math.sin(I),R=Math.cos(I),x[0]=N*N*(D=1-R)+R,x[1]=j*N*D+Z*A,x[2]=Z*N*D-j*A,x[3]=0,x[4]=N*j*D-Z*A,x[5]=j*j*D+R,x[6]=Z*j*D+N*A,x[7]=0,x[8]=N*Z*D+j*A,x[9]=j*Z*D-N*A,x[10]=Z*Z*D+R,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},ie.fromXRotation=function(x,I){var P=Math.sin(I),A=Math.cos(I);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=A,x[6]=P,x[7]=0,x[8]=0,x[9]=-P,x[10]=A,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ie.fromYRotation=function(x,I){var P=Math.sin(I),A=Math.cos(I);return x[0]=A,x[1]=0,x[2]=-P,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=P,x[9]=0,x[10]=A,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ie.fromZRotation=function(x,I){var P=Math.sin(I),A=Math.cos(I);return x[0]=A,x[1]=P,x[2]=0,x[3]=0,x[4]=-P,x[5]=A,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ie.fromRotationTranslation=f,ie.fromQuat2=function(x,I){var P=new n.ARRAY_TYPE(3),A=-I[0],R=-I[1],D=-I[2],N=I[3],j=I[4],Z=I[5],X=I[6],G=I[7],J=A*A+R*R+D*D+N*N;return J>0?(P[0]=2*(j*N+G*A+Z*D-X*R)/J,P[1]=2*(Z*N+G*R+X*A-j*D)/J,P[2]=2*(X*N+G*D+j*R-Z*A)/J):(P[0]=2*(j*N+G*A+Z*D-X*R),P[1]=2*(Z*N+G*R+X*A-j*D),P[2]=2*(X*N+G*D+j*R-Z*A)),f(x,I,P),x},ie.getTranslation=function(x,I){return x[0]=I[12],x[1]=I[13],x[2]=I[14],x},ie.getScaling=y,ie.getRotation=function(x,I){var P=new n.ARRAY_TYPE(3);y(P,I);var A=1/P[0],R=1/P[1],D=1/P[2],N=I[0]*A,j=I[1]*R,Z=I[2]*D,X=I[4]*A,G=I[5]*R,J=I[6]*D,se=I[8]*A,_e=I[9]*R,Ce=I[10]*D,Pe=N+G+Ce,Ee=0;return Pe>0?(Ee=2*Math.sqrt(Pe+1),x[3]=.25*Ee,x[0]=(J-_e)/Ee,x[1]=(se-Z)/Ee,x[2]=(j-X)/Ee):N>G&&N>Ce?(Ee=2*Math.sqrt(1+N-G-Ce),x[3]=(J-_e)/Ee,x[0]=.25*Ee,x[1]=(j+X)/Ee,x[2]=(se+Z)/Ee):G>Ce?(Ee=2*Math.sqrt(1+G-N-Ce),x[3]=(se-Z)/Ee,x[0]=(j+X)/Ee,x[1]=.25*Ee,x[2]=(J+_e)/Ee):(Ee=2*Math.sqrt(1+Ce-N-G),x[3]=(j-X)/Ee,x[0]=(se+Z)/Ee,x[1]=(J+_e)/Ee,x[2]=.25*Ee),x},ie.fromRotationTranslationScale=function(x,I,P,A){var R=I[0],D=I[1],N=I[2],j=I[3],Z=R+R,X=D+D,G=N+N,J=R*Z,se=R*X,_e=R*G,Ce=D*X,Pe=D*G,Ee=N*G,Ve=j*Z,De=j*X,qe=j*G,Qe=A[0],nt=A[1],ot=A[2];return x[0]=(1-(Ce+Ee))*Qe,x[1]=(se+qe)*Qe,x[2]=(_e-De)*Qe,x[3]=0,x[4]=(se-qe)*nt,x[5]=(1-(J+Ee))*nt,x[6]=(Pe+Ve)*nt,x[7]=0,x[8]=(_e+De)*ot,x[9]=(Pe-Ve)*ot,x[10]=(1-(J+Ce))*ot,x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x},ie.fromRotationTranslationScaleOrigin=function(x,I,P,A,R){var D=I[0],N=I[1],j=I[2],Z=I[3],X=D+D,G=N+N,J=j+j,se=D*X,_e=D*G,Ce=D*J,Pe=N*G,Ee=N*J,Ve=j*J,De=Z*X,qe=Z*G,Qe=Z*J,nt=A[0],ot=A[1],lt=A[2],yt=R[0],ut=R[1],Mt=R[2],Vt=(1-(Pe+Ve))*nt,Tt=(_e+Qe)*nt,wr=(Ce-qe)*nt,dr=(_e-Qe)*ot,er=(1-(se+Ve))*ot,qt=(Ee+De)*ot,Vr=(Ce+qe)*lt,xr=(Ee-De)*lt,Ir=(1-(se+Pe))*lt;return x[0]=Vt,x[1]=Tt,x[2]=wr,x[3]=0,x[4]=dr,x[5]=er,x[6]=qt,x[7]=0,x[8]=Vr,x[9]=xr,x[10]=Ir,x[11]=0,x[12]=P[0]+yt-(Vt*yt+dr*ut+Vr*Mt),x[13]=P[1]+ut-(Tt*yt+er*ut+xr*Mt),x[14]=P[2]+Mt-(wr*yt+qt*ut+Ir*Mt),x[15]=1,x},ie.fromQuat=function(x,I){var P=I[0],A=I[1],R=I[2],D=I[3],N=P+P,j=A+A,Z=R+R,X=P*N,G=A*N,J=A*j,se=R*N,_e=R*j,Ce=R*Z,Pe=D*N,Ee=D*j,Ve=D*Z;return x[0]=1-J-Ce,x[1]=G+Ve,x[2]=se-Ee,x[3]=0,x[4]=G-Ve,x[5]=1-X-Ce,x[6]=_e+Pe,x[7]=0,x[8]=se+Ee,x[9]=_e-Pe,x[10]=1-X-J,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},ie.frustum=function(x,I,P,A,R,D,N){var j=1/(P-I),Z=1/(R-A),X=1/(D-N);return x[0]=2*D*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*D*Z,x[6]=0,x[7]=0,x[8]=(P+I)*j,x[9]=(R+A)*Z,x[10]=(N+D)*X,x[11]=-1,x[12]=0,x[13]=0,x[14]=N*D*2*X,x[15]=0,x},ie.perspectiveNO=T,ie.perspectiveZO=function(x,I,P,A,R){var D,N=1/Math.tan(I/2);return x[0]=N/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=N,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,R!=null&&R!==1/0?(x[10]=R*(D=1/(A-R)),x[14]=R*A*D):(x[10]=-1,x[14]=-A),x},ie.perspectiveFromFieldOfView=function(x,I,P,A){var R=Math.tan(I.upDegrees*Math.PI/180),D=Math.tan(I.downDegrees*Math.PI/180),N=Math.tan(I.leftDegrees*Math.PI/180),j=Math.tan(I.rightDegrees*Math.PI/180),Z=2/(N+j),X=2/(R+D);return x[0]=Z,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=X,x[6]=0,x[7]=0,x[8]=-(N-j)*Z*.5,x[9]=(R-D)*X*.5,x[10]=A/(P-A),x[11]=-1,x[12]=0,x[13]=0,x[14]=A*P/(P-A),x[15]=0,x},ie.orthoNO=C,ie.orthoZO=function(x,I,P,A,R,D,N){var j=1/(I-P),Z=1/(A-R),X=1/(D-N);return x[0]=-2*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*Z,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=X,x[11]=0,x[12]=(I+P)*j,x[13]=(R+A)*Z,x[14]=D*X,x[15]=1,x},ie.lookAt=function(x,I,P,A){var R,D,N,j,Z,X,G,J,se,_e,Ce=I[0],Pe=I[1],Ee=I[2],Ve=A[0],De=A[1],qe=A[2],Qe=P[0],nt=P[1],ot=P[2];return Math.abs(Ce-Qe)<n.EPSILON&&Math.abs(Pe-nt)<n.EPSILON&&Math.abs(Ee-ot)<n.EPSILON?d(x):(G=Ce-Qe,J=Pe-nt,se=Ee-ot,R=De*(se*=_e=1/Math.hypot(G,J,se))-qe*(J*=_e),D=qe*(G*=_e)-Ve*se,N=Ve*J-De*G,(_e=Math.hypot(R,D,N))?(R*=_e=1/_e,D*=_e,N*=_e):(R=0,D=0,N=0),j=J*N-se*D,Z=se*R-G*N,X=G*D-J*R,(_e=Math.hypot(j,Z,X))?(j*=_e=1/_e,Z*=_e,X*=_e):(j=0,Z=0,X=0),x[0]=R,x[1]=j,x[2]=G,x[3]=0,x[4]=D,x[5]=Z,x[6]=J,x[7]=0,x[8]=N,x[9]=X,x[10]=se,x[11]=0,x[12]=-(R*Ce+D*Pe+N*Ee),x[13]=-(j*Ce+Z*Pe+X*Ee),x[14]=-(G*Ce+J*Pe+se*Ee),x[15]=1,x)},ie.targetTo=function(x,I,P,A){var R=I[0],D=I[1],N=I[2],j=A[0],Z=A[1],X=A[2],G=R-P[0],J=D-P[1],se=N-P[2],_e=G*G+J*J+se*se;_e>0&&(G*=_e=1/Math.sqrt(_e),J*=_e,se*=_e);var Ce=Z*se-X*J,Pe=X*G-j*se,Ee=j*J-Z*G;return(_e=Ce*Ce+Pe*Pe+Ee*Ee)>0&&(Ce*=_e=1/Math.sqrt(_e),Pe*=_e,Ee*=_e),x[0]=Ce,x[1]=Pe,x[2]=Ee,x[3]=0,x[4]=J*Ee-se*Pe,x[5]=se*Ce-G*Ee,x[6]=G*Pe-J*Ce,x[7]=0,x[8]=G,x[9]=J,x[10]=se,x[11]=0,x[12]=R,x[13]=D,x[14]=N,x[15]=1,x},ie.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},ie.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},ie.add=function(x,I,P){return x[0]=I[0]+P[0],x[1]=I[1]+P[1],x[2]=I[2]+P[2],x[3]=I[3]+P[3],x[4]=I[4]+P[4],x[5]=I[5]+P[5],x[6]=I[6]+P[6],x[7]=I[7]+P[7],x[8]=I[8]+P[8],x[9]=I[9]+P[9],x[10]=I[10]+P[10],x[11]=I[11]+P[11],x[12]=I[12]+P[12],x[13]=I[13]+P[13],x[14]=I[14]+P[14],x[15]=I[15]+P[15],x},ie.subtract=M,ie.multiplyScalar=function(x,I,P){return x[0]=I[0]*P,x[1]=I[1]*P,x[2]=I[2]*P,x[3]=I[3]*P,x[4]=I[4]*P,x[5]=I[5]*P,x[6]=I[6]*P,x[7]=I[7]*P,x[8]=I[8]*P,x[9]=I[9]*P,x[10]=I[10]*P,x[11]=I[11]*P,x[12]=I[12]*P,x[13]=I[13]*P,x[14]=I[14]*P,x[15]=I[15]*P,x},ie.multiplyScalarAndAdd=function(x,I,P,A){return x[0]=I[0]+P[0]*A,x[1]=I[1]+P[1]*A,x[2]=I[2]+P[2]*A,x[3]=I[3]+P[3]*A,x[4]=I[4]+P[4]*A,x[5]=I[5]+P[5]*A,x[6]=I[6]+P[6]*A,x[7]=I[7]+P[7]*A,x[8]=I[8]+P[8]*A,x[9]=I[9]+P[9]*A,x[10]=I[10]+P[10]*A,x[11]=I[11]+P[11]*A,x[12]=I[12]+P[12]*A,x[13]=I[13]+P[13]*A,x[14]=I[14]+P[14]*A,x[15]=I[15]+P[15]*A,x},ie.exactEquals=function(x,I){return x[0]===I[0]&&x[1]===I[1]&&x[2]===I[2]&&x[3]===I[3]&&x[4]===I[4]&&x[5]===I[5]&&x[6]===I[6]&&x[7]===I[7]&&x[8]===I[8]&&x[9]===I[9]&&x[10]===I[10]&&x[11]===I[11]&&x[12]===I[12]&&x[13]===I[13]&&x[14]===I[14]&&x[15]===I[15]},ie.equals=function(x,I){var P=x[0],A=x[1],R=x[2],D=x[3],N=x[4],j=x[5],Z=x[6],X=x[7],G=x[8],J=x[9],se=x[10],_e=x[11],Ce=x[12],Pe=x[13],Ee=x[14],Ve=x[15],De=I[0],qe=I[1],Qe=I[2],nt=I[3],ot=I[4],lt=I[5],yt=I[6],ut=I[7],Mt=I[8],Vt=I[9],Tt=I[10],wr=I[11],dr=I[12],er=I[13],qt=I[14],Vr=I[15];return Math.abs(P-De)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(De))&&Math.abs(A-qe)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(qe))&&Math.abs(R-Qe)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(Qe))&&Math.abs(D-nt)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(nt))&&Math.abs(N-ot)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(ot))&&Math.abs(j-lt)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(lt))&&Math.abs(Z-yt)<=n.EPSILON*Math.max(1,Math.abs(Z),Math.abs(yt))&&Math.abs(X-ut)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(ut))&&Math.abs(G-Mt)<=n.EPSILON*Math.max(1,Math.abs(G),Math.abs(Mt))&&Math.abs(J-Vt)<=n.EPSILON*Math.max(1,Math.abs(J),Math.abs(Vt))&&Math.abs(se-Tt)<=n.EPSILON*Math.max(1,Math.abs(se),Math.abs(Tt))&&Math.abs(_e-wr)<=n.EPSILON*Math.max(1,Math.abs(_e),Math.abs(wr))&&Math.abs(Ce-dr)<=n.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(dr))&&Math.abs(Pe-er)<=n.EPSILON*Math.max(1,Math.abs(Pe),Math.abs(er))&&Math.abs(Ee-qt)<=n.EPSILON*Math.max(1,Math.abs(Ee),Math.abs(qt))&&Math.abs(Ve-Vr)<=n.EPSILON*Math.max(1,Math.abs(Ve),Math.abs(Vr))},ie.sub=ie.mul=ie.ortho=ie.perspective=void 0;var n=function(x,I){if(x&&x.__esModule)return x;if(x===null||u(x)!=="object"&&typeof x!="function")return{default:x};var P=a(void 0);if(P&&P.has(x))return P.get(x);var A={},R=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var D in x)if(D!=="default"&&Object.prototype.hasOwnProperty.call(x,D)){var N=R?Object.getOwnPropertyDescriptor(x,D):null;N&&(N.get||N.set)?Object.defineProperty(A,D,N):A[D]=x[D]}return A.default=x,P&&P.set(x,A),A}(Y());function a(x){if(typeof WeakMap!="function")return null;var I=new WeakMap,P=new WeakMap;return(a=function(A){return A?P:I})(x)}function d(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function _(x,I,P){var A=I[0],R=I[1],D=I[2],N=I[3],j=I[4],Z=I[5],X=I[6],G=I[7],J=I[8],se=I[9],_e=I[10],Ce=I[11],Pe=I[12],Ee=I[13],Ve=I[14],De=I[15],qe=P[0],Qe=P[1],nt=P[2],ot=P[3];return x[0]=qe*A+Qe*j+nt*J+ot*Pe,x[1]=qe*R+Qe*Z+nt*se+ot*Ee,x[2]=qe*D+Qe*X+nt*_e+ot*Ve,x[3]=qe*N+Qe*G+nt*Ce+ot*De,x[4]=(qe=P[4])*A+(Qe=P[5])*j+(nt=P[6])*J+(ot=P[7])*Pe,x[5]=qe*R+Qe*Z+nt*se+ot*Ee,x[6]=qe*D+Qe*X+nt*_e+ot*Ve,x[7]=qe*N+Qe*G+nt*Ce+ot*De,x[8]=(qe=P[8])*A+(Qe=P[9])*j+(nt=P[10])*J+(ot=P[11])*Pe,x[9]=qe*R+Qe*Z+nt*se+ot*Ee,x[10]=qe*D+Qe*X+nt*_e+ot*Ve,x[11]=qe*N+Qe*G+nt*Ce+ot*De,x[12]=(qe=P[12])*A+(Qe=P[13])*j+(nt=P[14])*J+(ot=P[15])*Pe,x[13]=qe*R+Qe*Z+nt*se+ot*Ee,x[14]=qe*D+Qe*X+nt*_e+ot*Ve,x[15]=qe*N+Qe*G+nt*Ce+ot*De,x}function f(x,I,P){var A=I[0],R=I[1],D=I[2],N=I[3],j=A+A,Z=R+R,X=D+D,G=A*j,J=A*Z,se=A*X,_e=R*Z,Ce=R*X,Pe=D*X,Ee=N*j,Ve=N*Z,De=N*X;return x[0]=1-(_e+Pe),x[1]=J+De,x[2]=se-Ve,x[3]=0,x[4]=J-De,x[5]=1-(G+Pe),x[6]=Ce+Ee,x[7]=0,x[8]=se+Ve,x[9]=Ce-Ee,x[10]=1-(G+_e),x[11]=0,x[12]=P[0],x[13]=P[1],x[14]=P[2],x[15]=1,x}function y(x,I){var P=I[4],A=I[5],R=I[6],D=I[8],N=I[9],j=I[10];return x[0]=Math.hypot(I[0],I[1],I[2]),x[1]=Math.hypot(P,A,R),x[2]=Math.hypot(D,N,j),x}function T(x,I,P,A,R){var D,N=1/Math.tan(I/2);return x[0]=N/P,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=N,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,R!=null&&R!==1/0?(x[10]=(R+A)*(D=1/(A-R)),x[14]=2*R*A*D):(x[10]=-1,x[14]=-2*A),x}function C(x,I,P,A,R,D,N){var j=1/(I-P),Z=1/(A-R),X=1/(D-N);return x[0]=-2*j,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*Z,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*X,x[11]=0,x[12]=(I+P)*j,x[13]=(R+A)*Z,x[14]=(N+D)*X,x[15]=1,x}function M(x,I,P){return x[0]=I[0]-P[0],x[1]=I[1]-P[1],x[2]=I[2]-P[2],x[3]=I[3]-P[3],x[4]=I[4]-P[4],x[5]=I[5]-P[5],x[6]=I[6]-P[6],x[7]=I[7]-P[7],x[8]=I[8]-P[8],x[9]=I[9]-P[9],x[10]=I[10]-P[10],x[11]=I[11]-P[11],x[12]=I[12]-P[12],x[13]=I[13]-P[13],x[14]=I[14]-P[14],x[15]=I[15]-P[15],x}return ie.perspective=T,ie.ortho=C,ie.mul=_,ie.sub=M,ie}var te,re={},me={};function we(){if(te)return me;function u(R){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(D){return typeof D}:function(D){return D&&typeof Symbol=="function"&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},u(R)}te=1,Object.defineProperty(me,"__esModule",{value:!0}),me.create=d,me.clone=function(R){var D=new n.ARRAY_TYPE(3);return D[0]=R[0],D[1]=R[1],D[2]=R[2],D},me.length=_,me.fromValues=function(R,D,N){var j=new n.ARRAY_TYPE(3);return j[0]=R,j[1]=D,j[2]=N,j},me.copy=function(R,D){return R[0]=D[0],R[1]=D[1],R[2]=D[2],R},me.set=function(R,D,N,j){return R[0]=D,R[1]=N,R[2]=j,R},me.add=function(R,D,N){return R[0]=D[0]+N[0],R[1]=D[1]+N[1],R[2]=D[2]+N[2],R},me.subtract=f,me.multiply=y,me.divide=T,me.ceil=function(R,D){return R[0]=Math.ceil(D[0]),R[1]=Math.ceil(D[1]),R[2]=Math.ceil(D[2]),R},me.floor=function(R,D){return R[0]=Math.floor(D[0]),R[1]=Math.floor(D[1]),R[2]=Math.floor(D[2]),R},me.min=function(R,D,N){return R[0]=Math.min(D[0],N[0]),R[1]=Math.min(D[1],N[1]),R[2]=Math.min(D[2],N[2]),R},me.max=function(R,D,N){return R[0]=Math.max(D[0],N[0]),R[1]=Math.max(D[1],N[1]),R[2]=Math.max(D[2],N[2]),R},me.round=function(R,D){return R[0]=Math.round(D[0]),R[1]=Math.round(D[1]),R[2]=Math.round(D[2]),R},me.scale=function(R,D,N){return R[0]=D[0]*N,R[1]=D[1]*N,R[2]=D[2]*N,R},me.scaleAndAdd=function(R,D,N,j){return R[0]=D[0]+N[0]*j,R[1]=D[1]+N[1]*j,R[2]=D[2]+N[2]*j,R},me.distance=C,me.squaredDistance=M,me.squaredLength=x,me.negate=function(R,D){return R[0]=-D[0],R[1]=-D[1],R[2]=-D[2],R},me.inverse=function(R,D){return R[0]=1/D[0],R[1]=1/D[1],R[2]=1/D[2],R},me.normalize=function(R,D){var N=D[0],j=D[1],Z=D[2],X=N*N+j*j+Z*Z;return X>0&&(X=1/Math.sqrt(X)),R[0]=D[0]*X,R[1]=D[1]*X,R[2]=D[2]*X,R},me.dot=I,me.cross=function(R,D,N){var j=D[0],Z=D[1],X=D[2],G=N[0],J=N[1],se=N[2];return R[0]=Z*se-X*J,R[1]=X*G-j*se,R[2]=j*J-Z*G,R},me.lerp=function(R,D,N,j){var Z=D[0],X=D[1],G=D[2];return R[0]=Z+j*(N[0]-Z),R[1]=X+j*(N[1]-X),R[2]=G+j*(N[2]-G),R},me.hermite=function(R,D,N,j,Z,X){var G=X*X,J=G*(2*X-3)+1,se=G*(X-2)+X,_e=G*(X-1),Ce=G*(3-2*X);return R[0]=D[0]*J+N[0]*se+j[0]*_e+Z[0]*Ce,R[1]=D[1]*J+N[1]*se+j[1]*_e+Z[1]*Ce,R[2]=D[2]*J+N[2]*se+j[2]*_e+Z[2]*Ce,R},me.bezier=function(R,D,N,j,Z,X){var G=1-X,J=G*G,se=X*X,_e=J*G,Ce=3*X*J,Pe=3*se*G,Ee=se*X;return R[0]=D[0]*_e+N[0]*Ce+j[0]*Pe+Z[0]*Ee,R[1]=D[1]*_e+N[1]*Ce+j[1]*Pe+Z[1]*Ee,R[2]=D[2]*_e+N[2]*Ce+j[2]*Pe+Z[2]*Ee,R},me.random=function(R,D){D=D||1;var N=2*n.RANDOM()*Math.PI,j=2*n.RANDOM()-1,Z=Math.sqrt(1-j*j)*D;return R[0]=Math.cos(N)*Z,R[1]=Math.sin(N)*Z,R[2]=j*D,R},me.transformMat4=function(R,D,N){var j=D[0],Z=D[1],X=D[2],G=N[3]*j+N[7]*Z+N[11]*X+N[15];return R[0]=(N[0]*j+N[4]*Z+N[8]*X+N[12])/(G=G||1),R[1]=(N[1]*j+N[5]*Z+N[9]*X+N[13])/G,R[2]=(N[2]*j+N[6]*Z+N[10]*X+N[14])/G,R},me.transformMat3=function(R,D,N){var j=D[0],Z=D[1],X=D[2];return R[0]=j*N[0]+Z*N[3]+X*N[6],R[1]=j*N[1]+Z*N[4]+X*N[7],R[2]=j*N[2]+Z*N[5]+X*N[8],R},me.transformQuat=function(R,D,N){var j=N[0],Z=N[1],X=N[2],G=D[0],J=D[1],se=D[2],_e=Z*se-X*J,Ce=X*G-j*se,Pe=j*J-Z*G,Ee=Z*Pe-X*Ce,Ve=X*_e-j*Pe,De=j*Ce-Z*_e,qe=2*N[3];return Ce*=qe,Pe*=qe,Ve*=2,De*=2,R[0]=G+(_e*=qe)+(Ee*=2),R[1]=J+Ce+Ve,R[2]=se+Pe+De,R},me.rotateX=function(R,D,N,j){var Z=[],X=[];return Z[0]=D[0]-N[0],Z[1]=D[1]-N[1],Z[2]=D[2]-N[2],X[0]=Z[0],X[1]=Z[1]*Math.cos(j)-Z[2]*Math.sin(j),X[2]=Z[1]*Math.sin(j)+Z[2]*Math.cos(j),R[0]=X[0]+N[0],R[1]=X[1]+N[1],R[2]=X[2]+N[2],R},me.rotateY=function(R,D,N,j){var Z=[],X=[];return Z[0]=D[0]-N[0],Z[1]=D[1]-N[1],Z[2]=D[2]-N[2],X[0]=Z[2]*Math.sin(j)+Z[0]*Math.cos(j),X[1]=Z[1],X[2]=Z[2]*Math.cos(j)-Z[0]*Math.sin(j),R[0]=X[0]+N[0],R[1]=X[1]+N[1],R[2]=X[2]+N[2],R},me.rotateZ=function(R,D,N,j){var Z=[],X=[];return Z[0]=D[0]-N[0],Z[1]=D[1]-N[1],Z[2]=D[2]-N[2],X[0]=Z[0]*Math.cos(j)-Z[1]*Math.sin(j),X[1]=Z[0]*Math.sin(j)+Z[1]*Math.cos(j),X[2]=Z[2],R[0]=X[0]+N[0],R[1]=X[1]+N[1],R[2]=X[2]+N[2],R},me.angle=function(R,D){var N=R[0],j=R[1],Z=R[2],X=D[0],G=D[1],J=D[2],se=Math.sqrt(N*N+j*j+Z*Z)*Math.sqrt(X*X+G*G+J*J),_e=se&&I(R,D)/se;return Math.acos(Math.min(Math.max(_e,-1),1))},me.zero=function(R){return R[0]=0,R[1]=0,R[2]=0,R},me.str=function(R){return"vec3("+R[0]+", "+R[1]+", "+R[2]+")"},me.exactEquals=function(R,D){return R[0]===D[0]&&R[1]===D[1]&&R[2]===D[2]},me.equals=function(R,D){var N=R[0],j=R[1],Z=R[2],X=D[0],G=D[1],J=D[2];return Math.abs(N-X)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(j-G)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(G))&&Math.abs(Z-J)<=n.EPSILON*Math.max(1,Math.abs(Z),Math.abs(J))},me.forEach=me.sqrLen=me.len=me.sqrDist=me.dist=me.div=me.mul=me.sub=void 0;var n=function(R,D){if(R&&R.__esModule)return R;if(R===null||u(R)!=="object"&&typeof R!="function")return{default:R};var N=a(void 0);if(N&&N.has(R))return N.get(R);var j={},Z=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var X in R)if(X!=="default"&&Object.prototype.hasOwnProperty.call(R,X)){var G=Z?Object.getOwnPropertyDescriptor(R,X):null;G&&(G.get||G.set)?Object.defineProperty(j,X,G):j[X]=R[X]}return j.default=R,N&&N.set(R,j),j}(Y());function a(R){if(typeof WeakMap!="function")return null;var D=new WeakMap,N=new WeakMap;return(a=function(j){return j?N:D})(R)}function d(){var R=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0,R[2]=0),R}function _(R){return Math.hypot(R[0],R[1],R[2])}function f(R,D,N){return R[0]=D[0]-N[0],R[1]=D[1]-N[1],R[2]=D[2]-N[2],R}function y(R,D,N){return R[0]=D[0]*N[0],R[1]=D[1]*N[1],R[2]=D[2]*N[2],R}function T(R,D,N){return R[0]=D[0]/N[0],R[1]=D[1]/N[1],R[2]=D[2]/N[2],R}function C(R,D){return Math.hypot(D[0]-R[0],D[1]-R[1],D[2]-R[2])}function M(R,D){var N=D[0]-R[0],j=D[1]-R[1],Z=D[2]-R[2];return N*N+j*j+Z*Z}function x(R){var D=R[0],N=R[1],j=R[2];return D*D+N*N+j*j}function I(R,D){return R[0]*D[0]+R[1]*D[1]+R[2]*D[2]}me.sub=f,me.mul=y,me.div=T,me.dist=C,me.sqrDist=M,me.len=_,me.sqrLen=x;var P,A=(P=d(),function(R,D,N,j,Z,X){var G,J;for(D||(D=3),N||(N=0),J=j?Math.min(j*D+N,R.length):R.length,G=N;G<J;G+=D)P[0]=R[G],P[1]=R[G+1],P[2]=R[G+2],Z(P,P,X),R[G]=P[0],R[G+1]=P[1],R[G+2]=P[2];return R});return me.forEach=A,me}var tt,Et,ft={};function rr(){if(tt)return ft;function u(A){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},u(A)}tt=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.create=d,ft.clone=function(A){var R=new n.ARRAY_TYPE(4);return R[0]=A[0],R[1]=A[1],R[2]=A[2],R[3]=A[3],R},ft.fromValues=function(A,R,D,N){var j=new n.ARRAY_TYPE(4);return j[0]=A,j[1]=R,j[2]=D,j[3]=N,j},ft.copy=function(A,R){return A[0]=R[0],A[1]=R[1],A[2]=R[2],A[3]=R[3],A},ft.set=function(A,R,D,N,j){return A[0]=R,A[1]=D,A[2]=N,A[3]=j,A},ft.add=function(A,R,D){return A[0]=R[0]+D[0],A[1]=R[1]+D[1],A[2]=R[2]+D[2],A[3]=R[3]+D[3],A},ft.subtract=_,ft.multiply=f,ft.divide=y,ft.ceil=function(A,R){return A[0]=Math.ceil(R[0]),A[1]=Math.ceil(R[1]),A[2]=Math.ceil(R[2]),A[3]=Math.ceil(R[3]),A},ft.floor=function(A,R){return A[0]=Math.floor(R[0]),A[1]=Math.floor(R[1]),A[2]=Math.floor(R[2]),A[3]=Math.floor(R[3]),A},ft.min=function(A,R,D){return A[0]=Math.min(R[0],D[0]),A[1]=Math.min(R[1],D[1]),A[2]=Math.min(R[2],D[2]),A[3]=Math.min(R[3],D[3]),A},ft.max=function(A,R,D){return A[0]=Math.max(R[0],D[0]),A[1]=Math.max(R[1],D[1]),A[2]=Math.max(R[2],D[2]),A[3]=Math.max(R[3],D[3]),A},ft.round=function(A,R){return A[0]=Math.round(R[0]),A[1]=Math.round(R[1]),A[2]=Math.round(R[2]),A[3]=Math.round(R[3]),A},ft.scale=function(A,R,D){return A[0]=R[0]*D,A[1]=R[1]*D,A[2]=R[2]*D,A[3]=R[3]*D,A},ft.scaleAndAdd=function(A,R,D,N){return A[0]=R[0]+D[0]*N,A[1]=R[1]+D[1]*N,A[2]=R[2]+D[2]*N,A[3]=R[3]+D[3]*N,A},ft.distance=T,ft.squaredDistance=C,ft.length=M,ft.squaredLength=x,ft.negate=function(A,R){return A[0]=-R[0],A[1]=-R[1],A[2]=-R[2],A[3]=-R[3],A},ft.inverse=function(A,R){return A[0]=1/R[0],A[1]=1/R[1],A[2]=1/R[2],A[3]=1/R[3],A},ft.normalize=function(A,R){var D=R[0],N=R[1],j=R[2],Z=R[3],X=D*D+N*N+j*j+Z*Z;return X>0&&(X=1/Math.sqrt(X)),A[0]=D*X,A[1]=N*X,A[2]=j*X,A[3]=Z*X,A},ft.dot=function(A,R){return A[0]*R[0]+A[1]*R[1]+A[2]*R[2]+A[3]*R[3]},ft.cross=function(A,R,D,N){var j=D[0]*N[1]-D[1]*N[0],Z=D[0]*N[2]-D[2]*N[0],X=D[0]*N[3]-D[3]*N[0],G=D[1]*N[2]-D[2]*N[1],J=D[1]*N[3]-D[3]*N[1],se=D[2]*N[3]-D[3]*N[2],_e=R[0],Ce=R[1],Pe=R[2],Ee=R[3];return A[0]=Ce*se-Pe*J+Ee*G,A[1]=-_e*se+Pe*X-Ee*Z,A[2]=_e*J-Ce*X+Ee*j,A[3]=-_e*G+Ce*Z-Pe*j,A},ft.lerp=function(A,R,D,N){var j=R[0],Z=R[1],X=R[2],G=R[3];return A[0]=j+N*(D[0]-j),A[1]=Z+N*(D[1]-Z),A[2]=X+N*(D[2]-X),A[3]=G+N*(D[3]-G),A},ft.random=function(A,R){var D,N,j,Z,X,G;R=R||1;do X=(D=2*n.RANDOM()-1)*D+(N=2*n.RANDOM()-1)*N;while(X>=1);do G=(j=2*n.RANDOM()-1)*j+(Z=2*n.RANDOM()-1)*Z;while(G>=1);var J=Math.sqrt((1-X)/G);return A[0]=R*D,A[1]=R*N,A[2]=R*j*J,A[3]=R*Z*J,A},ft.transformMat4=function(A,R,D){var N=R[0],j=R[1],Z=R[2],X=R[3];return A[0]=D[0]*N+D[4]*j+D[8]*Z+D[12]*X,A[1]=D[1]*N+D[5]*j+D[9]*Z+D[13]*X,A[2]=D[2]*N+D[6]*j+D[10]*Z+D[14]*X,A[3]=D[3]*N+D[7]*j+D[11]*Z+D[15]*X,A},ft.transformQuat=function(A,R,D){var N=R[0],j=R[1],Z=R[2],X=D[0],G=D[1],J=D[2],se=D[3],_e=se*N+G*Z-J*j,Ce=se*j+J*N-X*Z,Pe=se*Z+X*j-G*N,Ee=-X*N-G*j-J*Z;return A[0]=_e*se+Ee*-X+Ce*-J-Pe*-G,A[1]=Ce*se+Ee*-G+Pe*-X-_e*-J,A[2]=Pe*se+Ee*-J+_e*-G-Ce*-X,A[3]=R[3],A},ft.zero=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=0,A},ft.str=function(A){return"vec4("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+")"},ft.exactEquals=function(A,R){return A[0]===R[0]&&A[1]===R[1]&&A[2]===R[2]&&A[3]===R[3]},ft.equals=function(A,R){var D=A[0],N=A[1],j=A[2],Z=A[3],X=R[0],G=R[1],J=R[2],se=R[3];return Math.abs(D-X)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(X))&&Math.abs(N-G)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(G))&&Math.abs(j-J)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(J))&&Math.abs(Z-se)<=n.EPSILON*Math.max(1,Math.abs(Z),Math.abs(se))},ft.forEach=ft.sqrLen=ft.len=ft.sqrDist=ft.dist=ft.div=ft.mul=ft.sub=void 0;var n=function(A,R){if(A&&A.__esModule)return A;if(A===null||u(A)!=="object"&&typeof A!="function")return{default:A};var D=a(void 0);if(D&&D.has(A))return D.get(A);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in A)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(A,Z)){var X=j?Object.getOwnPropertyDescriptor(A,Z):null;X&&(X.get||X.set)?Object.defineProperty(N,Z,X):N[Z]=A[Z]}return N.default=A,D&&D.set(A,N),N}(Y());function a(A){if(typeof WeakMap!="function")return null;var R=new WeakMap,D=new WeakMap;return(a=function(N){return N?D:R})(A)}function d(){var A=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0),A}function _(A,R,D){return A[0]=R[0]-D[0],A[1]=R[1]-D[1],A[2]=R[2]-D[2],A[3]=R[3]-D[3],A}function f(A,R,D){return A[0]=R[0]*D[0],A[1]=R[1]*D[1],A[2]=R[2]*D[2],A[3]=R[3]*D[3],A}function y(A,R,D){return A[0]=R[0]/D[0],A[1]=R[1]/D[1],A[2]=R[2]/D[2],A[3]=R[3]/D[3],A}function T(A,R){return Math.hypot(R[0]-A[0],R[1]-A[1],R[2]-A[2],R[3]-A[3])}function C(A,R){var D=R[0]-A[0],N=R[1]-A[1],j=R[2]-A[2],Z=R[3]-A[3];return D*D+N*N+j*j+Z*Z}function M(A){return Math.hypot(A[0],A[1],A[2],A[3])}function x(A){var R=A[0],D=A[1],N=A[2],j=A[3];return R*R+D*D+N*N+j*j}ft.sub=_,ft.mul=f,ft.div=y,ft.dist=T,ft.sqrDist=C,ft.len=M,ft.sqrLen=x;var I,P=(I=d(),function(A,R,D,N,j,Z){var X,G;for(R||(R=4),D||(D=0),G=N?Math.min(N*R+D,A.length):A.length,X=D;X<G;X+=R)I[0]=A[X],I[1]=A[X+1],I[2]=A[X+2],I[3]=A[X+3],j(I,I,Z),A[X]=I[0],A[X+1]=I[1],A[X+2]=I[2],A[X+3]=I[3];return A});return ft.forEach=P,ft}function or(){if(Et)return re;function u(De){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(qe){return typeof qe}:function(qe){return qe&&typeof Symbol=="function"&&qe.constructor===Symbol&&qe!==Symbol.prototype?"symbol":typeof qe},u(De)}Et=1,Object.defineProperty(re,"__esModule",{value:!0}),re.create=T,re.identity=function(De){return De[0]=0,De[1]=0,De[2]=0,De[3]=1,De},re.setAxisAngle=C,re.getAxisAngle=function(De,qe){var Qe=2*Math.acos(qe[3]),nt=Math.sin(Qe/2);return nt>n.EPSILON?(De[0]=qe[0]/nt,De[1]=qe[1]/nt,De[2]=qe[2]/nt):(De[0]=1,De[1]=0,De[2]=0),Qe},re.getAngle=function(De,qe){var Qe=D(De,qe);return Math.acos(2*Qe*Qe-1)},re.multiply=M,re.rotateX=function(De,qe,Qe){Qe*=.5;var nt=qe[0],ot=qe[1],lt=qe[2],yt=qe[3],ut=Math.sin(Qe),Mt=Math.cos(Qe);return De[0]=nt*Mt+yt*ut,De[1]=ot*Mt+lt*ut,De[2]=lt*Mt-ot*ut,De[3]=yt*Mt-nt*ut,De},re.rotateY=function(De,qe,Qe){Qe*=.5;var nt=qe[0],ot=qe[1],lt=qe[2],yt=qe[3],ut=Math.sin(Qe),Mt=Math.cos(Qe);return De[0]=nt*Mt-lt*ut,De[1]=ot*Mt+yt*ut,De[2]=lt*Mt+nt*ut,De[3]=yt*Mt-ot*ut,De},re.rotateZ=function(De,qe,Qe){Qe*=.5;var nt=qe[0],ot=qe[1],lt=qe[2],yt=qe[3],ut=Math.sin(Qe),Mt=Math.cos(Qe);return De[0]=nt*Mt+ot*ut,De[1]=ot*Mt-nt*ut,De[2]=lt*Mt+yt*ut,De[3]=yt*Mt-lt*ut,De},re.calculateW=function(De,qe){var Qe=qe[0],nt=qe[1],ot=qe[2];return De[0]=Qe,De[1]=nt,De[2]=ot,De[3]=Math.sqrt(Math.abs(1-Qe*Qe-nt*nt-ot*ot)),De},re.exp=x,re.ln=I,re.pow=function(De,qe,Qe){return I(De,qe),R(De,De,Qe),x(De,De),De},re.slerp=P,re.random=function(De){var qe=n.RANDOM(),Qe=n.RANDOM(),nt=n.RANDOM(),ot=Math.sqrt(1-qe),lt=Math.sqrt(qe);return De[0]=ot*Math.sin(2*Math.PI*Qe),De[1]=ot*Math.cos(2*Math.PI*Qe),De[2]=lt*Math.sin(2*Math.PI*nt),De[3]=lt*Math.cos(2*Math.PI*nt),De},re.invert=function(De,qe){var Qe=qe[0],nt=qe[1],ot=qe[2],lt=qe[3],yt=Qe*Qe+nt*nt+ot*ot+lt*lt,ut=yt?1/yt:0;return De[0]=-Qe*ut,De[1]=-nt*ut,De[2]=-ot*ut,De[3]=lt*ut,De},re.conjugate=function(De,qe){return De[0]=-qe[0],De[1]=-qe[1],De[2]=-qe[2],De[3]=qe[3],De},re.fromMat3=A,re.fromEuler=function(De,qe,Qe,nt){var ot=.5*Math.PI/180;qe*=ot,Qe*=ot,nt*=ot;var lt=Math.sin(qe),yt=Math.cos(qe),ut=Math.sin(Qe),Mt=Math.cos(Qe),Vt=Math.sin(nt),Tt=Math.cos(nt);return De[0]=lt*Mt*Tt-yt*ut*Vt,De[1]=yt*ut*Tt+lt*Mt*Vt,De[2]=yt*Mt*Vt-lt*ut*Tt,De[3]=yt*Mt*Tt+lt*ut*Vt,De},re.str=function(De){return"quat("+De[0]+", "+De[1]+", "+De[2]+", "+De[3]+")"},re.setAxes=re.sqlerp=re.rotationTo=re.equals=re.exactEquals=re.normalize=re.sqrLen=re.squaredLength=re.len=re.length=re.lerp=re.dot=re.scale=re.mul=re.add=re.set=re.copy=re.fromValues=re.clone=void 0;var n=y(Y()),a=y(ze()),d=y(we()),_=y(rr());function f(De){if(typeof WeakMap!="function")return null;var qe=new WeakMap,Qe=new WeakMap;return(f=function(nt){return nt?Qe:qe})(De)}function y(De,qe){if(De&&De.__esModule)return De;if(De===null||u(De)!=="object"&&typeof De!="function")return{default:De};var Qe=f(qe);if(Qe&&Qe.has(De))return Qe.get(De);var nt={},ot=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var lt in De)if(lt!=="default"&&Object.prototype.hasOwnProperty.call(De,lt)){var yt=ot?Object.getOwnPropertyDescriptor(De,lt):null;yt&&(yt.get||yt.set)?Object.defineProperty(nt,lt,yt):nt[lt]=De[lt]}return nt.default=De,Qe&&Qe.set(De,nt),nt}function T(){var De=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(De[0]=0,De[1]=0,De[2]=0),De[3]=1,De}function C(De,qe,Qe){Qe*=.5;var nt=Math.sin(Qe);return De[0]=nt*qe[0],De[1]=nt*qe[1],De[2]=nt*qe[2],De[3]=Math.cos(Qe),De}function M(De,qe,Qe){var nt=qe[0],ot=qe[1],lt=qe[2],yt=qe[3],ut=Qe[0],Mt=Qe[1],Vt=Qe[2],Tt=Qe[3];return De[0]=nt*Tt+yt*ut+ot*Vt-lt*Mt,De[1]=ot*Tt+yt*Mt+lt*ut-nt*Vt,De[2]=lt*Tt+yt*Vt+nt*Mt-ot*ut,De[3]=yt*Tt-nt*ut-ot*Mt-lt*Vt,De}function x(De,qe){var Qe=qe[0],nt=qe[1],ot=qe[2],lt=qe[3],yt=Math.sqrt(Qe*Qe+nt*nt+ot*ot),ut=Math.exp(lt),Mt=yt>0?ut*Math.sin(yt)/yt:0;return De[0]=Qe*Mt,De[1]=nt*Mt,De[2]=ot*Mt,De[3]=ut*Math.cos(yt),De}function I(De,qe){var Qe=qe[0],nt=qe[1],ot=qe[2],lt=qe[3],yt=Math.sqrt(Qe*Qe+nt*nt+ot*ot),ut=yt>0?Math.atan2(yt,lt)/yt:0;return De[0]=Qe*ut,De[1]=nt*ut,De[2]=ot*ut,De[3]=.5*Math.log(Qe*Qe+nt*nt+ot*ot+lt*lt),De}function P(De,qe,Qe,nt){var ot,lt,yt,ut,Mt,Vt=qe[0],Tt=qe[1],wr=qe[2],dr=qe[3],er=Qe[0],qt=Qe[1],Vr=Qe[2],xr=Qe[3];return(lt=Vt*er+Tt*qt+wr*Vr+dr*xr)<0&&(lt=-lt,er=-er,qt=-qt,Vr=-Vr,xr=-xr),1-lt>n.EPSILON?(ot=Math.acos(lt),yt=Math.sin(ot),ut=Math.sin((1-nt)*ot)/yt,Mt=Math.sin(nt*ot)/yt):(ut=1-nt,Mt=nt),De[0]=ut*Vt+Mt*er,De[1]=ut*Tt+Mt*qt,De[2]=ut*wr+Mt*Vr,De[3]=ut*dr+Mt*xr,De}function A(De,qe){var Qe,nt=qe[0]+qe[4]+qe[8];if(nt>0)Qe=Math.sqrt(nt+1),De[3]=.5*Qe,De[0]=(qe[5]-qe[7])*(Qe=.5/Qe),De[1]=(qe[6]-qe[2])*Qe,De[2]=(qe[1]-qe[3])*Qe;else{var ot=0;qe[4]>qe[0]&&(ot=1),qe[8]>qe[3*ot+ot]&&(ot=2);var lt=(ot+1)%3,yt=(ot+2)%3;Qe=Math.sqrt(qe[3*ot+ot]-qe[3*lt+lt]-qe[3*yt+yt]+1),De[ot]=.5*Qe,De[3]=(qe[3*lt+yt]-qe[3*yt+lt])*(Qe=.5/Qe),De[lt]=(qe[3*lt+ot]+qe[3*ot+lt])*Qe,De[yt]=(qe[3*yt+ot]+qe[3*ot+yt])*Qe}return De}re.clone=_.clone,re.fromValues=_.fromValues,re.copy=_.copy,re.set=_.set,re.add=_.add,re.mul=M;var R=_.scale;re.scale=R;var D=_.dot;re.dot=D,re.lerp=_.lerp;var N=_.length;re.length=N,re.len=N;var j=_.squaredLength;re.squaredLength=j,re.sqrLen=j;var Z=_.normalize;re.normalize=Z,re.exactEquals=_.exactEquals,re.equals=_.equals;var X,G,J,se=(X=d.create(),G=d.fromValues(1,0,0),J=d.fromValues(0,1,0),function(De,qe,Qe){var nt=d.dot(qe,Qe);return nt<-.999999?(d.cross(X,G,qe),d.len(X)<1e-6&&d.cross(X,J,qe),d.normalize(X,X),C(De,X,Math.PI),De):nt>.999999?(De[0]=0,De[1]=0,De[2]=0,De[3]=1,De):(d.cross(X,qe,Qe),De[0]=X[0],De[1]=X[1],De[2]=X[2],De[3]=1+nt,Z(De,De))});re.rotationTo=se;var _e,Ce,Pe=(_e=T(),Ce=T(),function(De,qe,Qe,nt,ot,lt){return P(_e,qe,ot,lt),P(Ce,Qe,nt,lt),P(De,_e,Ce,2*lt*(1-lt)),De});re.sqlerp=Pe;var Ee,Ve=(Ee=a.create(),function(De,qe,Qe,nt){return Ee[0]=Qe[0],Ee[3]=Qe[1],Ee[6]=Qe[2],Ee[1]=nt[0],Ee[4]=nt[1],Ee[7]=nt[2],Ee[2]=-qe[0],Ee[5]=-qe[1],Ee[8]=-qe[2],Z(De,A(De,Ee))});return re.setAxes=Ve,re}var Fr,gt={};function jr(){if(Fr)return gt;function u(P){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},u(P)}Fr=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=function(){var P=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0,P[4]=0,P[5]=0,P[6]=0,P[7]=0),P[3]=1,P},gt.clone=function(P){var A=new n.ARRAY_TYPE(8);return A[0]=P[0],A[1]=P[1],A[2]=P[2],A[3]=P[3],A[4]=P[4],A[5]=P[5],A[6]=P[6],A[7]=P[7],A},gt.fromValues=function(P,A,R,D,N,j,Z,X){var G=new n.ARRAY_TYPE(8);return G[0]=P,G[1]=A,G[2]=R,G[3]=D,G[4]=N,G[5]=j,G[6]=Z,G[7]=X,G},gt.fromRotationTranslationValues=function(P,A,R,D,N,j,Z){var X=new n.ARRAY_TYPE(8);X[0]=P,X[1]=A,X[2]=R,X[3]=D;var G=.5*N,J=.5*j,se=.5*Z;return X[4]=G*D+J*R-se*A,X[5]=J*D+se*P-G*R,X[6]=se*D+G*A-J*P,X[7]=-G*P-J*A-se*R,X},gt.fromRotationTranslation=y,gt.fromTranslation=function(P,A){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=.5*A[0],P[5]=.5*A[1],P[6]=.5*A[2],P[7]=0,P},gt.fromRotation=function(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},gt.fromMat4=function(P,A){var R=a.create();d.getRotation(R,A);var D=new n.ARRAY_TYPE(3);return d.getTranslation(D,A),y(P,R,D),P},gt.copy=T,gt.identity=function(P){return P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=0,P[5]=0,P[6]=0,P[7]=0,P},gt.set=function(P,A,R,D,N,j,Z,X,G){return P[0]=A,P[1]=R,P[2]=D,P[3]=N,P[4]=j,P[5]=Z,P[6]=X,P[7]=G,P},gt.getDual=function(P,A){return P[0]=A[4],P[1]=A[5],P[2]=A[6],P[3]=A[7],P},gt.setDual=function(P,A){return P[4]=A[0],P[5]=A[1],P[6]=A[2],P[7]=A[3],P},gt.getTranslation=function(P,A){var R=A[4],D=A[5],N=A[6],j=A[7],Z=-A[0],X=-A[1],G=-A[2],J=A[3];return P[0]=2*(R*J+j*Z+D*G-N*X),P[1]=2*(D*J+j*X+N*Z-R*G),P[2]=2*(N*J+j*G+R*X-D*Z),P},gt.translate=function(P,A,R){var D=A[0],N=A[1],j=A[2],Z=A[3],X=.5*R[0],G=.5*R[1],J=.5*R[2],se=A[4],_e=A[5],Ce=A[6],Pe=A[7];return P[0]=D,P[1]=N,P[2]=j,P[3]=Z,P[4]=Z*X+N*J-j*G+se,P[5]=Z*G+j*X-D*J+_e,P[6]=Z*J+D*G-N*X+Ce,P[7]=-D*X-N*G-j*J+Pe,P},gt.rotateX=function(P,A,R){var D=-A[0],N=-A[1],j=-A[2],Z=A[3],X=A[4],G=A[5],J=A[6],se=A[7],_e=X*Z+se*D+G*j-J*N,Ce=G*Z+se*N+J*D-X*j,Pe=J*Z+se*j+X*N-G*D,Ee=se*Z-X*D-G*N-J*j;return a.rotateX(P,A,R),P[4]=_e*(Z=P[3])+Ee*(D=P[0])+Ce*(j=P[2])-Pe*(N=P[1]),P[5]=Ce*Z+Ee*N+Pe*D-_e*j,P[6]=Pe*Z+Ee*j+_e*N-Ce*D,P[7]=Ee*Z-_e*D-Ce*N-Pe*j,P},gt.rotateY=function(P,A,R){var D=-A[0],N=-A[1],j=-A[2],Z=A[3],X=A[4],G=A[5],J=A[6],se=A[7],_e=X*Z+se*D+G*j-J*N,Ce=G*Z+se*N+J*D-X*j,Pe=J*Z+se*j+X*N-G*D,Ee=se*Z-X*D-G*N-J*j;return a.rotateY(P,A,R),P[4]=_e*(Z=P[3])+Ee*(D=P[0])+Ce*(j=P[2])-Pe*(N=P[1]),P[5]=Ce*Z+Ee*N+Pe*D-_e*j,P[6]=Pe*Z+Ee*j+_e*N-Ce*D,P[7]=Ee*Z-_e*D-Ce*N-Pe*j,P},gt.rotateZ=function(P,A,R){var D=-A[0],N=-A[1],j=-A[2],Z=A[3],X=A[4],G=A[5],J=A[6],se=A[7],_e=X*Z+se*D+G*j-J*N,Ce=G*Z+se*N+J*D-X*j,Pe=J*Z+se*j+X*N-G*D,Ee=se*Z-X*D-G*N-J*j;return a.rotateZ(P,A,R),P[4]=_e*(Z=P[3])+Ee*(D=P[0])+Ce*(j=P[2])-Pe*(N=P[1]),P[5]=Ce*Z+Ee*N+Pe*D-_e*j,P[6]=Pe*Z+Ee*j+_e*N-Ce*D,P[7]=Ee*Z-_e*D-Ce*N-Pe*j,P},gt.rotateByQuatAppend=function(P,A,R){var D=R[0],N=R[1],j=R[2],Z=R[3],X=A[0],G=A[1],J=A[2],se=A[3];return P[0]=X*Z+se*D+G*j-J*N,P[1]=G*Z+se*N+J*D-X*j,P[2]=J*Z+se*j+X*N-G*D,P[3]=se*Z-X*D-G*N-J*j,P[4]=(X=A[4])*Z+(se=A[7])*D+(G=A[5])*j-(J=A[6])*N,P[5]=G*Z+se*N+J*D-X*j,P[6]=J*Z+se*j+X*N-G*D,P[7]=se*Z-X*D-G*N-J*j,P},gt.rotateByQuatPrepend=function(P,A,R){var D=A[0],N=A[1],j=A[2],Z=A[3],X=R[0],G=R[1],J=R[2],se=R[3];return P[0]=D*se+Z*X+N*J-j*G,P[1]=N*se+Z*G+j*X-D*J,P[2]=j*se+Z*J+D*G-N*X,P[3]=Z*se-D*X-N*G-j*J,P[4]=D*(se=R[7])+Z*(X=R[4])+N*(J=R[6])-j*(G=R[5]),P[5]=N*se+Z*G+j*X-D*J,P[6]=j*se+Z*J+D*G-N*X,P[7]=Z*se-D*X-N*G-j*J,P},gt.rotateAroundAxis=function(P,A,R,D){if(Math.abs(D)<n.EPSILON)return T(P,A);var N=Math.hypot(R[0],R[1],R[2]);D*=.5;var j=Math.sin(D),Z=j*R[0]/N,X=j*R[1]/N,G=j*R[2]/N,J=Math.cos(D),se=A[0],_e=A[1],Ce=A[2],Pe=A[3];P[0]=se*J+Pe*Z+_e*G-Ce*X,P[1]=_e*J+Pe*X+Ce*Z-se*G,P[2]=Ce*J+Pe*G+se*X-_e*Z,P[3]=Pe*J-se*Z-_e*X-Ce*G;var Ee=A[4],Ve=A[5],De=A[6],qe=A[7];return P[4]=Ee*J+qe*Z+Ve*G-De*X,P[5]=Ve*J+qe*X+De*Z-Ee*G,P[6]=De*J+qe*G+Ee*X-Ve*Z,P[7]=qe*J-Ee*Z-Ve*X-De*G,P},gt.add=function(P,A,R){return P[0]=A[0]+R[0],P[1]=A[1]+R[1],P[2]=A[2]+R[2],P[3]=A[3]+R[3],P[4]=A[4]+R[4],P[5]=A[5]+R[5],P[6]=A[6]+R[6],P[7]=A[7]+R[7],P},gt.multiply=C,gt.scale=function(P,A,R){return P[0]=A[0]*R,P[1]=A[1]*R,P[2]=A[2]*R,P[3]=A[3]*R,P[4]=A[4]*R,P[5]=A[5]*R,P[6]=A[6]*R,P[7]=A[7]*R,P},gt.lerp=function(P,A,R,D){var N=1-D;return M(A,R)<0&&(D=-D),P[0]=A[0]*N+R[0]*D,P[1]=A[1]*N+R[1]*D,P[2]=A[2]*N+R[2]*D,P[3]=A[3]*N+R[3]*D,P[4]=A[4]*N+R[4]*D,P[5]=A[5]*N+R[5]*D,P[6]=A[6]*N+R[6]*D,P[7]=A[7]*N+R[7]*D,P},gt.invert=function(P,A){var R=I(A);return P[0]=-A[0]/R,P[1]=-A[1]/R,P[2]=-A[2]/R,P[3]=A[3]/R,P[4]=-A[4]/R,P[5]=-A[5]/R,P[6]=-A[6]/R,P[7]=A[7]/R,P},gt.conjugate=function(P,A){return P[0]=-A[0],P[1]=-A[1],P[2]=-A[2],P[3]=A[3],P[4]=-A[4],P[5]=-A[5],P[6]=-A[6],P[7]=A[7],P},gt.normalize=function(P,A){var R=I(A);if(R>0){R=Math.sqrt(R);var D=A[0]/R,N=A[1]/R,j=A[2]/R,Z=A[3]/R,X=A[4],G=A[5],J=A[6],se=A[7],_e=D*X+N*G+j*J+Z*se;P[0]=D,P[1]=N,P[2]=j,P[3]=Z,P[4]=(X-D*_e)/R,P[5]=(G-N*_e)/R,P[6]=(J-j*_e)/R,P[7]=(se-Z*_e)/R}return P},gt.str=function(P){return"quat2("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+", "+P[4]+", "+P[5]+", "+P[6]+", "+P[7]+")"},gt.exactEquals=function(P,A){return P[0]===A[0]&&P[1]===A[1]&&P[2]===A[2]&&P[3]===A[3]&&P[4]===A[4]&&P[5]===A[5]&&P[6]===A[6]&&P[7]===A[7]},gt.equals=function(P,A){var R=P[0],D=P[1],N=P[2],j=P[3],Z=P[4],X=P[5],G=P[6],J=P[7],se=A[0],_e=A[1],Ce=A[2],Pe=A[3],Ee=A[4],Ve=A[5],De=A[6],qe=A[7];return Math.abs(R-se)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(se))&&Math.abs(D-_e)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(_e))&&Math.abs(N-Ce)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ce))&&Math.abs(j-Pe)<=n.EPSILON*Math.max(1,Math.abs(j),Math.abs(Pe))&&Math.abs(Z-Ee)<=n.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Ee))&&Math.abs(X-Ve)<=n.EPSILON*Math.max(1,Math.abs(X),Math.abs(Ve))&&Math.abs(G-De)<=n.EPSILON*Math.max(1,Math.abs(G),Math.abs(De))&&Math.abs(J-qe)<=n.EPSILON*Math.max(1,Math.abs(J),Math.abs(qe))},gt.sqrLen=gt.squaredLength=gt.len=gt.length=gt.dot=gt.mul=gt.setReal=gt.getReal=void 0;var n=f(Y()),a=f(or()),d=f(ne());function _(P){if(typeof WeakMap!="function")return null;var A=new WeakMap,R=new WeakMap;return(_=function(D){return D?R:A})(P)}function f(P,A){if(P&&P.__esModule)return P;if(P===null||u(P)!=="object"&&typeof P!="function")return{default:P};var R=_(A);if(R&&R.has(P))return R.get(P);var D={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var j in P)if(j!=="default"&&Object.prototype.hasOwnProperty.call(P,j)){var Z=N?Object.getOwnPropertyDescriptor(P,j):null;Z&&(Z.get||Z.set)?Object.defineProperty(D,j,Z):D[j]=P[j]}return D.default=P,R&&R.set(P,D),D}function y(P,A,R){var D=.5*R[0],N=.5*R[1],j=.5*R[2],Z=A[0],X=A[1],G=A[2],J=A[3];return P[0]=Z,P[1]=X,P[2]=G,P[3]=J,P[4]=D*J+N*G-j*X,P[5]=N*J+j*Z-D*G,P[6]=j*J+D*X-N*Z,P[7]=-D*Z-N*X-j*G,P}function T(P,A){return P[0]=A[0],P[1]=A[1],P[2]=A[2],P[3]=A[3],P[4]=A[4],P[5]=A[5],P[6]=A[6],P[7]=A[7],P}function C(P,A,R){var D=A[0],N=A[1],j=A[2],Z=A[3],X=R[4],G=R[5],J=R[6],se=R[7],_e=A[4],Ce=A[5],Pe=A[6],Ee=A[7],Ve=R[0],De=R[1],qe=R[2],Qe=R[3];return P[0]=D*Qe+Z*Ve+N*qe-j*De,P[1]=N*Qe+Z*De+j*Ve-D*qe,P[2]=j*Qe+Z*qe+D*De-N*Ve,P[3]=Z*Qe-D*Ve-N*De-j*qe,P[4]=D*se+Z*X+N*J-j*G+_e*Qe+Ee*Ve+Ce*qe-Pe*De,P[5]=N*se+Z*G+j*X-D*J+Ce*Qe+Ee*De+Pe*Ve-_e*qe,P[6]=j*se+Z*J+D*G-N*X+Pe*Qe+Ee*qe+_e*De-Ce*Ve,P[7]=Z*se-D*X-N*G-j*J+Ee*Qe-_e*Ve-Ce*De-Pe*qe,P}gt.getReal=a.copy,gt.setReal=a.copy,gt.mul=C;var M=a.dot;gt.dot=M;var x=a.length;gt.length=x,gt.len=x;var I=a.squaredLength;return gt.squaredLength=I,gt.sqrLen=I,gt}var Ur,Xr,pr={};function Dt(){if(Ur)return pr;function u(A){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},u(A)}Ur=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.create=d,pr.clone=function(A){var R=new n.ARRAY_TYPE(2);return R[0]=A[0],R[1]=A[1],R},pr.fromValues=function(A,R){var D=new n.ARRAY_TYPE(2);return D[0]=A,D[1]=R,D},pr.copy=function(A,R){return A[0]=R[0],A[1]=R[1],A},pr.set=function(A,R,D){return A[0]=R,A[1]=D,A},pr.add=function(A,R,D){return A[0]=R[0]+D[0],A[1]=R[1]+D[1],A},pr.subtract=_,pr.multiply=f,pr.divide=y,pr.ceil=function(A,R){return A[0]=Math.ceil(R[0]),A[1]=Math.ceil(R[1]),A},pr.floor=function(A,R){return A[0]=Math.floor(R[0]),A[1]=Math.floor(R[1]),A},pr.min=function(A,R,D){return A[0]=Math.min(R[0],D[0]),A[1]=Math.min(R[1],D[1]),A},pr.max=function(A,R,D){return A[0]=Math.max(R[0],D[0]),A[1]=Math.max(R[1],D[1]),A},pr.round=function(A,R){return A[0]=Math.round(R[0]),A[1]=Math.round(R[1]),A},pr.scale=function(A,R,D){return A[0]=R[0]*D,A[1]=R[1]*D,A},pr.scaleAndAdd=function(A,R,D,N){return A[0]=R[0]+D[0]*N,A[1]=R[1]+D[1]*N,A},pr.distance=T,pr.squaredDistance=C,pr.length=M,pr.squaredLength=x,pr.negate=function(A,R){return A[0]=-R[0],A[1]=-R[1],A},pr.inverse=function(A,R){return A[0]=1/R[0],A[1]=1/R[1],A},pr.normalize=function(A,R){var D=R[0],N=R[1],j=D*D+N*N;return j>0&&(j=1/Math.sqrt(j)),A[0]=R[0]*j,A[1]=R[1]*j,A},pr.dot=function(A,R){return A[0]*R[0]+A[1]*R[1]},pr.cross=function(A,R,D){var N=R[0]*D[1]-R[1]*D[0];return A[0]=A[1]=0,A[2]=N,A},pr.lerp=function(A,R,D,N){var j=R[0],Z=R[1];return A[0]=j+N*(D[0]-j),A[1]=Z+N*(D[1]-Z),A},pr.random=function(A,R){R=R||1;var D=2*n.RANDOM()*Math.PI;return A[0]=Math.cos(D)*R,A[1]=Math.sin(D)*R,A},pr.transformMat2=function(A,R,D){var N=R[0],j=R[1];return A[0]=D[0]*N+D[2]*j,A[1]=D[1]*N+D[3]*j,A},pr.transformMat2d=function(A,R,D){var N=R[0],j=R[1];return A[0]=D[0]*N+D[2]*j+D[4],A[1]=D[1]*N+D[3]*j+D[5],A},pr.transformMat3=function(A,R,D){var N=R[0],j=R[1];return A[0]=D[0]*N+D[3]*j+D[6],A[1]=D[1]*N+D[4]*j+D[7],A},pr.transformMat4=function(A,R,D){var N=R[0],j=R[1];return A[0]=D[0]*N+D[4]*j+D[12],A[1]=D[1]*N+D[5]*j+D[13],A},pr.rotate=function(A,R,D,N){var j=R[0]-D[0],Z=R[1]-D[1],X=Math.sin(N),G=Math.cos(N);return A[0]=j*G-Z*X+D[0],A[1]=j*X+Z*G+D[1],A},pr.angle=function(A,R){var D=A[0],N=A[1],j=R[0],Z=R[1],X=Math.sqrt(D*D+N*N)*Math.sqrt(j*j+Z*Z);return Math.acos(Math.min(Math.max(X&&(D*j+N*Z)/X,-1),1))},pr.zero=function(A){return A[0]=0,A[1]=0,A},pr.str=function(A){return"vec2("+A[0]+", "+A[1]+")"},pr.exactEquals=function(A,R){return A[0]===R[0]&&A[1]===R[1]},pr.equals=function(A,R){var D=A[0],N=A[1],j=R[0],Z=R[1];return Math.abs(D-j)<=n.EPSILON*Math.max(1,Math.abs(D),Math.abs(j))&&Math.abs(N-Z)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(Z))},pr.forEach=pr.sqrLen=pr.sqrDist=pr.dist=pr.div=pr.mul=pr.sub=pr.len=void 0;var n=function(A,R){if(A&&A.__esModule)return A;if(A===null||u(A)!=="object"&&typeof A!="function")return{default:A};var D=a(void 0);if(D&&D.has(A))return D.get(A);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in A)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(A,Z)){var X=j?Object.getOwnPropertyDescriptor(A,Z):null;X&&(X.get||X.set)?Object.defineProperty(N,Z,X):N[Z]=A[Z]}return N.default=A,D&&D.set(A,N),N}(Y());function a(A){if(typeof WeakMap!="function")return null;var R=new WeakMap,D=new WeakMap;return(a=function(N){return N?D:R})(A)}function d(){var A=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0),A}function _(A,R,D){return A[0]=R[0]-D[0],A[1]=R[1]-D[1],A}function f(A,R,D){return A[0]=R[0]*D[0],A[1]=R[1]*D[1],A}function y(A,R,D){return A[0]=R[0]/D[0],A[1]=R[1]/D[1],A}function T(A,R){return Math.hypot(R[0]-A[0],R[1]-A[1])}function C(A,R){var D=R[0]-A[0],N=R[1]-A[1];return D*D+N*N}function M(A){return Math.hypot(A[0],A[1])}function x(A){var R=A[0],D=A[1];return R*R+D*D}pr.len=M,pr.sub=_,pr.mul=f,pr.div=y,pr.dist=T,pr.sqrDist=C,pr.sqrLen=x;var I,P=(I=d(),function(A,R,D,N,j,Z){var X,G;for(R||(R=2),D||(D=0),G=N?Math.min(N*R+D,A.length):A.length,X=D;X<G;X+=R)I[0]=A[X],I[1]=A[X+1],j(I,I,Z),A[X]=I[0],A[X+1]=I[1];return A});return pr.forEach=P,pr}function ar(){if(Xr)return U;function u(A){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},u(A)}Xr=1,Object.defineProperty(U,"__esModule",{value:!0}),U.vec4=U.vec3=U.vec2=U.quat2=U.quat=U.mat4=U.mat3=U.mat2d=U.mat2=U.glMatrix=void 0;var n=P(Y());U.glMatrix=n;var a=P(ye());U.mat2=a;var d=P(oe());U.mat2d=d;var _=P(ze());U.mat3=_;var f=P(ne());U.mat4=f;var y=P(or());U.quat=y;var T=P(jr());U.quat2=T;var C=P(Dt());U.vec2=C;var M=P(we());U.vec3=M;var x=P(rr());function I(A){if(typeof WeakMap!="function")return null;var R=new WeakMap,D=new WeakMap;return(I=function(N){return N?D:R})(A)}function P(A,R){if(A&&A.__esModule)return A;if(A===null||u(A)!=="object"&&typeof A!="function")return{default:A};var D=I(R);if(D&&D.has(A))return D.get(A);var N={},j=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Z in A)if(Z!=="default"&&Object.prototype.hasOwnProperty.call(A,Z)){var X=j?Object.getOwnPropertyDescriptor(A,Z):null;X&&(X.get||X.set)?Object.defineProperty(N,Z,X):N[Z]=A[Z]}return N.default=A,D&&D.set(A,N),N}return U.vec4=x,U}var vt,Pt,Ot,lr,Se=ar(),Kt=function(){if(Pt)return vt;function u(n,a,d,_){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(_-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=d,this.p2y=_}return Pt=1,vt=u,u.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,_=0;_<8;_++){var f=this.sampleCurveX(d)-n;if(Math.abs(f)<a)return d;var y=this.sampleCurveDerivativeX(d);if(Math.abs(y)<1e-6)break;d-=f/y}var T=0,C=1;for(d=n,_=0;_<20&&(f=this.sampleCurveX(d),!(Math.abs(f-n)<a));_++)n>f?T=d:C=d,d=.5*(C-T)+T;return d},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},vt}(),Fe=O(Kt);function $e(){if(lr)return Ot;function u(n,a){this.x=n,this.y=a}return lr=1,Ot=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,a){return this.clone()._rotateAround(n,a)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var a=n.x-this.x,d=n.y-this.y;return a*a+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,a){return Math.atan2(this.x*a-this.y*n,this.x*n+this.y*a)},_matMult:function(n){var a=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=a,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var a=Math.cos(n),d=Math.sin(n),_=d*this.x+a*this.y;return this.x=a*this.x-d*this.y,this.y=_,this},_rotateAround:function(n,a){var d=Math.cos(n),_=Math.sin(n),f=a.y+_*(this.x-a.x)+d*(this.y-a.y);return this.x=a.x+d*(this.x-a.x)-_*(this.y-a.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(n){return n instanceof u?n:Array.isArray(n)?new u(n[0],n[1]):n},Ot}var We=O($e());function zt(u,n){if(Array.isArray(u)){if(!Array.isArray(n)||u.length!==n.length)return!1;for(let a=0;a<u.length;a++)if(!zt(u[a],n[a]))return!1;return!0}if(typeof u=="object"&&u!==null&&n!==null){if(typeof n!="object"||Object.keys(u).length!==Object.keys(n).length)return!1;for(const a in u)if(!zt(u[a],n[a]))return!1;return!0}return u===n}const $t=Math.PI/180,_r=180/Math.PI;function Wt(u){return u*$t}function mr(u){return u*_r}const Tr=[[0,0],[1,0],[1,1],[0,1]];function yr(u){if(u<=0)return 0;if(u>=1)return 1;const n=u*u,a=n*u;return 4*(u<.5?a:3*(u-n)+a-.75)}function Lr(u,n,a,d){const _=new Fe(u,n,a,d);return function(f){return _.solve(f)}}const qr=Lr(.25,.1,.25,1);function nr(u,n,a){return Math.min(a,Math.max(n,u))}function Wr(u,n,a){return(a=nr((a-u)/(n-u),0,1))*a*(3-2*a)}function Zr(u,n,a){const d=a-n,_=((u-n)%d+d)%d+n;return _===n?a:_}function Rn(u,n,a){if(!u.length)return a(null,[]);let d=u.length;const _=new Array(u.length);let f=null;u.forEach((y,T)=>{n(y,(C,M)=>{C&&(f=C),_[T]=M,--d==0&&a(f,_)})})}function ln(u,...n){for(const a of n)for(const d in a)u[d]=a[d];return u}let jn=1;function uo(){return jn++}function ho(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function vs(u,n){u.forEach(a=>{n[a]&&(n[a]=n[a].bind(n))})}function Ai(u,n){return u.indexOf(n,u.length-n.length)!==-1}function ns(u,n,a){const d={};for(const _ in u)d[_]=n.call(this,u[_],_,u);return d}function ki(u,n,a){const d={};for(const _ in u)n.call(this,u[_],_,u)&&(d[_]=u[_]);return d}function Oi(u){return Array.isArray(u)?u.map(Oi):typeof u=="object"&&u?ns(u,Oi):u}const Zo={};function en(u){Zo[u]||(typeof console<"u"&&console.warn(u),Zo[u]=!0)}function Do(u,n,a){return(a.y-u.y)*(n.x-u.x)>(n.y-u.y)*(a.x-u.x)}function bs(u){let n=0;for(let a,d,_=0,f=u.length,y=f-1;_<f;y=_++)a=u[_],d=u[y],n+=(d.x-a.x)*(a.y+d.y);return n}function Lo([u,n,a]){const d=Wt(n+90),_=Wt(a);return{x:u*Math.cos(d)*Math.sin(_),y:u*Math.sin(d)*Math.sin(_),z:u*Math.cos(_),azimuthal:n,polar:a}}function jo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function is(u){const n={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,_,f)=>{const y=_||f;return n[d]=!y||y.toLowerCase(),""}),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}let Is,Ks=null;function $o(u,n){return[u[4*n],u[4*n+1],u[4*n+2],u[4*n+3]]}function pt(u,n,a,d){for(;n<a;){const _=n+a>>1;u[_]<d?n=_+1:a=_}return n}function fe(u,n,a,d){for(;n<a;){const _=n+a>>1;u[_]<=d?n=_+1:a=_}return n}function xe(u){return u>0?1/(1.001-u):1+u}function Ne(u){return u>0?1-1/(1.001-u):-u}const Ke={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Is==null){const u=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Is=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):u}catch{Is=u}}return Is},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ke.API_URL)return null;try{const u=new URL(Ke.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ge(u){return Ke.API_URL_REGEX.test(u)}function st(u){return Ke.API_SPRITE_REGEX.test(u)}let _t,at,bt,St,xt,jt;function ur(){return _t==null&&(_t=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),_t}const ir={now:()=>St!==void 0?St:performance.now(),setNow(u){St=u},restoreNow(){St=void 0},frame(u){const n=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(u,n=0){const{width:a,height:d}=u;xt||(xt=document.createElement("canvas"));const _=xt.getContext("2d",{willReadFrequently:!0});if(!_)throw new Error("failed to create canvas 2d context");return(a>xt.width||d>xt.height)&&(xt.width=a,xt.height=d),_.clearRect(-n,-n,a+2*n,d+2*n),_.drawImage(u,0,0,a,d),_.getImageData(-n,-n,a+2*n,d+2*n)},resolveURL:u=>(at||(at=document.createElement("a")),at.href=u,at.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(bt==null&&(bt=window.matchMedia("(prefers-reduced-motion: reduce)")),bt.matches)},hasCanvasFingerprintNoise(){if(jt!==void 0)return jt;if(!ur())return jt=!1,!1;const u=new OffscreenCanvas(85,1),n=u.getContext("2d",{willReadFrequently:!0});let a=0;for(let _=0;_<u.width;++_)n.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,n.fillRect(_,0,1,1);const d=n.getImageData(0,0,u.width,u.height);a=0;for(let _=0;_<d.data.length;++_)if(_%4!=3&&a++!==d.data[_])return jt=!0,!0;return jt=!1,!1}};function Rr(u,n){const a=u.indexOf("?");if(a<0)return`${u}?${new URLSearchParams(n).toString()}`;const d=new URLSearchParams(u.slice(a));for(const _ in n)d.set(_,n[_]);return`${u.slice(0,a)}?${d.toString()}`}function Br(u,n={persistentParams:[]}){const a=u.indexOf("?");if(a<0)return u;const d=new URLSearchParams,_=new URLSearchParams(u.slice(a));for(const y of n.persistentParams){const T=_.get(y);T&&d.set(y,T)}const f=d.toString();return`${u.slice(0,a)}${f.length>0?`?${f}`:""}`}const kr="mapbox-tiles";let zr=500,yn=50;const Tn=["language","worldview","jobid"];let Yr,On;function Qn(){try{return caches}catch{}}function Kn(){const u=Qn();u&&Yr==null&&(Yr=u.open(kr))}let Di=1/0;const Li={supported:!1,testSupport:function(u){!Ka&&os&&(As?Ma(u):mo=u)}};let mo,os,Ka=!1,As=!1;const Xs=typeof self<"u"?self:{};function Ma(u){const n=u.createTexture();u.bindTexture(u.TEXTURE_2D,n);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,os),u.isContextLost())return;Li.supported=!0}catch{}u.deleteTexture(n),Ka=!0}Xs.document&&(os=Xs.document.createElement("img"),os.onload=function(){mo&&Ma(mo),mo=null,As=!0},os.onerror=function(){Ka=!0,mo=null},os.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Bo={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Bo);class ka extends Error{constructor(n,a,d){a===401&&Ge(d)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=a,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const la=jo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ca=function(u,n){if(!(/^file:/.test(a=u.url)||/^file:/.test(la())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,_){const f=new AbortController,y=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:la(),referrerPolicy:d.referrerPolicy,signal:f.signal});let T=!1,C=!1;const M=(x=y.url).indexOf("sku=")>0&&Ge(x);var x;d.type==="json"&&y.headers.set("Accept","application/json");const I=(A,R,D)=>{if(C)return;if(A&&A.message!=="SecurityError"&&en(A.toString()),R&&D)return P(R);const N=Date.now();fetch(y).then(j=>{if(j.ok){const Z=M?j.clone():null;return P(j,Z,N)}return _(new ka(j.statusText,j.status,d.url))}).catch(j=>{j.name!=="AbortError"&&_(new Error(`${j.message} ${d.url}`))})},P=(A,R,D)=>{(d.type==="arrayBuffer"?A.arrayBuffer():d.type==="json"?A.json():A.text()).then(N=>{C||(R&&D&&function(j,Z,X){if(Kn(),Yr==null)return;const G=is(Z.headers.get("Cache-Control")||"");if(G["no-store"])return;const J={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((Ce,Pe)=>J.headers.set(Pe,Ce)),G["max-age"]&&J.headers.set("Expires",new Date(X+1e3*G["max-age"]).toUTCString());const se=J.headers.get("Expires");if(!se||new Date(se).getTime()-X<42e4)return;let _e=Br(j.url,{persistentParams:Tn});if(Z.status===206){const Ce=j.headers.get("Range");if(!Ce)return;J.status=200,_e=Rr(_e,{range:Ce})}(function(Ce,Pe){if(On===void 0)try{new Response(new ReadableStream),On=!0}catch{On=!1}On?Pe(Ce.body):Ce.blob().then(Pe)})(Z,Ce=>{const Pe=new Response((Ee=Z.status)!==200&&Ee!==404&&[101,103,204,205,304].includes(Ee)?null:Ce,J);var Ee;Kn(),Yr!=null&&Yr.then(Ve=>Ve.put(_e,Pe)).catch(Ve=>en(Ve.message))})}(y,R,D),T=!0,_(null,N,A.headers.get("Cache-Control"),A.headers.get("Expires")))}).catch(N=>{C||_(new Error(N.message))})};return M?function(A,R){if(Kn(),Yr==null)return R(null);Yr.then(D=>{let N=Br(A.url,{persistentParams:Tn});const j=A.headers.get("Range");j&&(N=Rr(N,{range:j})),D.match(N).then(Z=>{const X=function(G){if(!G)return!1;const J=new Date(G.headers.get("Expires")||0),se=is(G.headers.get("Cache-Control")||"");return J>Date.now()&&!se["no-cache"]}(Z);D.delete(N),X&&D.put(N,Z.clone()),R(null,Z,X)}).catch(R)}).catch(R)}(y,I):I(null,null),{cancel:()=>{C=!0,T||f.abort()}}}(u,n);if(jo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,n,void 0,!0)}var a;return function(d,_){const f=new XMLHttpRequest;f.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const y in d.headers)f.setRequestHeader(y,d.headers[y]);return d.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=d.credentials==="include",f.onerror=()=>{_(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let y=f.response;if(d.type==="json")try{y=JSON.parse(f.response)}catch(T){return _(T)}_(null,y,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else _(new ka(f.statusText,f.status,d.url))},f.send(d.body),{cancel:()=>f.abort()}}(u,n)},Ys=function(u,n){return ca(ln(u,{type:"arrayBuffer"}),n)};function Xi(u){const n=document.createElement("a");return n.href=u,n.protocol===location.protocol&&n.host===location.host}const ji="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let eo,Ci;eo=[],Ci=0;const Yi=function(u,n){if(Li.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Ci>=Ke.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:u,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return eo.push(f),f}Ci++;let a=!1;const d=()=>{if(!a)for(a=!0,Ci--;eo.length&&Ci<Ke.MAX_PARALLEL_IMAGE_REQUESTS;){const f=eo.shift(),{requestParameters:y,callback:T,cancelled:C}=f;C||(f.cancel=Yi(y,T).cancel)}},_=Ys(u,(f,y,T,C)=>{d(),f?n(f):y&&(self.createImageBitmap?function(M,x){const I=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(I).then(P=>{x(null,P)}).catch(P=>{x(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(M,x)=>n(M,x,T,C)):function(M,x){const I=new Image;I.onload=()=>{x(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=ji})},I.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(M)],{type:"image/png"});I.src=M.byteLength?URL.createObjectURL(P):ji}(y,(M,x)=>n(M,x,T,C)))});return{cancel:()=>{_.cancel(),d()}}};var go,io,_s,Ko={exports:{}},ei={exports:{}},ua={exports:{}},Js=function(){if(_s)return Ko.exports;_s=1;var u=(go||(go=1,ei.exports=function(a,d){var _,f,y,T,C,M,x,I;for(f=a.length-(_=3&a.length),y=d,C=3432918353,M=461845907,I=0;I<f;)x=255&a.charCodeAt(I)|(255&a.charCodeAt(++I))<<8|(255&a.charCodeAt(++I))<<16|(255&a.charCodeAt(++I))<<24,++I,y=27492+(65535&(T=5*(65535&(y=(y^=x=(65535&(x=(x=(65535&x)*C+(((x>>>16)*C&65535)<<16)&4294967295)<<15|x>>>17))*M+(((x>>>16)*M&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(x=0,_){case 3:x^=(255&a.charCodeAt(I+2))<<16;case 2:x^=(255&a.charCodeAt(I+1))<<8;case 1:y^=x=(65535&(x=(x=(65535&(x^=255&a.charCodeAt(I)))*C+(((x>>>16)*C&65535)<<16)&4294967295)<<15|x>>>17))*M+(((x>>>16)*M&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),ei.exports),n=(io||(io=1,ua.exports=function(a,d){for(var _,f=a.length,y=d^f,T=0;f>=4;)_=1540483477*(65535&(_=255&a.charCodeAt(T)|(255&a.charCodeAt(++T))<<8|(255&a.charCodeAt(++T))<<16|(255&a.charCodeAt(++T))<<24))+((1540483477*(_>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(_=1540483477*(65535&(_^=_>>>24))+((1540483477*(_>>>16)&65535)<<16)),f-=4,++T;switch(f){case 3:y^=(255&a.charCodeAt(T+2))<<16;case 2:y^=(255&a.charCodeAt(T+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(T)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),ua.exports);return Ko.exports=u,Ko.exports.murmur3=u,Ko.exports.murmur2=n,Ko.exports}(),Ji=O(Js);class Cs{constructor(n,...a){ln(this,a[0]||{}),this.type=n}}class Qs extends Cs{constructor(n,a={}){super("error",ln({error:n},a))}}function Ao(u,n,a){a[u]&&a[u].indexOf(n)!==-1||(a[u]=a[u]||[],a[u].push(n))}function ea(u,n,a){if(a&&a[u]){const d=a[u].indexOf(n);d!==-1&&a[u].splice(d,1)}}class Xo{on(n,a){return this._listeners=this._listeners||{},Ao(n,a,this._listeners),this}off(n,a){return ea(n,a,this._listeners),ea(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Ao(n,a,this._oneTimeListeners),this):new Promise(d=>this.once(n,d))}fire(n,a){const d=typeof n=="string"?new Cs(n,a):n,_=d.type;if(this.listens(_)){d.target=this;const f=this._listeners&&this._listeners[_]?this._listeners[_].slice():[];for(const C of f)C.call(this,d);const y=this._oneTimeListeners&&this._oneTimeListeners[_]?this._oneTimeListeners[_].slice():[];for(const C of y)ea(_,C,this._oneTimeListeners),C.call(this,d);const T=this._eventedParent;T&&(ln(d,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(d))}else d instanceof Qs&&console.error(d.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var Oa,it={},Ht=function(){if(Oa)return it;Oa=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function a(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function d(f){return(y=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:y>1?1:y;var y}function _(f,y,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?f+(y-f)*T*6:2*T<1?y:3*T<2?f+(y-f)*(2/3-T)*6:f}try{it.parseCSSColor=function(f){var y,T=f.replace(/ /g,"").toLowerCase();if(T in u)return u[T].slice();if(T[0]==="#")return T.length===4?(y=parseInt(T.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:T.length===7&&(y=parseInt(T.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var C=T.indexOf("("),M=T.indexOf(")");if(C!==-1&&M+1===T.length){var x=T.substr(0,C),I=T.substr(C+1,M-(C+1)).split(","),P=1;switch(x){case"rgba":if(I.length!==4)return null;P=d(I.pop());case"rgb":return I.length!==3?null:[a(I[0]),a(I[1]),a(I[2]),P];case"hsla":if(I.length!==4)return null;P=d(I.pop());case"hsl":if(I.length!==3)return null;var A=(parseFloat(I[0])%360+360)%360/360,R=d(I[1]),D=d(I[2]),N=D<=.5?D*(R+1):D+R-D*R,j=2*D-N;return[n(255*_(j,N,A+1/3)),n(255*_(j,N,A)),n(255*_(j,N,A-1/3)),P];default:return null}}return null}}catch{}return it}();class Zt{constructor(n,a,d,_=1){this.r=n,this.g=a,this.b=d,this.a=_}static parse(n){if(!n)return;if(n instanceof Zt)return n;if(typeof n!="string")return;const a=Ht.parseCSSColor(n);return a?new Zt(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[n,a,d,_]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(a)},${Math.round(d)},${_})`}toRenderColor(n){const{r:a,g:d,b:_,a:f}=this;return new vn(n,a,d,_,f)}}class vn{constructor(n,a,d,_,f){if(n){const y=n.image.height,T=y*y;a=f===0?0:a/f*(y-1),d=f===0?0:d/f*(y-1),_=f===0?0:_/f*(y-1);const C=Math.floor(a),M=Math.floor(d),x=Math.floor(_),I=Math.ceil(a),P=Math.ceil(d),A=Math.ceil(_),R=a-C,D=d-M,N=_-x,j=n.image.data,Z=4*(C+M*T+x*y),X=4*(C+M*T+A*y),G=4*(C+P*T+x*y),J=4*(C+P*T+A*y),se=4*(I+M*T+x*y),_e=4*(I+M*T+A*y),Ce=4*(I+P*T+x*y),Pe=4*(I+P*T+A*y);if(Z<0||Pe>=j.length)throw new Error("out of range");this.r=vr(vr(vr(j[Z],j[X],N),vr(j[G],j[J],N),D),vr(vr(j[se],j[_e],N),vr(j[Ce],j[Pe],N),D),R)/255*f,this.g=vr(vr(vr(j[Z+1],j[X+1],N),vr(j[G+1],j[J+1],N),D),vr(vr(j[se+1],j[_e+1],N),vr(j[Ce+1],j[Pe+1],N),D),R)/255*f,this.b=vr(vr(vr(j[Z+2],j[X+2],N),vr(j[G+2],j[J+2],N),D),vr(vr(j[se+2],j[_e+2],N),vr(j[Ce+2],j[Pe+2],N),D),R)/255*f,this.a=f}else this.r=a,this.g=d,this.b=_,this.a=f}toArray(){const{r:n,g:a,b:d,a:_}=this;return _===0?[0,0,0,0]:[255*n/_,255*a/_,255*d/_,_]}toArray01(){const{r:n,g:a,b:d,a:_}=this;return _===0?[0,0,0,0]:[n/_,a/_,d/_,_]}toArray01Scaled(n){const{r:a,g:d,b:_,a:f}=this;return f===0?[0,0,0]:[a/f*n,d/f*n,_/f*n]}toArray01PremultipliedAlpha(){const{r:n,g:a,b:d,a:_}=this;return[n,a,d,_]}toArray01Linear(){const{r:n,g:a,b:d,a:_}=this;return _===0?[0,0,0,0]:[Math.pow(n/_,2.2),Math.pow(a/_,2.2),Math.pow(d/_,2.2),_]}}function vr(u,n,a){return u*(1-a)+n*a}function pi(u,n,a){return u.map((d,_)=>vr(d,n[_],a))}Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1),Zt.blue=new Zt(0,0,1,1);var Bi=Object.freeze({__proto__:null,array:pi,color:function(u,n,a){return new Zt(vr(u.r,n.r,a),vr(u.g,n.g,a),vr(u.b,n.b,a),vr(u.a,n.a,a))},number:vr});function ai(u,...n){for(const a of n)for(const d in a)u[d]=a[d];return u}class _o extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class Ri{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[d,_]of a)this.bindings[d]=_}concat(n){return new Ri(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Yo={kind:"null"},cr={kind:"number"},cn={kind:"string"},fn={kind:"boolean"},oo={kind:"color"},$i={kind:"object"},on={kind:"value"},Bs={kind:"collator"},ss={kind:"formatted"},mi={kind:"resolvedImage"};function Co(u,n){return{kind:"array",itemType:u,N:n}}function Xe(u){if(u.kind==="array"){const n=Xe(u.itemType);return typeof u.N=="number"?`array<${n}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${n}>`}return u.kind}const Rt=[Yo,cr,cn,fn,oo,ss,$i,Co(on),mi];function gr(u,n){if(n.kind==="error")return null;if(u.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!gr(u.itemType,n.itemType))&&(typeof u.N!="number"||u.N===n.N))return null}else{if(u.kind===n.kind)return null;if(u.kind==="value"){for(const a of Rt)if(!gr(a,n))return null}}return`Expected ${Xe(u)} but found ${Xe(n)} instead.`}function $r(u,n){return n.some(a=>a.kind===u.kind)}function Dn(u,n){return n.some(a=>a==="null"?u===null:a==="array"?Array.isArray(u):a==="object"?u&&!Array.isArray(u)&&typeof u=="object":a===typeof u)}class An{constructor(n,a,d){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pn{constructor(n,a,d,_,f){this.text=n.normalize?n.normalize():n,this.image=a,this.scale=d,this.fontStack=_,this.textColor=f}}class ti{constructor(n){this.sections=n}static fromString(n){return new ti([new Pn(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof ti?n:ti.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const a of this.sections){if(a.image){n.push(["image",a.image.namePrimary]);continue}n.push(a.text);const d={};a.fontStack&&(d["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(d["font-scale"]=a.scale),a.textColor&&(d["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),n.push(d)}return n}}class hi{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,a){return n?new hi({namePrimary:n,nameSecondary:a,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function xi(u,n,a,d){return typeof u=="number"&&u>=0&&u<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[u,n,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[u,n,a,d]:[u,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fo(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Zt||u instanceof An||u instanceof ti||u instanceof hi)return!0;if(Array.isArray(u)){for(const n of u)if(!fo(n))return!1;return!0}if(typeof u=="object"){for(const n in u)if(!fo(u[n]))return!1;return!0}return!1}function qn(u){if(u===null)return Yo;if(typeof u=="string")return cn;if(typeof u=="boolean")return fn;if(typeof u=="number")return cr;if(u instanceof Zt)return oo;if(u instanceof An)return Bs;if(u instanceof ti)return ss;if(u instanceof hi)return mi;if(Array.isArray(u)){const n=u.length;let a;for(const d of u){const _=qn(d);if(a){if(a===_)continue;a=on;break}a=_}return Co(a||on,n)}return $i}function ni(u){const n=typeof u;return u===null?"":n==="string"||n==="number"||n==="boolean"?String(u):u instanceof Zt||u instanceof ti||u instanceof hi?u.toString():JSON.stringify(u)}class so{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!fo(n[1]))return a.error("invalid value");const d=n[1];let _=qn(d);const f=a.expectedType;return _.kind!=="array"||_.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(_=f),new so(_,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Zt?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof ti?this.value.serialize():this.value}}class ii{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const zs={string:cn,number:cr,boolean:fn,object:$i};class yo{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let d,_=1;const f=n[0];if(f==="array"){let T,C;if(n.length>2){const M=n[1];if(typeof M!="string"||!(M in zs)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);T=zs[M],_++}else T=on;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=n[2],_++}d=Co(T,C)}else d=zs[f];const y=[];for(;_<n.length;_++){const T=a.parse(n[_],_,on);if(!T)return null;y.push(T)}return new yo(d,y)}evaluate(n){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(n);if(!gr(this.type,qn(d)))return d;if(a===this.args.length-1)throw new ii(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Xe(qn(d))} but was expected to be of type ${Xe(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,a=[n.kind];if(n.kind==="array"){const d=n.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){a.push(d.kind);const _=n.N;(typeof _=="number"||this.args.length>1)&&a.push(_)}}return a.concat(this.args.map(d=>d.serialize()))}}class Ro{constructor(n){this.type=ss,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const d=n[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");const _=[];let f=!1;for(let y=1;y<=n.length-1;++y){const T=n[y];if(f&&typeof T=="object"&&!Array.isArray(T)){f=!1;let C=null;if(T["font-scale"]&&(C=a.parseObjectValue(T["font-scale"],y,"font-scale",cr),!C))return null;let M=null;if(T["text-font"]&&(M=a.parseObjectValue(T["text-font"],y,"text-font",Co(cn)),!M))return null;let x=null;if(T["text-color"]&&(x=a.parseObjectValue(T["text-color"],y,"text-color",oo),!x))return null;const I=_[_.length-1];I.scale=C,I.font=M,I.textColor=x}else{const C=a.parse(n[y],y,on);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,_.push({content:C,scale:null,font:null,textColor:null})}}return new Ro(_)}evaluate(n){return new ti(this.sections.map(a=>{const d=a.content.evaluate(n);return qn(d)===mi?new Pn("",d,null,null,null):new Pn(ni(d),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null)}))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const a of this.sections){n.push(a.content.serialize());const d={};a.scale&&(d["font-scale"]=a.scale.serialize()),a.font&&(d["text-font"]=a.font.serialize()),a.textColor&&(d["text-color"]=a.textColor.serialize()),n.push(d)}return n}}class ha{constructor(n,a){this.type=mi,this.inputPrimary=n,this.inputSecondary=a}static parse(n,a){if(n.length<2)return a.error("Expected two or more arguments.");const d=a.parse(n[1],1,cn);if(!d)return a.error("No image name provided.");if(n.length===2)return new ha(d);const _=a.parse(n[2],1,cn);return _?new ha(d,_):a.error("Secondary image variant is not a string.")}evaluate(n){const a=hi.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return a&&n.availableImages&&(a.available=n.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&n.availableImages&&(a.available=n.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ns(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}const Fs={"to-boolean":fn,"to-color":oo,"to-number":cr,"to-string":cn};class ta{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const d=n[0],_=[];let f=Yo;if(d==="to-array"){if(!Array.isArray(n[1]))return null;const y=n[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);f=Co(a.expectedType.itemType,y)}else{if(!(y>0&&fo(n[1][0])))return null;f=Co(qn(n[1][0]),y)}for(let T=0;T<y;T++){const C=n[1][T];let M;if(Ns(C)==="array")M=a.parse(C,void 0,f.itemType);else{const x=Ns(C);if(x!==f.itemType.kind)return a.error(`Expected ${f.itemType.kind} but found ${x}.`);M=a.registry.literal.parse(["literal",C===void 0?null:C],a)}if(!M)return null;_.push(M)}}else{if((d==="to-boolean"||d==="to-string")&&n.length!==2)return a.error("Expected one argument.");f=Fs[d];for(let y=1;y<n.length;y++){const T=a.parse(n[y],y,on);if(!T)return null;_.push(T)}}return new ta(f,_)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let a,d;for(const _ of this.args){if(a=_.evaluate(n),d=null,a instanceof Zt)return a;if(typeof a=="string"){const f=n.parseColor(a);if(f)return f}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:xi(a[0],a[1],a[2],a[3]),!d))return new Zt(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ii(d||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const d of this.args){if(a=d.evaluate(n),a===null)return 0;const _=Number(a);if(!isNaN(_))return _}throw new ii(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?ti.fromString(ni(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?hi.fromString(ni(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(a=>a.evaluate(n)):ni(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ro([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ha(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{n.push(a.serialize())}),n}}const Eu=["Unknown","Point","LineString","Polygon"];class da{constructor(n,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Eu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y:_}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-n[0])+this.featureDistanceData.bearing[1]*(_*a-n[1])}return 0}parseColor(n){let a=this._parseColorCache[n];return a||(a=this._parseColorCache[n]=Zt.parse(n)),a}getConfig(n){return this.options?this.options.get(n):null}}class as{constructor(n,a,d,_,f){this.name=n,this.type=a,this._evaluate=d,this.args=_,this._overloadIndex=f}evaluate(n){if(!this._evaluate){const a=as.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,a){const d=n[0],_=as.definitions[d];if(!_)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(_)?_[0]:_.type,y=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,T=[];let C=null,M=-1;for(const[x,I]of y){if(Array.isArray(x)&&x.length!==n.length-1)continue;T.push(x),M++,C=new yp(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const P=[];let A=!1;for(let R=1;R<n.length;R++){const D=n[R],N=Array.isArray(x)?x[R-1]:x.type,j=C.parse(D,1+P.length,N);if(!j){A=!0;break}P.push(j)}if(!A)if(Array.isArray(x)&&x.length!==P.length)C.error(`Expected ${x.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const D=Array.isArray(x)?x[R]:x.type,N=P[R];C.concat(R+1).checkSubtype(D,N.type)}if(C.errors.length===0)return new as(d,f,I,P,M)}}if(T.length===1)a.errors.push(...C.errors);else{const x=(T.length?T:y.map(([P])=>P)).map(vh).join(" | "),I=[];for(let P=1;P<n.length;P++){const A=a.parse(n[P],1+I.length);if(!A)return null;I.push(Xe(A.type))}a.error(`Expected arguments of type ${x}, but found (${I.join(", ")}) instead.`)}return null}static register(n,a){as.definitions=a;for(const d in a)n[d]=as}}function vh(u){return Array.isArray(u)?`(${u.map(Xe).join(", ")})`:`(${Xe(u.type)}...)`}class fa{constructor(n,a,d){this.type=Bs,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const d=n[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");const _=d["case-sensitive"]===void 0?a.parse(!1,1,fn):a.parseObjectValue(d["case-sensitive"],1,"case-sensitive",fn);if(!_)return null;const f=d["diacritic-sensitive"]===void 0?a.parse(!1,1,fn):a.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",fn);if(!f)return null;let y=null;return d.locale&&(y=a.parseObjectValue(d.locale,1,"locale",cn),!y)?null:new fa(_,f,y)}evaluate(n){return new An(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function Su(u,n,a=0,d=u.length-1,_=Pl){for(;d>a;){if(d-a>600){const C=d-a+1,M=n-a+1,x=Math.log(C),I=.5*Math.exp(2*x/3),P=.5*Math.sqrt(x*I*(C-I)/C)*(M-C/2<0?-1:1);Su(u,n,Math.max(a,Math.floor(n-M*I/C+P)),Math.min(d,Math.floor(n+(C-M)*I/C+P)),_)}const f=u[n];let y=a,T=d;for(Rl(u,a,n),_(u[d],f)>0&&Rl(u,a,d);y<T;){for(Rl(u,y,T),y++,T--;_(u[y],f)<0;)y++;for(;_(u[T],f)>0;)T--}_(u[a],f)===0?Rl(u,a,T):(T++,Rl(u,T,d)),T<=n&&(a=T+1),n<=T&&(d=T-1)}}function Rl(u,n,a){const d=u[n];u[n]=u[a],u[a]=d}function Pl(u,n){return u<n?-1:u>n?1:0}function bh(u){let n=0;for(let a,d,_=0,f=u.length,y=f-1;_<f;y=_++)a=u[_],d=u[y],n+=(d.x-a.x)*(a.y+d.y);return n}function Xa(u,n){u[0]=Math.min(u[0],n[0]),u[1]=Math.min(u[1],n[1]),u[2]=Math.max(u[2],n[0]),u[3]=Math.max(u[3],n[1])}function zo(u,n){return!(u[0]<=n[0]||u[2]>=n[2]||u[1]<=n[1]||u[3]>=n[3])}function xh(u,n,a){const d=u[0]-n[0],_=u[1]-n[1],f=u[0]-a[0],y=u[1]-a[1];return d*y-f*_==0&&d*f<=0&&_*y<=0}function ra(u,n,a=!1){let d=!1;for(let T=0,C=n.length;T<C;T++){const M=n[T];for(let x=0,I=M.length,P=I-1;x<I;P=x++){const A=M[P],R=M[x];if(xh(u,A,R))return a;(f=A)[1]>(_=u)[1]!=(y=R)[1]>_[1]&&_[0]<(y[0]-f[0])*(_[1]-f[1])/(y[1]-f[1])+f[0]&&(d=!d)}}var _,f,y;return d}function Vs(u,n,a,d){const _=d[0]-a[0],f=d[1]-a[1],y=(u[0]-a[0])*f-_*(u[1]-a[1]),T=(n[0]-a[0])*f-_*(n[1]-a[1]);return y>0&&T<0||y<0&&T>0}function B(u,n,a,d){return(_=[d[0]-a[0],d[1]-a[1]])[0]*(f=[n[0]-u[0],n[1]-u[1]])[1]-_[1]*f[0]!=0&&!(!Vs(u,n,a,d)||!Vs(a,d,u,n));var _,f}const ee=8192;function de(u,n){const a=(180+u[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,_=Math.pow(2,n.z);return[Math.round(a*_*ee),Math.round(d*_*ee)]}function Me(u,n){for(let a=0;a<n.length;a++)if(ra(u,n[a]))return!0;return!1}function Bt(u,n,a){for(const d of a)for(let _=0,f=d.length,y=f-1;_<f;y=_++)if(B(u,n,d[y],d[_]))return!0;return!1}function wt(u,n){for(let a=0;a<u.length;++a)if(!ra(u[a],n))return!1;for(let a=0;a<u.length-1;++a)if(Bt(u[a],u[a+1],n))return!1;return!0}function Or(u,n){for(let a=0;a<n.length;a++)if(wt(u,n[a]))return!0;return!1}function wi(u,n,a){const d=[];for(let _=0;_<u.length;_++){const f=[];for(let y=0;y<u[_].length;y++){const T=de(u[_][y],a);Xa(n,T),f.push(T)}d.push(f)}return d}function Dr(u,n,a){const d=[];for(let _=0;_<u.length;_++){const f=wi(u[_],n,a);d.push(f)}return d}function di(u,n,a,d){if(u[0]<a[0]||u[0]>a[2]){const _=.5*d;let f=u[0]-a[0]>_?-d:a[0]-u[0]>_?d:0;f===0&&(f=u[0]-a[2]>_?-d:a[2]-u[0]>_?d:0),u[0]+=f}Xa(n,u)}function zi(u,n,a,d){const _=Math.pow(2,d.z)*ee,f=[d.x*ee,d.y*ee],y=[];if(!u)return y;for(const T of u)for(const C of T){const M=[C.x+f[0],C.y+f[1]];di(M,n,a,_),y.push(M)}return y}function Go(u,n,a,d){const _=Math.pow(2,d.z)*ee,f=[d.x*ee,d.y*ee],y=[];if(!u)return y;for(const C of u){const M=[];for(const x of C){const I=[x.x+f[0],x.y+f[1]];Xa(n,I),M.push(I)}y.push(M)}if(n[2]-n[0]<=_/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of y)for(const M of C)di(M,n,a,_)}var T;return y}class Rs{constructor(n,a){this.type=fn,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(fo(n[1])){const d=n[1];if(d.type==="FeatureCollection")for(let _=0;_<d.features.length;++_){const f=d.features[_].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Rs(d,d.features[_].geometry)}else if(d.type==="Feature"){const _=d.geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Rs(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Rs(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,d){const _=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const T=wi(d.coordinates,f,y),C=zi(a.geometry(),_,f,y);if(!zo(_,f))return!1;for(const M of C)if(!ra(M,T))return!1}if(d.type==="MultiPolygon"){const T=Dr(d.coordinates,f,y),C=zi(a.geometry(),_,f,y);if(!zo(_,f))return!1;for(const M of C)if(!Me(M,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,d){const _=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(d.type==="Polygon"){const T=wi(d.coordinates,f,y),C=Go(a.geometry(),_,f,y);if(!zo(_,f))return!1;for(const M of C)if(!wt(M,T))return!1}if(d.type==="MultiPolygon"){const T=Dr(d.coordinates,f,y),C=Go(a.geometry(),_,f,y);if(!zo(_,f))return!1;for(const M of C)if(!Or(M,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Jo={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},No=1/298.257223563,ql=No*(2-No),sc=Math.PI/180;class Ml{static fromTile(n,a,d){const _=Math.PI*(1-2*(n+.5)/Math.pow(2,a)),f=Math.atan(.5*(Math.exp(_)-Math.exp(-_)))/sc;return new Ml(f,d)}static get units(){return Jo}constructor(n,a){if(n===void 0)throw new Error("No latitude given.");if(a&&!Jo[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Jo).join(", ")}`);const d=6378.137*sc*(a?Jo[a]:1),_=Math.cos(n*sc),f=1/(1-ql*(1-_*_)),y=Math.sqrt(f);this.kx=d*y*_,this.ky=d*y*f*(1-ql)}distance(n,a){const d=to(n[0]-a[0])*this.kx,_=(n[1]-a[1])*this.ky;return Math.sqrt(d*d+_*_)}bearing(n,a){const d=to(a[0]-n[0])*this.kx;return Math.atan2(d,(a[1]-n[1])*this.ky)/sc}destination(n,a,d){const _=d*sc;return this.offset(n,Math.sin(_)*a,Math.cos(_)*a)}offset(n,a,d){return[n[0]+a/this.kx,n[1]+d/this.ky]}lineDistance(n){let a=0;for(let d=0;d<n.length-1;d++)a+=this.distance(n[d],n[d+1]);return a}area(n){let a=0;for(let d=0;d<n.length;d++){const _=n[d];for(let f=0,y=_.length,T=y-1;f<y;T=f++)a+=to(_[f][0]-_[T][0])*(_[f][1]+_[T][1])*(d?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(n,a){let d=0;if(a<=0)return n[0];for(let _=0;_<n.length-1;_++){const f=n[_],y=n[_+1],T=this.distance(f,y);if(d+=T,d>a)return kl(f,y,(a-(d-T))/T)}return n[n.length-1]}pointToSegmentDistance(n,a,d){let[_,f]=a,y=to(d[0]-_)*this.kx,T=(d[1]-f)*this.ky;if(y!==0||T!==0){const C=(to(n[0]-_)*this.kx*y+(n[1]-f)*this.ky*T)/(y*y+T*T);C>1?(_=d[0],f=d[1]):C>0&&(_+=y/this.kx*C,f+=T/this.ky*C)}return y=to(n[0]-_)*this.kx,T=(n[1]-f)*this.ky,Math.sqrt(y*y+T*T)}pointOnLine(n,a){let d=1/0,_=n[0][0],f=n[0][1],y=0,T=0;for(let C=0;C<n.length-1;C++){let M=n[C][0],x=n[C][1],I=to(n[C+1][0]-M)*this.kx,P=(n[C+1][1]-x)*this.ky,A=0;I===0&&P===0||(A=(to(a[0]-M)*this.kx*I+(a[1]-x)*this.ky*P)/(I*I+P*P),A>1?(M=n[C+1][0],x=n[C+1][1]):A>0&&(M+=I/this.kx*A,x+=P/this.ky*A)),I=to(a[0]-M)*this.kx,P=(a[1]-x)*this.ky;const R=I*I+P*P;R<d&&(d=R,_=M,f=x,y=C,T=A)}return{point:[_,f],index:y,t:Math.max(0,Math.min(1,T))}}lineSlice(n,a,d){let _=this.pointOnLine(d,n),f=this.pointOnLine(d,a);if(_.index>f.index||_.index===f.index&&_.t>f.t){const M=_;_=f,f=M}const y=[_.point],T=_.index+1,C=f.index;!wh(d[T],y[0])&&T<=C&&y.push(d[T]);for(let M=T+1;M<=C;M++)y.push(d[M]);return wh(d[C],f.point)||y.push(f.point),y}lineSliceAlong(n,a,d){let _=0;const f=[];for(let y=0;y<d.length-1;y++){const T=d[y],C=d[y+1],M=this.distance(T,C);if(_+=M,_>n&&f.length===0&&f.push(kl(T,C,(n-(_-M))/M)),_>=a)return f.push(kl(T,C,(a-(_-M))/M)),f;_>n&&f.push(C)}return f}bufferPoint(n,a){const d=a/this.ky,_=a/this.kx;return[n[0]-_,n[1]-d,n[0]+_,n[1]+d]}bufferBBox(n,a){const d=a/this.ky,_=a/this.kx;return[n[0]-_,n[1]-d,n[2]+_,n[3]+d]}insideBBox(n,a){return to(n[0]-a[0])>=0&&to(n[0]-a[2])<=0&&n[1]>=a[1]&&n[1]<=a[3]}}function wh(u,n){return u[0]===n[0]&&u[1]===n[1]}function kl(u,n,a){const d=to(n[0]-u[0]);return[u[0]+d*a,u[1]+(n[1]-u[1])*a]}function to(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Jd{constructor(n=[],a=(d,_)=>d<_?-1:d>_?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:d}=this,_=a[n];for(;n>0;){const f=n-1>>1,y=a[f];if(d(_,y)>=0)break;a[n]=y,n=f}a[n]=_}_down(n){const{data:a,compare:d}=this,_=this.length>>1,f=a[n];for(;n<_;){let y=1+(n<<1);const T=y+1;if(T<this.length&&d(a[T],a[y])<0&&(y=T),d(a[y],f)>=0)break;a[n]=a[y],n=y}a[n]=f}}var fr=8192;function Qd(u,n){return n.dist-u.dist}const ac=100,Iu=50;function lc(u){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==u.length)return!1;for(let a=0;a<n.length;a++)if(n[a]!==u[a])return!1;return!0}function Au(u){return u[1]-u[0]+1}function Ya(u,n){const a=u[1]>=u[0]&&u[1]<n;return a||console.warn("Distance Expression: Index is out of range"),a}function na(u,n){if(u[0]>u[1])return[null,null];const a=Au(u);if(n){if(a===2)return[u,null];const d=Math.floor(a/2);return[[u[0],u[0]+d],[u[0]+d,u[1]]]}{if(a===1)return[u,null];const d=Math.floor(a/2)-1;return[[u[0],u[0]+d],[u[0]+d+1,u[1]]]}}function pa(u,n){const a=[1/0,1/0,-1/0,-1/0];if(!Ya(n,u.length))return a;for(let d=n[0];d<=n[1];++d)Xa(a,u[d]);return a}function Th(u){const n=[1/0,1/0,-1/0,-1/0];for(let a=0;a<u.length;++a)for(let d=0;d<u[a].length;++d)Xa(n,u[a][d]);return n}function cc(u,n,a){if(lc(u)||lc(n))return NaN;let d=0,_=0;return u[2]<n[0]&&(d=n[0]-u[2]),u[0]>n[2]&&(d=u[0]-n[2]),u[1]>n[3]&&(_=u[1]-n[3]),u[3]<n[1]&&(_=n[1]-u[3]),a.distance([0,0],[d,_])}function ef(u){return 360*u-180}function mp(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function ma(u,n){const a=Math.pow(2,n.z),d=(u.y/fr+n.y)/a;return[ef((u.x/fr+n.x)/a),mp(d)]}function gp(u,n){const a=[];for(let d=0;d<u.length;++d)a.push(ma(u[d],n));return a}function tf(u,n,a){const d=a.pointOnLine(n,u).point;return a.distance(u,d)}function rf(u,n,a,d,_){const f=a.slice(d[0],d[1]+1);let y=1/0;for(let T=n[0];T<=n[1];++T)if((y=Math.min(y,tf(u[T],f,_)))===0)return 0;return y}function Eh(u,n,a,d,_){const f=Math.min(_.pointToSegmentDistance(u,a,d),_.pointToSegmentDistance(n,a,d)),y=Math.min(_.pointToSegmentDistance(a,u,n),_.pointToSegmentDistance(d,u,n));return Math.min(f,y)}function nf(u,n,a,d,_){if(!Ya(n,u.length)||!Ya(d,a.length))return NaN;let f=1/0;for(let y=n[0];y<n[1];++y)for(let T=d[0];T<d[1];++T){if(B(u[y],u[y+1],a[T],a[T+1]))return 0;f=Math.min(f,Eh(u[y],u[y+1],a[T],a[T+1],_))}return f}function of(u,n,a,d,_){if(!Ya(n,u.length)||!Ya(d,a.length))return NaN;let f=1/0;for(let y=n[0];y<=n[1];++y)for(let T=d[0];T<=d[1];++T)if((f=Math.min(f,_.distance(u[y],a[T])))===0)return f;return f}function Sh(u,n,a){if(ra(u,n,!0))return 0;let d=1/0;for(const _ of n){const f=_.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(_[0]!==_[f-1]&&(d=Math.min(d,a.pointToSegmentDistance(u,_[f-1],_[0])))===0||(d=Math.min(d,tf(u,_,a)))===0)return d}return d}function _p(u,n,a,d){if(!Ya(n,u.length))return NaN;for(let f=n[0];f<=n[1];++f)if(ra(u[f],a,!0))return 0;let _=1/0;for(let f=n[0];f<n[1];++f)for(const y of a)for(let T=0,C=y.length,M=C-1;T<C;M=T++){if(B(u[f],u[f+1],y[M],y[T]))return 0;_=Math.min(_,Eh(u[f],u[f+1],y[M],y[T],d))}return _}function sf(u,n){for(const a of u)for(let d=0;d<=a.length-1;++d)if(ra(a[d],n,!0))return!0;return!1}function Hl(u,n,a,d=1/0){const _=Th(u),f=Th(n);if(d!==1/0&&cc(_,f,a)>=d)return d;if(zo(_,f)){if(sf(u,n))return 0}else if(sf(n,u))return 0;let y=d;for(const T of u)for(let C=0,M=T.length,x=M-1;C<M;x=C++)for(const I of n)for(let P=0,A=I.length,R=A-1;P<A;R=P++){if(B(T[x],T[C],I[R],I[P]))return 0;y=Math.min(y,Eh(T[x],T[C],I[R],I[P],a))}return y}function ga(u,n,a,d,_,f,y){if(f===null||y===null)return;const T=cc(pa(d,f),pa(_,y),a);T<n&&u.push({dist:T,range1:f,range2:y})}function Cu(u,n,a,d,_=1/0){let f=Math.min(d.distance(u[0],a[0][0]),_);if(f===0)return f;const y=new Jd([{dist:0,range1:[0,u.length-1],range2:[0,0]}],Qd),T=n?Iu:ac,C=Th(a);for(;y.length;){const M=y.pop();if(M.dist>=f)continue;const x=M.range1;if(Au(x)<=T){if(!Ya(x,u.length))return NaN;if(n){const I=_p(u,x,a,d);if((f=Math.min(f,I))===0)return f}else for(let I=x[0];I<=x[1];++I){const P=Sh(u[I],a,d);if((f=Math.min(f,P))===0)return f}}else{const I=na(x,n);if(I[0]!==null){const P=cc(pa(u,I[0]),C,d);P<f&&y.push({dist:P,range1:I[0],range2:[0,0]})}if(I[1]!==null){const P=cc(pa(u,I[1]),C,d);P<f&&y.push({dist:P,range1:I[1],range2:[0,0]})}}}return f}function Ru(u,n,a,d,_,f=1/0){let y=Math.min(f,_.distance(u[0],a[0]));if(y===0)return y;const T=new Jd([{dist:0,range1:[0,u.length-1],range2:[0,a.length-1]}],Qd),C=n?Iu:ac,M=d?Iu:ac;for(;T.length;){const x=T.pop();if(x.dist>=y)continue;const I=x.range1,P=x.range2;if(Au(I)<=C&&Au(P)<=M){if(!Ya(I,u.length)||!Ya(P,a.length))return NaN;if(n&&d?y=Math.min(y,nf(u,I,a,P,_)):n||d?n&&!d?y=Math.min(y,rf(a,P,u,I,_)):!n&&d&&(y=Math.min(y,rf(u,I,a,P,_))):y=Math.min(y,of(u,I,a,P,_)),y===0)return y}else{const A=na(I,n),R=na(P,d);ga(T,y,_,u,a,A[0],R[0]),ga(T,y,_,u,a,A[0],R[1]),ga(T,y,_,u,a,A[1],R[0]),ga(T,y,_,u,a,A[1],R[1])}}return y}function uc(u,n,a,d,_=1/0){let f=_;const y=pa(u,[0,u.length-1]);for(const T of a)if(!(f!==1/0&&cc(y,pa(T,[0,T.length-1]),d)>=f)&&(f=Math.min(f,Ru(u,n,T,!0,d,f)),f===0))return f;return f}function Uc(u,n,a,d,_=1/0){let f=_;const y=pa(u,[0,u.length-1]);for(const T of a){if(f!==1/0&&cc(y,Th(T),d)>=f)continue;const C=Cu(u,n,T,d,f);if(isNaN(C))return C;if((f=Math.min(f,C))===0)return f}return f}function Pu(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class Ol{constructor(n,a){this.type=cr,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(fo(n[1])){const d=n[1];if(d.type==="FeatureCollection"){for(let _=0;_<d.features.length;++_)if(Pu(d.features[_].geometry.type))return new Ol(d,d.features[_].geometry)}else if(d.type==="Feature"){if(Pu(d.geometry.type))return new Ol(d,d.geometry)}else if(Pu(d.type))return new Ol(d,d)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const a=n.geometry(),d=n.canonicalID();if(a!=null&&d!=null){if(n.geometryType()==="Point")return function(_,f,y){const T=[];for(const M of _)for(const x of M)T.push(ma(x,f));const C=new Ml(T[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?Ru(T,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",C):y.type==="MultiLineString"?uc(T,!1,y.coordinates,C):y.type==="Polygon"||y.type==="MultiPolygon"?Uc(T,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,C):null}(a,d,this.geometries);if(n.geometryType()==="LineString")return function(_,f,y){const T=[];for(const M of _){const x=[];for(const I of M)x.push(ma(I,f));T.push(x)}const C=new Ml(T[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return uc(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let M=1/0;for(let x=0;x<y.coordinates.length;x++){const I=uc(y.coordinates[x],!0,T,C,M);if(isNaN(I))return I;if((M=Math.min(M,I))===0)return M}return M}if(y.type==="Polygon"||y.type==="MultiPolygon"){let M=1/0;for(let x=0;x<T.length;x++){const I=Uc(T[x],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,C,M);if(isNaN(I))return I;if((M=Math.min(M,I))===0)return M}return M}return null}(a,d,this.geometries);if(n.geometryType()==="Polygon")return function(_,f,y){const T=[];for(const M of function(x,I){const P=x.length;if(P<=1)return[x];const A=[];let R,D;for(let N=0;N<P;N++){const j=bh(x[N]);j!==0&&(x[N].area=Math.abs(j),D===void 0&&(D=j<0),D===j<0?(R&&A.push(R),R=[x[N]]):R.push(x[N]))}return R&&A.push(R),A}(_)){const x=[];for(let I=0;I<M.length;++I)x.push(gp(M[I],f));T.push(x)}const C=new Ml(T[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Uc(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",T,C);if(y.type==="MultiLineString"){let M=1/0;for(let x=0;x<y.coordinates.length;x++){const I=Uc(y.coordinates[x],!0,T,C,M);if(isNaN(I))return I;if((M=Math.min(M,I))===0)return M}return M}return y.type==="Polygon"||y.type==="MultiPolygon"?function(M,x,I){let P=1/0;for(const A of M)for(const R of x){const D=Hl(A,R,I,P);if(isNaN(D))return D;if((P=Math.min(P,D))===0)return P}return P}(y.type==="Polygon"?[y.coordinates]:y.coordinates,T,C):null}(a,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Wl(u,n){switch(u){case"string":return ni(n);case"number":return+n;case"boolean":return!!n;case"color":return Zt.parse(n);case"formatted":return ti.fromString(ni(n));case"resolvedImage":return hi.fromString(ni(n))}return n}function Ln(u,n,a,d){return d!==void 0&&(u=d*Math.round(u/d)),n!==void 0&&u<n&&(u=n),a!==void 0&&u>a&&(u=a),u}class jc{constructor(n,a,d){this.type=n,this.key=a,this.scope=d}static parse(n,a){let d=a.expectedType;if(d==null&&(d=on),n.length<2||n.length>3)return a.error("Invalid number of arguments for 'config' expression.");const _=a.parse(n[1],1);if(!(_ instanceof so))return a.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const f=a.parse(n[2],2);return f instanceof so?new jc(d,ni(_.value),ni(f.value)):a.error("Scope of 'config' expression must be a string literal.")}return new jc(d,ni(_.value))}evaluate(n){const a=[this.key,this.scope,n.scope].filter(Boolean).join(""),d=n.getConfig(a);if(!d)return null;const{type:_,value:f,values:y,minValue:T,maxValue:C,stepValue:M}=d,x=d.default.evaluate(n);let I=x;if(f){const P=n.scope;n.scope=(P||"").split("").slice(1).join(""),I=f.evaluate(n),n.scope=P}return _&&(I=Wl(_,I)),I===void 0||T===void 0&&C===void 0&&M===void 0||(typeof I=="number"?I=Ln(I,T,C,M):Array.isArray(I)&&(I=I.map(P=>typeof P=="number"?Ln(P,T,C,M):P))),f!==void 0&&I!==void 0&&y&&!y.includes(I)&&(I=x,_&&(I=Wl(_,I))),(_&&_!==this.type||I!==void 0&&qn(I)!==this.type)&&(I=Wl(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function $c(u){if(u instanceof as&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Rs||u instanceof Ol)return!1;let n=!0;return u.eachChild(a=>{n&&!$c(a)&&(n=!1)}),n}function Mu(u){if(u instanceof as&&u.name==="feature-state")return!1;let n=!0;return u.eachChild(a=>{n&&!Mu(a)&&(n=!1)}),n}function Ih(u){if(u instanceof jc)return new Set([u.key]);let n=new Set;return u.eachChild(a=>{n=new Set([...n,...Ih(a)])}),n}function ku(u,n){if(u instanceof as&&n.indexOf(u.name)>=0)return!1;let a=!0;return u.eachChild(d=>{a&&!ku(d,n)&&(a=!1)}),a}class gi{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const d=n[1];return a.scope.has(d)?new gi(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class af{constructor(n,a=[],d,_=new Ri,f=[],y,T){this.registry=n,this.path=a,this.key=a.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=_,this.errors=f,this.expectedType=d,this._scope=y,this.options=T}parse(n,a,d,_,f={}){return a||d?this.concat(a,null,d,_)._parse(n,f):this._parse(n,f)}parseObjectValue(n,a,d,_,f,y={}){return this.concat(a,d,_,f)._parse(n,y)}_parse(n,a){function d(_,f,y){return y==="assert"?new yo(f,[_]):y==="coerce"?new ta(f,[_]):_}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const _=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(_){let f=_.parse(n,this);if(!f)return null;if(this.expectedType){const y=this.expectedType,T=f.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||T.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(y,T))return null}else f=d(f,y,a.typeAnnotation||"coerce");else f=d(f,y,a.typeAnnotation||"assert")}if(!(f instanceof so)&&f.type.kind!=="resolvedImage"&&Ja(f)){const y=new da(this._scope,this.options);try{f=new so(f.type,f.evaluate(y))}catch(T){return this.error(T.message),null}}return f}return ta.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,d,_){let f=typeof n=="number"?this.path.concat(n):this.path;f=typeof a=="string"?f.concat(a):f;const y=_?this.scope.concat(_):this.scope;return new af(this.registry,f,d||null,y,this.errors,this._scope,this.options)}error(n,...a){const d=`${this.key}${a.map(_=>`[${_}]`).join("")}`;this.errors.push(new _o(d,n))}checkSubtype(n,a){const d=gr(n,a);return d&&this.error(d),d}}var yp=af;function Ja(u){if(u instanceof gi)return Ja(u.boundExpression);if(u instanceof as&&u.name==="error"||u instanceof fa||u instanceof Rs||u instanceof Ol||u instanceof jc)return!1;const n=u instanceof ta||u instanceof yo;let a=!0;return u.eachChild(d=>{a=n?a&&Ja(d):a&&d instanceof so}),!!a&&$c(u)&&ku(u,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ou(u,n){const a=u.length-1;let d,_,f=0,y=a,T=0;for(;f<=y;)if(T=Math.floor((f+y)/2),d=u[T],_=u[T+1],d<=n){if(T===a||n<_)return T;f=T+1}else{if(!(d>n))throw new ii("Input is not a number.");y=T-1}return 0}class Du{constructor(n,a,d){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[_,f]of d)this.labels.push(_),this.outputs.push(f)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const d=a.parse(n[1],1,cr);if(!d)return null;const _=[];let f=null;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);for(let y=1;y<n.length;y+=2){const T=y===1?-1/0:n[y],C=n[y+1],M=y,x=y+1;if(typeof T!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(_.length&&_[_.length-1][0]>=T)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const I=a.parse(C,x,f);if(!I)return null;f=f||I.type,_.push([T,I])}return new Du(f,d,_)}evaluate(n){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(n);const _=this.input.evaluate(n);if(_<=a[0])return d[0].evaluate(n);const f=a.length;return _>=a[f-1]?d[f-1].evaluate(n):d[Ou(a,_)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&n.push(this.labels[a]),n.push(this.outputs[a].serialize());return n}}const vp=.95047,bp=1.08883,xp=4/29,Gc=6/29,wp=3*Gc*Gc,dg=Gc*Gc*Gc,fg=Math.PI/180,lf=180/Math.PI;function qc(u){return u>dg?Math.pow(u,1/3):u/wp+xp}function Ah(u){return u>Gc?u*u*u:wp*(u-xp)}function Ch(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function hc(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Rh(u){const n=hc(u.r),a=hc(u.g),d=hc(u.b),_=qc((.4124564*n+.3575761*a+.1804375*d)/vp),f=qc((.2126729*n+.7151522*a+.072175*d)/1);return{l:116*f-16,a:500*(_-f),b:200*(f-qc((.0193339*n+.119192*a+.9503041*d)/bp)),alpha:u.a}}function Tp(u){let n=(u.l+16)/116,a=isNaN(u.a)?n:n+u.a/500,d=isNaN(u.b)?n:n-u.b/200;return n=1*Ah(n),a=vp*Ah(a),d=bp*Ah(d),new Zt(Ch(3.2404542*a-1.5371385*n-.4985314*d),Ch(-.969266*a+1.8760108*n+.041556*d),Ch(.0556434*a-.2040259*n+1.0572252*d),u.alpha)}function pg(u,n,a){const d=n-u;return u+a*(d>180||d<-180?d-360*Math.round(d/360):d)}const Lu={forward:Rh,reverse:Tp,interpolate:function(u,n,a){return{l:vr(u.l,n.l,a),a:vr(u.a,n.a,a),b:vr(u.b,n.b,a),alpha:vr(u.alpha,n.alpha,a)}}},Qa={forward:function(u){const{l:n,a,b:d}=Rh(u),_=Math.atan2(d,a)*lf;return{h:_<0?_+360:_,c:Math.sqrt(a*a+d*d),l:n,alpha:u.a}},reverse:function(u){const n=u.h*fg,a=u.c;return Tp({l:u.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:u.alpha})},interpolate:function(u,n,a){return{h:pg(u.h,n.h,a),c:vr(u.c,n.c,a),l:vr(u.l,n.l,a),alpha:vr(u.alpha,n.alpha,a)}}};var Ep=Object.freeze({__proto__:null,hcl:Qa,lab:Lu});class _a{constructor(n,a,d,_,f){this.type=n,this.operator=a,this.interpolation=d,this.input=_,this.labels=[],this.outputs=[];for(const[y,T]of f)this.labels.push(y),this.outputs.push(T)}static interpolationFactor(n,a,d,_){let f=0;if(n.name==="exponential")f=Hc(a,n.base,d,_);else if(n.name==="linear")f=Hc(a,1,d,_);else if(n.name==="cubic-bezier"){const y=n.controlPoints;f=new Fe(y[0],y[1],y[2],y[3]).solve(Hc(a,1,d,_))}return f}static parse(n,a){let[d,_,f,...y]=n;if(!Array.isArray(_)||_.length===0)return a.error("Expected an interpolation type expression.",1);if(_[0]==="linear")_={name:"linear"};else if(_[0]==="exponential"){const M=_[1];if(typeof M!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);_={name:"exponential",base:M}}else{if(_[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(_[0])}`,1,0);{const M=_.slice(1);if(M.length!==4||M.some(x=>typeof x!="number"||x<0||x>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);_={name:"cubic-bezier",controlPoints:M}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(f=a.parse(f,2,cr),!f)return null;const T=[];let C=null;d==="interpolate-hcl"||d==="interpolate-lab"?C=oo:a.expectedType&&a.expectedType.kind!=="value"&&(C=a.expectedType);for(let M=0;M<y.length;M+=2){const x=y[M],I=y[M+1],P=M+3,A=M+4;if(typeof x!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(T.length&&T[T.length-1][0]>=x)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const R=a.parse(I,A,C);if(!R)return null;C=C||R.type,T.push([x,R])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new _a(C,d,_,f,T):a.error(`Type ${Xe(C)} is not interpolatable.`)}evaluate(n){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(n);const _=this.input.evaluate(n);if(_<=a[0])return d[0].evaluate(n);const f=a.length;if(_>=a[f-1])return d[f-1].evaluate(n);const y=Ou(a,_),T=_a.interpolationFactor(this.interpolation,_,a[y],a[y+1]),C=d[y].evaluate(n),M=d[y+1].evaluate(n);return this.operator==="interpolate"?Bi[this.type.kind.toLowerCase()](C,M,T):this.operator==="interpolate-hcl"?Qa.reverse(Qa.interpolate(Qa.forward(C),Qa.forward(M),T)):Lu.reverse(Lu.interpolate(Lu.forward(C),Lu.forward(M),T))}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,n,this.input.serialize()];for(let d=0;d<this.labels.length;d++)a.push(this.labels[d],this.outputs[d].serialize());return a}}function Hc(u,n,a,d){const _=d-a,f=u-a;return _===0?0:n===1?f/_:(Math.pow(n,f)-1)/(Math.pow(n,_)-1)}class Wc{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expectected at least one argument.");let d=null;const _=a.expectedType;_&&_.kind!=="value"&&(d=_);const f=[];for(const T of n.slice(1)){const C=a.parse(T,1+f.length,d,void 0,{typeAnnotation:"omit"});if(!C)return null;d=d||C.type,f.push(C)}const y=_&&f.some(T=>gr(_,T.type));return new Wc(y?on:d,f)}evaluate(n){let a,d=null,_=0;for(const f of this.args){if(_++,d=f.evaluate(n),d&&d instanceof hi&&!d.available&&(a||(a=d),d=null,_===this.args.length))return a;if(d!==null)break}return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class Ph{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const d=[];for(let f=1;f<n.length-1;f+=2){const y=n[f];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,f);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",f);const T=a.parse(n[f+1],f+1);if(!T)return null;d.push([y,T])}const _=a.parse(n[n.length-1],n.length-1,a.expectedType,d);return _?new Ph(d,_):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[a,d]of this.bindings)n.push(a,d.serialize());return n.push(this.result.serialize()),n}}class Mh{constructor(n,a,d){this.type=n,this.index=a,this.input=d}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,cr),_=a.parse(n[2],2,Co(a.expectedType||on));return d&&_?new Mh(_.type.itemType,d,_):null}evaluate(n){const a=this.index.evaluate(n),d=this.input.evaluate(n);if(a<0)throw new ii(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new ii(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new ii(`Array index must be an integer, but found ${a} instead.`);return d[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class cf{constructor(n,a){this.type=fn,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,on),_=a.parse(n[2],2,on);return d&&_?$r(d.type,[fn,cn,cr,Yo,on])?new cf(d,_):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(d.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(d==null)return!1;if(!Dn(a,["boolean","string","number","null"]))throw new ii(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(qn(a))} instead.`);if(!Dn(d,["string","array"]))throw new ii(`Expected second argument to be of type array or string, but found ${Xe(qn(d))} instead.`);return d.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Dl{constructor(n,a,d){this.type=cr,this.needle=n,this.haystack=a,this.fromIndex=d}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,on),_=a.parse(n[2],2,on);if(!d||!_)return null;if(!$r(d.type,[fn,cn,cr,Yo,on]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(d.type)} instead`);if(n.length===4){const f=a.parse(n[3],3,cr);return f?new Dl(d,_,f):null}return new Dl(d,_)}evaluate(n){const a=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!Dn(a,["boolean","string","number","null"]))throw new ii(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(qn(a))} instead.`);if(!Dn(d,["string","array"]))throw new ii(`Expected second argument to be of type array or string, but found ${Xe(qn(d))} instead.`);if(this.fromIndex){const _=this.fromIndex.evaluate(n);return d.indexOf(a,_)}return d.indexOf(a)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Bu{constructor(n,a,d,_,f,y){this.inputType=n,this.type=a,this.input=d,this.cases=_,this.outputs=f,this.otherwise=y}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let d,_;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);const f={},y=[];for(let M=2;M<n.length-1;M+=2){let x=n[M];const I=n[M+1];Array.isArray(x)||(x=[x]);const P=a.concat(M);if(x.length===0)return P.error("Expected at least one branch label.");for(const R of x){if(typeof R!="number"&&typeof R!="string")return P.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return P.error("Numeric branch labels must be integer values.");if(d){if(P.checkSubtype(d,qn(R)))return null}else d=qn(R);if(f[String(R)]!==void 0)return P.error("Branch labels must be unique.");f[String(R)]=y.length}const A=a.parse(I,M,_);if(!A)return null;_=_||A.type,y.push(A)}const T=a.parse(n[1],1,on);if(!T)return null;const C=a.parse(n[n.length-1],n.length-1,_);return C?T.type.kind!=="value"&&a.concat(1).checkSubtype(d,T.type)?null:new Bu(d,_,T,f,y,C):null}evaluate(n){const a=this.input.evaluate(n);return(qn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),d=[],_={};for(const y of a){const T=_[this.cases[y]];T===void 0?(_[this.cases[y]]=d.length,d.push([this.cases[y],[y]])):d[T][1].push(y)}const f=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,T]of d)n.push(T.length===1?f(T[0]):T.map(f)),n.push(this.outputs[y].serialize());return n.push(this.otherwise.serialize()),n}}class Zc{constructor(n,a,d){this.type=n,this.branches=a,this.otherwise=d}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const _=[];for(let y=1;y<n.length-1;y+=2){const T=a.parse(n[y],y,fn);if(!T)return null;const C=a.parse(n[y+1],y+1,d);if(!C)return null;_.push([T,C]),d=d||C.type}const f=a.parse(n[n.length-1],n.length-1,d);return f?new Zc(d,_,f):null}evaluate(n){for(const[a,d]of this.branches)if(a.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,d]of this.branches)n(a),n(d);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class kh{constructor(n,a,d,_){this.type=n,this.input=a,this.beginIndex=d,this.endIndex=_}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const d=a.parse(n[1],1,on),_=a.parse(n[2],2,cr);if(!d||!_)return null;if(!$r(d.type,[Co(on),cn,on]))return a.error(`Expected first argument to be of type array or string, but found ${Xe(d.type)} instead`);if(n.length===4){const f=a.parse(n[3],3,cr);return f?new kh(d.type,d,_,f):null}return new kh(d.type,d,_)}evaluate(n){const a=this.input.evaluate(n),d=this.beginIndex.evaluate(n);if(!Dn(a,["string","array"]))throw new ii(`Expected first argument to be of type array or string, but found ${Xe(qn(a))} instead.`);if(this.endIndex){const _=this.endIndex.evaluate(n);return a.slice(d,_)}return a.slice(d)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function uf(u,n){return u==="=="||u==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Sp(u,n,a,d){return d.compare(n,a)===0}function cl(u,n,a){const d=u!=="=="&&u!=="!=";return class iD{constructor(f,y,T){this.type=fn,this.lhs=f,this.rhs=y,this.collator=T,this.hasUntypedArgument=f.type.kind==="value"||y.type.kind==="value"}static parse(f,y){if(f.length!==3&&f.length!==4)return y.error("Expected two or three arguments.");const T=f[0];let C=y.parse(f[1],1,on);if(!C)return null;if(!uf(T,C.type))return y.concat(1).error(`"${T}" comparisons are not supported for type '${Xe(C.type)}'.`);let M=y.parse(f[2],2,on);if(!M)return null;if(!uf(T,M.type))return y.concat(2).error(`"${T}" comparisons are not supported for type '${Xe(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return y.error(`Cannot compare types '${Xe(C.type)}' and '${Xe(M.type)}'.`);d&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new yo(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new yo(C.type,[M])));let x=null;if(f.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(x=y.parse(f[3],3,Bs),!x)return null}return new iD(C,M,x)}evaluate(f){const y=this.lhs.evaluate(f),T=this.rhs.evaluate(f);if(d&&this.hasUntypedArgument){const C=qn(y),M=qn(T);if(C.kind!==M.kind||C.kind!=="string"&&C.kind!=="number")throw new ii(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const C=qn(y),M=qn(T);if(C.kind!=="string"||M.kind!=="string")return n(f,y,T)}return this.collator?a(f,y,T,this.collator.evaluate(f)):n(f,y,T)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[u];return this.eachChild(y=>{f.push(y.serialize())}),f}}}const dc=cl("==",function(u,n,a){return n===a},Sp),Ip=cl("!=",function(u,n,a){return n!==a},function(u,n,a,d){return!Sp(0,n,a,d)}),Ap=cl("<",function(u,n,a){return n<a},function(u,n,a,d){return d.compare(n,a)<0}),Kc=cl(">",function(u,n,a){return n>a},function(u,n,a,d){return d.compare(n,a)>0}),Cp=cl("<=",function(u,n,a){return n<=a},function(u,n,a,d){return d.compare(n,a)<=0}),Rp=cl(">=",function(u,n,a){return n>=a},function(u,n,a,d){return d.compare(n,a)>=0});class hf{constructor(n,a,d,_,f,y){this.type=cn,this.number=n,this.locale=a,this.currency=d,this.unit=_,this.minFractionDigits=f,this.maxFractionDigits=y}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const d=a.parse(n[1],1,cr);if(!d)return null;const _=n[2];if(typeof _!="object"||Array.isArray(_))return a.error("NumberFormat options argument must be an object.");let f=null;if(_.locale&&(f=a.parseObjectValue(_.locale,2,"locale",cn),!f))return null;let y=null;if(_.currency&&(y=a.parseObjectValue(_.currency,2,"currency",cn),!y))return null;let T=null;if(_.unit&&(T=a.parseObjectValue(_.unit,2,"unit",cn),!T))return null;let C=null;if(_["min-fraction-digits"]&&(C=a.parseObjectValue(_["min-fraction-digits"],2,"min-fraction-digits",cr),!C))return null;let M=null;return _["max-fraction-digits"]&&(M=a.parseObjectValue(_["max-fraction-digits"],2,"max-fraction-digits",cr),!M)?null:new hf(d,f,y,T,C,M)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class zu{constructor(n){this.type=cr,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const d=a.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Xe(d.type)} instead.`):new zu(d):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ii(`Expected value to be of type string or array, but found ${Xe(qn(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(a=>{n.push(a.serialize())}),n}}function Oh(u){return function(){u=1831565813+(u|=0)|0;let n=Math.imul(u^u>>>15,1|u);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const fc={"==":dc,"!=":Ip,">":Kc,"<":Ap,">=":Rp,"<=":Cp,array:yo,at:Mh,boolean:yo,case:Zc,coalesce:Wc,collator:fa,format:Ro,image:ha,in:cf,"index-of":Dl,interpolate:_a,"interpolate-hcl":_a,"interpolate-lab":_a,length:zu,let:Ph,literal:so,match:Bu,number:yo,"number-format":hf,object:yo,slice:kh,step:Du,string:yo,"to-boolean":ta,"to-color":ta,"to-number":ta,"to-string":ta,var:gi,within:Rs,distance:Ol,config:jc};function Pp(u,[n,a,d,_]){n=n.evaluate(u),a=a.evaluate(u),d=d.evaluate(u);const f=_?_.evaluate(u):1,y=xi(n,a,d,f);if(y)throw new ii(y);return new Zt(n/255*f,a/255*f,d/255*f,f)}function Dh(u,[n,a,d,_]){n=n.evaluate(u),a=a.evaluate(u),d=d.evaluate(u);const f=_?_.evaluate(u):1,y=function(M,x,I,P){return typeof M=="number"&&M>=0&&M<=360?typeof x=="number"&&x>=0&&x<=100&&typeof I=="number"&&I>=0&&I<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[M,x,I,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[M,x,I,P]:[M,x,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[M,x,I,P]:[M,x,I]).join(", ")}]: 'h' must be between 0 and 360.`}(n,a,d,f);if(y)throw new ii(y);const T=`hsla(${n}, ${a}%, ${d}%, ${f})`,C=Zt.parse(T);if(!C)throw new ii(`Failed to parse HSLA color: ${T}`);return C}function Nu(u,n){return u in n}function Lh(u,n){const a=n[u];return a===void 0?null:a}function ya(u){return{type:u}}function df(u){return{result:"success",value:u}}function ul(u){return{result:"error",value:u}}function Bh(u,n){return!!u&&!!u.parameters&&u.parameters.indexOf(n)>-1}function Xc(u){return u["property-type"]==="data-driven"}function zh(u){return Bh(u.expression,"measure-light")}function Nh(u){return Bh(u.expression,"zoom")}function ff(u){return!!u.expression&&u.expression.interpolated}function hl(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Ll(u){return u}function Mp(u,n){const a=n.type==="color",d=u.stops&&typeof u.stops[0][0]=="object",_=d||!(d||u.property!==void 0),f=u.type||(ff(n)?"exponential":"interval");if(a&&((u=ai({},u)).stops&&(u.stops=u.stops.map(M=>[M[0],Zt.parse(M[1])])),u.default=Zt.parse(u.default?u.default:n.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!Ep[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let y,T,C;if(f==="exponential")y=Op;else if(f==="interval")y=kp;else if(f==="categorical"){y=mg,T=Object.create(null);for(const M of u.stops)T[M[0]]=M[1];C=typeof u.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=gg}if(d){const M={},x=[];for(let A=0;A<u.stops.length;A++){const R=u.stops[A],D=R[0].zoom;M[D]===void 0&&(M[D]={zoom:D,type:u.type,property:u.property,default:u.default,stops:[]},x.push(D)),M[D].stops.push([R[0].value,R[1]])}const I=[];for(const A of x)I.push([M[A].zoom,Mp(M[A],n)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:_a.interpolationFactor.bind(void 0,P),zoomStops:I.map(A=>A[0]),evaluate:({zoom:A},R)=>Op({stops:I,base:u.base},n,A).evaluate(A,R)}}if(_){const M=f==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:_a.interpolationFactor.bind(void 0,M),zoomStops:u.stops.map(x=>x[0]),evaluate:({zoom:x})=>y(u,n,x,T,C)}}return{kind:"source",evaluate(M,x){const I=x&&x.properties?x.properties[u.property]:void 0;return I===void 0?Fu(u.default,n.default):y(u,n,I,T,C)}}}function Fu(u,n,a){return u!==void 0?u:n!==void 0?n:a!==void 0?a:void 0}function mg(u,n,a,d,_){return Fu(typeof a===_?d[a]:void 0,u.default,n.default)}function kp(u,n,a){if(Ns(a)!=="number")return Fu(u.default,n.default);const d=u.stops.length;if(d===1||a<=u.stops[0][0])return u.stops[0][1];if(a>=u.stops[d-1][0])return u.stops[d-1][1];const _=Ou(u.stops.map(f=>f[0]),a);return u.stops[_][1]}function Op(u,n,a){const d=u.base!==void 0?u.base:1;if(Ns(a)!=="number")return Fu(u.default,n.default);const _=u.stops.length;if(_===1||a<=u.stops[0][0])return u.stops[0][1];if(a>=u.stops[_-1][0])return u.stops[_-1][1];const f=Ou(u.stops.map(x=>x[0]),a),y=function(x,I,P,A){const R=A-P,D=x-P;return R===0?0:I===1?D/R:(Math.pow(I,D)-1)/(Math.pow(I,R)-1)}(a,d,u.stops[f][0],u.stops[f+1][0]),T=u.stops[f][1],C=u.stops[f+1][1];let M=Bi[n.type]||Ll;if(u.colorSpace&&u.colorSpace!=="rgb"){const x=Ep[u.colorSpace];M=(I,P)=>x.reverse(x.interpolate(x.forward(I),x.forward(P),y))}return typeof T.evaluate=="function"?{evaluate(...x){const I=T.evaluate.apply(void 0,x),P=C.evaluate.apply(void 0,x);if(I!==void 0&&P!==void 0)return M(I,P,y)}}:M(T,C,y)}function gg(u,n,a){return n.type==="color"?a=Zt.parse(a):n.type==="formatted"?a=ti.fromString(a.toString()):n.type==="resolvedImage"?a=hi.fromString(a.toString()):Ns(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),Fu(a,u.default,n.default)}as.register(fc,{error:[{kind:"error"},[cn],(u,[n])=>{throw new ii(n.evaluate(u))}],typeof:[cn,[on],(u,[n])=>Xe(qn(n.evaluate(u)))],"to-rgba":[Co(cr,4),[oo],(u,[n])=>n.evaluate(u).toRenderColor(null).toArray()],rgb:[oo,[cr,cr,cr],Pp],rgba:[oo,[cr,cr,cr,cr],Pp],hsl:[oo,[cr,cr,cr],Dh],hsla:[oo,[cr,cr,cr,cr],Dh],has:{type:fn,overloads:[[[cn],(u,[n])=>Nu(n.evaluate(u),u.properties())],[[cn,$i],(u,[n,a])=>Nu(n.evaluate(u),a.evaluate(u))]]},get:{type:on,overloads:[[[cn],(u,[n])=>Lh(n.evaluate(u),u.properties())],[[cn,$i],(u,[n,a])=>Lh(n.evaluate(u),a.evaluate(u))]]},"feature-state":[on,[cn],(u,[n])=>Lh(n.evaluate(u),u.featureState||{})],properties:[$i,[],u=>u.properties()],"geometry-type":[cn,[],u=>u.geometryType()],id:[on,[],u=>u.id()],zoom:[cr,[],u=>u.globals.zoom],pitch:[cr,[],u=>u.globals.pitch||0],"distance-from-center":[cr,[],u=>u.distanceFromCenter()],"measure-light":[cr,[cn],(u,[n])=>u.measureLight(n.evaluate(u))],"heatmap-density":[cr,[],u=>u.globals.heatmapDensity||0],"line-progress":[cr,[],u=>u.globals.lineProgress||0],"raster-value":[cr,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[cr,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[cr,[],u=>u.globals.skyRadialProgress||0],accumulated:[on,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[cr,ya(cr),(u,n)=>{let a=0;for(const d of n)a+=d.evaluate(u);return a}],"*":[cr,ya(cr),(u,n)=>{let a=1;for(const d of n)a*=d.evaluate(u);return a}],"-":{type:cr,overloads:[[[cr,cr],(u,[n,a])=>n.evaluate(u)-a.evaluate(u)],[[cr],(u,[n])=>-n.evaluate(u)]]},"/":[cr,[cr,cr],(u,[n,a])=>n.evaluate(u)/a.evaluate(u)],"%":[cr,[cr,cr],(u,[n,a])=>n.evaluate(u)%a.evaluate(u)],ln2:[cr,[],()=>Math.LN2],pi:[cr,[],()=>Math.PI],e:[cr,[],()=>Math.E],"^":[cr,[cr,cr],(u,[n,a])=>Math.pow(n.evaluate(u),a.evaluate(u))],sqrt:[cr,[cr],(u,[n])=>Math.sqrt(n.evaluate(u))],log10:[cr,[cr],(u,[n])=>Math.log(n.evaluate(u))/Math.LN10],ln:[cr,[cr],(u,[n])=>Math.log(n.evaluate(u))],log2:[cr,[cr],(u,[n])=>Math.log(n.evaluate(u))/Math.LN2],sin:[cr,[cr],(u,[n])=>Math.sin(n.evaluate(u))],cos:[cr,[cr],(u,[n])=>Math.cos(n.evaluate(u))],tan:[cr,[cr],(u,[n])=>Math.tan(n.evaluate(u))],asin:[cr,[cr],(u,[n])=>Math.asin(n.evaluate(u))],acos:[cr,[cr],(u,[n])=>Math.acos(n.evaluate(u))],atan:[cr,[cr],(u,[n])=>Math.atan(n.evaluate(u))],min:[cr,ya(cr),(u,n)=>Math.min(...n.map(a=>a.evaluate(u)))],max:[cr,ya(cr),(u,n)=>Math.max(...n.map(a=>a.evaluate(u)))],abs:[cr,[cr],(u,[n])=>Math.abs(n.evaluate(u))],round:[cr,[cr],(u,[n])=>{const a=n.evaluate(u);return a<0?-Math.round(-a):Math.round(a)}],floor:[cr,[cr],(u,[n])=>Math.floor(n.evaluate(u))],ceil:[cr,[cr],(u,[n])=>Math.ceil(n.evaluate(u))],"filter-==":[fn,[cn,on],(u,[n,a])=>u.properties()[n.value]===a.value],"filter-id-==":[fn,[on],(u,[n])=>u.id()===n.value],"filter-type-==":[fn,[cn],(u,[n])=>u.geometryType()===n.value],"filter-<":[fn,[cn,on],(u,[n,a])=>{const d=u.properties()[n.value],_=a.value;return typeof d==typeof _&&d<_}],"filter-id-<":[fn,[on],(u,[n])=>{const a=u.id(),d=n.value;return typeof a==typeof d&&a<d}],"filter->":[fn,[cn,on],(u,[n,a])=>{const d=u.properties()[n.value],_=a.value;return typeof d==typeof _&&d>_}],"filter-id->":[fn,[on],(u,[n])=>{const a=u.id(),d=n.value;return typeof a==typeof d&&a>d}],"filter-<=":[fn,[cn,on],(u,[n,a])=>{const d=u.properties()[n.value],_=a.value;return typeof d==typeof _&&d<=_}],"filter-id-<=":[fn,[on],(u,[n])=>{const a=u.id(),d=n.value;return typeof a==typeof d&&a<=d}],"filter->=":[fn,[cn,on],(u,[n,a])=>{const d=u.properties()[n.value],_=a.value;return typeof d==typeof _&&d>=_}],"filter-id->=":[fn,[on],(u,[n])=>{const a=u.id(),d=n.value;return typeof a==typeof d&&a>=d}],"filter-has":[fn,[on],(u,[n])=>n.value in u.properties()],"filter-has-id":[fn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[fn,[Co(cn)],(u,[n])=>n.value.indexOf(u.geometryType())>=0],"filter-id-in":[fn,[Co(on)],(u,[n])=>n.value.indexOf(u.id())>=0],"filter-in-small":[fn,[cn,Co(on)],(u,[n,a])=>a.value.indexOf(u.properties()[n.value])>=0],"filter-in-large":[fn,[cn,Co(on)],(u,[n,a])=>function(d,_,f,y){for(;f<=y;){const T=f+y>>1;if(_[T]===d)return!0;_[T]>d?y=T-1:f=T+1}return!1}(u.properties()[n.value],a.value,0,a.value.length-1)],all:{type:fn,overloads:[[[fn,fn],(u,[n,a])=>n.evaluate(u)&&a.evaluate(u)],[ya(fn),(u,n)=>{for(const a of n)if(!a.evaluate(u))return!1;return!0}]]},any:{type:fn,overloads:[[[fn,fn],(u,[n,a])=>n.evaluate(u)||a.evaluate(u)],[ya(fn),(u,n)=>{for(const a of n)if(a.evaluate(u))return!0;return!1}]]},"!":[fn,[fn],(u,[n])=>!n.evaluate(u)],"is-supported-script":[fn,[cn],(u,[n])=>{const a=u.globals&&u.globals.isSupportedScript;return!a||a(n.evaluate(u))}],upcase:[cn,[cn],(u,[n])=>n.evaluate(u).toUpperCase()],downcase:[cn,[cn],(u,[n])=>n.evaluate(u).toLowerCase()],concat:[cn,ya(on),(u,n)=>n.map(a=>ni(a.evaluate(u))).join("")],"resolved-locale":[cn,[Bs],(u,[n])=>n.evaluate(u).resolvedLocale()],random:[cr,[cr,cr,on],(u,n)=>{const[a,d,_]=n.map(y=>y.evaluate(u));if(a>d||a===d)return a;let f;if(typeof _=="string")f=function(y){let T=0;if(y.length===0)return T;for(let C=0;C<y.length;C++)T=(T<<5)-T+y.charCodeAt(C),T|=0;return T}(_);else{if(typeof _!="number")throw new ii(`Invalid seed input: ${_}`);f=_}return a+Oh(f)()*(d-a)}]});class Fh{constructor(n,a,d,_){this.expression=n,this._warningHistory={},this._evaluator=new da(d,_),this._defaultValue=a?function(f){return f.type==="color"&&(hl(f.default)||Array.isArray(f.default))?new Zt(0,0,0,0):f.type==="color"?Zt.parse(f.default)||null:f.default===void 0?null:f.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(n,a,d,_,f,y,T,C){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=_||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(n,a,d,_,f,y,T,C){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=_||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=C||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new ii(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Vh(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in fc}function Yc(u,n,a,d){const _=new yp(fc,[],n?function(y){const T={color:oo,string:cn,number:cr,enum:cn,boolean:fn,formatted:ss,resolvedImage:mi};return y.type==="array"?Co(T[y.value]||on,y.length):T[y.type]}(n):void 0,void 0,void 0,a,d),f=_.parse(u,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?df(new Fh(f,n,a,d)):ul(_.errors)}class Jc{constructor(n,a,d){this.kind=n,this._styleExpression=a,this.isLightConstant=d,this.isStateDependent=n!=="constant"&&!Mu(a.expression),this.configDependencies=Ih(a.expression)}evaluateWithoutErrorHandling(n,a,d,_,f,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,d,_,f,y)}evaluate(n,a,d,_,f,y){return this._styleExpression.evaluate(n,a,d,_,f,y)}}class va{constructor(n,a,d,_,f){this.kind=n,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!Mu(a.expression),this.isLightConstant=f,this.configDependencies=Ih(a.expression),this.interpolationType=_}evaluateWithoutErrorHandling(n,a,d,_,f,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,d,_,f,y)}evaluate(n,a,d,_,f,y){return this._styleExpression.evaluate(n,a,d,_,f,y)}interpolationFactor(n,a,d){return this.interpolationType?_a.interpolationFactor(this.interpolationType,n,a,d):0}}function Dp(u,n,a,d){if((u=Yc(u,n,a,d)).result==="error")return u;const _=u.value.expression,f=$c(_);if(!f&&!Xc(n))return ul([new _o("","data expressions not supported")]);const y=ku(_,["zoom","pitch","distance-from-center"]);if(!y&&!Nh(n))return ul([new _o("","zoom expressions not supported")]);const T=ku(_,["measure-light"]);if(!T&&!zh(n))return ul([new _o("","measure-light expression not supported")]);const C=n.expression&&n.expression.relaxZoomRestriction,M=Zl(_);return M||y||C?M instanceof _o?ul([M]):M instanceof _a&&!ff(n)?ul([new _o("",'"interpolate" expressions cannot be used with this property')]):df(M?new va(f?"camera":"composite",u.value,M.labels,M instanceof _a?M.interpolation:void 0,T):new Jc(f?"constant":"source",u.value,T)):ul([new _o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Uh{constructor(n,a){this._parameters=n,this._specification=a,ai(this,Mp(this._parameters,this._specification))}static deserialize(n){return new Uh(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Zl(u){let n=null;if(u instanceof Ph)n=Zl(u.result);else if(u instanceof Wc){for(const a of u.args)if(n=Zl(a),n)break}else(u instanceof Du||u instanceof _a)&&u.input instanceof as&&u.input.name==="zoom"&&(n=u);return n instanceof _o||u.eachChild(a=>{const d=Zl(a);d instanceof _o?n=d:n&&d&&n!==d&&(n=new _o("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var Ie,$,ce=function(){if($)return Ie;$=1,Ie=n;var u=3;function n(a,d,_){var f=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(d=y[1])+2*(_=y[2]);for(var T=0;T<this.d*this.d;T++){var C=y[u+T],M=y[u+T+1];f.push(C===M?null:y.subarray(C,M))}var x=y[u+f.length+1];this.keys=y.subarray(y[u+f.length],x),this.bboxes=y.subarray(x),this.insert=this._insertReadonly}else{this.d=d+2*_;for(var I=0;I<this.d*this.d;I++)f.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=a,this.padding=_,this.scale=d/a,this.uid=0;var P=_/d*a;this.min=-P,this.max=a+P}return n.prototype.insert=function(a,d,_,f,y){this._forEachCell(d,_,f,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(f),this.bboxes.push(y)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(a,d,_,f,y,T){this.cells[y].push(T)},n.prototype.query=function(a,d,_,f,y){var T=this.min,C=this.max;if(a<=T&&d<=T&&C<=_&&C<=f&&!y)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,d,_,f,this._queryCell,M,{},y),M},n.prototype._queryCell=function(a,d,_,f,y,T,C,M){var x=this.cells[y];if(x!==null)for(var I=this.keys,P=this.bboxes,A=0;A<x.length;A++){var R=x[A];if(C[R]===void 0){var D=4*R;(M?M(P[D+0],P[D+1],P[D+2],P[D+3]):a<=P[D+2]&&d<=P[D+3]&&_>=P[D+0]&&f>=P[D+1])?(C[R]=!0,T.push(I[R])):C[R]=!1}}},n.prototype._forEachCell=function(a,d,_,f,y,T,C,M){for(var x=this._convertToCellCoord(a),I=this._convertToCellCoord(d),P=this._convertToCellCoord(_),A=this._convertToCellCoord(f),R=x;R<=P;R++)for(var D=I;D<=A;D++){var N=this.d*D+R;if((!M||M(this._convertFromCellCoord(R),this._convertFromCellCoord(D),this._convertFromCellCoord(R+1),this._convertFromCellCoord(D+1)))&&y.call(this,a,d,_,f,N,T,C,M))return}},n.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},n.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,d=u+this.cells.length+1+1,_=0,f=0;f<this.cells.length;f++)_+=this.cells[f].length;var y=new Int32Array(d+_+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var T=d,C=0;C<a.length;C++){var M=a[C];y[u+C]=T,y.set(M,T),T+=M.length}return y[u+a.length]=T,y.set(this.keys,T),y[u+a.length+1]=T+=this.keys.length,y.set(this.bboxes,T),T+=this.bboxes.length,y.buffer},Ie}(),Ue=O(ce);const It={};function et(u,n,a={}){Object.defineProperty(u,"_classRegistryKey",{value:n,writable:!1}),It[n]={klass:u,omit:a.omit||[]}}et(Object,"Object"),Ue.serialize=function(u,n){const a=u.toArrayBuffer();return n&&n.add(a),{buffer:a}},Ue.deserialize=function(u){return new Ue(u.buffer)},Object.defineProperty(Ue,"name",{value:"Grid"}),et(Ue,"Grid"),et(Zt,"Color"),et(Error,"Error"),et(ti,"Formatted"),et(Pn,"FormattedSection"),et(ka,"AJAXError"),et(hi,"ResolvedImage"),et(Uh,"StylePropertyFunction"),et(Fh,"StyleExpression",{omit:["_evaluator"]}),et(va,"ZoomDependentExpression"),et(Jc,"ZoomConstantExpression"),et(as,"CompoundExpression",{omit:["_evaluate"]});for(const u in fc)It[fc[u]._classRegistryKey]||et(fc[u],`Expression${u}`);function Jt(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function br(u){return self.ImageBitmap&&u instanceof ImageBitmap}function Ar(u,n){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(Jt(u)||br(u))return n&&n.add(u),u;if(ArrayBuffer.isView(u)){const a=u;return n&&n.add(a.buffer),a}if(u instanceof ImageData)return n&&n.add(u.data.buffer),u;if(Array.isArray(u)){const a=[];for(const d of u)a.push(Ar(d,n));return a}if(u instanceof Map){const a={$name:"Map"};for(const[d,_]of u.entries())a[d]=Ar(_);return a}if(u instanceof Set){const a={$name:"Set"};let d=0;for(const _ of u.values())a[++d]=Ar(_);return a}if(typeof u=="object"){const a=u.constructor,d=a._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${d}`);const _=a.serialize?a.serialize(u,n):{};if(!a.serialize){for(const f in u)u.hasOwnProperty(f)&&(It[d].omit.indexOf(f)>=0||(_[f]=Ar(u[f],n)));u instanceof Error&&(_.message=u.message)}if(_.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(_.$name=d),_}throw new Error("can't serialize object of type "+typeof u)}function Kr(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||Jt(u)||br(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Kr);if(typeof u=="object"){const n=u.$name||"Object";if(n==="Map"){const _=new Map;for(const f of Object.keys(u))f!=="$name"&&_.set(f,Kr(u[f]));return _}if(n==="Set"){const _=new Set;for(const f of Object.keys(u))f!=="$name"&&_.add(Kr(u[f]));return _}const{klass:a}=It[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(u);const d=Object.create(a.prototype);for(const _ of Object.keys(u))_!=="$name"&&(d[_]=Kr(u[_]));return d}throw new Error("can't deserialize object of type "+typeof u)}const Gt={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function Gr(u){for(const n of u)if(Mn(n.charCodeAt(0)))return!0;return!1}function Hn(u){for(const n of u)if(!bn(n.charCodeAt(0)))return!1;return!0}function bn(u){return!(Gt.Arabic(u)||Gt["Arabic Supplement"](u)||Gt["Arabic Extended-A"](u)||Gt["Arabic Presentation Forms-A"](u)||Gt["Arabic Presentation Forms-B"](u))}function Mn(u){return!(u!==746&&u!==747&&(u<4352||!(Gt["Bopomofo Extended"](u)||Gt.Bopomofo(u)||Gt["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Gt["CJK Compatibility Ideographs"](u)||Gt["CJK Compatibility"](u)||Gt["CJK Radicals Supplement"](u)||Gt["CJK Strokes"](u)||!(!Gt["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Gt["CJK Unified Ideographs Extension A"](u)||Gt["CJK Unified Ideographs"](u)||Gt["Enclosed CJK Letters and Months"](u)||Gt["Hangul Compatibility Jamo"](u)||Gt["Hangul Jamo Extended-A"](u)||Gt["Hangul Jamo Extended-B"](u)||Gt["Hangul Jamo"](u)||Gt["Hangul Syllables"](u)||Gt.Hiragana(u)||Gt["Ideographic Description Characters"](u)||Gt.Kanbun(u)||Gt["Kangxi Radicals"](u)||Gt["Katakana Phonetic Extensions"](u)||Gt.Katakana(u)&&u!==12540||!(!Gt["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Gt["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Gt["Unified Canadian Aboriginal Syllabics"](u)||Gt["Unified Canadian Aboriginal Syllabics Extended"](u)||Gt["Vertical Forms"](u)||Gt["Yijing Hexagram Symbols"](u)||Gt["Yi Syllables"](u)||Gt["Yi Radicals"](u))))}function En(u){return!(Mn(u)||function(n){return!!(Gt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Gt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Gt["Letterlike Symbols"](n)||Gt["Number Forms"](n)||Gt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Gt["Control Pictures"](n)&&n!==9251||Gt["Optical Character Recognition"](n)||Gt["Enclosed Alphanumerics"](n)||Gt["Geometric Shapes"](n)||Gt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Gt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Gt["CJK Symbols and Punctuation"](n)||Gt.Katakana(n)||Gt["Private Use Area"](n)||Gt["CJK Compatibility Forms"](n)||Gt["Small Form Variants"](n)||Gt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(u))}function Bn(u){return u>=1424&&u<=2303||Gt["Arabic Presentation Forms-A"](u)||Gt["Arabic Presentation Forms-B"](u)}function ro(u,n){return!(!n&&Bn(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Gt.Khmer(u))}function po(u){for(const n of u)if(Bn(n.charCodeAt(0)))return!0;return!1}const $n="deferred",_i="loading",Vn="loaded";let Xn=null,kn="unavailable",yi=null;const Gi=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(kn="error"),Xn&&Xn(u)};function Po(){Us.fire(new Cs("pluginStateChange",{pluginStatus:kn,pluginURL:yi}))}const Us=new Xo,ba=function(){return kn},xs=function(){if(kn!==$n||!yi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");kn=_i,Po(),yi&&Ys({url:yi},u=>{u?Gi(u):(kn=Vn,Po())})},vo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>kn===Vn||vo.applyArabicShaping!=null,isLoading:()=>kn===_i,setState(u){kn=u.pluginStatus,yi=u.pluginURL},isParsed:()=>vo.applyArabicShaping!=null&&vo.processBidirectionalText!=null&&vo.processStyledBidirectionalText!=null,getPluginURL:()=>yi};class li{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(a,d){for(const _ of a)if(!ro(_.charCodeAt(0),d))return!1;return!0}(n,vo.isLoaded())}}class bo{constructor(n,a,d,_){this.property=n,this.value=a,this.expression=function(f,y,T,C){if(hl(f))return new Uh(f,y);if(Vh(f)||Array.isArray(f)&&f.length>0){const M=Dp(f,y,T,C);if(M.result==="error")throw new Error(M.value.map(x=>`${x.key}: ${x.message}`).join(", "));return M.value}{let M=f;return typeof f=="string"&&y.type==="color"&&(M=Zt.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>M}}}(a===void 0?n.specification.default:a,n.specification,d,_)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,d){return this.property.possiblyEvaluate(this,n,a,d)}}class Da{constructor(n,a,d){this.property=n,this.value=new bo(n,void 0,a,d)}transitioned(n,a){return new pc(this.property,this.value,a,ln({},n.transition,this.transition),n.now)}untransitioned(){return new pc(this.property,this.value,null,{},0)}}class el{constructor(n,a,d){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(n){return Oi(this._values[n].value.value)}setValue(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new Da(this._values[n].property,this._scope,this._options)),this._values[n].value=new bo(this._values[n].property,a===null?void 0:Oi(a),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,a){a&&(this._options=a);const d=this._properties.properties;if(n)for(const _ in n){const f=n[_];if(Ai(_,"-transition")){const y=_.slice(0,-11);d[y]&&this.setTransition(y,f)}else d.hasOwnProperty(_)&&this.setValue(_,f)}}getTransition(n){return Oi(this._values[n].transition)}setTransition(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new Da(this._values[n].property)),this._values[n].transition=Oi(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(n[a]=d);const _=this.getTransition(a);_!==void 0&&(n[`${a}-transition`]=_)}return n}transitioned(n,a){const d=new ls(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].transitioned(n,a._values[_]);return d}untransitioned(){const n=new ls(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class pc{constructor(n,a,d,_,f){const y=_.delay||0,T=_.duration||0;f=f||0,this.property=n,this.value=a,this.begin=f+y,this.end=this.begin+T,n.specification.transition&&(_.delay||_.duration)&&(this.prior=d)}possiblyEvaluate(n,a,d){const _=n.now||0,f=this.value.possiblyEvaluate(n,a,d),y=this.prior;if(y){if(_>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(_<this.begin)return y.possiblyEvaluate(n,a,d);{const T=(_-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,a,d),f,yr(T))}}return f}}class ls{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,d){const _=new ws(this._properties);for(const f of Object.keys(this._values))_._values[f]=this._values[f].possiblyEvaluate(n,a,d);return _}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class ao{constructor(n,a,d){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=a,this._options=d,this.configDependencies=new Set}getValue(n){return Oi(this._values[n].value)}setValue(n,a){this._values[n]=new bo(this._values[n].property,a===null?void 0:Oi(a),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(n[a]=d)}return n}possiblyEvaluate(n,a,d){const _=new ws(this._properties);for(const f of Object.keys(this._values))_._values[f]=this._values[f].possiblyEvaluate(n,a,d);return _}}class Qo{constructor(n,a,d){this.property=n,this.value=a,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,d,_){return this.property.evaluate(this.value,this.parameters,n,a,d,_)}}class ws{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Xt{constructor(n){this.specification=n}possiblyEvaluate(n,a){return n.expression.evaluate(a)}interpolate(n,a,d){const _=Bi[this.specification.type];return _?_(n,a,d):n}}class Mr{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,d,_){return new Qo(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},d,_)}:n.expression,a)}interpolate(n,a,d){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new Qo(this,{kind:"constant",value:void 0},n.parameters);const _=Bi[this.specification.type];return _?new Qo(this,{kind:"constant",value:_(n.value.value,a.value.value,d)},n.parameters):n}evaluate(n,a,d,_,f,y){return n.kind==="constant"?n.value:n.evaluate(a,d,_,f,y)}}class La{constructor(n){this.specification=n}possiblyEvaluate(n,a,d,_){return!!n.expression.evaluate(a,null,{},d,_)}interpolate(){return!1}}class qi{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new li(0,{});for(const d in n){const _=n[d];_.specification.overridable&&this.overridableProperties.push(d);const f=this.defaultPropertyValues[d]=new bo(_,void 0),y=this.defaultTransitionablePropertyValues[d]=new Da(_);this.defaultTransitioningPropertyValues[d]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=f.possiblyEvaluate(a)}}}et(Mr,"DataDrivenProperty"),et(Xt,"DataConstantProperty"),et(La,"ColorRampProperty");var mt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Vu(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function jh(u){if(Array.isArray(u))return u.map(jh);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const n={};for(const a in u)n[a]=jh(u[a]);return n}return Vu(u)}function Uu(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const n of u.slice(1))if(!Uu(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function tl(u,n="",a=null,d="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Uu(u)||(u=dl(u));const _=u;let f=!0;try{f=function(I){if(!gc(I))return I;let P=jh(I);return mc(P),P=$h(P),P}(_)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(_,null,2)}
        `)}const y=mt[`filter_${d}`],T=Yc(f,y,n,a);let C=null;if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));C=(I,P,A)=>T.value.evaluate(I,P,{},A);let M=null,x=null;if(f!==_){const I=Yc(_,y,n,a);if(I.result==="error")throw new Error(I.value.map(P=>`${P.key}: ${P.message}`).join(", "));M=(P,A,R,D,N)=>I.value.evaluate(P,A,{},R,void 0,void 0,D,N),x=!$c(I.value.expression)}return{filter:C,dynamicFilter:M||void 0,needGeometry:Bp(f),needFeature:!!x}}function $h(u){if(!Array.isArray(u))return u;const n=function(a){if(Lp.has(a[0])){for(let d=1;d<a.length;d++)if(gc(a[d]))return!0}return a}(u);return n===!0?n:n.map(a=>$h(a))}function mc(u){let n=!1;const a=[];if(u[0]==="case"){for(let d=1;d<u.length-1;d+=2)n=n||gc(u[d]),a.push(u[d+1]);a.push(u[u.length-1])}else if(u[0]==="match"){n=n||gc(u[1]);for(let d=2;d<u.length-1;d+=2)a.push(u[d+1]);a.push(u[u.length-1])}else if(u[0]==="step"){n=n||gc(u[1]);for(let d=1;d<u.length-1;d+=2)a.push(u[d+1])}n&&(u.length=0,u.push("any",...a));for(let d=1;d<u.length;d++)mc(u[d])}function gc(u){if(!Array.isArray(u))return!1;if((n=u[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let a=1;a<u.length;a++)if(gc(u[a]))return!0;return!1}const Lp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function _g(u,n){return u<n?-1:u>n?1:0}function Bp(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let n=1;n<u.length;n++)if(Bp(u[n]))return!0;return!1}function dl(u){if(!u)return!0;const n=u[0];return u.length<=1?n!=="any":n==="=="?_c(u[1],u[2],"=="):n==="!="?yc(_c(u[1],u[2],"==")):n==="<"||n===">"||n==="<="||n===">="?_c(u[1],u[2],n):n==="any"?(a=u.slice(1),["any"].concat(a.map(dl))):n==="all"?["all"].concat(u.slice(1).map(dl)):n==="none"?["all"].concat(u.slice(1).map(dl).map(yc)):n==="in"?ju(u[1],u.slice(2)):n==="!in"?yc(ju(u[1],u.slice(2))):n==="has"?Qc(u[1]):n!=="!has"||yc(Qc(u[1]));var a}function _c(u,n,a){switch(u){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,u,n]}}function ju(u,n){if(n.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",u,["literal",n.sort(_g)]]:["filter-in-small",u,["literal",n]]}}function Qc(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function yc(u){return["!",u]}const vc="";function pf(u,n){return n?`${u}${vc}${n}`:u}const Ba="-transition",zp=new Set(["fill","line","background","hillshade","raster"]);class Ps extends Xo{constructor(n,a,d,_,f){if(super(),this.id=n.id,this.fqid=pf(this.id,d),this.type=n.type,this.scope=d,this.lut=_,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),a.layout&&(this._unevaluatedLayout=new ao(a.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint)){this._transitionablePaint=new el(a.paint,this.scope,f);for(const y in n.paint)this.setPaintProperty(y,n.paint[y]);for(const y in n.layout)this.setLayoutProperty(y,n.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ws(a.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D()&&zp.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a){if(this.type==="custom"&&n==="visibility")return void(this.visibility=a);const d=this._unevaluatedLayout;d._properties.properties[n]&&(d.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return Ai(n,Ba)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a){const d=this._transitionablePaint,_=d._properties.properties;if(Ai(n,Ba)){const I=n.slice(0,-11);return _[I]&&d.setTransition(I,a||void 0),!1}if(!_[n])return!1;const f=d._values[n],y=f.value.isDataDriven(),T=f.value;d.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...d.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const C=d._values[n].value,M=C.isDataDriven(),x=Ai(n,"pattern")||n==="line-dasharray";return M||y||x||this._handleOverridablePaintPropertyUpdate(n,T,C)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,a,d){return null}_handleOverridablePaintPropertyUpdate(n,a,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){return ki({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof Qo&&Xc(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=tl(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,a,d,_,f,y,T,C,M){}queryIntersectsMatchingFeature(n,a,d,_){}}const yg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bc{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Wn(u,n=1){let a=0,d=0;return{members:u.map(_=>{const f=yg[_.type].BYTES_PER_ELEMENT,y=a=Uy(a,Math.max(n,f)),T=_.components||1;return d=Math.max(d,f),a+=f*T,{name:_.name,type:_.type,components:T,offset:y}}),size:Uy(a,Math.max(d,n)),alignment:n}}function Uy(u,n){return Math.ceil(u/n)*n}class eu extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){const _=2*n;return this.int16[_+0]=a,this.int16[_+1]=d,n}}eu.prototype.bytesPerElement=4,et(eu,"StructArrayLayout2i4");class Np extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,d)}emplace(n,a,d,_){const f=3*n;return this.int16[f+0]=a,this.int16[f+1]=d,this.int16[f+2]=_,n}}Np.prototype.bytesPerElement=6,et(Np,"StructArrayLayout3i6");class tu extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,_){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,d,_)}emplace(n,a,d,_,f){const y=4*n;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=_,this.int16[y+3]=f,n}}tu.prototype.bytesPerElement=8,et(tu,"StructArrayLayout4i8");class Fp extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,_,f)}emplace(n,a,d,_,f,y){const T=5*n;return this.int16[T+0]=a,this.int16[T+1]=d,this.int16[T+2]=_,this.int16[T+3]=f,this.int16[T+4]=y,n}}Fp.prototype.bytesPerElement=10,et(Fp,"StructArrayLayout5i10");class vg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,n,a,d,_,f,y,T)}emplace(n,a,d,_,f,y,T,C){const M=6*n,x=12*n,I=3*n;return this.int16[M+0]=a,this.int16[M+1]=d,this.uint8[x+4]=_,this.uint8[x+5]=f,this.uint8[x+6]=y,this.uint8[x+7]=T,this.float32[I+2]=C,n}}vg.prototype.bytesPerElement=12,et(vg,"StructArrayLayout2i4ub1f12");class xc extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,d,_)}emplace(n,a,d,_,f){const y=4*n;return this.float32[y+0]=a,this.float32[y+1]=d,this.float32[y+2]=_,this.float32[y+3]=f,n}}xc.prototype.bytesPerElement=16,et(xc,"StructArrayLayout4f16");class ru extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,d)}emplace(n,a,d,_){const f=3*n;return this.float32[f+0]=a,this.float32[f+1]=d,this.float32[f+2]=_,n}}ru.prototype.bytesPerElement=12,et(ru,"StructArrayLayout3f12");class wc extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,_,f)}emplace(n,a,d,_,f,y){const T=6*n,C=3*n;return this.uint16[T+0]=a,this.uint16[T+1]=d,this.uint16[T+2]=_,this.uint16[T+3]=f,this.float32[C+2]=y,n}}wc.prototype.bytesPerElement=12,et(wc,"StructArrayLayout4ui1f12");class $u extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,_){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,d,_)}emplace(n,a,d,_,f){const y=4*n;return this.uint16[y+0]=a,this.uint16[y+1]=d,this.uint16[y+2]=_,this.uint16[y+3]=f,n}}$u.prototype.bytesPerElement=8,et($u,"StructArrayLayout4ui8");class Vp extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,d,_,f,y)}emplace(n,a,d,_,f,y,T){const C=6*n;return this.int16[C+0]=a,this.int16[C+1]=d,this.int16[C+2]=_,this.int16[C+3]=f,this.int16[C+4]=y,this.int16[C+5]=T,n}}Vp.prototype.bytesPerElement=12,et(Vp,"StructArrayLayout6i12");class bg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T,C,M,x,I,P){const A=this.length;return this.resize(A+1),this.emplace(A,n,a,d,_,f,y,T,C,M,x,I,P)}emplace(n,a,d,_,f,y,T,C,M,x,I,P,A){const R=12*n;return this.int16[R+0]=a,this.int16[R+1]=d,this.int16[R+2]=_,this.int16[R+3]=f,this.uint16[R+4]=y,this.uint16[R+5]=T,this.uint16[R+6]=C,this.uint16[R+7]=M,this.int16[R+8]=x,this.int16[R+9]=I,this.int16[R+10]=P,this.int16[R+11]=A,n}}bg.prototype.bytesPerElement=24,et(bg,"StructArrayLayout4i4ui4i24");class xg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,d,_,f,y)}emplace(n,a,d,_,f,y,T){const C=10*n,M=5*n;return this.int16[C+0]=a,this.int16[C+1]=d,this.int16[C+2]=_,this.float32[M+2]=f,this.float32[M+3]=y,this.float32[M+4]=T,n}}xg.prototype.bytesPerElement=20,et(xg,"StructArrayLayout3i3f20");class wg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}wg.prototype.bytesPerElement=4,et(wg,"StructArrayLayout1ul4");class nu extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){const _=2*n;return this.uint16[_+0]=a,this.uint16[_+1]=d,n}}nu.prototype.bytesPerElement=4,et(nu,"StructArrayLayout2ui4");class Gh extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T,C,M,x,I,P,A){const R=this.length;return this.resize(R+1),this.emplace(R,n,a,d,_,f,y,T,C,M,x,I,P,A)}emplace(n,a,d,_,f,y,T,C,M,x,I,P,A,R){const D=20*n,N=10*n;return this.int16[D+0]=a,this.int16[D+1]=d,this.int16[D+2]=_,this.int16[D+3]=f,this.int16[D+4]=y,this.float32[N+3]=T,this.float32[N+4]=C,this.float32[N+5]=M,this.float32[N+6]=x,this.int16[D+14]=I,this.uint32[N+8]=P,this.uint16[D+18]=A,this.uint16[D+19]=R,n}}Gh.prototype.bytesPerElement=40,et(Gh,"StructArrayLayout5i4f1i1ul2ui40");class Gu extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,n,a,d,_,f,y,T)}emplace(n,a,d,_,f,y,T,C){const M=8*n;return this.int16[M+0]=a,this.int16[M+1]=d,this.int16[M+2]=_,this.int16[M+4]=f,this.int16[M+5]=y,this.int16[M+6]=T,this.int16[M+7]=C,n}}Gu.prototype.bytesPerElement=16,et(Gu,"StructArrayLayout3i2i2i16");class xa extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,_,f)}emplace(n,a,d,_,f,y){const T=4*n,C=8*n;return this.float32[T+0]=a,this.float32[T+1]=d,this.float32[T+2]=_,this.int16[C+6]=f,this.int16[C+7]=y,n}}xa.prototype.bytesPerElement=16,et(xa,"StructArrayLayout2f1f2i16");class qh extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y){const T=this.length;return this.resize(T+1),this.emplace(T,n,a,d,_,f,y)}emplace(n,a,d,_,f,y,T){const C=20*n,M=5*n;return this.uint8[C+0]=a,this.uint8[C+1]=d,this.float32[M+1]=_,this.float32[M+2]=f,this.float32[M+3]=y,this.float32[M+4]=T,n}}qh.prototype.bytesPerElement=20,et(qh,"StructArrayLayout2ub4f20");class Ms extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,d)}emplace(n,a,d,_){const f=3*n;return this.uint16[f+0]=a,this.uint16[f+1]=d,this.uint16[f+2]=_,n}}Ms.prototype.bytesPerElement=6,et(Ms,"StructArrayLayout3ui6");class Tg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j,Z,X,G,J){const se=this.length;return this.resize(se+1),this.emplace(se,n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j,Z,X,G,J)}emplace(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j,Z,X,G,J,se){const _e=30*n,Ce=15*n,Pe=60*n;return this.int16[_e+0]=a,this.int16[_e+1]=d,this.int16[_e+2]=_,this.float32[Ce+2]=f,this.float32[Ce+3]=y,this.uint16[_e+8]=T,this.uint16[_e+9]=C,this.uint32[Ce+5]=M,this.uint32[Ce+6]=x,this.uint32[Ce+7]=I,this.uint16[_e+16]=P,this.uint16[_e+17]=A,this.uint16[_e+18]=R,this.float32[Ce+10]=D,this.float32[Ce+11]=N,this.uint8[Pe+48]=j,this.uint8[Pe+49]=Z,this.uint8[Pe+50]=X,this.uint32[Ce+13]=G,this.int16[_e+28]=J,this.uint8[Pe+58]=se,n}}Tg.prototype.bytesPerElement=60,et(Tg,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Eg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j,Z,X,G,J,se,_e,Ce,Pe,Ee,Ve,De,qe,Qe,nt,ot){const lt=this.length;return this.resize(lt+1),this.emplace(lt,n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j,Z,X,G,J,se,_e,Ce,Pe,Ee,Ve,De,qe,Qe,nt,ot)}emplace(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j,Z,X,G,J,se,_e,Ce,Pe,Ee,Ve,De,qe,Qe,nt,ot,lt){const yt=20*n,ut=40*n,Mt=80*n;return this.float32[yt+0]=a,this.float32[yt+1]=d,this.int16[ut+4]=_,this.int16[ut+5]=f,this.int16[ut+6]=y,this.int16[ut+7]=T,this.int16[ut+8]=C,this.int16[ut+9]=M,this.int16[ut+10]=x,this.int16[ut+11]=I,this.int16[ut+12]=P,this.uint16[ut+13]=A,this.uint16[ut+14]=R,this.uint16[ut+15]=D,this.uint16[ut+16]=N,this.uint16[ut+17]=j,this.uint16[ut+18]=Z,this.uint16[ut+19]=X,this.uint16[ut+20]=G,this.uint16[ut+21]=J,this.uint16[ut+22]=se,this.uint16[ut+23]=_e,this.uint16[ut+24]=Ce,this.uint16[ut+25]=Pe,this.uint16[ut+26]=Ee,this.uint16[ut+27]=Ve,this.uint32[yt+14]=De,this.float32[yt+15]=qe,this.float32[yt+16]=Qe,this.float32[yt+17]=nt,this.float32[yt+18]=ot,this.uint8[Mt+76]=lt,n}}Eg.prototype.bytesPerElement=80,et(Eg,"StructArrayLayout2f9i15ui1ul4f1ub80");class Hh extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}Hh.prototype.bytesPerElement=4,et(Hh,"StructArrayLayout1f4");class Tc extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,_,f)}emplace(n,a,d,_,f,y){const T=5*n;return this.float32[T+0]=a,this.float32[T+1]=d,this.float32[T+2]=_,this.float32[T+3]=f,this.float32[T+4]=y,n}}Tc.prototype.bytesPerElement=20,et(Tc,"StructArrayLayout5f20");class Sg extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,n,a,d,_,f,y,T)}emplace(n,a,d,_,f,y,T,C){const M=7*n;return this.float32[M+0]=a,this.float32[M+1]=d,this.float32[M+2]=_,this.float32[M+3]=f,this.float32[M+4]=y,this.float32[M+5]=T,this.float32[M+6]=C,n}}Sg.prototype.bytesPerElement=28,et(Sg,"StructArrayLayout7f28");class mf extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,_){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,d,_)}emplace(n,a,d,_,f){const y=6*n;return this.uint32[3*n+0]=a,this.uint16[y+2]=d,this.uint16[y+3]=_,this.uint16[y+4]=f,n}}mf.prototype.bytesPerElement=12,et(mf,"StructArrayLayout1ul3ui12");class Ig extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}Ig.prototype.bytesPerElement=2,et(Ig,"StructArrayLayout1ui2");class gf extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){const _=2*n;return this.float32[_+0]=a,this.float32[_+1]=d,n}}gf.prototype.bytesPerElement=8,et(gf,"StructArrayLayout2f8");class _f extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N){const j=this.length;return this.resize(j+1),this.emplace(j,n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N)}emplace(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j){const Z=16*n;return this.float32[Z+0]=a,this.float32[Z+1]=d,this.float32[Z+2]=_,this.float32[Z+3]=f,this.float32[Z+4]=y,this.float32[Z+5]=T,this.float32[Z+6]=C,this.float32[Z+7]=M,this.float32[Z+8]=x,this.float32[Z+9]=I,this.float32[Z+10]=P,this.float32[Z+11]=A,this.float32[Z+12]=R,this.float32[Z+13]=D,this.float32[Z+14]=N,this.float32[Z+15]=j,n}}_f.prototype.bytesPerElement=64,et(_f,"StructArrayLayout16f64");class Up extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,_,f,y,T){const C=this.length;return this.resize(C+1),this.emplace(C,n,a,d,_,f,y,T)}emplace(n,a,d,_,f,y,T,C){const M=10*n,x=5*n;return this.uint16[M+0]=a,this.uint16[M+1]=d,this.uint16[M+2]=_,this.uint16[M+3]=f,this.float32[x+2]=y,this.float32[x+3]=T,this.float32[x+4]=C,n}}Up.prototype.bytesPerElement=20,et(Up,"StructArrayLayout4ui3f20");class jp extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.int16[1*n+0]=a,n}}jp.prototype.bytesPerElement=2,et(jp,"StructArrayLayout1i2");class $p extends Pi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint8[1*n+0]=a,n}}$p.prototype.bytesPerElement=1,et($p,"StructArrayLayout1ub1");class jy extends bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}jy.prototype.size=40;class Gp extends Gh{get(n){return new jy(this,n)}}et(Gp,"CollisionBoxArray");class yf extends bc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}yf.prototype.size=60;class Ag extends Tg{get(n){return new yf(this,n)}}et(Ag,"PlacedSymbolArray");class $y extends bc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}$y.prototype.size=80;class Cg extends Eg{get(n){return new $y(this,n)}}et(Cg,"SymbolInstanceArray");class Gy extends Hh{getoffsetX(n){return this.float32[1*n+0]}}et(Gy,"GlyphOffsetArray");class qp extends eu{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}et(qp,"SymbolLineVertexArray");class qy extends bc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}qy.prototype.size=12;class Hy extends mf{get(n){return new qy(this,n)}}et(Hy,"FeatureIndexArray");class Wy extends nu{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}et(Wy,"FillExtrusionCentroidArray");class Zy extends bc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Zy.prototype.size=6;class Rg extends Np{get(n){return new Zy(this,n)}}et(Rg,"FillExtrusionWallArray");const Jb=Wn([{name:"a_pos",components:2,type:"Int16"}],4),Qb=Wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class To{constructor(n=[]){this.segments=n}_prepareSegment(n,a,d,_){let f=this.segments[this.segments.length-1];return n>To.MAX_VERTEX_ARRAY_LENGTH&&en(`Max vertices per segment is ${To.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!f||f.vertexLength+n>To.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==_)&&(f={vertexOffset:a,primitiveOffset:d,vertexLength:0,primitiveLength:0},_!==void 0&&(f.sortKey=_),this.segments.push(f)),f}prepareSegment(n,a,d,_){return this._prepareSegment(n,a.length,d.length,_)}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,d,_){return new To([{vertexOffset:n,primitiveOffset:a,vertexLength:d,primitiveLength:_,vaos:{},sortKey:0}])}}function Ky(u,n){return 256*(u=nr(Math.floor(u),0,255))+nr(Math.floor(n),0,255)}To.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,et(To,"SegmentVector");const ex=Wn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),tx=Wn([{name:"a_dash",components:4,type:"Uint16"}]);class vf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,a,d,_){this.ids.push(Xy(n)),this.positions.push(a,d,_)}eachPosition(n,a){const d=Xy(n);let _=0,f=this.ids.length-1;for(;_<f;){const y=_+f>>1;this.ids[y]>=d?f=y:_=y+1}for(;this.ids[_]===d;)a(this.positions[3*_],this.positions[3*_+1],this.positions[3*_+2]),_++}static serialize(n,a){const d=new Float64Array(n.ids),_=new Uint32Array(n.positions);return Wh(d,_,0,d.length-1),a&&(a.add(d.buffer),a.add(_.buffer)),{ids:d,positions:_}}static deserialize(n){const a=new vf;let d;a.ids=n.ids,a.positions=n.positions;for(const _ of a.ids)_!==d&&a.uniqueIds.push(_),d=_;return a.indexed=!0,a}}function Xy(u){const n=+u;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:Ji(String(u))}function Wh(u,n,a,d){for(;a<d;){const _=u[a+d>>1];let f=a-1,y=d+1;for(;;){do f++;while(u[f]<_);do y--;while(u[y]>_);if(f>=y)break;Hp(u,f,y),Hp(n,3*f,3*y),Hp(n,3*f+1,3*y+1),Hp(n,3*f+2,3*y+2)}y-a<d-y?(Wh(u,n,a,y),a=y+1):(Wh(u,n,y+1,d),d=y)}}function Hp(u,n,a){const d=u[n];u[n]=u[a],u[a]=d}et(vf,"FeaturePositionMap");class Ec{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,a),this.initialized=!0),!!this.location}set(n,a,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class qu extends Ec{constructor(n){super(n),this.current=0}set(n,a,d){this.fetchUniformLocation(n,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class ia extends Ec{constructor(n){super(n),this.current=0}set(n,a,d){this.fetchUniformLocation(n,a)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class Kl extends Ec{constructor(n){super(n),this.current=[0,0]}set(n,a,d){this.fetchUniformLocation(n,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class Pg extends Ec{constructor(n){super(n),this.current=[0,0,0]}set(n,a,d){this.fetchUniformLocation(n,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class Wp extends Ec{constructor(n){super(n),this.current=[0,0,0,0]}set(n,a,d){this.fetchUniformLocation(n,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class Mg extends Ec{constructor(n){super(n),this.current=Zt.transparent.toRenderColor(null)}set(n,a,d){this.fetchUniformLocation(n,a)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const Yy=new Float32Array(16);class bf extends Ec{constructor(n){super(n),this.current=Yy}set(n,a,d){if(this.fetchUniformLocation(n,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let _=1;_<16;_++)if(d[_]!==this.current[_]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const rx=new Float32Array(9),nx=new Float32Array(4);class kg extends Ec{constructor(n){super(n),this.current=nx}set(n,a,d){if(this.fetchUniformLocation(n,a)){for(let _=0;_<4;_++)if(d[_]!==this.current[_]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function Og(u){return[Ky(255*u.r,255*u.g),Ky(255*u.b,255*u.a)]}class xf{constructor(n,a,d,_){this.value=n,this.uniformNames=a.map(f=>`u_${f}`),this.type=d,this.context=_}setUniform(n,a,d,_,f){const y=_.constantOr(this.value);a.set(n,f,y instanceof Zt?y.toRenderColor(this.context.lut):y)}getBinding(n,a){return this.type==="color"?new Mg(n):new ia(n)}}class Zh{constructor(n,a){this.uniformNames=a.map(d=>`u_${d}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,a,d,_,f){const y=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;y&&a.set(n,f,y)}getBinding(n,a){return a==="u_pattern"||a==="u_dash"?new Wp(n):new ia(n)}}class Xl{constructor(n,a,d,_){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(f=>({name:`a_${f}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,a,d,_,f,y,T){const C=this.paintVertexArray.length,M=this.expression.evaluate(new li(0,{brightness:y}),a,{},f,_,T);this.paintVertexArray.resize(n),this._setPaintValue(C,n,M,this.context)}updatePaintArray(n,a,d,_,f,y,T){const C=this.expression.evaluate({zoom:0,brightness:T},d,_,void 0,f);this._setPaintValue(n,a,C,this.context)}_setPaintValue(n,a,d,_){if(this.type==="color"){const f=Og(d.toRenderColor(_.lut));for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,f[0],f[1])}else{for(let f=n;f<a;f++)this.paintVertexArray.emplace(f,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class rl{constructor(n,a,d,_,f,y){this.expression=n,this.uniformNames=a.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=_,this.context=f,this.maxValue=0,this.paintVertexAttributes=a.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,a,d,_,f,y,T){const C=this.expression.evaluate(new li(this.context.zoom,{brightness:y}),a,{},f,_,T),M=this.expression.evaluate(new li(this.context.zoom+1,{brightness:y}),a,{},f,_,T),x=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(x,n,C,M,this.context)}updatePaintArray(n,a,d,_,f,y,T){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:T},d,_,void 0,f),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T},d,_,void 0,f);this._setPaintValue(n,a,C,M,this.context)}_setPaintValue(n,a,d,_,f){if(this.type==="color"){const y=Og(d.toRenderColor(f.lut)),T=Og(d.toRenderColor(f.lut));for(let C=n;C<a;C++)this.paintVertexArray.emplace(C,y[0],y[1],T[0],T[1])}else{for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,d,_);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(_))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a,d,_,f){const y=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,T=nr(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(n,f,T)}getBinding(n,a){return new ia(n)}}class Yl{constructor(n,a,d,_,f){this.expression=n,this.layerId=f,this.paintVertexAttributes=(d==="array"?tx:ex).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new _}populatePaintArray(n,a,d,_){const f=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(f,n,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(n,a,d,_,f,y,T){this._setPaintValues(n,a,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(n,a,d,_){if(!_||!d)return;const f=_[d];if(!f)return;const{tl:y,br:T,pixelRatio:C}=f;for(let M=n;M<a;M++)this.paintVertexArray.emplace(M,y[0],y[1],T[0],T[1],C)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hu{constructor(n,a,d=()=>!0){this.binders={},this._buffers=[],this.context=a;const _=[];for(const f in n.paint._values){const y=n.paint.get(f);if(!d(f)||!(y instanceof Qo&&Xc(y.property.specification)))continue;const T=ox(f,n.type),C=y.value,M=y.property.specification.type,x=!!y.property.useIntegerZoom,I=f==="line-dasharray"||f.endsWith("pattern"),P=f==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(C.kind!=="constant"||P)if(C.kind==="source"||P||I){const A=m(f,M,"source");this.binders[f]=I?new Yl(C,T,M,A,n.id):new Xl(C,T,M,A),_.push(`/a_${f}`)}else{const A=m(f,M,"composite");this.binders[f]=new rl(C,T,M,x,a,A),_.push(`/z_${f}`)}else this.binders[f]=I?new Zh(C.value,T):new xf(C.value,T,M,a),_.push(`/u_${f}`)}this.cacheKey=_.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof Xl||a instanceof rl?a.maxValue:0}populatePaintArrays(n,a,d,_,f,y,T){for(const C in this.binders){const M=this.binders[C];M.context=this.context,(M instanceof Xl||M instanceof rl||M instanceof Yl)&&M.populatePaintArray(n,a,d,_,f,y,T)}}setConstantPatternPositions(n){for(const a in this.binders){const d=this.binders[a];d instanceof Zh&&d.setConstantPatternPositions(n)}}updatePaintArrays(n,a,d,_,f,y,T,C){let M=!1;const x=Object.keys(n),I=x.length!==0,P=I?x:a.uniqueIds;this.context.lut=f.lut;for(const A in this.binders){const R=this.binders[A];if(R.context=this.context,(R instanceof Xl||R instanceof rl||R instanceof Yl)&&(R.expression.isStateDependent===!0||R.expression.isLightConstant===!1)){const D=f.paint.get(A);R.expression=D.value;for(const N of P){const j=n[N.toString()];a.eachPosition(N,(Z,X,G)=>{const J=_.feature(Z);R.updatePaintArray(X,G,J,j,y,T,C)})}if(!I)for(const N of d.uniqueIds){const j=n[N.toString()];d.eachPosition(N,(Z,X,G)=>{const J=_.feature(Z);R.updatePaintArray(X,G,J,j,y,T,C)})}M=!0}}return M}defines(){const n=[];for(const a in this.binders){const d=this.binders[a];(d instanceof xf||d instanceof Zh)&&n.push(...d.uniformNames.map(_=>`#define HAS_UNIFORM_${_}`))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof Xl||d instanceof rl||d instanceof Yl)for(let _=0;_<d.paintVertexAttributes.length;_++)n.push(d.paintVertexAttributes[_].name)}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const d=this.binders[a];if(d instanceof xf||d instanceof Zh||d instanceof rl)for(const _ of d.uniformNames)n.push(_)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const a=[];for(const d in this.binders){const _=this.binders[d];if(_ instanceof xf||_ instanceof Zh||_ instanceof rl)for(const f of _.uniformNames)a.push({name:f,property:d,binding:_.getBinding(n,f)})}return a}setUniforms(n,a,d,_,f){for(const{name:y,property:T,binding:C}of d)this.binders[T].setUniform(n,C,f,_.get(T),y)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Xl||a instanceof rl||a instanceof Yl)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(n){for(const a in this.binders){const d=this.binders[a];(d instanceof Xl||d instanceof rl||d instanceof Yl)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof Xl||a instanceof rl||a instanceof Yl)&&a.destroy()}}}class iu{constructor(n,a,d=()=>!0){this.programConfigurations={};for(const _ of n)this.programConfigurations[_.id]=new Hu(_,a,d);this.needsUpload=!1,this._featureMap=new vf,this._featureMapWithoutIds=new vf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,a,d,_,f,y,T,C){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(n,a,_,f,y,T,C);a.id!==void 0?this._featureMap.add(a.id,d,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,d,_,f,y){for(const T of d)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,a,T,_,f,y||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const ix={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ox(u,n){return ix[u]||[u.replace(`${n}-`,"").replace(/-/g,"_")]}const sx={"line-pattern":{source:wc,composite:wc},"fill-pattern":{source:wc,composite:wc},"fill-extrusion-pattern":{source:wc,composite:wc},"line-dasharray":{source:$u,composite:$u}},Jy={color:{source:gf,composite:xc},number:{source:Hh,composite:gf}};function m(u,n,a){const d=sx[u];return d&&d[a]||Jy[n][a]}et(xf,"ConstantBinder"),et(Zh,"PatternConstantBinder"),et(Xl,"SourceExpressionBinder"),et(Yl,"PatternCompositeBinder"),et(rl,"CompositeExpressionBinder"),et(Hu,"ProgramConfiguration",{omit:["_buffers"]}),et(iu,"ProgramConfigurationSet");const i=fr/Math.PI/2,c=5,g=6,v=16383,w=64,S=[w,32,16],k=-i,L=i;function F(u,n,a,d=i){return a=Wt(a),[u*Math.sin(a)*d,-n*d,u*Math.cos(a)*d]}function V(u,n,a){return F(Math.cos(Wt(u)),Math.sin(Wt(u)),n,a)}const q=63710088e-1,W=2*Math.PI*q;class K{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new K(Zr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,d=this.lat*a,_=n.lat*a,f=Math.sin(d)*Math.sin(_)+Math.cos(d)*Math.cos(_)*Math.cos((n.lng-this.lng)*a);return q*Math.acos(Math.min(f,1))}toBounds(n=0){const a=360*n/40075017,d=a/Math.cos(Math.PI/180*this.lat);return new ae({lng:this.lng-d,lat:this.lat-a},{lng:this.lng+d,lat:this.lat+a})}toEcef(n){return V(this.lat,this.lng,i+n*i/q)}static convert(n){if(n instanceof K)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new K(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new K(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ae{constructor(n,a){if(n)if(a)this.setSouthWest(n).setNorthEast(a);else if(n.length===4){const d=n;this.setSouthWest([d[0],d[1]]).setNorthEast([d[2],d[3]])}else{const d=n;this.setSouthWest(d[0]).setNorthEast(d[1])}}setNorthEast(n){return this._ne=n instanceof K?new K(n.lng,n.lat):K.convert(n),this}setSouthWest(n){return this._sw=n instanceof K?new K(n.lng,n.lat):K.convert(n),this}extend(n){const a=this._sw,d=this._ne;let _,f;if(n instanceof K)_=n,f=n;else{if(!(n instanceof ae))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(ae.convert(n)):this.extend(K.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(K.convert(n)):this;if(_=n._sw,f=n._ne,!_||!f)return this}return a||d?(a.lng=Math.min(_.lng,a.lng),a.lat=Math.min(_.lat,a.lat),d.lng=Math.max(f.lng,d.lng),d.lat=Math.max(f.lat,d.lat)):(this._sw=new K(_.lng,_.lat),this._ne=new K(f.lng,f.lat)),this}getCenter(){return new K((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new K(this.getWest(),this.getNorth())}getSouthEast(){return new K(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:a,lat:d}=K.convert(n);let _=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&_}static convert(n){if(n)return n instanceof ae?n:new ae(n)}}const le=0,ue=25.5;function pe(u){return W*Math.cos(u*Math.PI/180)}function Re(u){return(180+u)/360}function Oe(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Ae(u,n){return u/pe(n)}function Be(u){return 360*u-180}function Le(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function He(u,n){return u*pe(Le(n))}const je=85.051129;function Ze(u){return Math.cos(Wt(nr(u,-je,je)))}function rt(u,n){const a=nr(n,le,ue),d=Math.pow(2,a);return Ze(u)*W/(512*d)}function Je(u){return 1/Math.cos(u*Math.PI/180)}function Ye(u,n=0){const a=Math.exp(Math.PI*(1-(u.y+n/fr)/(1<<u.z)*2));return 80150034*a/(a*a+1)/fr/(1<<u.z)}class ht{constructor(n,a,d=0){this.x=+n,this.y=+a,this.z=+d}static fromLngLat(n,a=0){const d=K.convert(n);return new ht(Re(d.lng),Oe(d.lat),Ae(a,d.lat))}toLngLat(){return new K(Be(this.x),Le(this.y))}toAltitude(){return He(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/W*Je(Le(this.y))}}function Ct(u,n,a,d,_,f,y,T,C){const M=(n+d)/2,x=(a+_)/2,I=new We(M,x);T(I),function(P,A,R,D,N,j){const Z=R-N,X=D-j;return Math.abs((D-A)*Z-(R-P)*X)/Math.hypot(Z,X)}(I.x,I.y,f.x,f.y,y.x,y.y)>=C?(Ct(u,n,a,M,x,f,I,T,C),Ct(u,M,x,d,_,I,y,T,C)):u.push(y)}function Ft(u,n,a){let d=u[0],_=d.x,f=d.y;n(d);const y=[d];for(let T=1;T<u.length;T++){const C=u[T],{x:M,y:x}=C;n(C),Ct(y,_,f,M,x,d,C,n,a),_=M,f=x,d=C}return y}function At(u,n,a,d){if(d(n,a)){const _=n.add(a)._mult(.5);At(u,n,_,d),At(u,_,a,d)}else u.push(a)}function Yt(u,n){let a=u[0];const d=[a];for(let _=1;_<u.length;_++){const f=u[_];At(d,a,f,n),a=f}return d}const dt=Math.pow(2,14)-1,Lt=-dt-1;function kt(u,n){const a=Math.round(u.x*n),d=Math.round(u.y*n);return u.x=nr(a,Lt,dt),u.y=nr(d,Lt,dt),(a<u.x||a>u.x+1||d<u.y||d>u.y+1)&&en("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function Qt(u,n,a){const d=u.loadGeometry(),_=u.extent,f=fr/_;if(n&&a&&a.projection.isReprojectedInTileSpace){const y=1<<n.z,{scale:T,x:C,y:M,projection:x}=a,I=P=>{const A=Be((n.x+P.x/_)/y),R=Le((n.y+P.y/_)/y),D=x.project(A,R);P.x=(D.x*T-C)*_,P.y=(D.y*T-M)*_};for(let P=0;P<d.length;P++)if(u.type!==1)d[P]=Ft(d[P],I,1);else{const A=[];for(const R of d[P])R.x<0||R.x>=_||R.y<0||R.y>=_||(I(R),A.push(R));d[P]=A}}for(const y of d)for(const T of y)kt(T,f);return d}function tr(u,n){return{type:u.type,id:u.id,properties:u.properties,geometry:n?Qt(u):[]}}function Nt(u,n,a,d,_){u.emplaceBack(2*n+(d+1)/2,2*a+(_+1)/2)}function Ut(u,n,a){u.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Nr{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new eu,this.indexArray=new Ms,this.segments=new To,this.programConfigurations=new iu(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(n,a){}populate(n,a,d,_){const f=this.layers[0],y=[];let T=null;f.type==="circle"&&(T=f.layout.get("circle-sort-key"));for(const{feature:M,id:x,index:I,sourceLayerIndex:P}of n){const A=this.layers[0]._featureFilter.needGeometry,R=tr(M,A);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),R,d))continue;const D=T?T.evaluate(R,{},d):void 0,N={id:x,properties:M.properties,type:M.type,sourceLayerIndex:P,index:I,geometry:A?R.geometry:Qt(M,d,_),patterns:{},sortKey:D};y.push(N)}T&&y.sort((M,x)=>M.sortKey-x.sortKey);let C=null;_.projection.name==="globe"&&(this.globeExtVertexArray=new Vp,C=_.projection);for(const M of y){const{geometry:x,index:I,sourceLayerIndex:P}=M,A=n[I].feature;this.addFeature(M,x,I,a.availableImages,d,C,a.brightness),a.featureIndex.insert(A,x,I,P,this.index)}}update(n,a,d,_,f){const y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,a,y?this.stateDependentLayers:this.layers,d,_,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Jb.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,Qb.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,a,d,_,f,y,T){for(const C of a)for(const M of C){const x=M.x,I=M.y;if(x<0||x>=fr||I<0||I>=fr)continue;if(y){const R=y.projectTilePoint(x,I,f),D=y.upVector(f,x,I),N=this.globeExtVertexArray;Ut(N,R,D),Ut(N,R,D),Ut(N,R,D),Ut(N,R,D)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),A=P.vertexLength;Nt(this.layoutVertexArray,x,I,-1,-1),Nt(this.layoutVertexArray,x,I,1,-1),Nt(this.layoutVertexArray,x,I,1,1),Nt(this.layoutVertexArray,x,I,-1,1),this.indexArray.emplaceBack(A,A+1,A+2),this.indexArray.emplaceBack(A,A+2,A+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},_,f,T)}}function hr(u,n){for(let a=0;a<u.length;a++)if(Hi(n,u[a]))return!0;for(let a=0;a<n.length;a++)if(Hi(u,n[a]))return!0;return!!Hr(u,n)}function Sr(u,n,a){return!!Hi(u,n)||!!pn(n,u,a)}function Jr(u,n){if(u.length===1)return Ti(n,u[0]);for(let a=0;a<n.length;a++){const d=n[a];for(let _=0;_<d.length;_++)if(Hi(u,d[_]))return!0}for(let a=0;a<u.length;a++)if(Ti(n,u[a]))return!0;for(let a=0;a<n.length;a++)if(Hr(u,n[a]))return!0;return!1}function Pr(u,n,a){if(u.length>1){if(Hr(u,n))return!0;for(let d=0;d<n.length;d++)if(pn(n[d],u,a))return!0}for(let d=0;d<u.length;d++)if(pn(u[d],n,a))return!0;return!1}function Hr(u,n){if(u.length===0||n.length===0)return!1;for(let a=0;a<u.length-1;a++){const d=u[a],_=u[a+1];for(let f=0;f<n.length-1;f++)if(_n(d,_,n[f],n[f+1]))return!0}return!1}function _n(u,n,a,d){return Do(u,a,d)!==Do(n,a,d)&&Do(u,n,a)!==Do(u,n,d)}function pn(u,n,a){const d=a*a;if(n.length===1)return u.distSqr(n[0])<d;for(let _=1;_<n.length;_++)if(fi(u,n[_-1],n[_])<d)return!0;return!1}function fi(u,n,a){const d=n.distSqr(a);if(d===0)return u.distSqr(n);const _=((u.x-n.x)*(a.x-n.x)+(u.y-n.y)*(a.y-n.y))/d;return u.distSqr(_<0?n:_>1?a:a.sub(n)._mult(_)._add(n))}function Ti(u,n){let a,d,_,f=!1;for(let y=0;y<u.length;y++){a=u[y];for(let T=0,C=a.length-1;T<a.length;C=T++)d=a[T],_=a[C],d.y>n.y!=_.y>n.y&&n.x<(_.x-d.x)*(n.y-d.y)/(_.y-d.y)+d.x&&(f=!f)}return f}function Hi(u,n){let a=!1;for(let d=0,_=u.length-1;d<u.length;_=d++){const f=u[d],y=u[_];f.y>n.y!=y.y>n.y&&n.x<(y.x-f.x)*(n.y-f.y)/(y.y-f.y)+f.x&&(a=!a)}return a}function fl(u,n,a,d,_){for(const y of u)if(n<=y.x&&a<=y.y&&d>=y.x&&_>=y.y)return!0;const f=[new We(n,a),new We(n,_),new We(d,_),new We(d,a)];if(u.length>2){for(const y of f)if(Hi(u,y))return!0}for(let y=0;y<u.length-1;y++)if(Fo(u[y],u[y+1],f))return!0;return!1}function Fo(u,n,a){const d=a[0],_=a[2];if(u.x<d.x&&n.x<d.x||u.x>_.x&&n.x>_.x||u.y<d.y&&n.y<d.y||u.y>_.y&&n.y>_.y)return!1;const f=Do(u,n,a[0]);return f!==Do(u,n,a[1])||f!==Do(u,n,a[2])||f!==Do(u,n,a[3])}function Cn(u,n,a,d,_,f){let y=n.y-u.y,T=u.x-n.x;if(f=f||0){const C=y*y+T*T;if(C===0)return!0;const M=Math.sqrt(C);y/=M,T/=M}return!((a.x-u.x)*y+(a.y-u.y)*T-f<0||(d.x-u.x)*y+(d.y-u.y)*T-f<0||(_.x-u.x)*y+(_.y-u.y)*T-f<0)}function bi(u,n,a,d,_,f,y){return!(Cn(u,n,d,_,f,y)||Cn(n,a,d,_,f,y)||Cn(a,u,d,_,f,y)||Cn(d,_,u,n,a,y)||Cn(_,f,u,n,a,y)||Cn(f,d,u,n,a,y))}function lo(u,n,a){const d=n.paint.get(u).value;return d.kind==="constant"?d.value:a.programConfigurations.get(n.id).getMaxValue(u)}function vi(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function mn(u,n,a,d,_){if(!n[0]&&!n[1])return u;const f=We.convert(n)._mult(_);a==="viewport"&&f._rotate(-d);const y=[];for(let T=0;T<u.length;T++)y.push(u[T].sub(f));return y}function Zn(u,n,a,d){const _=We.convert(u)._mult(d);return n==="viewport"&&_._rotate(-a),_}let ci,Eo;et(Nr,"CircleBucket",{omit:["layers"]});var Vo,Nn={exports:{}},cs=(Vo||(Vo=1,function(u,n){(function(a){function d(f,y,T){var C=_(256*f,256*(y=Math.pow(2,T)-y-1),T),M=_(256*(f+1),256*(y+1),T);return C[0]+","+C[1]+","+M[0]+","+M[1]}function _(f,y,T){var C=2*Math.PI*6378137/256/Math.pow(2,T);return[f*C-2*Math.PI*6378137/2,y*C-2*Math.PI*6378137/2]}a.getURL=function(f,y,T,C,M,x){return x=x||{},f+"?"+["bbox="+d(T,C,M),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+y].join("&")},a.getTileBBox=d,a.getMercCoords=_,Object.defineProperty(a,"__esModule",{value:!0})})(n)}(0,Nn.exports)),Nn.exports);class ys{constructor(n,a,d){this.z=n,this.x=a,this.y=d,this.key=wa(0,n,n,a,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a){const d=cs.getTileBBox(this.x,this.y,this.z),_=function(f,y,T){let C,M="";for(let x=f;x>0;x--)C=1<<x-1,M+=(y&C?1:0)+(T&C?2:0);return M}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",_).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class us{constructor(n,a){this.wrap=n,this.canonical=a,this.key=wa(n,a.z,a.z,a.x,a.y)}}class Ni{constructor(n,a,d,_,f){this.overscaledZ=n,this.wrap=a,this.canonical=new ys(d,+_,+f),this.key=a===0&&n===d?this.canonical.key:wa(a,n,d,_,f)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const a=this.canonical.z-n;return n>this.canonical.z?new Ni(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ni(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a=!0){if(this.overscaledZ===n&&a)return this.key;if(n>this.canonical.z)return wa(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-n;return wa(this.wrap*+a,n,n,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new Ni(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,d=2*this.canonical.x,_=2*this.canonical.y;return[new Ni(a,this.wrap,a,d,_),new Ni(a,this.wrap,a,d+1,_),new Ni(a,this.wrap,a,d,_+1),new Ni(a,this.wrap,a,d+1,_+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new Ni(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new Ni(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new us(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function wa(u,n,a,d,_){const f=1<<Math.min(a,22);let y=f*(_%f)+d%f;return u&&a<22&&(y+=f*f*((u<0?-2*u-1:2*u)%(1<<2*(22-a)))),16*(32*y+a)+(n-a)}const Ta=[u=>{let n=u.canonical.x-1,a=u.wrap;return n<0&&(n=(1<<u.canonical.z)-1,a--),new Ni(u.overscaledZ,a,u.canonical.z,n,u.canonical.y)},u=>{let n=u.canonical.x+1,a=u.wrap;return n===1<<u.canonical.z&&(n=0,a++),new Ni(u.overscaledZ,a,u.canonical.z,n,u.canonical.y)},u=>new Ni(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new Ni(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];et(ys,"CanonicalTileID"),et(Ni,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const pl=Wn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:nl}=pl,za=Wn([{name:"a_pos_3",components:3,type:"Int16"}]);var ml=Wn([{name:"a_pos",type:"Int16",components:2}]);class Sc{constructor(n,a){this.pos=n,this.dir=a}intersectsPlane(n,a,d){const _=Se.vec3.dot(a,this.dir);if(Math.abs(_)<1e-6)return!1;const f=((n[0]-this.pos[0])*a[0]+(n[1]-this.pos[1])*a[1]+(n[2]-this.pos[2])*a[2])/_;return d[0]=this.pos[0]+this.dir[0]*f,d[1]=this.pos[1]+this.dir[1]*f,d[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(n,a,d){if(Se.vec3.equals(this.pos,n)||a===0)return d[0]=d[1]=d[2]=0,!1;const[_,f,y]=this.dir,T=this.pos[0]-n[0],C=this.pos[1]-n[1],M=this.pos[2]-n[2],x=_*_+f*f+y*y,I=2*(T*_+C*f+M*y),P=I*I-4*x*(T*T+C*C+M*M-a*a);if(P<0){const A=Math.max(-I/2,0),R=T+_*A,D=C+f*A,N=M+y*A,j=Math.hypot(R,D,N);return d[0]=R*a/j,d[1]=D*a/j,d[2]=N*a/j,!1}{const A=(-I-Math.sqrt(P))/(2*x);if(A<0){const R=Math.hypot(T,C,M);return d[0]=T*a/R,d[1]=C*a/R,d[2]=M*a/R,!1}return d[0]=T+_*A,d[1]=C+f*A,d[2]=M+y*A,!0}}}class ou{constructor(n,a,d,_,f){this.TL=n,this.TR=a,this.BR=d,this.BL=_,this.horizon=f}static fromInvProjectionMatrix(n,a,d){const _=[-1,1,1],f=[1,1,1],y=[1,-1,1],T=[-1,-1,1],C=Se.vec3.transformMat4(_,_,n),M=Se.vec3.transformMat4(f,f,n),x=Se.vec3.transformMat4(y,y,n),I=Se.vec3.transformMat4(T,T,n);return new ou(C,M,x,I,a/d)}}function Jl(u,n,a){let d=1/0,_=-1/0;const f=[];for(const y of u){Se.vec3.sub(f,y,n);const T=Se.vec3.dot(f,a);d=Math.min(d,T),_=Math.max(_,T)}return[d,_]}function Kh(u,n){let a=!0;for(let d=0;d<u.planes.length;d++){const _=u.planes[d];let f=0;for(let y=0;y<n.length;y++)f+=Se.vec3.dot(_,n[y])+_[3]>=0;if(f===0)return 0;f!==n.length&&(a=!1)}return a?2:1}function Xh(u,n){for(const a of u.projections){const d=Jl(n,u.points[0],a.axis);if(a.projection[1]<d[0]||a.projection[0]>d[1])return 0}return 1}function Zp(u,n){let a=0;const d=[0,0,0,0];for(let _=0;_<u.length;_++)d[0]=u[_][0],d[1]=u[_][1],d[2]=u[_][2],d[3]=1,Se.vec4.dot(d,n)>=0&&a++;return a}class Yh{constructor(n,a){this.points=n||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=Fi.fromPoints(this.points),this.projections=[],this.frustumEdges=[Se.vec3.sub([],this.points[2],this.points[3]),Se.vec3.sub([],this.points[0],this.points[3]),Se.vec3.sub([],this.points[4],this.points[0]),Se.vec3.sub([],this.points[5],this.points[1]),Se.vec3.sub([],this.points[6],this.points[2]),Se.vec3.sub([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const _=[0,-d[2],d[1]],f=[d[2],0,-d[0]];this.projections.push({axis:_,projection:Jl(this.points,this.points[0],_)}),this.projections.push({axis:f,projection:Jl(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(n,a,d,_){const f=Math.pow(2,d),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const x=Se.vec4.transformMat4([],M,n),I=1/x[3]/a*f;return Se.vec4.mul(x,x,[I,I,_?1/x[3]:I,I])}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const x=Se.vec3.sub([],y[M[0]],y[M[1]]),I=Se.vec3.sub([],y[M[2]],y[M[1]]),P=Se.vec3.normalize([],Se.vec3.cross([],x,I)),A=-Se.vec3.dot(P,y[M[1]]);return P.concat(A)}),C=[];for(let M=0;M<y.length;M++)C.push([y[M][0],y[M][1],y[M][2]]);return new Yh(C,T)}intersectsPrecise(n,a,d){for(let _=0;_<a.length;_++)if(!Zp(n,a[_]))return 0;for(let _=0;_<this.planes.length;_++)if(!Zp(n,this.planes[_]))return 0;for(const _ of d)for(const f of this.frustumEdges){const y=Se.vec3.cross([],_,f),T=Se.vec3.length(y);if(T===0)continue;Se.vec3.scale(y,y,1/T);const C=Jl(this.points,this.points[0],y),M=Jl(n,this.points[0],y);if(C[0]>M[1]||M[0]>C[1])return 0}return 1}containsPoint(n){for(const a of this.planes){const d=a[3];if(Se.vec3.dot([a[0],a[1],a[2]],n)+d<0)return!1}return!0}}class Fi{static fromPoints(n){const a=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const _ of n)Se.vec3.min(a,a,_),Se.vec3.max(d,d,_);return new Fi(a,d)}static fromTileIdAndHeight(n,a,d){const _=1<<n.canonical.z,f=n.canonical.x,y=n.canonical.y;return new Fi([f/_,y/_,a],[(f+1)/_,(y+1)/_,d])}static applyTransform(n,a){const d=n.getCorners();for(let _=0;_<d.length;++_)Se.vec3.transformMat4(d[_],d[_],a);return Fi.fromPoints(d)}static applyTransformFast(n,a){const d=[a[12],a[13],a[14]],_=[...d];for(let f=0;f<3;f++)for(let y=0;y<3;y++){const T=a[4*y+f],C=T*n.min[y],M=T*n.max[y];d[f]+=Math.min(C,M),_[f]+=Math.max(C,M)}return new Fi(d,_)}static projectAabbCorners(n,a){const d=n.getCorners();for(let _=0;_<d.length;++_)Se.vec3.transformMat4(d[_],d[_],a);return d}constructor(n,a){this.min=n,this.max=a,this.center=Se.vec3.scale([],Se.vec3.add([],this.min,this.max),.5)}quadrant(n){const a=[n%2==0,n<2],d=Se.vec3.clone(this.min),_=Se.vec3.clone(this.max);for(let f=0;f<a.length;f++)d[f]=a[f]?this.min[f]:this.center[f],_[f]=a[f]?this.center[f]:this.max[f];return _[2]=this.max[2],new Fi(d,_)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,a=this.max;return[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]],[n[0],n[1],a[2]],[a[0],n[1],a[2]],[a[0],a[1],a[2]],[n[0],a[1],a[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?Kh(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?Kh(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,a){return a||this.intersects(n)?Xh(n,this.getCorners()):0}intersectsPreciseFlat(n,a){return a||this.intersectsFlat(n)?Xh(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let a=0;a<3;++a)if(this.min[a]>n.max[a]||n.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n.min[a]),this.max[a]=Math.max(this.max[a],n.max[a])}encapsulatePoint(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n[a]),this.max[a]=Math.max(this.max[a],n[a])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}function Wu(u){return u*i/q}et(Fi,"Aabb");const ax=[new Fi([k,k,k],[L,L,L]),new Fi([k,k,k],[0,0,L]),new Fi([0,k,k],[L,0,L]),new Fi([k,0,k],[0,L,L]),new Fi([0,0,k],[L,L,L])];function Qy(u,n,a,d=!0){const _=Se.vec3.scale([],u._camera.position,u.worldSize),f=[n,a,1,1];Se.vec4.transformMat4(f,f,u.pixelMatrixInverse),Se.vec4.scale(f,f,1/f[3]);const y=Se.vec3.sub([],f,_),T=Se.vec3.normalize([],y),C=u.globeMatrix,M=[C[12],C[13],C[14]],x=Se.vec3.sub([],M,_),I=Se.vec3.length(x),P=Se.vec3.normalize([],x),A=u.worldSize/(2*Math.PI),R=Se.vec3.dot(P,T),D=Math.asin(A/I);if(D<Math.acos(R)){if(!d)return null;const Ve=[],De=[];Se.vec3.scale(Ve,T,I/R),Se.vec3.normalize(De,Se.vec3.sub(De,Ve,x)),Se.vec3.normalize(T,Se.vec3.add(T,x,Se.vec3.scale(T,De,Math.tan(D)*I)))}const N=[];new Sc(_,T).closestPointOnSphere(M,A,N);const j=Se.vec3.normalize([],$o(C,0)),Z=Se.vec3.normalize([],$o(C,1)),X=Se.vec3.normalize([],$o(C,2)),G=Se.vec3.dot(j,N),J=Se.vec3.dot(Z,N),se=Se.vec3.dot(X,N),_e=mr(Math.asin(-J/A));let Ce=mr(Math.atan2(G,se));Ce=u.center.lng+function(Ve,De){const qe=(De-Ve+180)%360-180;return qe<-180?qe+360:qe}(u.center.lng,Ce);const Pe=Re(Ce),Ee=nr(Oe(_e),0,1);return new ht(Pe,Ee)}class qz{constructor(n,a,d){this.a=Se.vec3.sub([],n,d),this.b=Se.vec3.sub([],a,d),this.center=d;const _=Se.vec3.normalize([],this.a),f=Se.vec3.normalize([],this.b);this.angle=Math.acos(Se.vec3.dot(_,f))}}function lx(u,n){if(u.angle===0)return null;let a;return a=u.a[n]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[n]/u.a[n]/Math.sin(u.angle)-1/Math.tan(u.angle)),a<0||a>1?null:function(d,_,f,y){const T=Math.sin(f);return d*(Math.sin((1-y)*f)/T)+_*(Math.sin(y*f)/T)}(u.a[n],u.b[n],u.angle,nr(a,0,1))+u.center[n]}function su(u){if(u.z<=1)return ax[u.z+2*u.y+u.x];const n=cx(ev(u));return Fi.fromPoints(n)}function Zu(u,n,a){return Se.vec3.scale(u,u,1-a),Se.vec3.scaleAndAdd(u,u,n,a)}function oS(u,n,a){for(const d of u)Se.vec3.transformMat4(d,d,n),Se.vec3.scale(d,d,a)}function sS(u,n,a,d){const _=n/u.worldSize,f=u.globeMatrix;if(a.z<=1){const Pe=su(a).getCorners();return oS(Pe,f,_),Fi.fromPoints(Pe)}const y=ev(a,d),T=cx(y,i+Wu(u._tileCoverLift));oS(T,f,_);const C=Number.MAX_VALUE,M=[-C,-C,-C],x=[C,C,C];if(y.contains(u.center)){for(const Ve of T)Se.vec3.min(x,x,Ve),Se.vec3.max(M,M,Ve);M[2]=0;const Pe=u.point,Ee=[Pe.x*_,Pe.y*_,0];return Se.vec3.min(x,x,Ee),Se.vec3.max(M,M,Ee),new Fi(x,M)}if(u._tileCoverLift>0){for(const Pe of T)Se.vec3.min(x,x,Pe),Se.vec3.max(M,M,Pe);return new Fi(x,M)}const I=[f[12]*_,f[13]*_,f[14]*_],P=y.getCenter(),A=nr(u.center.lat,-je,je),R=nr(P.lat,-je,je),D=Re(u.center.lng),N=Oe(A);let j=D-Re(P.lng);const Z=N-Oe(R);j>.5?j-=1:j<-.5&&(j+=1);let X=0;if(Math.abs(j)>Math.abs(Z))X=j>=0?1:3;else{X=Z>=0?0:2;const Pe=[f[4]*_,f[5]*_,f[6]*_],Ee=-Math.sin(Wt(Z>=0?y.getSouth():y.getNorth()))*i;Se.vec3.scaleAndAdd(I,I,Pe,Ee)}const G=T[X],J=T[(X+1)%4],se=new qz(G,J,I),_e=[lx(se,0)||G[0],lx(se,1)||G[1],lx(se,2)||G[2]],Ce=Jh(u.zoom);if(Ce>0){const Pe=function({x:Ve,y:De,z:qe},Qe,nt,ot,lt){const yt=1/(1<<qe);let ut=Ve*yt,Mt=ut+yt,Vt=De*yt,Tt=Vt+yt,wr=0;const dr=(ut+Mt)/2-ot;return dr>.5?wr=-1:dr<-.5&&(wr=1),ut=((ut+wr)*Qe-(ot*=Qe))*nt+ot,Mt=((Mt+wr)*Qe-ot)*nt+ot,Vt=(Vt*Qe-(lt*=Qe))*nt+lt,Tt=(Tt*Qe-lt)*nt+lt,[[ut,Tt,0],[Mt,Tt,0],[Mt,Vt,0],[ut,Vt,0]]}(a,n,u._pixelsPerMercatorPixel,D,N);for(let Ve=0;Ve<T.length;Ve++)Zu(T[Ve],Pe[Ve],Ce);const Ee=Se.vec3.add([],Pe[X],Pe[(X+1)%4]);Se.vec3.scale(Ee,Ee,.5),Zu(_e,Ee,Ce)}for(const Pe of T)Se.vec3.min(x,x,Pe),Se.vec3.max(M,M,Pe);return x[2]=Math.min(G[2],J[2]),Se.vec3.min(x,x,_e),Se.vec3.max(M,M,_e),new Fi(x,M)}function ev({x:u,y:n,z:a},d=!1){const _=1/(1<<a),f=new K(Be(u*_),n===(1<<a)-1&&d?-90:Le((n+1)*_)),y=new K(Be((u+1)*_),n===0&&d?90:Le(n*_));return new ae(f,y)}function cx(u,n=i){const a=Wt(u.getNorth()),d=Wt(u.getSouth()),_=Math.cos(a),f=Math.cos(d),y=Math.sin(a),T=Math.sin(d),C=u.getWest(),M=u.getEast();return[F(f,T,C,n),F(f,T,M,n),F(_,y,M,n),F(_,y,C,n)]}function Dg(u,n,a,d){const _=1<<a.z,f=(u/fr+a.x)/_;return V(Le((n/fr+a.y)/_),Be(f),d)}function tv({min:u,max:n}){return v/Math.max(n[0]-u[0],n[1]-u[1],n[2]-u[2])}const aS=new Float64Array(16);function rv(u){const n=tv(u),a=Se.mat4.fromScaling(aS,[n,n,n]);return Se.mat4.translate(a,a,Se.vec3.negate([],u.min))}function ux(u){const n=Se.mat4.fromTranslation(aS,u.min),a=1/tv(u);return Se.mat4.scale(n,n,[a,a,a])}function hx(u){const n=fr/(2*Math.PI);return u/(2*Math.PI)/n}function lS(u,n){return fr/(512*Math.pow(2,u))*tv(su(n))}function cS(u,n,a,d,_){const f=hx(a),y=[u,n,-a/(2*Math.PI)],T=Se.mat4.identity(new Float64Array(16));return Se.mat4.translate(T,T,y),Se.mat4.scale(T,T,[f,f,f]),Se.mat4.rotateX(T,T,Wt(-_)),Se.mat4.rotateY(T,T,Wt(-d)),T}function Jh(u){return Wr(c,g,u)}function uS(u,n){const a=V(n.lat,n.lng),d=function(f){const y=V(f._center.lat,f._center.lng),T=Se.vec3.fromValues(0,1,0);let C=Se.vec3.cross([],T,y);const M=Se.mat4.fromRotation([],-f.angle,y);C=Se.vec3.transformMat4(C,C,M),Se.mat4.fromRotation(M,-f._pitch,C);const x=Se.vec3.normalize([],y);return Se.vec3.scale(x,x,Wu(f.cameraToCenterDistance/f.pixelsPerMeter)),Se.vec3.transformMat4(x,x,M),Se.vec3.add([],y,x)}(u),_=Se.vec3.subtract([],d,a);return Se.vec3.angle(_,a)}function dx(u,n){return uS(u,n)>Math.PI/2*1.01}const hS=Wt(85),Hz=Math.cos(hS),Wz=Math.sin(hS),Zz=Se.mat4.create(),dS=u=>{const n=[];return u.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function fS(u,n,a,d,_,f,y,T,C){if(f&&u.queryGeometry.isAboveHorizon)return!1;f&&(C*=u.pixelToTileUnitsFactor);const M=u.tileID.canonical,x=a.projection.upVectorScale(M,a.center.lat,a.worldSize).metersToTile;for(const I of n)for(const P of I){const A=P.add(T),R=_&&a.elevation?a.elevation.exaggeration()*_.getElevationAt(A.x,A.y,!0):0,D=a.projection.projectTilePoint(A.x,A.y,M);if(R>0){const X=a.projection.upVector(M,A.x,A.y);D.x+=X[0]*x*R,D.y+=X[1]*x*R,D.z+=X[2]*x*R}const N=f?A:Kz(D.x,D.y,D.z,d),j=f?u.tilespaceRays.map(X=>Yz(X,R)):u.queryGeometry.screenGeometry,Z=Se.vec4.transformMat4([],[D.x,D.y,D.z,1],d);if(!y&&f?C*=Z[3]/a.cameraToCenterDistance:y&&!f&&(C*=a.cameraToCenterDistance/Z[3]),f){const X=Le((P.y/fr+M.y)/(1<<M.z));C/=a.projection.pixelsPerMeter(X,1)/Ae(1,X)}if(Sr(j,N,C))return!0}return!1}function Kz(u,n,a,d){const _=Se.vec4.transformMat4([],[u,n,a,1],d);return new We(_[0]/_[3],_[1]/_[3])}const pS=Se.vec3.fromValues(0,0,0),Xz=Se.vec3.fromValues(0,0,1);function Yz(u,n){const a=Se.vec3.create();return pS[2]=n,u.intersectsPlane(pS,Xz,a),new We(a[0],a[1])}class mS extends Nr{}let gS,_S,yS,vS;function bS(u,{width:n,height:a},d,_){if(_){if(_ instanceof Uint8ClampedArray)_=new Uint8Array(_.buffer);else if(_.length!==n*a*d)throw new RangeError("mismatched image size")}else _=new Uint8Array(n*a*d);return u.width=n,u.height=a,u.data=_,u}function xS(u,n,a){const{width:d,height:_}=n;d===u.width&&_===u.height||(fx(u,n,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,d),height:Math.min(u.height,_)},a,null),u.width=d,u.height=_,u.data=n.data)}function fx(u,n,a,d,_,f,y,T){if(_.width===0||_.height===0)return n;if(_.width>u.width||_.height>u.height||a.x>u.width-_.width||a.y>u.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>n.width||_.height>n.height||d.x>n.width-_.width||d.y>n.height-_.height)throw new RangeError("out of range destination coordinates for image copy");const C=u.data,M=n.data,x=f===4&&T;for(let I=0;I<_.height;I++){const P=((a.y+I)*u.width+a.x)*f,A=((d.y+I)*n.width+d.x)*f;if(x)for(let R=0;R<_.width;R++){const D=P+R*f+3,N=A+R*f;M[N+0]=255,M[N+1]=255,M[N+2]=255,M[N+3]=C[D]}else if(y)for(let R=0;R<_.width;R++){const D=P+R*f,N=A+R*f,j=C[D+3],Z=new Zt(C[D+0]/255*j,C[D+1]/255*j,C[D+2]/255*j,j).toRenderColor(y).toArray();M[N+0]=Z[0],M[N+1]=Z[1],M[N+2]=Z[2],M[N+3]=Z[3]}else for(let R=0;R<_.width*f;R++)M[A+R]=C[P+R]}return n}et(mS,"HeatmapBucket",{omit:["layers"]});class Qh{constructor(n,a){bS(this,n,1,a)}resize(n){xS(this,new Qh(n),1)}clone(){return new Qh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,d,_,f){fx(n,a,d,_,f,1,null)}}class Ea{constructor(n,a){bS(this,n,4,a)}resize(n){xS(this,new Ea(n),4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,d,_,f,y,T){fx(n,a,d,_,f,4,y,T)}}class wS{constructor(n,a){this.width=n.width,this.height=n.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Lg(u){const n={},a=u.resolution||256,d=u.clips?u.clips.length:1,_=u.image||new Ea({width:a,height:d}),f=(y,T,C)=>{n[u.evaluationKey]=C;const M=u.expression.evaluate(n);M&&(_.data[y+T+0]=Math.floor(255*M.r/M.a),_.data[y+T+1]=Math.floor(255*M.g/M.a),_.data[y+T+2]=Math.floor(255*M.b/M.a),_.data[y+T+3]=Math.floor(255*M.a))};if(u.clips)for(let y=0,T=0;y<d;++y,T+=4*a)for(let C=0,M=0;C<a;C++,M+=4){const x=C/(a-1),{start:I,end:P}=u.clips[y];f(T,M,I*(1-x)+P*x)}else for(let y=0,T=0;y<a;y++,T+=4)f(0,T,y/(a-1));return _}et(Qh,"AlphaImage"),et(Ea,"RGBAImage");const Jz=Wn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qz}=Jz;function Bg(u,n,a=2){const d=n&&n.length,_=d?n[0]*a:u.length;let f=TS(u,0,_,a,!0);const y=[];if(!f||f.next===f.prev)return y;let T,C,M;if(d&&(f=function(x,I,P,A){const R=[];for(let D=0,N=I.length;D<N;D++){const j=TS(x,I[D]*A,D<N-1?I[D+1]*A:x.length,A,!1);j===j.next&&(j.steiner=!0),R.push(a4(j))}R.sort(i4);for(let D=0;D<R.length;D++)P=o4(R[D],P);return P}(u,n,f,a)),u.length>80*a){T=1/0,C=1/0;let x=-1/0,I=-1/0;for(let P=a;P<_;P+=a){const A=u[P],R=u[P+1];A<T&&(T=A),R<C&&(C=R),A>x&&(x=A),R>I&&(I=R)}M=Math.max(x-T,I-C),M=M!==0?32767/M:0}return zg(f,y,a,T,C,M,0),y}function TS(u,n,a,d,_){let f;if(_===function(y,T,C,M){let x=0;for(let I=T,P=C-M;I<C;I+=M)x+=(y[P]-y[I])*(y[I+1]+y[P+1]),P=I;return x}(u,n,a,d)>0)for(let y=n;y<a;y+=d)f=IS(y/d|0,u[y],u[y+1],f);else for(let y=a-d;y>=n;y-=d)f=IS(y/d|0,u[y],u[y+1],f);return f&&nv(f,f.next)&&(Fg(f),f=f.next),f}function wf(u,n){if(!u)return u;n||(n=u);let a,d=u;do if(a=!1,d.steiner||!nv(d,d.next)&&hs(d.prev,d,d.next)!==0)d=d.next;else{if(Fg(d),d=n=d.prev,d===d.next)break;a=!0}while(a||d!==n);return n}function zg(u,n,a,d,_,f,y){if(!u)return;!y&&f&&function(C,M,x,I){let P=C;do P.z===0&&(P.z=px(P.x,P.y,M,x,I)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==C);P.prevZ.nextZ=null,P.prevZ=null,function(A){let R,D=1;do{let N,j=A;A=null;let Z=null;for(R=0;j;){R++;let X=j,G=0;for(let se=0;se<D&&(G++,X=X.nextZ,X);se++);let J=D;for(;G>0||J>0&&X;)G!==0&&(J===0||!X||j.z<=X.z)?(N=j,j=j.nextZ,G--):(N=X,X=X.nextZ,J--),Z?Z.nextZ=N:A=N,N.prevZ=Z,Z=N;j=X}Z.nextZ=null,D*=2}while(R>1)}(P)}(u,d,_,f);let T=u;for(;u.prev!==u.next;){const C=u.prev,M=u.next;if(f?t4(u,d,_,f):e4(u))n.push(C.i,u.i,M.i),Fg(u),u=M.next,T=M.next;else if((u=M)===T){y?y===1?zg(u=r4(wf(u),n),n,a,d,_,f,2):y===2&&n4(u,n,a,d,_,f):zg(wf(u),n,a,d,_,f,1);break}}}function e4(u){const n=u.prev,a=u,d=u.next;if(hs(n,a,d)>=0)return!1;const _=n.x,f=a.x,y=d.x,T=n.y,C=a.y,M=d.y,x=_<f?_<y?_:y:f<y?f:y,I=T<C?T<M?T:M:C<M?C:M,P=_>f?_>y?_:y:f>y?f:y,A=T>C?T>M?T:M:C>M?C:M;let R=d.next;for(;R!==n;){if(R.x>=x&&R.x<=P&&R.y>=I&&R.y<=A&&Kp(_,T,f,C,y,M,R.x,R.y)&&hs(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function t4(u,n,a,d){const _=u.prev,f=u,y=u.next;if(hs(_,f,y)>=0)return!1;const T=_.x,C=f.x,M=y.x,x=_.y,I=f.y,P=y.y,A=T<C?T<M?T:M:C<M?C:M,R=x<I?x<P?x:P:I<P?I:P,D=T>C?T>M?T:M:C>M?C:M,N=x>I?x>P?x:P:I>P?I:P,j=px(A,R,n,a,d),Z=px(D,N,n,a,d);let X=u.prevZ,G=u.nextZ;for(;X&&X.z>=j&&G&&G.z<=Z;){if(X.x>=A&&X.x<=D&&X.y>=R&&X.y<=N&&X!==_&&X!==y&&Kp(T,x,C,I,M,P,X.x,X.y)&&hs(X.prev,X,X.next)>=0||(X=X.prevZ,G.x>=A&&G.x<=D&&G.y>=R&&G.y<=N&&G!==_&&G!==y&&Kp(T,x,C,I,M,P,G.x,G.y)&&hs(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;X&&X.z>=j;){if(X.x>=A&&X.x<=D&&X.y>=R&&X.y<=N&&X!==_&&X!==y&&Kp(T,x,C,I,M,P,X.x,X.y)&&hs(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;G&&G.z<=Z;){if(G.x>=A&&G.x<=D&&G.y>=R&&G.y<=N&&G!==_&&G!==y&&Kp(T,x,C,I,M,P,G.x,G.y)&&hs(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function r4(u,n){let a=u;do{const d=a.prev,_=a.next.next;!nv(d,_)&&ES(d,a,a.next,_)&&Ng(d,_)&&Ng(_,d)&&(n.push(d.i,a.i,_.i),Fg(a),Fg(a.next),a=u=_),a=a.next}while(a!==u);return wf(a)}function n4(u,n,a,d,_,f){let y=u;do{let T=y.next.next;for(;T!==y.prev;){if(y.i!==T.i&&l4(y,T)){let C=SS(y,T);return y=wf(y,y.next),C=wf(C,C.next),zg(y,n,a,d,_,f,0),void zg(C,n,a,d,_,f,0)}T=T.next}y=y.next}while(y!==u)}function i4(u,n){return u.x-n.x}function o4(u,n){const a=function(_,f){let y=f;const T=_.x,C=_.y;let M,x=-1/0;do{if(C<=y.y&&C>=y.next.y&&y.next.y!==y.y){const D=y.x+(C-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(D<=T&&D>x&&(x=D,M=y.x<y.next.x?y:y.next,D===T))return M}y=y.next}while(y!==f);if(!M)return null;const I=M,P=M.x,A=M.y;let R=1/0;y=M;do{if(T>=y.x&&y.x>=P&&T!==y.x&&Kp(C<A?T:x,C,P,A,C<A?x:T,C,y.x,y.y)){const D=Math.abs(C-y.y)/(T-y.x);Ng(y,_)&&(D<R||D===R&&(y.x>M.x||y.x===M.x&&s4(M,y)))&&(M=y,R=D)}y=y.next}while(y!==I);return M}(u,n);if(!a)return n;const d=SS(a,u);return wf(d,d.next),wf(a,a.next)}function s4(u,n){return hs(u.prev,u,n.prev)<0&&hs(n.next,u,u.next)<0}function px(u,n,a,d,_){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-a)*_|0)|u<<8))|u<<4))|u<<2))|u<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*_|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function a4(u){let n=u,a=u;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==u);return a}function Kp(u,n,a,d,_,f,y,T){return(_-y)*(n-T)>=(u-y)*(f-T)&&(u-y)*(d-T)>=(a-y)*(n-T)&&(a-y)*(f-T)>=(_-y)*(d-T)}function l4(u,n){return u.next.i!==n.i&&u.prev.i!==n.i&&!function(a,d){let _=a;do{if(_.i!==a.i&&_.next.i!==a.i&&_.i!==d.i&&_.next.i!==d.i&&ES(_,_.next,a,d))return!0;_=_.next}while(_!==a);return!1}(u,n)&&(Ng(u,n)&&Ng(n,u)&&function(a,d){let _=a,f=!1;const y=(a.x+d.x)/2,T=(a.y+d.y)/2;do _.y>T!=_.next.y>T&&_.next.y!==_.y&&y<(_.next.x-_.x)*(T-_.y)/(_.next.y-_.y)+_.x&&(f=!f),_=_.next;while(_!==a);return f}(u,n)&&(hs(u.prev,u,n.prev)||hs(u,n.prev,n))||nv(u,n)&&hs(u.prev,u,u.next)>0&&hs(n.prev,n,n.next)>0)}function hs(u,n,a){return(n.y-u.y)*(a.x-n.x)-(n.x-u.x)*(a.y-n.y)}function nv(u,n){return u.x===n.x&&u.y===n.y}function ES(u,n,a,d){const _=ov(hs(u,n,a)),f=ov(hs(u,n,d)),y=ov(hs(a,d,u)),T=ov(hs(a,d,n));return _!==f&&y!==T||!(_!==0||!iv(u,a,n))||!(f!==0||!iv(u,d,n))||!(y!==0||!iv(a,u,d))||!(T!==0||!iv(a,n,d))}function iv(u,n,a){return n.x<=Math.max(u.x,a.x)&&n.x>=Math.min(u.x,a.x)&&n.y<=Math.max(u.y,a.y)&&n.y>=Math.min(u.y,a.y)}function ov(u){return u>0?1:u<0?-1:0}function Ng(u,n){return hs(u.prev,u,u.next)<0?hs(u,n,u.next)>=0&&hs(u,u.prev,n)>=0:hs(u,n,u.prev)<0||hs(u,u.next,n)<0}function SS(u,n){const a=mx(u.i,u.x,u.y),d=mx(n.i,n.x,n.y),_=u.next,f=n.prev;return u.next=n,n.prev=u,a.next=_,_.prev=a,d.next=a,a.prev=d,f.next=d,d.prev=f,d}function IS(u,n,a,d){const _=mx(u,n,a);return d?(_.next=d.next,_.prev=d,d.next.prev=_,d.next=_):(_.prev=_,_.next=_),_}function Fg(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function mx(u,n,a){return{i:u,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function sv(u,n){const a=u.length;if(a<=1)return[u];const d=[];let _,f;for(let y=0;y<a;y++){const T=bs(u[y]);T!==0&&(u[y].area=Math.abs(T),f===void 0&&(f=T<0),f===T<0?(_&&d.push(_),_=[u[y]]):_.push(u[y]))}if(_&&d.push(_),n>1)for(let y=0;y<d.length;y++)d[y].length<=n||(Su(d[y],n,1,d[y].length-1,c4),d[y]=d[y].slice(0,n));return d}function c4(u,n){return n.area-u.area}function gx(u,n,a){const d=a.patternDependencies;let _=!1;for(const f of n){const y=f.paint.get(`${u}-pattern`);y.isConstant()||(_=!0);const T=y.constantOr(null);T&&(_=!0,d[T]=!0)}return _}function _x(u,n,a,d,_){const f=_.patternDependencies;for(const y of n){const T=y.paint.get(`${u}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:d},a,{},_.availableImages);C=C&&C.name?C.name:C,f[C]=!0,a.patterns[y.id]=C}}return a}class yx{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new eu,this.indexArray=new Ms,this.indexArray2=new nu,this.programConfigurations=new iu(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new To,this.segments2=new To,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=n.projection}updateFootprints(n,a){}populate(n,a,d,_){this.hasPattern=gx("fill",this.layers,a);const f=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:T,id:C,index:M,sourceLayerIndex:x}of n){const I=this.layers[0]._featureFilter.needGeometry,P=tr(T,I);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),P,d))continue;const A=f?f.evaluate(P,{},d,a.availableImages):void 0,R={id:C,properties:T.properties,type:T.type,sourceLayerIndex:x,index:M,geometry:I?P.geometry:Qt(T,d,_),patterns:{},sortKey:A};y.push(R)}f&&y.sort((T,C)=>T.sortKey-C.sortKey);for(const T of y){const{geometry:C,index:M,sourceLayerIndex:x}=T;if(this.hasPattern){const I=_x("fill",this.layers,T,this.zoom,a);this.patternFeatures.push(I)}else this.addFeature(T,C,M,d,{},a.availableImages,a.brightness);a.featureIndex.insert(n[M].feature,C,M,x,this.index)}}update(n,a,d,_,f){const y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,a,y?this.stateDependentLayers:this.layers,d,_,f)}addFeatures(n,a,d,_,f,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,a,d,_,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Qz),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,d,_,f,y=[],T){for(const C of sv(a,500)){let M=0;for(const D of C)M+=D.length;const x=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),I=x.vertexLength,P=[],A=[];for(const D of C){if(D.length===0)continue;D!==C[0]&&A.push(P.length/2);const N=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),j=N.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(j+D.length-1,j),P.push(D[0].x),P.push(D[0].y);for(let Z=1;Z<D.length;Z++)this.layoutVertexArray.emplaceBack(D[Z].x,D[Z].y),this.indexArray2.emplaceBack(j+Z-1,j+Z),P.push(D[Z].x),P.push(D[Z].y);N.vertexLength+=D.length,N.primitiveLength+=D.length}const R=Bg(P,A);for(let D=0;D<R.length;D+=3)this.indexArray.emplaceBack(I+R[D],I+R[D+1],I+R[D+2]);x.vertexLength+=M,x.primitiveLength+=R.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,f,y,_,T)}}let AS,CS,RS,PS;et(yx,"FillBucket",{omit:["layers","patternFeatures"]});class vx{constructor(n,a,d,_){if(this.triangleCount=a.length/3,this.min=new We(0,0),this.max=new We(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[f,y]=[n[0].clone(),n[0].clone()];for(let I=1;I<n.length;++I){const P=n[I];f.x=Math.min(f.x,P.x),f.y=Math.min(f.y,P.y),y.x=Math.max(y.x,P.x),y.y=Math.max(y.y,P.y)}if(_){const I=Math.ceil(Math.max(y.x-f.x,y.y-f.y)/_);d=Math.max(d,I)}if(d===0)return;this.min=f,this.max=y;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const C=Math.max(T.x,T.y)/d;this.cellsX=Math.max(1,Math.ceil(T.x/C)),this.cellsY=Math.max(1,Math.ceil(T.y/C)),this.xScale=1/C,this.yScale=1/C;const M=[];for(let I=0;I<this.triangleCount;I++){const P=n[a[3*I+0]].sub(this.min),A=n[a[3*I+1]].sub(this.min),R=n[a[3*I+2]].sub(this.min),D=au(Math.floor(Math.min(P.x,A.x,R.x)),this.xScale,this.cellsX),N=au(Math.floor(Math.max(P.x,A.x,R.x)),this.xScale,this.cellsX),j=au(Math.floor(Math.min(P.y,A.y,R.y)),this.yScale,this.cellsY),Z=au(Math.floor(Math.max(P.y,A.y,R.y)),this.yScale,this.cellsY),X=new We(0,0),G=new We(0,0),J=new We(0,0),se=new We(0,0);for(let _e=j;_e<=Z;++_e){X.y=G.y=_e*C,J.y=se.y=(_e+1)*C;for(let Ce=D;Ce<=N;++Ce)X.x=J.x=Ce*C,G.x=se.x=(Ce+1)*C,(bi(P,A,R,X,G,se)||bi(P,A,R,X,se,J))&&M.push({cellIdx:_e*this.cellsX+Ce,triIdx:I})}}if(M.length===0)return;M.sort((I,P)=>I.cellIdx-P.cellIdx||I.triIdx-P.triIdx);let x=0;for(;x<M.length;){const I=M[x].cellIdx,P={start:this.payload.length,len:0};for(;x<M.length&&M[x].cellIdx===I;)++P.len,this.payload.push(M[x++].triIdx);this.cells[I]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,a){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const d=au(n.x-this.min.x,this.xScale,this.cellsX),_=au(n.y-this.min.y,this.yScale,this.cellsY),f=this.cells[_*this.cellsX+d];if(f){this._lazyInitLookup();for(let y=0;y<f.len;y++){const T=this.payload[f.start+y],C=Math.floor(T/8),M=1<<T%8;if(!(this.lookup[C]&M)&&(this.lookup[C]|=M,a.push(T),a.length===this.triangleCount))return}}}query(n,a,d){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>a.x||n.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const _=au(n.x-this.min.x,this.xScale,this.cellsX),f=au(a.x-this.min.x,this.xScale,this.cellsX),y=au(n.y-this.min.y,this.yScale,this.cellsY),T=au(a.y-this.min.y,this.yScale,this.cellsY);for(let C=y;C<=T;C++)for(let M=_;M<=f;M++){const x=this.cells[C*this.cellsX+M];if(x)for(let I=0;I<x.len;I++){const P=this.payload[x.start+I],A=Math.floor(P/8),R=1<<P%8;if(!(this.lookup[A]&R)&&(this.lookup[A]|=R,d.push(P),d.length===this.triangleCount))return}}}}function au(u,n,a){return Math.max(0,Math.min(a-1,Math.floor(u*n)))}et(vx,"TriangleGridIndex");class MS{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(n,a){for(const d of this.footprints)a.push({footprint:d,id:n})}populate(n,a,d,_){const f=[];for(const{feature:y,id:T,index:C,sourceLayerIndex:M}of n){const x=this.layers[0]._featureFilter.needGeometry,I=tr(y,x);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),I,d))continue;const P={id:T,properties:y.properties,type:y.type,sourceLayerIndex:M,index:C,geometry:x?I.geometry:Qt(y,d,_),patterns:{}};f.push(P)}for(const y of f){const{geometry:T,index:C,sourceLayerIndex:M}=y;this.addFeature(y,T,C,d,{},a.availableImages,a.brightness),a.featureIndex.insert(n[C].feature,T,C,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,a,d,_,f){}destroy(){}addFeature(n,a,d,_,f,y=[],T){for(const C of sv(a,2)){const M=[],x=[],I=[],P=new We(1/0,1/0),A=new We(-1/0,-1/0);for(const N of C)if(N.length!==0){N!==C[0]&&I.push(x.length/2);for(let j=0;j<N.length;j++)x.push(N[j].x),x.push(N[j].y),M.push(N[j]),P.x=Math.min(P.x,N[j].x),P.y=Math.min(P.y,N[j].y),A.x=Math.max(A.x,N[j].x),A.y=Math.max(A.y,N[j].y)}const R=Bg(x,I),D=new vx(M,R,8,256);this.footprints.push({vertices:M,indices:R,grid:D,min:P,max:A})}}}et(MS,"ClipBucket",{omit:["layers"]});const u4=Wn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),h4=Wn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),d4=Wn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),f4=Wn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),p4=Wn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),m4=Wn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:g4}=u4;var bx,kS,xx,OS,wx,DS,LS,av={};function BS(){if(kS)return bx;kS=1;var u=$e();function n(_,f,y,T,C){this.properties={},this.extent=y,this.type=0,this._pbf=_,this._geometry=-1,this._keys=T,this._values=C,_.readFields(a,this,f)}function a(_,f,y){_==1?f.id=y.readVarint():_==2?function(T,C){for(var M=T.readVarint()+T.pos;T.pos<M;){var x=C._keys[T.readVarint()],I=C._values[T.readVarint()];C.properties[x]=I}}(y,f):_==3?f.type=y.readVarint():_==4&&(f._geometry=y.pos)}function d(_){for(var f,y,T=0,C=0,M=_.length,x=M-1;C<M;x=C++)T+=((y=_[x]).x-(f=_[C]).x)*(f.y+y.y);return T}return bx=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var _=this._pbf;_.pos=this._geometry;for(var f,y=_.readVarint()+_.pos,T=1,C=0,M=0,x=0,I=[];_.pos<y;){if(C<=0){var P=_.readVarint();T=7&P,C=P>>3}if(C--,T===1||T===2)M+=_.readSVarint(),x+=_.readSVarint(),T===1&&(f&&I.push(f),f=[]),f.push(new u(M,x));else{if(T!==7)throw new Error("unknown command "+T);f&&f.push(f[0].clone())}}return f&&I.push(f),I},n.prototype.bbox=function(){var _=this._pbf;_.pos=this._geometry;for(var f=_.readVarint()+_.pos,y=1,T=0,C=0,M=0,x=1/0,I=-1/0,P=1/0,A=-1/0;_.pos<f;){if(T<=0){var R=_.readVarint();y=7&R,T=R>>3}if(T--,y===1||y===2)(C+=_.readSVarint())<x&&(x=C),C>I&&(I=C),(M+=_.readSVarint())<P&&(P=M),M>A&&(A=M);else if(y!==7)throw new Error("unknown command "+y)}return[x,P,I,A]},n.prototype.toGeoJSON=function(_,f,y){var T,C,M=this.extent*Math.pow(2,y),x=this.extent*_,I=this.extent*f,P=this.loadGeometry(),A=n.types[this.type];function R(j){for(var Z=0;Z<j.length;Z++){var X=j[Z];j[Z]=[360*(X.x+x)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+I)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(T=0;T<P.length;T++)D[T]=P[T][0];R(P=D);break;case 2:for(T=0;T<P.length;T++)R(P[T]);break;case 3:for(P=function(j){var Z=j.length;if(Z<=1)return[j];for(var X,G,J=[],se=0;se<Z;se++){var _e=d(j[se]);_e!==0&&(G===void 0&&(G=_e<0),G===_e<0?(X&&J.push(X),X=[j[se]]):X.push(j[se]))}return X&&J.push(X),J}(P),T=0;T<P.length;T++)for(C=0;C<P[T].length;C++)R(P[T][C])}P.length===1?P=P[0]:A="Multi"+A;var N={type:"Feature",geometry:{type:A,coordinates:P},properties:this.properties};return"id"in this&&(N.id=this.id),N},bx}function zS(){if(OS)return xx;OS=1;var u=BS();function n(d,_){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(a,this,_),this.length=this._features.length}function a(d,_,f){d===15?_.version=f.readVarint():d===1?_.name=f.readString():d===5?_.extent=f.readVarint():d===2?_._features.push(f.pos):d===3?_._keys.push(f.readString()):d===4&&_._values.push(function(y){for(var T=null,C=y.readVarint()+y.pos;y.pos<C;){var M=y.readVarint()>>3;T=M===1?y.readString():M===2?y.readFloat():M===3?y.readDouble():M===4?y.readVarint64():M===5?y.readVarint():M===6?y.readSVarint():M===7?y.readBoolean():null}return T}(f))}return xx=n,n.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var _=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,_,this.extent,this._keys,this._values)},xx}function NS(){return LS||(LS=1,av.VectorTile=function(){if(DS)return wx;DS=1;var u=zS();function n(a,d,_){if(a===3){var f=new u(_,_.readVarint()+_.pos);f.length&&(d[f.name]=f)}}return wx=function(a,d){this.layers=a.readFields(n,{},d)},wx}(),av.VectorTileFeature=BS(),av.VectorTileLayer=zS()),av}var Xp=NS();class Tf extends We{constructor(n,a,d){super(n,a),this.z=d}}class FS extends Tf{constructor(n,a,d,_){super(n,a,d),this.w=_}}function lv(u,n,a,d){const _=[],f=d===0?(y,T,C,M,x,I)=>{y.push(new We(I,C+(I-T)/(M-T)*(x-C)))}:(y,T,C,M,x,I)=>{y.push(new We(T+(I-C)/(x-C)*(M-T),I))};for(const y of u){const T=[];for(const C of y){if(C.length<=2)continue;const M=[];for(let P=0;P<C.length-1;P++){const A=C[P].x,R=C[P].y,D=C[P+1].x,N=C[P+1].y,j=d===0?A:R,Z=d===0?D:N;j<n?Z>n&&f(M,A,R,D,N,n):j>a?Z<a&&f(M,A,R,D,N,a):M.push(C[P]),Z<n&&j>=n&&f(M,A,R,D,N,n),Z>a&&j<=a&&f(M,A,R,D,N,a)}let x=C[C.length-1];const I=d===0?x.x:x.y;I>=n&&I<=a&&M.push(x),M.length&&(x=M[M.length-1],M[0].x===x.x&&M[0].y===x.y||M.push(M[0]),T.push(M))}T.length&&_.push(T)}return _}function VS(u,n,a,d){const _=a==="x"?"y":"x",f=(d-u[a])/(n[a]-u[a]);u[_]=u[_]+(n[_]-u[_])*f,u[a]=d,u.hasOwnProperty("z")&&(u.z=vr(u.z,n.z,f)),u.hasOwnProperty("w")&&(u.w=vr(u.w,n.w,f))}function US(u,n,a,d){const _=a,f=d;for(const y of["x","y"]){let T=u,C=n;T[y]>=C[y]&&(T=n,C=u),T[y]<_&&C[y]>_&&VS(T,C,y,_),T[y]<f&&C[y]>f&&VS(C,T,y,f)}}const cv=Number.MAX_SAFE_INTEGER;function jS(u,n,a,d){return u.order<n||u.order===cv||!(u.clipMask&a)||function(_,f){return f.length!==0&&f.find(y=>y===_)===void 0}(d,u.clipScope)}function uv(u,n){return u.x-n.x||u.y-n.y}function $S(u,n){return uv(u.min,n.min)===0&&uv(u.max,n.max)===0}function Tx(u,n){return!(u.min.x>n.max.x||u.max.x<n.min.x||u.min.y>n.max.y||u.max.y<n.min.y)}function Ex(u,n){if(u.length!==n.length)return!1;for(let a=0;a<u.length;a++)if(u[a].sourceId!==n[a].sourceId||!$S(u[a],n[a])||u[a].order!==n[a].order||u[a].clipMask!==n[a].clipMask||!zt(u[a].clipScope,n[a].clipScope))return!1;return!0}function GS(u,n,a){const d=1/fr,_=1/(1<<a.canonical.z),f=(n.x*d+a.canonical.x)*_+a.wrap,y=(n.y*d+a.canonical.y)*_;return{min:new We((u.x*d+a.canonical.x)*_+a.wrap,(u.y*d+a.canonical.y)*_),max:new We(f,y)}}function _4(u,n,a){const d=1<<a.canonical.z,_=((n.x-a.wrap)*d-a.canonical.x)*fr,f=(n.y*d-a.canonical.y)*fr;return{min:new We(((u.x-a.wrap)*d-a.canonical.x)*fr,(u.y*d-a.canonical.y)*fr),max:new We(_,f)}}function qS(u,n,a,d,_,f,y){const T=u.indices,C=u.vertices,M=[];for(let x=d;x<d+_;x+=3){const I=n[a[x+0]+f],P=n[a[x+1]+f],A=n[a[x+2]+f],R=Math.min(I.x,P.x,A.x),D=Math.max(I.x,P.x,A.x),N=Math.min(I.y,P.y,A.y),j=Math.max(I.y,P.y,A.y);M.length=0,u.grid.query(new We(R,N),new We(D,j),M);for(let Z=0;Z<M.length;Z++){const X=M[Z];if(bi(C[T[3*X+0]],C[T[3*X+1]],C[T[3*X+2]],I,P,A,y))return!0}}return!1}function HS(u,n,a,d){if(!u||!a)return!1;let _=u.vertices;if(!n.canonical.equals(d.canonical)||n.wrap!==d.wrap){if(a.vertices.length<u.vertices.length)return HS(a,d,u,n);const f=n.canonical,y=d.canonical,T=Math.pow(2,y.z-f.z);_=u.vertices.map(C=>new We((C.x+f.x*fr)*T-y.x*fr,(C.y+f.y*fr)*T-y.y*fr))}return qS(a,_,u.indices,0,u.indices.length,0,0)}function WS(u,n,a,d){const _=Math.pow(2,d.z-a.z);return new We((u+a.x*fr)*_-d.x*fr,(n+a.y*fr)*_-d.y*fr)}function ZS(u,n){const a=[];n.grid.queryPoint(u,a);const d=n.indices,_=n.vertices;for(let f=0;f<a.length;f++){const y=a[f];if(Hi([_[d[3*y+0]],_[d[3*y+1]],_[d[3*y+2]]],u))return!0}return!1}const Sx=[new We(0,0),new We(fr,0),new We(fr,fr),new We(0,fr)];function KS(u,n){const a=[];let d=[];if(!n||u.length<2)return[u];if(u.length===2)return Fo(u[0],u[1],Sx)?[u]:[];for(let _=0;_<u.length+2;_++){const f=u[_%u.length],y=u[(_+1)%u.length],T=Fo(_===0?u[u.length-1]:u[(_-1)%u.length],f,Sx),C=Fo(f,y,Sx),M=T||C;M&&d.push(f),M&&C||d.length>0&&(d.length>1&&a.push(d),d=[])}return d.length>1&&a.push(d),a}const Ix=Xp.VectorTileFeature.types,y4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],v4=["fill-extrusion-flood-light-ground-radius"],b4=Math.pow(2,13),x4=Math.pow(2,15)-1,XS=new We(0,1),ed=2147483648;function Vg(u,n,a,d,_,f,y,T){u.emplaceBack((n<<1)+y,(a<<1)+f,(Math.floor(d*b4)<<1)+_,Math.round(T))}function Ug(u,n,a){u.emplaceBack(n.x*fr,n.y*fr,a?1:0)}function hv(u,n,a,d,_,f){u.emplaceBack(n.x,n.y,(a.x<<1)+d,(a.y<<1)+_,f)}function jg(u,n,a){u.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class YS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class JS{constructor(){this.centroidXY=new We(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new We(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new We(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new We(this.max.x-this.min.x,this.max.y-this.min.y)}}class QS{constructor(){this.acc=new We(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,a){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=a.x,n.min.y=n.max.y=a.y)}appendEdge(n,a,d){this.accCount++,this.acc._add(a);let _=!!this.borders;a.x<n.min.x?(n.min.x=a.x,_=!0):a.x>n.max.x&&(n.max.x=a.x,_=!0),a.y<n.min.y?(n.min.y=a.y,_=!0):a.y>n.max.y&&(n.max.y=a.y,_=!0),((a.x===0||a.x===fr)&&a.x===d.x)!=((a.y===0||a.y===fr)&&a.y===d.y)&&this.processBorderOverlap(a,d),_&&this.checkBorderIntersection(a,d)}checkBorderIntersection(n,a){a.x<0!=n.x<0&&this.addBorderIntersection(0,vr(a.y,n.y,(0-a.x)/(n.x-a.x))),a.x>fr!=n.x>fr&&this.addBorderIntersection(1,vr(a.y,n.y,(fr-a.x)/(n.x-a.x))),a.y<0!=n.y<0&&this.addBorderIntersection(2,vr(a.x,n.x,(0-a.y)/(n.y-a.y))),a.y>fr!=n.y>fr&&this.addBorderIntersection(3,vr(a.x,n.x,(fr-a.y)/(n.y-a.y)))}addBorderIntersection(n,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[n];a<d[0]&&(d[0]=a),a>d[1]&&(d[1]=a)}processBorderOverlap(n,a){if(n.x===a.x){if(n.y===a.y)return;const d=n.x===0?0:1;this.addBorderIntersection(d,a.y),this.addBorderIntersection(d,n.y)}else{const d=n.y===0?2:3;this.addBorderIntersection(d,a.x),this.addBorderIntersection(d,n.x)}}centroid(){return this.accCount===0?new We(0,0):new We(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,a)=>n+ +(a[0]!==Number.MAX_VALUE),0):0}}function eI(u,n){const a=u.add(n)._unit(),d=nr(u.x*a.x+u.y*a.y,-1,1);var _,f,y;return y=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(y)))/4*x4*((_=u).x*(f=n).y-_.y*f.x<0?-1:1)}const w4=[u=>u.x<0,u=>u.x>fr,u=>u.y<0,u=>u.y>fr];function T4(u,n,a,d){const _=[4];if(d===0)return _;a._mult(d);const f=u.sub(a),y=n.sub(a),T=[u,n,f,y];for(let C=0;C<4;C++)for(const M of T)if(w4[C](M)){_.push(C);break}return _}class tI{constructor(n){this.vertexArray=new Fp,this.indexArray=new Ms,this.programConfigurations=new iu(n.layers,{zoom:n.zoom,lut:n.lut},a=>v4.includes(a)),this._segments=new To,this.hiddenByLandmarkVertexArray=new $p,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new To}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,a,d,_=!1){const f=n.length;if(f>2){let y=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let C;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const M=n[0],x=n[1];C=eI(M.sub(n[f-1])._perp()._unit(),x.sub(M)._perp()._unit())}for(let M=0;M<f;M++){const x=M===f-1?0:M+1,I=n[M],P=n[x],A=n[x===f-1?0:x+1],R=P.sub(I)._perp()._unit(),D=eI(R,A.sub(P)._perp()._unit()),N=C,j=D;if(Ax(I,P,a)||_&&iI(I,a)&&iI(P,a)){C=D;continue}const Z=T.vertexLength;hv(this.vertexArray,I,P,1,1,N),hv(this.vertexArray,I,P,1,0,N),hv(this.vertexArray,I,P,0,1,j),hv(this.vertexArray,I,P,0,0,j),T.vertexLength+=4;const X=T4(I,P,R,d);for(const G of X)this._segmentToGroundQuads[y].push({id:Z,region:G}),this._segmentToRegionTriCounts[y][G]+=2,T.primitiveLength+=2;C=D}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),a=n.length;for(let d=0;d<a;d++)this._segmentToGroundQuads[d].sort((_,f)=>_.region-f.region);for(let d=0;d<a;d++){const _=this._segmentToGroundQuads[d],f=n[d],y=this._segmentToRegionTriCounts[d];y.reduce((C,M)=>C+M,0);let T=0;for(let C=0;C<=4;C++){const M=y[C];if(M!==0){let x=this.regionSegments[C];x||(x=this.regionSegments[C]=new To);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+T,vertexLength:f.vertexLength,primitiveLength:M};x.get().push(I)}T+=M}for(let C=0;C<_.length;C++){const M=_[C].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,a,d,_,f,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,a,d,_,f,y)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,h4.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,a,d,_,f,y){this.hasData()&&this.programConfigurations.updatePaintArrays(n,a,d,_,f,y)}updateHiddenByLandmark(n){if(!this.hasData())return;const a=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const d=n.flags&ed?1:0;for(let _=n.groundVertexArrayOffset;_<a;++_)this.hiddenByLandmarkVertexArray.emplace(_,d);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,p4.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const a=this.regionSegments[n];a&&a.destroy()}}}}class dv{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Ms,this.footprintVertices=new eu,this.footprintSegments=[],this.layoutVertexArray=new tu,this.centroidVertexArray=new Wy,this.wallVertexArray=new Rg,this.indexArray=new Ms,this.programConfigurations=new iu(n.layers,{zoom:n.zoom,lut:n.lut},a=>y4.includes(a)),this.segments=new To,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new tI(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,a){}populate(n,a,d,_){this.features=[],this.hasPattern=gx("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ye(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:y,index:T,sourceLayerIndex:C}of n){const M=this.layers[0]._featureFilter.needGeometry,x=tr(f,M);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),x,d))continue;const I={id:y,sourceLayerIndex:C,index:T,geometry:M?x.geometry:Qt(f,d,_),properties:f.properties,type:f.type,patterns:{}},P=this.layoutVertexArray.length,A=Ix[I.type]==="Polygon";if(this.hasPattern)this.features.push(_x("fill-extrusion",this.layers,I,this.zoom,a));else if(this.wallMode)for(const R of I.geometry)for(const D of KS(R,A))this.addFeature(I,[D],T,d,{},a.availableImages,_,a.brightness);else this.addFeature(I,I.geometry,T,d,{},a.availableImages,_,a.brightness);a.featureIndex.insert(f,I.geometry,T,C,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,a,d,_,f,y){for(const T of this.features){const C=Ix[T.type]==="Polygon",{geometry:M}=T;if(this.wallMode)for(const x of M)for(const I of KS(x,C))this.addFeature(T,[I],T.index,a,d,_,f,y);else this.addFeature(T,M,T.index,a,d,_,f,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,a,d,_,f){const y=Object.keys(n).length!==0;if(y&&!this.stateDependentLayers.length)return;const T=y?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,a,T,d,_,f),this.groundEffect.update(n,a,T,d,_,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,g4),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,f4.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,m4.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,d4.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,d,_,f,y,T,C){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,x=[new We(0,0),new We(fr,fr)],I=T.projection,P=I.name==="globe",A=this.wallMode||Ix[n.type]==="Polygon",R=new QS;R.centroidDataIndex=this.centroidData.length;const D=new JS,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},_)<=0,j=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},_);let Z;if(D.height=j,D.vertexArrayOffset=this.layoutVertexArray.length,D.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vp),this.wallMode){if(P)return void en("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;Z=function(Ee){const Ve=Ee[0].x===Ee[Ee.length-1].x&&Ee[0].y===Ee[Ee.length-1].y;(function(er){let qt=0;const Vr=er.length;for(let xr=0;xr<Vr;xr++)qt+=(er[(xr+1)%Vr].x-er[xr].x)*(er[(xr+1)%Vr].y+er[xr].y);return qt>=0})(Ee)||(Ee=Ee.reverse());const qe={geometry:[],joinNormals:[],indices:[]},Qe=[],nt=[],ot=[];let lt=Ee.length;if(lt<(Ve?3:2))return qe;for(;lt>=2&&Ee[lt-1].equals(Ee[lt-2]);)lt--;let yt,ut,Mt,Vt,Tt,wr=0;for(;wr<lt-1&&Ee[wr].equals(Ee[wr+1]);)wr++;Ve&&(yt=Ee[lt-2],Tt=Ee[wr].sub(yt)._unit()._perp());for(let er=wr;er<lt;er++){if(Mt=er===lt-1?Ve?Ee[wr+1]:void 0:Ee[er+1],Mt&&Ee[er].equals(Mt))continue;Tt&&(Vt=Tt),yt&&(ut=yt),yt=Ee[er],Tt=Mt?Mt.sub(yt)._unit()._perp():Vt,Vt=Vt||Tt;let qt=Vt.add(Tt);qt.x===0&&qt.y===0||qt._unit();const Vr=qt.x*Tt.x+qt.y*Tt.y,xr=Vr!==0?1/Vr:1/0,Ir=Vt.x*Tt.y-Vt.y*Tt.x>0;let tn="miter";const gn=2;tn==="miter"&&xr>gn&&(tn="bevel"),tn==="bevel"&&(xr>100&&(tn="flipbevel"),xr<gn&&(tn="miter"));const un=(hn,xn,wn,Ei)=>{const ui=new We(hn.x,hn.y),rn=new We(hn.x,hn.y);ui.x+=xn.x*Ei,ui.y+=xn.y*Ei,rn.x-=xn.x*Math.max(wn,1),rn.y-=xn.y*Math.max(wn,1),ot.push(xn),Qe.push(ui),nt.push(rn)};if(tn==="miter")qt._mult(xr),un(yt,qt,0,0);else if(tn==="flipbevel")qt=Tt.mult(-1),un(yt,qt,0,0),un(yt,qt.mult(-1),0,0);else{const hn=-Math.sqrt(xr*xr-1),xn=Ir?hn:0,wn=Ir?0:hn;ut&&un(yt,Vt,xn,wn),Mt&&un(yt,Tt,xn,wn)}}qe.geometry=[...Qe,...nt.reverse(),Qe[0]],qe.joinNormals=[...ot,...ot.reverse(),ot[ot.length-1]];const dr=qe.geometry.length-1;for(let er=0;er<dr/2;er++)if(er+1<dr/2){let qt=er,Vr=er+1,xr=dr-1-er,Ir=dr-2-er;qt=qt===0?dr-1:qt-1,Vr=Vr===0?dr-1:Vr-1,xr=xr===0?dr-1:xr-1,Ir=Ir===0?dr-1:Ir-1,qe.indices.push(xr),qe.indices.push(Vr),qe.indices.push(qt),qe.indices.push(xr),qe.indices.push(Ir),qe.indices.push(Vr)}return qe}(a[0]),a=[Z.geometry]}const X=(Ee,Ve)=>Ee<(Ve.length-1)/2||Ee===Ve.length-1,G=this.wallMode?[a]:sv(a,500);for(let Ee=G.length-1;Ee>=0;Ee--){const Ve=G[Ee];(Ve.length===0||(J=Ve[0]).every(De=>De.x<=0)||J.every(De=>De.x>=fr)||J.every(De=>De.y<=0)||J.every(De=>De.y>=fr))&&G.splice(Ee,1)}var J;let se;if(P)se=lI(G,x,_);else{se=[];for(const Ee of G)se.push({polygon:Ee,bounds:x})}const _e=A?this.edgeRadius:0,Ce=_e>0&&this.zoom<17,Pe=(Ee,Ve)=>{if(Ee.length===0)return!1;const De=Ee[Ee.length-1];return Ve.x===De.x&&Ve.y===De.y};for(const{polygon:Ee,bounds:Ve}of se){let De=0,qe=0;for(const lt of Ee)A&&!lt[0].equals(lt[lt.length-1])&&lt.push(lt[0]),qe+=A?lt.length-1:lt.length;const Qe=this.segments.prepareSegment((A?5:4)*qe,this.layoutVertexArray,this.indexArray);D.footprintSegIdx<0&&(D.footprintSegIdx=this.footprintSegments.length),D.polygonSegIdx<0&&(D.polygonSegIdx=this.polygonSegments.length);const nt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ot=new YS;if(ot.vertexOffset=this.footprintVertices.length,ot.indexOffset=3*this.footprintIndices.length,ot.ringIndices=[],A){const lt=[],yt=[];De=Qe.vertexLength;for(let Mt=0;Mt<Ee.length;Mt++){const Vt=Ee[Mt];Vt.length&&Mt!==0&&yt.push(lt.length/2);const Tt=[];let wr,dr;wr=Vt[1].sub(Vt[0])._perp()._unit(),ot.ringIndices.push(Vt.length-1);for(let er=1;er<Vt.length;er++){const qt=Vt[er],Vr=Vt[er===Vt.length-1?1:er+1],xr=qt.clone();if(_e){dr=Vr.sub(qt)._perp()._unit();const Ir=wr.add(dr)._unit(),tn=_e*Math.min(4,1/(wr.x*Ir.x+wr.y*Ir.y));xr.x+=tn*Ir.x,xr.y+=tn*Ir.y,xr.x=Math.round(xr.x),xr.y=Math.round(xr.y),wr=dr}if(!N||_e!==0&&!Ce||Pe(Tt,xr)||Tt.push(xr),Vg(this.layoutVertexArray,xr.x,xr.y,0,0,1,1,0),this.wallMode){const Ir=X(er,Vt);Ug(this.wallVertexArray,Z.joinNormals[er],!Ir)}Qe.vertexLength++,this.footprintVertices.emplaceBack(qt.x,qt.y),lt.push(qt.x,qt.y),P&&jg(this.layoutVertexExtArray,I.projectTilePoint(xr.x,xr.y,_),I.upVector(_,xr.x,xr.y))}N&&(_e===0||Ce)&&(Tt.length!==0&&Pe(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,Ve,M))}const ut=this.wallMode?Z.indices:Bg(lt,yt);for(let Mt=0;Mt<ut.length;Mt+=3)this.footprintIndices.emplaceBack(ot.vertexOffset+ut[Mt+0],ot.vertexOffset+ut[Mt+1],ot.vertexOffset+ut[Mt+2]),this.indexArray.emplaceBack(De+ut[Mt],De+ut[Mt+2],De+ut[Mt+1]),Qe.primitiveLength++;ot.indexCount+=ut.length,ot.vertexCount+=this.footprintVertices.length-ot.vertexOffset}for(let lt=0;lt<Ee.length;lt++){const yt=Ee[lt];R.startRing(D,yt[0]);let ut=yt.length>4&&oI(yt[yt.length-2],yt[0],yt[1]),Mt=_e?E4(yt[yt.length-2],yt[0],yt[1],_e):0;const Vt=[];let Tt,wr,dr;wr=yt[1].sub(yt[0])._perp()._unit();let er=!0;for(let qt=1,Vr=0;qt<yt.length;qt++){let xr=yt[qt-1],Ir=yt[qt];const tn=yt[qt===yt.length-1?1:qt+1];if(R.appendEdge(D,Ir,xr),Ax(Ir,xr,Ve)){_e&&(wr=tn.sub(Ir)._perp()._unit(),er=!er);continue}const gn=Ir.sub(xr)._perp(),un=gn.x/(Math.abs(gn.x)+Math.abs(gn.y)),hn=gn.y>0?1:0,xn=xr.dist(Ir);if(Vr+xn>32768&&(Vr=0),_e){dr=tn.sub(Ir)._perp()._unit();let rn=nI(xr,Ir,tn,rI(wr,dr),_e);isNaN(rn)&&(rn=0);const ri=Ir.sub(xr)._unit();xr=xr.add(ri.mult(Mt))._round(),Ir=Ir.add(ri.mult(-rn))._round(),Mt=rn,wr=dr,N&&this.zoom>=17&&(Pe(Vt,xr)||Vt.push(xr),Pe(Vt,Ir)||Vt.push(Ir))}const wn=Qe.vertexLength,Ei=yt.length>4&&oI(xr,Ir,tn);let ui=sI(Vr,ut,er);if(Vg(this.layoutVertexArray,xr.x,xr.y,un,hn,0,0,ui),Vg(this.layoutVertexArray,xr.x,xr.y,un,hn,0,1,ui),this.wallMode){const rn=X(qt-1,yt),ri=Z.joinNormals[qt-1];Ug(this.wallVertexArray,ri,rn),Ug(this.wallVertexArray,ri,rn)}if(Vr+=xn,ui=sI(Vr,Ei,!er),ut=Ei,Vg(this.layoutVertexArray,Ir.x,Ir.y,un,hn,0,0,ui),Vg(this.layoutVertexArray,Ir.x,Ir.y,un,hn,0,1,ui),this.wallMode){const rn=X(qt,yt),ri=Z.joinNormals[qt];Ug(this.wallVertexArray,ri,rn),Ug(this.wallVertexArray,ri,rn)}if(Qe.vertexLength+=4,this.indexArray.emplaceBack(wn+0,wn+1,wn+2),this.indexArray.emplaceBack(wn+1,wn+3,wn+2),Qe.primitiveLength+=2,_e){const rn=De+(qt===1?yt.length-2:qt-2),ri=qt===1?De:rn+1;if(this.indexArray.emplaceBack(wn+1,rn,wn+3),this.indexArray.emplaceBack(rn,ri,wn+3),Qe.primitiveLength+=2,Tt===void 0&&(Tt=wn),!Ax(tn,yt[qt],Ve)){const oi=qt===yt.length-1?Tt:Qe.vertexLength;this.indexArray.emplaceBack(wn+2,wn+3,oi),this.indexArray.emplaceBack(wn+3,oi+1,oi),this.indexArray.emplaceBack(wn+3,ri,oi+1),Qe.primitiveLength+=3}er=!er}if(P){const rn=this.layoutVertexExtArray,ri=I.projectTilePoint(xr.x,xr.y,_),oi=I.projectTilePoint(Ir.x,Ir.y,_),Wi=I.upVector(_,xr.x,xr.y),Mo=I.upVector(_,Ir.x,Ir.y);jg(rn,ri,Wi),jg(rn,ri,Wi),jg(rn,oi,Mo),jg(rn,oi,Mo)}}A&&(De+=yt.length-1),N&&_e&&this.zoom>=17&&(Vt.length!==0&&Pe(Vt,Vt[0])&&Vt.pop(),this.groundEffect.addData(Vt,Ve,M,_e>0))}this.footprintSegments.push(ot),nt.triangleCount=this.indexArray.length-nt.triangleArrayOffset,this.polygonSegments.push(nt),++D.footprintSegLen,++D.polygonSegLen}if(D.vertexCount=this.layoutVertexArray.length-D.vertexArrayOffset,D.groundVertexCount=this.groundEffect.vertexArray.length-D.groundVertexArrayOffset,D.vertexCount!==0){if(D.centroidXY=R.borders?XS:this.encodeCentroid(R,D),this.centroidData.push(D),R.borders){this.featuresOnBorder.push(R);const Ee=this.featuresOnBorder.length-1;for(let Ve=0;Ve<R.borders.length;Ve++)R.borders[Ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ve].push(Ee)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,f,y,_,C),this.groundEffect.addPaintPropertiesData(n,d,f,y,_,C),this.maxHeight=Math.max(this.maxHeight,j)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((a,d)=>this.featuresOnBorder[a].borders[n][0]-this.featuresOnBorder[d].borders[n][0])}splitToSubtiles(){const n=[];for(let T=0;T<this.centroidData.length;T++){const C=this.centroidData[T],M=+(C.min.y+C.max.y>fr),x=2*M+(+(C.min.x+C.max.x>fr)^M);for(let I=0;I<C.polygonSegLen;I++){const P=C.polygonSegIdx+I;n.push({centroidIdx:T,subtile:x,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const a=new Ms;n.sort((T,C)=>T.triangleSegmentIdx===C.triangleSegmentIdx?T.subtile-C.subtile:T.triangleSegmentIdx-C.triangleSegmentIdx);let d=0,_=0,f=0;for(const T of n){if(T.triangleSegmentIdx!==d)break;f++}const y=n.length;for(;_!==n.length;){d=n[_].triangleSegmentIdx;let T=0,C=_,M=_;for(let x=C;x<f&&n[x].subtile===T;x++)M++;for(;C!==f;){const x=n[C];T=x.subtile;const I=this.centroidData[x.centroidIdx].min.clone(),P=this.centroidData[x.centroidIdx].max.clone(),A={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=C;R<M;R++){const D=n[R],N=this.polygonSegments[D.polygonSegmentIdx],j=this.centroidData[D.centroidIdx].min,Z=this.centroidData[D.centroidIdx].max,X=this.indexArray.uint16;for(let G=N.triangleArrayOffset;G<N.triangleArrayOffset+N.triangleCount;G++)a.emplaceBack(X[3*G],X[3*G+1],X[3*G+2]);A.primitiveLength+=N.triangleCount,I.x=Math.min(I.x,j.x),I.y=Math.min(I.y,j.y),P.x=Math.max(P.x,Z.x),P.y=Math.max(P.y,Z.y)}A.primitiveLength>0&&this.triangleSubSegments.push({segment:A,min:I,max:P}),C=M;for(let R=C;R<f&&n[R].subtile===n[C].subtile;R++)M++}_=f;for(let x=_;x<y&&n[x].triangleSegmentIdx===n[_].triangleSegmentIdx;x++)f++}a._trim(),this.indexArray=a}getVisibleSegments(n,a,d){const _=new To;if(this.wallMode){for(const D of this.triangleSubSegments)_.segments.push(D.segment);return _}let f=0,y=0;const T=1<<n.canonical.z;if(a){const D=a.getMinMaxForTile(n);D&&(f=D.min,y=D.max)}y+=this.maxHeight;const C=n.toUnwrapped();let M;const x=[C.canonical.x/T+C.wrap,C.canonical.y/T],I=[(C.canonical.x+1)/T+C.wrap,(C.canonical.y+1)/T],P=(D,N,j)=>[D[0]*(1-j[0])+N[0]*j[0],D[1]*(1-j[1])+N[1]*j[1]],A=[],R=[];for(const D of this.triangleSubSegments){A[0]=D.min.x/fr,A[1]=D.min.y/fr,R[0]=D.max.x/fr,R[1]=D.max.y/fr;const N=P(x,I,A),j=P(x,I,R);if(new Fi([N[0],N[1],f],[j[0],j[1],y]).intersectsPrecise(d)===0){M&&(_.segments.push(M),M=void 0);continue}const Z=D.segment;M&&M.vertexOffset!==Z.vertexOffset&&(_.segments.push(M),M=void 0),M?(M.vertexLength+=Z.vertexLength,M.primitiveLength+=Z.primitiveLength):M={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&_.segments.push(M),_}encodeCentroid(n,a){const d=n.centroid(),_=a.span(),f=Math.min(7,Math.round(_.x*this.tileToMeter/10)),y=Math.min(7,Math.round(_.y*this.tileToMeter/10));return new We(nr(d.x,1,fr-1)<<3|f,nr(d.y,1,fr-1)<<3|y)}encodeBorderCentroid(n){if(!n.borders)return new We(0,0);const a=n.borders,d=Number.MAX_VALUE;if(a[0][0]!==d||a[1][0]!==d){const _=a[0][0]!==d?0:1;return new We(6|(a[0][0]!==d?0:65528),(a[_][0]+a[_][1])/2<<3|6)}{const _=a[2][0]!==d?2:3;return new We((a[_][0]+a[_][1])/2<<3|6,6|(a[2][0]!==d?0:65528))}}showCentroid(n){const a=this.centroidData[n.centroidDataIndex];a.flags&=ed,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const a=n.vertexArrayOffset,d=n.vertexCount+n.vertexArrayOffset,_=n.flags&ed?XS:n.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==_.y||f!==_.x){for(let y=a;y<d;++y)this.centroidVertexArray.emplace(y,_.x,_.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(n.toUnwrapped());if(Ex(this.activeReplacements,_))return;if(this.activeReplacements=_,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const f=[];for(const y of this.activeReplacements){if(y.order<d)continue;const T=Math.pow(2,y.footprintTileId.canonical.z-n.canonical.z);for(const C of this.centroidData)if(!(C.flags&ed||y.min.x>C.max.x||C.min.x>y.max.x||y.min.y>C.max.y||C.min.y>y.max.y))for(let M=0;M<C.footprintSegLen;M++){const x=this.footprintSegments[C.footprintSegIdx+M];if(f.length=0,S4(this.footprintVertices,x.vertexOffset,x.vertexCount,y.footprintTileId.canonical,n.canonical,f),qS(y.footprint,f,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-T)){C.flags|=ed;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,a,d){let _=!1;for(let f=0;f<d.footprintSegLen;f++){const y=this.footprintSegments[d.footprintSegIdx+f];let T=0;for(const C of y.ringIndices){for(let M=T,x=C+T-1;M<C+T;x=M++){const I=this.footprintVertices.int16[2*(M+y.vertexOffset)+0],P=this.footprintVertices.int16[2*(M+y.vertexOffset)+1],A=this.footprintVertices.int16[2*(x+y.vertexOffset)+1];P>a!=A>a&&n<(this.footprintVertices.int16[2*(x+y.vertexOffset)+0]-I)*(a-P)/(A-P)+I&&(_=!_)}T=C}}return _}getHeightAtTileCoord(n,a){let d=Number.NEGATIVE_INFINITY,_=!0;const f=4*(n+fr)*fr+(a+fr);if(this.partLookup.hasOwnProperty(f)){const y=this.partLookup[f];return y?{height:y.height,hidden:!!(y.flags&ed)}:void 0}for(const y of this.centroidData)n>y.max.x||y.min.x>n||a>y.max.y||y.min.y>a||this.footprintContainsPoint(n,a,y)&&y&&y.height>d&&(d=y.height,this.partLookup[f]=y,_=!!(y.flags&ed));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:_};this.partLookup[f]=void 0}}function rI(u,n){const a=u.add(n)._unit();return u.x*a.x+u.y*a.y}function E4(u,n,a,d){const _=n.sub(u)._perp()._unit(),f=a.sub(n)._perp()._unit();return nI(u,n,a,rI(_,f),d)}function nI(u,n,a,d,_){const f=Math.sqrt(1-d*d);return Math.min(u.dist(n)/3,n.dist(a)/3,_*f/d)}function Ax(u,n,a){return u.x<a[0].x&&n.x<a[0].x||u.x>a[1].x&&n.x>a[1].x||u.y<a[0].y&&n.y<a[0].y||u.y>a[1].y&&n.y>a[1].y}function iI(u,n){return u.x<n[0].x||u.x>n[1].x||u.y<n[0].y||u.y>n[1].y}function oI(u,n,a){if(u.x<0||u.x>=fr||n.x<0||n.x>=fr||a.x<0||a.x>=fr)return!1;const d=a.sub(n),_=d.perp(),f=u.sub(n);return(d.x*f.x+d.y*f.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(f.x*f.x+f.y*f.y))>-.866&&_.x*f.x+_.y*f.y<0}function sI(u,n,a){const d=n?2|u:-3&u;return a?1|d:-2&d}function aI(){const u=Math.PI/32,n=Math.tan(u),a=q;return a*Math.sqrt(1+2*n*n)-a}function lI(u,n,a){const d=1<<a.z,_=Be(a.x/d),f=Be((a.x+1)/d),y=Le(a.y/d),T=Le((a.y+1)/d);return function(C,M,x,I,P=0,A){const R=[];if(!C.length||!x||!I)return R;const D=(se,_e)=>{for(const Ce of se)R.push({polygon:Ce,bounds:_e})},N=Math.ceil(Math.log2(x)),j=Math.ceil(Math.log2(I)),Z=N-j,X=[];for(let se=0;se<Math.abs(Z);se++)X.push(Z>0?0:1);for(let se=0;se<Math.min(N,j);se++)X.push(0),X.push(1);let G=C;if(G=lv(G,M[0].y-P,M[1].y+P,1),G=lv(G,M[0].x-P,M[1].x+P,0),!G.length)return R;const J=[];for(X.length?J.push({polygons:G,bounds:M,depth:0}):D(G,M);J.length;){const se=J.pop(),_e=se.depth,Ce=X[_e],Pe=se.bounds[0],Ee=se.bounds[1],Ve=Ce===0?Pe.x:Pe.y,De=Ce===0?Ee.x:Ee.y,qe=A?A(Ce,Ve,De):.5*(Ve+De),Qe=lv(se.polygons,Ve-P,qe+P,Ce),nt=lv(se.polygons,qe-P,De+P,Ce);if(Qe.length){const ot=[Pe,new We(Ce===0?qe:Ee.x,Ce===1?qe:Ee.y)];X.length>_e+1?J.push({polygons:Qe,bounds:ot,depth:_e+1}):D(Qe,ot)}if(nt.length){const ot=[new We(Ce===0?qe:Pe.x,Ce===1?qe:Pe.y),Ee];X.length>_e+1?J.push({polygons:nt,bounds:ot,depth:_e+1}):D(nt,ot)}}return R}(u,n,Math.ceil((f-_)/11.25),Math.ceil((y-T)/11.25),1,(C,M,x)=>{if(C===0)return .5*(M+x);{const I=Le((a.y+M/fr)/d);return(Oe(.5*(Le((a.y+x/fr)/d)+I))*d-a.y)*fr}})}function S4(u,n,a,d,_,f){const y=Math.pow(2,d.z-_.z);for(let T=0;T<a;T++){let C=u.int16[2*(T+n)+0],M=u.int16[2*(T+n)+1];C=(C+_.x*fr)*y-d.x*fr,M=(M+_.y*fr)*y-d.y*fr,f.push(new We(C,M))}}let cI,uI;function $g(u,n){return u.x*n.x+u.y*n.y}function hI(u,n){if(u.length===1){let a=0;const d=n[a++];let _;for(;!_||d.equals(_);)if(_=n[a++],!_)return 1/0;for(;a<n.length;a++){const f=n[a],y=u[0],T=_.sub(d),C=f.sub(d),M=y.sub(d),x=$g(T,T),I=$g(T,C),P=$g(C,C),A=$g(M,T),R=$g(M,C),D=x*P-I*I,N=(P*A-I*R)/D,j=(x*R-I*A)/D,Z=d.z*(1-N-j)+_.z*N+f.z*j;if(isFinite(Z))return Z}return 1/0}{let a=1/0;for(const d of n)a=Math.min(a,d.z);return a}}function dI(u,n,a,d,_,f,y,T){const C=y*_.getElevationAt(u,n,!0,!0),M=f[0]!==0,x=M?f[1]===0?y*(f[0]/7-450):y*function(I,P,A){const R=Math.floor(P[0]/8),D=Math.floor(P[1]/8),N=10*(P[0]-8*R),j=10*(P[1]-8*D),Z=I.getElevationAt(R,D,!0,!0),X=I.getMeterToDEM(A),G=Math.floor(.5*(N*X-1)),J=Math.floor(.5*(j*X-1)),se=I.tileCoordToPixel(R,D),_e=2*G+1,Ce=2*J+1,Pe=function(nt,ot,lt,yt,ut){return[nt.getElevationAtPixel(ot,lt,!0),nt.getElevationAtPixel(ot+ut,lt,!0),nt.getElevationAtPixel(ot,lt+ut,!0),nt.getElevationAtPixel(ot+yt,lt+ut,!0)]}(I,se.x-G,se.y-J,_e,Ce),Ee=Math.abs(Pe[0]-Pe[1]),Ve=Math.abs(Pe[2]-Pe[3]),De=Math.abs(Pe[0]-Pe[2])+Math.abs(Pe[1]-Pe[3]),qe=Math.min(.25,.5*X*(Ee+Ve)/_e),Qe=Math.min(.25,.5*X*De/Ce);return Z+Math.max(qe*N,Qe*j)}(_,f,T):C;return{base:C+(a===0)?-1:a,top:M?Math.max(x+d,C+a+2):C+d}}et(dv,"FillExtrusionBucket",{omit:["layers","features"]}),et(JS,"PartData"),et(YS,"FootprintSegment"),et(QS,"BorderCentroidData"),et(tI,"GroundEffect");const I4=Wn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),A4=Wn([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:C4}=I4,R4=Wn([{name:"a_packed",components:4,type:"Float32"}]),{members:P4}=R4,M4=Wn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:k4}=M4;class fI{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.image=new Qh({width:n,height:a}),this.positions={},this.uploaded=!1}getDash(n,a){const d=this.getKey(n,a);return this.positions[d]}trim(){const n=this.width,a=this.height=ho(this.nextRow);this.image.resize({width:n,height:a})}getKey(n,a){return n.join(",")+a}getDashRanges(n,a,d){const _=[];let f=n.length%2==1?-n[n.length-1]*d:0,y=n[0]*d,T=!0;_.push({left:f,right:y,isDash:T,zeroLength:n[0]===0});let C=n[0];for(let M=1;M<n.length;M++){T=!T;const x=n[M];f=C*d,C+=x,y=C*d,_.push({left:f,right:y,isDash:T,zeroLength:x===0})}return _}addRoundDash(n,a,d){const _=a/2;for(let f=-d;f<=d;f++){const y=this.width*(this.nextRow+d+f);let T=0,C=n[T];for(let M=0;M<this.width;M++){M/C.right>1&&(C=n[++T]);const x=Math.abs(M-C.left),I=Math.abs(M-C.right),P=Math.min(x,I);let A;const R=f/d*(_+1);if(C.isDash){const D=_-Math.abs(R);A=Math.sqrt(P*P+D*D)}else A=_-Math.sqrt(P*P+R*R);this.image.data[y+M]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(n,a){for(let C=n.length-1;C>=0;--C){const M=n[C],x=n[C+1];M.zeroLength?n.splice(C,1):x&&x.isDash===M.isDash&&(x.left=M.left,n.splice(C,1))}const d=n[0],_=n[n.length-1];d.isDash===_.isDash&&(d.left=_.left-this.width,_.right=d.right+this.width);const f=this.width*this.nextRow;let y=0,T=n[y];for(let C=0;C<this.width;C++){C/T.right>1&&(T=n[++y]);const M=Math.abs(C-T.left),x=Math.abs(C-T.right),I=Math.min(M,x);this.image.data[f+C]=Math.max(0,Math.min(255,(T.isDash?I:-I)+a+128))}}addDash(n,a){const d=this.getKey(n,a);if(this.positions[d])return this.positions[d];const _=a==="round",f=_?7:0,y=2*f+1;if(this.nextRow+y>this.height)return en("LineAtlas out of space"),null;n.length===0&&n.push(1);let T=0;for(let x=0;x<n.length;x++)n[x]<0&&(en("Negative value is found in line dasharray, replacing values with 0"),n[x]=0),T+=n[x];if(T!==0){const x=this.width/T,I=this.getDashRanges(n,this.width,x);_?this.addRoundDash(I,x,f):this.addRegularDash(I,a==="square"?.5*x:0)}const C=this.nextRow+f;this.nextRow+=y;const M={tl:[C,f],br:[T,0]};return this.positions[d]=M,M}}et(fI,"LineAtlas");const O4=Xp.VectorTileFeature.types,D4=Math.cos(Math.PI/180*37.5),L4=Math.cos(Math.PI/180*5);class Cx{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new vg,this.layoutVertexArray2=new xc,this.patternVertexArray=new ru,this.indexArray=new Ms,this.programConfigurations=new iu(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new To,this.maxLineLength=0,this.zOffsetVertexArray=new Hh,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:fr/64}updateFootprints(n,a){}populate(n,a,d,_){this.hasPattern=gx("line",this.layers,a);const f=this.layers[0].layout.get("line-sort-key"),y=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!y.isConstant()||!!y.constantOr(0);const T=[];for(const{feature:I,id:P,index:A,sourceLayerIndex:R}of n){const D=this.layers[0]._featureFilter.needGeometry,N=tr(I,D);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),N,d))continue;const j=f?f.evaluate(N,{},d):void 0,Z={id:P,properties:I.properties,type:I.type,sourceLayerIndex:R,index:A,geometry:D?N.geometry:Qt(I,d,_),patterns:{},sortKey:j};T.push(Z)}f&&T.sort((I,P)=>I.sortKey-P.sortKey);const{lineAtlas:C,featureIndex:M}=a,x=this.addConstantDashes(C);for(const I of T){const{geometry:P,index:A,sourceLayerIndex:R}=I;if(x&&this.addFeatureDashes(I,C),this.hasPattern){const D=_x("line",this.layers,I,this.zoom,a);this.patternFeatures.push(D)}else this.addFeature(I,P,A,d,C.positions,a.availableImages,a.brightness);M.insert(n[A].feature,P,A,R,this.index)}}addConstantDashes(n){let a=!1;for(const d of this.layers){const _=d.paint.get("line-dasharray").value,f=d.layout.get("line-cap").value;if(_.kind!=="constant"||f.kind!=="constant")a=!0;else{const y=f.value,T=_.value;if(!T)continue;n.addDash(T,y)}}return a}addFeatureDashes(n,a){const d=this.zoom;for(const _ of this.layers){const f=_.paint.get("line-dasharray").value,y=_.layout.get("line-cap").value;if(f.kind==="constant"&&y.kind==="constant")continue;let T,C;if(f.kind==="constant"){if(T=f.value,!T)continue}else T=f.evaluate({zoom:d},n);C=y.kind==="constant"?y.value:y.evaluate({zoom:d},n),a.addDash(T,C),n.patterns[_.id]=a.getKey(T,C)}}update(n,a,d,_,f){const y=Object.keys(n).length!==0;y&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,a,y?this.stateDependentLayers:this.layers,d,_,f)}addFeatures(n,a,d,_,f,y){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,a,d,_,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,P4)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,k4)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,A4.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,C4),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,d,_,f,y,T){const C=this.layers[0].layout,M=C.get("line-join").evaluate(n,{}),x=C.get("line-cap").evaluate(n,{}),I=C.get("line-miter-limit"),P=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const A of a)this.addLine(A,n,_,M,x,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,f,y,_,T)}addLine(n,a,d,_,f,y,T){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const C={zoom:this.zoom,lineProgress:void 0},M=this.layers[0].layout,x=_==="none";if(this.patternJoinNone=this.hasPattern&&x,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<n.length-1;se++)this.totalDistance+=n[se].dist(n[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=O4[a.type]==="Polygon";let P=n.length;for(;P>=2&&n[P-1].equals(n[P-2]);)P--;let A=0;for(;A<P-1&&n[A].equals(n[A+1]);)A++;if(P<(I?3:2))return;_==="bevel"&&(y=1.05);const R=this.overscaling<=16?15*fr/(512*this.overscaling):0,D=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let N,j,Z,X,G,J;this.e1=this.e2=-1,I&&(N=n[P-2],G=n[A].sub(N)._unit()._perp());for(let se=A;se<P;se++){if(Z=se===P-1?I?n[A+1]:void 0:n[se+1],Z&&n[se].equals(Z))continue;if(G&&(X=G),N&&(j=N),N=n[se],this.hasZOffset){const ot=M.get("line-z-offset").value;if(ot.kind==="constant")J=ot.value;else{if(this.lineClips){const lt=this.totalDistance/(this.lineClips.end-this.lineClips.start);C.lineProgress=(lt*this.lineClips.start+this.distance+(j?j.dist(N):0))/lt}else en(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),C.lineProgress=0;J=ot.evaluate(C,a)}J=J||0}G=Z?Z.sub(N)._unit()._perp():X,X=X||G;const _e=j&&Z;let Ce=_e?_:I||x?"butt":f;const Pe=X.x*G.x+X.y*G.y;if(x){const ot=function(lt){if(lt.patternJoinNone){const yt=lt.segmentPoints.length/2,ut=lt.lineSoFar-lt.segmentStart;for(let Mt=0;Mt<yt;++Mt){const Vt=lt.segmentPoints[2*Mt+1],Tt=Math.round(lt.segmentPoints[2*Mt])+.5+.25*Vt;lt.patternVertexArray.emplaceBack(Tt,ut,lt.segmentStart),lt.patternVertexArray.emplaceBack(Tt,ut,lt.segmentStart)}lt.segmentPoints.length=0}lt.e1=lt.e2=-1};if(_e&&Pe<L4){this.updateDistance(j,N),this.addCurrentVertex(N,X,1,1,D,J),ot(this),this.addCurrentVertex(N,G,-1,-1,D,J);continue}if(j){if(!Z){this.updateDistance(j,N),this.addCurrentVertex(N,X,1,1,D,J),ot(this);continue}Ce="miter"}}let Ee=X.add(G);Ee.x===0&&Ee.y===0||Ee._unit();const Ve=Ee.x*G.x+Ee.y*G.y,De=Ve!==0?1/Ve:1/0,qe=2*Math.sqrt(2-2*Ve),Qe=Ve<D4&&j&&Z,nt=X.x*G.y-X.y*G.x>0;if(Qe&&se>A){const ot=N.dist(j);if(ot>2*R){const lt=N.sub(N.sub(j)._mult(R/ot)._round());this.updateDistance(j,lt),this.addCurrentVertex(lt,X,0,0,D,J),j=lt}}if(_e&&Ce==="round"&&(De<T?Ce="miter":De<=2&&(Ce="fakeround")),Ce==="miter"&&De>y&&(Ce="bevel"),Ce==="bevel"&&(De>2&&(Ce="flipbevel"),De<y&&(Ce="miter")),j&&this.updateDistance(j,N),Ce==="miter")Ee._mult(De),this.addCurrentVertex(N,Ee,0,0,D,J);else if(Ce==="flipbevel"){if(De>100)Ee=G.mult(-1);else{const ot=De*X.add(G).mag()/X.sub(G).mag();Ee._perp()._mult(ot*(nt?-1:1))}this.addCurrentVertex(N,Ee,0,0,D,J),this.addCurrentVertex(N,Ee.mult(-1),0,0,D,J)}else if(Ce==="bevel"||Ce==="fakeround"){const ot=-Math.sqrt(De*De-1),lt=nt?ot:0,yt=nt?0:ot;if(j&&this.addCurrentVertex(N,X,lt,yt,D,J),Ce==="fakeround"){const ut=Math.round(180*qe/Math.PI/20);for(let Mt=1;Mt<ut;Mt++){let Vt=Mt/ut;if(Vt!==.5){const wr=Vt-.5;Vt+=Vt*wr*(Vt-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*wr*wr+(.848013+Pe*(.215638*Pe-1.06021)))}const Tt=G.sub(X)._mult(Vt)._add(X)._unit()._mult(nt?-1:1);this.addHalfVertex(N,Tt.x,Tt.y,!1,nt,0,D,J)}}Z&&this.addCurrentVertex(N,G,-lt,-yt,D,J)}else Ce==="butt"?this.addCurrentVertex(N,Ee,0,0,D,J):Ce==="square"?(j||this.addCurrentVertex(N,Ee,-1,-1,D,J),this.addCurrentVertex(N,Ee,0,0,D,J),j&&this.addCurrentVertex(N,Ee,1,1,D,J)):Ce==="round"&&(j&&(this.addCurrentVertex(N,X,0,0,D,J),this.addCurrentVertex(N,X,1,1,D,J,!0)),Z&&(this.addCurrentVertex(N,G,-1,-1,D,J,!0),this.addCurrentVertex(N,G,0,0,D,J)));if(Qe&&se<P-1){const ot=N.dist(Z);if(ot>2*R){const lt=N.add(Z.sub(N)._mult(R/ot)._round());this.updateDistance(N,lt),this.addCurrentVertex(lt,G,0,0,D,J),N=lt}}}}addVerticesTo(n,a,d,_,f,y,T,C,M,x){const I=(a.w-n.w)/this.tessellationStep|0;if(I>1){this.lineSoFar=n.w;const P=(a.x-n.x)/I,A=(a.y-n.y)/I,R=(a.z-n.z)/I,D=(a.w-n.w)/I;for(let N=1;N<I;++N)n.x+=P,n.y+=A,n.z+=R,this.lineSoFar+=D,this.addHalfVertex(n,d,_,x,!1,T,M,n.z),this.addHalfVertex(n,f,y,x,!0,-C,M,n.z)}this.lineSoFar=a.w,this.addHalfVertex(a,d,_,x,!1,T,M,a.z),this.addHalfVertex(a,f,y,x,!0,-C,M,a.z)}addCurrentVertex(n,a,d,_,f,y,T=!1){const C=a.x+a.y*d,M=a.y-a.x*d,x=a.y*_-a.x,I=-a.y-a.x*_;if(y!=null){const A=fr+10,R=y,D=new FS(n.x,n.y,R,this.lineSoFar),N=pI(n,-10,A),j=this.lineSoFar;if(this.currentVertex)if(N){const Z=this.currentVertexIsOutside,X=this.currentVertex,G=new FS(n.x,n.y,R,this.lineSoFar);US(X,G,-10,A),pI(G,-10,A)||(Z&&(this.e1=this.e2=-1,this.lineSoFar=X.w,this.addHalfVertex(X,C,M,T,!1,d,f,X.z),this.addHalfVertex(X,x,I,T,!0,-_,f,X.z)),this.addVerticesTo(X,G,C,M,x,I,d,_,f,T))}else{const Z=this.currentVertex;this.currentVertexIsOutside&&(US(Z,D,-10,A),this.e1=this.e2=-1,this.lineSoFar=Z.w,this.addHalfVertex(Z,C,M,T,!1,d,f,Z.z),this.addHalfVertex(Z,x,I,T,!0,-_,f,Z.z)),this.addVerticesTo(Z,D,C,M,x,I,d,_,f,T)}else N||(this.addHalfVertex(n,C,M,T,!1,d,f,y),this.addHalfVertex(n,x,I,T,!0,-_,f,y));this.currentVertex=D,this.currentVertexIsOutside=N,this.lineSoFar=j}else this.addHalfVertex(n,C,M,T,!1,d,f,y),this.addHalfVertex(n,x,I,T,!0,-_,f,y)}addHalfVertex({x:n,y:a},d,_,f,y,T,C,M){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((n<<1)+(f?1:0),(a<<1)+(y?1:0),Math.round(63*d)+128,Math.round(63*_)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),C.primitiveLength++),y?this.e2=x:this.e1=x,M!=null&&this.zOffsetVertexArray.emplaceBack(M)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}}function pI(u,n,a){return u.x<n||u.x>a||u.y<n||u.y>a}let mI,gI;function _I(u,n,a){return n*(fr/(u.tileSize*Math.pow(2,a-u.tileID.overscaledZ)))}function yI(u,n){return 1/_I(u,1,n.tileZoom)}function vI(u,n,a,d){return u.translatePosMatrix(d||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}et(Cx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const bI=u=>{const n=[];xI(u)&&n.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const a=u.paint.get("line-trim-offset");a[0]===0&&a[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const d=u.layout.get("line-join").constantOr("miter")==="none",_=!!u.paint.get("line-pattern").constantOr(1);return d&&_&&n.push("LINE_JOIN_NONE"),n};function xI(u){const n=u.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let Rx;const wI=()=>Rx||(Rx={layout:mI||(mI=new qi({"line-cap":new Mr(mt.layout_line["line-cap"]),"line-join":new Mr(mt.layout_line["line-join"]),"line-miter-limit":new Xt(mt.layout_line["line-miter-limit"]),"line-round-limit":new Xt(mt.layout_line["line-round-limit"]),"line-sort-key":new Mr(mt.layout_line["line-sort-key"]),"line-z-offset":new Mr(mt.layout_line["line-z-offset"]),visibility:new Xt(mt.layout_line.visibility)})),paint:gI||(gI=new qi({"line-opacity":new Mr(mt.paint_line["line-opacity"]),"line-color":new Mr(mt.paint_line["line-color"]),"line-translate":new Xt(mt.paint_line["line-translate"]),"line-translate-anchor":new Xt(mt.paint_line["line-translate-anchor"]),"line-width":new Mr(mt.paint_line["line-width"]),"line-gap-width":new Mr(mt.paint_line["line-gap-width"]),"line-offset":new Mr(mt.paint_line["line-offset"]),"line-blur":new Mr(mt.paint_line["line-blur"]),"line-dasharray":new Mr(mt.paint_line["line-dasharray"]),"line-pattern":new Mr(mt.paint_line["line-pattern"]),"line-gradient":new La(mt.paint_line["line-gradient"]),"line-trim-offset":new Xt(mt.paint_line["line-trim-offset"]),"line-trim-fade-range":new Xt(mt.paint_line["line-trim-fade-range"]),"line-trim-color":new Xt(mt.paint_line["line-trim-color"]),"line-emissive-strength":new Xt(mt.paint_line["line-emissive-strength"]),"line-border-width":new Mr(mt.paint_line["line-border-width"]),"line-border-color":new Mr(mt.paint_line["line-border-color"]),"line-occlusion-opacity":new Xt(mt.paint_line["line-occlusion-opacity"])}))},Rx);class B4 extends Mr{possiblyEvaluate(n,a){return a=new li(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(n,a)}evaluate(n,a,d,_){return a=ln({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,d,_)}}let Gg;function TI(u,n){return n>0?n+2*u:u}const z4=Wn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N4=Wn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),F4=Wn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Wn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const V4=Wn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),U4=Wn([{name:"a_texb",components:2,type:"Uint16"}]),j4=Wn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),$4=Wn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const EI=Wn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),G4=Wn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Wn([{name:"triangle",components:3,type:"Uint16"}]),Wn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Wn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Wn([{type:"Float32",name:"offsetX"}]),Wn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var js=24;const Ic=128;function Px(u,n){const{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new li(u+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:_}=a;let f=0;for(;f<d.length&&d[f]<=u;)f++;f=Math.max(0,f-1);let y=f;for(;y<d.length&&d[y]<u+1;)y++;y=Math.min(d.length-1,y);const T=d[f],C=d[y];return a.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:_}:{kind:"camera",minZoom:T,maxZoom:C,minSize:a.evaluate(new li(T)),maxSize:a.evaluate(new li(C)),interpolationType:_}}}function fv(u,{uSize:n,uSizeT:a},{lowerSize:d,upperSize:_}){return u.kind==="source"?d/Ic:u.kind==="composite"?vr(d/Ic,_/Ic,a):n}function Yp(u,n){let a=0,d=0;if(u.kind==="constant")d=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:_,minZoom:f,maxZoom:y}=u,T=_?nr(_a.interpolationFactor(_,n,f,y),0,1):0;u.kind==="camera"?d=vr(u.minSize,u.maxSize,T):a=T}return{uSizeT:a,uSize:d}}var q4=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ic,evaluateSizeForFeature:fv,evaluateSizeForZoom:Yp,getSizeData:Px});function H4(u,n,a){return u.sections.forEach(d=>{d.text=function(_,f,y){const T=f.layout.get("text-transform").evaluate(y,{});return T==="uppercase"?_=_.toLocaleUpperCase():T==="lowercase"&&(_=_.toLocaleLowerCase()),vo.applyArabicShaping&&(_=vo.applyArabicShaping(_)),_}(d.text,n,a)}),u}const qg={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function W4(u){return u==="︶"||u==="﹈"||u==="︸"||u==="﹄"||u==="﹂"||u==="︾"||u==="︼"||u==="︺"||u==="︘"||u==="﹀"||u==="︐"||u==="︓"||u==="︔"||u==="｀"||u==="￣"||u==="︑"||u==="︒"}function Z4(u){return u==="︵"||u==="﹇"||u==="︷"||u==="﹃"||u==="﹁"||u==="︽"||u==="︻"||u==="︹"||u==="︗"||u==="︿"}var SI,Mx,II,kx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function K4(){return SI||(SI=1,kx.read=function(u,n,a,d,_){var f,y,T=8*_-d-1,C=(1<<T)-1,M=C>>1,x=-7,I=a?_-1:0,P=a?-1:1,A=u[n+I];for(I+=P,f=A&(1<<-x)-1,A>>=-x,x+=T;x>0;f=256*f+u[n+I],I+=P,x-=8);for(y=f&(1<<-x)-1,f>>=-x,x+=d;x>0;y=256*y+u[n+I],I+=P,x-=8);if(f===0)f=1-M;else{if(f===C)return y?NaN:1/0*(A?-1:1);y+=Math.pow(2,d),f-=M}return(A?-1:1)*y*Math.pow(2,f-d)},kx.write=function(u,n,a,d,_,f){var y,T,C,M=8*f-_-1,x=(1<<M)-1,I=x>>1,P=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,A=d?0:f-1,R=d?1:-1,D=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,y=x):(y=Math.floor(Math.log(n)/Math.LN2),n*(C=Math.pow(2,-y))<1&&(y--,C*=2),(n+=y+I>=1?P/C:P*Math.pow(2,1-I))*C>=2&&(y++,C/=2),y+I>=x?(T=0,y=x):y+I>=1?(T=(n*C-1)*Math.pow(2,_),y+=I):(T=n*Math.pow(2,I-1)*Math.pow(2,_),y=0));_>=8;u[a+A]=255&T,A+=R,T/=256,_-=8);for(y=y<<_|T,M+=_;M>0;u[a+A]=255&y,A+=R,y/=256,M-=8);u[a+A-R]|=128*D}),kx}function AI(){if(II)return Mx;II=1,Mx=n;var u=K4();function n(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var a=4294967296,d=1/a,_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function f(G){return G.type===n.Bytes?G.readVarint()+G.pos:G.pos+1}function y(G,J,se){return se?4294967296*J+(G>>>0):4294967296*(J>>>0)+(G>>>0)}function T(G,J,se){var _e=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));se.realloc(_e);for(var Ce=se.pos-1;Ce>=G;Ce--)se.buf[Ce+_e]=se.buf[Ce]}function C(G,J){for(var se=0;se<G.length;se++)J.writeVarint(G[se])}function M(G,J){for(var se=0;se<G.length;se++)J.writeSVarint(G[se])}function x(G,J){for(var se=0;se<G.length;se++)J.writeFloat(G[se])}function I(G,J){for(var se=0;se<G.length;se++)J.writeDouble(G[se])}function P(G,J){for(var se=0;se<G.length;se++)J.writeBoolean(G[se])}function A(G,J){for(var se=0;se<G.length;se++)J.writeFixed32(G[se])}function R(G,J){for(var se=0;se<G.length;se++)J.writeSFixed32(G[se])}function D(G,J){for(var se=0;se<G.length;se++)J.writeFixed64(G[se])}function N(G,J){for(var se=0;se<G.length;se++)J.writeSFixed64(G[se])}function j(G,J){return(G[J]|G[J+1]<<8|G[J+2]<<16)+16777216*G[J+3]}function Z(G,J,se){G[se]=J,G[se+1]=J>>>8,G[se+2]=J>>>16,G[se+3]=J>>>24}function X(G,J){return(G[J]|G[J+1]<<8|G[J+2]<<16)+(G[J+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(G,J,se){for(se=se||this.length;this.pos<se;){var _e=this.readVarint(),Ce=_e>>3,Pe=this.pos;this.type=7&_e,G(Ce,J,this),this.pos===Pe&&this.skip(_e)}return J},readMessage:function(G,J){return this.readFields(G,J,this.readVarint()+this.pos)},readFixed32:function(){var G=j(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=X(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=j(this.buf,this.pos)+j(this.buf,this.pos+4)*a;return this.pos+=8,G},readSFixed64:function(){var G=j(this.buf,this.pos)+X(this.buf,this.pos+4)*a;return this.pos+=8,G},readFloat:function(){var G=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var J,se,_e=this.buf;return J=127&(se=_e[this.pos++]),se<128?J:(J|=(127&(se=_e[this.pos++]))<<7,se<128?J:(J|=(127&(se=_e[this.pos++]))<<14,se<128?J:(J|=(127&(se=_e[this.pos++]))<<21,se<128?J:function(Ce,Pe,Ee){var Ve,De,qe=Ee.buf;if(Ve=(112&(De=qe[Ee.pos++]))>>4,De<128||(Ve|=(127&(De=qe[Ee.pos++]))<<3,De<128)||(Ve|=(127&(De=qe[Ee.pos++]))<<10,De<128)||(Ve|=(127&(De=qe[Ee.pos++]))<<17,De<128)||(Ve|=(127&(De=qe[Ee.pos++]))<<24,De<128)||(Ve|=(1&(De=qe[Ee.pos++]))<<31,De<128))return y(Ce,Ve,Pe);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(se=_e[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,J=this.pos;return this.pos=G,G-J>=12&&_?function(se,_e,Ce){return _.decode(se.subarray(_e,Ce))}(this.buf,J,G):function(se,_e,Ce){for(var Pe="",Ee=_e;Ee<Ce;){var Ve,De,qe,Qe=se[Ee],nt=null,ot=Qe>239?4:Qe>223?3:Qe>191?2:1;if(Ee+ot>Ce)break;ot===1?Qe<128&&(nt=Qe):ot===2?(192&(Ve=se[Ee+1]))==128&&(nt=(31&Qe)<<6|63&Ve)<=127&&(nt=null):ot===3?(De=se[Ee+2],(192&(Ve=se[Ee+1]))==128&&(192&De)==128&&((nt=(15&Qe)<<12|(63&Ve)<<6|63&De)<=2047||nt>=55296&&nt<=57343)&&(nt=null)):ot===4&&(De=se[Ee+2],qe=se[Ee+3],(192&(Ve=se[Ee+1]))==128&&(192&De)==128&&(192&qe)==128&&((nt=(15&Qe)<<18|(63&Ve)<<12|(63&De)<<6|63&qe)<=65535||nt>=1114112)&&(nt=null)),nt===null?(nt=65533,ot=1):nt>65535&&(nt-=65536,Pe+=String.fromCharCode(nt>>>10&1023|55296),nt=56320|1023&nt),Pe+=String.fromCharCode(nt),Ee+=ot}return Pe}(this.buf,J,G)},readBytes:function(){var G=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,G);return this.pos=G,J},readPackedVarint:function(G,J){if(this.type!==n.Bytes)return G.push(this.readVarint(J));var se=f(this);for(G=G||[];this.pos<se;)G.push(this.readVarint(J));return G},readPackedSVarint:function(G){if(this.type!==n.Bytes)return G.push(this.readSVarint());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==n.Bytes)return G.push(this.readBoolean());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==n.Bytes)return G.push(this.readFloat());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==n.Bytes)return G.push(this.readDouble());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==n.Bytes)return G.push(this.readFixed32());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==n.Bytes)return G.push(this.readSFixed32());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==n.Bytes)return G.push(this.readFixed64());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==n.Bytes)return G.push(this.readSFixed64());var J=f(this);for(G=G||[];this.pos<J;)G.push(this.readSFixed64());return G},skip:function(G){var J=7&G;if(J===n.Varint)for(;this.buf[this.pos++]>127;);else if(J===n.Bytes)this.pos=this.readVarint()+this.pos;else if(J===n.Fixed32)this.pos+=4;else{if(J!==n.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(G,J){this.writeVarint(G<<3|J)},realloc:function(G){for(var J=this.length||16;J<this.pos+G;)J*=2;if(J!==this.length){var se=new Uint8Array(J);se.set(this.buf),this.buf=se,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),Z(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),Z(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),Z(this.buf,-1&G,this.pos),Z(this.buf,Math.floor(G*d),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),Z(this.buf,-1&G,this.pos),Z(this.buf,Math.floor(G*d),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(J,se){var _e,Ce;if(J>=0?(_e=J%4294967296|0,Ce=J/4294967296|0):(Ce=~(-J/4294967296),4294967295^(_e=~(-J%4294967296))?_e=_e+1|0:(_e=0,Ce=Ce+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");se.realloc(10),function(Pe,Ee,Ve){Ve.buf[Ve.pos++]=127&Pe|128,Pe>>>=7,Ve.buf[Ve.pos++]=127&Pe|128,Pe>>>=7,Ve.buf[Ve.pos++]=127&Pe|128,Pe>>>=7,Ve.buf[Ve.pos++]=127&Pe|128,Ve.buf[Ve.pos]=127&(Pe>>>=7)}(_e,0,se),function(Pe,Ee){var Ve=(7&Pe)<<4;Ee.buf[Ee.pos++]|=Ve|((Pe>>>=3)?128:0),Pe&&(Ee.buf[Ee.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ee.buf[Ee.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ee.buf[Ee.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ee.buf[Ee.pos++]=127&Pe|((Pe>>>=7)?128:0),Pe&&(Ee.buf[Ee.pos++]=127&Pe)))))}(Ce,se)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var J=this.pos;this.pos=function(_e,Ce,Pe){for(var Ee,Ve,De=0;De<Ce.length;De++){if((Ee=Ce.charCodeAt(De))>55295&&Ee<57344){if(!Ve){Ee>56319||De+1===Ce.length?(_e[Pe++]=239,_e[Pe++]=191,_e[Pe++]=189):Ve=Ee;continue}if(Ee<56320){_e[Pe++]=239,_e[Pe++]=191,_e[Pe++]=189,Ve=Ee;continue}Ee=Ve-55296<<10|Ee-56320|65536,Ve=null}else Ve&&(_e[Pe++]=239,_e[Pe++]=191,_e[Pe++]=189,Ve=null);Ee<128?_e[Pe++]=Ee:(Ee<2048?_e[Pe++]=Ee>>6|192:(Ee<65536?_e[Pe++]=Ee>>12|224:(_e[Pe++]=Ee>>18|240,_e[Pe++]=Ee>>12&63|128),_e[Pe++]=Ee>>6&63|128),_e[Pe++]=63&Ee|128)}return Pe}(this.buf,G,this.pos);var se=this.pos-J;se>=128&&T(J,se,this),this.pos=J-1,this.writeVarint(se),this.pos+=se},writeFloat:function(G){this.realloc(4),u.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),u.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var J=G.length;this.writeVarint(J),this.realloc(J);for(var se=0;se<J;se++)this.buf[this.pos++]=G[se]},writeRawMessage:function(G,J){this.pos++;var se=this.pos;G(J,this);var _e=this.pos-se;_e>=128&&T(se,_e,this),this.pos=se-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(G,J,se){this.writeTag(G,n.Bytes),this.writeRawMessage(J,se)},writePackedVarint:function(G,J){J.length&&this.writeMessage(G,C,J)},writePackedSVarint:function(G,J){J.length&&this.writeMessage(G,M,J)},writePackedBoolean:function(G,J){J.length&&this.writeMessage(G,P,J)},writePackedFloat:function(G,J){J.length&&this.writeMessage(G,x,J)},writePackedDouble:function(G,J){J.length&&this.writeMessage(G,I,J)},writePackedFixed32:function(G,J){J.length&&this.writeMessage(G,A,J)},writePackedSFixed32:function(G,J){J.length&&this.writeMessage(G,R,J)},writePackedFixed64:function(G,J){J.length&&this.writeMessage(G,D,J)},writePackedSFixed64:function(G,J){J.length&&this.writeMessage(G,N,J)},writeBytesField:function(G,J){this.writeTag(G,n.Bytes),this.writeBytes(J)},writeFixed32Field:function(G,J){this.writeTag(G,n.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(G,J){this.writeTag(G,n.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(G,J){this.writeTag(G,n.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(G,J){this.writeTag(G,n.Fixed64),this.writeSFixed64(J)},writeVarintField:function(G,J){this.writeTag(G,n.Varint),this.writeVarint(J)},writeSVarintField:function(G,J){this.writeTag(G,n.Varint),this.writeSVarint(J)},writeStringField:function(G,J){this.writeTag(G,n.Bytes),this.writeString(J)},writeFloatField:function(G,J){this.writeTag(G,n.Fixed32),this.writeFloat(J)},writeDoubleField:function(G,J){this.writeTag(G,n.Fixed64),this.writeDouble(J)},writeBooleanField:function(G,J){this.writeVarintField(G,!!J)}},Mx}var pv=O(AI());const Ox=3;function X4(u,n,a){n.glyphs=[],u===1&&a.readMessage(Y4,n)}function Y4(u,n,a){if(u===3){const{id:d,bitmap:_,width:f,height:y,left:T,top:C,advance:M}=a.readMessage(J4,{});n.glyphs.push({id:d,bitmap:new Qh({width:f+2*Ox,height:y+2*Ox},_),metrics:{width:f,height:y,left:T,top:C,advance:M}})}else u===4?n.ascender=a.readSVarint():u===5&&(n.descender=a.readSVarint())}function J4(u,n,a){u===1?n.id=a.readVarint():u===2?n.bitmap=a.readBytes():u===3?n.width=a.readVarint():u===4?n.height=a.readVarint():u===5?n.left=a.readSVarint():u===6?n.top=a.readSVarint():u===7&&(n.advance=a.readVarint())}const CI=Ox,Bl={horizontal:1,vertical:2,horizontalOnly:3};class Hg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,a){const d=new Hg;return d.scale=n||1,d.fontStack=a,d}static forImage(n){const a=new Hg;return a.imageName=n,a}}class Jp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){const d=new Jp;for(let _=0;_<n.sections.length;_++){const f=n.sections[_];f.image?d.addImageSection(f):d.addTextSection(f,a)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(a,d){let _="";for(let f=0;f<a.length;f++){const y=a.charCodeAt(f+1)||null,T=a.charCodeAt(f-1)||null;_+=!d&&(y&&En(y)&&!qg[a[f+1]]||T&&En(T)&&!qg[a[f-1]])||!qg[a[f]]?a[f]:qg[a[f]]}return _}(this.text,n)}trim(){let n=0;for(let d=0;d<this.text.length&&mv[this.text.charCodeAt(d)];d++)n++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&mv[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){const d=new Jp;return d.text=this.text.substring(n,a),d.sectionIndex=this.sectionIndex.slice(n,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}addTextSection(n,a){this.text+=n.text,this.sections.push(Hg.forText(n.scale,n.fontStack||a));const d=this.sections.length-1;for(let _=0;_<n.text.length;++_)this.sectionIndex.push(d)}addImageSection(n){const a=n.image?n.image.namePrimary:"";if(a.length===0)return void en("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(Hg.forImage(a)),this.sectionIndex.push(this.sections.length-1)):en("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Dx(u,n,a,d,_,f,y,T,C,M,x,I,P,A,R){const D=Jp.fromFeature(u,_);I===Bl.vertical&&D.verticalizePunctuation(P);let N=[];const j=function(se,_e,Ce,Pe,Ee,Ve){if(!se)return[];const De=[],qe=function(lt,yt,ut,Mt,Vt,Tt){let wr=0;for(let dr=0;dr<lt.length();dr++){const er=lt.getSection(dr);wr+=RI(lt.getCodePoint(dr),er,Mt,Vt,yt,Tt)}return wr/Math.max(1,Math.ceil(wr/ut))}(se,_e,Ce,Pe,Ee,Ve),Qe=se.text.indexOf("​")>=0;let nt=0;for(let lt=0;lt<se.length();lt++){const yt=se.getSection(lt),ut=se.getCodePoint(lt);if(mv[ut]||(nt+=RI(ut,yt,Pe,Ee,_e,Ve)),lt<se.length()-1){const Mt=!((ot=ut)<11904||!(Gt["Bopomofo Extended"](ot)||Gt.Bopomofo(ot)||Gt["CJK Compatibility Forms"](ot)||Gt["CJK Compatibility Ideographs"](ot)||Gt["CJK Compatibility"](ot)||Gt["CJK Radicals Supplement"](ot)||Gt["CJK Strokes"](ot)||Gt["CJK Symbols and Punctuation"](ot)||Gt["CJK Unified Ideographs Extension A"](ot)||Gt["CJK Unified Ideographs"](ot)||Gt["Enclosed CJK Letters and Months"](ot)||Gt["Halfwidth and Fullwidth Forms"](ot)||Gt.Hiragana(ot)||Gt["Ideographic Description Characters"](ot)||Gt["Kangxi Radicals"](ot)||Gt["Katakana Phonetic Extensions"](ot)||Gt.Katakana(ot)||Gt["Vertical Forms"](ot)||Gt["Yi Radicals"](ot)||Gt["Yi Syllables"](ot)));(Q4[ut]||Mt||yt.imageName)&&De.push(MI(lt+1,nt,qe,De,eN(ut,se.getCodePoint(lt+1),Mt&&Qe),!1))}}var ot;return kI(MI(se.length(),nt,qe,De,0,!0))}(D,M,f,n,d,A),{processBidirectionalText:Z,processStyledBidirectionalText:X}=vo;if(Z&&D.sections.length===1){const se=Z(D.toString(),j);for(const _e of se){const Ce=new Jp;Ce.text=_e,Ce.sections=D.sections;for(let Pe=0;Pe<_e.length;Pe++)Ce.sectionIndex.push(0);N.push(Ce)}}else if(X){const se=X(D.text,D.sectionIndex,j);for(const _e of se){const Ce=new Jp;Ce.text=_e[0],Ce.sectionIndex=_e[1],Ce.sections=D.sections,N.push(Ce)}}else N=function(se,_e){const Ce=[],Pe=se.text;let Ee=0;for(const Ve of _e)Ce.push(se.substring(Ee,Ve)),Ee=Ve;return Ee<Pe.length&&Ce.push(se.substring(Ee,Pe.length)),Ce}(D,j);const G=[],J={positionedLines:G,text:D.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,_e,Ce,Pe,Ee,Ve,De,qe,Qe,nt,ot,lt){let yt=0,ut=0,Mt=0;const Vt=qe==="right"?1:qe==="left"?0:.5;let Tt=!1;for(const xr of Ee){const Ir=xr.getSections();for(const tn of Ir){if(tn.imageName)continue;const gn=_e[tn.fontStack];if(gn&&(Tt=gn.ascender!==void 0&&gn.descender!==void 0,!Tt))break}if(!Tt)break}let wr=0;for(const xr of Ee){xr.trim();const Ir=xr.getMaxScale(),tn=(Ir-1)*js,gn={positionedGlyphs:[],lineOffset:0};se.positionedLines[wr]=gn;const un=gn.positionedGlyphs;let hn=0;if(!xr.length()){ut+=Ve,++wr;continue}let xn=0,wn=0;for(let ui=0;ui<xr.length();ui++){const rn=xr.getSection(ui),ri=xr.getSectionIndex(ui),oi=xr.getCodePoint(ui);let Wi=rn.scale,Mo=null,Ho=null,ko=null,xo=js,Ts=0;const es=!(Qe===Bl.horizontal||!ot&&!Mn(oi)||ot&&(mv[oi]||(dr=oi,Gt.Arabic(dr)||Gt["Arabic Supplement"](dr)||Gt["Arabic Extended-A"](dr)||Gt["Arabic Presentation Forms-A"](dr)||Gt["Arabic Presentation Forms-B"](dr))));if(rn.imageName){const $s=Pe[rn.imageName];if(!$s)continue;ko=rn.imageName,se.iconsInText=se.iconsInText||!0,Ho=$s.paddedRect;const Vi=$s.displaySize;Wi=Wi*js/lt,Mo={width:Vi[0],height:Vi[1],left:0,top:-CI,advance:es?Vi[1]:Vi[0],localGlyph:!1},Ts=Tt?-Mo.height*Wi:Ir*js-17-Vi[1]*Wi,xo=Mo.advance;const il=(es?Vi[0]:Vi[1])*Wi-js*Ir;il>0&&il>hn&&(hn=il)}else{const $s=Ce[rn.fontStack];if(!$s)continue;$s[oi]&&(Ho=$s[oi]);const Vi=_e[rn.fontStack];if(!Vi)continue;const il=Vi.glyphs[oi];if(!il)continue;if(Mo=il.metrics,xo=oi!==8203?js:0,Tt){const Mc=Vi.ascender!==void 0?Math.abs(Vi.ascender):0,ec=Vi.descender!==void 0?Math.abs(Vi.descender):0,tc=(Mc+ec)*Wi;xn<tc&&(xn=tc,wn=(Mc-ec)/2*Wi),Ts=-Mc*Wi}else Ts=(Ir-Wi)*js-17}es?(se.verticalizable=!0,un.push({glyph:oi,imageName:ko,x:yt,y:ut+Ts,vertical:es,scale:Wi,localGlyph:Mo.localGlyph,fontStack:rn.fontStack,sectionIndex:ri,metrics:Mo,rect:Ho}),yt+=xo*Wi+nt):(un.push({glyph:oi,imageName:ko,x:yt,y:ut+Ts,vertical:es,scale:Wi,localGlyph:Mo.localGlyph,fontStack:rn.fontStack,sectionIndex:ri,metrics:Mo,rect:Ho}),yt+=Mo.advance*Wi+nt)}un.length!==0&&(Mt=Math.max(yt-nt,Mt),Tt?OI(un,Vt,hn,wn,Ve*Ir/2):OI(un,Vt,hn,0,Ve/2)),yt=0;const Ei=Ve*Ir+hn;gn.lineOffset=Math.max(hn,tn),ut+=Ei,++wr}var dr;const er=ut,{horizontalAlign:qt,verticalAlign:Vr}=Lx(De);(function(xr,Ir,tn,gn,un,hn){const xn=(Ir-tn)*un,wn=-hn*gn;for(const Ei of xr)for(const ui of Ei.positionedGlyphs)ui.x+=xn,ui.y+=wn})(se.positionedLines,Vt,qt,Vr,Mt,er),se.top+=-Vr*er,se.bottom=se.top+er,se.left+=-qt*Mt,se.right=se.left+Mt,se.hasBaseline=Tt}(J,n,a,d,N,y,T,C,I,M,P,R),!function(se){for(const _e of se)if(_e.positionedGlyphs.length!==0)return!1;return!0}(G)&&J}const mv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Q4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function RI(u,n,a,d,_,f){if(n.imageName){const y=d[n.imageName];return y?y.displaySize[0]*n.scale*js/f+_:0}{const y=a[n.fontStack],T=y&&y.glyphs[u];return T?T.metrics.advance*n.scale+_:0}}function PI(u,n,a,d){const _=Math.pow(u-n,2);return d?u<n?_/2:2*_:_+Math.abs(a)*a}function eN(u,n,a){let d=0;return u===10&&(d-=1e4),a&&(d+=150),u!==40&&u!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function MI(u,n,a,d,_,f){let y=null,T=PI(n,a,_,f);for(const C of d){const M=PI(n-C.x,a,_,f)+C.badness;M<=T&&(y=C,T=M)}return{index:u,x:n,priorBreak:y,badness:T}}function kI(u){return u?kI(u.priorBreak).concat(u.index):[]}function Lx(u){let n=.5,a=.5;switch(u){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function OI(u,n,a,d,_){if(!(n||a||d||_))return;const f=u.length-1,y=u[f],T=(y.x+y.metrics.advance*y.scale)*n;for(let C=0;C<=f;C++)u[C].x-=T,u[C].y+=a+d+_}function tN(u,n,a,d){const{horizontalAlign:_,verticalAlign:f}=Lx(d),y=a[0]-u.displaySize[0]*_,T=a[1]-u.displaySize[1]*f;return{imagePrimary:u,imageSecondary:n,top:T,bottom:T+u.displaySize[1],left:y,right:y+u.displaySize[0]}}function DI(u,n,a,d,_,f){const y=u.imagePrimary;let T;if(y.content){const N=y.content,j=y.pixelRatio||1;T=[N[0]/j,N[1]/j,y.displaySize[0]-N[2]/j,y.displaySize[1]-N[3]/j]}const C=n.left*f,M=n.right*f;let x,I,P,A;a==="width"||a==="both"?(A=_[0]+C-d[3],I=_[0]+M+d[1]):(A=_[0]+(C+M-y.displaySize[0])/2,I=A+y.displaySize[0]);const R=n.top*f,D=n.bottom*f;return a==="height"||a==="both"?(x=_[1]+R-d[0],P=_[1]+D+d[2]):(x=_[1]+(R+D-y.displaySize[1])/2,P=x+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:x,right:I,bottom:P,left:A,collisionPadding:T}}class Ku extends We{constructor(n,a,d,_,f){super(n,a),this.angle=_,this.z=d,f!==void 0&&(this.segment=f)}clone(){return new Ku(this.x,this.y,this.z,this.angle,this.segment)}}function LI(u,n,a,d,_){if(n.segment===void 0)return!0;let f=n,y=n.segment+1,T=0;for(;T>-a/2;){if(y--,y<0)return!1;T-=u[y].dist(f),f=u[y]}T+=u[y].dist(u[y+1]),y++;const C=[];let M=0;for(;T<a/2;){const x=u[y],I=u[y+1];if(!I)return!1;let P=u[y-1].angleTo(x)-x.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:P}),M+=P;T-C[0].distance>d;)M-=C.shift().angleDelta;if(M>_)return!1;y++,T+=x.dist(I)}return!0}function BI(u){let n=0;for(let a=0;a<u.length-1;a++)n+=u[a].dist(u[a+1]);return n}function zI(u,n,a){return u?.6*n*a:0}function NI(u,n){return Math.max(u?u.right-u.left:0,n?n.right-n.left:0)}function rN(u,n,a,d,_,f){const y=zI(a,_,f),T=NI(a,d)*f;let C=0;const M=BI(u)/2;for(let x=0;x<u.length-1;x++){const I=u[x],P=u[x+1],A=I.dist(P);if(C+A>M){const R=(M-C)/A,D=vr(I.x,P.x,R),N=vr(I.y,P.y,R),j=new Ku(D,N,0,P.angleTo(I),x);return!y||LI(u,j,T,y,n)?j:void 0}C+=A}}function nN(u,n,a,d,_,f,y,T,C){const M=zI(d,f,y),x=NI(d,_),I=x*y,P=u[0].x===0||u[0].x===C||u[0].y===0||u[0].y===C;return n-I<n/4&&(n=I+n/4),FI(u,P?n/2*T%n:(x/2+2*f)*y*T%n,n,M,a,I,P,!1,C)}function FI(u,n,a,d,_,f,y,T,C){const M=f/2,x=BI(u);let I=0,P=n-a,A=[];for(let R=0;R<u.length-1;R++){const D=u[R],N=u[R+1],j=D.dist(N),Z=N.angleTo(D);for(;P+a<I+j;){P+=a;const X=(P-I)/j,G=vr(D.x,N.x,X),J=vr(D.y,N.y,X);if(G>=0&&G<C&&J>=0&&J<C&&P-M>=0&&P+M<=x){const se=new Ku(G,J,0,Z,R);d&&!LI(u,se,f,d,_)||A.push(se)}}I+=j}return T||A.length||y||(A=FI(u,I/2,a,d,_,f,y,!0,C)),A}function VI(u,n,a,d,_){const f=[];for(let y=0;y<u.length;y++){const T=u[y];let C;for(let M=0;M<T.length-1;M++){let x=T[M],I=T[M+1];x.x<n&&I.x<n||(x.x<n?x=new We(n,x.y+(n-x.x)/(I.x-x.x)*(I.y-x.y))._round():I.x<n&&(I=new We(n,x.y+(n-x.x)/(I.x-x.x)*(I.y-x.y))._round()),x.y<a&&I.y<a||(x.y<a?x=new We(x.x+(a-x.y)/(I.y-x.y)*(I.x-x.x),a)._round():I.y<a&&(I=new We(x.x+(a-x.y)/(I.y-x.y)*(I.x-x.x),a)._round()),x.x>=d&&I.x>=d||(x.x>=d?x=new We(d,x.y+(d-x.x)/(I.x-x.x)*(I.y-x.y))._round():I.x>=d&&(I=new We(d,x.y+(d-x.x)/(I.x-x.x)*(I.y-x.y))._round()),x.y>=_&&I.y>=_||(x.y>=_?x=new We(x.x+(_-x.y)/(I.y-x.y)*(I.x-x.x),_)._round():I.y>=_&&(I=new We(x.x+(_-x.y)/(I.y-x.y)*(I.x-x.x),_)._round()),C&&x.equals(C[C.length-1])||(C=[x],f.push(C)),C.push(I)))))}}return f}function UI(u){let n=0,a=0;for(const y of u)n+=y.w*y.h,a=Math.max(a,y.w);u.sort((y,T)=>T.h-y.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let _=0,f=0;for(const y of u)for(let T=d.length-1;T>=0;T--){const C=d[T];if(!(y.w>C.w||y.h>C.h)){if(y.x=C.x,y.y=C.y,f=Math.max(f,y.y+y.h),_=Math.max(_,y.x+y.w),y.w===C.w&&y.h===C.h){const M=d.pop();T<d.length&&(d[T]=M)}else y.h===C.h?(C.x+=y.w,C.w-=y.w):y.w===C.w?(C.y+=y.h,C.h-=y.h):(d.push({x:C.x+y.w,y:C.y,w:C.w-y.w,h:y.h}),C.y+=y.h,C.h-=y.h);break}}return{w:_,h:f,fill:n/(_*f)||0}}et(Ku,"Anchor");const Wg=1;class Bx{constructor(n,{pixelRatio:a,version:d,stretchX:_,stretchY:f,content:y},T){this.paddedRect=n,this.pixelRatio=a,this.stretchX=_,this.stretchY=f,this.content=y,this.version=d,this.padding=T}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class jI{constructor(n,a,d){const _={},f={};this.haveRenderCallbacks=[];const y=[];this.addImages(n,_,Wg,y),this.addImages(a,f,2,y);const{w:T,h:C}=UI(y),M=new Ea({width:T||1,height:C||1});for(const x in n){const I=n[x],P=_[x].paddedRect;Ea.copy(I.data,M,{x:0,y:0},{x:P.x+Wg,y:P.y+Wg},I.data,d,I.sdf)}for(const x in a){const I=a[x],P=f[x].paddedRect;let A=f[x].padding;const R=P.x+A,D=P.y+A,N=I.data.width,j=I.data.height;A=A>1?A-1:A,Ea.copy(I.data,M,{x:0,y:0},{x:R,y:D},I.data,d),Ea.copy(I.data,M,{x:0,y:j-A},{x:R,y:D-A},{width:N,height:A},d),Ea.copy(I.data,M,{x:0,y:0},{x:R,y:D+j},{width:N,height:A},d),Ea.copy(I.data,M,{x:N-A,y:0},{x:R-A,y:D},{width:A,height:j},d),Ea.copy(I.data,M,{x:0,y:0},{x:R+N,y:D},{width:A,height:j},d),Ea.copy(I.data,M,{x:N-A,y:j-A},{x:R-A,y:D-A},{width:A,height:A},d),Ea.copy(I.data,M,{x:0,y:j-A},{x:R+N,y:D-A},{width:A,height:A},d),Ea.copy(I.data,M,{x:0,y:0},{x:R+N,y:D+j},{width:A,height:A},d),Ea.copy(I.data,M,{x:N-A,y:0},{x:R-A,y:D+j},{width:A,height:A},d)}this.image=M,this.iconPositions=_,this.patternPositions=f}addImages(n,a,d,_){for(const f in n){const y=n[f],T={x:0,y:0,w:y.data.width+2*d,h:y.data.height+2*d};_.push(T),a[f]=new Bx(T,y,d),y.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(n,a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(_=>n.hasImage(_,d)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const _ in n.getUpdatedImages(d))this.patchUpdatedImage(this.iconPositions[_],n.getImage(_,d),a),this.patchUpdatedImage(this.patternPositions[_],n.getImage(_,d),a)}patchUpdatedImage(n,a,d){if(!n||!a||n.version===a.version)return;n.version=a.version;const[_,f]=n.tl;d.update(a.data,{position:{x:_,y:f}})}}et(Bx,"ImagePosition"),et(jI,"ImageAtlas");const Zg=1e20;function $I(u,n,a,d,_,f,y,T,C){for(let M=n;M<n+d;M++)GI(u,a*f+M,f,_,y,T,C);for(let M=a;M<a+_;M++)GI(u,M*f+n,1,d,y,T,C)}function GI(u,n,a,d,_,f,y){f[0]=0,y[0]=-Zg,y[1]=Zg,_[0]=u[n];for(let T=1,C=0,M=0;T<d;T++){_[T]=u[n+T*a];const x=T*T;do{const I=f[C];M=(_[T]-_[I]+x-I*I)/(T-I)/2}while(M<=y[C]&&--C>-1);C++,f[C]=T,y[C]=M,y[C+1]=Zg}for(let T=0,C=0;T<d;T++){for(;y[C+1]<T;)C++;const M=f[C],x=T-M;u[n+T*a]=_[M]+x*x}}const Ac=2,zx={none:0,ideographs:1,all:2};class Qp{constructor(n,a,d){this.requestManager=n,this.localGlyphMode=a,this.localFontFamily=d,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,a){this.urls[a]=n}getGlyphs(n,a,d){const _=[],f=this.urls[a]||Ke.GLYPHS_URL;for(const y in n)for(const T of n[y])_.push({stack:y,id:T});Rn(_,({stack:y,id:T},C)=>{let M=this.entries[y];M||(M=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=M.glyphs[T];if(x!==void 0)return void C(null,{stack:y,id:T,glyph:x});if(x=this._tinySDF(M,y,T),x)return M.glyphs[T]=x,void C(null,{stack:y,id:T,glyph:x});const I=Math.floor(T/256);if(256*I>65535)return void C(new Error("glyphs > 65535 not supported"));if(M.ranges[I])return void C(null,{stack:y,id:T,glyph:x});let P=M.requests[I];P||(P=M.requests[I]=[],Qp.loadGlyphRange(y,I,f,this.requestManager,(A,R)=>{if(R){M.ascender=R.ascender,M.descender=R.descender;for(const D in R.glyphs)this._doesCharSupportLocalGlyph(+D)||(M.glyphs[+D]=R.glyphs[+D]);M.ranges[I]=!0}for(const D of P)D(A,R);delete M.requests[I]})),P.push((A,R)=>{A?C(A):R&&C(null,{stack:y,id:T,glyph:R.glyphs[T]||null})})},(y,T)=>{if(y)d(y);else if(T){const C={};for(const{stack:M,id:x,glyph:I}of T)C[M]===void 0&&(C[M]={}),C[M].glyphs===void 0&&(C[M].glyphs={}),C[M].glyphs[x]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},C[M].ascender=this.entries[M].ascender,C[M].descender=this.entries[M].descender;d(null,C)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==zx.none&&(this.localGlyphMode===zx.all?!!this.localFontFamily:!!this.localFontFamily&&(Gt["CJK Unified Ideographs"](n)||Gt["Hangul Syllables"](n)||Gt.Hiragana(n)||Gt.Katakana(n)||Gt["CJK Symbols and Punctuation"](n)||Gt["CJK Unified Ideographs Extension A"](n)||Gt["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,a,d){const _=this.localFontFamily;if(!_||!this._doesCharSupportLocalGlyph(d))return;let f=n.tinySDF;if(!f){let D="400";/bold/i.test(a)?D="900":/medium/i.test(a)?D="500":/light/i.test(a)&&(D="200"),f=n.tinySDF=new Qp.TinySDF({fontFamily:_,fontWeight:D,fontSize:24*Ac,buffer:3*Ac,radius:8*Ac}),f.fontWeight=D}if(this.localGlyphs[f.fontWeight][d])return this.localGlyphs[f.fontWeight][d];const y=String.fromCodePoint(d),{data:T,width:C,height:M,glyphWidth:x,glyphHeight:I,glyphLeft:P,glyphTop:A,glyphAdvance:R}=f.draw(y);return this.localGlyphs[f.fontWeight][d]={id:d,bitmap:new Qh({width:C,height:M},T),metrics:{width:x/Ac,height:I/Ac,left:P/Ac,top:A/Ac-27,advance:R/Ac,localGlyph:!0}}}}Qp.loadGlyphRange=function(u,n,a,d,_){const f=256*n,y=f+255,T=d.transformRequest(d.normalizeGlyphsURL(a).replace("{fontstack}",u).replace("{range}",`${f}-${y}`),Bo.Glyphs);Ys(T,(C,M)=>{if(C)_(C);else if(M){const x={},I=function(P){return new pv(P).readFields(X4,{})}(M);for(const P of I.glyphs)x[P.id]=P;_(null,{glyphs:x,ascender:I.ascender,descender:I.descender})}})},Qp.TinySDF=class{constructor({fontSize:u=24,buffer:n=3,radius:a=8,cutoff:d=.25,fontFamily:_="sans-serif",fontWeight:f="normal",fontStyle:y="normal"}={}){this.buffer=n,this.cutoff=d,this.radius=a;const T=this.size=u+4*n,C=this._createCanvas(T),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${y} ${f} ${u}px ${_}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(u){const n=document.createElement("canvas");return n.width=n.height=u,n}draw(u){const{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:_,actualBoundingBoxRight:f}=this.ctx.measureText(u),y=Math.ceil(a),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-_))),C=Math.min(this.size-this.buffer,y+Math.ceil(d)),M=T+2*this.buffer,x=C+2*this.buffer,I=Math.max(M*x,0),P=new Uint8ClampedArray(I),A={data:P,width:M,height:x,glyphWidth:T,glyphHeight:C,glyphTop:y,glyphLeft:0,glyphAdvance:n};if(T===0||C===0)return A;const{ctx:R,buffer:D,gridInner:N,gridOuter:j}=this;R.clearRect(D,D,T,C),R.fillText(u,D,D+y);const Z=R.getImageData(D,D,T,C);j.fill(Zg,0,I),N.fill(0,0,I);for(let X=0;X<C;X++)for(let G=0;G<T;G++){const J=Z.data[4*(X*T+G)+3]/255;if(J===0)continue;const se=(X+D)*M+G+D;if(J===1)j[se]=0,N[se]=Zg;else{const _e=.5-J;j[se]=_e>0?_e*_e:0,N[se]=_e<0?_e*_e:0}}$I(j,0,0,M,x,M,this.f,this.v,this.z),$I(N,D,D,T,C,M,this.f,this.v,this.z);for(let X=0;X<I;X++){const G=Math.sqrt(j[X])-Math.sqrt(N[X]);P[X]=Math.round(255-255*(G/this.radius+this.cutoff))}return A}};const td=Wg;function qI(u,n,a,d){const _=[],f=u.imagePrimary,y=f.pixelRatio,T=f.paddedRect.w-2*td,C=f.paddedRect.h-2*td,M=u.right-u.left,x=u.bottom-u.top,I=f.stretchX||[[0,T]],P=f.stretchY||[[0,C]],A=(Ve,De)=>Ve+De[1]-De[0],R=I.reduce(A,0),D=P.reduce(A,0),N=T-R,j=C-D;let Z=0,X=R,G=0,J=D,se=0,_e=N,Ce=0,Pe=j;if(f.content&&d){const Ve=f.content;Z=gv(I,0,Ve[0]),G=gv(P,0,Ve[1]),X=gv(I,Ve[0],Ve[2]),J=gv(P,Ve[1],Ve[3]),se=Ve[0]-Z,Ce=Ve[1]-G,_e=Ve[2]-Ve[0]-X,Pe=Ve[3]-Ve[1]-J}const Ee=(Ve,De,qe,Qe)=>{const nt=_v(Ve.stretch-Z,X,M,u.left),ot=yv(Ve.fixed-se,_e,Ve.stretch,R),lt=_v(De.stretch-G,J,x,u.top),yt=yv(De.fixed-Ce,Pe,De.stretch,D),ut=_v(qe.stretch-Z,X,M,u.left),Mt=yv(qe.fixed-se,_e,qe.stretch,R),Vt=_v(Qe.stretch-G,J,x,u.top),Tt=yv(Qe.fixed-Ce,Pe,Qe.stretch,D),wr=new We(nt,lt),dr=new We(ut,lt),er=new We(ut,Vt),qt=new We(nt,Vt),Vr=new We(ot/y,yt/y),xr=new We(Mt/y,Tt/y),Ir=n*Math.PI/180;if(Ir){const wn=Math.sin(Ir),Ei=Math.cos(Ir),ui=[Ei,-wn,wn,Ei];wr._matMult(ui),dr._matMult(ui),qt._matMult(ui),er._matMult(ui)}const tn=Ve.stretch+Ve.fixed,gn=qe.stretch+qe.fixed,un=De.stretch+De.fixed,hn=Qe.stretch+Qe.fixed,xn=u.imageSecondary;return{tl:wr,tr:dr,bl:qt,br:er,texPrimary:{x:f.paddedRect.x+td+tn,y:f.paddedRect.y+td+un,w:gn-tn,h:hn-un},texSecondary:xn?{x:xn.paddedRect.x+td+tn,y:xn.paddedRect.y+td+un,w:gn-tn,h:hn-un}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vr,pixelOffsetBR:xr,minFontScaleX:_e/y/M,minFontScaleY:Pe/y/x,isSDF:a}};if(d&&(f.stretchX||f.stretchY)){const Ve=HI(I,N,R),De=HI(P,j,D);for(let qe=0;qe<Ve.length-1;qe++){const Qe=Ve[qe],nt=Ve[qe+1];for(let ot=0;ot<De.length-1;ot++)_.push(Ee(Qe,De[ot],nt,De[ot+1]))}}else _.push(Ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return _}function gv(u,n,a){let d=0;for(const _ of u)d+=Math.max(n,Math.min(a,_[1]))-Math.max(n,Math.min(a,_[0]));return d}function HI(u,n,a){const d=[{fixed:-td,stretch:0}];for(const[_,f]of u){const y=d[d.length-1];d.push({fixed:_-y.stretch,stretch:y.stretch}),d.push({fixed:_-y.stretch,stretch:y.stretch+(f-_)})}return d.push({fixed:n+td,stretch:a}),d}function _v(u,n,a,d){return u/n*a+d}function yv(u,n,a,d){return u-n*a/d}function iN(u,n,a,d){const _=n+u.positionedLines[d].lineOffset;return d===0?a+_/2:a+(_+(n+u.positionedLines[d-1].lineOffset))/2}function oN(u,n=1,a=!1){let d=1/0,_=1/0,f=-1/0,y=-1/0;const T=u[0];for(let A=0;A<T.length;A++){const R=T[A];(!A||R.x<d)&&(d=R.x),(!A||R.y<_)&&(_=R.y),(!A||R.x>f)&&(f=R.x),(!A||R.y>y)&&(y=R.y)}const C=Math.min(f-d,y-_);let M=C/2;const x=new Jd([],sN);if(C===0)return new We(d,_);for(let A=d;A<f;A+=C)for(let R=_;R<y;R+=C)x.push(new em(A+M,R+M,M,u));let I=function(A){let R=0,D=0,N=0;const j=A[0];for(let Z=0,X=j.length,G=X-1;Z<X;G=Z++){const J=j[Z],se=j[G],_e=J.x*se.y-se.x*J.y;D+=(J.x+se.x)*_e,N+=(J.y+se.y)*_e,R+=3*_e}return new em(D/R,N/R,0,A)}(u),P=x.length;for(;x.length;){const A=x.pop();(A.d>I.d||!I.d)&&(I=A,a&&console.log("found best %d after %d probes",Math.round(1e4*A.d)/1e4,P)),A.max-I.d<=n||(M=A.h/2,x.push(new em(A.p.x-M,A.p.y-M,M,u)),x.push(new em(A.p.x+M,A.p.y-M,M,u)),x.push(new em(A.p.x-M,A.p.y+M,M,u)),x.push(new em(A.p.x+M,A.p.y+M,M,u)),P+=4)}return a&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function sN(u,n){return n.max-u.max}class em{constructor(n,a,d,_){this.p=new We(n,a),this.h=d,this.d=function(f,y){let T=!1,C=1/0;for(let M=0;M<y.length;M++){const x=y[M];for(let I=0,P=x.length,A=P-1;I<P;A=I++){const R=x[I],D=x[A];R.y>f.y!=D.y>f.y&&f.x<(D.x-R.x)*(f.y-R.y)/(D.y-R.y)+R.x&&(T=!T),C=Math.min(C,fi(f,R,D))}}return(T?1:-1)*Math.sqrt(C)}(this.p,_),this.max=this.d+this.h*Math.SQRT2}}const Nx=Number.POSITIVE_INFINITY,aN=Math.sqrt(2);function WI(u,[n,a]){let d=0,_=0;if(a===Nx){n<0&&(n=0);const f=n/aN;switch(u){case"top-right":case"top-left":_=f-7;break;case"bottom-right":case"bottom-left":_=7-f;break;case"bottom":_=7-n;break;case"top":_=n-7}switch(u){case"top-right":case"bottom-right":d=-f;break;case"top-left":case"bottom-left":d=f;break;case"left":d=n;break;case"right":d=-n}}else{switch(n=Math.abs(n),a=Math.abs(a),u){case"top-right":case"top-left":case"top":_=a-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-a}switch(u){case"top-right":case"bottom-right":case"right":d=-n;break;case"top-left":case"bottom-left":case"left":d=n}}return[d,_]}function Fx(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function lN(u,n,a,d,_,f,y,T,C,M,x,I,P,A,R){let D=f.textMaxSize.evaluate(n,{},I);D===void 0&&(D=y);const N=u.layers[0].layout,j=N.get("icon-offset").evaluate(n,{},I),Z=KI(a.horizontal)||a.vertical,X=P.name==="globe",G=js,J=y/G,se=u.tilePixelRatio*D/G,_e=(nt=u.overscaling,u.zoom>18&&nt>2&&(nt>>=1),Math.max(fr/(512*nt),1)*N.get("symbol-spacing")),Ce=N.get("text-padding")*u.tilePixelRatio,Pe=N.get("icon-padding")*u.tilePixelRatio,Ee=Wt(N.get("text-max-angle")),Ve=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",De=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",qe=N.get("symbol-placement"),Qe=_e/2;var nt;const ot=N.get("icon-text-fit").evaluate(n,{},I),lt=N.get("icon-text-fit-padding").evaluate(n,{},I),yt=ot!=="none";let ut;u.hasAnyIconTextFit===!1&&yt&&(u.hasAnyIconTextFit=!0),d&&yt&&(u.allowVerticalPlacement&&a.vertical&&(ut=DI(d,a.vertical,ot,lt,j,J)),Z&&(d=DI(d,Z,ot,lt,j,J)));const Mt=(Vt,Tt,wr)=>{if(Tt.x<0||Tt.x>=fr||Tt.y<0||Tt.y>=fr)return;let dr=null;if(X){const{x:er,y:qt,z:Vr}=P.projectTilePoint(Tt.x,Tt.y,wr);dr={anchor:new Ku(er,qt,Vr,0,void 0),up:P.upVector(wr,Tt.x,Tt.y)}}(function(er,qt,Vr,xr,Ir,tn,gn,un,hn,xn,wn,Ei,ui,rn,ri,oi,Wi,Mo,Ho,ko,xo,Ts,es,$s,Vi,il,Mc){const ec=er.addToLineVertexArray(qt,xr);let tc,Af,sd,Cf,d_,gC,_C,yC=0,vC=0,bC=0,xC=0,p1=-1,m1=-1;const lu={};let wC=Ji("");const Rf=Vr?Vr.anchor:qt,g1=hn.layout.get("icon-text-fit").evaluate(xo,{},Vi)!=="none";let _1=0,y1=0;if(hn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[_1,y1]=hn.layout.get("text-offset").evaluate(xo,{},Vi).map(gl=>gl*js):(_1=hn.layout.get("text-radial-offset").evaluate(xo,{},Vi)*js,y1=Nx),er.allowVerticalPlacement&&Ir.vertical){const gl=Ir.vertical;if(ri)gC=Vx(gl),un&&(_C=Vx(un));else{const _l=hn.layout.get("text-rotate").evaluate(xo,{},Vi)+90;sd=vv(xn,Rf,qt,wn,Ei,ui,gl,rn,_l,oi),un&&(Cf=vv(xn,Rf,qt,wn,Ei,ui,un,Mo,_l))}}if(tn){const gl=hn.layout.get("icon-rotate").evaluate(xo,{},Vi),_l=qI(tn,gl,es,g1),lm=un?qI(un,gl,es,g1):void 0;Af=vv(xn,Rf,qt,wn,Ei,ui,tn,Mo,gl),yC=4*_l.length;const TC=er.iconSizeData;let Pf=null;TC.kind==="source"?(Pf=[Ic*hn.layout.get("icon-size").evaluate(xo,{},Vi)],Pf[0]>rd&&en(`${er.layerIds[0]}: Value for "icon-size" is >= ${Kg}. Reduce your "icon-size".`)):TC.kind==="composite"&&(Pf=[Ic*Ts.compositeIconSizes[0].evaluate(xo,{},Vi),Ic*Ts.compositeIconSizes[1].evaluate(xo,{},Vi)],(Pf[0]>rd||Pf[1]>rd)&&en(`${er.layerIds[0]}: Value for "icon-size" is >= ${Kg}. Reduce your "icon-size".`)),er.addSymbols(er.icon,_l,Pf,ko,Ho,xo,!1,Vr,qt,ec.lineStartIndex,ec.lineLength,-1,$s,Vi,il,Mc),p1=er.icon.placedSymbolArray.length-1,lm&&(vC=4*lm.length,er.addSymbols(er.icon,lm,Pf,ko,Ho,xo,Bl.vertical,Vr,qt,ec.lineStartIndex,ec.lineLength,-1,$s,Vi,il,Mc),m1=er.icon.placedSymbolArray.length-1)}for(const gl in Ir.horizontal){const _l=Ir.horizontal[gl];tc||(wC=Ji(_l.text),ri?d_=Vx(_l):tc=vv(xn,Rf,qt,wn,Ei,ui,_l,rn,hn.layout.get("text-rotate").evaluate(xo,{},Vi),oi));const lm=_l.positionedLines.length===1;if(bC+=ZI(er,Vr,qt,_l,gn,hn,ri,xo,oi,ec,Ir.vertical?Bl.horizontal:Bl.horizontalOnly,lm?Object.keys(Ir.horizontal):[gl],lu,p1,Ts,$s,Vi,il),lm)break}Ir.vertical&&(xC+=ZI(er,Vr,qt,Ir.vertical,gn,hn,ri,xo,oi,ec,Bl.vertical,["vertical"],lu,m1,Ts,$s,Vi,il));let ad=-1;const v1=(gl,_l)=>gl?Math.max(gl,_l):_l;ad=v1(d_,ad),ad=v1(gC,ad),ad=v1(_C,ad);const T5=ad>-1?1:0;er.glyphOffsetArray.length>=65535&&en("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xo.sortKey!==void 0&&er.addToSortKeyRanges(er.symbolInstances.length,xo.sortKey),er.symbolInstances.emplaceBack(qt.x,qt.y,Rf.x,Rf.y,Rf.z,lu.right>=0?lu.right:-1,lu.center>=0?lu.center:-1,lu.left>=0?lu.left:-1,lu.vertical>=0?lu.vertical:-1,p1,m1,wC,tc!==void 0?tc:er.collisionBoxArray.length,tc!==void 0?tc+1:er.collisionBoxArray.length,sd!==void 0?sd:er.collisionBoxArray.length,sd!==void 0?sd+1:er.collisionBoxArray.length,Af!==void 0?Af:er.collisionBoxArray.length,Af!==void 0?Af+1:er.collisionBoxArray.length,Cf||er.collisionBoxArray.length,Cf?Cf+1:er.collisionBoxArray.length,wn,bC,xC,yC,vC,T5,0,_1,y1,ad,0,g1?1:0)})(u,Tt,dr,Vt,a,d,_,ut,u.layers[0],u.collisionBoxArray,n.index,n.sourceLayerIndex,u.index,Ce,Ve,C,0,Pe,De,j,n,f,M,x,I,A,R)};if(qe==="line")for(const Vt of VI(n.geometry,0,0,fr,fr)){const Tt=nN(Vt,_e,Ee,a.vertical||Z,d,G,se,u.overscaling,fr);for(const wr of Tt)Z&&cN(u,Z.text,Qe,wr)||Mt(Vt,wr,I)}else if(qe==="line-center"){for(const Vt of n.geometry)if(Vt.length>1){const Tt=rN(Vt,Ee,a.vertical||Z,d,G,se);Tt&&Mt(Vt,Tt,I)}}else if(n.type==="Polygon")for(const Vt of sv(n.geometry,0)){const Tt=oN(Vt,16);Mt(Vt[0],new Ku(Tt.x,Tt.y,0,0,void 0),I)}else if(n.type==="LineString")for(const Vt of n.geometry)Mt(Vt,new Ku(Vt[0].x,Vt[0].y,0,0,void 0),I);else if(n.type==="Point")for(const Vt of n.geometry)for(const Tt of Vt)Mt([Tt],new Ku(Tt.x,Tt.y,0,0,void 0),I)}const Kg=255,rd=Kg*Ic;function ZI(u,n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N,j){const Z=function(J,se,_e,Ce,Pe,Ee,Ve,De){const qe=[];if(se.positionedLines.length===0)return qe;const Qe=Ce.layout.get("text-rotate").evaluate(Ee,{})*Math.PI/180,nt=function(Mt){const Vt=Mt[0],Tt=Mt[1],wr=Vt*Tt;return wr>0?[Vt,-Tt]:wr<0?[-Vt,Tt]:Vt===0?[Tt,Vt]:[Tt,-Vt]}(_e);let ot=Math.abs(se.top-se.bottom);for(const Mt of se.positionedLines)ot-=Mt.lineOffset;const lt=se.positionedLines.length,yt=ot/lt;let ut=se.top-_e[1];for(let Mt=0;Mt<lt;++Mt){const Vt=se.positionedLines[Mt];ut=iN(se,yt,ut,Mt);for(const Tt of Vt.positionedGlyphs){if(!Tt.rect)continue;const wr=Tt.rect||{};let dr=CI+1,er=!0,qt=1,Vr=0;if(Tt.imageName){const ko=Ve[Tt.imageName];if(!ko)continue;if(ko.sdf){en("SDF images are not supported in formatted text and will be ignored.");continue}er=!1,qt=ko.pixelRatio,dr=Wg/qt}const xr=(Pe||De)&&Tt.vertical,Ir=Tt.metrics.advance*Tt.scale/2,tn=Tt.metrics,gn=Tt.rect;if(gn===null)continue;De&&se.verticalizable&&(Vr=Tt.imageName?Ir-Tt.metrics.width*Tt.scale/2:0);const un=Pe?[Tt.x+Ir,Tt.y]:[0,0];let hn=[0,0],xn=[0,0],wn=!1;Pe||(xr?(xn=[Tt.x+Ir+nt[0],Tt.y+nt[1]-Vr],wn=!0):hn=[Tt.x+Ir+_e[0],Tt.y+_e[1]-Vr]);const Ei=gn.w*Tt.scale/(qt*(Tt.localGlyph?Ac:1)),ui=gn.h*Tt.scale/(qt*(Tt.localGlyph?Ac:1));let rn,ri,oi,Wi;if(xr){const ko=Tt.y-ut,xo=new We(-Ir,Ir-ko),Ts=-Math.PI/2,es=new We(...xn);rn=new We(-Ir+hn[0],hn[1]),rn._rotateAround(Ts,xo)._add(es),rn.x+=-ko+Ir,rn.y-=(tn.left-dr)*Tt.scale;const $s=Tt.imageName?tn.advance*Tt.scale:js*Tt.scale,Vi=String.fromCodePoint(Tt.glyph);W4(Vi)?rn.x+=(1-dr)*Tt.scale:Z4(Vi)?rn.x+=$s-tn.height*Tt.scale+(-dr-1)*Tt.scale:rn.x+=Tt.imageName||tn.width+2*dr===gn.w&&tn.height+2*dr===gn.h?($s-ui)/2:($s-(tn.height+2*dr)*Tt.scale)/2,ri=new We(rn.x,rn.y-Ei),oi=new We(rn.x+ui,rn.y),Wi=new We(rn.x+ui,rn.y-Ei)}else{const ko=(tn.left-dr)*Tt.scale-Ir+hn[0],xo=(-tn.top-dr)*Tt.scale+hn[1],Ts=ko+Ei,es=xo+ui;rn=new We(ko,xo),ri=new We(Ts,xo),oi=new We(ko,es),Wi=new We(Ts,es)}if(Qe){let ko;ko=Pe?new We(0,0):wn?new We(nt[0],nt[1]):new We(_e[0],_e[1]),rn._rotateAround(Qe,ko),ri._rotateAround(Qe,ko),oi._rotateAround(Qe,ko),Wi._rotateAround(Qe,ko)}const Mo=new We(0,0),Ho=new We(0,0);qe.push({tl:rn,tr:ri,bl:oi,br:Wi,texPrimary:wr,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:un,sectionIndex:Tt.sectionIndex,isSDF:er,pixelOffsetTL:Mo,pixelOffsetBR:Ho,minFontScaleX:0,minFontScaleY:0})}}return qe}(0,d,C,f,y,T,_,u.allowVerticalPlacement),X=u.textSizeData;let G=null;X.kind==="source"?(G=[Ic*f.layout.get("text-size").evaluate(T,{},N)],G[0]>rd&&en(`${u.layerIds[0]}: Value for "text-size" is >= ${Kg}. Reduce your "text-size".`)):X.kind==="composite"&&(G=[Ic*R.compositeTextSizes[0].evaluate(T,{},N),Ic*R.compositeTextSizes[1].evaluate(T,{},N)],(G[0]>rd||G[1]>rd)&&en(`${u.layerIds[0]}: Value for "text-size" is >= ${Kg}. Reduce your "text-size".`)),u.addSymbols(u.text,Z,G,C,y,T,x,n,a,M.lineStartIndex,M.lineLength,A,D,N,j,!1);for(const J of I)P[J]=u.text.placedSymbolArray.length-1;return 4*Z.length}function KI(u){for(const n in u)return u[n];return null}function vv(u,n,a,d,_,f,y,T,C,M){let x=y.top,I=y.bottom,P=y.left,A=y.right;const R=y.collisionPadding;if(R&&(P-=R[0],x-=R[1],A+=R[2],I+=R[3]),C){const D=new We(P,x),N=new We(A,x),j=new We(P,I),Z=new We(A,I),X=Wt(C);let G=new We(0,0);M&&(G=new We(M[0],M[1])),D._rotateAround(X,G),N._rotateAround(X,G),j._rotateAround(X,G),Z._rotateAround(X,G),P=Math.min(D.x,N.x,j.x,Z.x),A=Math.max(D.x,N.x,j.x,Z.x),x=Math.min(D.y,N.y,j.y,Z.y),I=Math.max(D.y,N.y,j.y,Z.y)}return u.emplaceBack(n.x,n.y,n.z,a.x,a.y,P,x,A,I,T,d,_,f),u.length-1}function Vx(u){u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const n=u.bottom-u.top;return n>0?Math.max(10,n):null}function cN(u,n,a,d){const _=u.compareText;if(n in _){const f=_[n];for(let y=f.length-1;y>=0;y--)if(d.dist(f[y])<a)return!0}else _[n]=[];return _[n].push(d),!1}function XI(u,n){const a=u.fovAboveCenter,d=u.elevation?u.elevation.getMinElevationBelowMSL()*n:0,_=(u._camera.position[2]*u.worldSize-d)/Math.cos(u._pitch),f=Math.sin(a)*_/Math.sin(Math.max(Math.PI/2-u._pitch-a,.01));let y=Math.sin(u._pitch)*f+_;const T=_*(1/u._horizonShift);return u.elevation&&u.elevation.exaggeration()!==0||(y*=1+Math.max(u.zoom-17,0)),Math.min(1.01*y,T)}function Xg(u,n){if(!n.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:n};const a=Math.pow(2,-u.z),d=u.x*a,_=(u.x+1)*a,f=u.y*a,y=(u.y+1)*a,T=Be(d),C=Be(_),M=Le(f),x=Le(y),I=n.project(T,M),P=n.project(C,M),A=n.project(C,x),R=n.project(T,x);let D=Math.min(I.x,P.x,A.x,R.x),N=Math.min(I.y,P.y,A.y,R.y),j=Math.max(I.x,P.x,A.x,R.x),Z=Math.max(I.y,P.y,A.y,R.y);const X=a/16;function G(se,_e,Ce,Pe,Ee,Ve){const De=(Ce+Ee)/2,qe=(Pe+Ve)/2,Qe=n.project(Be(De),Le(qe)),nt=Math.max(0,D-Qe.x,N-Qe.y,Qe.x-j,Qe.y-Z);D=Math.min(D,Qe.x),j=Math.max(j,Qe.x),N=Math.min(N,Qe.y),Z=Math.max(Z,Qe.y),nt>X&&(G(se,Qe,Ce,Pe,De,qe),G(Qe,_e,De,qe,Ee,Ve))}G(I,P,d,f,_,f),G(P,A,_,f,_,y),G(A,R,_,y,d,y),G(R,I,d,y,d,f),D-=X,N-=X,j+=X,Z+=X;const J=1/Math.max(j-D,Z-N);return{scale:J,x:D*J,y:N*J,x2:j*J,y2:Z*J,projection:n}}function YI(u,{x:n,y:a},d=0){return new We(((n-d)*u.scale-u.x)*fr,(a*u.scale-u.y)*fr)}const uN=Se.mat4.identity(new Float32Array(16));class nd{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,a){return{x:0,y:0,z:0}}unproject(n,a){return new K(0,0)}projectTilePoint(n,a,d){return{x:n,y:a,z:0}}locationPoint(n,a,d=!0){return n._coordinatePoint(n.locationCoordinate(a),d)}pixelsPerMeter(n,a){return Ae(1,n)*a}pixelSpaceConversion(n,a,d){return 1}farthestPixelDistance(n){return XI(n,n.pixelsPerMeter)}pointCoordinate(n,a,d,_){const f=n.horizonLineFromTop(!1),y=new We(a,Math.max(f,d));return n.rayIntersectionCoordinate(n.pointRayIntersection(y,_))}pointCoordinate3D(n,a,d){const _=new We(a,d);if(n.elevation)return n.elevation.pointCoordinate(_);{const f=this.pointCoordinate(n,_.x,_.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(n,a){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,a.x,a.y);const d=n.horizonLineFromTop();return a.y<d}createInversionMatrix(n,a){return uN}createTileMatrix(n,a,d){let _,f,y;const T=d.canonical,C=Se.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=Xg(T,this);_=1,f=M.x+d.wrap*M.scale,y=M.y,Se.mat4.scale(C,C,[_/M.scale,_/M.scale,n.pixelsPerMeter/a])}else _=a/n.zoomScale(T.z),f=(T.x+Math.pow(2,T.z)*d.wrap)*_,y=T.y*_;return Se.mat4.translate(C,C,[f,y,0]),Se.mat4.scale(C,C,[_/fr,_/fr,1]),C}upVector(n,a,d){return[0,0,1]}upVectorScale(n,a,d){return{metersToTile:1}}}class hN extends nd{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[a,d]=this.parallels=n.parallels||[29.5,45.5],_=Math.sin(Wt(a));this.n=(_+Math.sin(Wt(d)))/2,this.c=1+_*(2*this.n-_),this.r0=Math.sqrt(this.c)/this.n}project(n,a){const{n:d,c:_,r0:f}=this,y=Wt(n-this.center[0]),T=Wt(a),C=Math.sqrt(_-2*d*Math.sin(T))/d;return{x:C*Math.sin(y*d),y:C*Math.cos(y*d)-f,z:0}}unproject(n,a){const{n:d,c:_,r0:f}=this,y=f+a;let T=Math.atan2(n,Math.abs(y))*Math.sign(y);y*d<0&&(T-=Math.PI*Math.sign(n)*Math.sign(y));const C=Wt(this.center[0])*d;T=Zr(T,-Math.PI-C,Math.PI-C);const M=nr(mr(T/d)+this.center[0],-180,180),x=Math.asin(nr((_-(n*n+y*y)*d*d)/(2*d),-1,1)),I=nr(mr(x),-je,je);return new K(M,I)}}const Yg=1.340264,Jg=-.081106,Qg=893e-6,e_=.003796,bv=Math.sqrt(3)/2;class dN extends nd{project(n,a){a=a/180*Math.PI,n=n/180*Math.PI;const d=Math.asin(bv*Math.sin(a)),_=d*d,f=_*_*_;return{x:.5*(n*Math.cos(d)/(bv*(Yg+3*Jg*_+f*(7*Qg+9*e_*_)))/Math.PI+.5),y:1-.5*(d*(Yg+Jg*_+f*(Qg+e_*_))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,_=d*d,f=_*_*_;for(let x,I,P,A=0;A<12&&(I=d*(Yg+Jg*_+f*(Qg+e_*_))-a,P=Yg+3*Jg*_+f*(7*Qg+9*e_*_),x=I/P,d=nr(d-x,-Math.PI/3,Math.PI/3),_=d*d,f=_*_*_,!(Math.abs(x)<1e-12));++A);const y=bv*n*(Yg+3*Jg*_+f*(7*Qg+9*e_*_))/Math.cos(d),T=Math.asin(Math.sin(d)/bv),C=nr(180*y/Math.PI,-180,180),M=nr(180*T/Math.PI,-je,je);return new K(C,M)}}class fN extends nd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){return{x:.5+n/360,y:.5-a/360,z:0}}unproject(n,a){const d=360*(n-.5),_=nr(360*(.5-a),-je,je);return new K(d,_)}}const tm=Math.PI/2;function xv(u){return Math.tan((tm+u)/2)}class pN extends nd{constructor(n){super(n),this.center=n.center||[0,30];const[a,d]=this.parallels=n.parallels||[30,30];let _=Wt(a),f=Wt(d);this.southernCenter=_+f<0,this.southernCenter&&(_=-_,f=-f);const y=Math.cos(_),T=xv(_);this.n=_===f?Math.sin(_):Math.log(y/Math.cos(f))/Math.log(xv(f)/T),this.f=y*Math.pow(xv(_),this.n)/this.n}project(n,a){a=Wt(a),this.southernCenter&&(a=-a),n=Wt(n-this.center[0]);const d=1e-6,{n:_,f}=this;f>0?a<-tm+d&&(a=-tm+d):a>tm-d&&(a=tm-d);const y=f/Math.pow(xv(a),_);let T=y*Math.sin(_*n),C=f-y*Math.cos(_*n);return T=.5*(T/Math.PI+.5),C=.5*(C/Math.PI+.5),{x:T,y:this.southernCenter?C:1-C,z:0}}unproject(n,a){n=(2*n-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:d,f:_}=this,f=_-a,y=Math.sign(f),T=Math.sign(d)*Math.sqrt(n*n+f*f);let C=Math.atan2(n,Math.abs(f))*y;f*d<0&&(C-=Math.PI*Math.sign(n)*y);const M=nr(mr(C/d)+this.center[0],-180,180),x=nr(mr(2*Math.atan(Math.pow(_/T,1/d))-tm),-je,je);return new K(M,this.southernCenter?-x:x)}}class JI extends nd{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,a){return{x:Re(n),y:Oe(a),z:0}}unproject(n,a){const d=Be(n),_=Le(a);return new K(d,_)}}const QI=Wt(je);class mN extends nd{project(n,a){const d=(a=Wt(a))*a,_=d*d;return{x:.5*((n=Wt(n))*(.8707-.131979*d+_*(_*(.003971*d-.001529*_)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+d*(.015085+_*(.028874*d-.044475-.005916*_)))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,_=25,f=0,y=d*d;do{y=d*d;const M=y*y;f=(d*(1.007226+y*(.015085+M*(.028874*y-.044475-.005916*M)))-a)/(1.007226+y*(.045255+M*(.259866*y-.311325-.005916*11*M))),d=nr(d-f,-QI,QI)}while(Math.abs(f)>1e-6&&--_>0);y=d*d;const T=nr(mr(n/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),C=mr(d);return new K(T,C)}}const eA=Wt(je);class gN extends nd{project(n,a){a=Wt(a),n=Wt(n);const d=Math.cos(a),_=2/Math.PI,f=Math.acos(d*Math.cos(n/2)),y=Math.sin(f)/f,T=.5*(n*_+2*d*Math.sin(n/2)/y)||0,C=.5*(a+Math.sin(a)/y)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(n,a){let d=n=(2*n-.5)*Math.PI,_=a=(2*(1-a)-1)*Math.PI,f=25;const y=1e-6;let T=0,C=0;do{const M=Math.cos(_),x=Math.sin(_),I=2*x*M,P=x*x,A=M*M,R=Math.cos(d/2),D=Math.sin(d/2),N=2*R*D,j=D*D,Z=1-A*R*R,X=Z?1/Z:0,G=Z?Math.acos(M*R)*Math.sqrt(1/Z):0,J=.5*(2*G*M*D+2*d/Math.PI)-n,se=.5*(G*x+_)-a,_e=.5*X*(A*j+G*M*R*P)+1/Math.PI,Ce=X*(N*I/4-G*x*D),Pe=.125*X*(I*D-G*x*A*N),Ee=.5*X*(P*R+G*j*M)+.5,Ve=Ce*Pe-Ee*_e;T=(se*Ce-J*Ee)/Ve,C=(J*Pe-se*_e)/Ve,d=nr(d-T,-Math.PI,Math.PI),_=nr(_-C,-eA,eA)}while((Math.abs(T)>y||Math.abs(C)>y)&&--f>0);return new K(mr(d),mr(_))}}class tA extends nd{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Wt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){const{scale:d,cosPhi:_}=this;return{x:Wt(n)*_*d+.5,y:-Math.sin(Wt(a))/_*d+.5,z:0}}unproject(n,a){const{scale:d,cosPhi:_}=this,f=-(a-.5)/d,y=nr(mr((n-.5)/d)/_,-180,180),T=Math.asin(nr(f*_,-1,1)),C=nr(mr(T),-je,je);return new K(y,C)}}class _N extends JI{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,a,d){const _=Dg(n,a,d),f=rv(su(d));return Se.vec3.transformMat4(_,_,f),{x:_[0],y:_[1],z:_[2]}}locationPoint(n,a){const d=V(a.lat,a.lng),_=Se.vec3.normalize([],d),f=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(a),n._centerAltitude):n._centerAltitude,y=Ae(1,0)*fr*f;Se.vec3.scaleAndAdd(d,d,_,y);const T=Se.mat4.identity(new Float64Array(16));return Se.mat4.multiply(T,n.pixelMatrix,n.globeMatrix),Se.vec3.transformMat4(d,d,T),new We(d[0],d[1])}pixelsPerMeter(n,a){return Ae(1,0)*a}pixelSpaceConversion(n,a,d){const _=Ae(1,n)*a,f=vr(Ae(1,45)*a,_,d);return this.pixelsPerMeter(n,a)/f}createTileMatrix(n,a,d){const _=ux(su(d.canonical));return Se.mat4.multiply(new Float64Array(16),n.globeMatrix,_)}createInversionMatrix(n,a){const{center:d}=n,_=rv(su(a));return Se.mat4.rotateY(_,_,Wt(d.lng)),Se.mat4.rotateX(_,_,Wt(d.lat)),Se.mat4.scale(_,_,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(_)}pointCoordinate(n,a,d,_){return Qy(n,a,d,!0)||new ht(0,0)}pointCoordinate3D(n,a,d){const _=this.pointCoordinate(n,a,d,0);return[_.x,_.y,_.z]}isPointAboveHorizon(n,a){return!Qy(n,a.x,a.y,!1)}farthestPixelDistance(n){const a=function(_,f){const y=_.cameraToCenterDistance,T=_._centerAltitude*f,C=_._camera,M=_._camera.forward(),x=Se.vec3.add([],Se.vec3.scale([],M,-y),[0,0,T]),I=_.worldSize/(2*Math.PI),P=[0,0,-I],A=_.width/_.height,R=Math.tan(_.fovAboveCenter),D=Se.vec3.scale([],C.up(),R),N=Se.vec3.scale([],C.right(),R*A),j=Se.vec3.normalize([],Se.vec3.add([],Se.vec3.add([],M,D),N)),Z=[];let X;if(new Sc(x,j).closestPointOnSphere(P,I,Z)){const G=Se.vec3.add([],Z,P),J=Se.vec3.sub([],G,x);X=Math.cos(_.fovAboveCenter)*Se.vec3.length(J)}else{const G=Se.vec3.sub([],x,P),J=Se.vec3.sub([],P,x);Se.vec3.normalize(J,J);const se=Se.vec3.length(G)-I;X=Math.sqrt(se*(se+2*I));const _e=Math.acos(X/(I+se))-Math.acos(Se.vec3.dot(M,J));X*=Math.cos(_e)}return 1.01*X}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),d=Jh(n.zoom);if(d>0){const _=XI(n,Ae(1,n.center.lat)*n.worldSize),f=n.worldSize/(2*Math.PI),y=Math.max(n.width,n.height)/n.worldSize*Math.PI;return vr(a,_+f*(1-Math.cos(y)),Math.pow(d,10))}return a}upVector(n,a,d){return Dg(a,d,n,1)}upVectorScale(n){return{metersToTile:Wu(tv(su(n)))}}}function rA(u){const n=u.parallels,a=!!n&&Math.abs(n[0]+n[1])<.01;switch(u.name){case"mercator":return new JI(u);case"equirectangular":return new fN(u);case"naturalEarth":return new mN(u);case"equalEarth":return new dN(u);case"winkelTripel":return new gN(u);case"albers":return a?new tA(u):new hN(u);case"lambertConformalConic":return a?new tA(u):new pN(u);case"globe":return new _N(u)}throw new Error(`Invalid projection name: ${u.name}`)}const yN=Xp.VectorTileFeature.types,vN=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wv(u,n,a,d,_,f,y,T,C,M,x,I,P){const A=T?Math.min(rd,Math.round(T[0])):0,R=T?Math.min(rd,Math.round(T[1])):0;u.emplaceBack(n,a,Math.round(32*d),Math.round(32*_),f,y,(A<<1)+(C?1:0),R,16*M,16*x,256*I,256*P)}function Tv(u,n,a){u.emplaceBack(n,a)}function Ev(u,n,a,d,_,f,y){u.emplaceBack(n,a,d,_,f,y)}function Sv(u,n,a,d,_){u.emplaceBack(n,a,d,_),u.emplaceBack(n,a,d,_),u.emplaceBack(n,a,d,_),u.emplaceBack(n,a,d,_)}function bN(u){for(const n of u.sections)if(po(n.text))return!0;return!1}class Ux{constructor(n){this.layoutVertexArray=new bg,this.indexArray=new Ms,this.programConfigurations=n,this.segments=new To,this.dynamicLayoutVertexArray=new xc,this.opacityVertexArray=new wg,this.placedSymbolArray=new Ag,this.iconTransitioningVertexArray=new nu,this.globeExtVertexArray=new xg,this.zOffsetVertexArray=new Hh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,a,d,_,f){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,z4.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,F4.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,vN,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,U4.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,N4.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,V4.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||_)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}et(Ux,"SymbolBuffers");class jx{constructor(n,a,d){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new d,this.segments=new To,this.collisionVertexArray=new qh,this.collisionVertexArrayExt=new xc}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,j4.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,$4.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}et(jx,"CollisionBuffers");class Iv{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Se.mat4.identity([]),this.placementViewportMatrix=Se.mat4.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Px(this.zoom,a["text-size"]),this.iconSizeData=Px(this.zoom,a["icon-size"]);const d=this.layers[0].layout,_=d.get("symbol-sort-key"),f=d.get("symbol-z-order");this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&_.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(y=>Bl[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=d.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Ux(new iu(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new Ux(new iu(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new Gy,this.lineVertexArray=new qp,this.symbolInstances=new Cg}calculateGlyphDependencies(n,a,d,_,f){for(let y=0;y<n.length;y++){const T=n.codePointAt(y);if(T===void 0)break;if(a[T]=!0,_&&f&&T<=65535){const C=qg[n.charAt(y)];C&&(a[C.charCodeAt(0)]=!0)}}}updateFootprints(n,a){}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!Ex(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}populate(n,a,d,_){const f=this.layers[0],y=f.layout,T=this.projection.name==="globe",C=y.get("text-font"),M=y.get("text-field"),x=y.get("icon-image"),I=(M.value.kind!=="constant"||M.value.value instanceof ti&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),P=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,A=y.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const R=a.iconDependencies,D=a.glyphDependencies,N=a.availableImages,j=new li(this.zoom);for(const{feature:Z,id:X,index:G,sourceLayerIndex:J}of n){const se=f._featureFilter.needGeometry,_e=tr(Z,se);if(!f._featureFilter.filter(j,_e,d))continue;if(se||(_e.geometry=Qt(Z,d,_)),T&&Z.type!==1&&d.z<=5){const Ve=_e.geometry,De=.98078528056,qe=(Qe,nt)=>{const ot=Dg(Qe.x,Qe.y,d,1),lt=Dg(nt.x,nt.y,d,1);return Se.vec3.dot(ot,lt)<De};for(let Qe=0;Qe<Ve.length;Qe++)Ve[Qe]=Yt(Ve[Qe],qe)}let Ce,Pe;if(I){const Ve=f.getValueAndResolveTokens("text-field",_e,d,N),De=ti.factory(Ve);bN(De)&&(this.hasRTLText=!0),(!this.hasRTLText||ba()==="unavailable"||this.hasRTLText&&vo.isParsed())&&(Ce=H4(De,f,_e))}if(P){const Ve=f.getValueAndResolveTokens("icon-image",_e,d,N);Pe=Ve instanceof hi?Ve:hi.fromString(Ve)}if(!Ce&&!Pe)continue;const Ee=this.sortFeaturesByKey?A.evaluate(_e,{},d):void 0;if(this.features.push({id:X,text:Ce,icon:Pe,index:G,sourceLayerIndex:J,geometry:_e.geometry,properties:Z.properties,type:yN[Z.type],sortKey:Ee}),Pe&&(R[Pe.namePrimary]=!0,Pe.nameSecondary&&(R[Pe.nameSecondary]=!0)),Ce){const Ve=C.evaluate(_e,{},d).join(","),De=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Bl.vertical)>=0;for(const qe of Ce.sections)if(qe.image)R[qe.image.namePrimary]=!0;else{const Qe=Gr(Ce.toString()),nt=qe.fontStack||Ve,ot=D[nt]=D[nt]||{};this.calculateGlyphDependencies(qe.text,ot,De,this.allowVerticalPlacement,Qe)}}}y.get("symbol-placement")==="line"&&(this.features=function(Z){const X={},G={},J=[];let se=0;function _e(Ve){J.push(Z[Ve]),se++}function Ce(Ve,De,qe){const Qe=G[Ve];return delete G[Ve],G[De]=Qe,J[Qe].geometry[0].pop(),J[Qe].geometry[0]=J[Qe].geometry[0].concat(qe[0]),Qe}function Pe(Ve,De,qe){const Qe=X[De];return delete X[De],X[Ve]=Qe,J[Qe].geometry[0].shift(),J[Qe].geometry[0]=qe[0].concat(J[Qe].geometry[0]),Qe}function Ee(Ve,De,qe){const Qe=qe?De[0][De[0].length-1]:De[0][0];return`${Ve}:${Qe.x}:${Qe.y}`}for(let Ve=0;Ve<Z.length;Ve++){const De=Z[Ve],qe=De.geometry,Qe=De.text?De.text.toString():null;if(!Qe){_e(Ve);continue}const nt=Ee(Qe,qe),ot=Ee(Qe,qe,!0);if(nt in G&&ot in X&&G[nt]!==X[ot]){const lt=Pe(nt,ot,qe),yt=Ce(nt,ot,J[lt].geometry);delete X[nt],delete G[ot],G[Ee(Qe,J[yt].geometry,!0)]=yt,J[lt].geometry=null}else nt in G?Ce(nt,ot,qe):ot in X?Pe(nt,ot,qe):(_e(Ve),X[nt]=se-1,G[ot]=se-1)}return J.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,X)=>Z.sortKey-X.sortKey)}update(n,a,d,_,f){const y=Object.keys(n).length!==0;if(y&&!this.stateDependentLayers.length)return;const T=y?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,a,T,d,_,f),this.icon.programConfigurations.updatePaintArrays(n,a,T,d,_,f)}updateZOffset(){const n=(f,y,T)=>{d+=y,d>f.length&&f.resize(d);for(let C=-y;C<0;C++)f.emplace(C+d,T)},a=(f,y,T)=>{_+=y,_>f.length&&f.resize(_);for(let C=-y;C<0;C++)f.emplace(C+_,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,_=0;for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:C,numIconVertices:M}=y,x=y.zOffset,I=M>0;if((T>0||C>0)&&(n(this.text.zOffsetVertexArray,T,x),n(this.text.zOffsetVertexArray,C,x)),I){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:A}=y;P>=0&&a(this.icon.zOffsetVertexArray,M,x),A>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=rA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const d=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:_,y:f}of a)this.lineVertexArray.emplaceBack(_,f);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,a,d,_,f,y,T,C,M,x,I,P,A,R,D,N){const j=n.indexArray,Z=n.layoutVertexArray,X=n.globeExtVertexArray,G=n.segments.prepareSegment(4*a.length,Z,j,this.canOverlap?y.sortKey:void 0),J=this.glyphOffsetArray.length,se=G.vertexLength,_e=this.allowVerticalPlacement&&T===Bl.vertical?Math.PI/2:0,Ce=y.text&&y.text.sections;for(let Ee=0;Ee<a.length;Ee++){const{tl:Ve,tr:De,bl:qe,br:Qe,texPrimary:nt,texSecondary:ot,pixelOffsetTL:lt,pixelOffsetBR:yt,minFontScaleX:ut,minFontScaleY:Mt,glyphOffset:Vt,isSDF:Tt,sectionIndex:wr}=a[Ee],dr=G.vertexLength,er=Vt[1];if(wv(Z,M.x,M.y,Ve.x,er+Ve.y,nt.x,nt.y,d,Tt,lt.x,lt.y,ut,Mt),wv(Z,M.x,M.y,De.x,er+De.y,nt.x+nt.w,nt.y,d,Tt,yt.x,lt.y,ut,Mt),wv(Z,M.x,M.y,qe.x,er+qe.y,nt.x,nt.y+nt.h,d,Tt,lt.x,yt.y,ut,Mt),wv(Z,M.x,M.y,Qe.x,er+Qe.y,nt.x+nt.w,nt.y+nt.h,d,Tt,yt.x,yt.y,ut,Mt),C){const{x:qt,y:Vr,z:xr}=C.anchor,[Ir,tn,gn]=C.up;Ev(X,qt,Vr,xr,Ir,tn,gn),Ev(X,qt,Vr,xr,Ir,tn,gn),Ev(X,qt,Vr,xr,Ir,tn,gn),Ev(X,qt,Vr,xr,Ir,tn,gn),Sv(n.dynamicLayoutVertexArray,qt,Vr,xr,_e)}else Sv(n.dynamicLayoutVertexArray,M.x,M.y,M.z,_e);if(N){const qt=ot||nt;Tv(n.iconTransitioningVertexArray,qt.x,qt.y),Tv(n.iconTransitioningVertexArray,qt.x+qt.w,qt.y),Tv(n.iconTransitioningVertexArray,qt.x,qt.y+qt.h),Tv(n.iconTransitioningVertexArray,qt.x+qt.w,qt.y+qt.h)}j.emplaceBack(dr,dr+1,dr+2),j.emplaceBack(dr+1,dr+2,dr+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Vt[0]),Ee!==a.length-1&&wr===a[Ee+1].sectionIndex||n.programConfigurations.populatePaintArrays(Z.length,y,y.index,{},A,R,D,Ce&&Ce[wr])}const Pe=C?C.anchor:M;n.placedSymbolArray.emplaceBack(Pe.x,Pe.y,Pe.z,M.x,M.y,J,this.glyphOffsetArray.length-J,se,x,I,M.segment,d?d[0]:0,d?d[1]:0,_[0],_[1],T,0,!1,0,P,0)}_commitLayoutVertex(n,a,d,_,f,y,T){n.emplaceBack(a,d,_,f,y,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(n,a,d,_,f,y,T){const C=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),M=C.vertexLength,x=T.tileAnchorX,I=T.tileAnchorY;for(let A=0;A<4;A++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,a,n.padding,T.zOffset),this._commitLayoutVertex(d.layoutVertexArray,_,f,y,x,I,new We(n.x1,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,_,f,y,x,I,new We(n.x2,n.y1)),this._commitLayoutVertex(d.layoutVertexArray,_,f,y,x,I,new We(n.x2,n.y2)),this._commitLayoutVertex(d.layoutVertexArray,_,f,y,x,I,new We(n.x1,n.y2)),C.vertexLength+=4;const P=d.indexArray;P.emplaceBack(M,M+1),P.emplaceBack(M+1,M+2),P.emplaceBack(M+2,M+3),P.emplaceBack(M+3,M),C.primitiveLength+=4}_addTextDebugCollisionBoxes(n,a,d,_,f,y){for(let T=_;T<f;T++){const C=d.get(T),M=this.getSymbolInstanceTextSize(n,y,a,T);this._addCollisionDebugVertices(C,M,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(n,a,d,_,f,y){for(let T=_;T<f;T++){const C=d.get(T),M=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(C,M,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,y)}}generateCollisionDebugBuffers(n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new jx(Gu,EI.members,nu),this.iconCollisionBox=new jx(Gu,EI.members,nu);const d=Yp(this.iconSizeData,n),_=Yp(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(_,n,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(_,n,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(d,n,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(d,n,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(n,a,d,_){const f=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:_),y=fv(this.textSizeData,n,f)/js;return this.tilePixelRatio*y}getSymbolInstanceIconSize(n,a,d){const _=this.icon.placedSymbolArray.get(d),f=fv(this.iconSizeData,n,_);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(n,a,d,_){n.emplaceBack(a,-d,-d,_),n.emplaceBack(a,d,-d,_),n.emplaceBack(a,d,d,_),n.emplaceBack(a,-d,d,_)}_updateTextDebugCollisionBoxes(n,a,d,_,f,y){for(let T=_;T<f;T++){const C=d.get(T),M=this.getSymbolInstanceTextSize(n,y,a,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,C.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(n,a,d,_,f,y){for(let T=_;T<f;T++){const C=d.get(T),M=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,C.padding,y.zOffset)}}updateCollisionDebugBuffers(n,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=Yp(this.iconSizeData,n),_=Yp(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(_,n,a,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(_,n,a,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(d,n,a,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._updateIconDebugCollisionBoxes(d,n,a,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,a,d,_,f,y,T,C,M){const x={};if(a<d){const{x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G,featureIndex:J}=n.get(a);x.textBox={x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G},x.textFeatureIndex=J}if(_<f){const{x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G,featureIndex:J}=n.get(_);x.verticalTextBox={x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G},x.verticalTextFeatureIndex=J}if(y<T){const{x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G,featureIndex:J}=n.get(y);x.iconBox={x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G},x.iconFeatureIndex=J}if(C<M){const{x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G,featureIndex:J}=n.get(C);x.verticalIconBox={x1:I,y1:P,x2:A,y2:R,padding:D,projectedAnchorX:N,projectedAnchorY:j,projectedAnchorZ:Z,tileAnchorX:X,tileAnchorY:G},x.verticalIconFeatureIndex=J}return x}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,a){const d=n.placedSymbolArray.get(a),_=d.vertexStartIndex+4*d.numGlyphs;for(let f=d.vertexStartIndex;f<_;f+=4)n.indexArray.emplaceBack(f,f+1,f+2),n.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),d=Math.cos(n),_=[],f=[],y=[];for(let T=0;T<this.symbolInstances.length;++T){y.push(T);const C=this.symbolInstances.get(T);_.push(0|Math.round(a*C.tileAnchorX+d*C.tileAnchorY)),f.push(C.featureIndex)}return y.sort((T,C)=>_[T]-_[C]||f[C]-f[T]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,a){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:M}=d;_>=0&&this.addIndicesForPlacedSymbol(this.text,_),f>=0&&f!==_&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&y!==f&&y!==_&&this.addIndicesForPlacedSymbol(this.text,y),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let nA,iA,$x;et(Iv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Iv.addDynamicAttributes=Sv;class oA{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Yo,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}et(oA,"FormatSectionOverride",{omit:["defaultValue"]});const Gx=()=>$x||($x={layout:nA||(nA=new qi({"symbol-placement":new Xt(mt.layout_symbol["symbol-placement"]),"symbol-spacing":new Xt(mt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xt(mt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mr(mt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xt(mt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xt(mt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Xt(mt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xt(mt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xt(mt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xt(mt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mr(mt.layout_symbol["icon-size"]),"icon-text-fit":new Mr(mt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Mr(mt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mr(mt.layout_symbol["icon-image"]),"icon-rotate":new Mr(mt.layout_symbol["icon-rotate"]),"icon-padding":new Xt(mt.layout_symbol["icon-padding"]),"icon-keep-upright":new Xt(mt.layout_symbol["icon-keep-upright"]),"icon-offset":new Mr(mt.layout_symbol["icon-offset"]),"icon-anchor":new Mr(mt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xt(mt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xt(mt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xt(mt.layout_symbol["text-rotation-alignment"]),"text-field":new Mr(mt.layout_symbol["text-field"]),"text-font":new Mr(mt.layout_symbol["text-font"]),"text-size":new Mr(mt.layout_symbol["text-size"]),"text-max-width":new Mr(mt.layout_symbol["text-max-width"]),"text-line-height":new Mr(mt.layout_symbol["text-line-height"]),"text-letter-spacing":new Mr(mt.layout_symbol["text-letter-spacing"]),"text-justify":new Mr(mt.layout_symbol["text-justify"]),"text-radial-offset":new Mr(mt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xt(mt.layout_symbol["text-variable-anchor"]),"text-anchor":new Mr(mt.layout_symbol["text-anchor"]),"text-max-angle":new Xt(mt.layout_symbol["text-max-angle"]),"text-writing-mode":new Xt(mt.layout_symbol["text-writing-mode"]),"text-rotate":new Mr(mt.layout_symbol["text-rotate"]),"text-padding":new Xt(mt.layout_symbol["text-padding"]),"text-keep-upright":new Xt(mt.layout_symbol["text-keep-upright"]),"text-transform":new Mr(mt.layout_symbol["text-transform"]),"text-offset":new Mr(mt.layout_symbol["text-offset"]),"text-allow-overlap":new Xt(mt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xt(mt.layout_symbol["text-ignore-placement"]),"text-optional":new Xt(mt.layout_symbol["text-optional"]),visibility:new Xt(mt.layout_symbol.visibility)})),paint:iA||(iA=new qi({"icon-opacity":new Mr(mt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Mr(mt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Mr(mt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Mr(mt.paint_symbol["text-emissive-strength"]),"icon-color":new Mr(mt.paint_symbol["icon-color"]),"icon-halo-color":new Mr(mt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mr(mt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mr(mt.paint_symbol["icon-halo-blur"]),"icon-translate":new Xt(mt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xt(mt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mr(mt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Mr(mt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Mr(mt.paint_symbol["text-occlusion-opacity"]),"text-color":new Mr(mt.paint_symbol["text-color"],{runtimeType:oo,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new Mr(mt.paint_symbol["text-halo-color"]),"text-halo-width":new Mr(mt.paint_symbol["text-halo-width"]),"text-halo-blur":new Mr(mt.paint_symbol["text-halo-blur"]),"text-translate":new Xt(mt.paint_symbol["text-translate"]),"text-translate-anchor":new Xt(mt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xt(mt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Xt(mt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Xt(mt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Xt(mt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Mr(mt.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new Xt(mt.paint_symbol["symbol-elevation-reference"])}))},$x);class Av extends Ps{constructor(n,a,d,_){super(n,Gx(),a,d,_),this._colorAdjustmentMatrix=Se.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,a){super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const _=[];for(const f of d)_.indexOf(f)<0&&_.push(f);this.layout._values["text-writing-mode"]=_}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,a,d,_){return this._saturation===n&&this._contrast===a&&this._brightnessMin===d&&this._brightnessMax===_||(this._colorAdjustmentMatrix=function(f,y,T,C){f=Ne(f),y=xe(y);const M=Se.mat4.create(),x=f/3,I=1-2*x,P=[I,x,x,0,x,I,x,0,x,x,I,0,0,0,0,1],A=.5-.5*y,R=C-T;return Se.mat4.multiply(M,[R,0,0,0,0,R,0,0,0,0,R,0,T,T,T,1],[y,0,0,0,0,y,0,0,0,0,y,0,A,A,A,1]),Se.mat4.multiply(M,M,P),M}(n,a,d,_),this._saturation=n,this._contrast=a,this._brightnessMin=d,this._brightnessMax=_),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,a,d,_){const f=this.layout.get(n).evaluate(a,{},d,_),y=this._unevaluatedLayout._values[n];return y.isDataDriven()||Vh(y.value)||!f?f:function(T,C){return C.replace(/{([^{}]+)}/g,(M,x)=>x in T?String(T[x]):"")}(a.properties,f)}createBucket(n){return new Iv(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Gx().paint.overridableProperties){if(!Av.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),d=new oA(a),_=new Fh(d,a.property.specification,this.scope,this.options);let f=null;f=a.value.kind==="constant"||a.value.kind==="source"?new Jc("source",_):new va("composite",_,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new Qo(a.property,f,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&Av.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const d=n.get("text-field"),_=Gx().paint.properties[a];let f=!1;const y=T=>{for(const C of T)if(_.overrides&&_.overrides.hasOverride(C))return void(f=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ti)y(d.value.value.sections);else if(d.value.kind==="source"){const T=M=>{f||(M instanceof so&&qn(M.value)===ss?y(M.value.sections):M instanceof Ro?y(M.sections):M.eachChild(T))},C=d.value;C._styleExpression&&T(C._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,a,d){return{config:new Hu(this,{zoom:a,lut:d}),overrideFog:!1}}}let sA,aA,lA,cA;var qx=Wn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Hx(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Wx(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Zx{constructor(n,a,d,_){this.context=n,this.format=d,this.useMipmap=_&&_.useMipmap,this.texture=n.gl.createTexture(),this.update(a,{premultiply:_&&_.premultiply})}update(n,a){const d=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,_=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:f}=this,{gl:y}=f,{x:T,y:C}=a&&a.position?a.position:{x:0,y:0},M=Math.max(T+d,this.size?this.size[0]:0),x=Math.max(C+_,this.size?this.size[1]:0);!this.size||this.size[0]===M&&this.size[1]===x||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||a.premultiply!==!1));const I=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&M>0&&x>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(M,x)))+1:1;y.texStorage2D(y.TEXTURE_2D,P,this.format,M,x),this.size=[M,x]}if(this.size)if(I)y.texSubImage2D(y.TEXTURE_2D,0,T,C,Hx(this.format),Wx(this.format),n);else{const P=n.data;P&&y.texSubImage2D(y.TEXTURE_2D,0,T,C,d,_,Hx(this.format),Wx(this.format),P)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(n,a,d=!1){const{context:_}=this,{gl:f}=_;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!d?n===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(n,a,d,_){const{context:f}=this,{gl:y}=f;y.bindTexture(y.TEXTURE_2D,this.texture),a!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,a),this.magFilter=a),n!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?n===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),d!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,d),this.wrapS=d),_!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,_),this.wrapT=_)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Cv{constructor(n,a){this.context=n,this.texture=a}bind(n,a){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),n!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,n),this.minFilter=n),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrapS=a)}}function Rv(u,n,a,d,_,f,y,T){const C=[u,n,1,a,d,1,_,f,1],M=[y,T,1],x=Se.mat3.adjoint([],C),[I,P,A]=Se.vec3.transformMat3(M,M,x);return Se.mat3.multiply(C,C,[I,0,0,0,P,0,0,0,A])}function uA(u,n,a,d,_,f,y,T){const C=function(M,x,I,P,A,R,D,N){const j=Rv(0,0,1,0,1,1,0,1),Z=Rv(M,x,I,P,A,R,D,N),X=Se.mat3.adjoint([],j);return Se.mat3.multiply(Z,Z,X)}(u,n,a,d,_,f,y,T);return[C[2]/C[8]/fr,C[5]/C[8]/fr]}function Pv(u){return[u[0],Math.min(Math.max(u[1],-je),je)]}class hA extends Xo{constructor(n,a,d,_){super(),this.id=n,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(_),this.options=a,this._dirty=!1}load(n,a){if(this._loaded=a||!1,this.fire(new Cs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Yi(this.map._requestManager.transformRequest(this.url,Bo.Image),(d,_)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new Qs(d)):_&&(this.image=_ instanceof HTMLImageElement?ir.getImageData(_):_,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Cv(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Cs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Cv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=n[0][1],d=n[0][1];for(const f of n)f[1]>d&&(d=f[1]),f[1]<a&&(a=f[1]);const _=(d+a)/2;if(_>je?this.onNorthPole=!0:_<-je&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=n.map(ht.fromLngLat);this.tileID=function(y){let T=1/0,C=1/0,M=-1/0,x=-1/0;for(const D of y)T=Math.min(T,D.x),C=Math.min(C,D.y),M=Math.max(M,D.x),x=Math.max(x,D.y);const I=Math.max(M-T,x-C),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),A=Math.pow(2,P);let R=Math.floor((T+M)/2*A);return R>1&&(R-=1),new ys(P,R,Math.floor((C+x)/2*A))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Cs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const j in this.tiles){const Z=this.tiles[j];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=Xg(new ys(0,0,0),this.map.transform.projection),d=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(j){const Z=j[1].x-j[0].x,X=j[1].y-j[0].y,G=j[2].x-j[1].x,J=j[2].y-j[1].y,se=j[3].x-j[2].x,_e=j[3].y-j[2].y,Ce=j[0].x-j[3].x,Pe=j[0].y-j[3].y,Ee=Z*J-G*X,Ve=G*_e-se*J,De=se*Pe-Ce*_e,qe=Ce*X-Z*Pe;return Ee>0&&Ve>0&&De>0&&qe>0||Ee<0&&Ve<0&&De<0&&qe<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const _=Xg(this.tileID,this.map.transform.projection),[f,y,T,C]=this.coordinates.map(j=>{const Z=_.projection.project(j[0],j[1]);return YI(_,Z)._round()});this.perspectiveTransform=uA(f.x,f.y,y.x,y.y,T.x,T.y,C.x,C.y);const M=this._boundsArray=new tu;M.emplaceBack(f.x,f.y,0,0),M.emplaceBack(y.x,y.y,fr,0),M.emplaceBack(C.x,C.y,0,fr),M.emplaceBack(T.x,T.y,fr,fr),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(M,qx.members),this.boundsSegments=To.simpleSegment(0,0,4,2);const x=[],I=[Pv((P=this.coordinates)[0]),Pv(P[1]),Pv(P[2]),Pv(P[3])];var P;const[A,R,D,N]=function(j){let Z=j[0][0],X=Z,G=j[0][1],J=G;for(let se=1;se<j.length;se++)j[se][0]<Z?Z=j[se][0]:j[se][0]>X&&(X=j[se][0]),j[se][1]<G?G=j[se][1]:j[se][1]>J&&(J=j[se][1]);return[Z,G,X-Z,J-G]}(I);{const j=new tu,[Z,X,G,J]=function(lt){let yt=lt[0].x,ut=yt,Mt=lt[0].y,Vt=Mt;for(let Tt=1;Tt<lt.length;Tt++)lt[Tt].x<yt?yt=lt[Tt].x:lt[Tt].x>ut&&(ut=lt[Tt].x),lt[Tt].y<Mt?Mt=lt[Tt].y:lt[Tt].y>Vt&&(Vt=lt[Tt].y);return[yt,Mt,ut-yt,Vt-Mt]}(d),se=lt=>[(lt.x-Z)/G,(lt.y-X)/J],[_e,Ce,Pe,Ee]=d.map(se),Ve=function(lt,yt,ut,Mt,Vt,Tt,wr,dr){const er=Rv(0,0,1,0,1,1,0,1),qt=Rv(lt,yt,ut,Mt,Vt,Tt,wr,dr),Vr=Se.mat3.adjoint([],qt);return Se.mat3.multiply(er,er,Vr)}(_e[0],_e[1],Ce[0],Ce[1],Pe[0],Pe[1],Ee[0],Ee[1]);this.elevatedGlobePerspectiveTransform=uA(_e[0],_e[1],Ce[0],Ce[1],Pe[0],Pe[1],Ee[0],Ee[1]);const De=(lt,yt)=>{x.push(lt.lng);const ut=Math.round((lt.lng-A)/D*fr),Mt=Math.round((lt.lat-R)/N*fr),Vt=se(yt),Tt=Se.vec3.transformMat3([],[Vt[0],Vt[1],1],Ve),wr=Math.round(Tt[0]/Tt[2]*fr),dr=Math.round(Tt[1]/Tt[2]*fr);j.emplaceBack(ut,Mt,wr,dr)},qe=d[3].x-d[0].x,Qe=d[3].y-d[0].y,nt=d[2].x-d[1].x,ot=d[2].y-d[1].y;for(let lt=0;lt<65;lt++){const yt=lt/64,ut=[d[0].x+yt*qe,d[0].y+yt*Qe],Mt=[d[1].x+yt*nt,d[1].y+yt*ot],Vt=Mt[0]-ut[0],Tt=Mt[1]-ut[1];for(let wr=0;wr<65;wr++){const dr=wr/64,er={x:ut[0]+Vt*dr,y:ut[1]+Tt*dr,z:0};De(a.projection.unproject(er.x,er.y),er)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(j,qx.members)}{this.maxLongitudeTriangleSize=0;let j=[],Z=new Ms;const X=(G,J,se)=>{Z.emplaceBack(G,J,se);const _e=x[G],Ce=x[J],Pe=x[se],Ee=Math.min(Math.min(_e,Ce),Pe),Ve=Math.max(Math.max(_e,Ce),Pe)-Ee;Ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ve),j.push(Ee+Ve/2)};for(let G=0;G<64;G++)for(let J=0;J<64;J++){const se=65*G+J,_e=se+1,Ce=se+65,Pe=Ce+1;X(se,Ce,_e),X(_e,Ce,Pe)}[j,Z]=function(G,J){const se=Array.from({length:G.length},(Pe,Ee)=>Ee);se.sort((Pe,Ee)=>G[Pe]-G[Ee]);const _e=[],Ce=new Ms;for(let Pe=0;Pe<se.length;Pe++){const Ee=se[Pe];_e.push(G[Ee]);const Ve=3*Ee,De=Ve+1;Ce.emplaceBack(J.uint16[Ve],J.uint16[De],J.uint16[De+1])}return[_e,Ce]}(j,Z),this.elevatedGlobeTrianglesCenterLongitudes=j,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(Z)}this.elevatedGlobeSegments=To.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,D/fr,0,N/fr,0,0,R,A,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const a=this.map.painter.context,d=a.gl;!this._dirty||this.texture instanceof Cv||(this.texture?this.texture.update(this.image):(this.texture=new Zx(a,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(a)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let _=(f=n+180)+360*Math.round((d[0]-f)/360);var f;const y=new To,T=(I,P)=>{y.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:a.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},C=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-_)<=C){const I=fe(d,0,d.length,_+C);return I===d.length||T(I,pt(d,I+1,d.length,_+360-C)-I),y}_<d[0]&&(_+=360);const M=pt(d,0,d.length,_-C);if(M===d.length)return T(0,d.length),y;T(0,M-0);const x=fe(d,M+1,d.length,_+C);return x!==d.length&&T(x,d.length-x),y}}const xN=(Math.pow(256,2)-1)/16907520;class dA extends Ps{constructor(n,a,d,_){super(n,{layout:lA||(lA=new qi({visibility:new Xt(mt.layout_raster.visibility)})),paint:cA||(cA=new qi({"raster-opacity":new Xt(mt.paint_raster["raster-opacity"]),"raster-color":new La(mt.paint_raster["raster-color"]),"raster-color-mix":new Xt(mt.paint_raster["raster-color-mix"]),"raster-color-range":new Xt(mt.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xt(mt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xt(mt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xt(mt.paint_raster["raster-brightness-max"]),"raster-saturation":new Xt(mt.paint_raster["raster-saturation"]),"raster-contrast":new Xt(mt.paint_raster["raster-contrast"]),"raster-resampling":new Xt(mt.paint_raster["raster-resampling"]),"raster-fade-duration":new Xt(mt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xt(mt.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xt(mt.paint_raster["raster-array-band"]),"raster-elevation":new Xt(mt.paint_raster["raster-elevation"])}))},a,d,_),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof hA&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[d,_]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(_)||d===this._curRampRange[0]&&_===this._curRampRange[1]||(this.colorRamp=Lg({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:_}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,_])}}let fA,pA,mA,gA,_A;class yA extends Ps{constructor(n,a,d,_){super(n,{layout:fA||(fA=new qi({visibility:new Xt(mt["layout_raster-particle"].visibility)})),paint:pA||(pA=new qi({"raster-particle-array-band":new Xt(mt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xt(mt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new La(mt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xt(mt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xt(mt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xt(mt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xt(mt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Xt(mt["paint_raster-particle"]["raster-particle-elevation"])}))},a,d,_),this._updateColorRamp(),this.lastInvalidatedAt=ir.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Lg({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ir.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class wN extends Ps{constructor(n,a){super(n,{},a,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function Kx(u,n,a){const d=[0,0,1],_=Se.quat.identity([]);return Se.quat.rotateY(_,_,a?-Wt(u)+Math.PI:Wt(u)),Se.quat.rotateX(_,_,-Wt(n)),Se.vec3.transformQuat(d,d,_),Se.vec3.normalize(d,d)}function vA(u,n){const a=Mv(u.projection,u.zoom,u.width,u.height),d=function(f,y,T,C,M){const x=new K(T.lng-180*id,T.lat),I=new K(T.lng+180*id,T.lat),P=f.project(x.lng,x.lat),A=f.project(I.lng,I.lat),R=-Math.atan2(A.y-P.y,A.x-P.x),D=ht.fromLngLat(T);D.y=nr(D.y,-1+id,1-id);const N=D.toLngLat(),j=f.project(N.lng,N.lat),Z=ht.fromLngLat(N);Z.x+=id;const X=Z.toLngLat(),G=f.project(X.lng,X.lat),J=xA(G.x-j.x,G.y-j.y,R),se=ht.fromLngLat(N);se.y+=id;const _e=se.toLngLat(),Ce=f.project(_e.lng,_e.lat),Pe=xA(Ce.x-j.x,Ce.y-j.y,R),Ee=Math.abs(J.x)/Math.abs(Pe.y),Ve=Se.mat4.identity([]);Se.mat4.rotateZ(Ve,Ve,-R*(1-(M?0:C)));const De=Se.mat4.identity([]);return Se.mat4.scale(De,De,[1,1-(1-Ee)*C,1]),De[4]=-Pe.x/Pe.y*C,Se.mat4.rotateZ(De,De,R),Se.mat4.multiply(De,Ve,De),De}(u.projection,0,u.center,a,n),_=bA(u);return Se.mat4.scale(d,d,[_,_,1]),d}function bA(u){const n=u.projection,a=Mv(u.projection,u.zoom,u.width,u.height),d=Xx(n,u.center),_=Xx(n,K.convert(n.center));return Math.pow(2,d*a+(1-a)*_)}function Mv(u,n,a,d,_=1/0){const f=u.range;if(!f)return 0;const y=Math.min(_,Math.max(a,d)),T=Math.log(y/1024)/Math.LN2;return Wr(f[0]+T,f[1]+T,n)}const id=1/4e4;function Xx(u,n){const a=nr(n.lat,-je,je),d=new K(n.lng-180*id,a),_=new K(n.lng+180*id,a),f=u.project(d.lng,a),y=u.project(_.lng,a),T=ht.fromLngLat(d),C=ht.fromLngLat(_),M=y.x-f.x,x=y.y-f.y,I=C.x-T.x,P=C.y-T.y,A=Math.sqrt((I*I+P*P)/(M*M+x*x));return Math.log(A)/Math.LN2}function xA(u,n,a){const d=Math.cos(a),_=Math.sin(a);return{x:u*d-n*_,y:u*_+n*d}}function wA(u,n,a){Se.mat4.identity(u),Se.mat4.rotateZ(u,u,Wt(n[2])),Se.mat4.rotateX(u,u,Wt(n[0])),Se.mat4.rotateY(u,u,Wt(n[1])),Se.mat4.scale(u,u,a),Se.mat4.multiply(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function kv(u,n,a,d,_,f,y,T){const C=[a[0]-n[0],a[1]-n[1],0],M=[d[0]-n[0],d[1]-n[1],0];if(Se.vec3.length(C)<1e-12||Se.vec3.length(M)<1e-12)return Se.quat.identity(u);const x=Se.vec3.cross([],C,M);Se.vec3.normalize(x,x),Se.vec3.subtract(M,d,n),C[2]=(f-_)*T,M[2]=(y-_)*T;const I=C;return Se.vec3.cross(I,C,M),Se.vec3.normalize(I,I),Se.quat.rotationTo(u,x,I)}function Yx(u,n,a=!1){const d=Jh(n.zoom),_=function(f,y,T){const C=y.worldSize,M=[f[12],f[13],f[14]],x=Le(M[1]/C),I=Be(M[0]/C),P=Se.mat4.identity([]),A=Ae(1,x)*C,R=Ae(1,0)*C*rt(x,y.zoom),D=1/hx(C);let N=R*D;if(T){const G=Mv(y.projection,y.zoom,y.width,y.height,1024);N=D*y.projection.pixelSpaceConversion(y.center.lat,C,G)}const j=V(x,I);Se.vec3.add(j,j,Se.vec3.scale([],Se.vec3.normalize([],j),A*N*M[2]));const Z=function(G){const J=[G[0],G[1],G[2]];let se=[0,1,0];const _e=Se.vec3.cross([],se,J);return Se.vec3.cross(se,J,_e),Se.vec3.squaredLength(se)===0&&(se=[0,1,0],Se.vec3.cross(_e,J,se)),Se.vec3.normalize(_e,_e),Se.vec3.normalize(se,se),Se.vec3.normalize(J,J),[_e[0],_e[1],_e[2],0,se[0],se[1],se[2],0,J[0],J[1],J[2],0,G[0],G[1],G[2],1]}(j);Se.mat4.scale(P,P,[N,N,N*A]),Se.mat4.translate(P,P,[-M[0],-M[1],-M[2]]);const X=Se.mat4.multiply([],y.globeMatrix,Z);return Se.mat4.multiply(X,X,P),Se.mat4.multiply(X,X,f),X}(u,n,a);if(d>0){const f=function(y,T){const C=T.worldSize,M=Ae(1,0)*C*rt(T.center.lat,T.zoom)/hx(C),x=Ae(1,T.center.lat)*C,I=Se.mat4.identity([]);return Se.mat4.rotateY(I,I,Wt(T.center.lng)),Se.mat4.rotateX(I,I,Wt(T.center.lat)),Se.mat4.translate(I,I,[0,0,i]),Se.mat4.scale(I,I,[M,M,M*x]),Se.mat4.translate(I,I,[T.point.x-.5*C,T.point.y-.5*C,0]),Se.mat4.multiply(I,I,y),Se.mat4.multiply(I,T.globeMatrix,I)}(u,n);return function(y,T,C){const M=(R,D,N)=>{const j=Se.vec3.length(R),Z=Se.vec3.length(D),X=Zu(R,D,N);return Se.vec3.scale(X,X,1/Se.vec3.length(X)*vr(j,Z,N))},x=M([y[0],y[1],y[2]],[T[0],T[1],T[2]],C),I=M([y[4],y[5],y[6]],[T[4],T[5],T[6]],C),P=M([y[8],y[9],y[10]],[T[8],T[9],T[10]],C),A=Zu([y[12],y[13],y[14]],[T[12],T[13],T[14]],C);return[x[0],x[1],x[2],0,I[0],I[1],I[2],0,P[0],P[1],P[2],0,A[0],A[1],A[2],1]}(_,f,d)}return _}function TA(u,n,a,d){const _=Fi.projectAabbCorners(d,a);let f=Number.MAX_VALUE,y=-1;for(let M=0;M<_.length;++M){const x=_[M];x[0]=(.5*x[0]+.5)*n.width,x[1]=(.5-.5*x[1])*n.height,x[2]<f&&(y=M,f=x[2])}const T=M=>new We(_[M][0],_[M][1]);let C;switch(y){case 0:case 6:C=[T(1),T(5),T(4),T(7),T(3),T(2),T(1)];break;case 1:case 7:C=[T(0),T(4),T(5),T(6),T(2),T(3),T(0)];break;case 3:case 5:C=[T(1),T(0),T(4),T(7),T(6),T(2),T(1)];break;default:C=[T(1),T(5),T(6),T(7),T(3),T(0),T(1)]}if(hr(u,C))return f}const TN=Wn([{name:"a_pos_3f",components:3,type:"Float32"}]),EN=Wn([{name:"a_color_3f",components:3,type:"Float32"}]),SN=Wn([{name:"a_color_4f",components:4,type:"Float32"}]),IN=Wn([{name:"a_uv_2f",components:2,type:"Float32"}]),AN=Wn([{name:"a_normal_3f",components:3,type:"Float32"}]),CN=Wn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),RN=Wn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),EA={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class Ov{constructor(n,a,d,_){this.message=(n?`${n}: `:"")+d,_&&(this.identifier=_),a!=null&&a.__line__&&(this.line=a.__line__)}}function SA(u,n){const a=u.indexOf("://")===-1;try{return new URL(u,a&&n?"http://example.com":void 0),!0}catch{return!1}}class IA{constructor(n,a){this.feature=n,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class AA{constructor(){this.instancedDataArray=new _f,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Jx{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,a){}populate(n,a,d,_){this.tileToMeter=Ye(d);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:T,index:C,sourceLayerIndex:M}of n){const x=T??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),I=tr(y,f);if(!this.layers[0]._featureFilter.filter(new li(this.zoom),I,d))continue;const P={id:x,sourceLayerIndex:M,index:C,geometry:f?I.geometry:Qt(y,d,_),properties:y.properties,type:y.type,patterns:{}},A=this.addFeature(P,P.geometry,I);A&&a.featureIndex.insert(y,P.geometry,C,M,this.index,this.instancesPerModel[A].instancedDataArray.length,fr/32)}this.lookup=null}update(n,a,d,_){for(const f in this.instancesPerModel){const y=this.instancesPerModel[f];for(const T in n)y.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(y.features[y.idToFeaturesIndex[T]],n[T],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const _ of d.features){const f=this.layers[0],y=_.feature,T=this.canonical,C=f.paint.get("model-rotation").evaluate(y,{},T),M=f.paint.get("model-scale").evaluate(y,{},T),x=f.paint.get("model-translation").evaluate(y,{},T);Se.vec3.exactEquals(_.rotation,C)&&Se.vec3.exactEquals(_.scale,M)&&Se.vec3.exactEquals(_.translation,x)||(this.evaluate(_,_.featureStates,d,!0),n=!0)}}return n}updateReplacement(n,a,d,_){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(Ex(this.activeReplacements,f))return!1;this.activeReplacements=f;let y=!1;for(const T in this.instancesPerModel){const C=this.instancesPerModel[T],M=C.instancedDataArray;for(const x of C.features){const I=x.instancedDataOffset,P=x.instancedDataCount;for(let A=0;A<P;A++){const R=16*(A+I);let D=M.float32[R+0];const N=D>fr;D=N?D-fr:D;const j=Math.floor(D),Z=M.float32[R+1];let X=!1;for(const G of this.activeReplacements)if(!jS(G,d,EA.Model,_)&&!(G.min.x>j||j>G.max.x||G.min.y>Z||Z>G.max.y)&&(X=ZS(WS(j,Z,n.canonical,G.footprintTileId.canonical),G.footprint),X))break;M.float32[R]=X?D+fr:D,y=y||X!==N}}}return y}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=n.createVertexBuffer(d.instancedDataArray,CN.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length!==0&&d.instancedDataBuffer&&d.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const a of this.modelUris)n.removeModel(a,"")}addFeature(n,a,d){const _=this.layers[0],f=_.layout.get("model-id").evaluate(d,{},this.canonical);if(!f)return en(`modelId is not evaluated for layer ${_.id} and it is not going to get rendered.`),f;SA(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new AA);const y=this.instancesPerModel[f],T=y.instancedDataArray,C=new IA(d,T.length);for(const M of a)for(const x of M){if(x.x<0||x.x>=fr||x.y<0||x.y>=fr)continue;const I=(this.lookupDim-1)/fr,P=this.lookupDim*(x.y*I|0)+x.x*I|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const A=T.length;T.resize(A+1),y.instancesEvaluatedElevation.push(0),T.float32[16*A]=x.x,T.float32[16*A+1]=x.y}return C.instancedDataCount=y.instancedDataArray.length-C.instancedDataOffset,C.instancedDataCount>0&&(n.id&&(y.idToFeaturesIndex[n.id]=y.features.length),y.features.push(C),this.evaluate(C,{},y,!1)),f}getModelUris(){return this.modelUris}evaluate(n,a,d,_){const f=this.layers[0],y=n.feature,T=this.canonical,C=n.rotation=f.paint.get("model-rotation").evaluate(y,a,T),M=n.scale=f.paint.get("model-scale").evaluate(y,a,T),x=n.translation=f.paint.get("model-translation").evaluate(y,a,T),I=f.paint.get("model-color").evaluate(y,a,T);I.a=f.paint.get("model-color-mix-intensity").evaluate(y,a,T);const P=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),wA(P,C,M);const A=Math.round(100*I.a)+I.b/1.05;for(let R=0;R<n.instancedDataCount;++R){const D=n.instancedDataOffset+R,N=16*D,j=d.instancedDataArray.float32;let Z=0;_&&(Z=j[N+6]-d.instancesEvaluatedElevation[D]);const X=0|j[N+1];j[N]=(0|j[N])+I.r/1.05,j[N+1]=X+I.g/1.05,j[N+2]=A,j[N+3]=1/(T.z>10?this.tileToMeter:Ye(T,X)),j[N+4]=x[0],j[N+5]=x[1],j[N+6]=x[2]+Z,j[N+7]=P[0],j[N+8]=P[1],j[N+9]=P[2],j[N+10]=P[4],j[N+11]=P[5],j[N+12]=P[6],j[N+13]=P[8],j[N+14]=P[9],j[N+15]=P[10],d.instancesEvaluatedElevation[D]=x[2]}}}let CA,RA;et(Jx,"ModelBucket",{omit:["layers"]}),et(AA,"PerModelAttributes"),et(IA,"ModelFeature");const Ef=64,rm={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function PA(u,n,a,d,_,f,y,T,C,M=!1){const x=a.zoom,I=a.project(d),P=rt(d.lat,x),A=1/P;Se.mat4.identity(u),Se.mat4.translate(u,u,[I.x+y[0]*A,I.y+y[1]*A,y[2]]);let R=1,D=1;const N=a.worldSize;if(M){if(a.projection.name==="mercator"){let G=0;a.elevation&&(G=a.elevation.getAtPointOrZero(new ht(I.x/N,I.y/N),0));const J=Se.vec4.transformMat4([],[I.x,I.y,G,1],a.projMatrix)[3]/a.cameraToCenterDistance;R=J,D=J*rt(a.center.lat,x)}else if(a.projection.name==="globe"){const G=Yx(u,a),J=Se.mat4.multiply([],a.projMatrix,G),se=[0,0,0,1];Se.vec4.transformMat4(se,se,J);const _e=se[3]/a.cameraToCenterDistance,Ce=Jh(x),Pe=a.projection.pixelsPerMeter(d.lat,N)*rt(d.lat,x),Ee=a.projection.pixelsPerMeter(a.center.lat,N)*rt(a.center.lat,x);R=_e/vr(Pe,Ze(a.center.lat),Ce),D=_e*P/Pe,R*=Ee,D*=Ee}}else R=A;Se.mat4.scale(u,u,[R,R,D]);const j=[...u],Z=n.orientation,X=[];if(wA(X,[Z[0]+_[0],Z[1]+_[1],Z[2]+_[2]],f),Se.mat4.multiply(u,j,X),T&&a.elevation){let G=0;const J=[];if(C&&a.elevation){G=function(Ce,Pe,Ee,Ve,De){const qe=Pe.elevation;if(!qe)return 0;const Qe=Fi.projectAabbCorners(Ee,Ve),nt=Ae(1,De.lat)*Pe.worldSize,ot=function(Vr,xr){const Ir=[0,0,1],tn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const gn of tn){const un=Vr[gn.corners[0]],hn=Vr[gn.corners[1]],xn=Vr[gn.corners[2]],wn=[hn[0]-un[0],hn[1]-un[1],xr*(hn[2]-un[2])],Ei=Se.vec3.cross(wn,wn,[xn[0]-un[0],xn[1]-un[1],xr*(xn[2]-un[2])]);Se.vec3.normalize(Ei,Ei),gn.dotProductWithUp=Se.vec3.dot(Ei,Ir)}return tn.sort((gn,un)=>gn.dotProductWithUp-un.dotProductWithUp),tn[0].corners}(Qe,nt),lt=Qe[ot[0]],yt=Qe[ot[1]],ut=Qe[ot[2]],Mt=Qe[ot[3]],Vt=qe.getAtPointOrZero(new ht(lt[0]/Pe.worldSize,lt[1]/Pe.worldSize),0),Tt=qe.getAtPointOrZero(new ht(yt[0]/Pe.worldSize,yt[1]/Pe.worldSize),0),wr=qe.getAtPointOrZero(new ht(ut[0]/Pe.worldSize,ut[1]/Pe.worldSize),0),dr=qe.getAtPointOrZero(new ht(Mt[0]/Pe.worldSize,Mt[1]/Pe.worldSize),0),er=(Vt+dr)/2,qt=(Tt+wr)/2;return er>qt?Tt<wr?kv(Ce,yt,Mt,lt,Tt,dr,Vt,nt):kv(Ce,ut,lt,Mt,wr,Vt,dr,nt):Vt<dr?kv(Ce,lt,yt,ut,Vt,Tt,wr,nt):kv(Ce,Mt,ut,yt,dr,wr,Tt,nt),Math.max(er,qt)}(J,a,n.aabb,u,d);const se=Se.mat4.fromQuat([],J),_e=Se.mat4.multiply([],se,X);Se.mat4.multiply(u,j,_e)}else G=a.elevation.getAtPointOrZero(new ht(I.x/N,I.y/N),0);G!==0&&(u[14]+=G)}}function t_(u,n,a=!1){u.uploaded||(u.gfxTexture=new Zx(n,u.image,a?n.gl.R8:n.gl.RGBA8,{useMipmap:u.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function PN(u,n,a){u.indexBuffer=n.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=n.createVertexBuffer(u.vertexArray,TN.members,!1,!0),u.normalArray&&(u.normalBuffer=n.createVertexBuffer(u.normalArray,AN.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=n.createVertexBuffer(u.texcoordArray,IN.members,!1,!0)),u.colorArray&&(u.colorBuffer=n.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?EN:SN).members,!1,!0)),u.featureArray&&(u.pbrBuffer=n.createVertexBuffer(u.featureArray,RN.members,!0)),u.segments=To.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const d=u.material;d.pbrMetallicRoughness.baseColorTexture&&t_(d.pbrMetallicRoughness.baseColorTexture,n),d.pbrMetallicRoughness.metallicRoughnessTexture&&t_(d.pbrMetallicRoughness.metallicRoughnessTexture,n),d.normalTexture&&t_(d.normalTexture,n),d.occlusionTexture&&t_(d.occlusionTexture,n,a),d.emissionTexture&&t_(d.emissionTexture,n)}function Qx(u,n,a){if(u.meshes)for(const d of u.meshes)PN(d,n,a);if(u.children)for(const d of u.children)Qx(d,n,a)}function Dv(u){if(u.meshes)for(const n of u.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(u.children)for(const n of u.children)Dv(n)}function e1(u){if(u.meshes)for(const a of u.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((n=a.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(u.children)for(const a of u.children)e1(a)}class nm{constructor(n,a,d){this._demTile=n,this._dem=this._demTile.dem,this._scale=a,this._offset=d}static create(n,a,d){const _=d||n.findDEMTileFor(a);if(!_||!_.dem)return;const f=_.dem,y=_.tileID,T=1<<a.canonical.z-y.canonical.z;return new nm(_,f.dim/fr/T,[(a.canonical.x/T-y.canonical.x)*f.dim,(a.canonical.y/T-y.canonical.y)*f.dim])}tileCoordToPixel(n,a){const d=a*this._scale+this._offset[1],_=Math.floor(n*this._scale+this._offset[0]),f=Math.floor(d);return new We(_,f)}getElevationAt(n,a,d,_){const f=n*this._scale+this._offset[0],y=a*this._scale+this._offset[1],T=Math.floor(f),C=Math.floor(y),M=this._dem;return _=!!_,d?vr(vr(M.get(T,C,_),M.get(T,C+1,_),y-C),vr(M.get(T+1,C,_),M.get(T+1,C+1,_),y-C),f-T):M.get(T,C,_)}getElevationAtPixel(n,a,d){return this._dem.get(n,a,!!d)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Ae(1,n)*this._dem.stride}}const t1=new Float32Array(262144),Sf=new Uint8Array(262144);function MA(u){let n=0;if(u.meshes)for(const a of u.meshes)n=Math.max(n,a.aabb.max[2]);if(u.children)for(const a of u.children)n=Math.max(n,MA(a));return n}function kA(u,n,a){if(u.meshes)for(const d of u.meshes)d.aabb.min[0]!==1/0&&a.insert(n,d.aabb.min[0],d.aabb.min[1],d.aabb.max[0],d.aabb.max[1]);if(u.children)for(const d of u.children)kA(d,n,a)}const OA=["","wall","door","roof","window","lamp","logo"];class DA{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:MA(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const a=new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==n&&(d.transformedAabb=Fi.applyTransformFast(d.aabb,this.node.matrix),a.encapsulate(d.transformedAabb)),n++;this.aabb=a}return this.aabb}}class Lv{constructor(n,a,d,_,f,y){this.id=a,this.modelTraits|=rm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=rm.HasMapboxMeshFeatures),_&&(this.modelTraits|=rm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const T of n)this.nodesInfo.push(new DA(T)),kA(T,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0)}updateFootprints(n,a){for(const d of this.getNodesInfo()){const _=d.node;_.footprint&&a.push({footprint:_.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const d of a){const _=d.node;this.uploaded?this.updatePbrBuffer(_):Qx(_,n,!0)}for(const d of a)Dv(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let a=!1;if(!n.meshes)return a;for(const d of n.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),a=!0);return a}needsReEvaluation(n,a,d){const _=n.transform.projectionOptions,f=n.style.getBrightness(),y=this.brightness!==f;return!!(!this.uploaded||this.dirty||_.name!==this.projection.name||r_(d.paint.get("model-color").value,y)||r_(d.paint.get("model-color-mix-intensity").value,y)||r_(d.paint.get("model-roughness").value,y)||r_(d.paint.get("model-emissive-strength").value,y)||r_(d.paint.get("model-height-based-emissive-strength-multiplier").value,y))&&(this.projection=_,this.brightness=f,!0)}evaluateScale(n,a){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const d=this.getNodesInfo(),_=this.id.canonical;for(const f of d){const y=f.feature;f.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},_)}}evaluate(n){const a=this.getNodesInfo();for(const d of a){if(!d.node.meshes)continue;const _=d.feature,f=d.node.meshes&&d.node.meshes[0].featureData,y=d.evaluatedColor[2],T=d.evaluatedRMEA[2],C=this.id.canonical;if(d.hasTranslucentParts=!1,f){for(let M=0;M<OA.length;M++){const x=OA[M];x.length&&(_.properties.part=x);const I=n.paint.get("model-color").evaluate(_,{},C).toRenderColor(null),P=n.paint.get("model-color-mix-intensity").evaluate(_,{},C);d.evaluatedColor[M]=[I.r,I.g,I.b,P],d.evaluatedRMEA[M][0]=n.paint.get("model-roughness").evaluate(_,{},C),d.evaluatedRMEA[M][2]=n.paint.get("model-emissive-strength").evaluate(_,{},C),d.evaluatedRMEA[M][3]=I.a,d.emissionHeightBasedParams[M]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,{},C),!d.hasTranslucentParts&&I.a<1&&(d.hasTranslucentParts=!0)}delete _.properties.part,kN(d,y!==d.evaluatedColor[2]||T!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(_,{},C);d.evaluatedScale=n.paint.get("model-scale").evaluate(_,{},C),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,a,d,_){const f=n.findDEMTileFor(d);if(f&&(f.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const y=nm.create(n,d,f);if(!y)return;this.modelTraits&rm.HasMapboxMeshFeatures&&this.updateDEM(n,y,d,_);for(const T of this.getNodesInfo()){const C=T.node;if(!C.footprint||!C.footprint.vertices||!C.footprint.vertices.length)continue;const M=C.footprint.vertices;let x=y.getElevationAt(M[0].x,M[0].y,!0,!0);for(let I=1;I<M.length;I++)x=Math.min(x,y.getElevationAt(M[I].x,M[I].y,!0,!0));C.elevation=x}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=a}}updateDEM(n,a,d,_){let f=a._dem._modifiedForSources[_];if(f===void 0&&(a._dem._modifiedForSources[_]=[],f=a._dem._modifiedForSources[_]),f.includes(d.canonical))return;const y=a._dem.dim;f.push(d.canonical);let T=!1;for(const C of this.getNodesInfo()){const M=C.node;if(!M.footprint||!M.footprint.grid)continue;const x=M.footprint.grid,I=a.tileCoordToPixel(x.min.x,x.min.y),P=a.tileCoordToPixel(x.max.x,x.max.y),A=Math.min(Math.min(y-P.y,I.x),Math.min(I.y,y-P.x));if(A<0)continue;const R=nr(A,2,5);let D=Math.max(0,I.x-R),N=Math.max(0,I.y-R),j=Math.min(P.x+R,y-1),Z=Math.min(P.y+R,y-1);for(let se=N;se<=Z;++se)for(let _e=D;_e<=j;++_e)Sf[se*y+_e]=255;let X=0,G=0;for(let se=0;se<x.cellsY;++se)for(let _e=0;_e<x.cellsX;++_e){if(!x.cells[se*x.cellsX+_e])continue;const Ce=a.tileCoordToPixel(x.min.x+_e/x.xScale,x.min.y+se/x.yScale),Pe=a.tileCoordToPixel(x.min.x+(_e+1)/x.xScale,x.min.y+(se+1)/x.yScale);for(let Ee=Ce.y;Ee<=Math.min(Pe.y+1,y-1);++Ee)for(let Ve=Ce.x;Ve<=Math.min(Pe.x+1,y-1);++Ve)Sf[Ee*y+Ve]===255&&(Sf[Ee*y+Ve]=0,X+=a.getElevationAtPixel(Ve,Ee),G++)}const J=X/G;D=Math.max(1,I.x-R),N=Math.max(1,I.y-R),j=Math.min(P.x+R,y-2),Z=Math.min(P.y+R,y-2),T=!0;for(let se=N;se<=Z;++se)for(let _e=D;_e<=j;++_e)Sf[se*y+_e]===0&&(t1[se*y+_e]=a._dem.set(_e,se,J));for(let se=1;se<R;++se){D=Math.max(1,I.x-se),N=Math.max(1,I.y-se),j=Math.min(P.x+se,y-2),Z=Math.min(P.y+se,y-2);for(let _e=N;_e<=Z;++_e)for(let Ce=D;Ce<=j;++Ce){const Pe=_e*y+Ce;if(Sf[Pe]===255){let Ee=0,Ve=0,De=-1,qe=-1;for(let Qe=-1;Qe<=1;++Qe)for(let nt=-1;nt<=1;++nt){const ot=(_e+Qe)*y+Ce+nt;if(Sf[ot]>=se)continue;const lt=t1[ot],yt=Math.abs(lt);yt>Ve&&(Ee=lt,Ve=yt,De=nt,qe=Qe)}if(Ve>.1){const Qe=1-(se+.5*Math.abs(De*qe))/R;let nt=a._dem.get(Ce,_e)+Ee*Qe;const ot=a._dem.get(Ce+De,_e+qe),lt=a._dem.get(Ce-De,_e-qe,!0);(nt-ot)*(nt-lt)>0&&(nt=(ot+lt)/2),t1[Pe]=a._dem.set(Ce,_e,nt),Sf[Pe]=se}}}}}T&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=ir.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const a of n)Dv(a.node),e1(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(n.toUnwrapped()),_=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const y=_[f].node;_[f].hiddenByReplacement=!!y.footprint&&!d.find(T=>T.footprint===y.footprint)}}getHeightAtTileCoord(n,a){const d=this.getNodesInfo(),_=[],f=[0,0,0],y=Se.mat4.identity([]);for(let T=0;T<this.nodesInfo.length;T++){const C=d[T],M=C.node.meshes[0],x=M.transformedAabb;if(n<x.min[0]||a<x.min[1]||n>x.max[0]||a>x.max[1])continue;if(C.node.hidden===!0)return{height:1/0,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};Se.mat4.invert(y,C.node.matrix),f[0]=n,f[1]=a,Se.vec3.transformMat4(f,f,y);const I=(f[0]-M.aabb.min[0])/(M.aabb.max[0]-M.aabb.min[0])*Ef|0,P=Math.min(63,(f[1]-M.aabb.min[1])/(M.aabb.max[1]-M.aabb.min[1])*Ef|0)*Ef+Math.min(63,I),A=M.heightmap[P];if(!(A<0&&C.node.footprint))return C.hiddenByReplacement?void 0:{height:A,maxHeight:C.feature.properties.height,hidden:!1,verticalScale:C.evaluatedScale[2]};if(C.node.footprint.grid.query(new We(n,a),new We(n,a),_),_.length>0)return{height:void 0,maxHeight:C.feature.properties.height,hidden:C.hiddenByReplacement,verticalScale:C.evaluatedScale[2]}}}}function r_(u,n){return!u.isLightConstant&&n}function MN(u,n,a,d,_,f,y,T){let C=(61440&n|(61440&n)>>4)>>8,M=(3840&n|(3840&n)>>4)>>4,x=240&n|(240&n)>>4;a[3]>0&&(C=vr(C,255*a[0],a[3]),M=vr(M,255*a[1],a[3]),x=vr(x,255*a[2],a[3]));const I=C<<8|M,P=x<<8|Math.floor(255*d[3]),A=function(se){const _e=nr(se,0,2);return Math.min(Math.round(.5*_e*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],R=nr(_[0],0,1),D=nr(_[1],0,1),N=nr(_[2],0,1),j=nr(_[3],0,1);let Z,X,G,J;if(R!==D&&y!==f&&D!==R){const se=y-f;X=1/(se*(D-R)),G=-(f+se*R)/(se*(D-R));const _e=nr(_[4],-1,1);J=Math.pow(10,_e),Z=255*N<<8|255*j}else Z=65535,X=0,G=1,J=1;if(u.emplaceBack(I,P,A,Z,X,G,J),T){const se=T.length;T.clear();for(let _e=0;_e<se;_e++)T.emplaceBack(I,P,A,Z,X,G,J)}}function kN(u,n,a){const d=u.node;let _=0;const f=a&rm.HasMeshoptCompression;for(const y of d.meshes){if(d.lights&&d.lightMeshIndex===_||!y.featureData)continue;y.featureArray=new Up,y.featureArray.reserve(y.featureData.length);let T=n;for(const C of y.featureData){const M=f?65535&C:C>>16&65535,x=f?C>>16&65535:65535&C,I=(15&x)<8?15&x:0,P=u.evaluatedRMEA[I],A=u.evaluatedColor[I],R=u.emissionHeightBasedParams[I];let D;if(T&&I===2&&d.lights&&(D=new Up,D.resize(10*d.lights.length)),MN(y.featureArray,M,A,P,R,y.aabb.min[2],y.aabb.max[2],D),D&&T){T=!1;const N=d.meshes[d.lightMeshIndex];N.featureArray=D,N.featureArray._trim()}}y.featureArray._trim(),_++}}function LA(u,n,a,d){const _=1<<u.z;n.lat=Le((d/fr+u.y)/_),n.lng=Be((a/fr+u.x)/_)}et(Lv,"Tiled3dModelBucket",{omit:["layers"]}),et(DA,"Tiled3dModelFeature");const ON={circle:class extends Ps{constructor(u,n,a,d){super(u,{layout:ci||(ci=new qi({"circle-sort-key":new Mr(mt.layout_circle["circle-sort-key"]),visibility:new Xt(mt.layout_circle.visibility)})),paint:Eo||(Eo=new qi({"circle-radius":new Mr(mt.paint_circle["circle-radius"]),"circle-color":new Mr(mt.paint_circle["circle-color"]),"circle-blur":new Mr(mt.paint_circle["circle-blur"]),"circle-opacity":new Mr(mt.paint_circle["circle-opacity"]),"circle-translate":new Xt(mt.paint_circle["circle-translate"]),"circle-translate-anchor":new Xt(mt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xt(mt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xt(mt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mr(mt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mr(mt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mr(mt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xt(mt.paint_circle["circle-emissive-strength"])}))},n,a,d)}createBucket(u){return new Nr(u)}queryRadius(u){const n=u;return lo("circle-radius",this,n)+lo("circle-stroke-width",this,n)+vi(this.paint.get("circle-translate"))}queryIntersectsFeature(u,n,a,d,_,f,y,T){const C=Zn(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a);return fS(u,d,f,y,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,n,a){const d=dS(this);return{config:new Hu(this,{zoom:n,lut:a}),defines:d,overrideFog:!1}}},heatmap:class extends Ps{createBucket(u){return new mS(u)}constructor(u,n,a,d){super(u,{layout:gS||(gS=new qi({visibility:new Xt(mt.layout_heatmap.visibility)})),paint:_S||(_S=new qi({"heatmap-radius":new Mr(mt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mr(mt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xt(mt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new La(mt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xt(mt.paint_heatmap["heatmap-opacity"])}))},n,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return lo("heatmap-radius",this,u)}queryIntersectsFeature(u,n,a,d,_,f,y,T){const C=this.paint.get("heatmap-radius").evaluate(n,a);return fS(u,d,f,y,T,!0,!0,new We(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,n,a){return u==="heatmap"?{config:new Hu(this,{zoom:n,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Ps{constructor(u,n,a,d){super(u,{layout:yS||(yS=new qi({visibility:new Xt(mt.layout_hillshade.visibility)})),paint:vS||(vS=new qi({"hillshade-illumination-direction":new Xt(mt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xt(mt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xt(mt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xt(mt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xt(mt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xt(mt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xt(mt.paint_hillshade["hillshade-emissive-strength"])}))},n,a,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,n,a){return{overrideFog:!1}}},fill:class extends Ps{constructor(u,n,a,d){super(u,{layout:AS||(AS=new qi({"fill-sort-key":new Mr(mt.layout_fill["fill-sort-key"]),visibility:new Xt(mt.layout_fill.visibility)})),paint:CS||(CS=new qi({"fill-antialias":new Xt(mt.paint_fill["fill-antialias"]),"fill-opacity":new Mr(mt.paint_fill["fill-opacity"]),"fill-color":new Mr(mt.paint_fill["fill-color"]),"fill-outline-color":new Mr(mt.paint_fill["fill-outline-color"]),"fill-translate":new Xt(mt.paint_fill["fill-translate"]),"fill-translate-anchor":new Xt(mt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Mr(mt.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xt(mt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Mr(mt.paint_fill["fill-z-offset"])}))},n,a,d)}getProgramIds(){const u=this.paint.get("fill-pattern"),n=u&&u.constantOr(1),a=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(u,n,a){return{config:new Hu(this,{zoom:n,lut:a}),overrideFog:!1}}recalculate(u,n){super.recalculate(u,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new yx(u)}queryRadius(){return vi(this.paint.get("fill-translate"))}queryIntersectsFeature(u,n,a,d,_,f){return!u.queryGeometry.isAboveHorizon&&Jr(mn(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),d)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Ps{constructor(u,n,a,d){super(u,{layout:cI||(cI=new qi({visibility:new Xt(mt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xt(mt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:uI||(uI=new qi({"fill-extrusion-opacity":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Mr(mt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Xt(mt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},n,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new dv(u)}queryRadius(){return vi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,n,a,d,_,f,y,T,C){const M=Zn(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(n,a),I=this.paint.get("fill-extrusion-base").evaluate(n,a),P=[0,0],A=T&&f.elevation,R=f.elevation?f.elevation.exaggeration():1,D=u.tile.getBucket(this);if(A&&D instanceof dv){const G=D.centroidVertexArray,J=C+1;J<G.length&&(P[0]=G.geta_centroid_pos0(J),P[1]=G.geta_centroid_pos1(J))}if(P[0]===0&&P[1]===1)return!1;f.projection.name==="globe"&&(d=lI([d],[new We(0,0),new We(fr,fr)],u.tileID.canonical).map(G=>G.polygon).flat());const N=A?T:null,[j,Z]=function(G,J,se,_e,Ce,Pe,Ee,Ve,De,qe,Qe){return G.projection.name==="globe"?function(nt,ot,lt,yt,ut,Mt,Vt,Tt,wr,dr,er){const qt=[],Vr=[],xr=nt.projection.upVectorScale(er,nt.center.lat,nt.worldSize).metersToTile,Ir=[0,0,0,1],tn=[0,0,0,1],gn=(hn,xn,wn,Ei)=>{hn[0]=xn,hn[1]=wn,hn[2]=Ei,hn[3]=1},un=aI();lt>0&&(lt+=un),yt+=un;for(const hn of ot){const xn=[],wn=[];for(const Ei of hn){const ui=Ei.x+ut.x,rn=Ei.y+ut.y,ri=nt.projection.projectTilePoint(ui,rn,er),oi=nt.projection.upVector(er,Ei.x,Ei.y);let Wi=lt,Mo=yt;if(Vt){const Ho=dI(ui,rn,lt,yt,Vt,Tt,wr,dr);Wi+=Ho.base,Mo+=Ho.top}lt!==0?gn(Ir,ri.x+oi[0]*xr*Wi,ri.y+oi[1]*xr*Wi,ri.z+oi[2]*xr*Wi):gn(Ir,ri.x,ri.y,ri.z),gn(tn,ri.x+oi[0]*xr*Mo,ri.y+oi[1]*xr*Mo,ri.z+oi[2]*xr*Mo),Se.vec3.transformMat4(Ir,Ir,Mt),Se.vec3.transformMat4(tn,tn,Mt),xn.push(new Tf(Ir[0],Ir[1],Ir[2])),wn.push(new Tf(tn[0],tn[1],tn[2]))}qt.push(xn),Vr.push(wn)}return[qt,Vr]}(G,J,se,_e,Ce,Pe,Ee,Ve,De,qe,Qe):Ee?function(nt,ot,lt,yt,ut,Mt,Vt,Tt,wr){const dr=[],er=[],qt=[0,0,0,1];for(const Vr of nt){const xr=[],Ir=[];for(const tn of Vr){const gn=tn.x+yt.x,un=tn.y+yt.y,hn=dI(gn,un,ot,lt,Mt,Vt,Tt,wr);qt[0]=gn,qt[1]=un,qt[2]=hn.base,qt[3]=1,Se.vec4.transformMat4(qt,qt,ut),qt[3]=Math.max(qt[3],1e-5);const xn=new Tf(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);qt[0]=gn,qt[1]=un,qt[2]=hn.top,qt[3]=1,Se.vec4.transformMat4(qt,qt,ut),qt[3]=Math.max(qt[3],1e-5);const wn=new Tf(qt[0]/qt[3],qt[1]/qt[3],qt[2]/qt[3]);xr.push(xn),Ir.push(wn)}dr.push(xr),er.push(Ir)}return[dr,er]}(J,se,_e,Ce,Pe,Ee,Ve,De,qe):function(nt,ot,lt,yt,ut){const Mt=[],Vt=[],Tt=ut[8]*ot,wr=ut[9]*ot,dr=ut[10]*ot,er=ut[11]*ot,qt=ut[8]*lt,Vr=ut[9]*lt,xr=ut[10]*lt,Ir=ut[11]*lt;for(const tn of nt){const gn=[],un=[];for(const hn of tn){const xn=hn.x+yt.x,wn=hn.y+yt.y,Ei=ut[0]*xn+ut[4]*wn+ut[12],ui=ut[1]*xn+ut[5]*wn+ut[13],rn=ut[2]*xn+ut[6]*wn+ut[14],ri=ut[3]*xn+ut[7]*wn+ut[15],oi=Ei+Tt,Wi=ui+wr,Mo=rn+dr,Ho=Math.max(ri+er,1e-5),ko=Ei+qt,xo=ui+Vr,Ts=rn+xr,es=Math.max(ri+Ir,1e-5);gn.push(new Tf(oi/Ho,Wi/Ho,Mo/Ho)),un.push(new Tf(ko/es,xo/es,Ts/es))}Mt.push(gn),Vt.push(un)}return[Mt,Vt]}(J,se,_e,Ce,Pe)}(f,d,I,x,M,y,N,P,R,f.center.lat,u.tileID.canonical),X=u.queryGeometry;return function(G,J,se){let _e=1/0;Jr(se,J)&&(_e=hI(se,J[0]));for(let Ce=0;Ce<J.length;Ce++){const Pe=J[Ce],Ee=G[Ce];for(let Ve=0;Ve<Pe.length-1;Ve++){const De=Pe[Ve],qe=[De,Pe[Ve+1],Ee[Ve+1],Ee[Ve],De];hr(se,qe)&&(_e=Math.min(_e,hI(se,qe)))}}return _e!==1/0&&_e}(j,Z,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends Ps{constructor(u,n,a,d){const _=wI();super(u,_,n,a,d),_.layout&&(this.layout=new ws(_.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Du,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,n){super.recalculate(u,n),this.paint._values["line-floorwidth"]=(()=>{if(Gg)return Gg;const a=wI();return Gg=new B4(a.paint.properties["line-width"].specification),Gg.useIntegerZoom=!0,Gg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new Cx(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,n,a){const d=bI(this);return{config:new Hu(this,{zoom:n,lut:a}),defines:d,overrideFog:!1}}queryRadius(u){const n=u,a=TI(lo("line-width",this,n),lo("line-gap-width",this,n)),d=lo("line-offset",this,n);return a/2+Math.abs(d)+vi(this.paint.get("line-translate"))}queryIntersectsFeature(u,n,a,d,_,f){if(u.queryGeometry.isAboveHorizon)return!1;const y=mn(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),T=u.pixelToTileUnitsFactor/2*TI(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),C=this.paint.get("line-offset").evaluate(n,a);return C&&(d=function(M,x){const I=[],P=new We(0,0);for(let A=0;A<M.length;A++){const R=M[A],D=[];for(let N=0;N<R.length;N++){const j=R[N],Z=R[N+1],X=N===0?P:j.sub(R[N-1])._unit()._perp(),G=N===R.length-1?P:Z.sub(j)._unit()._perp(),J=X._add(G)._unit();J._mult(1/(J.x*G.x+J.y*G.y)),D.push(J._mult(x)._add(j))}I.push(D)}return I}(d,C*u.pixelToTileUnitsFactor)),function(M,x,I){for(let P=0;P<x.length;P++){const A=x[P];if(M.length>=3){for(let R=0;R<A.length;R++)if(Hi(M,A[R]))return!0}if(Pr(M,A,I))return!0}return!1}(y,d,T)}isTileClipped(){return!0}isDraped(u){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:Av,background:class extends Ps{constructor(u,n,a,d){super(u,{layout:sA||(sA=new qi({visibility:new Xt(mt.layout_background.visibility)})),paint:aA||(aA=new qi({"background-pitch-alignment":new Xt(mt.paint_background["background-pitch-alignment"]),"background-color":new Xt(mt.paint_background["background-color"]),"background-pattern":new Xt(mt.paint_background["background-pattern"]),"background-opacity":new Xt(mt.paint_background["background-opacity"]),"background-emissive-strength":new Xt(mt.paint_background["background-emissive-strength"])}))},n,a,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,n,a){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:dA,"raster-particle":yA,sky:class extends Ps{constructor(u,n,a,d){super(u,{layout:mA||(mA=new qi({visibility:new Xt(mt.layout_sky.visibility)})),paint:gA||(gA=new qi({"sky-type":new Xt(mt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xt(mt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xt(mt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xt(mt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xt(mt.paint_sky["sky-gradient-radius"]),"sky-gradient":new La(mt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xt(mt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xt(mt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xt(mt.paint_sky["sky-opacity"])}))},n,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(u,n){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),_=!d,f=u.style.light,y=f.properties.get("position");return _&&f.properties.get("anchor")==="viewport"&&en("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),_?Kx(y.azimuthal,90-y.polar,n):Kx(d[0],90-d[1],n)}const a=this.paint.get("sky-gradient-center");return Kx(a[0],90-a[1],n)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends Ps{constructor(u,n,a,d){super(u,{paint:_A||(_A=new qi({}))},n,null)}},model:class extends Ps{constructor(u,n,a,d){super(u,{layout:CA||(CA=new qi({visibility:new Xt(mt.layout_model.visibility),"model-id":new Mr(mt.layout_model["model-id"])})),paint:RA||(RA=new qi({"model-opacity":new Xt(mt.paint_model["model-opacity"]),"model-rotation":new Mr(mt.paint_model["model-rotation"]),"model-scale":new Mr(mt.paint_model["model-scale"]),"model-translation":new Mr(mt.paint_model["model-translation"]),"model-color":new Mr(mt.paint_model["model-color"]),"model-color-mix-intensity":new Mr(mt.paint_model["model-color-mix-intensity"]),"model-type":new Xt(mt.paint_model["model-type"]),"model-cast-shadows":new Xt(mt.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xt(mt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xt(mt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Mr(mt.paint_model["model-emissive-strength"]),"model-roughness":new Mr(mt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Mr(mt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xt(mt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Xt(mt.paint_model["model-front-cutoff"])}))},n,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Jx(u)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof Lv?fr-1:0}queryIntersectsFeature(u,n,a,d,_,f){if(!this.modelManager)return!1;const y=this.modelManager,T=u.tile.getBucket(this);if(!(T&&T instanceof Jx))return!1;const C=T;for(const M in C.instancesPerModel){const x=C.instancesPerModel[M],I=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(I)){const P=x.features[x.idToFeaturesIndex[I]],A=y.getModel(M,this.scope);if(!A)return!1;let R=Se.mat4.create();const D=new K(0,0),N=C.canonical;let j=Number.MAX_VALUE;for(let Z=0;Z<P.instancedDataCount;++Z){const X=16*(P.instancedDataOffset+Z),G=x.instancedDataArray.float32,J=[G[X+4],G[X+5],G[X+6]];LA(N,D,G[X],0|G[X+1]),PA(R,A,f,D,P.rotation,P.scale,J,!1,!1,!1),f.projection.name==="globe"&&(R=Yx(R,f));const se=Se.mat4.multiply([],f.projMatrix,R),_e=u.queryGeometry,Ce=TA(_e.isPointQuery()?_e.screenBounds:_e.screenGeometry,f,se,A.aabb);Ce!=null&&(j=Math.min(Ce,j))}return j!==Number.MAX_VALUE&&j}}return!1}_handleOverridablePaintPropertyUpdate(u,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const n=this._transitionablePaint._values[u];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof va}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(u,n,a,d){const _=u.tile,f=_.getBucket(this);let y=null,T=Number.MAX_VALUE;if(!(f&&f instanceof Lv))return{queryFeature:y,intersectionZ:T};const C=f.getNodesInfo()[n];if(C.hiddenByReplacement||!C.node.meshes||!a.filter(new li(_.tileID.overscaledZ),C.feature,_.tileID.canonical))return{queryFeature:y,intersectionZ:T};const M=C.node,x=d.calculatePosMatrix(_.tileID.toUnwrapped(),d.worldSize),I=C.evaluatedScale;let P=0;d.elevation&&M.elevation&&(P=M.elevation*d.elevation.exaggeration()),Se.mat4.translate(x,x,[(M.anchor?M.anchor[0]:0)*(I[0]-1),(M.anchor?M.anchor[1]:0)*(I[1]-1),P]),Se.mat4.scale(x,x,I),Se.mat4.multiply(x,x,M.matrix);const A=u.queryGeometry,R=A.isPointQuery()?A.screenBounds:A.screenGeometry,D=function(j){const Z=Se.mat4.multiply([],x,j.matrix),X=Se.mat4.multiply(Z,d.expandedFarZProjMatrix,Z);for(let G=0;G<j.meshes.length;++G){const J=j.meshes[G];if(G===j.lightMeshIndex)continue;const se=TA(R,d,X,J.aabb);se!=null&&(T=Math.min(se,T))}if(j.children)for(const G of j.children)D(G)};if(D(M),T===Number.MAX_VALUE)return{queryFeature:y,intersectionZ:T};const N=new K(0,0);return LA(_.tileID.canonical,N,C.node.anchor[0],C.node.anchor[1]),y={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:C.feature.properties,id:C.feature.id,state:{},layer:this.serialize()},{queryFeature:y,intersectionZ:T}}},clip:class extends Ps{constructor(u,n,a,d){super(u,{layout:RS||(RS=new qi({"clip-layer-types":new Xt(mt.layout_clip["clip-layer-types"]),"clip-layer-scope":new Xt(mt.layout_clip["clip-layer-scope"])})),paint:PS||(PS=new qi({}))},n,a,d)}recalculate(u,n){super.recalculate(u,n)}createBucket(u){return new MS(u)}isTileClipped(){return!0}is3D(){return!0}}};class DN{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class LN{constructor(){this.tasks={},this.taskQueue=[],vs(["process"],this),this.invoker=new DN(this.process),this.nextId=0}add(n,a){const d=this.nextId++,_=function({type:f,isSymbolTile:y,zoom:T}){return T=T||0,f==="message"?0:f!=="maybePrepare"||y?f!=="parseTile"||y?f==="parseTile"&&y?300-T:f==="maybePrepare"&&y?400-T:500:200-T:100-T}(a);if(_===0){try{n()}finally{}return null}return this.tasks[d]={fn:n,metadata:a,priority:_,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const a=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let n=null,a=1/0;for(let _=0;_<this.taskQueue.length;_++){const f=this.tasks[this.taskQueue[_]];f.priority<a&&(a=f.priority,n=_)}if(n===null)return null;const d=this.taskQueue[n];return this.taskQueue.splice(n,1),d}remove(){this.invoker.remove()}}class BA{constructor(n,a,d){this.target=n,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},vs(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new LN}send(n,a,d,_,f=!1,y){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=y,this.callbacks[T]=d);const C=new Set;return this.target.postMessage({id:T,type:n,hasCallback:!!d,targetMapId:_,mustQueue:f,sourceMapId:this.mapId,data:Ar(a,C)},C),{cancel:()=>{d&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:_,sourceMapId:this.mapId})}}}receive(n){const a=n.data,d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const _=this.cancelCallbacks[d];delete this.cancelCallbacks[d],_&&_.cancel()}else if(a.mustQueue||jo()){const _=this.callbacks[d],f=this.scheduler.add(()=>this.processTask(d,a),_&&_.metadata||{type:"message"});f&&(this.cancelCallbacks[d]=f)}else this.processTask(d,a)}processTask(n,a){if(delete this.cancelCallbacks[n],a.type==="<response>"){const d=this.callbacks[n];delete this.callbacks[n],d&&(a.error?d(Kr(a.error)):d(null,Kr(a.data)))}else{const d=new Set,_=a.hasCallback?(y,T)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:y?Ar(y):null,data:Ar(T,d)},d)}:y=>{},f=Kr(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,f,_);else if(this.parent.getWorkerSource){const y=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,y[0],f.source,f.scope)[y[1]](f,_)}else _(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class im{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=uo();const d=this.workerPool.acquire(this.id);for(let _=0;_<d.length;_++){const f=new im.Actor(d[_],a,this.id);f.name=`Worker ${_}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,d){Rn(this.actors,(_,f)=>{_.send(n,a,f)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}im.Actor=BA;class zA{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,a){const d=this.toIdx(n,a);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(n,a){return this.leaves[this.toIdx(n,a)]}toIdx(n,a){return a*this.size+n}}function NA(u,n,a,d){let _=0,f=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(d[y])<1e-15){if(a[y]<u[y]||a[y]>n[y])return null}else{const T=1/d[y];let C=(u[y]-a[y])*T,M=(n[y]-a[y])*T;if(C>M){const x=C;C=M,M=x}if(C>_&&(_=C),M<f&&(f=M),_>f)return null}return _}function FA(u,n,a,d,_,f,y,T,C,M,x){const I=d-u,P=_-n,A=f-a,R=y-u,D=T-n,N=C-a,j=x[1]*N-x[2]*D,Z=x[2]*R-x[0]*N,X=x[0]*D-x[1]*R,G=I*j+P*Z+A*X;if(Math.abs(G)<1e-15)return null;const J=1/G,se=M[0]-u,_e=M[1]-n,Ce=M[2]-a,Pe=(se*j+_e*Z+Ce*X)*J;if(Pe<0||Pe>1)return null;const Ee=_e*A-Ce*P,Ve=Ce*I-se*A,De=se*P-_e*I,qe=(x[0]*Ee+x[1]*Ve+x[2]*De)*J;return qe<0||Pe+qe>1?null:(R*Ee+D*Ve+N*De)*J}function VA(u,n,a){return(u-n)/(a-n)}function UA(u,n,a,d,_,f,y,T,C){const M=1<<a,x=f-d,I=y-_,P=(u+1)/M*x+d,A=(n+0)/M*I+_,R=(n+1)/M*I+_;T[0]=(u+0)/M*x+d,T[1]=A,C[0]=P,C[1]=R}class jA{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(f){const y=Math.ceil(Math.log2(f.dim/8)),T=[];let C=Math.ceil(Math.pow(2,y));const M=1/C,x=(A,R,D,N,j)=>{const Z=N?1:0,X=(A+1)*D-Z,G=R*D,J=(R+1)*D-Z;j[0]=A*D,j[1]=G,j[2]=X,j[3]=J};let I=new zA(C);const P=[];for(let A=0;A<C*C;A++){x(A%C,Math.floor(A/C),M,!1,P);const R=od(P[0],P[1],f),D=od(P[2],P[1],f),N=od(P[2],P[3],f),j=od(P[0],P[3],f);I.minimums.push(Math.min(R,D,N,j)),I.maximums.push(Math.max(R,D,N,j)),I.leaves.push(1)}for(T.push(I),C/=2;C>=1;C/=2){const A=T[T.length-1];I=new zA(C);for(let R=0;R<C*C;R++){x(R%C,Math.floor(R/C),2,!0,P);const D=A.getElevation(P[0],P[1]),N=A.getElevation(P[2],P[1]),j=A.getElevation(P[2],P[3]),Z=A.getElevation(P[0],P[3]),X=A.isLeaf(P[0],P[1]),G=A.isLeaf(P[2],P[1]),J=A.isLeaf(P[2],P[3]),se=A.isLeaf(P[0],P[3]),_e=Math.min(D.min,N.min,j.min,Z.min),Ce=Math.max(D.max,N.max,j.max,Z.max),Pe=X&&G&&J&&se;I.maximums.push(Ce),I.minimums.push(_e),I.leaves.push(Ce-_e<=5&&Pe?1:0)}T.push(I)}return T}(this.dem),d=a.length-1,_=a[d];this._addNode(_.minimums[0],_.maximums[0],_.leaves[0]),this._construct(a,0,0,d,0)}raycastRoot(n,a,d,_,f,y,T=1){return NA([n,a,-100],[d,_,this.maximums[0]*T],f,y)}raycast(n,a,d,_,f,y,T=1){if(!this.nodeCount)return null;const C=this.raycastRoot(n,a,d,_,f,y,T);if(C==null)return null;const M=[],x=[],I=[],P=[],A=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;A.length>0;){const{idx:R,t:D,nodex:N,nodey:j,depth:Z}=A.pop();if(this.leaves[R]){UA(N,j,Z,n,a,d,_,I,P);const G=1<<Z,J=(N+0)/G,se=(N+1)/G,_e=(j+0)/G,Ce=(j+1)/G,Pe=od(J,_e,this.dem)*T,Ee=od(se,_e,this.dem)*T,Ve=od(se,Ce,this.dem)*T,De=od(J,Ce,this.dem)*T,qe=FA(I[0],I[1],Pe,P[0],I[1],Ee,P[0],P[1],Ve,f,y),Qe=FA(P[0],P[1],Ve,I[0],P[1],De,I[0],I[1],Pe,f,y),nt=Math.min(qe!==null?qe:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{const ot=Se.vec3.scaleAndAdd([],f,y,D);if($A(Pe,Ee,De,Ve,VA(ot[0],I[0],P[0]),VA(ot[1],I[1],P[1]))>=ot[2])return D}continue}let X=0;for(let G=0;G<this._siblingOffset.length;G++){UA((N<<1)+this._siblingOffset[G][0],(j<<1)+this._siblingOffset[G][1],Z+1,n,a,d,_,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[R]+G]*T;const J=NA(I,P,f,y);if(J!=null){const se=J;M[G]=se;let _e=!1;for(let Ce=0;Ce<X&&!_e;Ce++)se>=M[x[Ce]]&&(x.splice(Ce,0,G),_e=!0);_e||(x[X]=G),X++}}for(let G=0;G<X;G++){const J=x[G];A.push({idx:this.childOffsets[R]+J,t:M[J],nodex:(N<<1)+this._siblingOffset[J][0],nodey:(j<<1)+this._siblingOffset[J][1],depth:Z+1})}}return null}_addNode(n,a,d){return this.minimums.push(n),this.maximums.push(a),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(n,a,d,_,f){if(n[_].isLeaf(a,d)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const y=_-1,T=n[y];let C=0,M=0;for(let x=0;x<this._siblingOffset.length;x++){const I=2*a+this._siblingOffset[x][0],P=2*d+this._siblingOffset[x][1],A=T.getElevation(I,P),R=T.isLeaf(I,P),D=this._addNode(A.min,A.max,R);R&&(C|=1<<x),M||(M=D)}for(let x=0;x<this._siblingOffset.length;x++)C&1<<x||this._construct(n,2*a+this._siblingOffset[x][0],2*d+this._siblingOffset[x][1],y,M+x)}}function $A(u,n,a,d,_,f){return vr(vr(u,a,f),vr(n,d,f),_)}function od(u,n,a){const d=a.dim,_=nr(u*d-.5,0,d-1),f=nr(n*d-.5,0,d-1),y=Math.floor(_),T=Math.floor(f),C=Math.min(y+1,d-1),M=Math.min(T+1,d-1);return $A(a.get(y,T),a.get(C,T),a.get(y,M),a.get(C,M),_-y,f-T)}const BN={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function zN(u,n,a){return(256*u*256+256*n+a)/10-1e4}function NN(u,n,a){return 256*u+n+a/256-32768}class Bv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,a,d,_=!1){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void en(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const f=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=_,this._modifiedForSources={},!_){for(let C=0;C<f;C++)y[this._idx(-1,C)]=y[this._idx(0,C)],y[this._idx(f,C)]=y[this._idx(f-1,C)],y[this._idx(C,-1)]=y[this._idx(C,0)],y[this._idx(C,f)]=y[this._idx(C,f-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(f,-1)]=y[this._idx(f-1,0)],y[this._idx(-1,f)]=y[this._idx(0,f-1)],y[this._idx(f,f)]=y[this._idx(f-1,f-1)]}const T=d==="terrarium"?NN:zN;for(let C=0;C<y.length;++C){const M=4*C;this.floatView[C]=T(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=ir.now()}_buildQuadTree(){this._tree=new jA(this)}get(n,a,d=!1){d&&(n=nr(n,-1,this.dim),a=nr(a,-1,this.dim));const _=this._idx(n,a);return this.floatView[_]}set(n,a,d){const _=this._idx(n,a),f=this.floatView[_];return this.floatView[_]=d,d-f}static getUnpackVector(n){return BN[n]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}static pack(n,a){const d=[0,0,0,0],_=Bv.getUnpackVector(a);let f=Math.floor((n+_[3])/_[2]);return d[2]=f%256,f=Math.floor(f/256),d[1]=f%256,f=Math.floor(f/256),d[0]=f,d}getPixels(){return new wS({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,a,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let _=a*this.dim,f=a*this.dim+this.dim,y=d*this.dim,T=d*this.dim+this.dim;switch(a){case-1:_=f-1;break;case 1:f=_+1}switch(d){case-1:y=T-1;break;case 1:T=y+1}const C=-a*this.dim,M=-d*this.dim;for(let x=y;x<T;x++)for(let I=_;I<f;I++){const P=4*this._idx(I,x),A=4*this._idx(I+C,x+M);this.pixels[P+0]=n.pixels[A+0],this.pixels[P+1]=n.pixels[A+1],this.pixels[P+2]=n.pixels[A+2],this.pixels[P+3]=n.pixels[A+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function FN(u,n,a){u===1?n.header_length=a.readFixed32():u===2?n.x=a.readVarint():u===3?n.y=a.readVarint():u===4?n.z=a.readVarint():u===5&&n.layers.push(function(d,_){return d.readFields(GN,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},_)}(a,a.readVarint()+a.pos))}function VN(u,n,a){u===1?(n.delta_filter=function(d,_){return d.readFields(UN,{block_size:0},_)}(a,a.readVarint()+a.pos),n.filter="delta_filter"):u===2?(a.readVarint(),n.filter="zigzag_filter"):u===3?(a.readVarint(),n.filter="bitshuffle_filter"):u===4&&(a.readVarint(),n.filter="byteshuffle_filter")}function UN(u,n,a){u===1&&(n.block_size=a.readVarint())}function jN(u,n,a){u===1?(a.readVarint(),n.codec="gzip_data"):u===2?(a.readVarint(),n.codec="jpeg_image"):u===3?(a.readVarint(),n.codec="webp_image"):u===4&&(a.readVarint(),n.codec="png_image")}function $N(u,n,a){u===1?n.first_byte=a.readFixed64():u===2?n.last_byte=a.readFixed64():u===3?n.filters.push(function(d,_){return d.readFields(VN,{},_)}(a,a.readVarint()+a.pos)):u===4?n.codec=function(d,_){return d.readFields(jN,{},_)}(a,a.readVarint()+a.pos):u===5?n.deprecated_offset=a.readFloat():u===6?n.deprecated_scale=a.readFloat():u===7?n.bands.push(a.readString()):u===8?n.offset=a.readDouble():u===9&&(n.scale=a.readDouble())}function GN(u,n,a){u===1?n.version=a.readVarint():u===2?n.name=a.readString():u===3?n.units=a.readString():u===4?n.tilesize=a.readVarint():u===5?n.buffer=a.readVarint():u===6?n.pixel_format=a.readVarint():u===7&&n.data_index.push(function(d,_){return d.readFields($N,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},_)}(a,a.readVarint()+a.pos))}function qN(u,n,a){if(u===2)(function(d,_,f){d.readFields(HN,f,_)})(a,a.readVarint()+a.pos,n);else if(u===3)throw new Error("Not implemented")}function HN(u,n,a){if(u===1){let d=0;const _=a.readVarint()+a.pos;for(;a.pos<_;)n[d++]=a.readVarint()}}et(Bv,"DEMData"),et(jA,"DemMinMaxQuadTree",{omit:["dem"]});class WN{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const a=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,a),a}put(n,a){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,a)}}function ZN(u,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let a=n[3];for(let d=2;d>=1;d--){const _=d===1?1:0,f=d===2?1:0;for(let y=0;y<n[0];y++){const T=n[1]*y;for(let C=_;C<n[1];C++){const M=n[2]*(C+T);for(let x=f;x<n[2];x++){const I=n[3]*(x+M);for(let P=0;P<n[3];P++){const A=I+P;u[A]+=u[A-a]}}}}a*=n[d]}return u}function KN(u){for(let n=0,a=u.length;n<a;n++)u[n]=u[n]>>>1^-(1&u[n]);return u}function XN(u,n){switch(n){case"uint32":return u;case"uint16":for(let a=0;a<u.length;a+=2){const d=u[a],_=u[a+1];u[a]=(240&d)>>4|(61440&d)>>8|(240&_)<<4|61440&_,u[a+1]=15&d|(3840&d)>>4|(15&_)<<8|(3840&_)<<4}return u;case"uint8":for(let a=0;a<u.length;a+=4){const d=u[a],_=u[a+1],f=u[a+2],y=u[a+3];u[a+0]=(192&d)>>6|(192&_)>>4|(192&f)>>2|192&y,u[a+1]=(48&d)>>4|(48&_)>>2|48&f|(48&y)<<2,u[a+2]=(12&d)>>2|12&_|(12&f)<<2|(12&y)<<4,u[a+3]=3&d|(3&_)<<2|(3&f)<<4|(3&y)<<6}return u;default:throw new Error(`Invalid pixel format, "${n}"`)}}var zl=Uint8Array,n_=Uint16Array,YN=Int32Array,GA=new zl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),qA=new zl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),JN=new zl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),HA=function(u,n){for(var a=new n_(31),d=0;d<31;++d)a[d]=n+=1<<u[d-1];var _=new YN(a[30]);for(d=1;d<30;++d)for(var f=a[d];f<a[d+1];++f)_[f]=f-a[d]<<5|d;return{b:a,r:_}},WA=HA(GA,2),ZA=WA.b,QN=WA.r;ZA[28]=258,QN[258]=28;for(var e5=HA(qA,0).b,KA=new n_(32768),qo=0;qo<32768;++qo){var om=(43690&qo)>>1|(21845&qo)<<1;KA[qo]=((65280&(om=(61680&(om=(52428&om)>>2|(13107&om)<<2))>>4|(3855&om)<<4))>>8|(255&om)<<8)>>1}var i_=function(u,n,a){for(var d=u.length,_=0,f=new n_(n);_<d;++_)u[_]&&++f[u[_]-1];var y,T=new n_(n);for(_=1;_<n;++_)T[_]=T[_-1]+f[_-1]<<1;y=new n_(1<<n);var C=15-n;for(_=0;_<d;++_)if(u[_])for(var M=_<<4|u[_],x=n-u[_],I=T[u[_]-1]++<<x,P=I|(1<<x)-1;I<=P;++I)y[KA[I]>>C]=M;return y},o_=new zl(288);for(qo=0;qo<144;++qo)o_[qo]=8;for(qo=144;qo<256;++qo)o_[qo]=9;for(qo=256;qo<280;++qo)o_[qo]=7;for(qo=280;qo<288;++qo)o_[qo]=8;var XA=new zl(32);for(qo=0;qo<32;++qo)XA[qo]=5;var t5=i_(o_,9),r5=i_(XA,5),r1=function(u){for(var n=u[0],a=1;a<u.length;++a)u[a]>n&&(n=u[a]);return n},Cc=function(u,n,a){var d=n/8|0;return(u[d]|u[d+1]<<8)>>(7&n)&a},n1=function(u,n){var a=n/8|0;return(u[a]|u[a+1]<<8|u[a+2]<<16)>>(7&n)},n5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rc=function(u,n,a){var d=new Error(n||n5[u]);if(d.code=u,Error.captureStackTrace&&Error.captureStackTrace(d,Rc),!a)throw d;return d},i5=new zl(0),o5=typeof TextDecoder<"u"&&new TextDecoder;try{o5.decode(i5,{stream:!0})}catch{}const s5={gzip_data:"gzip"};class Ql extends Error{constructor(n){super(n),this.name="MRTError"}}const a5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},YA={uint32:1,uint16:2,uint8:4},l5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let i1;class o1{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const a=this.layers[n];if(!a)throw new Ql(`Layer '${n}' not found`);return a}getHeaderLength(n){const a=new Uint8Array(n),d=new DataView(n);if(a[0]!==13)throw new Ql("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(n){const a=new Uint8Array(n),d=this.getHeaderLength(n);if(a.length<d)throw new Ql(`Expected header with length >= ${d} but got buffer of length ${a.length}`);const _=function(f,y){return f.readFields(FN,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new i1(a.subarray(0,d)));if(!isNaN(this.x)&&(this.x!==_.x||this.y!==_.y||this.z!==_.z))throw new Ql(`Invalid attempt to parse header ${_.z}/${_.x}/${_.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=_.x,this.y=_.y,this.z=_.z;for(const f of _.layers)this.layers[f.name]=new c5(f,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const a=[],d=this.getLayer(n.layerName);for(let _ of n.blockIndices){const f=d.dataIndex[_],y=f.first_byte-n.firstByte,T=f.last_byte-n.firstByte;if(d._blocksInProgress.has(_))continue;const C={layerName:d.name,firstByte:y,lastByte:T,pixelFormat:d.pixelFormat,blockIndex:_,blockShape:[f.bands.length].concat(d.bandShape),buffer:d.buffer,codec:f.codec.codec,filters:f.filters.map(M=>M.filter)};d._blocksInProgress.add(_),a.push(C)}return new JA(a,()=>{a.forEach(_=>d._blocksInProgress.delete(_.blockIndex))},(_,f)=>{if(a.forEach(y=>d._blocksInProgress.delete(y.blockIndex)),_)throw _;f.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class c5{constructor({version:n,name:a,units:d,tilesize:_,pixel_format:f,buffer:y,data_index:T},C){if(this.version=n,this.version!==1)throw new Ql(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=a,this.units=d,this.tileSize=_,this.buffer=y,this.pixelFormat=a5[f],this.dataIndex=T,this.bandShape=[_+2*y,_+2*y,YA[this.pixelFormat]],this._decodedBlocks=new WN(C?C.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return YA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const a=n.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,n.data)}getBlockForBand(n){let a=0;switch(typeof n){case"string":for(const[d,_]of this.dataIndex.entries()){for(const[f,y]of _.bands.entries())if(y===n)return{bandIndex:a+f,blockIndex:d,blockBandIndex:f};a+=_.bands.length}break;case"number":for(const[d,_]of this.dataIndex.entries()){if(n>=a&&n<a+_.bands.length)return{bandIndex:n,blockIndex:d,blockBandIndex:n-a};a+=_.bands.length}break;default:throw new Ql(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Ql(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let a=1/0,d=-1/0;const _=[],f=new Set;for(const y of n){const{blockIndex:T}=this.getBlockForBand(y);if(T<0)throw new Ql(`Invalid band: ${JSON.stringify(y)}`);const C=this.dataIndex[T];_.includes(T)||_.push(T),f.add(T),a=Math.min(a,C.first_byte),d=Math.max(d,C.last_byte)}if(f.size>this.cacheSize)throw new Ql(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:d,blockIndices:_}}hasBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0}hasDataForBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(n){const{blockIndex:a,blockBandIndex:d}=this.getBlockForBand(n),_=this._decodedBlocks.get(a.toString());if(!_)throw new Ql(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[a],y=this.bandShape.reduce((M,x)=>M*x,1),T=d*y,C=_.subarray(T,T+y);return{data:C,bytes:new Uint8Array(C.buffer).subarray(C.byteOffset,C.byteOffset+C.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset!==0?f.offset:f.deprecated_offset,scale:f.scale!==0?f.scale:f.deprecated_scale}}}o1.setPbf=function(u){i1=u};class JA{constructor(n,a,d){this.tasks=n,this._onCancel=a,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,a){this._finalized||(this._onComplete(n,a),this._finalized=!0)}}o1.performDecoding=function(u,n){const a=new Uint8Array(u);return Promise.all(n.tasks.map(d=>{const{layerName:_,firstByte:f,lastByte:y,pixelFormat:T,blockShape:C,blockIndex:M,filters:x,codec:I}=d,P=a.subarray(f,y+1),A=new Uint32Array(C[0]*C[1]*C[2]);let R;if(I!=="gzip_data")throw new Ql(`Unhandled codec: ${I}`);return R=function(D,N){if(!globalThis.DecompressionStream&&N==="gzip_data")return Promise.resolve(((G=function(_e){_e[0]==31&&_e[1]==139&&_e[2]==8||Rc(6,"invalid gzip data");var Ce=_e[3],Pe=10;4&Ce&&(Pe+=2+(_e[10]|_e[11]<<8));for(var Ee=(Ce>>3&1)+(Ce>>4&1);Ee>0;Ee-=!_e[Pe++]);return Pe+(2&Ce)}(X=D))+8>X.length&&Rc(6,"invalid gzip data"),function(_e,Ce,Pe,Ee){var Ve=_e.length;if(!Ve||Ce.f&&!Ce.l)return Pe||new zl(0);var De=!Pe,qe=De||Ce.i!=2,Qe=Ce.i;De&&(Pe=new zl(3*Ve));var nt,ot,lt=function(sd){var Cf=Pe.length;if(sd>Cf){var d_=new zl(Math.max(2*Cf,sd));d_.set(Pe),Pe=d_}},yt=Ce.f||0,ut=Ce.p||0,Mt=Ce.b||0,Vt=Ce.l,Tt=Ce.d,wr=Ce.m,dr=Ce.n,er=8*Ve;do{if(!Vt){yt=Cc(_e,ut,1);var qt=Cc(_e,ut+1,3);if(ut+=3,!qt){var Vr=_e[(rn=4+((ut+7)/8|0))-4]|_e[rn-3]<<8,xr=rn+Vr;if(xr>Ve){Qe&&Rc(0);break}qe&&lt(Mt+Vr),Pe.set(_e.subarray(rn,xr),Mt),Ce.b=Mt+=Vr,Ce.p=ut=8*xr,Ce.f=yt;continue}if(qt==1)Vt=t5,Tt=r5,wr=9,dr=5;else if(qt==2){var Ir=Cc(_e,ut,31)+257,tn=Cc(_e,ut+10,15)+4,gn=Ir+Cc(_e,ut+5,31)+1;ut+=14;for(var un=new zl(gn),hn=new zl(19),xn=0;xn<tn;++xn)hn[JN[xn]]=Cc(_e,ut+3*xn,7);ut+=3*tn;var wn=r1(hn),Ei=(1<<wn)-1,ui=i_(hn,wn);for(xn=0;xn<gn;){var rn,ri=ui[Cc(_e,ut,Ei)];if(ut+=15&ri,(rn=ri>>4)<16)un[xn++]=rn;else{var oi=0,Wi=0;for(rn==16?(Wi=3+Cc(_e,ut,3),ut+=2,oi=un[xn-1]):rn==17?(Wi=3+Cc(_e,ut,7),ut+=3):rn==18&&(Wi=11+Cc(_e,ut,127),ut+=7);Wi--;)un[xn++]=oi}}var Mo=un.subarray(0,Ir),Ho=un.subarray(Ir);wr=r1(Mo),dr=r1(Ho),Vt=i_(Mo,wr),Tt=i_(Ho,dr)}else Rc(1);if(ut>er){Qe&&Rc(0);break}}qe&&lt(Mt+131072);for(var ko=(1<<wr)-1,xo=(1<<dr)-1,Ts=ut;;Ts=ut){var es=(oi=Vt[n1(_e,ut)&ko])>>4;if((ut+=15&oi)>er){Qe&&Rc(0);break}if(oi||Rc(2),es<256)Pe[Mt++]=es;else{if(es==256){Ts=ut,Vt=null;break}var $s=es-254;es>264&&($s=Cc(_e,ut,(1<<(Mc=GA[xn=es-257]))-1)+ZA[xn],ut+=Mc);var Vi=Tt[n1(_e,ut)&xo],il=Vi>>4;if(Vi||Rc(3),ut+=15&Vi,Ho=e5[il],il>3){var Mc=qA[il];Ho+=n1(_e,ut)&(1<<Mc)-1,ut+=Mc}if(ut>er){Qe&&Rc(0);break}qe&&lt(Mt+131072);var ec=Mt+$s;if(Mt<Ho){var tc=0-Ho,Af=Math.min(Ho,ec);for(tc+Mt<0&&Rc(3);Mt<Af;++Mt)Pe[Mt]=(void 0)[tc+Mt]}for(;Mt<ec;++Mt)Pe[Mt]=Pe[Mt-Ho]}}Ce.l=Vt,Ce.p=Ts,Ce.b=Mt,Ce.f=yt,Vt&&(yt=1,Ce.m=wr,Ce.d=Tt,Ce.n=dr)}while(!yt);return Mt!=Pe.length&&De?(nt=Pe,((ot=Mt)==null||ot>nt.length)&&(ot=nt.length),new zl(nt.subarray(0,ot))):Pe.subarray(0,Mt)}(X.subarray(G,-8),{i:2},new zl(((j=X)[(Z=j.length)-4]|j[Z-3]<<8|j[Z-2]<<16|j[Z-1]<<24)>>>0))));var j,Z,X,G;const J=s5[N];if(!J)throw new Error(`Unhandled codec: ${N}`);const se=new globalThis.DecompressionStream(J);return new Response(new Blob([D]).stream().pipeThrough(se)).arrayBuffer().then(_e=>new Uint8Array(_e))}(P,I).then(D=>(function(N,j){N.readFields(qN,j)}(new i1(D),A),new l5[T](A.buffer))),R.then(D=>{for(let N=x.length-1;N>=0;N--)switch(x[N]){case"delta_filter":ZN(D,C);break;case"zigzag_filter":KN(D);break;case"bitshuffle_filter":XN(D,T);break;default:throw new Ql(`Unhandled filter "${x[N]}"`)}return{layerName:_,blockIndex:M,data:D}}).catch(D=>{throw D})}))},et(JA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var s_={workerUrl:"",workerClass:null,workerParams:void 0};const s1="mapboxgl_preloaded_worker_pool";class a_{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<a_.workerCount;)this.workers.push(s_.workerClass!=null?new s_.workerClass:new self.Worker(s_.workerUrl,s_.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[s1]}numActive(){return Object.keys(this.active).length}}let l_;function zv(){return l_||(l_=new a_),l_}a_.workerCount=2;let c_,a1,Pc,sm,l1,am=null;function QA(){return jo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:a1||Ke.DRACO_URL}function eC(){if(jo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(sm)return sm;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return sm=WebAssembly.validate(u)?Ke.MESHOPT_SIMD_URL:Ke.MESHOPT_URL,sm}const Nv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},u5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},u_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function tC(u,n,a){const d=a.json.bufferViews.length,_=a.buffers.length;n.bufferView=d,a.json.bufferViews[d]={buffer:_,byteLength:u.byteLength},a.buffers[_]=u}const c1="KHR_draco_mesh_compression";function h5(u,n){const a=u.extensions&&u.extensions[c1];if(!a)return;const d=new Pc.Decoder,_=oC(n,a.bufferView),f=new Pc.Mesh;if(!d.DecodeArrayToMesh(_,_.byteLength,f))throw new Error("Failed to decode Draco mesh");const y=n.json.accessors[u.indices],T=Nv[y.componentType],C=y.count*T.BYTES_PER_ELEMENT,M=Pc._malloc(C);T===Uint16Array?d.GetTrianglesUInt16Array(f,C,M):d.GetTrianglesUInt32Array(f,C,M),tC(Pc.memory.buffer.slice(M,M+C),y,n),Pc._free(M);for(const x of Object.keys(a.attributes)){const I=d.GetAttributeByUniqueId(f,a.attributes[x]),P=n.json.accessors[u.attributes[x]],A=u5[P.componentType],R=P.count*u_[P.type]*Nv[P.componentType].BYTES_PER_ELEMENT,D=Pc._malloc(R);d.GetAttributeDataArrayForAllPoints(f,I,Pc[A],R,D),tC(Pc.memory.buffer.slice(D,D+R),P,n),Pc._free(D)}d.destroy(),f.destroy(),delete u.extensions[c1]}const Fv="EXT_meshopt_compression";function d5(u,n){if(!u.extensions||!u.extensions[Fv])return;const a=u.extensions[Fv],d=new Uint8Array(n.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),_=new Uint8Array(a.count*a.byteStride);l1.decodeGltfBuffer(_,a.count,a.byteStride,d,a.mode,a.filter),u.buffer=n.buffers.length,u.byteOffset=0,n.buffers[u.buffer]=_.buffer,delete u.extensions[Fv]}const rC=1179937895,nC=new TextDecoder("utf8");function iC(u,n){return new URL(u,n).href}function f5(u,n,a,d){return fetch(iC(u.uri,d)).then(_=>_.arrayBuffer()).then(_=>{n.buffers[a]=_})}function oC(u,n){const a=u.json.bufferViews[n];return new Uint8Array(u.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function p5(u,n,a,d){if(u.uri){const _=iC(u.uri,d);return fetch(_).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{n.images[a]=f})}if(u.bufferView!==void 0){const _=oC(n,u.bufferView),f=new Blob([_],{type:u.mimeType});return createImageBitmap(f).then(y=>{n.images[a]=y})}}function sC(u,n=0,a){const d={json:null,images:[],buffers:[]};if(new Uint32Array(u,n,1)[0]===rC){const x=new Uint32Array(u,n);let I=2;const P=(x[I++]>>2)-3,A=x[I++]>>2;if(I++,d.json=JSON.parse(nC.decode(x.subarray(I,I+A))),I+=A,I<P){const R=x[I++];I++;const D=n+(I<<2);d.buffers[0]=u.slice(D,D+R)}}else d.json=JSON.parse(nC.decode(new Uint8Array(u,n)));const{buffers:_,images:f,meshes:y,extensionsUsed:T,bufferViews:C}=d.json;let M=Promise.resolve();if(_){const x=[];for(let I=0;I<_.length;I++){const P=_[I];P.uri?x.push(f5(P,d,I,a)):d.buffers[I]||(d.buffers[I]=null)}M=Promise.all(x)}return M.then(()=>{const x=[],I=T&&T.includes(c1),P=T&&T.includes(Fv);if(I&&x.push(function(){if(!Pc)return c_??(c_=function(A){let R,D=null;function N(){R=new Uint8Array(D.buffer)}function j(){throw new Error("Unexpected Draco error.")}const Z={a:{a:j,d:function(X,G,J){return R.copyWithin(X,G,G+J)},c:function(X){const G=R.length,J=Math.max(X>>>0,Math.ceil(1.2*G)),se=Math.ceil((J-G)/65536);try{return D.grow(se),N(),!0}catch{return!1}},b:j}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,Z):A.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,Z))).then(X=>{const{Rb:G,Qb:J,P:se,T:_e,X:Ce,Ja:Pe,La:Ee,Qa:Ve,Va:De,Wa:qe,eb:Qe,jb:nt,f:ot,e:lt,yb:yt,zb:ut,Ab:Mt,Bb:Vt,Db:Tt,Gb:wr}=X.instance.exports;D=lt;const dr=(()=>{let er=0,qt=0,Vr=0,xr=0;return Ir=>{Vr&&(G(xr),G(er),qt+=Vr,Vr=er=0),er||(qt+=128,er=J(qt));const tn=Ir.length+7&-8;let gn=er;tn>=qt&&(Vr=tn,gn=xr=J(tn));for(let un=0;un<Ir.length;un++)R[gn+un]=Ir[un];return gn}})();return N(),ot(),{memory:lt,_free:G,_malloc:J,Mesh:class{constructor(){this.ptr=se()}destroy(){_e(this.ptr)}},Decoder:class{constructor(){this.ptr=Pe()}destroy(){nt(this.ptr)}DecodeArrayToMesh(er,qt,Vr){const xr=dr(er),Ir=Ee(this.ptr,xr,qt,Vr.ptr);return!!Ce(Ir)}GetAttributeByUniqueId(er,qt){return{ptr:Ve(this.ptr,er.ptr,qt)}}GetTrianglesUInt16Array(er,qt,Vr){De(this.ptr,er.ptr,qt,Vr)}GetTrianglesUInt32Array(er,qt,Vr){qe(this.ptr,er.ptr,qt,Vr)}GetAttributeDataArrayForAllPoints(er,qt,Vr,xr,Ir){Qe(this.ptr,er.ptr,qt.ptr,Vr,xr,Ir)}},DT_INT8:yt(),DT_UINT8:ut(),DT_INT16:Mt(),DT_UINT16:Vt(),DT_UINT32:Tt(),DT_FLOAT32:wr()}})}(fetch(QA())),c_.then(A=>{Pc=A,c_=void 0}))}()),P&&x.push(function(){if(l1)return;const A=function(R){let D;const N=WebAssembly.instantiateStreaming(R,{}).then(X=>{D=X.instance,D.exports.__wasm_call_ctors()}),j={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(X,G,J,se,_e,Ce){(function(Pe,Ee,Ve,De,qe,Qe,nt){const ot=Pe.exports.sbrk,lt=De+3&-4,yt=ot(lt*qe),ut=ot(Qe.length),Mt=new Uint8Array(Pe.exports.memory.buffer);Mt.set(Qe,ut);const Vt=Ee(yt,De,qe,ut,Qe.length);if(Vt===0&&nt&&nt(yt,lt,qe),Ve.set(Mt.subarray(yt,yt+De*qe)),ot(yt-ot(0)),Vt!==0)throw new Error(`Malformed buffer data: ${Vt}`)})(D,D.exports[Z[_e]],X,G,J,se,D.exports[j[Ce]])}}}(fetch(eC()));return A.ready.then(()=>{l1=A})}()),f)for(let A=0;A<f.length;A++)x.push(p5(f[A],d,A,a));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(I&&y)for(const{primitives:A}of y)for(const R of A)h5(R,d);if(P&&y&&C)for(const A of C)d5(A,d);return d})})}function If(u,n){const a=u.json.bufferViews[n.bufferView],d=Nv[n.componentType];return new d(u.buffers[a.buffer],(n.byteOffset||0)+(a.byteOffset||0),n.count*(a.byteStride&&a.byteStride!==u_[n.type]*d.BYTES_PER_ELEMENT?a.byteStride/d.BYTES_PER_ELEMENT:u_[n.type]))}function u1(u,n,a,d){const _=Nv[n.componentType],f=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(_),y=u.json.bufferViews[n.bufferView],T=y.byteStride?y.byteStride/_.BYTES_PER_ELEMENT:u_[n.type],C=a.float32,M=C.length/a.capacity;for(let x=0,I=0;x<n.count*T;x+=T,I+=M)for(let P=0;P<M;P++)C[I+P]=d[x+P]*f;a._trim()}function m5(u,n,a){const d=u.indices,_=u.attributes,f={};f.indexArray=new Ms;const y=n.json.accessors[d],T=y.count/3;f.indexArray.reserve(T);const C=If(n,y);for(let P=0;P<T;P++)f.indexArray.emplaceBack(C[3*P],C[3*P+1],C[3*P+2]);f.indexArray._trim(),f.vertexArray=new ru;const M=n.json.accessors[_.POSITION];f.vertexArray.reserve(M.count);const x=If(n,M);for(let P=0;P<M.count;P++)f.vertexArray.emplaceBack(x[3*P],x[3*P+1],x[3*P+2]);if(f.vertexArray._trim(),f.aabb=new Fi(M.min,M.max),f.centroid=function(P,A){const R=[0,0,0],D=P.length;if(D>0){for(let N=0;N<D;N++){const j=3*P[N];R[0]+=A[j],R[1]+=A[j+1],R[2]+=A[j+2]}R[0]/=D,R[1]/=D,R[2]/=D}return R}(C,x),_.COLOR_0!==void 0){const P=n.json.accessors[_.COLOR_0],A=u_[P.type],R=If(n,P);f.colorArray=A===3?new ru:new xc,f.colorArray.resize(P.count),u1(n,P,f.colorArray,R)}if(_.NORMAL!==void 0){f.normalArray=new ru;const P=n.json.accessors[_.NORMAL];f.normalArray.resize(P.count);const A=If(n,P);u1(n,P,f.normalArray,A)}if(_.TEXCOORD_0!==void 0&&a.length>0){f.texcoordArray=new gf;const P=n.json.accessors[_.TEXCOORD_0];f.texcoordArray.resize(P.count);const A=If(n,P);u1(n,P,f.texcoordArray,A)}if(_._FEATURE_ID_RGBA4444!==void 0){const P=n.json.accessors[_._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=If(n,P))}_._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(If(n,n.json.accessors[_._FEATURE_RGBA4444]).buffer));const I=u.material;return f.material=function(P,A){const{emissiveFactor:R=[0,0,0],alphaMode:D="OPAQUE",alphaCutoff:N=.5,normalTexture:j,occlusionTexture:Z,emissiveTexture:X,doubleSided:G}=P,{baseColorFactor:J=[1,1,1,1],metallicFactor:se=1,roughnessFactor:_e=1,baseColorTexture:Ce,metallicRoughnessTexture:Pe}=P.pbrMetallicRoughness||{},Ee=Z?A[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&Ee){const Ve=Z.extensions.KHR_texture_transform;Ee.offsetScale=[Ve.offset[0],Ve.offset[1],Ve.scale[0],Ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Zt(...J),metallicFactor:se,roughnessFactor:_e,baseColorTexture:Ce?A[Ce.index]:void 0,metallicRoughnessTexture:Pe?A[Pe.index]:void 0},doubleSided:G,emissiveFactor:R,alphaMode:D,alphaCutoff:N,normalTexture:j?A[j.index]:void 0,occlusionTexture:Ee,emissionTexture:X?A[X.index]:void 0,defined:P.defined===void 0}}(I!==void 0?n.json.materials[I]:{defined:!1},a),f}function aC(u,n,a){const{matrix:d,rotation:_,translation:f,scale:y,mesh:T,extras:C,children:M}=u,x={};if(x.matrix=d||Se.mat4.fromRotationTranslationScale([],_||[0,0,0,1],f||[0,0,0],y||[1,1,1]),T!==void 0){x.meshes=a[T];const I=x.anchor=[0,0];for(const P of x.meshes){const{min:A,max:R}=P.aabb;I[0]+=A[0]+R[0],I[1]+=A[1]+R[1]}I[0]=Math.floor(I[0]/x.meshes.length/2),I[1]=Math.floor(I[1]/x.meshes.length/2)}if(C&&(C.id&&(x.id=C.id),C.lights&&(x.lights=function(I){if(!I.length)return[];const P=function(j){const Z=atob(j),X=new Uint8Array(Z.length);for(let G=0;G<Z.length;G++)X[G]=Z.codePointAt(G);return X}(I),A=[],R=P.length/24,D=new Uint16Array(P.buffer),N=new Float32Array(P.buffer);for(let j=0;j<R;j++){const Z=D[2*j*6]/30,X=D[2*j*6+1]/30,G=D[2*j*6+10]/100,J=N[6*j+1],se=N[6*j+2],_e=N[6*j+3],Ce=N[6*j+4],Pe=_e-J,Ee=Ce-se,Ve=Math.hypot(Pe,Ee);A.push({pos:[J+.5*Pe,se+.5*Ee,X],normal:[Ee/Ve,-Pe/Ve,0],width:Ve,height:Z,depth:G,points:[J,se,_e,Ce]})}return A}(C.lights))),M){const I=[];for(const P of M)I.push(aC(n.json.nodes[P],n,a));x.children=I}return x}function g5(u){if(u.vertices.length===0||u.indices.length===0)return null;const n=new vx(u.vertices,u.indices,8,256),[a,d]=[n.min.clone(),n.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:n,min:a,max:d}}function _5(u){if(!u.extras||!u.extras.ground)return null;const n=u.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const a=n[0];if(!a||!Array.isArray(a)||a.length===0)return null;const d=[];for(const y of a){if(!Array.isArray(y)||y.length!==2)continue;const T=y[0],C=y[1];typeof T=="number"&&typeof C=="number"&&d.push(new We(T,C))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let _=0;for(let y=0;y<d.length;y++){const T=d[y],C=d[(y+1)%d.length],M=d[(y+2)%d.length];_+=(T.x-C.x)*(M.y-C.y)-(M.x-C.x)*(T.y-C.y)}_>0&&d.reverse();const f=Bg(d.flatMap(y=>[y.x,y.y]),[]);return f.length===0?null:{vertices:d,indices:f}}function y5(u,n){const a=[],d=[];let _=0;const f=[];for(const y of u){_=a.length;const T=y.vertexArray.float32,C=y.indexArray.uint16;for(let M=0;M<y.vertexArray.length;M++)f[0]=T[3*M+0],f[1]=T[3*M+1],f[2]=T[3*M+2],Se.vec3.transformMat4(f,f,n),a.push(new We(f[0],f[1]));for(let M=0;M<3*y.indexArray.length;M++)d.push(C[M]+_)}if(d.length%3!=0)return null;for(let y=0;y<d.length;y+=3){const T=a[d[y+0]],C=a[d[y+1]],M=a[d[y+2]];(T.x-C.x)*(M.y-C.y)-(M.x-C.x)*(T.y-C.y)>0&&([d[y+1],d[y+2]]=[d[y+2],d[y+1]])}return{vertices:a,indices:d}}function lC(u){const n=function(C,M){const x=[],I=WebGL2RenderingContext;if(C.json.textures)for(const P of C.json.textures){const A={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};P.sampler!==void 0&&Object.assign(A,C.json.samplers[P.sampler]),x.push({image:M[P.source],sampler:A,uploaded:!1})}return x}(u,u.images),a=function(C,M){const x=[];for(const I of C.json.meshes){const P=[];for(const A of I.primitives)P.push(m5(A,C,M));x.push(P)}return x}(u,n),{scenes:d,scene:_,nodes:f}=u.json,y=d?d[_||0].nodes:f,T=[];for(const C of y)T.push(aC(f[C],u,a));return function(C,M,x){const I={},P=new Set;for(let A=0;A<C.length;A++){const R=x[M[A]];if(!R.extras)continue;const D=R.extras["mapbox:footprint:version"],N=R.extras["mapbox:footprint:id"];(D||N)&&P.add(A),D==="1.0.0"&&N&&(I[N]=A)}for(let A=0;A<C.length;A++){if(P.has(A))continue;const R=C[A],D=x[M[A]];if(!D.extras)continue;let N=null;R.id in I&&(N=y5(C[I[R.id]].meshes,R.matrix)),N||(N=_5(D)),N&&(R.footprint=g5(N))}if(P.size>0){const A=Array.from(P.values()).sort((R,D)=>R-D);for(let R=A.length-1;R>=0;R--)C.splice(A[R],1)}}(T,y,u.json.nodes),T}function v5(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const n=u.vertexArray.float32,a=u.aabb.min[0]-1,d=u.aabb.min[1]-1,_=Ef/(u.aabb.max[0]-a+2),f=Ef/(u.aabb.max[1]-d+2);for(let y=0;y<n.length;y+=3){const T=n[y+2],C=(n[y+0]-a)*_|0,M=(n[y+1]-d)*f|0;T>u.heightmap[M*Ef+C]&&(u.heightmap[M*Ef+C]=T)}}function b5(u,n){const a={};a.indexArray=new Ms,a.indexArray.reserve(4*u.length),a.vertexArray=new ru,a.vertexArray.reserve(10*u.length),a.colorArray=new xc,a.vertexArray.reserve(10*u.length);let d=0;for(const y of u){const T=Math.min(10,Math.max(4,1.3*y.height))*n,C=[-y.normal[1],y.normal[0],0],M=Math.min(.29,.1*y.width/y.depth),x=y.width-2*y.depth*n*(M+.01),I=Se.vec3.scaleAndAdd([],y.pos,C,x/2),P=Se.vec3.scaleAndAdd([],y.pos,C,-x/2),A=[I[0],I[1],I[2]+y.height],R=[P[0],P[1],P[2]+y.height],D=Se.vec3.scaleAndAdd([],y.normal,C,M);Se.vec3.scale(D,D,T);const N=Se.vec3.scaleAndAdd([],y.normal,C,-M);Se.vec3.scale(N,N,T),Se.vec3.add(D,I,D),Se.vec3.add(N,P,N),I[2]+=.1,P[2]+=.1,a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(N[0],N[1],N[2]),a.vertexArray.emplaceBack(I[0],I[1],I[2]),a.vertexArray.emplaceBack(P[0],P[1],P[2]),a.vertexArray.emplaceBack(A[0],A[1],A[2]),a.vertexArray.emplaceBack(R[0],R[1],R[2]),a.vertexArray.emplaceBack(I[0],I[1],I[2]),a.vertexArray.emplaceBack(P[0],P[1],P[2]),a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(N[0],N[1],N[2]);const j=x/T/2;a.colorArray.emplaceBack(-j-M,-1,j,.8),a.colorArray.emplaceBack(j+M,-1,j,.8),a.colorArray.emplaceBack(-j,0,j,1.3),a.colorArray.emplaceBack(j,0,j,1.3),a.colorArray.emplaceBack(j+M,-.8,j,.7),a.colorArray.emplaceBack(j+M,-.8,j,.7),a.colorArray.emplaceBack(0,0,j,1.3),a.colorArray.emplaceBack(0,0,j,1.3),a.colorArray.emplaceBack(j+M,-1.2,j,.8),a.colorArray.emplaceBack(j+M,-1.2,j,.8),a.indexArray.emplaceBack(6+d,4+d,8+d),a.indexArray.emplaceBack(7+d,9+d,5+d),a.indexArray.emplaceBack(0+d,1+d,2+d),a.indexArray.emplaceBack(1+d,3+d,2+d),d+=10}const _={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=Zt.white,_.pbrMetallicRoughness=f,a.material=_,a.aabb=new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}class cC{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const d=n[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const x5=["id","tile","layer","source","sourceLayer","state"];class uC{constructor(n,a,d,_,f){this.type="Feature",this._vectorTileFeature=n,this._z=a,this._x=d,this._y=_,this.properties=n.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of x5)this[a]!==void 0&&(n[a]=this[a]);return n}}class hC{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ue(fr,16,0),this.featureIndexArray=new Hy,this.promoteId=a,this.is3DTile=!1}insert(n,a,d,_,f,y=0,T=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,_,f,y);const M=this.grid;for(let x=0;x<a.length;x++){const I=a[x],P=[1/0,1/0,-1/0,-1/0];for(let A=0;A<I.length;A++){const R=I[A];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}T!==0&&(P[0]-=T,P[1]-=T,P[2]+=T,P[3]+=T),P[0]<fr&&P[1]<fr&&P[2]>=0&&P[3]>=0&&M.insert(C,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xp.VectorTile(new pv(this.rawTileData)).layers,this.sourceLayerCoder=new cC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,a,d,_){this.loadVTLayers();const f=n.params||{},y=tl(f.filter),T=n.tileResult,C=n.transform,M=T.bufferedTilespaceBounds,x=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(R,D,N,j)=>fl(T.bufferedTilespaceGeometry,R,D,N,j));x.sort(w5);let I=null;C.elevation&&x.length>0&&(I=nm.create(C.elevation,this.tileID));const P={};let A;for(let R=0;R<x.length;R++){const D=x[R];if(D===A)continue;A=D;const N=this.featureIndexArray.get(D);let j=null;if(this.is3DTile){const Z=this.bucketLayerIDs[0][0],X=a[Z];if(X.type!=="model")continue;const{queryFeature:G,intersectionZ:J}=X.queryIntersectsMatchingFeature(T,N.featureIndex,y,C);G&&this.appendToResult(P,Z,N.featureIndex,G,J)}else this.loadMatchingFeature(P,N,y,f.layers,f.availableImages,a,d,_,(Z,X,G,J=0)=>(j||(j=Qt(Z,this.tileID.canonical,n.tileTransform)),X.queryIntersectsFeature(T,Z,G,j,this.z,n.transform,n.pixelPosMatrix,I,J)))}return P}loadMatchingFeature(n,a,d,_,f,y,T,C,M){const{featureIndex:x,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:A}=a,R=this.bucketLayerIDs[I];if(_&&!function(Z,X){for(let G=0;G<Z.length;G++)if(X.indexOf(Z[G])>=0)return!0;return!1}(_,R))return;const D=this.sourceLayerCoder.decode(P),N=this.vtLayers[D].feature(x);if(d.needGeometry){const Z=tr(N,!0);if(!d.filter(new li(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!d.filter(new li(this.tileID.overscaledZ),N))return;const j=this.getId(N,D);for(let Z=0;Z<R.length;Z++){const X=R[Z];if(_&&_.indexOf(X)<0)continue;const G=y[X];if(!G)continue;let J={};j!==void 0&&C&&(J=C.getState(G.sourceLayer||"_geojsonTileLayer",j));const se=!M||M(N,G,J,A);if(!se)continue;const _e=new uC(N,this.z,this.x,this.y,j),Ce=ln({},T[X]);Ce.paint=dC(Ce.paint,G.paint,N,J,f),Ce.layout=dC(Ce.layout,G.layout,N,J,f),_e.layer=Ce,this.appendToResult(n,X,x,_e,se)}}appendToResult(n,a,d,_,f){let y=n[a];y===void 0&&(y=n[a]=[]),y.push({featureIndex:d,feature:_,intersectionZ:f})}lookupSymbolFeatures(n,a,d,_,f,y,T,C){const M={};this.loadVTLayers();const x=tl(f);for(const I of n)this.loadMatchingFeature(M,{bucketIndex:d,sourceLayerIndex:_,featureIndex:I,layoutVertexArrayOffset:0},x,y,T,C,a);return M}loadFeature(n){const{featureIndex:a,sourceLayerIndex:d}=n;this.loadVTLayers();const _=this.sourceLayerCoder.decode(d),f=this.vtFeatures[_];if(f[a])return f[a];const y=this.vtLayers[_].feature(a);return f[a]=y,y}hasLayer(n){for(const a of this.bucketLayerIDs)for(const d of a)if(n===d)return!0;return!1}getId(n,a){let d=n.id;if(this.promoteId){const _=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];_!=null&&(d=n.properties[_]),typeof d=="boolean"&&(d=Number(d))}return d}}function dC(u,n,a,d,_){return ns(u,(f,y)=>{const T=n instanceof ws?n.get(y):null;return T&&T.evaluate?T.evaluate(a,d,_):T})}function w5(u,n){return n-u}et(hC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const fC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class h1{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,d]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const _=d>>4;if(_!==1)throw new Error(`Got v${_} data when expected v1.`);const f=fC[15&d];if(!f)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new h1(T,y,f,n)}constructor(n,a=64,d=Float64Array,_){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const f=fC.indexOf(this.ArrayType),y=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-T%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${d}.`);_&&_ instanceof ArrayBuffer?(this.data=_,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+C,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+y+T+C),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+C,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=n,this.coords[this._pos++]=a,d}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return d1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,d,_){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:y,nodeSize:T}=this,C=[0,f.length-1,0],M=[];for(;C.length;){const x=C.pop()||0,I=C.pop()||0,P=C.pop()||0;if(I-P<=T){for(let N=P;N<=I;N++){const j=y[2*N],Z=y[2*N+1];j>=n&&j<=d&&Z>=a&&Z<=_&&M.push(f[N])}continue}const A=P+I>>1,R=y[2*A],D=y[2*A+1];R>=n&&R<=d&&D>=a&&D<=_&&M.push(f[A]),(x===0?n<=R:a<=D)&&(C.push(P),C.push(A-1),C.push(1-x)),(x===0?d>=R:_>=D)&&(C.push(A+1),C.push(I),C.push(1-x))}return M}within(n,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:f,nodeSize:y}=this,T=[0,_.length-1,0],C=[],M=d*d;for(;T.length;){const x=T.pop()||0,I=T.pop()||0,P=T.pop()||0;if(I-P<=y){for(let N=P;N<=I;N++)mC(f[2*N],f[2*N+1],n,a)<=M&&C.push(_[N]);continue}const A=P+I>>1,R=f[2*A],D=f[2*A+1];mC(R,D,n,a)<=M&&C.push(_[A]),(x===0?n-d<=R:a-d<=D)&&(T.push(P),T.push(A-1),T.push(1-x)),(x===0?n+d>=R:a+d>=D)&&(T.push(A+1),T.push(I),T.push(1-x))}return C}}function d1(u,n,a,d,_,f){if(_-d<=a)return;const y=d+_>>1;pC(u,n,y,d,_,f),d1(u,n,a,d,y-1,1-f),d1(u,n,a,y+1,_,1-f)}function pC(u,n,a,d,_,f){for(;_>d;){if(_-d>600){const M=_-d+1,x=a-d+1,I=Math.log(M),P=.5*Math.exp(2*I/3),A=.5*Math.sqrt(I*P*(M-P)/M)*(x-M/2<0?-1:1);pC(u,n,a,Math.max(d,Math.floor(a-x*P/M+A)),Math.min(_,Math.floor(a+(M-x)*P/M+A)),f)}const y=n[2*a+f];let T=d,C=_;for(h_(u,n,d,a),n[2*_+f]>y&&h_(u,n,d,_);T<C;){for(h_(u,n,T,C),T++,C--;n[2*T+f]<y;)T++;for(;n[2*C+f]>y;)C--}n[2*d+f]===y?h_(u,n,d,C):(C++,h_(u,n,C,_)),C<=a&&(d=C+1),a<=C&&(_=C-1)}}function h_(u,n,a,d){f1(u,a,d),f1(n,2*a,2*d),f1(n,2*a+1,2*d+1)}function f1(u,n,a){const d=u[n];u[n]=u[a],u[a]=d}function mC(u,n,a,d){const _=u-a,f=n-d;return _*_+f*f}o.$=el,o.A=class extends Ov{},o.B=Ns,o.C=ai,o.D=Vu,o.E=Xo,o.F=ff,o.G=Xc,o.H=Nh,o.I=Bx,o.J=Vh,o.K=jh,o.L=Dp,o.M=Yc,o.N=Mu,o.O=ku,o.P=We,o.Q=$c,o.R=Bo,o.S=as,o.T=Zx,o.U=Ht,o.V=Ov,o.W=Uu,o.X=hl,o.Y=zh,o.Z=function(u){const n=u.value;let a=[];if(!n)return a;const d=Ns(n);return d!=="string"?(a=a.concat([new Ov(u.key,n,`string expected, "${d}" found`)]),a):(SA(n,!0)||(a=a.concat([new Ov(u.key,n,`invalid url "${n}"`)])),a)},o._=mt,o.a=function(u){return Ke.API_CDN_URL_REGEX.test(u)},o.a$=Ig,o.a0=qi,o.a1=Xt,o.a2=class{constructor(u){this.specification=u}possiblyEvaluate(u,n){return Lo(u.expression.evaluate(n))}interpolate(u,n,a){return{x:vr(u.x,n.x,a),y:vr(u.y,n.y,a),z:vr(u.z,n.z,a),azimuthal:vr(u.azimuthal,n.azimuthal,a),polar:vr(u.polar,n.polar,a)}}},o.a3=li,o.a4=va,o.a5=ht,o.a6=Se,o.a7=Wr,o.a8=ws,o.a9=Jh,o.aA=Ni,o.aB=dA,o.aC=yA,o.aD=hA,o.aE=function(u,n){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){n(null,a)};for(let d=0;d<u.length;d++){const _=document.createElement("source");Xi(u[d])||(a.crossOrigin="Anonymous"),_.src=u[d],a.appendChild(_)}return{cancel:()=>{}}},o.aF=Cv,o.aG=function(u){return fetch(u).then(n=>n.arrayBuffer()).then(n=>sC(n,0,u))},o.aH=lC,o.aI=class{constructor(u,n,a,d){this.id=u,this.position=n!=null?new K(n[0],n[1]):new K(0,0),this.orientation=a??[0,0,0],this.nodes=d,this.uploaded=!1,this.aabb=new Fi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(u,n){if(Se.mat4.multiply(u.matrix,n,u.matrix),u.meshes)for(const a of u.meshes){const d=Fi.applyTransformFast(a.aabb,u.matrix);this.aabb.encapsulate(d)}if(u.children)for(const a of u.children)this._applyTransformations(a,u.matrix)}computeBoundsAndApplyParent(){const u=Se.mat4.identity([]);for(const n of this.nodes)this._applyTransformations(n,u)}computeModelMatrix(u,n,a,d,_,f,y=!1){PA(this.matrix,this,u.transform,this.position,n,a,d,_,f,y)}upload(u){if(!this.uploaded){for(const n of this.nodes)Qx(n,u);for(const n of this.nodes)Dv(n);this.uploaded=!0}}destroy(){for(const u of this.nodes)e1(u)}},o.aJ=vs,o.aK=Xg,o.aL=Be,o.aM=Le,o.aN=tu,o.aO=Ms,o.aP=uo,o.aQ=Gp,o.aR=Iv,o.aS=function(){vo.isLoading()||vo.isLoaded()||ba()!=="deferred"||xs()},o.aT=tl,o.aU=tr,o.aV=uC,o.aW=is,o.aX=Cx,o.aY=yx,o.aZ=Qt,o.a_=eu,o.aa=vr,o.ab=fr,o.ac=pi,o.ad=class{constructor(u){this.specification=u}possiblyEvaluate(u,n){return function([a,d]){const _=Lo([1,a,d]);return{x:_.x,y:_.y,z:_.z}}(u.expression.evaluate(n))}interpolate(u,n,a){return{x:vr(u.x,n.x,a),y:vr(u.y,n.y,a),z:vr(u.z,n.z,a)}}},o.ae=function(u,n,a=0,d=!0){const _=new We(a,a),f=u.sub(_),y=n.add(_),T=[f,new We(y.x,f.y),y,new We(f.x,y.y)];return d&&T.push(f.clone()),T},o.af=function(u,n){const a=[];for(let d=0;d<u.length;d++){const _=Zr(d-1,-1,u.length-1),f=Zr(d+1,-1,u.length-1),y=u[d],T=u[f],C=u[_].sub(y).unit(),M=T.sub(y).unit(),x=M.angleWithSep(C.x,C.y),I=C.add(M).unit().mult(-1*n/Math.sin(x/2));a.push(y.add(I))}return a},o.ag=YI,o.ah=fl,o.ai=function(u,n,a=0){return Se.vec3.fromValues(((n.x-a)*u.scale-u.x)*fr,(n.y*u.scale-u.y)*fr,He(n.z,n.y))},o.aj=Sc,o.ak=_I,o.al=function(u){let n=1/0,a=1/0,d=-1/0,_=-1/0;for(const f of u)n=Math.min(n,f.x),a=Math.min(a,f.y),d=Math.max(d,f.x),_=Math.max(_,f.y);return{min:new We(n,a),max:new We(d,_)}},o.am=Re,o.an=Hi,o.ao=Ft,o.ap=nr,o.aq=i,o.ar=function(u,n){const a={};for(let d=0;d<n.length;d++){const _=n[d];_ in u&&(a[_]=u[_])}return a},o.as=ae,o.at=Oe,o.au=class{constructor(u){this.entries={},this.scheduler=u}request(u,n,a,d){const _=this.entries[u]=this.entries[u]||{callbacks:[]};if(_.result){const[f,y]=_.result;return this.scheduler?this.scheduler.add(()=>{d(f,y)},n):d(f,y),()=>{}}return _.callbacks.push(d),_.cancel||(_.cancel=a((f,y)=>{_.result=[f,y];for(const T of _.callbacks)this.scheduler?this.scheduler.add(()=>{T(f,y)},n):T(f,y);setTimeout(()=>delete this.entries[u],3e3)})),()=>{_.result||(_.callbacks=_.callbacks.filter(f=>f!==d),_.callbacks.length||(_.cancel(),delete this.entries[u]))}}},o.av=pf,o.aw=function(u,n,a){const d=JSON.stringify(u.request);return u.data&&(this.deduped.entries[d]={result:[null,u.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},_=>{const f=Ys(u.request,(y,T,C,M)=>{y?_(y):T&&_(null,{vectorTile:a?void 0:new Xp.VectorTile(new pv(T)),rawData:T,cacheControl:C,expires:M})});return()=>{f.cancel(),_()}},n)},o.ax=function(u){Di++,Di>yn&&(u.getActor().send("enforceCacheSizeLimit",zr),Di=0)},o.ay=ur,o.az=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},o.b=function(u){return Ke.API_FONTS_REGEX.test(u)},o.b$=function(u){const{x:n,y:a}=u.point,{lng:d,lat:_}=u._center;return cS(n,a,u.worldSize,d,_)},o.b0=ml,o.b1=To,o.b2=Bg,o.b3=qx,o.b4=function(u,n){const a=Jh(n.zoom);if(a===0)return su(u);const d=ev(u),_=cx(d),f=Re(d.getWest())*n.worldSize,y=Re(d.getEast())*n.worldSize,T=Oe(d.getNorth())*n.worldSize,C=Oe(d.getSouth())*n.worldSize,M=[f,T,0],x=[y,T,0],I=[f,C,0],P=[y,C,0],A=Se.mat4.invert([],n.globeMatrix);return Se.vec3.transformMat4(M,M,A),Se.vec3.transformMat4(x,x,A),Se.vec3.transformMat4(I,I,A),Se.vec3.transformMat4(P,P,A),_[0]=Zu(_[0],I,a),_[1]=Zu(_[1],P,a),_[2]=Zu(_[2],x,a),_[3]=Zu(_[3],M,a),Fi.fromPoints(_)},o.b5=rv,o.b6=Dg,o.b7=Zu,o.b8=Np,o.b9=za,o.bA=Zr,o.bB=Wt,o.bC=$o,o.bD=Ae,o.bE=function(u,n,a){u[4*n+0]=a[0],u[4*n+1]=a[1],u[4*n+2]=a[2],u[4*n+3]=a[3]},o.bF=bf,o.bG=Kl,o.bH=Pg,o.bI=ia,o.bJ=qu,o.bK=K,o.bL=rA,o.bM=us,o.bN=Yh,o.bO=bA,o.bP=ys,o.bQ=sS,o.bR=function(u,n,a,d,_,f,y,T,C){if(C.name==="globe")return sS(u,n,new ys(a,d,_),!1);const M=Xg({z:a,x:d,y:_},C);return new Fi([(f+M.x/M.scale)*n,n*(M.y/M.scale),y],[(f+M.x2/M.scale)*n,n*(M.y2/M.scale),T])},o.bS=function(u,n,a){let d=0;for(let _=0;_<2;++_)u[_]>0&&(d+=(u[_]-0)*(u[_]-0)),n[_]<0&&(d+=(0-n[_])*(0-n[_]));return d},o.bT=je,o.bU=g,o.bV=function(u){const n=Se.mat4.identity(new Float64Array(16));Se.mat4.multiply(n,u.pixelMatrix,u.globeMatrix);const a=[0,k,0],d=[0,L,0];return Se.vec3.transformMat4(a,a,n),Se.vec3.transformMat4(d,d,n),[a[0]>0&&a[0]<=u.width&&a[1]>0&&a[1]<=u.height&&!dx(u,new K(u.center.lat,90)),d[0]>0&&d[0]<=u.width&&d[1]>0&&d[1]<=u.height&&!dx(u,new K(u.center.lat,-90))]},o.bW=function(u,n){const{scale:a}=u.tileTransform,d=a*fr/(u.tileSize*Math.pow(2,n.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return Se.mat2.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[d,d])},o.bX=Mv,o.bY=vA,o.bZ=function(u){const n=vA(u,!0);return Se.mat2.invert([],[n[0],n[1],n[4],n[5]])},o.b_=ou,o.ba=o1,o.bb=pv,o.bc=Ys,o.bd=function(u){const n=[];for(const a in u)n.push(u[a]);return n},o.be=function(u,n){const a=[];for(const d in u)d in n||a.push(d);return a},o.bf=Rn,o.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bh=zt,o.bi=function(u,n){const{x:a,y:d}=u.point,_=cS(a,d,u.worldSize/u._pixelsPerMercatorPixel,0,0);return Se.mat4.multiply(_,_,ux(su(n)))},o.bj=Yp,o.bk=Bl,o.bl=fv,o.bm=function(u,n,a,d,_){const f=5*n+2;u.float32[f+0]=a,u.float32[f+1]=d,u.float32[f+2]=_},o.bn=Sv,o.bo=VI,o.bp=hr,o.bq=js,o.br=jS,o.bs=EA,o.bt=WS,o.bu=ZS,o.bv=Fx,o.bw=WI,o.bx=Lx,o.by=h1,o.bz=Zt,o.c=st,o.c$=Ta,o.c0=mr,o.c1=wa,o.c2=c,o.c3=function(u){const n=Math.round((u+45+360)%360/90)%4;return Tr[n]},o.c4=45,o.c5=pe,o.c6=Wp,o.c7=function(u,n,a){const d=Math.sqrt(u*u+n*n+a*a),_=d>0?Math.acos(a/d)*_r:0;let f=u!==0||n!==0?Math.atan2(-n,-u)*_r+90:0;return f<0&&(f+=360),[d,f,_]},o.c8=Ye,o.c9=Fi,o.cA=function(u){const n=je-5;u=nr(u,-n,n)/n*90;const a=Math.pow(Math.abs(Math.sin(Wt(u))),3);return Math.round(a*(S.length-1))},o.cB=function(u,n,a,d){const _=n.getNorth(),f=n.getSouth(),y=n.getWest(),T=n.getEast(),C=1<<u.z,M=T-y,x=_-f,I=M/w,P=-x/S[a],A=[0,I,0,P,0,0,_,y,0];if(u.z>0){const R=180/d;Se.mat3.multiply(A,A,[R/M+1,0,0,0,R/x+1,0,-.5*R/I,.5*R/P,1])}return A[2]=C,A[5]=u.x,A[8]=u.y,A},o.cC=su,o.cD=function(u,n,a){const d=Se.mat4.identity(new Float64Array(16)),_=(n/(1<<u)-.5)*Math.PI*2;return Se.mat4.rotateY(d,a.globeMatrix,_),Float32Array.from(d)},o.cE=class{isDataAvailableAtPoint(u){const n=this._source();if(this.isUsingMockSource()||!n||u.y<0||u.y>1)return!1;const a=n.getSource().maxzoom,d=1<<a,_=Math.floor(u.x),f=Math.floor((u.x-_)*d),y=Math.floor(u.y*d),T=this.findDEMTileFor(new Ni(a,_,a,f,y));return!(!T||!T.dem)}getAtPointOrZero(u,n=0){return this.getAtPoint(u,n)||0}getAtPoint(u,n,a=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const d=this._source();if(!d||u.y<0||u.y>1)return n;const _=d.getSource().maxzoom,f=1<<_,y=Math.floor(u.x),T=u.x-y,C=new Ni(_,y,_,Math.floor(T*f),Math.floor(u.y*f)),M=this.findDEMTileFor(C);if(!M||!M.dem)return n;const x=M.dem,I=1<<M.tileID.canonical.z,P=(T*I-M.tileID.canonical.x)*x.dim,A=(u.y*I-M.tileID.canonical.y)*x.dim,R=Math.floor(P),D=Math.floor(A);return(a?this.exaggeration():1)*vr(vr(x.get(R,D),x.get(R,D+1),A-D),vr(x.get(R+1,D),x.get(R+1,D+1),A-D),P-R)}getAtTileOffset(u,n,a){const d=1<<u.canonical.z;return this.getAtPointOrZero(new ht(u.wrap+(u.canonical.x+n/fr)/d,(u.canonical.y+a/fr)/d))}getAtTileOffsetFunc(u,n,a,d){return _=>{const f=this.getAtTileOffset(u,_.x,_.y),y=d.upVector(u.canonical,_.x,_.y),T=d.upVectorScale(u.canonical,n,a).metersToTile;return Se.vec3.scale(y,y,f*T),y}}getForTilePoints(u,n,a,d){if(this.isUsingMockSource())return!1;const _=nm.create(this,u,d);return!!_&&(n.forEach(f=>{f[2]=this.exaggeration()*_.getElevationAt(f[0],f[1],a)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(u);if(!n||!n.dem)return null;const a=n.dem.tree,d=n.tileID,_=1<<u.canonical.z-d.canonical.z;let f=u.canonical.x/_-d.canonical.x,y=u.canonical.y/_-d.canonical.y,T=0;for(let C=0;C<u.canonical.z-d.canonical.z&&!a.leaves[T];C++){f*=2,y*=2;const M=2*Math.floor(y)+Math.floor(f);T=a.childOffsets[T]+M,f%=1,y%=1}return{min:this.exaggeration()*a.minimums[T],max:this.exaggeration()*a.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,n,a){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let n=!1,a=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const _ of u){const f=this.getMinMaxForTile(_.tileID);f&&(a=Math.min(a,f.min),d=Math.max(d,f.max),n=!0)}return n?{min:a,max:d}:null}},o.cF=wS,o.cG=Wu,o.cH=function(u,n){return[Math.pow(u[0],2.2)*n,Math.pow(u[1],2.2)*n,Math.pow(u[2],2.2)*n]},o.cI=lS,o.cJ=Ne,o.cK=xe,o.cL=256,o.cM=function(u,n){const a=[0,0,0],d=rv(su(n.canonical));return Se.vec3.transformMat4(a,a,d),Se.vec3.transformMat4(a,a,u),a},o.cN=u=>({u_camera_to_center_distance:new ia(u),u_extrude_scale:new kg(u),u_device_pixel_ratio:new ia(u),u_matrix:new bf(u),u_inv_rot_matrix:new bf(u),u_merc_center:new Kl(u),u_tile_id:new Pg(u),u_zoom_transition:new ia(u),u_up_dir:new Pg(u),u_emissive_strength:new ia(u)}),o.cO=u=>({u_matrix:new bf(u),u_pixels_to_tile_units:new kg(u),u_device_pixel_ratio:new ia(u),u_units_to_pixels:new Kl(u),u_dash_image:new qu(u),u_gradient_image:new qu(u),u_image_height:new ia(u),u_texsize:new Kl(u),u_tile_units_to_pixels:new ia(u),u_alpha_discard_threshold:new ia(u),u_trim_offset:new Kl(u),u_trim_fade_range:new Kl(u),u_trim_color:new Wp(u),u_emissive_strength:new ia(u)}),o.cP=u=>({u_matrix:new bf(u),u_texsize:new Kl(u),u_pixels_to_tile_units:new kg(u),u_device_pixel_ratio:new ia(u),u_image:new qu(u),u_units_to_pixels:new Kl(u),u_tile_units_to_pixels:new ia(u),u_alpha_discard_threshold:new ia(u),u_trim_offset:new Kl(u)}),o.cQ=xa,o.cR=G4,o.cS=q4,o.cT=dS,o.cU=(u,n,a,d,_,f)=>{const y=u.transform,T=y.projection.name==="globe";let C;if(f.paint.get("circle-pitch-alignment")==="map")if(T){const x=lS(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;C=Float32Array.from([x,0,0,x])}else C=y.calculatePixelsToTileUnitsMatrix(a);else C=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(y.projection),u_matrix:u.translatePosMatrix(n.projMatrix,a,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ir.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Zz,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(T){M.u_inv_rot_matrix=d,M.u_merc_center=_,M.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],M.u_zoom_transition=Jh(y.zoom);const x=_[0]*fr,I=_[1]*fr;M.u_up_dir=y.projection.upVector(new ys(0,0,0),x,I)}return M},o.cV=bI,o.cW=(u,n,a,d,_,f)=>{const y=u.transform;return{u_matrix:vI(u,n,a,d),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:y.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:_,u_image:0,u_tile_units_to_pixels:yI(n,y),u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f}},o.cX=(u,n,a,d,_,f,y)=>{const T=u.transform,C=T.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:vI(u,n,a,d),u_pixels_to_tile_units:C,u_device_pixel_ratio:f,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:xI(a)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:yI(n,u.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength")}},o.cY=ho,o.cZ=Lg,o.c_=aI,o.ca=Lo,o.cb=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},o.cc=function(u){return u({pluginStatus:kn,pluginURL:yi}),Us.on("pluginStateChange",u),u},o.cd=im,o.ce=zv,o.cf=Qp,o.cg=zx,o.ch=la,o.ci=Gi,o.cj=Br,o.ck=Ji,o.cl=Oi,o.cm=function(u){const n=u.indexOf(vc);return n>=0?u.slice(0,n):u},o.cn=function(u){return u.indexOf(vc)>=0},o.co=function(u){const n=u.indexOf(vc);return n>=0?u.slice(n+1):""},o.cp=function(u){const n=[],a=u.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),u.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},o.cq=function(u,n,a,d){return u.type==="custom"?new wN(u,n):new ON[u.type](u,n,a,d)},o.cr=ki,o.cs=Us,o.ct=ca,o.cu=Mg,o.cv=class extends Ec{constructor(u){super(u),this.current=rx}set(u,n,a){if(this.fetchUniformLocation(u,n)){for(let d=0;d<9;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},o.cw=yr,o.cx=function(u,n,a){const d=Jh(a.zoom),_=u.style.map._antialias,f=n.options.extStandardDerivativesForceOff||u.terrain&&u.terrain.exaggeration()>0;return d===0&&!_&&!f},o.cy=function(u){const n=u.pixelsPerMeter,a=n/Ae(1,u.center.lat),d=Se.mat4.identity(new Float64Array(16));return Se.mat4.translate(d,d,[u.point.x,u.point.y,0]),Se.mat4.scale(d,d,[a,a,n]),Float32Array.from(d)},o.cz=ev,o.d=function(u){return Ke.API_TILEJSON_REGEX.test(u)},o.d$=O,o.d0=dv,o.d1=ed,o.d2=450,o.d3=7,o.d4=xN,o.d5=Wn,o.d6=jp,o.d7=256,o.d8=ux,o.d9=ru,o.dA=uS,o.dB=function(u){const n=[0,0,0],a=Se.mat4.identity(new Float64Array(16));return Se.mat4.multiply(a,u.pixelMatrix,u.globeMatrix),Se.vec3.transformMat4(n,n,a),new We(n[0],n[1])},o.dC=function(u,n,a=!1){if(kn===$n||kn===_i||kn===Vn)throw new Error("setRTLTextPlugin cannot be called multiple times.");yi=ir.resolveURL(u),kn=$n,Xn=n,Po(),a||xs()},o.dD=ba,o.dE=function(){zv().acquire(s1)},o.dF=function(){const u=l_;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(s1),l_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dG=a_,o.dH=function(u){const n=Qn();if(!n)return;const a=n.delete(kr);u&&a.catch(u).then(()=>u())},o.dI=s_,o.dJ=QA,o.dK=function(u){a1=ir.resolveURL(u),am||(am=new im(zv(),new Xo)),am.broadcast("setDracoUrl",a1)},o.dL=eC,o.dM=function(u){sm=ir.resolveURL(u),am||(am=new im(zv(),new Xo)),am.broadcast("setMeshoptUrl",sm)},o.dN=et,o.dO=Qh,o.dP=Ac,o.dQ=cC,o.dR=hC,o.dS=fI,o.dT=ns,o.dU=jI,o.dV=function(u,n,a,d,_,f,y,T,C,M,x){u.createArrays(),u.tilePixelRatio=fr/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const I=u.layers[0].layout,P=u.layers[0]._unevaluatedLayout._values,A={};if(u.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:Z}=u.textSizeData;A.compositeTextSizes=[P["text-size"].possiblyEvaluate(new li(j),T),P["text-size"].possiblyEvaluate(new li(Z),T)]}if(u.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:Z}=u.iconSizeData;A.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new li(j),T),P["icon-size"].possiblyEvaluate(new li(Z),T)]}A.layoutTextSize=P["text-size"].possiblyEvaluate(new li(C+1),T),A.layoutIconSize=P["icon-size"].possiblyEvaluate(new li(C+1),T),A.textMaxSize=P["text-size"].possiblyEvaluate(new li(18),T);const R=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",D=I.get("text-size");let N=!1;for(const j of u.features)if(j.icon&&j.icon.nameSecondary){N=!0;break}for(const j of u.features){const Z=I.get("text-font").evaluate(j,{},T).join(","),X=D.evaluate(j,{},T),G=A.layoutTextSize.evaluate(j,{},T),J=(A.layoutIconSize.evaluate(j,{},T),{horizontal:{},vertical:void 0}),se=j.text;let _e,Ce=[0,0];if(se){const Ve=se.toString(),De=I.get("text-letter-spacing").evaluate(j,{},T)*js,qe=I.get("text-line-height").evaluate(j,{},T)*js,Qe=Hn(Ve)?De:0,nt=I.get("text-anchor").evaluate(j,{},T),ot=I.get("text-variable-anchor");if(!ot){const Vt=I.get("text-radial-offset").evaluate(j,{},T);Ce=Vt?WI(nt,[Vt*js,Nx]):I.get("text-offset").evaluate(j,{},T).map(Tt=>Tt*js)}let lt=R?"center":I.get("text-justify").evaluate(j,{},T);const yt=I.get("symbol-placement")==="point",ut=yt?I.get("text-max-width").evaluate(j,{},T)*js:1/0,Mt=Vt=>{u.allowVerticalPlacement&&Gr(Ve)&&(J.vertical=Dx(se,n,a,_,Z,ut,qe,nt,Vt,Qe,Ce,Bl.vertical,!0,G,X))};if(!R&&ot){const Vt=lt==="auto"?ot.map(wr=>Fx(wr)):[lt];let Tt=!1;for(let wr=0;wr<Vt.length;wr++){const dr=Vt[wr];if(!J.horizontal[dr])if(Tt)J.horizontal[dr]=J.horizontal[0];else{const er=Dx(se,n,a,_,Z,ut,qe,"center",dr,Qe,Ce,Bl.horizontal,!1,G,X);er&&(J.horizontal[dr]=er,Tt=er.positionedLines.length===1)}}Mt("left")}else{if(lt==="auto"&&(lt=Fx(nt)),yt||I.get("text-writing-mode").indexOf("horizontal")>=0||!Gr(Ve)){const Vt=Dx(se,n,a,_,Z,ut,qe,nt,lt,Qe,Ce,Bl.horizontal,!1,G,X);Vt&&(J.horizontal[lt]=Vt)}Mt(yt?"left":lt)}}let Pe=!1;if(j.icon&&j.icon.namePrimary){const Ve=d[j.icon.namePrimary];Ve&&(_e=tN(_[j.icon.namePrimary],j.icon.nameSecondary?_[j.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(j,{},T),I.get("icon-anchor").evaluate(j,{},T)),Pe=Ve.sdf,u.sdfIcons===void 0?u.sdfIcons=Ve.sdf:u.sdfIcons!==Ve.sdf&&en("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==u.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0))}const Ee=KI(J.horizontal)||J.vertical;u.iconsInText||(u.iconsInText=!!Ee&&Ee.iconsInText),(Ee||_e)&&lN(u,j,J,_e,d,A,G,0,Ce,Pe,y,T,M,x,N)}f&&u.generateCollisionDebugBuffers(C,u.collisionBoxArray)},o.dW=Xp,o.dX=Bv,o.dY=$e,o.dZ=NS,o.d_=AI,o.da=Tc,o.db=Sg,o.dc=function(u,n,a,d,_){return nr((u-n)/(a-n)*(_-d)+d,d,_)},o.dd=Oh,o.de=rt,o.df=class{constructor(u,n,a,d){this.context=u,this.format=d,this.size=a,this.texture=u.gl.createTexture();const[_,f,y]=this.size,{gl:T}=u;T.bindTexture(T.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),T.texImage3D(T.TEXTURE_3D,0,this.format,_,f,y,0,Hx(this.format),Wx(this.format),n.data)}bind(u,n){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_3D,this.texture),u!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,u),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,u),this.minFilter=u),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},o.dg=Yx,o.dh=[1,1,1],o.di=nm,o.dj=rm,o.dk=nu,o.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new We(1/0,1/0),max:new We(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,n=!1){const a=GS(new We(0,0),new We(fr,fr),u),d=[];if(n&&!Tx(a,this._globalClipBounds))return d;for(const _ of this._activeRegions){if(_.hiddenByOverlap||!Tx(a,_))continue;const f=_4(_.min,_.max,u);d.push({min:f.min,max:f.max,sourceId:this._sourceIds[_.priority],footprint:_.footprint,footprintTileId:_.tileId,order:_.order,clipMask:_.clipMask,clipScope:_.clipScope})}return d}setSources(u){this._setSources(u.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const a=[];for(const d of n.cache.getVisibleCoordinates()){const _=n.cache.getTile(d).buckets[n.layer];_&&_.updateFootprints(d.toUnwrapped(),a)}return a},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(u){const n=u.getFootprints();if(n.length===0)return;const a=u.getOrder(),d=u.getClipMask(),_=u.getClipScope();for(const f of n){if(!f.footprint)continue;const y=GS(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:a,clipMask:d,clipScope:_})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,a)=>n.priority-a.priority||uv(n.min,a.min)||uv(n.max,a.max)||n.order-a.order||n.clipMask-a.clipMask||function(d,_){const f=(y,T)=>y+T;return d.length-_.length||d.reduce(f,"").localeCompare(_.reduce(f,""))}(n.clipScope,a.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let n=0;for(;!u&&n!==this._activeRegions.length;){const a=this._activeRegions[n],d=this._prevRegions[n];u=a.priority!==d.priority||!$S(a,d)||a.order!==d.order||a.clipMask!==d.clipMask||!zt(a.clipScope,d.clipScope),++n}}if(u){++this._updateTime;for(const a of this._activeRegions)a.order!==cv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const n=a=>{const d=this._activeRegions;if(a>=d.length)return a;const _=d[a].priority;for(;a<d.length&&d[a].priority===_;)++a;return a};if(this._sourceIds.length>1){let a=0,d=n(a);for(;a!==d;){let _=a;const f=a;for(;_!==d;){const y=this._activeRegions[_];y.hiddenByOverlap=!1;for(let T=0;T<f;T++){const C=this._activeRegions[T];if(!C.hiddenByOverlap&&y.order===cv&&Tx(y,C)&&(y.hiddenByOverlap=HS(y.footprint,y.tileId,C.footprint,C.tileId),y.hiddenByOverlap))break}++_}a=d,d=n(a)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=u.length-1;n>=0;n--)this._addSource(u[n]);this._computeReplacement()}},o.dm=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,n){const a=new eu,d=new Ms,_=[],f=u+1+2,y=n[0]+1,T=n[0]+1+(1+n.length),C=(M,x,I)=>{let P=M===f-1?M-2:M===0?M:M-1;return P+=I?24575:0,[P,x]};for(let M=0;M<f;++M)a.emplaceBack(...C(M,0,!0));for(let M=0;M<y;++M)for(let x=0;x<f;++x)a.emplaceBack(...C(x,M,(x===0||x===f-1)&&!0));for(let M=0;M<n.length;++M){const x=n[M];for(let I=0;I<f;++I)a.emplaceBack(...C(I,x,!0))}for(let M=0;M<n.length;++M){const x=d.length,I=n[M]+1+2,P=new Ms;for(let D=0;D<I-1;D++){const N=D===I-2,j=N?f*(T-n.length+M-D):f;for(let Z=0;Z<f-1;Z++){const X=D*f+Z;D===0||N||Z===0||Z===f-2?(P.emplaceBack(X+1,X,X+j),P.emplaceBack(X+j,X+j+1,X+1)):(d.emplaceBack(X+1,X,X+j),d.emplaceBack(X+j,X+j+1,X+1))}}const A=To.simpleSegment(0,x,a.length,d.length-x);for(let D=0;D<P.uint16.length;D+=3)d.emplaceBack(P.uint16[D],P.uint16[D+1],P.uint16[D+2]);const R=To.simpleSegment(0,x,a.length,d.length-x);_.push({withoutSkirts:A,withSkirts:R})}return{vertices:a,indices:d,segments:_}}_createGrid(u){const n=this._fillGridMeshWithLods(w,S);this._gridSegments=n.segments,this._gridBuffer=u.createVertexBuffer(n.vertices,ml.members),this._gridIndexBuffer=u.createIndexBuffer(n.indices,!0)}_createPoles(u){const n=new Ms;for(let y=0;y<=w;y++)n.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=u.createIndexBuffer(n,!0);const a=new Tc,d=new Tc,_=new Tc,f=new Tc;this._poleSegments=[];for(let y=0,T=0;y<c;y++){const C=360/(1<<y);a.emplaceBack(0,-i,0,.5,0),d.emplaceBack(0,-i,0,.5,1),_.emplaceBack(0,-i,0,.5,.5),f.emplaceBack(0,-i,0,.5,.5);for(let M=0;M<=w;M++){let x=M/w,I=0;const P=vr(0,C,x),[A,R,D]=F(Hz,Wz,P,i);a.emplaceBack(A,R,D,x,I),d.emplaceBack(A,R,D,x,1-I);const N=Wt(P);x=.5+.5*Math.sin(N),I=.5+.5*Math.cos(N),_.emplaceBack(A,R,D,x,I),f.emplaceBack(A,R,D,x,1-I)}this._poleSegments.push(To.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(a,nl,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(d,nl,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(_,nl,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(f,nl,!1)}getGridBuffers(u,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},o.dn=cv,o.dp=Lr,o.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.dr=qr,o.ds=Je,o.dt=V,o.du=function([u,n,a]){const d=Math.hypot(u,n,a),_=Math.atan2(u,a),f=.5*Math.PI-Math.acos(-n/d);return new K(mr(_),mr(f))},o.dv=Xx,o.dw=q,o.dx=function(u){const n=u.navigator?u.navigator.userAgent:null;return!!function(a){if(Ks==null){const d=a.navigator?a.navigator.userAgent:null;Ks=!!a.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return Ks}(u)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dy=function(u,n){zr=u,yn=n},o.dz=dx,o.e=Ke,o.e0=function(u){let n=0;if(new Uint32Array(u,0,1)[0]!==rC){const a=new Uint32Array(u,0,7),[,,d,_,f,y]=a;n=a.byteLength+_+f+y+f,(d!==u.byteLength||n>=u.byteLength)&&en("Invalid b3dm header information.")}return sC(u,n)},o.e1=function(u,n){const a=lC(u);for(const d of a){for(const _ of d.meshes)v5(_);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(b5(d.lights,n)))}return a},o.e2=Lv,o.e3=BA,o.e4=vo,o.e5=function(u){Kn(),Yr!=null&&Yr.then(n=>{n.keys().then(a=>{for(let d=0;d<a.length-u;d++)n.delete(a[d])})})},o.f=function(u){return u.indexOf("mapbox:")===0},o.g=function(u,n){return ca(ln(u,{method:"GET"}),n)},o.h=Ge,o.i=function(u){return Ke.API_STYLE_REGEX.test(u)&&!st(u)},o.j=function(u){return decodeURIComponent(atob(u).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.k=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(n,a)=>String.fromCharCode(+("0x"+a))))},o.l=ln,o.m=Li,o.n=function(u,n){return ca(ln(u,{type:"json"}),n)},o.o=Yi,o.p=function(u,n){return ca(ln(u,{method:"POST"}),n)},o.q=ir,o.r=Ea,o.s=function(u){try{const n=self[u];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Qs,o.u=function(){return function u(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},o.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},o.w=en,o.x=Cs,o.y=2,o.z=UI}),b(["./shared"],function(o){function O(pt){const fe=pt?pt.url.toString():void 0;return fe?performance.getEntriesByName(fe):[]}function z(pt){if(typeof pt=="number"||typeof pt=="boolean"||typeof pt=="string"||pt==null)return JSON.stringify(pt);if(Array.isArray(pt)){let xe="[";for(const Ne of pt)xe+=`${z(Ne)},`;return`${xe}]`}let fe="{";for(const xe of Object.keys(pt).sort())fe+=`${xe}:${z(pt[xe])},`;return`${fe}}`}function U(pt){let fe="";for(const xe of o.bg)fe+=`/${z(pt[xe])}`;return fe}class H{constructor(fe){this.keyCache={},this._layers={},this._layerConfigs={},fe&&this.replace(fe)}replace(fe,xe){this._layerConfigs={},this._layers={},this.update(fe,[],xe)}update(fe,xe,Ne){this._options=Ne;for(const Ge of fe)this._layerConfigs[Ge.id]=Ge,(this._layers[Ge.id]=o.cq(Ge,this.scope,null,this._options)).compileFilter(Ne),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id];for(const Ge of xe)delete this.keyCache[Ge],delete this._layerConfigs[Ge],delete this._layers[Ge];this.familiesBySource={};const Ke=function(Ge,st){const _t={};for(let bt=0;bt<Ge.length;bt++){const St=st&&st[Ge[bt].id]||U(Ge[bt]);st&&(st[Ge[bt].id]=St);let xt=_t[St];xt||(xt=_t[St]=[]),xt.push(Ge[bt])}const at=[];for(const bt in _t)at.push(_t[bt]);return at}(o.bd(this._layerConfigs),this.keyCache);for(const Ge of Ke){const st=Ge.map(jt=>this._layers[jt.id]),_t=st[0];if(_t.visibility==="none")continue;const at=_t.source||"";let bt=this.familiesBySource[at];bt||(bt=this.familiesBySource[at]={});const St=_t.sourceLayer||"_geojsonTileLayer";let xt=bt[St];xt||(xt=bt[St]=[]),xt.push(st)}}}const Y=1*o.dP;class Q{constructor(fe){const xe={},Ne=[];for(const _t in fe){const at=fe[_t],bt=xe[_t]={};for(const St in at.glyphs){const xt=at.glyphs[+St];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const jt=xt.metrics.localGlyph?Y:1,ur={x:0,y:0,w:xt.bitmap.width+2*jt,h:xt.bitmap.height+2*jt};Ne.push(ur),bt[St]=ur}}const{w:Ke,h:Ge}=o.z(Ne),st=new o.dO({width:Ke||1,height:Ge||1});for(const _t in fe){const at=fe[_t];for(const bt in at.glyphs){const St=at.glyphs[+bt];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const xt=xe[_t][bt],jt=St.metrics.localGlyph?Y:1;o.dO.copy(St.bitmap,st,{x:0,y:0},{x:xt.x+jt,y:xt.y+jt},St.bitmap)}}this.image=st,this.positions=xe}}o.dN(Q,"GlyphAtlas");class ge{constructor(fe){this.tileID=new o.aA(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.lut=fe.lut,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.scope=fe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=fe.showCollisionBoxes,this.collectResourceTiming=!!fe.collectResourceTiming,this.promoteId=fe.promoteId,this.isSymbolTile=fe.isSymbolTile,this.tileTransform=o.aK(fe.tileID.canonical,fe.projection),this.projection=fe.projection,this.brightness=fe.brightness,this.extraShadowCaster=!!fe.extraShadowCaster,this.tessellationStep=fe.tessellationStep}parse(fe,xe,Ne,Ke,Ge){this.status="parsing",this.data=fe,this.collisionBoxArray=new o.aQ;const st=new o.dQ(Object.keys(fe.layers).sort()),_t=new o.dR(this.tileID,this.promoteId);_t.bucketLayerIDs=[];const at={},bt=new o.dS(256,256),St={featureIndex:_t,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:bt,availableImages:Ne,brightness:this.brightness},xt=xe.familiesBySource[this.source];for(const zr in xt){const yn=fe.layers[zr];if(!yn)continue;let Tn=!1,Yr=!1,On=!1;for(const Di of xt[zr])Di[0].type==="symbol"?Tn=!0:Yr=!0,Di[0].is3D()&&Di[0].type!=="model"&&(On=!0);if(this.extraShadowCaster&&!On||this.isSymbolTile===!0&&!Tn||this.isSymbolTile===!1&&!Yr)continue;yn.version===1&&o.w(`Vector tile source "${this.source}" layer "${zr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qn=st.encode(zr),Kn=[];for(let Di=0;Di<yn.length;Di++){const Li=yn.feature(Di),mo=_t.getId(Li,zr);Kn.push({feature:Li,id:mo,index:Di,sourceLayerIndex:Qn})}for(const Di of xt[zr]){const Li=Di[0];(!this.extraShadowCaster||Li.is3D()&&Li.type!=="model")&&(this.isSymbolTile!==void 0&&Li.type==="symbol"!==this.isSymbolTile||Li.minzoom&&this.zoom<Math.floor(Li.minzoom)||Li.maxzoom&&this.zoom>=Li.maxzoom||Li.visibility!=="none"&&(ye(Di,this.zoom,St.brightness,Ne),(at[Li.id]=Li.createBucket({index:_t.bucketLayerIDs.length,layers:Di,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Kn,St,this.tileID.canonical,this.tileTransform),_t.bucketLayerIDs.push(Di.map(mo=>mo.id))))}}let jt,ur,ir,Rr;bt.trim();const Br={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},kr=()=>{if(jt)return this.status="done",Ge(jt);if(this.extraShadowCaster)this.status="done",Ge(null,{buckets:o.bd(at).filter(zr=>!zr.isEmpty()),featureIndex:_t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:St.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ur&&ir&&Rr){const zr=new Q(ur),yn=new o.dU(ir,Rr,this.lut);for(const Tn in at){const Yr=at[Tn];Yr instanceof o.aR?(ye(Yr.layers,this.zoom,St.brightness,Ne),o.dV(Yr,ur,zr.positions,ir,yn.iconPositions,this.showCollisionBoxes,Ne,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Yr.hasPattern&&(Yr instanceof o.aX||Yr instanceof o.aY||Yr instanceof o.d0)&&(ye(Yr.layers,this.zoom,St.brightness,Ne),Yr.addFeatures(St,this.tileID.canonical,yn.patternPositions,Ne,this.tileTransform,this.brightness))}this.status="done",Ge(null,{buckets:o.bd(at).filter(Tn=>!Tn.isEmpty()),featureIndex:_t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zr.image,lineAtlas:bt,imageAtlas:yn,brightness:St.brightness})}};if(!this.extraShadowCaster){const zr=o.dT(St.glyphDependencies,Yr=>Object.keys(Yr).map(Number));Object.keys(zr).length?Ke.send("getGlyphs",{uid:this.uid,stacks:zr,scope:this.scope},(Yr,On)=>{jt||(jt=Yr,ur=On,kr())},void 0,!1,Br):ur={};const yn=Object.keys(St.iconDependencies);yn.length?Ke.send("getImages",{icons:yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Yr,On)=>{jt||(jt=Yr,ir=On,kr())},void 0,!1,Br):ir={};const Tn=Object.keys(St.patternDependencies);Tn.length?Ke.send("getImages",{icons:Tn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Yr,On)=>{jt||(jt=Yr,Rr=On,kr())},void 0,!1,Br):Rr={}}kr()}}function ye(pt,fe,xe,Ne){const Ke=new o.a3(fe,{brightness:xe});for(const Ge of pt)Ge.recalculate(Ke,Ne)}class ke extends o.E{constructor(fe,xe,Ne,Ke,Ge,st){super(),this.actor=fe,this.layerIndex=xe,this.availableImages=Ne,this.loadVectorData=Ge||o.aw,this.loading={},this.loaded={},this.deduped=new o.au(fe.scheduler),this.isSpriteLoaded=Ke,this.scheduler=fe.scheduler,this.brightness=st}loadTile(fe,xe){const Ne=fe.uid,Ke=fe&&fe.request,Ge=Ke&&Ke.collectResourceTiming,st=this.loading[Ne]=new ge(fe);st.abort=this.loadVectorData(fe,(_t,at)=>{const bt=!this.loading[Ne];if(delete this.loading[Ne],bt||_t||!at)return st.status="done",bt||(this.loaded[Ne]=st),xe(_t);const St=at.rawData,xt={};at.expires&&(xt.expires=at.expires),at.cacheControl&&(xt.cacheControl=at.cacheControl),st.vectorTile=at.vectorTile||new o.dW.VectorTile(new o.bb(St));const jt=()=>{st.parse(st.vectorTile,this.layerIndex,this.availableImages,this.actor,(ur,ir)=>{if(ur||!ir)return xe(ur);const Rr={};if(Ge){const Br=O(Ke);Br.length>0&&(Rr.resourceTiming=JSON.parse(JSON.stringify(Br)))}xe(null,o.l({rawTileData:St.slice(0)},ir,xt,Rr))})};this.isSpriteLoaded?jt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(jt,{type:"parseTile",isSymbolTile:fe.isSymbolTile,zoom:fe.tileZoom}):jt()}),this.loaded=this.loaded||{},this.loaded[Ne]=st})}reloadTile(fe,xe){const Ne=this.loaded,Ke=fe.uid;if(Ne&&Ne[Ke]){const Ge=Ne[Ke];Ge.showCollisionBoxes=fe.showCollisionBoxes,Ge.projection=fe.projection,Ge.brightness=fe.brightness,Ge.tileTransform=o.aK(fe.tileID.canonical,fe.projection),Ge.extraShadowCaster=fe.extraShadowCaster,Ge.lut=fe.lut;const st=(_t,at)=>{const bt=Ge.reloadCallback;bt&&(delete Ge.reloadCallback,Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,bt)),xe(_t,at)};Ge.status==="parsing"?Ge.reloadCallback=st:Ge.status==="done"&&(Ge.vectorTile?Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,st):st())}else xe(null,void 0)}abortTile(fe,xe){const Ne=fe.uid,Ke=this.loading[Ne];Ke&&(Ke.abort&&Ke.abort(),delete this.loading[Ne]),xe()}removeTile(fe,xe){const Ne=this.loaded,Ke=fe.uid;Ne&&Ne[Ke]&&delete Ne[Ke],xe()}}class he{loadTile(fe,xe){const{uid:Ne,encoding:Ke,rawImageData:Ge,padding:st}=fe,_t=ImageBitmap&&Ge instanceof ImageBitmap?this.getImageData(Ge,st):Ge;xe(null,new o.dX(Ne,_t,Ke,st<1))}getImageData(fe,xe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(fe.width,fe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=fe.width,this.offscreenCanvas.height=fe.height,this.offscreenCanvasContext.drawImage(fe,0,0,fe.width,fe.height);const Ne=this.offscreenCanvasContext.getImageData(-xe,-xe,fe.width+2*xe,fe.height+2*xe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ne}}o.ba.setPbf(o.bb);class oe{decodeRasterArray({task:fe,buffer:xe},Ne){o.ba.performDecoding(xe,fe).then(Ke=>{Ne(null,Ke)},Ke=>{Ne(Ke)})}}const ve=o.dW.VectorTileFeature.prototype.toGeoJSON;class be{constructor(fe){this._feature=fe,this.extent=o.ab,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(this._feature.type===1){const fe=[];for(const xe of this._feature.geometry)fe.push([new o.P(xe[0],xe[1])]);return fe}{const fe=[];for(const xe of this._feature.geometry){const Ne=[];for(const Ke of xe)Ne.push(new o.P(Ke[0],Ke[1]));fe.push(Ne)}return fe}}toGeoJSON(fe,xe,Ne){return ve.call(this,fe,xe,Ne)}}class ze{constructor(fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.ab,this.length=fe.length,this._features=fe}feature(fe){return new be(this._features[fe])}}const Te=64/4096,ie=128;class ne{constructor(){this.features=new Map}clear(){this.features.clear()}load(fe=[],xe){for(const Ne of fe){const Ke=Ne.id;if(Ke==null)continue;let Ge=this.features.get(Ke);Ge&&this.updateCache(Ge,xe),Ne.geometry?(Ge=re(Ne),this.updateCache(Ge,xe),this.features.set(Ke,Ge)):this.features.delete(Ke),this.updateCache(Ge,xe)}}updateCache(fe,xe){for(const{canonical:Ne,uid:Ke}of Object.values(xe)){const{z:Ge,x:st,y:_t}=Ne;te(fe,Math.pow(2,Ge),st,_t)&&delete xe[Ke]}}getTile(fe,xe,Ne){const Ke=Math.pow(2,fe),Ge=[];for(const st of this.features.values())te(st,Ke,xe,Ne)&&Ge.push(Et(st,Ke,xe,Ne));return{features:Ge}}getFeatures(){return[...this.features.values()]}}function te({minX:pt,minY:fe,maxX:xe,maxY:Ne},Ke,Ge,st){return pt<(Ge+1+Te)/Ke&&fe<(st+1+Te)/Ke&&xe>(Ge-Te)/Ke&&Ne>(st-Te)/Ke}function re(pt){const{id:fe,geometry:xe,properties:Ne}=pt;if(!xe)return;if(xe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ke,coordinates:Ge}=xe,st={id:fe,type:1,geometry:[],tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},_t=st.geometry;if(Ke==="Point")me(Ge,_t,st);else if(Ke==="MultiPoint")for(const at of Ge)me(at,_t,st);else if(Ke==="LineString")st.type=2,we(Ge,_t,st);else if(Ke==="MultiLineString")st.type=2,tt(Ge,_t,st);else if(Ke==="Polygon")st.type=3,tt(Ge,_t,st,!0);else{if(Ke!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");st.type=3;for(const at of Ge)tt(at,_t,st,!0)}return st}function me([pt,fe],xe,Ne){const Ke=o.am(pt);let Ge=o.at(fe);Ge=Ge<0?0:Ge>1?1:Ge,xe.push(Ke,Ge),Ne.minX=Math.min(Ne.minX,Ke),Ne.minY=Math.min(Ne.minY,Ge),Ne.maxX=Math.max(Ne.maxX,Ke),Ne.maxY=Math.max(Ne.maxY,Ge)}function we(pt,fe,xe,Ne=!1,Ke=!1){const Ge=[];for(const st of pt)me(st,Ge,xe);fe.push(Ge),Ne&&function(st,_t){let at=0;for(let bt=0,St=st.length,xt=St-2;bt<St;xt=bt,bt+=2)at+=(st[bt]-st[xt])*(st[bt+1]+st[xt+1]);if(at>0===_t)for(let bt=0,St=st.length;bt<St/2;bt+=2){const xt=st[bt],jt=st[bt+1];st[bt]=st[St-2-bt],st[bt+1]=st[St-1-bt],st[St-2-bt]=xt,st[St-1-bt]=jt}}(Ge,Ke)}function tt(pt,fe,xe,Ne=!1){for(let Ke=0;Ke<pt.length;Ke++)we(pt[Ke],fe,xe,Ne,Ke===0)}function Et(pt,fe,xe,Ne){const{id:Ke,type:Ge,geometry:st,tags:_t}=pt,at=[];if(Ge===1)(function(bt,St,xt,jt,ur){for(let ir=0;ir<bt.length;ir+=2){const Rr=Math.round(o.ab*(bt[ir+0]*St-xt)),Br=Math.round(o.ab*(bt[ir+1]*St-jt));ur.push([Rr,Br])}})(st,fe,xe,Ne,at);else for(const bt of st)ft(bt,fe,xe,Ne,at);return{id:Ke,type:Ge,geometry:at,tags:_t}}function ft(pt,fe,xe,Ne,Ke){const Ge=-ie,st=o.ab+ie;let _t;for(let at=0;at<pt.length-2;at+=2){let bt=Math.round(o.ab*(pt[at+0]*fe-xe)),St=Math.round(o.ab*(pt[at+1]*fe-Ne)),xt=Math.round(o.ab*(pt[at+2]*fe-xe)),jt=Math.round(o.ab*(pt[at+3]*fe-Ne));const ur=xt-bt,ir=jt-St;bt<Ge&&xt<Ge||(bt<Ge?(St+=Math.round(ir*((Ge-bt)/ur)),bt=Ge):xt<Ge&&(jt=St+Math.round(ir*((Ge-bt)/ur)),xt=Ge),St<Ge&&jt<Ge||(St<Ge?(bt+=Math.round(ur*((Ge-St)/ir)),St=Ge):jt<Ge&&(xt=bt+Math.round(ur*((Ge-St)/ir)),jt=Ge),bt>=st&&xt>=st||(bt>=st?(St+=Math.round(ir*((st-bt)/ur)),bt=st):xt>=st&&(jt=St+Math.round(ir*((st-bt)/ur)),xt=st),St>=st&&jt>=st||(St>=st?(bt+=Math.round(ur*((st-St)/ir)),St=st):jt>=st&&(xt=bt+Math.round(ur*((st-St)/ir)),jt=st),_t&&bt===_t[_t.length-1][0]&&St===_t[_t.length-1][1]||(_t=[[bt,St]],Ke.push(_t)),_t.push([xt,jt])))))}}var rr,or,Fr,gt={exports:{}},jr=function(){if(Fr)return gt.exports;Fr=1;var pt=o.d_(),fe=function(){if(or)return rr;or=1;var St=o.dY(),xt=o.dZ().VectorTileFeature;function jt(ir,Rr){this.options=Rr||{},this.features=ir,this.length=ir.length}function ur(ir,Rr){this.id=typeof ir.id=="number"?ir.id:void 0,this.type=ir.type,this.rawGeometry=ir.type===1?[ir.geometry]:ir.geometry,this.properties=ir.tags,this.extent=Rr||4096}return rr=jt,jt.prototype.feature=function(ir){return new ur(this.features[ir],this.options.extent)},ur.prototype.loadGeometry=function(){var ir=this.rawGeometry;this.geometry=[];for(var Rr=0;Rr<ir.length;Rr++){for(var Br=ir[Rr],kr=[],zr=0;zr<Br.length;zr++)kr.push(new St(Br[zr][0],Br[zr][1]));this.geometry.push(kr)}return this.geometry},ur.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ir=this.geometry,Rr=1/0,Br=-1/0,kr=1/0,zr=-1/0,yn=0;yn<ir.length;yn++)for(var Tn=ir[yn],Yr=0;Yr<Tn.length;Yr++){var On=Tn[Yr];Rr=Math.min(Rr,On.x),Br=Math.max(Br,On.x),kr=Math.min(kr,On.y),zr=Math.max(zr,On.y)}return[Rr,kr,Br,zr]},ur.prototype.toGeoJSON=xt.prototype.toGeoJSON,rr}();function xe(St){var xt=new pt;return function(jt,ur){for(var ir in jt.layers)ur.writeMessage(3,Ne,jt.layers[ir])}(St,xt),xt.finish()}function Ne(St,xt){var jt;xt.writeVarintField(15,St.version||1),xt.writeStringField(1,St.name||""),xt.writeVarintField(5,St.extent||4096);var ur={keys:[],values:[],keycache:{},valuecache:{}};for(jt=0;jt<St.length;jt++)ur.feature=St.feature(jt),xt.writeMessage(2,Ke,ur);var ir=ur.keys;for(jt=0;jt<ir.length;jt++)xt.writeStringField(3,ir[jt]);var Rr=ur.values;for(jt=0;jt<Rr.length;jt++)xt.writeMessage(4,bt,Rr[jt])}function Ke(St,xt){var jt=St.feature;jt.id!==void 0&&xt.writeVarintField(1,jt.id),xt.writeMessage(2,Ge,St),xt.writeVarintField(3,jt.type),xt.writeMessage(4,at,jt)}function Ge(St,xt){var jt=St.feature,ur=St.keys,ir=St.values,Rr=St.keycache,Br=St.valuecache;for(var kr in jt.properties){var zr=jt.properties[kr],yn=Rr[kr];if(zr!==null){yn===void 0&&(ur.push(kr),Rr[kr]=yn=ur.length-1),xt.writeVarint(yn);var Tn=typeof zr;Tn!=="string"&&Tn!=="boolean"&&Tn!=="number"&&(zr=JSON.stringify(zr));var Yr=Tn+":"+zr,On=Br[Yr];On===void 0&&(ir.push(zr),Br[Yr]=On=ir.length-1),xt.writeVarint(On)}}}function st(St,xt){return(xt<<3)+(7&St)}function _t(St){return St<<1^St>>31}function at(St,xt){for(var jt=St.loadGeometry(),ur=St.type,ir=0,Rr=0,Br=jt.length,kr=0;kr<Br;kr++){var zr=jt[kr],yn=1;ur===1&&(yn=zr.length),xt.writeVarint(st(1,yn));for(var Tn=ur===3?zr.length-1:zr.length,Yr=0;Yr<Tn;Yr++){Yr===1&&ur!==1&&xt.writeVarint(st(2,Tn-1));var On=zr[Yr].x-ir,Qn=zr[Yr].y-Rr;xt.writeVarint(_t(On)),xt.writeVarint(_t(Qn)),ir+=On,Rr+=Qn}ur===3&&xt.writeVarint(st(7,1))}}function bt(St,xt){var jt=typeof St;jt==="string"?xt.writeStringField(1,St):jt==="boolean"?xt.writeBooleanField(7,St):jt==="number"&&(St%1!=0?xt.writeDoubleField(3,St):St<0?xt.writeSVarintField(6,St):xt.writeVarintField(5,St))}return gt.exports=xe,gt.exports.fromVectorTileJs=xe,gt.exports.fromGeojsonVt=function(St,xt){xt=xt||{};var jt={};for(var ur in St)jt[ur]=new fe(St[ur].features,xt),jt[ur].name=ur,jt[ur].version=xt.version,jt[ur].extent=xt.extent;return xe({layers:jt})},gt.exports.GeoJSONWrapper=fe,gt.exports}(),Ur=o.d$(jr);const Xr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:pt=>pt},pr=Math.fround||(Dt=new Float32Array(1),pt=>(Dt[0]=+pt,Dt[0]));var Dt;const ar=3,vt=5,Pt=6;class Ot{constructor(fe){this.options=Object.assign(Object.create(Xr),fe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(fe){const{log:xe,minZoom:Ne,maxZoom:Ke}=this.options;xe&&console.time("total time");const Ge=`prepare ${fe.length} points`;xe&&console.time(Ge),this.points=fe;const st=[];for(let at=0;at<fe.length;at++){const bt=fe[at];if(!bt.geometry)continue;const[St,xt]=bt.geometry.coordinates,jt=pr(Kt(St)),ur=pr(Fe(xt));st.push(jt,ur,1/0,at,-1,1),this.options.reduce&&st.push(0)}let _t=this.trees[Ke+1]=this._createTree(st);xe&&console.timeEnd(Ge);for(let at=Ke;at>=Ne;at--){const bt=+Date.now();_t=this.trees[at]=this._createTree(this._cluster(_t,at)),xe&&console.log("z%d: %d clusters in %dms",at,_t.numItems,+Date.now()-bt)}return xe&&console.timeEnd("total time"),this}getClusters(fe,xe){let Ne=((fe[0]+180)%360+360)%360-180;const Ke=Math.max(-90,Math.min(90,fe[1]));let Ge=fe[2]===180?180:((fe[2]+180)%360+360)%360-180;const st=Math.max(-90,Math.min(90,fe[3]));if(fe[2]-fe[0]>=360)Ne=-180,Ge=180;else if(Ne>Ge){const xt=this.getClusters([Ne,Ke,180,st],xe),jt=this.getClusters([-180,Ke,Ge,st],xe);return xt.concat(jt)}const _t=this.trees[this._limitZoom(xe)],at=_t.range(Kt(Ne),Fe(st),Kt(Ge),Fe(Ke)),bt=_t.data,St=[];for(const xt of at){const jt=this.stride*xt;St.push(bt[jt+vt]>1?lr(bt,jt,this.clusterProps):this.points[bt[jt+ar]])}return St}getChildren(fe){const xe=this._getOriginId(fe),Ne=this._getOriginZoom(fe),Ke="No cluster with the specified id.",Ge=this.trees[Ne];if(!Ge)throw new Error(Ke);const st=Ge.data;if(xe*this.stride>=st.length)throw new Error(Ke);const _t=this.options.radius/(this.options.extent*Math.pow(2,Ne-1)),at=Ge.within(st[xe*this.stride],st[xe*this.stride+1],_t),bt=[];for(const St of at){const xt=St*this.stride;st[xt+4]===fe&&bt.push(st[xt+vt]>1?lr(st,xt,this.clusterProps):this.points[st[xt+ar]])}if(bt.length===0)throw new Error(Ke);return bt}getLeaves(fe,xe,Ne){const Ke=[];return this._appendLeaves(Ke,fe,xe=xe||10,Ne=Ne||0,0),Ke}getTile(fe,xe,Ne){const Ke=this.trees[this._limitZoom(fe)],Ge=Math.pow(2,fe),{extent:st,radius:_t}=this.options,at=_t/st,bt=(Ne-at)/Ge,St=(Ne+1+at)/Ge,xt={features:[]};return this._addTileFeatures(Ke.range((xe-at)/Ge,bt,(xe+1+at)/Ge,St),Ke.data,xe,Ne,Ge,xt),xe===0&&this._addTileFeatures(Ke.range(1-at/Ge,bt,1,St),Ke.data,Ge,Ne,Ge,xt),xe===Ge-1&&this._addTileFeatures(Ke.range(0,bt,at/Ge,St),Ke.data,-1,Ne,Ge,xt),xt.features.length?xt:null}getClusterExpansionZoom(fe){let xe=this._getOriginZoom(fe)-1;for(;xe<=this.options.maxZoom;){const Ne=this.getChildren(fe);if(xe++,Ne.length!==1)break;fe=Ne[0].properties.cluster_id}return xe}_appendLeaves(fe,xe,Ne,Ke,Ge){const st=this.getChildren(xe);for(const _t of st){const at=_t.properties;if(at&&at.cluster?Ge+at.point_count<=Ke?Ge+=at.point_count:Ge=this._appendLeaves(fe,at.cluster_id,Ne,Ke,Ge):Ge<Ke?Ge++:fe.push(_t),fe.length===Ne)break}return Ge}_createTree(fe){const xe=new o.by(fe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ne=0;Ne<fe.length;Ne+=this.stride)xe.add(fe[Ne],fe[Ne+1]);return xe.finish(),xe.data=fe,xe}_addTileFeatures(fe,xe,Ne,Ke,Ge,st){for(const _t of fe){const at=_t*this.stride,bt=xe[at+vt]>1;let St,xt,jt;if(bt)St=Se(xe,at,this.clusterProps),xt=xe[at],jt=xe[at+1];else{const Rr=this.points[xe[at+ar]];St=Rr.properties;const[Br,kr]=Rr.geometry.coordinates;xt=Kt(Br),jt=Fe(kr)}const ur={type:1,geometry:[[Math.round(this.options.extent*(xt*Ge-Ne)),Math.round(this.options.extent*(jt*Ge-Ke))]],tags:St};let ir;ir=bt||this.options.generateId?xe[at+ar]:this.points[xe[at+ar]].id,ir!==void 0&&(ur.id=ir),st.features.push(ur)}}_limitZoom(fe){return Math.max(this.options.minZoom,Math.min(Math.floor(+fe),this.options.maxZoom+1))}_cluster(fe,xe){const{radius:Ne,extent:Ke,reduce:Ge,minPoints:st}=this.options,_t=Ne/(Ke*Math.pow(2,xe)),at=fe.data,bt=[],St=this.stride;for(let xt=0;xt<at.length;xt+=St){if(at[xt+2]<=xe)continue;at[xt+2]=xe;const jt=at[xt],ur=at[xt+1],ir=fe.within(at[xt],at[xt+1],_t),Rr=at[xt+vt];let Br=Rr;for(const kr of ir){const zr=kr*St;at[zr+2]>xe&&(Br+=at[zr+vt])}if(Br>Rr&&Br>=st){let kr,zr=jt*Rr,yn=ur*Rr,Tn=-1;const Yr=(xt/St<<5)+(xe+1)+this.points.length;for(const On of ir){const Qn=On*St;if(at[Qn+2]<=xe)continue;at[Qn+2]=xe;const Kn=at[Qn+vt];zr+=at[Qn]*Kn,yn+=at[Qn+1]*Kn,at[Qn+4]=Yr,Ge&&(kr||(kr=this._map(at,xt,!0),Tn=this.clusterProps.length,this.clusterProps.push(kr)),Ge(kr,this._map(at,Qn)))}at[xt+4]=Yr,bt.push(zr/Br,yn/Br,1/0,Yr,-1,Br),Ge&&bt.push(Tn)}else{for(let kr=0;kr<St;kr++)bt.push(at[xt+kr]);if(Br>1)for(const kr of ir){const zr=kr*St;if(!(at[zr+2]<=xe)){at[zr+2]=xe;for(let yn=0;yn<St;yn++)bt.push(at[zr+yn])}}}}return bt}_getOriginId(fe){return fe-this.points.length>>5}_getOriginZoom(fe){return(fe-this.points.length)%32}_map(fe,xe,Ne){if(fe[xe+vt]>1){const st=this.clusterProps[fe[xe+Pt]];return Ne?Object.assign({},st):st}const Ke=this.points[fe[xe+ar]].properties,Ge=this.options.map(Ke);return Ne&&Ge===Ke?Object.assign({},Ge):Ge}}function lr(pt,fe,xe){return{type:"Feature",id:pt[fe+ar],properties:Se(pt,fe,xe),geometry:{type:"Point",coordinates:[(Ne=pt[fe],360*(Ne-.5)),$e(pt[fe+1])]}};var Ne}function Se(pt,fe,xe){const Ne=pt[fe+vt],Ke=Ne>=1e4?`${Math.round(Ne/1e3)}k`:Ne>=1e3?Math.round(Ne/100)/10+"k":Ne,Ge=pt[fe+Pt],st=Ge===-1?{}:Object.assign({},xe[Ge]);return Object.assign(st,{cluster:!0,cluster_id:pt[fe+ar],point_count:Ne,point_count_abbreviated:Ke})}function Kt(pt){return pt/360+.5}function Fe(pt){const fe=Math.sin(pt*Math.PI/180),xe=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return xe<0?0:xe>1?1:xe}function $e(pt){const fe=(180-360*pt)*Math.PI/180;return 360*Math.atan(Math.exp(fe))/Math.PI-90}function We(pt,fe,xe,Ne){let Ke=Ne;const Ge=fe+(xe-fe>>1);let st,_t=xe-fe;const at=pt[fe],bt=pt[fe+1],St=pt[xe],xt=pt[xe+1];for(let jt=fe+3;jt<xe;jt+=3){const ur=zt(pt[jt],pt[jt+1],at,bt,St,xt);if(ur>Ke)st=jt,Ke=ur;else if(ur===Ke){const ir=Math.abs(jt-Ge);ir<_t&&(st=jt,_t=ir)}}Ke>Ne&&(st-fe>3&&We(pt,fe,st,Ne),pt[st+2]=Ke,xe-st>3&&We(pt,st,xe,Ne))}function zt(pt,fe,xe,Ne,Ke,Ge){let st=Ke-xe,_t=Ge-Ne;if(st!==0||_t!==0){const at=((pt-xe)*st+(fe-Ne)*_t)/(st*st+_t*_t);at>1?(xe=Ke,Ne=Ge):at>0&&(xe+=st*at,Ne+=_t*at)}return st=pt-xe,_t=fe-Ne,st*st+_t*_t}function $t(pt,fe,xe,Ne){const Ke={id:pt??null,type:fe,geometry:xe,tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")_r(Ke,xe);else if(fe==="Polygon")_r(Ke,xe[0]);else if(fe==="MultiLineString")for(const Ge of xe)_r(Ke,Ge);else if(fe==="MultiPolygon")for(const Ge of xe)_r(Ke,Ge[0]);return Ke}function _r(pt,fe){for(let xe=0;xe<fe.length;xe+=3)pt.minX=Math.min(pt.minX,fe[xe]),pt.minY=Math.min(pt.minY,fe[xe+1]),pt.maxX=Math.max(pt.maxX,fe[xe]),pt.maxY=Math.max(pt.maxY,fe[xe+1])}function Wt(pt,fe,xe,Ne){if(!fe.geometry)return;const Ke=fe.geometry.coordinates;if(Ke&&Ke.length===0)return;const Ge=fe.geometry.type,st=Math.pow(xe.tolerance/((1<<xe.maxZoom)*xe.extent),2);let _t=[],at=fe.id;if(xe.promoteId?at=fe.properties[xe.promoteId]:xe.generateId&&(at=Ne||0),Ge==="Point")mr(Ke,_t);else if(Ge==="MultiPoint")for(const bt of Ke)mr(bt,_t);else if(Ge==="LineString")Tr(Ke,_t,st,!1);else if(Ge==="MultiLineString"){if(xe.lineMetrics){for(const bt of Ke)_t=[],Tr(bt,_t,st,!1),pt.push($t(at,"LineString",_t,fe.properties));return}yr(Ke,_t,st,!1)}else if(Ge==="Polygon")yr(Ke,_t,st,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(const bt of fe.geometry.geometries)Wt(pt,{id:at,geometry:bt,properties:fe.properties},xe,Ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const bt of Ke){const St=[];yr(bt,St,st,!0),_t.push(St)}}pt.push($t(at,Ge,_t,fe.properties))}function mr(pt,fe){fe.push(Lr(pt[0]),qr(pt[1]),0)}function Tr(pt,fe,xe,Ne){let Ke,Ge,st=0;for(let at=0;at<pt.length;at++){const bt=Lr(pt[at][0]),St=qr(pt[at][1]);fe.push(bt,St,0),at>0&&(st+=Ne?(Ke*St-bt*Ge)/2:Math.sqrt(Math.pow(bt-Ke,2)+Math.pow(St-Ge,2))),Ke=bt,Ge=St}const _t=fe.length-3;fe[2]=1,We(fe,0,_t,xe),fe[_t+2]=1,fe.size=Math.abs(st),fe.start=0,fe.end=fe.size}function yr(pt,fe,xe,Ne){for(let Ke=0;Ke<pt.length;Ke++){const Ge=[];Tr(pt[Ke],Ge,xe,Ne),fe.push(Ge)}}function Lr(pt){return pt/360+.5}function qr(pt){const fe=Math.sin(pt*Math.PI/180),xe=.5-.25*Math.log((1+fe)/(1-fe))/Math.PI;return xe<0?0:xe>1?1:xe}function nr(pt,fe,xe,Ne,Ke,Ge,st,_t){if(Ne/=fe,Ge>=(xe/=fe)&&st<Ne)return pt;if(st<xe||Ge>=Ne)return null;const at=[];for(const bt of pt){const St=bt.geometry;let xt=bt.type;const jt=Ke===0?bt.minX:bt.minY,ur=Ke===0?bt.maxX:bt.maxY;if(jt>=xe&&ur<Ne){at.push(bt);continue}if(ur<xe||jt>=Ne)continue;let ir=[];if(xt==="Point"||xt==="MultiPoint")Wr(St,ir,xe,Ne,Ke);else if(xt==="LineString")Zr(St,ir,xe,Ne,Ke,!1,_t.lineMetrics);else if(xt==="MultiLineString")ln(St,ir,xe,Ne,Ke,!1);else if(xt==="Polygon")ln(St,ir,xe,Ne,Ke,!0);else if(xt==="MultiPolygon")for(const Rr of St){const Br=[];ln(Rr,Br,xe,Ne,Ke,!0),Br.length&&ir.push(Br)}if(ir.length){if(_t.lineMetrics&&xt==="LineString"){for(const Rr of ir)at.push($t(bt.id,xt,Rr,bt.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(ir.length===1?(xt="LineString",ir=ir[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=ir.length===3?"Point":"MultiPoint"),at.push($t(bt.id,xt,ir,bt.tags))}}return at.length?at:null}function Wr(pt,fe,xe,Ne,Ke){for(let Ge=0;Ge<pt.length;Ge+=3){const st=pt[Ge+Ke];st>=xe&&st<=Ne&&jn(fe,pt[Ge],pt[Ge+1],pt[Ge+2])}}function Zr(pt,fe,xe,Ne,Ke,Ge,st){let _t=Rn(pt);const at=Ke===0?uo:ho;let bt,St,xt=pt.start;for(let Br=0;Br<pt.length-3;Br+=3){const kr=pt[Br],zr=pt[Br+1],yn=pt[Br+2],Tn=pt[Br+3],Yr=pt[Br+4],On=Ke===0?kr:zr,Qn=Ke===0?Tn:Yr;let Kn=!1;st&&(bt=Math.sqrt(Math.pow(kr-Tn,2)+Math.pow(zr-Yr,2))),On<xe?Qn>xe&&(St=at(_t,kr,zr,Tn,Yr,xe),st&&(_t.start=xt+bt*St)):On>Ne?Qn<Ne&&(St=at(_t,kr,zr,Tn,Yr,Ne),st&&(_t.start=xt+bt*St)):jn(_t,kr,zr,yn),Qn<xe&&On>=xe&&(St=at(_t,kr,zr,Tn,Yr,xe),Kn=!0),Qn>Ne&&On<=Ne&&(St=at(_t,kr,zr,Tn,Yr,Ne),Kn=!0),!Ge&&Kn&&(st&&(_t.end=xt+bt*St),fe.push(_t),_t=Rn(pt)),st&&(xt+=bt)}let jt=pt.length-3;const ur=pt[jt],ir=pt[jt+1],Rr=Ke===0?ur:ir;Rr>=xe&&Rr<=Ne&&jn(_t,ur,ir,pt[jt+2]),jt=_t.length-3,Ge&&jt>=3&&(_t[jt]!==_t[0]||_t[jt+1]!==_t[1])&&jn(_t,_t[0],_t[1],_t[2]),_t.length&&fe.push(_t)}function Rn(pt){const fe=[];return fe.size=pt.size,fe.start=pt.start,fe.end=pt.end,fe}function ln(pt,fe,xe,Ne,Ke,Ge){for(const st of pt)Zr(st,fe,xe,Ne,Ke,Ge,!1)}function jn(pt,fe,xe,Ne){pt.push(fe,xe,Ne)}function uo(pt,fe,xe,Ne,Ke,Ge){const st=(Ge-fe)/(Ne-fe);return jn(pt,Ge,xe+(Ke-xe)*st,1),st}function ho(pt,fe,xe,Ne,Ke,Ge){const st=(Ge-xe)/(Ke-xe);return jn(pt,fe+(Ne-fe)*st,Ge,1),st}function vs(pt,fe){const xe=[];for(let Ne=0;Ne<pt.length;Ne++){const Ke=pt[Ne],Ge=Ke.type;let st;if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")st=Ai(Ke.geometry,fe);else if(Ge==="MultiLineString"||Ge==="Polygon"){st=[];for(const _t of Ke.geometry)st.push(Ai(_t,fe))}else if(Ge==="MultiPolygon"){st=[];for(const _t of Ke.geometry){const at=[];for(const bt of _t)at.push(Ai(bt,fe));st.push(at)}}xe.push($t(Ke.id,Ge,st,Ke.tags))}return xe}function Ai(pt,fe){const xe=[];xe.size=pt.size,pt.start!==void 0&&(xe.start=pt.start,xe.end=pt.end);for(let Ne=0;Ne<pt.length;Ne+=3)xe.push(pt[Ne]+fe,pt[Ne+1],pt[Ne+2]);return xe}function ns(pt,fe){if(pt.transformed)return pt;const xe=1<<pt.z,Ne=pt.x,Ke=pt.y;for(const Ge of pt.features){const st=Ge.geometry,_t=Ge.type;if(Ge.geometry=[],_t===1)for(let at=0;at<st.length;at+=2)Ge.geometry.push(ki(st[at],st[at+1],fe,xe,Ne,Ke));else for(let at=0;at<st.length;at++){const bt=[];for(let St=0;St<st[at].length;St+=2)bt.push(ki(st[at][St],st[at][St+1],fe,xe,Ne,Ke));Ge.geometry.push(bt)}}return pt.transformed=!0,pt}function ki(pt,fe,xe,Ne,Ke,Ge){return[Math.round(xe*(pt*Ne-Ke)),Math.round(xe*(fe*Ne-Ge))]}function Oi(pt,fe,xe,Ne,Ke){const Ge=fe===Ke.maxZoom?0:Ke.tolerance/((1<<fe)*Ke.extent),st={features:[],numPoints:0,numSimplified:0,numFeatures:pt.length,source:null,x:xe,y:Ne,z:fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _t of pt)Zo(st,_t,Ge,Ke);return st}function Zo(pt,fe,xe,Ne){const Ke=fe.geometry,Ge=fe.type,st=[];if(pt.minX=Math.min(pt.minX,fe.minX),pt.minY=Math.min(pt.minY,fe.minY),pt.maxX=Math.max(pt.maxX,fe.maxX),pt.maxY=Math.max(pt.maxY,fe.maxY),Ge==="Point"||Ge==="MultiPoint")for(let _t=0;_t<Ke.length;_t+=3)st.push(Ke[_t],Ke[_t+1]),pt.numPoints++,pt.numSimplified++;else if(Ge==="LineString")en(st,Ke,pt,xe,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(let _t=0;_t<Ke.length;_t++)en(st,Ke[_t],pt,xe,Ge==="Polygon",_t===0);else if(Ge==="MultiPolygon")for(let _t=0;_t<Ke.length;_t++){const at=Ke[_t];for(let bt=0;bt<at.length;bt++)en(st,at[bt],pt,xe,!0,bt===0)}if(st.length){let _t=fe.tags||null;if(Ge==="LineString"&&Ne.lineMetrics){_t={};for(const bt in fe.tags)_t[bt]=fe.tags[bt];_t.mapbox_clip_start=Ke.start/Ke.size,_t.mapbox_clip_end=Ke.end/Ke.size}const at={geometry:st,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:_t};fe.id!==null&&(at.id=fe.id),pt.features.push(at)}}function en(pt,fe,xe,Ne,Ke,Ge){const st=Ne*Ne;if(Ne>0&&fe.size<(Ke?st:Ne))return void(xe.numPoints+=fe.length/3);const _t=[];for(let at=0;at<fe.length;at+=3)(Ne===0||fe[at+2]>st)&&(xe.numSimplified++,_t.push(fe[at],fe[at+1])),xe.numPoints++;Ke&&function(at,bt){let St=0;for(let xt=0,jt=at.length,ur=jt-2;xt<jt;ur=xt,xt+=2)St+=(at[xt]-at[ur])*(at[xt+1]+at[ur+1]);if(St>0===bt)for(let xt=0,jt=at.length;xt<jt/2;xt+=2){const ur=at[xt],ir=at[xt+1];at[xt]=at[jt-2-xt],at[xt+1]=at[jt-1-xt],at[jt-2-xt]=ur,at[jt-1-xt]=ir}}(_t,Ge),pt.push(_t)}const Do={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class bs{constructor(fe,xe){const Ne=(xe=this.options=function(Ge,st){for(const _t in st)Ge[_t]=st[_t];return Ge}(Object.create(Do),xe)).debug;if(Ne&&console.time("preprocess data"),xe.maxZoom<0||xe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(xe.promoteId&&xe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ke=function(Ge,st){const _t=[];if(Ge.type==="FeatureCollection")for(let at=0;at<Ge.features.length;at++)Wt(_t,Ge.features[at],st,at);else Wt(_t,Ge.type==="Feature"?Ge:{geometry:Ge},st);return _t}(fe,xe);this.tiles={},this.tileCoords=[],Ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",xe.indexMaxZoom,xe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ke=function(Ge,st){const _t=st.buffer/st.extent;let at=Ge;const bt=nr(Ge,1,-1-_t,_t,0,-1,2,st),St=nr(Ge,1,1-_t,2+_t,0,-1,2,st);return(bt||St)&&(at=nr(Ge,1,-_t,1+_t,0,-1,2,st)||[],bt&&(at=vs(bt,1).concat(at)),St&&(at=at.concat(vs(St,-1)))),at}(Ke,xe),Ke.length&&this.splitTile(Ke,0,0,0),Ne&&(Ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(fe,xe,Ne,Ke,Ge,st,_t){const at=[fe,xe,Ne,Ke],bt=this.options,St=bt.debug;for(;at.length;){Ke=at.pop(),Ne=at.pop(),xe=at.pop(),fe=at.pop();const xt=1<<xe,jt=Lo(xe,Ne,Ke);let ur=this.tiles[jt];if(!ur&&(St>1&&console.time("creation"),ur=this.tiles[jt]=Oi(fe,xe,Ne,Ke,bt),this.tileCoords.push({z:xe,x:Ne,y:Ke}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",xe,Ne,Ke,ur.numFeatures,ur.numPoints,ur.numSimplified),console.timeEnd("creation"));const Kn=`z${xe}`;this.stats[Kn]=(this.stats[Kn]||0)+1,this.total++}if(ur.source=fe,Ge==null){if(xe===bt.indexMaxZoom||ur.numPoints<=bt.indexMaxPoints)continue}else{if(xe===bt.maxZoom||xe===Ge)continue;if(Ge!=null){const Kn=Ge-xe;if(Ne!==st>>Kn||Ke!==_t>>Kn)continue}}if(ur.source=null,fe.length===0)continue;St>1&&console.time("clipping");const ir=.5*bt.buffer/bt.extent,Rr=.5-ir,Br=.5+ir,kr=1+ir;let zr=null,yn=null,Tn=null,Yr=null,On=nr(fe,xt,Ne-ir,Ne+Br,0,ur.minX,ur.maxX,bt),Qn=nr(fe,xt,Ne+Rr,Ne+kr,0,ur.minX,ur.maxX,bt);fe=null,On&&(zr=nr(On,xt,Ke-ir,Ke+Br,1,ur.minY,ur.maxY,bt),yn=nr(On,xt,Ke+Rr,Ke+kr,1,ur.minY,ur.maxY,bt),On=null),Qn&&(Tn=nr(Qn,xt,Ke-ir,Ke+Br,1,ur.minY,ur.maxY,bt),Yr=nr(Qn,xt,Ke+Rr,Ke+kr,1,ur.minY,ur.maxY,bt),Qn=null),St>1&&console.timeEnd("clipping"),at.push(zr||[],xe+1,2*Ne,2*Ke),at.push(yn||[],xe+1,2*Ne,2*Ke+1),at.push(Tn||[],xe+1,2*Ne+1,2*Ke),at.push(Yr||[],xe+1,2*Ne+1,2*Ke+1)}}getTile(fe,xe,Ne){fe=+fe,xe=+xe,Ne=+Ne;const Ke=this.options,{extent:Ge,debug:st}=Ke;if(fe<0||fe>24)return null;const _t=1<<fe,at=Lo(fe,xe=xe+_t&_t-1,Ne);if(this.tiles[at])return ns(this.tiles[at],Ge);st>1&&console.log("drilling down to z%d-%d-%d",fe,xe,Ne);let bt,St=fe,xt=xe,jt=Ne;for(;!bt&&St>0;)St--,xt>>=1,jt>>=1,bt=this.tiles[Lo(St,xt,jt)];return bt&&bt.source?(st>1&&(console.log("found parent tile z%d-%d-%d",St,xt,jt),console.time("drilling down")),this.splitTile(bt.source,St,xt,jt,fe,xe,Ne),st>1&&console.timeEnd("drilling down"),this.tiles[at]?ns(this.tiles[at],Ge):null):null}}function Lo(pt,fe,xe){return 32*((1<<pt)*xe+fe)+pt}function jo(pt,fe){const xe=pt.tileID.canonical;if(!this._geoJSONIndex)return void fe(null,null);const Ne=this._geoJSONIndex.getTile(xe.z,xe.x,xe.y);if(!Ne)return void fe(null,null);const Ke=new ze(Ne.features);let Ge=Ur(Ke);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),fe(null,{vectorTile:Ke,rawData:Ge.buffer})}class is extends ke{constructor(fe,xe,Ne,Ke,Ge,st){super(fe,xe,Ne,Ke,jo,st),Ge&&(this.loadGeoJSON=Ge),this._dynamicIndex=new ne}loadData(fe,xe){const Ne=fe&&fe.request,Ke=Ne&&Ne.collectResourceTiming;this.loadGeoJSON(fe,(Ge,st)=>{if(Ge||!st)return xe(Ge);if(typeof st!="object")return xe(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));{try{if(fe.filter){const at=o.M(fe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(at.result==="error")throw new Error(at.value.map(bt=>`${bt.key}: ${bt.message}`).join(", "));st.features=st.features.filter(bt=>at.value.evaluate({zoom:0},bt))}fe.dynamic?(st.type==="Feature"&&(st={type:"FeatureCollection",features:[st]}),fe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(st.features,this.loaded),fe.cluster&&(st.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=fe.cluster?new Ot(function({superclusterOptions:at,clusterProperties:bt}){if(!bt||!at)return at;const St={},xt={},jt={accumulated:null,zoom:0},ur={properties:null},ir=Object.keys(bt);for(const Rr of ir){const[Br,kr]=bt[Rr],zr=o.M(kr),yn=o.M(typeof Br=="string"?[Br,["accumulated"],["get",Rr]]:Br);St[Rr]=zr.value,xt[Rr]=yn.value}return at.map=Rr=>{ur.properties=Rr;const Br={};for(const kr of ir)Br[kr]=St[kr].evaluate(jt,ur);return Br},at.reduce=(Rr,Br)=>{ur.properties=Br;for(const kr of ir)jt.accumulated=Rr[kr],Rr[kr]=xt[kr].evaluate(jt,ur)},at}(fe)).load(st.features):fe.dynamic?this._dynamicIndex:function(at,bt){return new bs(at,bt)}(st,fe.geojsonVtOptions)}catch(at){return xe(at)}const _t={};if(Ke){const at=O(Ne);at&&(_t.resourceTiming={},_t.resourceTiming[fe.source]=JSON.parse(JSON.stringify(at)))}xe(null,_t)}})}reloadTile(fe,xe){const Ne=this.loaded;return Ne&&Ne[fe.uid]?fe.partial?xe(null,void 0):super.reloadTile(fe,xe):this.loadTile(fe,xe)}loadGeoJSON(fe,xe){if(fe.request)o.n(fe.request,xe);else{if(typeof fe.data!="string")return xe(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`));try{return xe(null,JSON.parse(fe.data))}catch{return xe(new Error(`Input data given to '${fe.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(fe,xe){try{xe(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(Ne){xe(Ne)}}getClusterChildren(fe,xe){try{xe(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(Ne){xe(Ne)}}getClusterLeaves(fe,xe){try{xe(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(Ne){xe(Ne)}}}class Is{constructor(fe,xe){this.tileID=new o.aA(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),this.tileZoom=fe.tileZoom,this.uid=fe.uid,this.zoom=fe.zoom,this.canonical=fe.tileID.canonical,this.pixelRatio=fe.pixelRatio,this.tileSize=fe.tileSize,this.source=fe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=fe.projection,this.brightness=xe}parse(fe,xe,Ne,Ke){this.status="parsing";const Ge=new o.aA(Ne.tileID.overscaledZ,Ne.tileID.wrap,Ne.tileID.canonical.z,Ne.tileID.canonical.x,Ne.tileID.canonical.y),st={},_t=xe.familiesBySource[Ne.source],at=new o.dR(Ge,Ne.promoteId);return at.bucketLayerIDs=[],at.is3DTile=!0,o.e0(fe).then(bt=>{if(!bt)return Ke(new Error("Could not parse tile"));const St=o.e1(bt,1/o.c8(Ne.tileID.canonical)),xt=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("MAPBOX_mesh_features")||bt.json.asset.extras&&bt.json.asset.extras.MAPBOX_mesh_features,jt=bt.json.extensionsUsed&&bt.json.extensionsUsed.includes("EXT_meshopt_compression"),ur=new o.a3(this.zoom,{brightness:this.brightness});for(const ir in _t)for(const Rr of _t[ir]){const Br=Rr[0];at.bucketLayerIDs.push(Rr.map(zr=>zr.id)),Br.recalculate(ur,[]);const kr=new o.e2(St,Ge,xt,jt,this.brightness,at);xt||(kr.needsUpload=!0),st[Br.fqid]=kr,kr.evaluate(Br)}this.status="done",Ke(null,{buckets:st,featureIndex:at})}).catch(bt=>Ke(new Error(bt.message)))}}class Ks{constructor(fe,xe,Ne,Ke,Ge,st){this.actor=fe,this.layerIndex=xe,this.brightness=st,this.loading={},this.loaded={}}loadTile(fe,xe){const Ne=fe.uid,Ke=this.loading[Ne]=new Is(fe,this.brightness);o.bc(fe.request,(Ge,st)=>{const _t=!this.loading[Ne];return delete this.loading[Ne],_t||Ge?(Ke.status="done",_t||(this.loaded[Ne]=Ke),xe(Ge)):st&&st.byteLength!==0?void Ke.parse(st,this.layerIndex,fe,(at,bt)=>{Ke.status="done",this.loaded=this.loaded||{},this.loaded[Ne]=Ke,at||!bt?xe(at):xe(null,bt)}):(Ke.status="done",this.loaded[Ne]=Ke,xe())})}reloadTile(fe,xe){const Ne=this.loaded,Ke=fe.uid;if(Ne&&Ne[Ke]){const Ge=Ne[Ke];Ge.projection=fe.projection,Ge.brightness=fe.brightness;const st=(_t,at)=>{Ge.reloadCallback&&(delete Ge.reloadCallback,this.loadTile(fe,xe)),xe(_t,at)};Ge.status==="parsing"?Ge.reloadCallback=st:Ge.status==="done"&&this.loadTile(fe,xe)}}abortTile(fe,xe){const Ne=fe.uid;this.loading[Ne]&&delete this.loading[Ne],xe()}removeTile(fe,xe){const Ne=this.loaded,Ke=fe.uid;Ne&&Ne[Ke]&&delete Ne[Ke],xe()}}class $o{constructor(fe){this.self=fe,this.actor=new o.e3(fe,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bL({name:"mercator"}),this.workerSourceTypes={vector:ke,geojson:is,"batched-model":Ks},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(xe,Ne)=>{if(this.workerSourceTypes[xe])throw new Error(`Worker source with name "${xe}" already registered.`);this.workerSourceTypes[xe]=Ne},this.self.registerRTLTextPlugin=xe=>{if(o.e4.isParsed())throw new Error("RTL text plugin already registered.");o.e4.applyArabicShaping=xe.applyArabicShaping,o.e4.processBidirectionalText=xe.processBidirectionalText,o.e4.processStyledBidirectionalText=xe.processStyledBidirectionalText}}clearCaches(fe,xe,Ne){delete this.layerIndexes[fe],delete this.availableImages[fe],delete this.workerSources[fe],delete this.demWorkerSources[fe],delete this.rasterArrayWorkerSource,Ne()}checkIfReady(fe,xe,Ne){Ne()}setReferrer(fe,xe){this.referrer=xe}spriteLoaded(fe,{scope:xe,isLoaded:Ne}){if(this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={}),this.isSpriteLoaded[fe][xe]=Ne,this.workerSources[fe]&&this.workerSources[fe][xe])for(const Ke in this.workerSources[fe][xe]){const Ge=this.workerSources[fe][xe][Ke];for(const st in Ge){const _t=Ge[st];_t instanceof ke&&(_t.isSpriteLoaded=Ne,_t.fire(new o.x("isSpriteLoaded")))}}}setImages(fe,{scope:xe,images:Ne},Ke){if(this.availableImages[fe]||(this.availableImages[fe]={}),this.availableImages[fe][xe]=Ne,this.workerSources[fe]&&this.workerSources[fe][xe]){for(const Ge in this.workerSources[fe][xe]){const st=this.workerSources[fe][xe][Ge];for(const _t in st)st[_t].availableImages=Ne}Ke()}else Ke()}setProjection(fe,xe){this.projections[fe]=o.bL(xe)}setBrightness(fe,xe,Ne){this.brightness=xe,Ne()}setLayers(fe,xe,Ne){this.getLayerIndex(fe,xe.scope).replace(xe.layers,xe.options),Ne()}updateLayers(fe,xe,Ne){this.getLayerIndex(fe,xe.scope).update(xe.layers,xe.removedIds,xe.options),Ne()}loadTile(fe,xe,Ne){xe.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,xe.type,xe.source,xe.scope).loadTile(xe,Ne)}loadDEMTile(fe,xe,Ne){this.getDEMWorkerSource(fe,xe.source,xe.scope).loadTile(xe,Ne)}decodeRasterArray(fe,xe,Ne){this.getRasterArrayWorkerSource().decodeRasterArray(xe,Ne)}reloadTile(fe,xe,Ne){xe.projection=this.projections[fe]||this.defaultProjection,this.getWorkerSource(fe,xe.type,xe.source,xe.scope).reloadTile(xe,Ne)}abortTile(fe,xe,Ne){this.getWorkerSource(fe,xe.type,xe.source,xe.scope).abortTile(xe,Ne)}removeTile(fe,xe,Ne){this.getWorkerSource(fe,xe.type,xe.source,xe.scope).removeTile(xe,Ne)}removeSource(fe,xe,Ne){if(!(this.workerSources[fe]&&this.workerSources[fe][xe.scope]&&this.workerSources[fe][xe.scope][xe.type]&&this.workerSources[fe][xe.scope][xe.type][xe.source]))return;const Ke=this.workerSources[fe][xe.scope][xe.type][xe.source];delete this.workerSources[fe][xe.scope][xe.type][xe.source],Ke.removeSource!==void 0?Ke.removeSource(xe,Ne):Ne()}loadWorkerSource(fe,xe,Ne){try{this.self.importScripts(xe.url),Ne()}catch(Ke){Ne(Ke.toString())}}syncRTLPluginState(fe,xe,Ne){try{o.e4.setState(xe);const Ke=o.e4.getPluginURL();if(o.e4.isLoaded()&&!o.e4.isParsed()&&Ke!=null){this.self.importScripts(Ke);const Ge=o.e4.isParsed();Ne(Ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ke}`),Ge)}}catch(Ke){Ne(Ke.toString())}}setDracoUrl(fe,xe){this.dracoUrl=xe}getAvailableImages(fe,xe){this.availableImages[fe]||(this.availableImages[fe]={});let Ne=this.availableImages[fe][xe];return Ne||(Ne=[]),Ne}getLayerIndex(fe,xe){this.layerIndexes[fe]||(this.layerIndexes[fe]={});let Ne=this.layerIndexes[fe][xe];return Ne||(Ne=this.layerIndexes[fe][xe]=new H,Ne.scope=xe),Ne}getWorkerSource(fe,xe,Ne,Ke){return this.workerSources[fe]||(this.workerSources[fe]={}),this.workerSources[fe][Ke]||(this.workerSources[fe][Ke]={}),this.workerSources[fe][Ke][xe]||(this.workerSources[fe][Ke][xe]={}),this.isSpriteLoaded[fe]||(this.isSpriteLoaded[fe]={}),this.workerSources[fe][Ke][xe][Ne]||(this.workerSources[fe][Ke][xe][Ne]=new this.workerSourceTypes[xe]({send:(Ge,st,_t,at,bt,St)=>{this.actor.send(Ge,st,_t,fe,bt,St)},scheduler:this.actor.scheduler},this.getLayerIndex(fe,Ke),this.getAvailableImages(fe,Ke),this.isSpriteLoaded[fe][Ke],void 0,this.brightness)),this.workerSources[fe][Ke][xe][Ne]}getDEMWorkerSource(fe,xe,Ne){return this.demWorkerSources[fe]||(this.demWorkerSources[fe]={}),this.demWorkerSources[fe][Ne]||(this.demWorkerSources[fe][Ne]={}),this.demWorkerSources[fe][Ne][xe]||(this.demWorkerSources[fe][Ne][xe]=new he),this.demWorkerSources[fe][Ne][xe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new oe),this.rasterArrayWorkerSource}enforceCacheSizeLimit(fe,xe){o.e5(xe)}getWorkerPerformanceMetrics(fe,xe,Ne){Ne(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $o(self)),$o}),b(["./shared"],function(o){var O="3.7.0";const z={create:"create",load:"load",fullLoad:"fullLoad"},U={mark(m){performance.mark(m)},measure(m,i,c){performance.measure(m,i,c)}};function H(m){const i=m.name.split("?")[0];return o.a(i)&&i.includes("mapbox-gl.js")?"javascript":o.a(i)&&i.includes("mapbox-gl.css")?"css":o.b(i)?"fontRange":o.c(i)?"sprite":o.i(i)?"style":o.d(i)?"tilejson":"other"}var Y,Q={},ge=function(){if(Y)return Q;function m(g){return!i(g)}function i(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,S,k=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(k);try{S=new Worker(L),w=!0}catch{w=!1}return S&&S.terminate(),URL.revokeObjectURL(L),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var S=w.getContext("2d");if(!S)return!1;var k=S.getImageData(0,0,1,1);return k&&k.width===w.width}()?(c[v=g&&g.failIfMajorPerformanceCaveat]===void 0&&(c[v]=function(w){var S,k=function(L){var F=document.createElement("canvas"),V=Object.create(m.webGLContextAttributes);return V.failIfMajorPerformanceCaveat=L,F.getContext("webgl2",V)}(w);if(!k)return!1;try{S=k.createShader(k.VERTEX_SHADER)}catch{return!1}return!(!S||k.isContextLost())&&(k.shaderSource(S,"void main() {}"),k.compileShader(S),k.getShaderParameter(S,k.COMPILE_STATUS)===!0)}(v)),c[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}Y=1,Q.supported=m,Q.notSupportedReason=i;var c={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Q}();function ye(m,i,c){const g=document.createElement(m);return i!=null&&(g.className=i),c&&c.appendChild(g),g}function ke(m,i,c){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const v of Object.keys(i))g.setAttributeNS(null,v,String(i[v]));return c&&c.appendChild(g),g}const he=typeof document<"u"?document.documentElement&&document.documentElement.style:null,oe=he&&he.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ve;function be(){he&&oe&&(ve=he[oe],he[oe]="none")}function ze(){he&&oe&&(he[oe]=ve)}function Te(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",Te,!0)}function ie(){window.addEventListener("click",Te,!0),window.setTimeout(()=>{window.removeEventListener("click",Te,!0)},0)}function ne(m,i){const c=m.getBoundingClientRect();return me(m,c,i)}function te(m,i){const c=m.getBoundingClientRect(),g=[];for(let v=0;v<i.length;v++)g.push(me(m,c,i[v]));return g}function re(m){return window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function me(m,i,c){const g=m.offsetWidth===i.width?1:m.offsetWidth/i.width;return new o.P((c.clientX-i.left)*g,(c.clientY-i.top)*g)}const we="01",tt="NO_ACCESS_TOKEN";class Et{constructor(i,c,g){this._transformRequestFn=i,this._customAccessToken=c,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const i=function(){let c="";for(let g=0;g<10;g++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",we,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,c){return this._transformRequestFn&&this._transformRequestFn(i,c)||{url:i}}normalizeStyleURL(i,c){if(!o.f(i))return i;const g=rr(i);return g.params.push(`sdk=js-${O}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeGlyphsURL(i,c){if(!o.f(i))return i;const g=rr(i);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeModelURL(i,c){if(!o.f(i))return i;const g=rr(i);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||c)}normalizeSourceURL(i,c,g,v){if(!o.f(i))return i;const w=rr(i);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),g&&w.params.push(`language=${g}`),v&&w.params.push(`worldview=${v}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeSpriteURL(i,c,g,v){const w=rr(i);return o.f(i)?(w.path=`/styles/v1${w.path}/sprite${c}${g}`,this._makeAPIURL(w,this._customAccessToken||v)):(w.path+=`${c}${g}`,or(w))}normalizeTileURL(i,c,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!o.f(i))return i;const v=rr(i);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||g&&v.authority!=="raster"&&g===512?"@2x":""}${o.m.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${o.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${o.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${o.e.TILE_URL_VERSION}${v.path}`);const w=this._customAccessToken||function(S){for(const k of S){const L=k.match(/^access_token=(.*)$/);if(L)return L[1]}return null}(v.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,w)}canonicalizeTileURL(i,c){const g=rr(i);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return i;let v="mapbox://";g.path.match(/^\/raster\/v1\//)?v+=`raster/${g.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${g.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${g.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let w=g.params;return c&&(w=w.filter(S=>!S.match(/^access_token=/))),w.length&&(v+=`?${w.join("&")}`),v}canonicalizeTileset(i,c){const g=!!c&&o.f(c),v=[];for(const w of i.tiles||[])o.h(w)?v.push(this.canonicalizeTileURL(w,g)):v.push(w);return v}_makeAPIURL(i,c){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=rr(o.e.API_URL);if(i.protocol=v.protocol,i.authority=v.authority,i.protocol==="http"){const w=i.params.indexOf("secure");w>=0&&i.params.splice(w,1)}if(v.path!=="/"&&(i.path=`${v.path}${i.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return or(i);if(c=c||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return i.params=i.params.filter(w=>w.indexOf("access_token")===-1),i.params.push(`access_token=${c||""}`),or(i)}}const ft=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function rr(m){const i=m.match(ft);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function or(m){const i=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${i}`}const Fr="mapbox.eventData";function gt(m){if(!m)return null;const i=m.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(o.j(i[1]))}catch{return null}}class jr{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const c=gt(o.e.ACCESS_TOKEN);let g="";return g=c&&c.u?o.k(c.u):o.e.ACCESS_TOKEN||"",i?`${Fr}.${i}:${g}`:`${Fr}:${g}`}fetchEventData(){const i=o.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid");if(i)try{const v=localStorage.getItem(c);v&&(this.eventData=JSON.parse(v));const w=localStorage.getItem(g);w&&(this.anonId=w)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const i=o.s("localStorage"),c=this.getStorageKey(),g=this.getStorageKey("uuid"),v=this.anonId;if(i&&v)try{localStorage.setItem(g,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,c,g,v){if(!o.e.EVENTS_URL)return;const w=rr(o.e.EVENTS_URL);w.params.push(`access_token=${v||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(i).toISOString()},k=c?o.l(S,c):S,L={url:or(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([k])};this.pendingRequest=o.p(L,F=>{this.pendingRequest=null,g(F),this.saveEventData(),this.processRequests(v)})}queueRequest(i,c){this.queue.push(i),this.processRequests(c)}}const Ur=new class extends jr{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,i){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(c=>o.f(c)||o.h(c))&&this.queueRequest(Date.now(),i)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=gt(o.e.ACCESS_TOKEN),c=i?i.u:o.e.ACCESS_TOKEN;let g=c!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),g=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),S=new Date(v),k=(v-this.eventData.lastSuccess)/864e5;g=g||k>=1||k<-1||w.getDate()!==S.getDate()}else g=!0;g?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:we,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=v,this.eventData.tokenU=c)},m):this.processRequests()}},Xr=Ur.postTurnstileEvent.bind(Ur),pr=new class extends jr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,i,c,g){this.skuToken=i,this.errorCb=g,o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(tt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:we,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):i&&(this.success[i]=!0)},m))}remove(){this.errorCb=null}},Dt=pr.postMapLoadEvent.bind(pr),ar=new class extends jr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let i=this.mapInstanceIdMap.get(m);return i||(i=o.u(),this.mapInstanceIdMap.set(m,i)),i}getEventId(m){const i=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,i+1),i}postStyleLoadEvent(m,i){const{map:c,style:g,importedStyles:v}=i;if(!o.e.EVENTS_URL||!m&&!o.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),S={mapInstanceId:w,eventId:this.getEventId(w),style:g};v.length&&(S.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:S},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:c}=this.queue.shift();this.postEvent(i,c,()=>{},m)}},vt=ar.postStyleLoadEvent.bind(ar),Pt=new class extends jr{constructor(){super("gljs.performance")}postPerformanceEvent(m,i){o.e.EVENTS_URL&&(m||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:c}=this.queue.shift(),g=function(v){const w=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),k=function(K){const ae={};if(K){for(const le in K)if(le!=="other")for(const ue of K[le]){const pe=`${le}ResolveRangeMin`,Re=`${le}ResolveRangeMax`,Oe=`${le}RequestCount`,Ae=`${le}RequestCachedCount`;ae[pe]=Math.min(ae[pe]||1/0,ue.startTime),ae[Re]=Math.max(ae[Re]||-1/0,ue.responseEnd);const Be=Le=>{ae[Le]===void 0&&(ae[Le]=0),++ae[Le]};ue.transferSize!==void 0&&ue.transferSize===0&&Be(Ae),Be(Oe)}}return ae}(function(K,ae){const le={};if(K)for(const ue of K){const pe=ae(ue);le[pe]===void 0&&(le[pe]=[]),le[pe].push(ue)}return le}(w,H)),L=window.devicePixelRatio,F=navigator.connection||navigator.mozConnection||navigator.webkitConnection,V=F?F.effectiveType:void 0,q={counters:[],metadata:[],attributes:[]},W=(K,ae,le)=>{le!=null&&K.push({name:ae,value:le.toString()})};for(const K in k)W(q.counters,K,k[K]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&(W(q.counters,"interactionRangeMin",v.interactionRange[0]),W(q.counters,"interactionRangeMax",v.interactionRange[1])),S)for(const K of Object.keys(z)){const ae=z[K],le=S.find(ue=>ue.name===ae);le&&W(q.counters,ae,le.startTime)}return W(q.counters,"visibilityHidden",v.visibilityHidden),W(q.attributes,"style",function(K){if(K)for(const ae of K){const le=ae.name.split("?")[0];if(o.i(le)){const ue=le.split("/").slice(-2);if(ue.length===2)return`mapbox://styles/${ue[0]}/${ue[1]}`}}}(w)),W(q.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),W(q.attributes,"fogEnabled",v.fogEnabled?"true":"false"),W(q.attributes,"projection",v.projection),W(q.attributes,"zoom",v.zoom),W(q.metadata,"devicePixelRatio",L),W(q.metadata,"connectionEffectiveType",V),W(q.metadata,"navigatorUserAgent",navigator.userAgent),W(q.metadata,"screenWidth",window.screen.width),W(q.metadata,"screenHeight",window.screen.height),W(q.metadata,"windowWidth",window.innerWidth),W(q.metadata,"windowHeight",window.innerHeight),W(q.metadata,"mapWidth",v.width/L),W(q.metadata,"mapHeight",v.height/L),W(q.metadata,"webglRenderer",v.renderer),W(q.metadata,"webglVendor",v.vendor),W(q.metadata,"sdkVersion",O),W(q.metadata,"sdkIdentifier","mapbox-gl-js"),q}(c);for(const v of g.metadata);for(const v of g.counters);for(const v of g.attributes);this.postEvent(i,g,()=>{},m)}},Ot=Pt.postPerformanceEvent.bind(Pt),lr=new class extends jr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,i,c,g){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const v=rr(o.e.API_URL+o.e.SESSION_PATH);v.params.push(`sku=${i||""}`),v.params.push(`access_token=${g||o.e.ACCESS_TOKEN||""}`);const w={url:or(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(w,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,i,c,g){this.skuToken=i,this.errorCb=g,o.e.SESSION_PATH&&o.e.API_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},c):this.errorCb(new Error(tt)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||this.getSession(c,this.skuToken,g=>{g?this.errorCb(g):i&&(this.success[i]=!0)},m)}remove(){this.errorCb=null}},Se=lr.getSessionAPI.bind(lr),Kt=new Set;function Fe(m,i){i?Kt.add(m):Kt.delete(m)}class $e{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,c){this._updatedSourceCaches[i]=c,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const c=i.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(i.id),this.setDirty()}removeLayer(i){const c=i.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][i.id]=i,this._updatedLayers[c].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const c in this._updatedLayers)i[c]=i[c]||{},i[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)i[c]=i[c]||{},i[c].removedIds=Object.keys(this._removedLayers[c]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function We(m){const{userImage:i}=m;return!!(i&&i.render&&i.render())&&(m.data.replace(new Uint8Array(i.data.buffer)),!0)}class zt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new o.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,c){if(this.loaded[c]!==i&&(this.loaded[c]=i,i)){for(const{ids:g,callback:v}of this.requestors)this._notify(g,c,v);this.requestors=[]}}hasImage(i,c){return!!this.getImage(i,c)}getImage(i,c){return this.images[c][i]}addImage(i,c,g){this._validate(i,g)&&(this.images[c][i]=g)}_validate(i,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.t(new Error(`Image "${i}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.t(new Error(`Image "${i}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new o.t(new Error(`Image "${i}" has invalid "content" value`))),g=!1),g}_validateStretch(i,c){if(!i)return!0;let g=0;for(const v of i){if(v[0]<g||v[1]<v[0]||c<v[1])return!1;g=v[1]}return!0}_validateContent(i,c){return!(i&&(i.length!==4||i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,c,g){g.version=this.images[c][i].version+1,this.images[c][i]=g,this.updatedImages[c][i]=!0}removeImage(i,c){const g=this.images[c][i];delete this.images[c][i],delete this.patterns[c][i],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,c,g){let v=!0;const w=!!this.loaded[c];if(!w)for(const S of i)this.images[c][S]||(v=!1);w||v?this._notify(i,c,g):this.requestors.push({ids:i,scope:c,callback:g})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,c,g){const v={};for(const w of i){this.images[c][w]||this.fire(new o.x("styleimagemissing",{id:w}));const S=this.images[c][w];S?v[w]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:o.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(i){const{width:c,height:g}=this.atlasImage[i];return{width:c,height:g}}getPattern(i,c,g){const v=this.patterns[c][i],w=this.getImage(i,c);if(!w)return null;if(v&&v.position.version===w.version)return v.position;if(v)v.position.version=w.version;else{const S={w:w.data.width+2*o.y,h:w.data.height+2*o.y,x:0,y:0},k=new o.I(S,w,o.y);this.patterns[c][i]={bin:S,position:k}}return this._updatePatternAtlas(c,g),this.patterns[c][i].position}bind(i,c){const g=i.gl;let v=this.atlasTexture[c];v?this.dirty&&(v.update(this.atlasImage[c]),this.dirty=!1):(v=new o.T(i,this.atlasImage[c],g.RGBA8),this.atlasTexture[c]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(i,c){const g=[];for(const k in this.patterns[i])g.push(this.patterns[i][k].bin);const{w:v,h:w}=o.z(g),S=this.atlasImage[i];S.resize({width:v||1,height:w||1});for(const k in this.patterns[i]){const{bin:L,position:F}=this.patterns[i][k];let V=F.padding;const q=L.x+V,W=L.y+V,K=this.images[i][k].data,ae=K.width,le=K.height;V=V>1?V-1:V,o.r.copy(K,S,{x:0,y:0},{x:q,y:W},{width:ae,height:le},c),o.r.copy(K,S,{x:0,y:le-V},{x:q,y:W-V},{width:ae,height:V},c),o.r.copy(K,S,{x:0,y:0},{x:q,y:W+le},{width:ae,height:V},c),o.r.copy(K,S,{x:ae-V,y:0},{x:q-V,y:W},{width:V,height:le},c),o.r.copy(K,S,{x:0,y:0},{x:q+ae,y:W},{width:V,height:le},c),o.r.copy(K,S,{x:ae-V,y:le-V},{x:q-V,y:W-V},{width:V,height:V},c),o.r.copy(K,S,{x:0,y:le-V},{x:q+ae,y:W-V},{width:V,height:V},c),o.r.copy(K,S,{x:0,y:0},{x:q+ae,y:W+le},{width:V,height:V},c),o.r.copy(K,S,{x:ae-V,y:0},{x:q-V,y:W+le},{width:V,height:V},c)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,c){for(const g of i){if(this.callbackDispatchedThisFrame[c][g])continue;this.callbackDispatchedThisFrame[c][g]=!0;const v=this.images[c][g];We(v)&&this.updateImage(g,c,v)}}}function $t(m){const i=m.key,c=m.value,g=m.valueSpec||{},v=m.objectElementValidators||{},w=m.style,S=m.styleSpec;let k=[];const L=o.B(c);if(L!=="object")return[new o.V(i,c,`object expected, ${L} found`)];for(const F in c){const V=F.split(".")[0];let q;v[V]?q=v[V]:g[V]?q=en:v["*"]?q=v["*"]:g["*"]&&(q=en),q?k=k.concat(q({key:(i&&`${i}.`)+F,value:c[F],valueSpec:g[V]||g["*"],style:w,styleSpec:S,object:c,objectKey:F},c)):k.push(new o.A(i,c[F],`unknown property "${F}"`))}for(const F in g)v[F]||g[F].required&&g[F].default===void 0&&c[F]===void 0&&k.push(new o.V(i,c,`missing required property "${F}"`));return k}function _r(m){const i=m.value,c=m.valueSpec,g=m.style,v=m.styleSpec,w=m.key,S=m.arrayElementValidator||en;if(o.B(i)!=="array")return[new o.V(w,i,`array expected, ${o.B(i)} found`)];if(c.length&&i.length!==c.length)return[new o.V(w,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new o.V(w,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let k={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};v.$version<7&&(k.function=c.function),o.B(c.value)==="object"&&(k=c.value);let L=[];for(let F=0;F<i.length;F++)L=L.concat(S({array:i,arrayIndex:F,value:i[F],valueSpec:k,style:g,styleSpec:v,key:`${w}[${F}]`},!0));return L}function Wt(m){const i=m.key,c=m.value,g=m.valueSpec;let v=o.B(c);if(v==="number"&&c!=c&&(v="NaN"),v!=="number")return[new o.V(i,c,`number expected, ${v} found`)];if("minimum"in g){let w=g.minimum;if(o.B(g.minimum)==="array"&&(w=g.minimum[m.arrayIndex]),c<w)return[new o.V(i,c,`${c} is less than the minimum value ${w}`)]}if("maximum"in g){let w=g.maximum;if(o.B(g.maximum)==="array"&&(w=g.maximum[m.arrayIndex]),c>w)return[new o.V(i,c,`${c} is greater than the maximum value ${w}`)]}return[]}function mr(m){const i=m.valueSpec,c=o.D(m.value.type);let g,v,w,S={};const k=c!=="categorical"&&m.value.property===void 0,L=!k,F=o.B(m.value.stops)==="array"&&o.B(m.value.stops[0])==="array"&&o.B(m.value.stops[0][0])==="object",V=$t({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(K){if(c==="identity")return[new o.V(K.key,K.value,'identity function may not have a "stops" property')];let ae=[];const le=K.value;return ae=ae.concat(_r({key:K.key,value:le,valueSpec:K.valueSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:q})),o.B(le)==="array"&&le.length===0&&ae.push(new o.V(K.key,le,"array must have at least one stop")),ae},default:function(K){return en({key:K.key,value:K.value,valueSpec:i,style:K.style,styleSpec:K.styleSpec})}}});return c==="identity"&&k&&V.push(new o.V(m.key,m.value,'missing required property "property"')),c==="identity"||m.value.stops||V.push(new o.V(m.key,m.value,'missing required property "stops"')),c==="exponential"&&m.valueSpec.expression&&!o.F(m.valueSpec)&&V.push(new o.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(L&&!o.G(m.valueSpec)?V.push(new o.V(m.key,m.value,"property functions not supported")):k&&!o.H(m.valueSpec)&&V.push(new o.V(m.key,m.value,"zoom functions not supported"))),c!=="categorical"&&!F||m.value.property!==void 0||V.push(new o.V(m.key,m.value,'"property" property is required')),V;function q(K){let ae=[];const le=K.value,ue=K.key;if(o.B(le)!=="array")return[new o.V(ue,le,`array expected, ${o.B(le)} found`)];if(le.length!==2)return[new o.V(ue,le,`array length 2 expected, length ${le.length} found`)];if(F){if(o.B(le[0])!=="object")return[new o.V(ue,le,`object expected, ${o.B(le[0])} found`)];if(le[0].zoom===void 0)return[new o.V(ue,le,"object stop key must have zoom")];if(le[0].value===void 0)return[new o.V(ue,le,"object stop key must have value")];const pe=o.D(le[0].zoom);if(typeof pe!="number")return[new o.V(ue,le[0].zoom,"stop zoom values must be numbers")];if(w&&w>pe)return[new o.V(ue,le[0].zoom,"stop zoom values must appear in ascending order")];pe!==w&&(w=pe,v=void 0,S={}),ae=ae.concat($t({key:`${ue}[0]`,value:le[0],valueSpec:{zoom:{}},style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Wt,value:W}}))}else ae=ae.concat(W({key:`${ue}[0]`,value:le[0],valueSpec:{},style:K.style,styleSpec:K.styleSpec},le));return o.J(o.K(le[1]))?ae.concat([new o.V(`${ue}[1]`,le[1],"expressions are not allowed in function stops.")]):ae.concat(en({key:`${ue}[1]`,value:le[1],valueSpec:i,style:K.style,styleSpec:K.styleSpec}))}function W(K,ae){const le=o.B(K.value),ue=o.D(K.value),pe=K.value!==null?K.value:ae;if(g){if(le!==g)return[new o.V(K.key,pe,`${le} stop domain type must match previous stop domain type ${g}`)]}else g=le;if(le!=="number"&&le!=="string"&&le!=="boolean"&&typeof ue!="number"&&typeof ue!="string"&&typeof ue!="boolean")return[new o.V(K.key,pe,"stop domain value must be a number, string, or boolean")];if(le!=="number"&&c!=="categorical"){let Re=`number expected, ${le} found`;return o.G(i)&&c===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(K.key,pe,Re)]}return c!=="categorical"||le!=="number"||typeof ue=="number"&&isFinite(ue)&&Math.floor(ue)===ue?c!=="categorical"&&le==="number"&&typeof ue=="number"&&typeof v=="number"&&v!==void 0&&ue<v?[new o.V(K.key,pe,"stop domain values must appear in ascending order")]:(v=ue,c==="categorical"&&ue in S?[new o.V(K.key,pe,"stop domain values must be unique")]:(S[ue]=!0,[])):[new o.V(K.key,pe,`integer expected, found ${String(ue)}`)]}}function Tr(m){const i=(m.expressionContext==="property"?o.L:o.M)(o.K(m.value),m.valueSpec);if(i.result==="error")return i.value.map(g=>new o.V(`${m.key}${g.key}`,m.value,g.message));const c=i.value.expression||i.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!o.N(c))return[new o.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return yr(c,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!o.O(c,["zoom","feature-state"]))return[new o.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!o.Q(c))return[new o.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yr(m,i){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const v of i.valueSpec.expression.parameters)c.delete(v);if(c.size===0)return[];const g=[];return m instanceof o.S&&c.has(m.name)?[new o.V(i.key,i.value,`["${m.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(m.eachChild(v=>{g.push(...yr(v,i))}),g)}function Lr(m){const i=m.key,c=m.value,g=m.valueSpec,v=[];return Array.isArray(g.values)?g.values.indexOf(o.D(c))===-1&&v.push(new o.V(i,c,`expected one of [${g.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(g.values).indexOf(o.D(c))===-1&&v.push(new o.V(i,c,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(c)} found`)),v}function qr(m){return o.W(o.K(m.value))?Tr(o.C({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):nr(m)}function nr(m){const i=m.value,c=m.key;if(o.B(i)!=="array")return[new o.V(c,i,`array expected, ${o.B(i)} found`)];const g=m.styleSpec;let v,w=[];if(i.length<1)return[new o.V(c,i,"filter array must have at least 1 element")];switch(w=w.concat(Lr({key:`${c}[0]`,value:i[0],valueSpec:g.filter_operator,style:m.style,styleSpec:m.styleSpec})),o.D(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&o.D(i[1])==="$type"&&w.push(new o.V(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new o.V(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=o.B(i[1]),v!=="string"&&w.push(new o.V(`${c}[1]`,i[1],`string expected, ${v} found`)));for(let S=2;S<i.length;S++)v=o.B(i[S]),o.D(i[1])==="$type"?w=w.concat(Lr({key:`${c}[${S}]`,value:i[S],valueSpec:g.geometry_type,style:m.style,styleSpec:m.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&w.push(new o.V(`${c}[${S}]`,i[S],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let S=1;S<i.length;S++)w=w.concat(nr({key:`${c}[${S}]`,value:i[S],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":v=o.B(i[1]),i.length!==2?w.push(new o.V(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&w.push(new o.V(`${c}[1]`,i[1],`string expected, ${v} found`))}return w}function Wr(m,i){const c=m.key,g=m.style,v=m.layer,w=m.styleSpec,S=m.value,k=m.objectKey,L=w[`${i}_${m.layerType}`];if(!L)return[];const F=k.match(/^(.*)-transition$/);if(i==="paint"&&F&&L[F[1]]&&L[F[1]].transition)return en({key:c,value:S,valueSpec:w.transition,style:g,styleSpec:w});const V=m.valueSpec||L[k];if(!V)return[new o.A(c,S,`unknown property "${k}"`)];let q;if(o.B(S)==="string"&&o.G(V)&&!V.tokens&&(q=/^{([^}]+)}$/.exec(S))){const K=`\`{ "type": "identity", "property": ${q?JSON.stringify(q[1]):'"_"'} }\``;return[new o.V(c,S,`"${k}" does not support interpolation syntax
Use an identity property function instead: ${K}.`)]}const W=[];if(m.layerType==="symbol")k!=="text-field"||!g||g.glyphs||g.imports||W.push(new o.V(c,S,'use of "text-field" requires a style "glyphs" property')),k==="text-font"&&o.X(o.K(S))&&o.D(S.type)==="identity"&&W.push(new o.V(c,S,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&i==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&o.G(V)&&(o.Y(V)||o.H(V))){const K=o.L(o.K(S),V),ae=K.value.expression||K.value._styleExpression.expression;ae&&!o.O(ae,["measure-light"])&&(k==="model-emissive-strength"&&o.Q(ae)&&o.N(ae)||W.push(new o.V(c,S,`${k} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(en({key:m.key,value:S,valueSpec:V,style:g,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:k}))}function Zr(m){return Wr(m,"paint")}function Rn(m){return Wr(m,"layout")}function ln(m){let i=[];const c=m.value,g=m.key,v=m.style,w=m.styleSpec;c.type||c.ref||i.push(new o.V(g,c,'either "type" or "ref" is required'));let S=o.D(c.type);const k=o.D(c.ref);if(c.id){const L=o.D(c.id);for(let F=0;F<m.arrayIndex;F++){const V=v.layers[F];o.D(V.id)===L&&i.push(new o.V(g,c.id,`duplicate layer id "${c.id}", previously used at line ${V.id.__line__}`))}}if("ref"in c){let L;["type","source","source-layer","filter","layout"].forEach(F=>{F in c&&i.push(new o.V(g,c[F],`"${F}" is prohibited for ref layers`))}),v.layers.forEach(F=>{o.D(F.id)===k&&(L=F)}),L?L.ref?i.push(new o.V(g,c.ref,"ref cannot reference another ref layer")):S=o.D(L.type):typeof k=="string"&&i.push(new o.V(g,c.ref,`ref layer "${k}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(c.source){const L=v.sources&&v.sources[c.source],F=L&&o.D(L.type);L?F==="vector"&&S==="raster"?i.push(new o.V(g,c.source,`layer "${c.id}" requires a raster source`)):F==="raster"&&S!=="raster"?i.push(new o.V(g,c.source,`layer "${c.id}" requires a vector source`)):F!=="vector"||c["source-layer"]?F==="raster-dem"&&S!=="hillshade"?i.push(new o.V(g,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):F!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||F==="geojson"&&L.lineMetrics?S==="raster-particle"&&F!=="raster-array"&&i.push(new o.V(g,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):i.push(new o.V(g,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new o.V(g,c.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new o.V(g,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new o.V(g,c.source,`source "${c.source}" not found`))}else i.push(new o.V(g,c,'missing required property "source"'));return i=i.concat($t({key:g,value:c,valueSpec:w.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>en({key:`${g}.type`,value:c.type,valueSpec:w.layer.type,style:m.style,styleSpec:m.styleSpec,object:c,objectKey:"type"}),filter:L=>qr(o.C({layerType:S},L)),layout:L=>$t({layer:c,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":F=>Rn(o.C({layerType:S},F))}}),paint:L=>$t({layer:c,key:L.key,value:L.value,valueSpec:{},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{"*":F=>Zr(o.C({layerType:S,layer:c},F))}})}})),i}function jn(m){const i=m.value,c=m.key,g=o.B(i);return g!=="string"?[new o.V(c,i,`string expected, ${g} found`)]:[]}const uo={promoteId:function({key:m,value:i}){if(o.B(i)==="string")return jn({key:m,value:i});{const c=[];for(const g in i)c.push(...jn({key:`${m}.${g}`,value:i[g]}));return c}}};function ho(m){const i=m.value,c=m.key,g=m.styleSpec,v=m.style;if(!i.type)return[new o.V(c,i,'"type" is required')];const w=o.D(i.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(i.url||i.tiles||S.push(new o.A(c,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat($t({key:c,value:i,valueSpec:g[`source_${w.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:uo})),S;case"geojson":if(S=$t({key:c,value:i,valueSpec:g.source_geojson,style:v,styleSpec:g,objectElementValidators:uo}),i.cluster)for(const k in i.clusterProperties){const[L,F]=i.clusterProperties[k],V=typeof L=="string"?[L,["accumulated"],["get",k]]:L;S.push(...Tr({key:`${c}.${k}.map`,value:F,expressionContext:"cluster-map"})),S.push(...Tr({key:`${c}.${k}.reduce`,value:V,expressionContext:"cluster-reduce"}))}return S;case"video":return $t({key:c,value:i,valueSpec:g.source_video,style:v,styleSpec:g});case"image":return $t({key:c,value:i,valueSpec:g.source_image,style:v,styleSpec:g});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Lr({key:`${c}.type`,value:i.type,valueSpec:{values:vs(g)},style:v,styleSpec:g})}}function vs(m){return m.source.reduce((i,c)=>{const g=m[c];return g.type.type==="enum"&&(i=i.concat(Object.keys(g.type.values))),i},[])}function Ai(m){const i=m.value,c=m.styleSpec,g=c.light,v=m.style;let w=[];const S=o.B(i);if(i===void 0)return w;if(S!=="object")return w=w.concat([new o.V("light",i,`object expected, ${S} found`)]),w;for(const k in i){const L=k.match(/^(.*)-transition$/);w=w.concat(L&&g[L[1]]&&g[L[1]].transition?en({key:k,value:i[k],valueSpec:c.transition,style:v,styleSpec:c}):g[k]?en({key:k,value:i[k],valueSpec:g[k],style:v,styleSpec:c}):[new o.V(k,i[k],`unknown property "${k}"`)])}return w}function ns(m){const i=m.value;let c=[];if(!i)return c;const g=o.B(i);if(g!=="object")return c=c.concat([new o.V("light-3d",i,`object expected, ${g} found`)]),c;const v=m.styleSpec,w=v["light-3d"],S=m.key,k=m.style,L=m.style.lights;for(const q of["type","id"])if(!(q in i))return c=c.concat([new o.V("light-3d",i,`missing property ${q} on light`)]),c;if(i.type&&L)for(let q=0;q<m.arrayIndex;q++){const W=o.D(i.type),K=L[q];o.D(K.type)===W&&c.push(new o.V(S,i.id,`duplicate light type "${i.type}", previously defined at line ${K.id.__line__}`))}const F=`properties_light_${i.type}`;if(!(F in v))return c=c.concat([new o.V("light-3d",i,`Invalid light type ${i.type}`)]),c;const V=v[F];for(const q in i)if(q==="properties"){const W=i[q],K=o.B(W);if(K!=="object")return c=c.concat([new o.V("properties",W,`object expected, ${K} found`)]),c;for(const ae in W)c=c.concat(V[ae]?en({key:ae,value:W[ae],valueSpec:V[ae],style:k,styleSpec:v}):[new o.A(m.key,W[ae],`unknown property "${ae}"`)])}else{const W=q.match(/^(.*)-transition$/);c=c.concat(W&&w[W[1]]&&w[W[1]].transition?en({key:q,value:i[q],valueSpec:v.transition,style:k,styleSpec:v}):w[q]?en({key:q,value:i[q],valueSpec:w[q],style:k,styleSpec:v}):[new o.A(q,i[q],`unknown property "${q}"`)])}return c}function ki(m){const i=m.value,c=m.key,g=m.style,v=m.styleSpec,w=v.terrain;let S=[];const k=o.B(i);if(i===void 0||k==="null")return S;if(k!=="object")return S=S.concat([new o.V("terrain",i,`object expected, ${k} found`)]),S;for(const L in i){const F=L.match(/^(.*)-transition$/);S=S.concat(F&&w[F[1]]&&w[F[1]].transition?en({key:L,value:i[L],valueSpec:v.transition,style:g,styleSpec:v}):w[L]?en({key:L,value:i[L],valueSpec:w[L],style:g,styleSpec:v}):[new o.A(L,i[L],`unknown property "${L}"`)])}if(i.source){const L=g.sources&&g.sources[i.source],F=L&&o.D(L.type);L?F!=="raster-dem"&&S.push(new o.V(c,i.source,`terrain cannot be used with a source of type ${String(F)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(c,i.source,`source "${i.source}" not found`))}else S.push(new o.V(c,i,'terrain is missing required property "source"'));return S}function Oi(m){const i=m.value,c=m.style,g=m.styleSpec,v=g.fog;let w=[];const S=o.B(i);if(i===void 0)return w;if(S!=="object")return w=w.concat([new o.V("fog",i,`object expected, ${S} found`)]),w;for(const k in i){const L=k.match(/^(.*)-transition$/);w=w.concat(L&&v[L[1]]&&v[L[1]].transition?en({key:k,value:i[k],valueSpec:g.transition,style:c,styleSpec:g}):v[k]?en({key:k,value:i[k],valueSpec:v[k],style:c,styleSpec:g}):[new o.A(k,i[k],`unknown property "${k}"`)])}return w}const Zo={"*":()=>[],array:_r,boolean:function(m){const i=m.value,c=m.key,g=o.B(i);return g!=="boolean"?[new o.V(c,i,`boolean expected, ${g} found`)]:[]},number:Wt,color:function(m){const i=m.key,c=m.value,g=o.B(c);return g!=="string"?[new o.V(i,c,`color expected, ${g} found`)]:o.U.parseCSSColor(c)===null?[new o.V(i,c,`color expected, "${c}" found`)]:[]},enum:Lr,filter:qr,function:mr,layer:ln,object:$t,source:ho,model:o.Z,light:Ai,"light-3d":ns,terrain:ki,fog:Oi,string:jn,formatted:function(m){return jn(m).length===0?[]:Tr(m)},resolvedImage:function(m){return jn(m).length===0?[]:Tr(m)},projection:function(m){const i=m.value,c=m.styleSpec,g=c.projection,v=m.style;let w=[];const S=o.B(i);if(S==="object")for(const k in i)w=w.concat(en({key:k,value:i[k],valueSpec:g[k],style:v,styleSpec:c}));else S!=="string"&&(w=w.concat([new o.V("projection",i,`object or string expected, ${S} found`)]));return w},import:function(m){const{value:i,styleSpec:c}=m,{data:g,...v}=i;Object.defineProperty(v,"__line__",{value:i.__line__,enumerable:!1});let w=$t(o.C({},m,{value:v,valueSpec:c.import}));return o.D(v.id)===""&&w.push(new o.V(`${m.key}.id`,v,"import id can't be an empty string")),g&&(w=w.concat(bs(g,c,{key:`${m.key}.data`}))),w}};function en(m,i=!1){const c=m.value,g=m.valueSpec,v=m.styleSpec;if(g.expression&&o.X(o.D(c)))return mr(m);if(g.expression&&o.J(o.K(c)))return Tr(m);if(g.type&&Zo[g.type]){const w=Zo[g.type](m);return i===!0&&w.length>0&&o.B(m.value)==="array"?Tr(m):w}return $t(o.C({},m,{valueSpec:g.type?v[g.type]:g}))}function Do(m){const i=m.value,c=m.key,g=jn(m);return g.length||(i.indexOf("{fontstack}")===-1&&g.push(new o.V(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&g.push(new o.V(c,i,'"glyphs" url must include a "{range}" token'))),g}function bs(m,i=o._,c={}){return en({key:c.key||"",value:m,valueSpec:i.$root,styleSpec:i,style:m,objectElementValidators:{glyphs:Do,"*":()=>[]}})}function Lo(m,i=o._){return Ge(bs(m,i))}const jo=m=>Ge(ho(m)),is=m=>Ge(Ai(m)),Is=m=>Ge(ns(m)),Ks=m=>Ge(ki(m)),$o=m=>Ge(Oi(m)),pt=m=>Ge(ln(m)),fe=m=>Ge(qr(m)),xe=m=>Ge(Zr(m)),Ne=m=>Ge(Rn(m)),Ke=m=>Ge(o.Z(m));function Ge(m){return m.slice().sort((i,c)=>i.line&&c.line?i.line-c.line:0)}function st(m,i){let c=!1;if(i&&i.length)for(const g of i)g instanceof o.A?o.w(g.message):(m.fire(new o.t(new Error(g.message))),c=!0);return c}let _t;class at extends o.E{constructor(i,c="flat"){super(),this._transitionable=new o.$(_t||(_t=new o.a0({anchor:new o.a1(o._.light.anchor),position:new o.a2(o._.light.position),color:new o.a1(o._.light.color),intensity:new o.a1(o._.light.intensity)}))),this.setLight(i,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c,g={}){this._validate(is,i,g)||(this._transitionable.setTransitionOrValue(i),this.id=c)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,g){return(!g||g.validate!==!1)&&st(this,i.call(Lo,o.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}const bt=new o.a0({source:new o.a1(o._.terrain.source),exaggeration:new o.a1(o._.terrain.exaggeration)});let St=class extends o.E{constructor(m,i,c,g){super(),this.scope=c,this._transitionable=new o.$(bt,c,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(m,i){this._transitionable.setTransitionOrValue(m,i)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new o.a3(m)).get("exaggeration")}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof o.a4}};const xt=45,jt=65,ur=.05;function ir(m,i,c,g){const v=o.a7(xt,jt,c),[w,S]=Rr(m,g);let k=1-Math.min(1,Math.exp((i-w)/(S-w)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*v*m.alpha}function Rr(m,i){const c=.5/Math.tan(.5*i);return[m.range[0]+c,m.range[1]+c]}function Br(m,i,c,g,v){const w=o.a6.vec3.transformMat4([],[i,c,g],v.mercatorFogMatrix);return ir(m,o.a6.vec3.length(w),v.pitch,v._fov)}function kr(m,i,c,g,v,w,S){const k=[[c,g,0],[v,g,0],[v,w,0],[c,w,0]];let L=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(const V of k){const q=o.a6.vec3.transformMat4([],V,i),W=o.a6.vec3.length(q);L=Math.min(L,W),F=Math.max(F,W)}return[ir(m,L,S.pitch,S._fov),ir(m,F,S.pitch,S._fov)]}const zr=new o.a0({range:new o.a1(o._.fog.range),color:new o.a1(o._.fog.color),"high-color":new o.a1(o._.fog["high-color"]),"space-color":new o.a1(o._.fog["space-color"]),"horizon-blend":new o.a1(o._.fog["horizon-blend"]),"star-intensity":new o.a1(o._.fog["star-intensity"]),"vertical-range":new o.a1(o._.fog["vertical-range"])});class yn extends o.E{constructor(i,c,g,v){super(),this._transitionable=new o.$(zr,g,new Map(v)),this.set(i,v),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.a8(zr),this.scope=g}get state(){const i=this._transform,c=i.projection.name==="globe",g=o.a9(i.zoom),v=this.properties.get("range"),w=[.5,3];return{range:c?[o.aa(w[0],v[0],g),o.aa(w[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c,g={}){if(this._validate($o,i,g))return;const v=o.l({},i);for(const w of Object.keys(o._.fog))v[w]===void 0&&(v[w]=o._.fog[w].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.a7(xt,jt,i))*c.a}getOpacityAtLatLng(i,c){return this._transform.projection.supportsFog?function(g,v,w){const S=o.a5.fromLngLat(v),k=w.elevation?w.elevation.getAtPointOrZero(S):0;return Br(g,S.x,S.y,k,w)}(this.state,i,c):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(i.toUnwrapped());return kr(this.state,c,0,0,o.ab,o.ab,this._transform)}getOpacityForBounds(i,c,g,v,w){return this._transform.projection.supportsFog?kr(this.state,i,c,g,v,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?Rr(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const g of c){const v=i.points[g];let w;if(v[2]>=0)w=v;else{const S=i.points[g-4];w=o.ac(S,v,S[2]/(S[2]-v[2]))}if(Br(this.state,w[0],w[1],0,this._transform)>=ur)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,g){return(!g||g.validate!==!1)&&st(this,i.call(Lo,o.l({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o._})))}}class Tn extends o.E{constructor(i,c,g,v){super(),this.scope=g,this._options=i,this.properties=new o.a8(c),this._transitionable=new o.$(c,g,new Map(v)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,c){this._options=i,this._transitionable.setTransitionOrValue(i.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Yr,On;class Qn{constructor(i,c,g,v){this.screenBounds=i,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(i,c){let g,v;if(i instanceof o.P||typeof i[0]=="number"){const w=o.P.convert(i);g=[w],v=c.isPointAboveHorizon(w)}else{const w=o.P.convert(i[0]),S=o.P.convert(i[1]);g=[w,S],v=o.ae(w,S).every(k=>c.isPointAboveHorizon(k))}return new Qn(g,c.getCameraPoint(),v,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return o.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.ae(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),o.af(v,i)}bufferedCameraGeometryGlobe(i){const c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.ae(c,g,i),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>g.y))+((w.x>c.x)+(w.x>g.x))){case 0:v[0]=w,v[4]=w.clone();break;case 1:v.splice(1,0,w);break;case 2:v[1]=w;break;case 3:v.splice(4,0,w);break;case 5:v.splice(2,0,w);break;case 6:v[3]=w;break;case 7:v.splice(3,0,w);break;case 8:v[2]=w}return v}containsTile(i,c,g,v=0){const w=i.queryPadding/c._pixelsPerMercatorPixel+1,S=g?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let k=i.tileID.wrap+(S.unwrapped?v:0);const L=S.polygon.map(ue=>o.ag(i.tileTransform,ue,k));if(!o.ah(L,0,0,o.ab,o.ab))return;k=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const F=this.screenGeometryMercator.polygon.map(ue=>o.ai(i.tileTransform,ue,k)),V=F.map(ue=>new o.P(ue[0],ue[1])),q=c.getFreeCameraOptions().position||new o.a5(0,0,0),W=o.ai(i.tileTransform,q,k),K=F.map(ue=>{const pe=o.a6.vec3.sub(ue,ue,W);return o.a6.vec3.normalize(pe,pe),new o.aj(W,pe)}),ae=o.ak(i,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:V,tilespaceRays:K,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(le=o.al(L),le.min.x=o.ap(le.min.x,0,o.ab),le.min.y=o.ap(le.min.y,0,o.ab),le.max.x=o.ap(le.max.x,0,o.ab),le.max.y=o.ap(le.max.y,0,o.ab),le),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:ae};var le}_bufferedScreenMercator(i,c){const g=Li(i);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),c):{polygon:this.bufferedScreenGeometry(i).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(i,c){const g=Li(i);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),c):{polygon:this.bufferedCameraGeometry(i).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(i,c){const g=function(w,S){const k=o.a6.mat4.multiply([],S.pixelMatrix,S.globeMatrix),L=[0,-o.aq,0,1],F=[0,o.aq,0,1],V=[0,0,0,1];o.a6.vec4.transformMat4(L,L,k),o.a6.vec4.transformMat4(F,F,k),o.a6.vec4.transformMat4(V,V,k);const q=new o.P(L[0]/L[3],L[1]/L[3]),W=new o.P(F[0]/F[3],F[1]/F[3]),K=o.an(w,q)&&L[3]<V[3],ae=o.an(w,W)&&F[3]<V[3];if(!K&&!ae)return null;const le=function(He,je,Ze){for(let rt=1;rt<He.length;rt++){const Je=Di(je.pointCoordinate3D(He[rt-1]).x),Ye=Di(je.pointCoordinate3D(He[rt]).x);if(Ze<0){if(Je<Ye)return{idx:rt,t:-Je/(Ye-1-Je)}}else if(Ye<Je)return{idx:rt,t:(1-Je)/(Ye+1-Je)}}return null}(w,S,K?-1:1);if(!le)return null;const{idx:ue,t:pe}=le;let Re=ue>1?Kn(w.slice(0,ue),S):[],Oe=ue<w.length?Kn(w.slice(ue),S):[];Re=Re.map(He=>new o.P(Di(He.x),He.y)),Oe=Oe.map(He=>new o.P(Di(He.x),He.y));const Ae=[...Re];Ae.length===0&&Ae.push(Oe[Oe.length-1]);const Be=o.aa(Ae[Ae.length-1].y,(Oe.length===0?Re[0]:Oe[0]).y,pe);let Le;return Le=K?[new o.P(0,Be),new o.P(0,0),new o.P(1,0),new o.P(1,Be)]:[new o.P(1,Be),new o.P(1,1),new o.P(0,1),new o.P(0,Be)],Ae.push(...Le),Oe.length===0?Ae.push(Re[0]):Ae.push(...Oe),{polygon:Ae.map(He=>new o.a5(He.x,He.y)),unwrapped:!1}}(i,c);if(g)return g;const v=function(w,S){let k=!1,L=-1/0,F=0;for(let q=0;q<w.length-1;q++)w[q].x>L&&(L=w[q].x,F=q);for(let q=0;q<w.length-1;q++){const W=(F+q)%(w.length-1),K=w[W],ae=w[W+1];Math.abs(K.x-ae.x)>.5&&(K.x<ae.x?(K.x+=1,W===0&&(w[w.length-1].x+=1)):(ae.x+=1,W+1===w.length-1&&(w[0].x+=1)),k=!0)}const V=o.am(S.center.lng);return k&&V<Math.abs(V-1)&&w.forEach(q=>{q.x-=1}),{polygon:w,unwrapped:k}}(Kn(i,c).map(w=>new o.P(Di(w.x),w.y)),c);return{polygon:v.polygon.map(w=>new o.a5(w.x,w.y)),unwrapped:v.unwrapped}}}function Kn(m,i){return o.ao(m,c=>{const g=i.pointCoordinate3D(c);c.x=g.x,c.y=g.y},1/256)}function Di(m){return m<0?1+m%1:m%1}function Li(m){return 100*m|0}function mo(m,i,c,g,v){const w=function(k,L){if(k)return v(k);if(L){if(m.url&&L.tiles&&m.tiles&&delete m.tiles,L.variants){if(!Array.isArray(L.variants))return v(new Error("variants must be an array"));for(const V of L.variants){if(V==null||typeof V!="object"||V.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(V.capabilities))return v(new Error("capabilities must be an array"));if(V.capabilities.length===1&&V.capabilities[0]==="meshopt"){L=o.l(L,V);break}}}const F=o.ar(o.l(L,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(F.vectorLayers=L.vector_layers,F.vectorLayerIds=F.vectorLayers.map(V=>V.id)),L.raster_layers&&(F.rasterLayers=L.raster_layers,F.rasterLayerIds=F.rasterLayers.map(V=>V.id)),F.tiles=i.canonicalizeTileset(F,m.url),v(null,F)}},S=function(k,L,F){if(!k)return null;if(!L&&!F)return k;F=F||k.worldview_default;const V=Object.values(k.language||{});if(V.length===0)return null;const q=Object.values(k.worldview||{});if(q.length===0)return null;const W=V.every(ae=>ae===L),K=q.every(ae=>ae===F);return W&&K?k:L in(k.language_options||{})||F in(k.worldview_options||{})?null:k.language_options&&k.worldview_options?k:null}(m.data,c,g);return S?o.q.frame(()=>w(null,S)):m.url?o.n(i.transformRequest(i.normalizeSourceURL(m.url,null,c,g),o.R.Source),w):o.q.frame(()=>{const{data:k,...L}=m;w(null,L)})}class os{constructor(i,c,g){this.bounds=o.as.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const c=Math.pow(2,i.z),g=Math.floor(o.am(this.bounds.getWest())*c),v=Math.floor(o.at(this.bounds.getNorth())*c),w=Math.ceil(o.am(this.bounds.getEast())*c),S=Math.ceil(o.at(this.bounds.getSouth())*c);return i.x>=g&&i.x<w&&i.y>=v&&i.y<S}}class Ka extends o.E{constructor(i,c,g,v){if(super(),this.id=i,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.l(this,o.ar(c,["url","scheme","tileSize","promoteId"])),this._options=o.l({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new o.au}load(i){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=mo(this._options,this.map._requestManager,c,g,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new o.t(v))):w&&(o.l(this,w),w.bounds&&(this.tileBounds=new os(w.bounds,this.minzoom,this.maxzoom)),Xr(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(v)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}loadTile(i,c){const g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),v=this.map._requestManager.transformRequest(g,o.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S={request:v,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=c:i.request=i.actor.send("reloadTile",S,k.bind(this));else if(i.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",S,k.bind(this),void 0,!0);else{const L=o.aw.call({deduped:this._deduped},S,(F,V)=>{F||!V?k.call(this,F):(S.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},i.actor&&i.actor.send("loadTile",S,k.bind(this),void 0,!0))},!0);i.request={cancel:L}}function k(L,F){return delete i.request,i.aborted?c(null):L&&L.status!==404?c(L):(F&&F.resourceTiming&&(i.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&i.setExpiryData(F),i.loadVectorData(F,this.map.painter),o.ax(this.dispatcher),c(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class As extends o.E{constructor(i,c,g,v){super(),this.id=i,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.l({type:"raster"},c),o.l(this,o.ar(c,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._tileJSONRequest=mo(this._options,this.map._requestManager,null,null,(c,g)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.t(c)):g&&(o.l(this,g),g.bounds&&(this.tileBounds=new os(g.bounds,this.minzoom,this.maxzoom)),Xr(g.tiles),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(c)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=o.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return o.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const g=o.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);i.request=o.o(this.map._requestManager.transformRequest(v,o.R.Tile),(w,S,k,L)=>(delete i.request,i.aborted?(i.state="unloaded",c(null)):w?(i.state="errored",c(w)):S?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:k,expires:L}),i.setTexture(S,this.map.painter),i.state="loaded",o.ax(this.dispatcher),void c(null)):c(null)))}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c&&c()}unloadTile(i,c){i.texture&&i.texture instanceof o.T?(i.destroy(!0),i.texture&&i.texture instanceof o.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xs extends As{constructor(i,c,g,v){super(i,c,g,v),this.type="raster-array",this.maxzoom=22,this._options=o.l({type:"raster-array"},c)}triggerRepaint(i){const c=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);c&&c.enabled&&g&&c._clearRenderCacheForTile(g.id,i.tileID),this.map.triggerRepaint()}loadTile(i,c){const g=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(g,o.R.Tile);i.requestParams=v,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(w,S,k,L)=>{if(delete i.request,i.aborted)return i.state="unloaded",c(null);if(w)return w.code===20?void 0:(i.state="errored",c(w));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:k,expires:L}),i.state="empty",c(null)})}unloadTile(i,c){const g=i.texture;g&&g instanceof o.T?(i.destroy(!0),this.map.painter.saveTileTexture(g)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,c,g){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(c,g,(v,w)=>{if(v)return i.state="errored",this.fire(new o.t(v)),void this.triggerRepaint(i);w&&(i.setTexture(w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:w})=>w===i),g=c&&c.fields,v=g&&g.bands&&g.bands;return v?v[0]:0}getTextureDescriptor(i,c,g){if(!i)return;const v=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let w=null;c instanceof o.aB?w=c.paint.get("raster-array-band"):c instanceof o.aC&&(w=c.paint.get("raster-particle-array-band"));const S=w||this.getInitialBand(v);if(S!=null)if(i.textureDescriptor){if(!i.updateNeeded(v,S)||g)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,v,S)}}const Ma={vector:Ka,raster:As,"raster-dem":class extends As{constructor(m,i,c,g){super(m,i,c,g),this.type="raster-dem",this.maxzoom=22,this._options=o.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(m,i){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,w){v&&(m.state="errored",i(v)),w&&(m.dem=w,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",i(null))}m.request=o.o(this.map._requestManager.transformRequest(c,o.R.Tile),(function(v,w,S,k){if(delete m.request,m.aborted)m.state="unloaded",i(null);else if(v)m.state="errored",i(v);else if(w){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:S,expires:k});const L=ImageBitmap&&w instanceof ImageBitmap&&o.ay(),F=1-(w.width-o.az(w.width))/2;F<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const V=L?w:o.q.getImageData(w,F),q={uid:m.uid,coord:m.tileID,source:this.id,scope:this.scope,rawImageData:V,encoding:this.encoding,padding:F};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",q,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const i=m.canonical,c=Math.pow(2,i.z),g=(i.x-1+c)%c,v=i.x===0?m.wrap-1:m.wrap,w=(i.x+1+c)%c,S=i.x+1===c?m.wrap+1:m.wrap,k={};return k[new o.aA(m.overscaledZ,v,i.z,g,i.y).key]={backfilled:!1},k[new o.aA(m.overscaledZ,S,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(k[new o.aA(m.overscaledZ,v,i.z,g,i.y-1).key]={backfilled:!1},k[new o.aA(m.overscaledZ,m.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},k[new o.aA(m.overscaledZ,S,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<c&&(k[new o.aA(m.overscaledZ,v,i.z,g,i.y+1).key]={backfilled:!1},k[new o.aA(m.overscaledZ,m.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},k[new o.aA(m.overscaledZ,S,i.z,w,i.y+1).key]={backfilled:!1}),k}},"raster-array":Xs,geojson:class extends o.E{constructor(m,i,c,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=i.data,this._options=o.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const v=o.ab/this.tileSize;this.workerOptions=o.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*v,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*v,extent:o.ab,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.ab,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*v,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new o.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new o.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const c of this._data.features)i.set(c.id,c);for(const c of m.features)i.set(c.id,c);this._data.features=[...i.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},i),this}getClusterChildren(m,i){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},i),this}getClusterLeaves(m,i,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:i,offset:c},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.x("dataloading",{dataType:"source"})),this._loaded=!1;const i=o.l({append:m},this.workerOptions);i.scope=this.scope;const c=this._data;typeof c=="string"?(i.request=this.map._requestManager.transformRequest(o.q.resolveURL(c),o.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(g,v)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new o.t(g));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new o.x("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,i){const c=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,v=this._partialReload,w={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g?{image:g.image.clone()}:null,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:v};m.request=this.actor.send(c,w,(S,k)=>v&&!k?(m.state="loaded",i(null)):(delete m.request,m.destroy(),m.aborted?i(null):S?i(S):(m.loadVectorData(k,this.map.painter,c==="reloadTile"),i(null))),void 0,c==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,i){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aD{constructor(m,i,c,g){super(m,i,c,g),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const i of m.urls)this.urls.push(this.map._requestManager.transformRequest(i,o.R.Source).url);o.aE(this.urls,(i,c)=>{this._loaded=!0,i?this.fire(new o.t(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const i=this.video.seekable;m<i.start(0)||m>i.end(0)?this.fire(new o.t(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,i=m.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(m,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aD,model:class extends o.E{constructor(m,i,c,g){super(),this.id=m,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const m=[];for(const i in this._options.models){const c=this._options.models[i],g=o.aG(this.map._requestManager.transformRequest(c.uri,o.R.Model).url).then(v=>{if(!v)return;const w=o.aH(v),S=new o.aI(i,c.position,c.orientation,w);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(v=>{this.fire(new o.t(new Error(`Could not load model ${i} from ${c.uri}: ${v.message}`)))});m.push(g)}return Promise.allSettled(m).then(()=>{this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new o.t(new Error(`Could not load models: ${i.message}`)))})}onAdd(m){this.map=m,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(m,i){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(m,i,c,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}load(m){this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=mo(this._options,this.map._requestManager,i,c,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.t(g))):v&&(o.l(this,v),v.bounds&&(this.tileBounds=new os(v.bounds,this.minzoom,this.maxzoom)),Xr(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,i){const c=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=i;else{if(m.buckets){const w=Object.values(m.buckets);for(const S of w)S.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,v.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(w,S){return m.aborted?i(null):w&&w.status!==404?i(w):(S&&(S.resourceTiming&&(m.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&m.setExpiryData(S),m.buckets={...m.buckets,...S.buckets},S.featureIndex&&(m.latestFeatureIndex=S.featureIndex)),m.state="loaded",void i(null))}}serialize(){return o.l({},this._options)}},canvas:class extends o.aD{constructor(m,i,c,g){super(m,i,c,g),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(w=>typeof w!="number"))||this.fire(new o.t(new o.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.t(new o.V(`sources.${m}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.t(new o.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new o.t(new o.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.t(new o.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof o.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends o.E{constructor(m,i,c,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=i,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new os(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),o.l(this,o.ar(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new o.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:i,y:c,z:g}=m.canonical;return this._implementation.hasTile({x:i,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,i){const{x:c,y:g,z:v}=m.tileID.canonical,w=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:c,y:g,z:v},{signal:w.signal})).then((function(S){return delete m.request,m.aborted?(m.state="unloaded",i(null)):S===void 0?(m.state="errored",i(null)):S===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",i(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(S)?(this.loadTileData(m,S),m.state="loaded",void i(null)):(m.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(m.state="errored",i(S))}),m.request.cancel=()=>w.abort()}loadTileData(m,i){m.setTexture(i,this.map.painter)}unloadTile(m,i){if(m.texture&&m.texture instanceof o.T?(m.destroy(!0),m.texture&&m.texture instanceof o.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:c,y:g,z:v}=m.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:v})}i&&i()}abortTile(m,i){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=o.av(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new o.x("data",{dataType:"source",sourceDataType:"content"}))}}},Bo=function(m,i,c,g){const v=new Ma[i.type](m,i,c,g);if(v.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${v.id}`);return o.aJ(["load","abort","unload","serialize","prepare"],v),v};function ka(m,i){const c=o.a6.mat4.identity([]);return o.a6.mat4.scale(c,c,[.5*m.width,.5*-m.height,1]),o.a6.mat4.translate(c,c,[1,-1,0]),o.a6.mat4.multiply(c,c,m.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(c)}function la(m,i,c,g,v,w,S,k=!1){const L=m.tilesIn(g,S,k);L.sort(Ys);const F=[];for(const q of L)F.push({wrappedTileID:q.tile.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(i,c,m._state,q,v,w,ka(m.transform,q.tile.tileID),k)});const V=function(q){const W={},K={};for(const ae of q){const le=ae.queryResults,ue=ae.wrappedTileID,pe=K[ue]=K[ue]||{};for(const Re in le){const Oe=le[Re],Ae=pe[Re]=pe[Re]||{},Be=W[Re]=W[Re]||[];for(const Le of Oe)Ae[Le.featureIndex]||(Ae[Le.featureIndex]=!0,Be.push(Le))}}return W}(F);for(const q in V)V[q].forEach(W=>{const K=W.feature,ae=K.layer;ae&&ae.type!=="background"&&ae.type!=="sky"&&ae.type!=="slot"&&(K.source=ae.source,ae["source-layer"]&&(K.sourceLayer=ae["source-layer"]),K.state=K.id!==void 0?m.getFeatureState(ae["source-layer"],K.id):{})});return V}function ca(m,i){const c=m.getRenderableIds().map(w=>m.getTileByID(w)),g=[],v={};for(let w=0;w<c.length;w++){const S=c[w],k=S.tileID.canonical.key;v[k]||(v[k]=!0,S.querySourceFeatures(g,i))}return g}function Ys(m,i){const c=m.tileID,g=i.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}const Xi=32,ji=33,eo=new Uint16Array(8184);for(let m=0;m<2046;m++){let i=m+2,c=0,g=0,v=0,w=0,S=0,k=0;for(1&i?v=w=S=Xi:c=g=k=Xi;(i>>=1)>1;){const F=c+v>>1,V=g+w>>1;1&i?(v=c,w=g,c=S,g=k):(c=v,g=w,v=S,w=k),S=F,k=V}const L=4*m;eo[L+0]=c,eo[L+1]=g,eo[L+2]=v,eo[L+3]=w}const Ci=new Uint16Array(2178),Yi=new Uint8Array(1089),go=new Uint16Array(1089);function io(m){return m===0?-.03125:m===32?.03125:0}const _s={type:2,extent:o.ab,loadGeometry:()=>[[new o.P(0,0),new o.P(o.ab+1,0),new o.P(o.ab+1,o.ab+1),new o.P(0,o.ab+1),new o.P(0,0)]]};class Ko{constructor(i,c,g,v,w){this.tileID=i,this.uid=o.aP(),this.uses=0,this.tileSize=c,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection)}registerFadeDuration(i){const c=i+this.timeAdded;c<o.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,c,g){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(v,w){const S={};if(!w)return S;for(const k of v){const L=k.layerIds.map(F=>w.getLayer(F)).filter(Boolean);if(L.length!==0){k.layers=L,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(F=>L.filter(V=>V.id===F)[0]));for(const F of L)S[F.fqid]=k}}return S}(i.buckets,c.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.aR){if(this.hasSymbolBuckets=!0,!g)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const w=this.buckets[v];if(w instanceof o.aR&&w.hasRTLText){this.hasRTLText=!0,o.aS();break}}this.queryPadding=0;for(const v in this.buckets){const w=this.buckets[v],S=c.style.getOwnLayer(v);if(!S)continue;const k=S.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,k)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new o.aQ}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(i)}const c=i.gl,g=this.imageAtlas;if(g&&!g.uploaded){const v=!!Object.keys(g.patternPositions).length;this.imageAtlasTexture=new o.T(i,g.image,c.RGBA8,{useMipmap:v}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(i,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(i,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(i,c,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,g),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=c.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this._lastUpdatedBrightness=v,this.updateBuckets(c)))}queryRenderedFeatures(i,c,g,v,w,S,k,L){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:v,pixelPosMatrix:k,transform:S,params:w,tileTransform:this.tileTransform},i,c,g):{}}querySourceFeatures(i,c){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const v=g.loadVTLayers(),w=c?c.sourceLayer:"",S=v._geojsonTileLayer||v[w];if(!S)return;const k=o.aT(c&&c.filter),{z:L,x:F,y:V}=this.tileID.canonical,q={z:L,x:F,y:V};for(let W=0;W<S.length;W++){const K=S.feature(W);if(k.needGeometry){const ue=o.aU(K,!0);if(!k.filter(new o.a3(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!k.filter(new o.a3(this.tileID.overscaledZ),K))continue;const ae=g.getId(K,w),le=new o.aV(K,L,F,V,ae);le.tile=q,i.push(le)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const g=o.aW(i.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const g=Date.now();let v=!1;if(this.expirationTime>g)v=!1;else if(c)if(this.expirationTime<c)v=!0;else{const w=this.expirationTime-c;w?this.expirationTime=g+Math.max(w,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,c){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0&&c&&this.updateBuckets(c)}updateBuckets(i){if(!this.latestFeatureIndex)return;const c=this.latestFeatureIndex.loadVTLayers(),g=i.style.listImages(),v=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const S=this.buckets[w],k=S.layers[0].sourceLayer||"_geojsonTileLayer",L=c[k],F=i.style.getOwnSourceCache(S.layers[0].source);let V={};F&&(V=F._state.getState(k,void 0)),S.update(V,L,g,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),(S instanceof o.aX||S instanceof o.aY)&&i._terrain&&i._terrain.enabled&&F&&S.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(F.id,this.tileID);const q=i&&i.style&&i.style.getOwnLayer(w);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=o.q.now()+i}setTexture(i,c){const g=c.context,v=g.gl;this.texture=this.texture||c.getTileTexture(i.width),this.texture&&this.texture instanceof o.T?this.texture.update(i):(this.texture=new o.T(g,i,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(i,c){const g={};for(const v of c)g[v]=!0;this.dependencies[i]=g}hasDependency(i,c){for(const g of i){const v=this.dependencies[g];if(v){for(const w of c)if(v[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const g=o.aZ(_s,this.tileID.canonical,this.tileTransform)[0],v=new o.a_,w=new o.a$;for(let S=0;S<g.length;S++){const{x:k,y:L}=g[S];v.emplaceBack(k,L),w.emplaceBack(S)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(v,o.b0.members),this._tileDebugSegments=o.b1.simpleSegment(0,0,v.length,w.length)}_makeTileBoundsBuffers(i,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const g=o.aZ(_s,this.tileID.canonical,this.tileTransform)[0];let v,w;if(this.isRaster){const S=function(k,L){const F=o.aK(k,L),V=Math.pow(2,k.z);for(let ue=0;ue<ji;ue++)for(let pe=0;pe<ji;pe++){const Re=o.aL((k.x+(pe+io(pe))/Xi)/V),Oe=o.aM((k.y+(ue+io(ue))/Xi)/V),Ae=L.project(Re,Oe),Be=ue*ji+pe;Ci[2*Be+0]=Math.round((Ae.x*F.scale-F.x)*o.ab),Ci[2*Be+1]=Math.round((Ae.y*F.scale-F.y)*o.ab)}Yi.fill(0),go.fill(0);for(let ue=2045;ue>=0;ue--){const pe=4*ue,Re=eo[pe+0],Oe=eo[pe+1],Ae=eo[pe+2],Be=eo[pe+3],Le=Re+Ae>>1,He=Oe+Be>>1,je=Le+He-Oe,Ze=He+Re-Le,rt=Oe*ji+Re,Je=Be*ji+Ae,Ye=He*ji+Le,ht=Math.hypot((Ci[2*rt+0]+Ci[2*Je+0])/2-Ci[2*Ye+0],(Ci[2*rt+1]+Ci[2*Je+1])/2-Ci[2*Ye+1])>=16;Yi[Ye]=Yi[Ye]||(ht?1:0),ue<1022&&(Yi[Ye]=Yi[Ye]||Yi[(Oe+Ze>>1)*ji+(Re+je>>1)]||Yi[(Be+Ze>>1)*ji+(Ae+je>>1)])}const q=new o.aN,W=new o.aO;let K=0;function ae(ue,pe){const Re=pe*ji+ue;return go[Re]===0&&(q.emplaceBack(Ci[2*Re+0],Ci[2*Re+1],ue*o.ab/Xi,pe*o.ab/Xi),go[Re]=++K),go[Re]-1}function le(ue,pe,Re,Oe,Ae,Be){const Le=ue+Re>>1,He=pe+Oe>>1;if(Math.abs(ue-Ae)+Math.abs(pe-Be)>1&&Yi[He*ji+Le])le(Ae,Be,ue,pe,Le,He),le(Re,Oe,Ae,Be,Le,He);else{const je=ae(ue,pe),Ze=ae(Re,Oe),rt=ae(Ae,Be);W.emplaceBack(je,Ze,rt)}}return le(0,0,Xi,Xi,Xi,0),le(Xi,Xi,0,0,0,Xi),{vertices:q,indices:W}}(this.tileID.canonical,c);v=S.vertices,w=S.indices}else{v=new o.aN,w=new o.aO;for(const{x:k,y:L}of g)v.emplaceBack(k,L,0,0);const S=o.b2(v.int16,void 0,4);for(let k=0;k<S.length;k+=3)w.emplaceBack(S[k],S[k+1],S[k+2])}this._tileBoundsBuffer=i.createVertexBuffer(v,o.b3.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=o.b1.simpleSegment(0,0,v.length,w.length)}_makeGlobeTileDebugBuffers(i,c){const g=c.projection;if(!g||g.name!=="globe"||c.freezeTileCoverage)return;const v=this.tileID.canonical,w=o.b4(v,c),S=o.b5(w),k=o.a9(c.zoom);let L;k>0&&(L=o.a6.mat4.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,v,c,S,L,k),this._makeGlobeTileDebugTextBuffer(i,v,c,S,L,k)}_globePoint(i,c,g,v,w,S,k){let L=o.b6(i,c,g);if(S){const F=1<<g.z,V=o.am(v.center.lng),q=o.at(v.center.lat),W=(g.x+.5)/F-V;let K=0;W>.5?K=-1:W<-.5&&(K=1);let ae=(i/o.ab+g.x)/F+K,le=(c/o.ab+g.y)/F;ae=(ae-V)*v._pixelsPerMercatorPixel+V,le=(le-q)*v._pixelsPerMercatorPixel+q;const ue=[ae*v.worldSize,le*v.worldSize,0];o.a6.vec3.transformMat4(ue,ue,S),L=o.b7(L,ue,k)}return o.a6.vec3.transformMat4(L,L,w)}_makeGlobeTileDebugBorderBuffer(i,c,g,v,w,S){const k=new o.a_,L=new o.a$,F=new o.b8,V=(W,K,ae,le,ue)=>{const pe=(ae-W)/(ue-1),Re=(le-K)/(ue-1),Oe=k.length;for(let Ae=0;Ae<ue;Ae++){const Be=W+Ae*pe,Le=K+Ae*Re;k.emplaceBack(Be,Le);const He=this._globePoint(Be,Le,c,g,v,w,S);F.emplaceBack(He[0],He[1],He[2]),L.emplaceBack(Oe+Ae)}},q=o.ab;V(0,0,q,0,16),V(q,0,q,q,16),V(q,q,0,q,16),V(0,q,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(L),this._tileDebugBuffer=i.createVertexBuffer(k,o.b0.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(F,o.b9.members),this._tileDebugSegments=o.b1.simpleSegment(0,0,k.length,L.length)}_makeGlobeTileDebugTextBuffer(i,c,g,v,w,S){const k=o.ab/4,L=new o.a_,F=new o.aO,V=new o.b8,q=25;F.reserve(32),L.reserve(q),V.reserve(q);const W=(K,ae)=>q*K+ae;for(let K=0;K<q;K++){const ae=K*k;for(let le=0;le<q;le++){const ue=le*k;L.emplaceBack(ue,ae);const pe=this._globePoint(ue,ae,c,g,v,w,S);V.emplaceBack(pe[0],pe[1],pe[2])}}for(let K=0;K<4;K++)for(let ae=0;ae<4;ae++){const le=W(K,ae),ue=W(K,ae+1),pe=W(K+1,ae),Re=W(K+1,ae+1);F.emplaceBack(le,ue,pe),F.emplaceBack(pe,ue,Re)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(F),this._tileDebugTextBuffer=i.createVertexBuffer(L,o.b0.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(V,o.b9.members),this._tileDebugTextSegments=o.b1.simpleSegment(0,0,q,32)}destroy(i=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.ba.setPbf(o.bb);class ei extends Ko{constructor(i,c,g,v,w){super(i,c,g,v,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,c){const g=c.context,v=g.gl;this.texture=this.texture||c.getTileTexture(i.width),this.texture&&this.texture instanceof o.T?this.texture.update(i,{premultiply:!1}):this.texture=new o.T(g,i,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,c){const g=this._mrt=new o.ba(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=o.bc(v,(w,S,k,L)=>{if(w)c(w);else try{const F=g.getHeaderLength(S);if(F>i)return void(this.request=this.fetchHeader(F,c));g.parseHeader(S),this._isHeaderLoaded=!0;let V=0;for(const q of Object.values(g.layers))V=Math.max(V,q.dataIndex[q.dataIndex.length-1].last_byte);S.byteLength>=V&&(this.entireBuffer=S),c(null,this.entireBuffer||S,k,L)}catch(F){c(F)}}),this.request}fetchBand(i,c,g){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void g(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void g(new Error("Can't fetch tile band without an actor"));let S;const k=(q,W)=>{S.complete(q,W),q?g(q):(this.updateTextureDescriptor(i,c),g(null,this.textureDescriptor&&this.textureDescriptor.img))},L=(q,W)=>{if(q)return g(q);const K=w.send("decodeRasterArray",{buffer:W,task:S},k,void 0,!0);this._workQueue.push(()=>{K&&K.cancel(),S.cancel()})},F=v.getLayer(i);if(!F)return void g(new Error(`Unknown sourceLayer "${i}"`));if(F.hasDataForBand(c))return this.updateTextureDescriptor(i,c),void g(null,this.textureDescriptor?this.textureDescriptor.img:null);const V=F.getDataRange([c]);if(S=v.createDecodingTask(V),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)L(null,this.entireBuffer.slice(V.firstByte,V.lastByte+1));else{const q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${V.firstByte}-${V.lastByte}`}}),W=o.bc(q,L);this._fetchQueue.push(()=>{W.cancel(),S.cancel()})}else g(null)}updateNeeded(i,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,c){if(!this._mrt)return;const g=this._mrt.getLayer(i);if(!g||!g.hasBand(c)||!g.hasDataForBand(c))return;const{bytes:v,tileSize:w,buffer:S,offset:k,scale:L}=g.getBandView(c),F=w+2*S,V={data:v,width:F,height:F},q=this.texture;q&&q instanceof o.T&&q.update(V,{premultiply:!1}),this.textureDescriptor={layer:i,band:c,img:V,buffer:S,offset:k,tileSize:w,format:g.pixelFormat,mix:[L,256*L,65536*L,16777216*L]}}}class ua{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,g){const v=i.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const w={value:c,timeout:void 0};if(g!==void 0&&(w.timeout=setTimeout(()=>{this.remove(i,w)},g)),this.data[v].push(w),this.order.push(v),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const g=i.wrapped().key,v=c===void 0?0:this.data[g].indexOf(c),w=this.data[g][v];return this.data[g].splice(v,1),w.timeout&&clearTimeout(w.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(w.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const g in this.data)for(const v of this.data[g])i(v.value)||c.push(v);for(const g of c)this.remove(g.value.tileID,g)}}class Js{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,g){const v=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][v]=this.stateChanges[i][v]||{},o.l(this.stateChanges[i][v],g),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==v&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][v]===null){this.deletedStates[i][v]={};for(const w in this.state[i][v])g[w]||(this.deletedStates[i][v][w]=null)}else for(const w in g)this.deletedStates[i]&&this.deletedStates[i][v]&&this.deletedStates[i][v][w]===null&&delete this.deletedStates[i][v][w]}removeFeatureState(i,c,g){if(this.deletedStates[i]===null)return;const v=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},g&&c!==void 0)this.deletedStates[i][v]!==null&&(this.deletedStates[i][v]=this.deletedStates[i][v]||{},this.deletedStates[i][v][g]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][v])for(g in this.deletedStates[i][v]={},this.stateChanges[i][v])this.deletedStates[i][v][g]=null;else this.deletedStates[i][v]=null;else this.deletedStates[i]=null}getState(i,c){const g=this.state[i]||{},v=this.stateChanges[i]||{},w=this.deletedStates[i];if(w===null)return{};if(c!==void 0){const k=String(c),L=o.l({},g[k],v[k]);if(w){const F=w[c];if(F===null)return{};for(const V in F)delete L[V]}return L}const S=o.l({},g,v);if(w)for(const k in w)delete S[k];return S}initializeTileState(i,c){i.setFeatureState(this.state,c)}coalesceChanges(i,c){const g={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const w={};for(const S in this.stateChanges[v])this.state[v][S]||(this.state[v][S]={}),o.l(this.state[v][S],this.stateChanges[v][S]),w[S]=this.state[v][S];g[v]=w}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const w={};if(this.deletedStates[v]===null)for(const S in this.state[v])w[S]={},this.state[v][S]={};else for(const S in this.deletedStates[v]){if(this.deletedStates[v][S]===null)this.state[v][S]={};else if(this.state[v][S])for(const k of Object.keys(this.deletedStates[v][S]))delete this.state[v][S][k];w[S]=this.state[v][S]}g[v]=g[v]||{},o.l(g[v],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const v in i)i[v].setFeatureState(g,c)}}class Ji extends o.E{constructor(i,c,g){super(),this.id=i,this._onlySymbols=g,c.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new ua(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Js,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const c=this._tiles[i];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,c){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,c)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const g=this._tiles[c];g.upload(i),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.bd(this._tiles).map(i=>i.tileID).sort(Cs).map(i=>i.key)}getRenderableIds(i,c){const g=[];for(const v in this._tiles)this._isIdRenderable(+v,i,c)&&g.push(this._tiles[v]);return i?g.sort((v,w)=>{const S=v.tileID,k=w.tileID,L=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),F=new o.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-k.overscaledZ||F.y-L.y||F.x-L.x}).map(v=>v.tileID.key):g.map(v=>v.tileID).sort(Cs).map(v=>v.key)}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c,g){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())&&(g||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,c){const g=this._tiles[i];g&&(g.state!=="loading"&&(g.state=c),this._loadTile(g,this._tileLoaded.bind(this,g,i,c)))}_tileLoaded(i,c,g,v){if(v)if(i.state="errored",v.status!==404)this._source.fire(new o.t(v,{tile:i}));else{if(this._source.fire(new o.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=o.q.now(),g==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new o.x("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const c=this.getRenderableIds();for(let v=0;v<c.length;v++){const w=c[v];if(i.neighboringTiles&&i.neighboringTiles[w]){const S=this.getTileByID(w);g(i,S),g(S,i)}}function g(v,w){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let S=w.tileID.canonical.x-v.tileID.canonical.x;const k=w.tileID.canonical.y-v.tileID.canonical.y,L=Math.pow(2,v.tileID.canonical.z),F=w.tileID.key;S===0&&k===0||Math.abs(k)>1||(Math.abs(S)>1&&(Math.abs(S+L)===1?S+=L:Math.abs(S-L)===1&&(S-=L)),w.dem&&v.dem&&(v.dem.backfillBorder(w.dem,S,k),v.neighboringTiles&&v.neighboringTiles[F]&&(v.neighboringTiles[F].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,g,v){for(const w in this._tiles){let S=this._tiles[w];if(v[w]||!S.hasData()||S.tileID.overscaledZ<=c||S.tileID.overscaledZ>g)continue;let k=S.tileID;for(;S&&S.tileID.overscaledZ>c+1;){const F=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[F.key],S&&S.hasData()&&(k=F)}let L=k;for(;L.overscaledZ>c;)if(L=L.scaledTo(L.overscaledZ-1),i[L.key]){v[k.key]=k;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const g=this._loadedParentTiles[i.key];return g&&g.tileID.overscaledZ>=c?g:null}for(let g=i.overscaledZ-1;g>=c;g--){const v=i.scaledTo(g),w=this._getLoadedTile(v);if(w)return w}}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,c){c=c||this._source.tileSize;const g=Math.ceil(i.width/c)+1,v=Math.ceil(i.height/c)+1,w=Math.floor(g*v*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(k)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const g={};for(const v in this._tiles){const w=this._tiles[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),g[w.tileID.key]=w}this._tiles=g;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(i,c,g,v){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(i,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let S;if(this.used||this.usedForTerrain){if(this._source.tileID)S=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new o.aA(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){const F=i.clone();F.tileCoverLift=this.tileCoverLift,S=F.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&i.projection.name==="globe"&&(S.push(new o.aA(1,0,1,0,0)),S.push(new o.aA(1,0,1,1,0)),S.push(new o.aA(1,0,1,0,1)),S.push(new o.aA(1,0,1,1,1)))}else if(S=i.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);S=S.filter(V=>F(V))}}else S=[];if(S.length>0&&this.castsShadows&&v&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qs(this._source.type)){const F=i.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),V=Math.min(F,this._source.maxzoom);if(w){const q=i.extendTileCover(S,V);for(const W of q)S.push(W)}else{const q=i.extendTileCover(S,V,v);for(const W of q)this._shadowCasterTiles[W.key]=!0,S.push(W)}}const k=this._updateRetainedTiles(S);if(Qs(this._source.type)&&S.length!==0){const F={},V={},q=Object.keys(k);for(const K of q){const ae=k[K],le=this._tiles[K];if(!le||le.fadeEndTime&&le.fadeEndTime<=o.q.now())continue;const ue=this.findLoadedParent(ae,Math.max(ae.overscaledZ-Ji.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),F[ue.tileID.key]=ue.tileID),V[K]=ae}const W=S[S.length-1].overscaledZ;for(const K in this._tiles){const ae=this._tiles[K];if(k[K]||!ae.hasData())continue;let le=ae.tileID;for(;le.overscaledZ>W;){le=le.scaledTo(le.overscaledZ-1);const ue=this._tiles[le.key];if(ue&&ue.hasData()&&V[le.key]){k[K]=ae.tileID;break}}}for(const K in F)k[K]||(this._coveredTiles[K]=!0,k[K]=F[K])}for(const F in k)this._tiles[F].clearFadeHold();const L=o.be(this._tiles,k);for(const F of L){const V=this._tiles[F];V.hasSymbolBuckets&&!V.holdingForFade()?V.setHoldDuration(this.map._fadeDuration):V.hasSymbolBuckets&&!V.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const c={};if(i.length===0)return c;const g={},v=i.reduce((F,V)=>Math.min(F,V.overscaledZ),1/0),w=i[0].overscaledZ,S=Math.max(w-Ji.maxOverzooming,this._source.minzoom),k=Math.max(w+Ji.maxUnderzooming,this._source.minzoom),L={};for(const F of i){const V=this._addTile(F);c[F.key]=F,V.hasData()||v<this._source.maxzoom&&(L[F.key]=F)}this._retainLoadedChildren(L,v,k,c);for(const F of i){let V=this._tiles[F.key];if(V.hasData())continue;if(F.canonical.z>=this._source.maxzoom){const W=F.children(this._source.maxzoom)[0],K=this.getTile(W);if(K&&K.hasData()){c[W.key]=W;continue}}else{const W=F.children(this._source.maxzoom);if(c[W[0].key]&&c[W[1].key]&&c[W[2].key]&&c[W[3].key])continue}let q=V.wasRequested();for(let W=F.overscaledZ-1;W>=S;--W){const K=F.scaledTo(W);if(g[K.key]||(g[K.key]=!0,V=this.getTile(K),!V&&q&&(V=this._addTile(K)),V&&(c[K.key]=K,q=V.wasRequested(),V.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let g,v=this._tiles[i].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){g=this._loadedParentTiles[v.key];break}c.push(v.key);const w=v.scaledTo(v.overscaledZ-1);if(g=this._getLoadedTile(w),g)break;v=w}for(const w of c)this._loadedParentTiles[w]=g}}_addTile(i){let c=this._tiles[i.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const g=!!c;if(!g){const v=this.map?this.map.painter:null,w=this._source.tileSize*i.overscaleFactor();c=this._source.type==="raster-array"?new ei(i,w,this.transform.tileZoom,v,this._isRaster):new Ko(i,w,this.transform.tileZoom,v,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,i.key,c.state))}return c?(c.uses++,this._tiles[i.key]=c,g||this._source.fire(new o.x("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const g=c.getExpiryTimeout();g&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},g))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,c,g){const v=[],w=this.transform;if(!w)return v;const S=w.projection.name==="globe",k=o.am(w.center.lng);for(const L in this._tiles){const F=this._tiles[L];if(g&&F.clearQueryDebugViz(),F.holdingForFade())continue;let V;if(S){const q=F.tileID.canonical;if(q.z===0){const W=[Math.abs(o.ap(k,...Ao(q,-1))-k),Math.abs(o.ap(k,...Ao(q,1))-k)];V=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(o.ap(k,...Ao(q,-1))-k),Math.abs(o.ap(k,...Ao(q,0))-k),Math.abs(o.ap(k,...Ao(q,1))-k)];V=[W.indexOf(Math.min(...W))-1]}}else V=[0];for(const q of V){const W=i.containsTile(F,w,c,q);W&&v.push(W)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,c){const g=this.getRenderableIds(i,c).map(w=>this._tiles[w].tileID),v=this.transform.projection.name==="globe";for(const w of g)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=v?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return g}sortCoordinatesByDistance(i){const c=i.slice(),g=this.transform._camera.position,v=this.transform._camera.forward(),w={};for(const S of c){const k=1/(1<<S.canonical.z);w[S.key]=((S.canonical.x+.5)*k+S.wrap-g[0])*v[0]+((S.canonical.y+.5)*k-g[1])*v[1]-g[2]*v[2]}return c.sort((S,k)=>w[S.key]-w[k.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Qs(this._source.type))for(const i in this._tiles){const c=this._tiles[i];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(i,c,g){this._state.updateState(i=i||"_geojsonTileLayer",c,g)}removeFeatureState(i,c,g){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,g)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,g){const v=this._tiles[i];v&&v.setDependencies(c,g)}reloadTilesForDependencies(i,c){for(const g in this._tiles)this._tiles[g].hasDependency(i,c)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(i,c))}_preloadTiles(i,c){if(!this._sourceLoaded){const L=()=>{this._sourceLoaded&&(this._source.off("data",L),this._preloadTiles(i,c))};return void this._source.on("data",L)}const g=new Map,v=Array.isArray(i)?i:[i],w=this.map.painter.terrain,S=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const L of v){const F=L.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const V of F)g.set(V.key,V);this.usedForTerrain&&L.updateElevation(!1)}const k=Array.from(g.values());o.bf(k,(L,F)=>{const V=new Ko(L,this._source.tileSize*L.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(V,q=>{this._source.type==="raster-dem"&&V.dem&&this._backfillDEM(V),F(q,V)})},c)}}function Cs(m,i){const c=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*i.wrap)-+(i.wrap<0);return m.overscaledZ-i.overscaledZ||g-c||i.canonical.y-m.canonical.y||i.canonical.x-m.canonical.x}function Qs(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function Ao(m,i){const c=1<<m.z;return[m.x/c+i,(m.x+1)/c+i]}Ji.maxOverzooming=10,Ji.maxUnderzooming=3;class ea{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,c=!1;for(const g in this.style._mergedLayers){const v=this.style._mergedLayers[g];if(v.type==="fill-extrusion")this.layers.push({layer:v,visible:i,visibilityChanged:c});else if(v.type==="model"){const w=this.style.getLayerSource(v);w&&w.type==="batched-model"&&this.layers.push({layer:v,visible:i,visibilityChanged:c})}}}onNewFrame(i){this.layersGotHidden=!1;for(const c of this.layers){const g=c.layer;let v=!1;g.type==="fill-extrusion"?v=!g.isHidden(i)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="model"&&(v=!g.isHidden(i)&&g.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!v&&c.visible,c.visible=v}}updateZOffset(i,c){this.currentBuildingBuckets=[];for(const v of this.layers){const w=v.layer,S=this.style.getLayerSourceCache(w);let k=1;w.type==="fill-extrusion"&&(k=v.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let L=S?S.getTile(c):null;if(!L&&S&&c.canonical.z>S.getSource().minzoom){let F=c.scaledTo(Math.min(S.getSource().maxzoom,c.overscaledZ-1));for(;F.overscaledZ>=S.getSource().minzoom&&(L=S.getTile(F),!L&&F.overscaledZ!==0);)F=F.scaledTo(F.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(w):null,tileID:L?L.tileID:c,verticalScale:k})}i.hasAnyZOffset=!1;let g=!1;for(let v=0;v<i.symbolInstances.length;v++){const w=i.symbolInstances.get(v),S=w.zOffset,k=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=k!==Number.NEGATIVE_INFINITY?k:S,g||S===w.zOffset||(g=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}g&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,c,g,v){let w=c,S=g;if(i.canonical.z!==v.canonical.z){const k=v.canonical,L=1/(1<<i.canonical.z-k.z);w=(c+i.canonical.x*o.ab)*L-k.x*o.ab|0,S=(g+i.canonical.y*o.ab)*L-k.y*o.ab|0}return{tileX:w,tileY:S}}_getHeightAtTileOffset(i,c,g){let v,w;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:k,tileID:L,verticalScale:F}=this.currentBuildingBuckets[S];if(!k)continue;const{tileX:V,tileY:q}=this._mapCoordToOverlappingTile(i,c,g,L),W=k.getHeightAtTileCoord(V,q);W&&W.height!==void 0&&(W.hidden?v=W.height:w=Math.max(W.height*F,w||0))}if(w!==void 0)return w;for(let S=0;S<this.layers.length;++S){const k=this.layers[S];if(k.layer.type!=="model"||!k.visible)continue;const{bucket:L,tileID:F}=this.currentBuildingBuckets[S];if(!L)continue;const{tileX:V,tileY:q}=this._mapCoordToOverlappingTile(i,c,g,F),W=L.getHeightAtTileCoord(V,q);if(W&&!W.hidden)return W.height===void 0&&v!==void 0?Math.min(W.maxHeight,v)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Xo(m,i){const c={};for(const g in m)g!=="ref"&&(c[g]=m[g]);return o.bg.forEach(g=>{g in i&&(c[g]=i[g])}),c}function Oa(m){m=m.slice();const i=Object.create(null);for(let c=0;c<m.length;c++)i[m[c].id]=m[c];for(let c=0;c<m.length;c++)"ref"in m[c]&&(m[c]=Xo(m[c],i[m[c].ref]));return m}const it={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ht(m,i,c){c.push({command:it.addSource,args:[m,i[m]]})}function Zt(m,i,c){i.push({command:it.removeSource,args:[m]}),c[m]=!0}function vn(m,i,c,g){Zt(m,c,g),Ht(m,i,c)}function vr(m,i,c){let g;for(g in m[c])if(m[c].hasOwnProperty(g)&&g!=="data"&&!o.bh(m[c][g],i[c][g]))return!1;for(g in i[c])if(i[c].hasOwnProperty(g)&&g!=="data"&&!o.bh(m[c][g],i[c][g]))return!1;return!0}function pi(m,i,c,g,v,w){let S;for(S in i=i||{},m=m||{})m.hasOwnProperty(S)&&(o.bh(m[S],i[S])||c.push({command:w,args:[g,S,i[S],v]}));for(S in i)i.hasOwnProperty(S)&&!m.hasOwnProperty(S)&&(o.bh(m[S],i[S])||c.push({command:w,args:[g,S,i[S],v]}))}function Bi(m){return m.id}function ai(m,i){return m[i.id]=i,m}class _o{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.ap(i,0,1);let c=1,g=this._distances[c];const v=i*this.paddedLength+this.padding;for(;g<v&&c<this._distances.length;)g=this._distances[++c];const w=c-1,S=this._distances[w],k=g-S,L=k>0?(v-S)/k:0;return this.points[w].mult(1-L).add(this.points[c].mult(L))}}class Ri{constructor(i,c,g){const v=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/g),this.yCellCount=Math.ceil(c/g);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,g,v,w){this._forEachCell(c,g,v,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(w)}insertCircle(i,c,g,v){this._forEachCell(c-v,g-v,c+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(g),this.circles.push(v)}_insertBoxCell(i,c,g,v,w,S){this.boxCells[w].push(S)}_insertCircleCell(i,c,g,v,w,S){this.circleCells[w].push(S)}_query(i,c,g,v,w,S){if(g<0||i>this.width||v<0||c>this.height)return!w&&[];const k=[];if(i<=0&&c<=0&&this.width<=g&&this.height<=v){if(w)return!0;for(let L=0;L<this.boxKeys.length;L++)k.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const F=this.circles[3*L],V=this.circles[3*L+1],q=this.circles[3*L+2];k.push({key:this.circleKeys[L],x1:F-q,y1:V-q,x2:F+q,y2:V+q})}return S?k.filter(S):k}return this._forEachCell(i,c,g,v,this._queryCell,k,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?k.length>0:k}_queryCircle(i,c,g,v,w){const S=i-g,k=i+g,L=c-g,F=c+g;if(k<0||S>this.width||F<0||L>this.height)return!v&&[];const V=[];return this._forEachCell(S,L,k,F,this._queryCellCircle,V,{hitTest:v,circle:{x:i,y:c,radius:g},seenUids:{box:{},circle:{}}},w),v?V.length>0:V}query(i,c,g,v,w){return this._query(i,c,g,v,!1,w)}hitTest(i,c,g,v,w){return this._query(i,c,g,v,!0,w)}hitTestCircle(i,c,g,v){return this._queryCircle(i,c,g,!0,v)}_queryCell(i,c,g,v,w,S,k,L){const F=k.seenUids,V=this.boxCells[w];if(V!==null){const W=this.bboxes;for(const K of V)if(!F.box[K]){F.box[K]=!0;const ae=4*K;if(i<=W[ae+2]&&c<=W[ae+3]&&g>=W[ae+0]&&v>=W[ae+1]&&(!L||L(this.boxKeys[K]))){if(k.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[K],x1:W[ae],y1:W[ae+1],x2:W[ae+2],y2:W[ae+3]})}}}const q=this.circleCells[w];if(q!==null){const W=this.circles;for(const K of q)if(!F.circle[K]){F.circle[K]=!0;const ae=3*K;if(this._circleAndRectCollide(W[ae],W[ae+1],W[ae+2],i,c,g,v)&&(!L||L(this.circleKeys[K]))){if(k.hitTest)return S.push(!0),!0;{const le=W[ae],ue=W[ae+1],pe=W[ae+2];S.push({key:this.circleKeys[K],x1:le-pe,y1:ue-pe,x2:le+pe,y2:ue+pe})}}}}}_queryCellCircle(i,c,g,v,w,S,k,L){const F=k.circle,V=k.seenUids,q=this.boxCells[w];if(q!==null){const K=this.bboxes;for(const ae of q)if(!V.box[ae]){V.box[ae]=!0;const le=4*ae;if(this._circleAndRectCollide(F.x,F.y,F.radius,K[le+0],K[le+1],K[le+2],K[le+3])&&(!L||L(this.boxKeys[ae])))return S.push(!0),!0}}const W=this.circleCells[w];if(W!==null){const K=this.circles;for(const ae of W)if(!V.circle[ae]){V.circle[ae]=!0;const le=3*ae;if(this._circlesCollide(K[le],K[le+1],K[le+2],F.x,F.y,F.radius)&&(!L||L(this.circleKeys[ae])))return S.push(!0),!0}}}_forEachCell(i,c,g,v,w,S,k,L){const F=this._convertToXCellCoord(i),V=this._convertToYCellCoord(c),q=this._convertToXCellCoord(g),W=this._convertToYCellCoord(v);for(let K=F;K<=q;K++)for(let ae=V;ae<=W;ae++)if(w.call(this,i,c,g,v,this.xCellCount*ae+K,S,k,L))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,g,v,w,S){const k=v-i,L=w-c,F=g+S;return F*F>k*k+L*L}_circleAndRectCollide(i,c,g,v,w,S,k){const L=(S-v)/2,F=Math.abs(i-(v+L));if(F>L+g)return!1;const V=(k-w)/2,q=Math.abs(c-(w+V));if(q>V+g)return!1;if(F<=L||q<=V)return!0;const W=F-L,K=q-V;return W*W+K*K<=g*g}}const Yo={unknown:0,flipRequired:1,flipNotRequired:2},cr=Math.tan(85*Math.PI/180);function cn(m,i,c,g,v,w,S){const k=o.a6.mat4.create();if(c)if(w.name==="globe"){const L=o.bi(v,i);o.a6.mat4.multiply(k,k,L)}else{const L=o.a6.mat2.invert([],S);k[0]=L[0],k[1]=L[1],k[4]=L[2],k[5]=L[3],g||o.a6.mat4.rotateZ(k,k,v.angle)}else o.a6.mat4.multiply(k,v.labelPlaneMatrix,m);return k}function fn(m,i,c,g,v,w,S){const k=cn(m,i,c,g,v,w,S);return w.name==="globe"&&c||(k[2]=k[6]=k[10]=k[14]=0),k}function oo(m,i,c,g,v,w,S){if(c){if(w.name==="globe"){const k=cn(m,i,c,g,v,w,S);return o.a6.mat4.invert(k,k),o.a6.mat4.multiply(k,m,k),k}{const k=o.a6.mat4.clone(m),L=o.a6.mat4.identity([]);return L[0]=S[0],L[1]=S[1],L[4]=S[2],L[5]=S[3],o.a6.mat4.multiply(k,k,L),g||o.a6.mat4.rotateZ(k,k,-v.angle),k}}return v.glCoordMatrix}function $i(m,i,c,g){const v=[m,i,c,1];c?o.a6.vec4.transformMat4(v,v,g):An(v,v,g);const w=v[3];return v[0]/=w,v[1]/=w,v[2]/=w,v}function on(m,i){return Math.min(.5+m/i*.5,1.5)}function Bs(m,i){const c=m[0]/m[3],g=m[1]/m[3];return c>=-i[0]&&c<=i[0]&&g>=-i[1]&&g<=i[1]}function ss(m,i,c,g,v,w,S,k,L,F){const V=c.transform,q=g?m.textSizeData:m.iconSizeData,W=o.bj(q,c.transform.zoom),K=V.projection.name==="globe",ae=[256/c.width*2+1,256/c.height*2+1],le=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;le.clear();let ue=null;K&&(ue=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const pe=m.lineVertexArray,Re=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,Oe=c.transform.width/c.transform.height;let Ae,Be=!1;for(let Le=0;Le<Re.length;Le++){const He=Re.get(Le),{numGlyphs:je,writingMode:Ze}=He;if(Ze!==o.bk.vertical||Be||Ae===o.bk.horizontal||(Be=!0),Ae=Ze,(He.hidden||Ze===o.bk.vertical)&&!Be){Dn(je,le);continue}Be=!1;const rt=new o.P(He.tileAnchorX,He.tileAnchorY);let{x:Je,y:Ye,z:ht}=V.projection.projectTilePoint(rt.x,rt.y,F.canonical);if(L){const[Nt,Ut,Nr]=L(rt);Je+=Nt,Ye+=Ut,ht+=Nr}const Ct=[Je,Ye,ht,1];if(o.a6.vec4.transformMat4(Ct,Ct,i),!Bs(Ct,ae)){Dn(je,le);continue}const Ft=Ct[3],At=on(c.transform.getCameraToCenterDistance(V.projection),Ft),Yt=o.bl(q,W,He),dt=S?Yt/At:Yt*At,Lt=$i(Je,Ye,ht,v);if(Lt[3]<=0){Dn(je,le);continue}let kt={};const Qt=S?null:L,tr=Xe(He,dt,!1,k,i,v,w,m.glyphOffsetArray,pe,le,ue,Lt,rt,kt,Oe,Qt,V.projection,F,S);Be=tr.useVertical,Qt&&tr.needsFlipping&&(kt={}),(tr.notEnoughRoom||Be||tr.needsFlipping&&Xe(He,dt,!0,k,i,v,w,m.glyphOffsetArray,pe,le,ue,Lt,rt,kt,Oe,Qt,V.projection,F,S).notEnoughRoom)&&Dn(je,le)}g?(m.text.dynamicLayoutVertexBuffer.updateData(le),ue&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ue)):(m.icon.dynamicLayoutVertexBuffer.updateData(le),ue&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ue))}function mi(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le){const{lineStartIndex:ue,glyphStartIndex:pe,segment:Re}=k,Oe=pe+k.numGlyphs,Ae=ue+k.lineLength,Be=i.getoffsetX(pe),Le=i.getoffsetX(Oe-1),He=$r(m*Be,c,g,v,w,S,Re,ue,Ae,L,F,V,q,W,!0,K,ae,le);if(!He)return null;const je=$r(m*Le,c,g,v,w,S,Re,ue,Ae,L,F,V,q,W,!0,K,ae,le);return je?{first:He,last:je}:null}function Co(m,i,c,g){return m===o.bk.horizontal&&Math.abs(g)>Math.abs(c)?{useVertical:!0}:m===o.bk.vertical?g>0?{needsFlipping:!0}:null:i!==Yo.unknown&&function(v,w){return v===0||Math.abs(w/v)>cr}(c,g)?i===Yo.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Xe(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue,pe,Re){const Oe=i/24,Ae=m.lineOffsetX*Oe,Be=m.lineOffsetY*Oe,{lineStartIndex:Le,glyphStartIndex:He,numGlyphs:je,segment:Ze,writingMode:rt,flipState:Je}=m,Ye=Le+m.lineLength,ht=Ct=>{if(V){const[dt,Lt,kt]=Ct.up,Qt=F.length;o.bm(V,Qt+0,dt,Lt,kt),o.bm(V,Qt+1,dt,Lt,kt),o.bm(V,Qt+2,dt,Lt,kt),o.bm(V,Qt+3,dt,Lt,kt)}const[Ft,At,Yt]=Ct.point;o.bn(F,Ft,At,Yt,Ct.angle)};if(je>1){const Ct=mi(Oe,k,Ae,Be,c,q,W,m,L,w,K,le,!1,ue,pe,Re);if(!Ct)return{notEnoughRoom:!0};if(g&&!c){let[Ft,At,Yt]=Ct.first.point,[dt,Lt,kt]=Ct.last.point;[Ft,At]=$i(Ft,At,Yt,S),[dt,Lt]=$i(dt,Lt,kt,S);const Qt=Co(rt,Je,(dt-Ft)*ae,Lt-At);if(m.flipState=Qt&&Qt.needsFlipping?Yo.flipRequired:Yo.flipNotRequired,Qt)return Qt}ht(Ct.first);for(let Ft=He+1;Ft<He+je-1;Ft++){const At=$r(Oe*k.getoffsetX(Ft),Ae,Be,c,q,W,Ze,Le,Ye,L,w,K,le,!1,!1,ue,pe,Re);if(!At)return F.length-=4*(Ft-He),{notEnoughRoom:!0};ht(At)}ht(Ct.last)}else{if(g&&!c){const Ft=$i(W.x,W.y,0,v),At=Le+Ze+1,Yt=new o.P(L.getx(At),L.gety(At)),dt=$i(Yt.x,Yt.y,0,v),Lt=dt[3]>0?dt:gr(W,Yt,Ft,1,v,void 0,ue,pe.canonical),kt=Co(rt,Je,(Lt[0]-Ft[0])*ae,Lt[1]-Ft[1]);if(m.flipState=kt&&kt.needsFlipping?Yo.flipRequired:Yo.flipNotRequired,kt)return kt}const Ct=$r(Oe*k.getoffsetX(He),Ae,Be,c,q,W,Ze,Le,Ye,L,w,K,le,!1,!1,ue,pe,Re);if(!Ct)return{notEnoughRoom:!0};ht(Ct)}return{}}function Rt(m,i,c,g,v){const{x:w,y:S,z:k}=g.projectTilePoint(m.x,m.y,i);if(!v)return $i(w,S,k,c);const[L,F,V]=v(m);return $i(w+L,S+F,k+V,c)}function gr(m,i,c,g,v,w,S,k){const L=Rt(m.sub(i)._unit()._add(m),k,v,S,w);return o.a6.vec3.sub(L,c,L),o.a6.vec3.normalize(L,L),o.a6.vec3.scaleAndAdd(L,c,L,g)}function $r(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue,pe){const Re=g?m-i:m+i;let Oe=Re>0?1:-1,Ae=0;g&&(Oe*=-1,Ae=Math.PI),Oe<0&&(Ae+=Math.PI);let Be=k+S+(Oe>0?0:1)|0,Le=v,He=v,je=0,Ze=0;const rt=Math.abs(Re),Je=[],Ye=[];let ht=w,Ct=ht;const Ft=()=>gr(Ct,ht,He,rt-je+1,V,W,le,ue.canonical);for(;je+Ze<=rt;){if(Be+=Oe,Be<k||Be>=L)return null;if(He=Le,Ct=ht,Je.push(He),K&&Ye.push(Ct),ht=new o.P(F.getx(Be),F.gety(Be)),Le=q[Be],!Le){const Ut=Rt(ht,ue.canonical,V,le,W);Le=Ut[3]>0?q[Be]=Ut:Ft()}je+=Ze,Ze=o.a6.vec3.distance(He,Le)}ae&&W&&(q[Be]&&(Le=Ft(),Ze=o.a6.vec3.distance(He,Le)),q[Be]=Le);const At=(rt-je)/Ze,Yt=ht.sub(Ct)._mult(At)._add(Ct),dt=o.a6.vec3.sub([],Le,He),Lt=o.a6.vec3.scaleAndAdd([],He,dt,At);let kt=[0,0,1],Qt=dt[0],tr=dt[1];if(pe&&(kt=le.upVector(ue.canonical,Yt.x,Yt.y),kt[0]!==0||kt[1]!==0||kt[2]!==1)){const Ut=[kt[2],0,-kt[0]],Nr=o.a6.vec3.cross([],kt,Ut);o.a6.vec3.normalize(Ut,Ut),o.a6.vec3.normalize(Nr,Nr),Qt=o.a6.vec3.dot(dt,Ut),tr=o.a6.vec3.dot(dt,Nr)}if(c){const Ut=o.a6.vec3.cross([],kt,dt);o.a6.vec3.normalize(Ut,Ut),o.a6.vec3.scaleAndAdd(Lt,Lt,Ut,c*Oe)}const Nt=Ae+Math.atan2(tr,Qt);return Je.push(Lt),K&&Ye.push(Yt),{point:Lt,angle:Nt,path:Je,tilePath:Ye,up:kt}}function Dn(m,i){const c=i.length,g=c+4*m;i.resize(g),i.float32.fill(-1/0,4*c,4*g)}function An(m,i,c){const g=i[0],v=i[1];return m[0]=c[0]*g+c[4]*v+c[12],m[1]=c[1]*g+c[5]*v+c[13],m[3]=c[3]*g+c[7]*v+c[15],m}const Pn=100;class ti{constructor(i,c,g=new Ri(i.width+200,i.height+200,25),v=new Ri(i.width+200,i.height+200,25)){this.transform=i,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Pn,this.screenBottomBoundary=i.height+Pn,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,g,v,w,S,k,L){let F=g.projectedAnchorX,V=g.projectedAnchorY,q=g.projectedAnchorZ;const W=g.elevation,K=g.tileID,ae=i.getProjection();if(W&&K){const[Le,He,je]=ae.upVector(K.canonical,g.tileAnchorX,g.tileAnchorY),Ze=ae.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=Le*W*Ze,V+=He*W*Ze,q+=je*W*Ze}const le=this.projectAndGetPerspectiveRatio(k,F,V,q,g.tileID,ae.name==="globe"||!!W||this.transform.pitch>0,ae),ue=S*le.perspectiveRatio,pe=(g.x1*c+v.x-g.padding)*ue+le.point.x,Re=(g.y1*c+v.y-g.padding)*ue+le.point.y,Oe=(g.x2*c+v.x+g.padding)*ue+le.point.x,Ae=(g.y2*c+v.y+g.padding)*ue+le.point.y,Be=le.perspectiveRatio<=.55||le.occluded;return!this.isInsideGrid(pe,Re,Oe,Ae)||!w&&this.grid.hitTest(pe,Re,Oe,Ae,L)||Be?{box:[],offscreen:!1,occluded:le.occluded}:{box:[pe,Re,Oe,Ae],offscreen:this.isOffscreen(pe,Re,Oe,Ae),occluded:!1}}placeCollisionCircles(i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le){const ue=[],pe=this.transform.elevation,Re=i.getProjection(),Oe=pe?pe.getAtTileOffsetFunc(le,this.transform.center.lat,this.transform.worldSize,Re):null,Ae=new o.P(g.tileAnchorX,g.tileAnchorY);let{x:Be,y:Le,z:He}=Re.projectTilePoint(Ae.x,Ae.y,le.canonical);if(Oe){const[Yt,dt,Lt]=Oe(Ae);Be+=Yt,Le+=dt,He+=Lt}const je=Re.name==="globe",Ze=this.projectAndGetPerspectiveRatio(k,Be,Le,He,le,je||!!pe||this.transform.pitch>0,Re),{perspectiveRatio:rt}=Ze,Je=(q?S/rt:S*rt)/o.bq,Ye=$i(Be,Le,He,L),ht=Ze.signedDistanceFromCamera>0?mi(Je,w,g.lineOffsetX*Je,g.lineOffsetY*Je,!1,Ye,Ae,g,v,L,{},pe&&!q?Oe:null,q&&!!pe,Re,le,q):null;let Ct=!1,Ft=!1,At=!0;if(ht&&!Ze.occluded){const Yt=.5*K*rt+ae,dt=new o.P(-100,-100),Lt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),kt=new _o,{first:Qt,last:tr}=ht,Nt=Qt.path.length;let Ut=[];for(let Sr=Nt-1;Sr>=1;Sr--)Ut.push(Qt.path[Sr]);for(let Sr=1;Sr<tr.path.length;Sr++)Ut.push(tr.path[Sr]);const Nr=2.5*Yt;F&&(Ut=Ut.map(([Sr,Jr,Pr],Hr)=>(Oe&&!je&&(Pr=Oe(Hr<Nt-1?Qt.tilePath[Nt-1-Hr]:tr.tilePath[Hr-Nt+2])[2]),$i(Sr,Jr,Pr,F))),Ut.some(Sr=>Sr[3]<=0)&&(Ut=[]));let hr=[];if(Ut.length>0){let Sr=1/0,Jr=-1/0,Pr=1/0,Hr=-1/0;for(const _n of Ut)Sr=Math.min(Sr,_n[0]),Pr=Math.min(Pr,_n[1]),Jr=Math.max(Jr,_n[0]),Hr=Math.max(Hr,_n[1]);Jr>=dt.x&&Sr<=Lt.x&&Hr>=dt.y&&Pr<=Lt.y&&(hr=[Ut.map(_n=>new o.P(_n[0],_n[1]))],(Sr<dt.x||Jr>Lt.x||Pr<dt.y||Hr>Lt.y)&&(hr=o.bo(hr,dt.x,dt.y,Lt.x,Lt.y)))}for(const Sr of hr){kt.reset(Sr,.25*Yt);let Jr=0;Jr=kt.length<=.5*Yt?1:Math.ceil(kt.paddedLength/Nr)+1;for(let Pr=0;Pr<Jr;Pr++){const Hr=Pr/Math.max(Jr-1,1),_n=kt.lerp(Hr),pn=_n.x+Pn,fi=_n.y+Pn;ue.push(pn,fi,Yt,0);const Ti=pn-Yt,Hi=fi-Yt,fl=pn+Yt,Fo=fi+Yt;if(At=At&&this.isOffscreen(Ti,Hi,fl,Fo),Ft=Ft||this.isInsideGrid(Ti,Hi,fl,Fo),!c&&this.grid.hitTestCircle(pn,fi,Yt,W)&&(Ct=!0,!V))return{circles:[],offscreen:!1,collisionDetected:Ct,occluded:!1}}}}return{circles:!V&&Ct||!Ft?[]:ue,offscreen:At,collisionDetected:Ct,occluded:Ze.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let g=1/0,v=1/0,w=-1/0,S=-1/0;for(const V of i){const q=new o.P(V.x+Pn,V.y+Pn);g=Math.min(g,q.x),v=Math.min(v,q.y),w=Math.max(w,q.x),S=Math.max(S,q.y),c.push(q)}const k=this.grid.query(g,v,w,S).concat(this.ignoredGrid.query(g,v,w,S)),L={},F={};for(const V of k){const q=V.key;if(L[q.bucketInstanceId]===void 0&&(L[q.bucketInstanceId]={}),L[q.bucketInstanceId][q.featureIndex])continue;const W=[new o.P(V.x1,V.y1),new o.P(V.x2,V.y1),new o.P(V.x2,V.y2),new o.P(V.x1,V.y2)];o.bp(c,W)&&(L[q.bucketInstanceId][q.featureIndex]=!0,F[q.bucketInstanceId]===void 0&&(F[q.bucketInstanceId]=[]),F[q.bucketInstanceId].push(q.featureIndex))}return F}insertCollisionBox(i,c,g,v,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,g,v,w){const S=c?this.ignoredGrid:this.grid,k={bucketInstanceId:g,featureIndex:v,collisionGroupID:w};for(let L=0;L<i.length;L+=4)S.insertCircle(k,i[L],i[L+1],i[L+2])}projectAndGetPerspectiveRatio(i,c,g,v,w,S,k){const L=[c,g,v,1];let F=!1;v||this.transform.pitch>0?(o.a6.vec4.transformMat4(L,L,i),this.fogState&&w&&k.name!=="globe"&&(F=function(W,K,ae,le,ue,pe){const Re=pe.calculateFogTileMatrix(ue),Oe=[K,ae,le];return o.a6.vec3.transformMat4(Oe,Oe,Re),ir(W,o.a6.vec3.length(Oe),pe.pitch,pe._fov)}(this.fogState,c,g,v,w.toUnwrapped(),this.transform)>.9)):An(L,L,i);const V=L[3];return{point:new o.P((L[0]/V+1)/2*this.transform.width+Pn,(-L[1]/V+1)/2*this.transform.height+Pn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/V*.5,1.5),signedDistanceFromCamera:V,occluded:S&&L[2]>V||F}}isOffscreen(i,c,g,v){return g<Pn||i>=this.screenRightBoundary||v<Pn||c>this.screenBottomBoundary}isInsideGrid(i,c,g,v){return g>=0&&i<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=o.a6.mat4.identity([]);return o.a6.mat4.translate(i,i,[-100,-100,0]),i}}function hi(m,i,c){const g=i.createTileMatrix(m,m.worldSize,c.toUnwrapped());return o.a6.mat4.multiply(new Float32Array(16),m.projMatrix,g)}function xi(m,i,c){if(i.projection.name===c.projection.name)return m.projMatrix;const g=c.clone();return g.setProjection(i.projection),hi(g,i.getProjection(),m)}function fo(m,i,c){return i.name===c.projection.name?m.projMatrix:hi(c,i,m)}class qn{constructor(i,c,g,v){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class ni{constructor(i,c,g,v,w,S=!1){this.text=new qn(i?i.text:null,c,g,w),this.icon=new qn(i?i.icon:null,c,v,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class so{constructor(i,c,g,v=!1){this.text=i,this.icon=c,this.skipFade=g,this.clipped=v}}class ii{constructor(){this.invProjMatrix=o.a6.mat4.create(),this.viewportMatrix=o.a6.mat4.create(),this.circles=[]}}class zs{constructor(i,c,g,v,w){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=w}}class yo{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[i]}}function Ro(m,i,c,g,v){const{horizontalAlign:w,verticalAlign:S}=o.bx(m),k=-(w-.5)*i,L=-(S-.5)*c,F=o.bw(m,g);return new o.P(k+F[0]*v,L+F[1]*v)}function ha(m,i,c,g,v){const w=new o.P(m,i);return c&&w._rotate(g?v:-v),w}class Ns{constructor(i,c,g,v,w,S){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new ti(this.transform,w),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new yo(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,g,v){const w=g.getBucket(c),S=g.latestFeatureIndex;if(!w||!S||c.fqid!==w.layerIds[0])return;const k=w.layers[0].layout,L=w.layers[0].paint,F=g.collisionBoxArray,V=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),q=g.tileSize/o.ab,W=g.tileID.toUnwrapped();this.transform.setProjection(w.projection);const K=(ae=g.tileID,le=w.getProjection(),ue=this.transform,le.name===this.projection?ue.calculateProjMatrix(ae.toUnwrapped()):hi(ue,le,ae));var ae,le,ue;const pe=k.get("text-pitch-alignment")==="map",Re=k.get("text-rotation-alignment")==="map";c.compileFilter();const Oe=c.dynamicFilter(),Ae=c.dynamicFilterNeedsFeature(),Be=this.transform.calculatePixelsToTileUnitsMatrix(g),Le=fn(K,g.tileID.canonical,pe,Re,this.transform,w.getProjection(),Be);let He=null;if(pe){const rt=oo(K,g.tileID.canonical,pe,Re,this.transform,w.getProjection(),Be);He=o.a6.mat4.multiply([],this.transform.labelPlaneMatrix,rt)}let je=null;Oe&&g.latestFeatureIndex&&(je={unwrappedTileID:W,dynamicFilter:Oe,dynamicFilterNeedsFeature:Ae}),this.retainedQueryData[w.bucketInstanceId]=new zs(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,g.tileID);const Ze={bucket:w,layout:k,paint:L,posMatrix:K,textLabelPlaneMatrix:Le,labelToScreenMatrix:He,clippingData:je,scale:V,textPixelRatio:q,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.bj(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.bj(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(v)for(const rt of w.sortKeyRanges){const{sortKey:Je,symbolInstanceStart:Ye,symbolInstanceEnd:ht}=rt;i.push({sortKey:Je,symbolInstanceStart:Ye,symbolInstanceEnd:ht,parameters:Ze})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue,pe,Re){const{textOffset0:Oe,textOffset1:Ae,crossTileID:Be}=W,Le=[Oe,Ae],He=Ro(i,g,v,Le,w),je=this.collisionIndex.placeCollisionBox(ae,w,c,ha(He.x,He.y,S,k,this.transform.angle),q,L,F,V.predicate);if(ue){const Ze=ae.getSymbolInstanceIconSize(Re,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ae,Ze,ue,ha(He.x,He.y,S,k,this.transform.angle),q,L,F,V.predicate).box.length===0)return}if(je.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[Be]&&this.prevPlacement.placements[Be]&&this.prevPlacement.placements[Be].text&&(Ze=this.prevPlacement.variableOffsets[Be].anchor),this.variableOffsets[Be]={textOffset:Le,width:g,height:v,anchor:i,textScale:w,prevAnchor:Ze},this.markUsedJustification(ae,i,W,le),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,le,W),this.placedOrientations[Be]=le),{shift:He,placedGlyphBoxes:je}}}placeLayerBucketPart(i,c,g,v){const{bucket:w,layout:S,paint:k,posMatrix:L,textLabelPlaneMatrix:F,labelToScreenMatrix:V,clippingData:q,textPixelRatio:W,holdingForFade:K,collisionBoxArray:ae,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:ue,collisionGroup:pe,latestFeatureIndex:Re}=i.parameters,Oe=S.get("text-optional"),Ae=S.get("icon-optional"),Be=S.get("text-allow-overlap"),Le=S.get("icon-allow-overlap"),He=S.get("text-rotation-alignment")==="map",je=S.get("text-pitch-alignment")==="map",Ze=S.get("symbol-z-elevate"),rt=k.get("symbol-z-offset"),Je=k.get("symbol-elevation-reference")==="sea";this.transform.setProjection(w.projection);let Ye=Be&&(Le||!w.hasIconData()||Ae),ht=Le&&(Be||!w.hasTextData()||Oe);const Ct=!rt.isConstant();!w.collisionArrays&&ae&&w.deserializeCollisionBoxes(ae),g&&v&&w.updateCollisionDebugBuffers(this.transform.zoom,ae);const Ft=(At,Yt,dt)=>{const{crossTileID:Lt,numVerticalGlyphVertices:kt}=At;let Qt=null;if(q&&q.dynamicFilterNeedsFeature||Ct){const mn=this.retainedQueryData[w.bucketInstanceId];Qt=Re.loadFeature({featureIndex:At.featureIndex,bucketIndex:mn.bucketIndex,sourceLayerIndex:mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(q&&!(0,q.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Qt,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new o.P(At.tileAnchorX,At.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[Lt]=new so(!1,!1,!1,!0),void c.add(Lt);const tr=rt.evaluate(Qt,{});if(c.has(Lt))return;if(K)return void(this.placements[Lt]=new so(!1,!1,!1));let Nt=!1,Ut=!1,Nr=!0,hr=!1,Sr=!1,Jr=null,Pr={box:null,offscreen:null,occluded:null},Hr={box:null,offscreen:null,occluded:null},_n=null,pn=null,fi=null,Ti=0,Hi=0,fl=0;dt.textFeatureIndex?Ti=dt.textFeatureIndex:At.useRuntimeCollisionCircles&&(Ti=At.featureIndex),dt.verticalTextFeatureIndex&&(Hi=dt.verticalTextFeatureIndex);const Fo=mn=>{mn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Zn=this.transform.elevation;mn.elevation=Je?tr:tr+(Zn?Zn.getAtTileOffset(mn.tileID,mn.tileAnchorX,mn.tileAnchorY):0),mn.elevation+=At.zOffset},Cn=dt.textBox;if(Cn){Fo(Cn);const mn=ci=>{let Eo=o.bk.horizontal;if(w.allowVerticalPlacement&&!ci&&this.prevPlacement){const Vo=this.prevPlacement.placedOrientations[Lt];Vo&&(this.placedOrientations[Lt]=Vo,Eo=Vo,this.markUsedOrientation(w,Eo,At))}return Eo},Zn=(ci,Eo)=>{if(w.allowVerticalPlacement&&kt>0&&dt.verticalTextBox){for(const Vo of w.writingModes)if(Vo===o.bk.vertical?(Pr=Eo(),Hr=Pr):Pr=ci(),Pr&&Pr.box&&Pr.box.length)break}else Pr=ci()};if(S.get("text-variable-anchor")){let ci=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Lt]){const Nn=this.prevPlacement.variableOffsets[Lt];ci.indexOf(Nn.anchor)>0&&(ci=ci.filter(cs=>cs!==Nn.anchor),ci.unshift(Nn.anchor))}const Eo=(Nn,cs,ys)=>{const us=w.getSymbolInstanceTextSize(le,At,this.transform.zoom,Yt),Ni=(Nn.x2-Nn.x1)*us+2*Nn.padding,wa=(Nn.y2-Nn.y1)*us+2*Nn.padding,Ta=At.hasIconTextFit&&!Le?cs:null;Ta&&Fo(Ta);let pl={box:[],offscreen:!1,occluded:!1};const nl=Be?2*ci.length:ci.length;for(let za=0;za<nl;++za){const ml=this.attemptAnchorPlacement(ci[za%ci.length],Nn,Ni,wa,us,He,je,W,L,pe,za>=ci.length,At,Yt,w,ys,Ta,le,ue);if(ml&&(pl=ml.placedGlyphBoxes,pl&&pl.box&&pl.box.length)){Nt=!0,Jr=ml.shift;break}}return pl};Zn(()=>Eo(Cn,dt.iconBox,o.bk.horizontal),()=>{const Nn=dt.verticalTextBox;return Nn&&Fo(Nn),w.allowVerticalPlacement&&!(Pr&&Pr.box&&Pr.box.length)&&kt>0&&Nn?Eo(Nn,dt.verticalIconBox,o.bk.vertical):{box:null,offscreen:null,occluded:null}}),Pr&&(Nt=Pr.box,Nr=Pr.offscreen,hr=Pr.occluded);const Vo=mn(!(!Pr||!Pr.box));if(!Nt&&this.prevPlacement){const Nn=this.prevPlacement.variableOffsets[Lt];Nn&&(this.variableOffsets[Lt]=Nn,this.markUsedJustification(w,Nn.anchor,At,Vo))}}else{const ci=(Eo,Vo)=>{const Nn=w.getSymbolInstanceTextSize(le,At,this.transform.zoom,Yt),cs=this.collisionIndex.placeCollisionBox(w,Nn,Eo,new o.P(0,0),Be,W,L,pe.predicate);return cs&&cs.box&&cs.box.length&&(this.markUsedOrientation(w,Vo,At),this.placedOrientations[Lt]=Vo),cs};Zn(()=>ci(Cn,o.bk.horizontal),()=>{const Eo=dt.verticalTextBox;return w.allowVerticalPlacement&&kt>0&&Eo?(Fo(Eo),ci(Eo,o.bk.vertical)):{box:null,offscreen:null,occluded:null}}),mn(!!(Pr&&Pr.box&&Pr.box.length))}}if(_n=Pr,Nt=_n&&_n.box&&_n.box.length>0,Nr=_n&&_n.offscreen,hr=_n&&_n.occluded,At.useRuntimeCollisionCircles){const mn=w.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex>=0?At.centerJustifiedTextSymbolIndex:At.verticalPlacedTextSymbolIndex),Zn=o.bl(w.textSizeData,le,mn),ci=S.get("text-padding");pn=this.collisionIndex.placeCollisionCircles(w,Be,mn,w.lineVertexArray,w.glyphOffsetArray,Zn,L,F,V,g,je,pe.predicate,At.collisionCircleDiameter*Zn/o.bq,ci,this.retainedQueryData[w.bucketInstanceId].tileID),Nt=Be||pn.circles.length>0&&!pn.collisionDetected,Nr=Nr&&pn.offscreen,hr=pn.occluded}if(dt.iconFeatureIndex&&(fl=dt.iconFeatureIndex),dt.iconBox){const mn=Zn=>{Fo(Zn);const ci=At.hasIconTextFit&&Jr?ha(Jr.x,Jr.y,He,je,this.transform.angle):new o.P(0,0),Eo=w.getSymbolInstanceIconSize(ue,this.transform.zoom,At.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Eo,Zn,ci,Le,W,L,pe.predicate)};Hr&&Hr.box&&Hr.box.length&&dt.verticalIconBox?(fi=mn(dt.verticalIconBox),Ut=fi.box.length>0):(fi=mn(dt.iconBox),Ut=fi.box.length>0),Nr=Nr&&fi.offscreen,Sr=fi.occluded}const bi=Oe||At.numHorizontalGlyphVertices===0&&kt===0,lo=Ae||At.numIconVertices===0;if(bi||lo?lo?bi||(Ut=Ut&&Nt):Nt=Ut&&Nt:Ut=Nt=Ut&&Nt,Nt&&_n&&_n.box&&this.collisionIndex.insertCollisionBox(_n.box,S.get("text-ignore-placement"),w.bucketInstanceId,Hr&&Hr.box&&Hi?Hi:Ti,pe.ID),Ut&&fi&&this.collisionIndex.insertCollisionBox(fi.box,S.get("icon-ignore-placement"),w.bucketInstanceId,fl,pe.ID),pn&&(Nt&&this.collisionIndex.insertCollisionCircles(pn.circles,S.get("text-ignore-placement"),w.bucketInstanceId,Ti,pe.ID),g)){const mn=w.bucketInstanceId;let Zn=this.collisionCircleArrays[mn];Zn===void 0&&(Zn=this.collisionCircleArrays[mn]=new ii);for(let ci=0;ci<pn.circles.length;ci+=4)Zn.circles.push(pn.circles[ci+0]),Zn.circles.push(pn.circles[ci+1]),Zn.circles.push(pn.circles[ci+2]),Zn.circles.push(pn.collisionDetected?1:0)}const vi=w.projection.name!=="globe";Ye=Ye&&(vi||!hr),ht=ht&&(vi||!Sr),this.placements[Lt]=new so(Nt||Ye,Ut||ht,Nr||w.justReloaded),c.add(Lt)};if(Ze&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),w.sortFeaturesByY){const At=w.getSortedSymbolIndexes(this.transform.angle);for(let Yt=At.length-1;Yt>=0;--Yt){const dt=At[Yt];Ft(w.symbolInstances.get(dt),dt,w.collisionArrays[dt])}w.hasAnyZOffset&&o.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const At=w.getSortedIndexesByZOffset();for(let Yt=0;Yt<At.length;++Yt){const dt=At[Yt];Ft(w.symbolInstances.get(dt),dt,w.collisionArrays[dt])}}else for(let At=i.symbolInstanceStart;At<i.symbolInstanceEnd;At++)Ft(w.symbolInstances.get(At),At,w.collisionArrays[At]);if(g&&w.bucketInstanceId in this.collisionCircleArrays){const At=this.collisionCircleArrays[w.bucketInstanceId];o.a6.mat4.invert(At.invProjMatrix,L),At.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,c,g,v){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L,crossTileID:F}=g,V=o.bv(c),q=v===o.bk.vertical?L:V==="left"?w:V==="center"?S:V==="right"?k:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=q>=0&&w!==q?0:F),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=q>=0&&S!==q?0:F),k>=0&&(i.text.placedSymbolArray.get(k).crossTileID=q>=0&&k!==q?0:F),L>=0&&(i.text.placedSymbolArray.get(L).crossTileID=q>=0&&L!==q?0:F)}markUsedOrientation(i,c,g){const v=c===o.bk.horizontal||c===o.bk.horizontalOnly?c:0,w=c===o.bk.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:F}=g,V=i.text.placedSymbolArray;S>=0&&(V.get(S).placedOrientation=v),k>=0&&(V.get(k).placedOrientation=v),L>=0&&(V.get(L).placedOrientation=v),F>=0&&(V.get(F).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const v=c?c.symbolFadeChange(i):1,w=c?c.opacities:{},S=c?c.variableOffsets:{},k=c?c.placedOrientations:{};for(const L in this.placements){const F=this.placements[L],V=w[L];V?(this.opacities[L]=new ni(V,v,F.text,F.icon,null,F.clipped),g=g||F.text!==V.text.placed||F.icon!==V.icon.placed):(this.opacities[L]=new ni(null,v,F.text,F.icon,F.skipFade,F.clipped),g=g||F.text||F.icon)}for(const L in w){const F=w[L];if(!this.opacities[L]){const V=new ni(F,v,!1,!1);V.isHidden()||(this.opacities[L]=V,g=g||F.text.placed||F.icon.placed)}}for(const L in S)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=S[L]);for(const L in k)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=k[L]);g?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c,g,v){const w=new Set;for(const S of c){const k=S.getBucket(i);k&&S.latestFeatureIndex&&i.fqid===k.layerIds[0]&&(this.updateBucketOpacities(k,w,S,S.collisionBoxArray,g,v,S.tileID,i.scope),k.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(k,S.tileID),k.updateZOffset()))}}updateBucketOpacities(i,c,g,v,w,S,k,L){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const F=i.layers[0].layout,V=i.layers[0].paint,q=!!i.layers[0].dynamicFilter(),W=new ni(null,0,!1,!1,!0),K=F.get("text-allow-overlap"),ae=F.get("icon-allow-overlap"),le=F.get("text-variable-anchor"),ue=F.get("text-rotation-alignment")==="map",pe=F.get("text-pitch-alignment")==="map",Re=V.get("symbol-z-offset"),Oe=V.get("symbol-elevation-reference")==="sea",Ae=!Re.isConstant(),Be=new ni(null,0,K&&(ae||!i.hasIconData()||F.get("icon-optional")),ae&&(K||!i.hasTextData()||F.get("text-optional")),!0);!i.collisionArrays&&v&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(v);const Le=(je,Ze,rt)=>{for(let Je=0;Je<Ze/4;Je++)je.opacityVertexArray.emplaceBack(rt)};let He=0;S&&i.updateReplacement(k,S);for(let je=0;je<i.symbolInstances.length;je++){const Ze=i.symbolInstances.get(je),{numHorizontalGlyphVertices:rt,numVerticalGlyphVertices:Je,crossTileID:Ye,numIconVertices:ht,tileAnchorX:Ct,tileAnchorY:Ft}=Ze;let At=null;if(Ze&&Ae){const hr=this.retainedQueryData[i.bucketInstanceId];At=g.latestFeatureIndex.loadFeature({featureIndex:Ze.featureIndex,bucketIndex:hr.bucketIndex,sourceLayerIndex:hr.sourceLayerIndex,layoutVertexArrayOffset:0})}const Yt=Re.evaluate(At,{}),dt=c.has(Ye);let Lt=this.opacities[Ye];dt?Lt=W:Lt||(Lt=Be,this.opacities[Ye]=Lt),c.add(Ye);const kt=rt>0||Je>0,Qt=ht>0,tr=this.placedOrientations[Ye],Nt=tr===o.bk.vertical,Ut=tr===o.bk.horizontal||tr===o.bk.horizontalOnly;!kt&&!Qt||Lt.isHidden()||He++;let Nr=!1;if((kt||Qt)&&S)for(const hr of i.activeReplacements){if(o.br(hr,w,o.bs.Symbol,L)||hr.min.x>Ct||Ct>hr.max.x||hr.min.y>Ft||Ft>hr.max.y)continue;const Sr=o.bt(Ct,Ft,k.canonical,hr.footprintTileId.canonical);if(Nr=o.bu(Sr,hr.footprint),Nr)break}if(kt){const hr=Nr?Pl:Rl(Lt.text);Le(i.text,rt,Nt?Pl:hr),Le(i.text,Je,Ut?Pl:hr);const Sr=Lt.text.isHidden(),{leftJustifiedTextSymbolIndex:Jr,centerJustifiedTextSymbolIndex:Pr,rightJustifiedTextSymbolIndex:Hr,verticalPlacedTextSymbolIndex:_n}=Ze,pn=i.text.placedSymbolArray,fi=Sr||Nt?1:0;Jr>=0&&(pn.get(Jr).hidden=fi),Pr>=0&&(pn.get(Pr).hidden=fi),Hr>=0&&(pn.get(Hr).hidden=fi),_n>=0&&(pn.get(_n).hidden=Sr||Ut?1:0);const Ti=this.variableOffsets[Ye];Ti&&this.markUsedJustification(i,Ti.anchor,Ze,tr);const Hi=this.placedOrientations[Ye];Hi&&(this.markUsedJustification(i,"left",Ze,Hi),this.markUsedOrientation(i,Hi,Ze))}if(Qt){const hr=Nr?Pl:Rl(Lt.icon),{placedIconSymbolIndex:Sr,verticalPlacedIconSymbolIndex:Jr}=Ze,Pr=i.icon.placedSymbolArray,Hr=Lt.icon.isHidden()?1:0;Sr>=0&&(Le(i.icon,ht,Nt?Pl:hr),Pr.get(Sr).hidden=Hr),Jr>=0&&(Le(i.icon,Ze.numVerticalIconVertices,Ut?Pl:hr),Pr.get(Jr).hidden=Hr)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const hr=i.collisionArrays[je];if(hr){let Sr=new o.P(0,0),Jr=!0;if(hr.textBox||hr.verticalTextBox){if(le){const Hr=this.variableOffsets[Ye];Hr?(Sr=Ro(Hr.anchor,Hr.width,Hr.height,Hr.textOffset,Hr.textScale),ue&&Sr._rotate(pe?this.transform.angle:-this.transform.angle)):Jr=!1}q&&(Jr=!Lt.clipped),hr.textBox&&Fs(i.textCollisionBox.collisionVertexArray,Lt.text.placed,!Jr||Nt,Yt,Oe,Sr.x,Sr.y),hr.verticalTextBox&&Fs(i.textCollisionBox.collisionVertexArray,Lt.text.placed,!Jr||Ut,Yt,Oe,Sr.x,Sr.y)}const Pr=Jr&&!!(!Ut&&hr.verticalIconBox);hr.iconBox&&Fs(i.iconCollisionBox.collisionVertexArray,Lt.icon.placed,Pr,Yt,Oe,Ze.hasIconTextFit?Sr.x:0,Ze.hasIconTextFit?Sr.y:0),hr.verticalIconBox&&Fs(i.iconCollisionBox.collisionVertexArray,Lt.icon.placed,!Pr,Yt,Oe,Ze.hasIconTextFit?Sr.x:0,Ze.hasIconTextFit?Sr.y:0)}}}if(i.fullyClipped=He===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const je=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=je.invProjMatrix,i.placementViewportMatrix=je.viewportMatrix,i.collisionCircleArray=je.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>i}setStale(){this.stale=!0}}function Fs(m,i,c,g,v,w,S){m.emplaceBack(i?1:0,c?1:0,w||0,S||0,g,v?1:0),m.emplaceBack(i?1:0,c?1:0,w||0,S||0,g,v?1:0),m.emplaceBack(i?1:0,c?1:0,w||0,S||0,g,v?1:0),m.emplaceBack(i?1:0,c?1:0,w||0,S||0,g,v?1:0)}const ta=Math.pow(2,25),Eu=Math.pow(2,24),da=Math.pow(2,17),as=Math.pow(2,16),vh=Math.pow(2,9),fa=Math.pow(2,8),Su=Math.pow(2,1);function Rl(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const i=m.placed?1:0,c=Math.floor(127*m.opacity);return c*ta+i*Eu+c*da+i*as+c*vh+i*fa+c*Su+i}const Pl=0;class bh{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,c,g,v,w){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(S,v,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((k,L)=>k.sortKey-L.sortKey));this._currentPartIndex<S.length;){const k=S[this._currentPartIndex];if(c.placeLayerBucketPart(k,this._seenCrossTileIDs,g,k.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class Xa{constructor(i,c,g,v,w,S,k,L,F){this.placement=new Ns(i,w,S,k,L,F),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,c,g,v){const w=o.q.now(),S=()=>{const k=o.q.now()-w;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=c[i[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=L)&&(!k.maxzoom||k.maxzoom>L)){const F=k,V=F.layout.get("symbol-z-elevate"),q=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,W=F.layout.get("symbol-z-order"),K=W==="viewport-y"||W==="auto"&&!(W!=="viewport-y"&&q),ae=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),le=K&&ae,ue=this._inProgressLayer=this._inProgressLayer||new bh(F),pe=o.av(k.source,k.scope);if(ue.continuePlacement(V||le?v[pe]:g[pe],this.placement,this._showCollisionBoxes,k,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const zo=512/o.ab/2;class xh{constructor(i,c,g){this.tileID=i,this.bucketInstanceId=g,this.index=new o.by(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=i.canonical.x*o.ab,w=i.canonical.y*o.ab;for(let S=0;S<c.length;S++){const{key:k,crossTileID:L,tileAnchorX:F,tileAnchorY:V}=c.get(S),q=Math.floor((v+F)*zo),W=Math.floor((w+V)*zo);this.index.add(q,W),this.keys.push(k),this.crossTileIDs.push(L)}this.index.finish()}findMatches(i,c,g){const v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=zo/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*o.ab,k=c.canonical.y*o.ab;for(let L=0;L<i.length;L++){const F=i.get(L);if(F.crossTileID)continue;const{key:V,tileAnchorX:q,tileAnchorY:W}=F,K=Math.floor((S+q)*w),ae=Math.floor((k+W)*w),le=this.index.range(K-v,ae-v,K+v,ae+v);for(const ue of le){const pe=this.crossTileIDs[ue];if(this.keys[ue]===V&&!g.has(pe)){g.add(pe),F.crossTileID=pe;break}}}}}class ra{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Vs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(c!==0)for(const g in this.indexes){const v=this.indexes[g],w={};for(const S in v){const k=v[S];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+c),w[k.tileID.key]=k}this.indexes[g]=w}this.lng=i}addBucket(i,c,g){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const v=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>i.overscaledZ)for(const k in S){const L=S[k];L.tileID.isChildOf(i)&&L.findMatches(c.symbolInstances,i,v)}else{const k=S[i.scaledTo(Number(w)).key];k&&k.findMatches(c.symbolInstances,i,v)}}for(let w=0;w<c.symbolInstances.length;w++){const S=c.symbolInstances.get(w);S.crossTileID||(S.crossTileID=g.generate(),v.add(S.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new xh(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const g of c.crossTileIDs)this.usedCrossTileIDs[i].delete(g)}removeStaleBuckets(i){let c=!1;for(const g in this.indexes){const v=this.indexes[g];for(const w in v)i[v[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[w]),delete v[w],c=!0)}return c}}class B{constructor(){this.layerIndexes={},this.crossTileIDs=new ra,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,g,v){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new Vs);let S=!1;const k={};v.name!=="globe"&&w.handleWrapJump(g);for(const L of c){const F=L.getBucket(i);F&&i.fqid===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(L.tileID,F,this.crossTileIDs)&&(S=!0),k[F.bucketInstanceId]=!0)}return w.removeStaleBuckets(k)&&(S=!0),S}pruneUnusedLayers(i){const c={};i.forEach(g=>{c[g]=!0});for(const g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}const ee=771;class de{constructor(i,c,g,v){this.blendFunction=i,this.blendColor=c,this.mask=g,this.blendEquation=v}}de.Replace=[1,0,1,0],de.disabled=new de(de.Replace,o.bz.transparent,[!1,!1,!1,!1]),de.unblended=new de(de.Replace,o.bz.transparent,[!0,!0,!0,!0]),de.alphaBlended=new de([1,ee,1,ee],o.bz.transparent,[!0,!0,!0,!0]),de.alphaBlendedNonPremultiplied=new de([770,ee,770,ee],o.bz.transparent,[!0,!0,!0,!0]),de.multiply=new de([774,0,774,0],o.bz.transparent,[!0,!0,!0,!0]);class Me{constructor(i,c,g){this.func=i,this.mask=c,this.range=g}}Me.ReadOnly=!1,Me.ReadWrite=!0,Me.disabled=new Me(519,Me.ReadOnly,[0,1]);const Bt=7680;class wt{constructor(i,c,g,v,w,S){this.test=i,this.ref=c,this.mask=g,this.fail=v,this.depthFail=w,this.pass=S}}wt.disabled=new wt({func:519,mask:0},0,0,Bt,Bt,Bt);const Or=1029,wi=2305;class Dr{constructor(i,c,g){this.enable=i,this.mode=c,this.frontFace=g}}function di(m,i){const c=o.bC(m,3);o.a6.mat4.fromQuat(m,i),o.bE(m,3,c)}function zi(m,i){const c=o.a6.quat.identity([]);return o.a6.quat.rotateZ(c,c,-i),o.a6.quat.rotateX(c,c,-m),c}function Go(m,i){const c=[m[0],m[1],0],g=[i[0],i[1],0];if(o.a6.vec3.length(c)>=1e-15){const S=o.a6.vec3.normalize([],c);o.a6.vec3.scale(g,S,o.a6.vec3.dot(g,S)),i[0]=g[0],i[1]=g[1]}const v=o.a6.vec3.cross([],i,m);if(o.a6.vec3.len(v)<1e-15)return null;const w=Math.atan2(-v[1],v[0]);return zi(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),w)}Dr.disabled=new Dr(!1,Or,wi),Dr.backCCW=new Dr(!0,Or,wi),Dr.backCW=new Dr(!0,Or,2304),Dr.frontCW=new Dr(!0,1028,2304),Dr.frontCCW=new Dr(!0,1028,wi);class Rs{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){if(i){const c=i instanceof o.a5?i:new o.a5(i[0],i[1],i[2]);this._renderWorldCopies&&(c.x=o.bA(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(i,c){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(o.a5.fromLngLat(i)):0,w=o.a5.fromLngLat(i,v),S=[w.x-g.x,w.y-g.y,w.z-g.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Go(S,c)}setPitchBearing(i,c){this.orientation=zi(o.bB(i),o.bB(-c))}}class Jo{constructor(i,c){this._transform=o.a6.mat4.identity([]),this.orientation=c,this.position=i}get mercatorPosition(){const i=this.position;return new o.a5(i[0],i[1],i[2])}get position(){const i=o.bC(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var c;i&&o.bE(this._transform,3,[(c=i)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||o.a6.quat.identity([]),i&&di(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=zi(i,c),di(this._transform,this._orientation)}forward(){const i=o.bC(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=o.bC(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=o.bC(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){const g=new Float64Array(16);return o.a6.mat4.invert(g,this.getWorldToCamera(i,c)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,c,g){const v=this.position;o.a6.vec3.scale(v,v,-i);const w=new Float64Array(16);return o.a6.mat4.fromScaling(w,[g,g,g]),o.a6.mat4.translate(w,w,v),w[10]*=c,w}getWorldToCamera(i,c){const g=new Float64Array(16),v=new Float64Array(4),w=this.position;return o.a6.quat.conjugate(v,this._orientation),o.a6.vec3.scale(w,w,-i),o.a6.mat4.fromQuat(g,v),o.a6.mat4.translate(g,g,w),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(i,c,g,v){const w=new Float64Array(16);return o.a6.mat4.perspective(w,i,c,g,v),w}getCameraToClipOrthographic(i,c,g,v,w,S){const k=new Float64Array(16);return o.a6.mat4.ortho(k,i,c,g,v,w,S),k}getDistanceToElevation(i,c=!1){const g=i===0?0:o.bD(i,c?o.aM(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Jo([...this.position],[...this.orientation])}}const No={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ql{constructor(i=0,c=0,g=0,v=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=g,this.right=v}interpolate(i,c,g){return c.top!=null&&i.top!=null&&(this.top=o.aa(i.top,c.top,g)),c.bottom!=null&&i.bottom!=null&&(this.bottom=o.aa(i.bottom,c.bottom,g)),c.left!=null&&i.left!=null&&(this.left=o.aa(i.left,c.left,g)),c.right!=null&&i.right!=null&&(this.right=o.aa(i.right,c.right,g)),this}getCenter(i,c){const g=o.ap((this.left+i-this.right)/2,0,i),v=o.ap((this.top+c-this.bottom)/2,0,c);return new o.P(g,v)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ql(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const sc=(m,i,c)=>(1-c)*m+c*i,Ml=m=>m*m*m*m*m;class wh{constructor(i,c,g,v,w,S,k){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new o.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ql,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Jo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new wh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,c=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(i||g)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.ar(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.bL(this.projectionOptions);const g=this.getProjection(),v=!o.bh(c,g);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bL({name:"mercator"});const c=i!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bA(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const c=-i*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.a6.mat2.create(),o.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=o.ap(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=o.bB(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,w=0;for(let S=0;S<c.length;S++){const k=new o.P(c[S][0]*this.width,g+c[S][1]*(this.height-g)),L=i.pointCoordinate(k);if(!L)continue;const F=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);v+=L[3]*F,w+=F}return w===0?NaN:v/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-g,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let g;g=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];const v=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,g));return o.ap(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!o.a6.quat.exactEquals(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){const g=[i.position.x,i.position.y,i.position.z];o.a6.vec3.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,c=new Rs;return c.position=new o.a5(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!o.a6.quat.length(i))return!1;o.a6.quat.normalize(i,i);const c=o.a6.vec3.transformQuat([],[0,0,-1],i),g=o.a6.vec3.transformQuat([],[0,-1,0],i);if(g[2]<0)return!1;const v=Go(c,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(i){const c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;i[2]=o.ap(i[2],v/g,v/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,g){this._unmodified=!1,this._edgeInsets.interpolate(i,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new o.bM(0,i)];if(this.renderWorldCopies){const g=this.pointCoordinate(new o.P(0,0)),v=this.pointCoordinate(new o.P(this.width,0)),w=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),k=Math.floor(Math.min(g.x,v.x,w.x,S.x)),L=Math.floor(Math.max(g.x,v.x,w.x,S.x)),F=1;for(let V=k-F;V<=L+F;V++)V!==0&&c.push(new o.bM(V,i))}return c}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,c,g){let v=[];const w=g!==void 0,S=!w;if(S&&this.zoom<c||w&&g[0]===0&&g[1]===0)return v;const k=new Set,L=(V,q,W,K,ae)=>{const le=o.c1(q,V,W,K,ae);k.has(le)||(v.push(new o.aA(V,q,W,K,ae)),k.add(le))};for(let V=0;V<i.length;V++){const q=i[V];if(S&&q.canonical.z!==c)continue;const W=q.canonical,K=q.overscaledZ,ae=q.wrap,le=1<<W.z,ue=W.x+1<le,pe=W.x>0,Re=W.y+1<le,Oe=W.y>0,Ae=q.wrap-(pe?0:1),Be=q.wrap+(ue?0:1),Le=pe?W.x-1:le-1,He=ue?W.x+1:0;if(w)g[0]<0?(L(K,Be,W.z,He,W.y),g[1]<0&&Re&&(L(K,ae,W.z,W.x,W.y+1),L(K,Be,W.z,He,W.y+1)),g[1]>0&&Oe&&(L(K,ae,W.z,W.x,W.y-1),L(K,Be,W.z,He,W.y-1))):g[0]>0?(L(K,Ae,W.z,Le,W.y),g[1]<0&&Re&&(L(K,ae,W.z,W.x,W.y+1),L(K,Ae,W.z,Le,W.y+1)),g[1]>0&&Oe&&(L(K,ae,W.z,W.x,W.y-1),L(K,Ae,W.z,Le,W.y-1))):g[1]<0&&Re?L(K,ae,W.z,W.x,W.y+1):Oe&&L(K,ae,W.z,W.x,W.y-1);else{const je=q.visibleQuadrants;1&je&&(L(K,Ae,W.z,Le,W.y),Oe&&(L(K,ae,W.z,W.x,W.y-1),L(K,Ae,W.z,Le,W.y-1))),2&je&&(L(K,Be,W.z,He,W.y),Oe&&(L(K,ae,W.z,W.x,W.y-1),L(K,Be,W.z,He,W.y-1))),4&je&&(L(K,Ae,W.z,Le,W.y),Re&&(L(K,ae,W.z,W.x,W.y+1),L(K,Ae,W.z,Le,W.y+1))),8&je&&(L(K,Be,W.z,He,W.y),Re&&(L(K,ae,W.z,W.x,W.y+1),L(K,Be,W.z,He,W.y+1)))}}const F=[];for(const V of v)v.some(q=>V.isChildOf(q))||F.push(V);if(v=F.filter(V=>!i.some(q=>!!(V.overscaledZ<c&&q.isChildOf(V))||V.equals(q)||V.isChildOf(q))),S){const V=1<<c,q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=[V*q.x,V*q.y],K=4,ae=K*K;v=v.filter(le=>{const ue=le.canonical.x+.5-W[0],pe=le.canonical.y+.5-W[1];return ue*ue+pe*pe<ae})}return v}coveringTiles(i){let c=this.coveringZoomLevel(i);const g=c,v=this.elevation&&this.elevation.exaggeration(),w=v&&!i.isTerrainDEM,S=this.projection.name==="mercator";if(i.minzoom!==void 0&&c<i.minzoom)return[];i.maxzoom!==void 0&&c>i.maxzoom&&(c=i.maxzoom);const k=this.locationCoordinate(this.center),L=this.center.lat,F=1<<c,V=[F*k.x,F*k.y,0],q=this.projection.name==="globe",W=!q,K=o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,W),ae=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=F*o.bD(1,this.center.lat),ue=this._camera.position[2]/o.bD(1,this.center.lat),pe=[F*ae.x,F*ae.y,ue*(W?1:le)],Re=q||v,Oe=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Ae=this.isLODDisabled(!0)?c:0;let Be;if(this._elevation&&i.isTerrainDEM)Be=1e4*this._elevation.exaggeration();else if(this._elevation){const dt=this._elevation.getMinMaxForVisibleTiles();Be=dt?dt.max:this._centerAltitude}else Be=this._centerAltitude;const Le=i.isTerrainDEM?-Be:this._elevation?this._elevation.getMinElevationBelowMSL():0,He=this.projection.isReprojectedInTileSpace?o.bO(this):1,je=dt=>{const kt=new o.a5(dt.x+25e-6,dt.y,dt.z),Qt=new o.a5(dt.x,dt.y+25e-6,dt.z),tr=dt.toLngLat(),Nt=kt.toLngLat(),Ut=Qt.toLngLat(),Nr=this.locationCoordinate(tr),hr=this.locationCoordinate(Nt),Sr=this.locationCoordinate(Ut),Jr=Math.hypot(hr.x-Nr.x,hr.y-Nr.y),Pr=Math.hypot(Sr.x-Nr.x,Sr.y-Nr.y);return Math.sqrt(Jr*Pr)*He/25e-6},Ze=dt=>{const Lt=Be,kt=Le;return{aabb:o.bR(this,F,0,0,0,dt,kt,Lt,this.projection),zoom:0,x:0,y:0,minZ:kt,maxZ:Lt,wrap:dt,fullyVisible:!1}},rt=[];let Je=[];const Ye=c,ht=i.reparseOverscaled?g:c,Ct=(ue-this._centerAltitude)*le,Ft=dt=>{if(!this._elevation||!dt.tileID||!S)return;const Lt=this._elevation.getMinMaxForTile(dt.tileID),kt=dt.aabb;Lt?(kt.min[2]=Lt.min,kt.max[2]=Lt.max,kt.center[2]=(kt.min[2]+kt.max[2])/2):(dt.shouldSplit=Yt(dt),dt.shouldSplit||(kt.min[2]=kt.max[2]=kt.center[2]=this._centerAltitude))},At=(dt,Lt)=>{if(.707*Lt<dt)return 1;const kt=Lt/dt;return kt/(1.4144271570014144+(Math.pow(1.1,kt-1.4144271570014144+1)-1)/(1.1-1)-1)},Yt=dt=>{if(dt.zoom<Ae)return!0;if(dt.zoom===Ye)return!1;if(dt.shouldSplit!=null)return dt.shouldSplit;const Lt=dt.aabb.distanceX(pe),kt=dt.aabb.distanceY(pe);let Qt=Ct,tr=1;if(q){Qt=dt.aabb.distanceZ(pe);const Pr=Math.pow(2,dt.zoom),Hr=o.aM((dt.y+1)/Pr),_n=o.aM(dt.y/Pr),pn=Math.min(Math.max(L,Hr),_n),fi=o.c5(pn)/o.c5(L);if(tr=pn===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,fi/this._mercatorScaleRatio),this.zoom<=o.c2&&dt.zoom===Ye-1&&fi>=.9)return!0}else if(w&&(Qt=dt.aabb.distanceZ(pe)*le),this.projection.isReprojectedInTileSpace&&g<=5){const Pr=Math.pow(2,dt.zoom),Hr=je(new o.a5((dt.x+.5)/Pr,(dt.y+.5)/Pr));tr=Hr>.85?1:Hr}if(!S){const Pr=Math.sqrt(Lt*Lt+kt*kt+Qt*Qt);let Hr=(1<<Ye-dt.zoom)*Oe*tr;return Hr*=At(Math.max(Qt,Ct),Pr),Pr<Hr}let Nt=Number.MAX_VALUE,Ut=0;const Nr=dt.aabb.getCorners(),hr=[];for(const Pr of Nr){o.a6.vec3.sub(hr,Pr,pe),q||(w?hr[2]*=le:hr[2]=Ct);const Hr=o.a6.vec3.dot(hr,this._camera.forward());Hr<Nt&&(Nt=Hr,Ut=Math.abs(hr[2]))}let Sr=(1<<Ye-dt.zoom)*Oe*tr;if(Sr*=At(Math.max(Ut,Ct),Nt),Nt<Sr)return!0;const Jr=dt.aabb.closestPoint(V);return Jr[0]===V[0]&&Jr[1]===V[1]};if(this.renderWorldCopies)for(let dt=1;dt<=3;dt++)rt.push(Ze(-dt)),rt.push(Ze(dt));for(rt.push(Ze(0));rt.length>0;){const dt=rt.pop(),Lt=dt.x,kt=dt.y;let Qt=dt.fullyVisible;const tr=()=>this.projection.name==="globe"&&(dt.y===0||dt.y===(1<<dt.zoom)-1);if(!Qt){let Nt=Re?dt.aabb.intersects(K):dt.aabb.intersectsFlat(K);if(Nt===0&&tr()){const Ut=new o.bP(dt.zoom,Lt,kt);Nt=o.bQ(this,F,Ut,!0).intersects(K)}if(Nt===0)continue;Qt=Nt===2}if(dt.zoom!==Ye&&Yt(dt))for(let Nt=0;Nt<4;Nt++){const Ut=(Lt<<1)+Nt%2,Nr=(kt<<1)+(Nt>>1),hr={aabb:S?dt.aabb.quadrant(Nt):o.bR(this,F,dt.zoom+1,Ut,Nr,dt.wrap,dt.minZ,dt.maxZ,this.projection),zoom:dt.zoom+1,x:Ut,y:Nr,wrap:dt.wrap,fullyVisible:Qt,tileID:void 0,shouldSplit:void 0,minZ:dt.minZ,maxZ:dt.maxZ};w&&!q&&(hr.tileID=new o.aA(dt.zoom+1===Ye?ht:dt.zoom+1,dt.wrap,dt.zoom+1,Ut,Nr),Ft(hr)),rt.push(hr)}else{const Nt=dt.zoom===Ye?ht:dt.zoom;if(i.minzoom&&i.minzoom>Nt)continue;let Ut=0;if(!Qt){let Jr=Re?dt.aabb.intersectsPrecise(K):dt.aabb.intersectsPreciseFlat(K);if(Jr===0&&tr()){const Pr=new o.bP(dt.zoom,Lt,kt);Jr=o.bQ(this,F,Pr,!0).intersectsPrecise(K)}if(Jr===0)continue;if(i.calculateQuadrantVisibility)if(K.containsPoint(dt.aabb.center))Ut=15;else for(let Pr=0;Pr<4;Pr++)dt.aabb.quadrant(Pr).intersects(K)!==0&&(Ut|=1<<Pr)}const Nr=V[0]-(.5+Lt+(dt.wrap<<dt.zoom))*(1<<c-dt.zoom),hr=V[1]-.5-kt,Sr=dt.tileID?dt.tileID:new o.aA(Nt,dt.wrap,dt.zoom,Lt,kt);i.calculateQuadrantVisibility&&(Sr.visibleQuadrants=Ut),Je.push({tileID:Sr,distanceSq:Nr*Nr+hr*hr})}}if(this.fogCullDistSq){const dt=this.fogCullDistSq,Lt=this.horizonLineFromTop();Je=Je.filter(kt=>{const Qt=[0,0,0,1],tr=[o.ab,o.ab,0,1],Nt=this.calculateFogTileMatrix(kt.tileID.toUnwrapped());o.a6.vec4.transformMat4(Qt,Qt,Nt),o.a6.vec4.transformMat4(tr,tr,Nt);const Ut=o.a6.vec4.min([],Qt,tr),Nr=o.a6.vec4.max([],Qt,tr),hr=o.bS(Ut,Nr);if(hr===0)return!0;let Sr=!1;const Jr=this._elevation;if(Jr&&hr>dt&&Lt!==0){const Pr=this.calculateProjMatrix(kt.tileID.toUnwrapped());let Hr;i.isTerrainDEM||(Hr=Jr.getMinMaxForTile(kt.tileID)),Hr||(Hr={min:Le,max:Be});const _n=o.c3(this.rotation),pn=[_n[0]*o.ab,_n[1]*o.ab,Hr.max];o.a6.vec3.transformMat4(pn,pn,Pr),Sr=(1-pn[1])*this.height*.5<Lt}return hr<dt||Sr})}return Je.sort((dt,Lt)=>dt.distanceSq-Lt.distanceSq).map(dt=>dt.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const c=o.ap(i.lat,-o.bT,o.bT),g=this.projection.project(i.lng,c);return new o.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,c){let g,v;const w=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;g=(c.x-w.x)/k,v=(c.y-w.y)/k}else{const k=this.pointCoordinate(c),L=this.pointCoordinate(w);g=k.x-L.x,v=k.y-L.y}const S=this.locationCoordinate(i);this.setLocation(new o.a5(S.x-g,S.y-v))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,c){const g=c?o.bD(c,i.lat):void 0,v=this.projection.project(i.lng,i.lat);return new o.a5(v.x,v.y,g)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){const g=c??this._centerAltitude,v=[i.x,i.y,0,1],w=[i.x,i.y,1,1];o.a6.vec4.transformMat4(v,v,this.pixelMatrixInverse),o.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse);const S=w[3];o.a6.vec4.scale(v,v,1/v[3]),o.a6.vec4.scale(w,w,1/S);const k=v[2],L=w[2];return{p0:v,p1:w,t:k===L?0:(g-k)/(L-k)}}screenPointToMercatorRay(i){const c=[i.x,i.y,0,1],g=[i.x,i.y,1,1];return o.a6.vec4.transformMat4(c,c,this.pixelMatrixInverse),o.a6.vec4.transformMat4(g,g,this.pixelMatrixInverse),o.a6.vec4.scale(c,c,1/c[3]),o.a6.vec4.scale(g,g,1/g[3]),c[2]=o.bD(c[2],this._center.lat)*this.worldSize,g[2]=o.bD(g[2],this._center.lat)*this.worldSize,o.a6.vec4.scale(c,c,1/this.worldSize),o.a6.vec4.scale(g,g,1/this.worldSize),new o.aj([c[0],c[1],c[2]],o.a6.vec3.normalize([],o.a6.vec3.sub([],g,c)))}rayIntersectionCoordinate(i){const{p0:c,p1:g,t:v}=i,w=o.bD(c[2],this._center.lat),S=o.bD(g[2],this._center.lat);return new o.a5(o.aa(c[0],g[0],v)/this.worldSize,o.aa(c[1],g[1],v)/this.worldSize,o.aa(w,S,v))}pointCoordinate(i,c=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,c)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let c=this.projection.pointCoordinate3D(this,i.x,i.y);if(c)return new o.a5(c[0],c[1],c[2]);let g=0,v=this.horizonLineFromTop();if(i.y>v)return this.pointCoordinate(i);const w=.02*v,S=i.clone();for(let k=0;k<10&&v-g>w;k++){S.y=o.aa(g,v,.66);const L=this.projection.pointCoordinate3D(this,S.x,S.y);L?(v=S.y,c=L):g=S.y}return c?new o.a5(c[0],c[1],c[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=o.bU)return!this.isPointAboveHorizon(i);const c=this.pointCoordinate(i);return c.y>=0&&c.y<=1}_coordinatePoint(i,c){const g=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,v=[i.x*this.worldSize,i.y*this.worldSize,g+i.toAltitude(),1];return o.a6.vec4.transformMat4(v,v,this.pixelMatrix),v[3]>0?new o.P(v[0]/v[3],v[1]/v[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:c}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.P(c,i)),S=this.pointLocation3D(new o.P(v,i)),k=this.pointLocation3D(new o.P(v,g)),L=this.pointLocation3D(new o.P(c,g));let F=Math.min(w.lng,S.lng,k.lng,L.lng),V=Math.max(w.lng,S.lng,k.lng,L.lng),q=Math.min(w.lat,S.lat,k.lat,L.lat),W=Math.max(w.lat,S.lat,k.lat,L.lat);const K=Math.pow(2,-this.zoom)/16*270,ae=this.projection.name==="globe"?1:4,le=(ue,pe,Re,Oe,Ae)=>{const Be=(ue+Re)/2,Le=(pe+Oe)/2,He=new o.P(Be,Le),{lng:je,lat:Ze}=this.pointLocation3D(He),rt=Math.max(0,F-je,q-Ze,je-V,Ze-W);F=Math.min(F,je),V=Math.max(V,je),q=Math.min(q,Ze),W=Math.max(W,Ze),(Ae<ae||rt>K)&&(le(ue,pe,Be,Le,Ae+1),le(Be,Le,Re,Oe,Ae+1))};if(le(c,i,v,i,1),le(v,i,v,g,1),le(v,g,c,g,1),le(c,g,c,i,1),this.projection.name==="globe"){const[ue,pe]=o.bV(this);ue?(W=90,V=180,F=-180):pe&&(q=-90,V=180,F=-180)}return new o.as(new o.bK(F,q),new o.bK(V,W))}_getBoundsRectangular(i,c){const{top:g,left:v}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,k=new o.P(v,g),L=new o.P(S,g),F=new o.P(S,w),V=new o.P(v,w);let q=this.pointCoordinate(k,i),W=this.pointCoordinate(L,i);const K=this.pointCoordinate(F,c),ae=this.pointCoordinate(V,c),le=(ue,pe)=>(pe.y-ue.y)/(pe.x-ue.x);return q.y>1&&W.y>=0?q=new o.a5((1-ae.y)/le(ae,q)+ae.x,1):q.y<0&&W.y<=1&&(q=new o.a5(-ae.y/le(ae,q)+ae.x,0)),W.y>1&&q.y>=0?W=new o.a5((1-K.y)/le(K,W)+K.x,1):W.y<0&&q.y<=1&&(W=new o.a5(-K.y/le(K,W)+K.x,0)),new o.as().extend(this.coordinateLocation(q)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=i.visibleDemTiles.reduce((g,v)=>{if(v.dem){const w=v.dem.tree;g.min=Math.min(g.min,w.minimums[0]),g.max=Math.max(g.max,w.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-o.bT,this.maxLat=o.bT,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.am(this.minLng)*this.tileSize,this.worldMaxX=o.am(this.maxLng)*this.tileSize,this.worldMinY=o.at(this.maxLat)*this.tileSize,this.worldMaxY=o.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){return this.projection.createTileMatrix(this,c,i)}calculateDistanceTileData(i){const c=i.key,g=this._distanceTileDataCache;if(g[c])return g[c];const v=i.canonical,w=1/this.height,S=this.cameraWorldSize,k=S/this.zoomScale(v.z),L=(v.x+Math.pow(2,v.z)*i.wrap)*k,F=v.y*k,V=this.point;V.x*=S/this.worldSize,V.y*=S/this.worldSize;const q=this.angle,W=Math.sin(-q),K=-Math.cos(-q);return g[c]={bearing:[W,K],center:[(V.x-L)*w,(V.y-F)*w],scale:k/o.ab*w},g[c]}calculateFogTileMatrix(i){const c=i.key,g=this._fogTileMatrixCache;if(g[c])return g[c];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return o.a6.mat4.multiply(v,this.worldToFogMatrix,v),g[c]=new Float32Array(v),g[c]}calculateProjMatrix(i,c=!1,g=!1){const v=i.key;let w;if(w=g?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[v])return w[v];const S=this.calculatePosMatrix(i,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.a6.mat4.multiply(S,k,S),w[v]=new Float32Array(S),w[v]}calculatePixelsToTileUnitsMatrix(i){const c=i.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];const v=o.bW(i,this);return g[c]=v,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,c=o.a6.mat4.fromScaling([],[i,i,i]);return o.a6.mat4.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const c=o.bD(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),v=this._camera.forward(),w=o.bD(1,this._center.lat);g[2]/=w,v[2]/=w,o.a6.vec3.normalize(v,v);const S=i.raycast(g,v,i.exaggeration());if(S){const k=o.a6.vec3.scaleAndAdd([],g,v,S),L=new o.a5(k[0],k[1],o.bD(k[2],o.aM(k[1]))),F=(L.z+o.a6.vec3.length([L.x-g[0],L.y-g[1],L.z-g[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const c=this._elevation,g=o.bD(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),w=c.getAtPointOrZero(new o.a5(...v)),S=this.pixelsPerMeter/this.worldSize*w,k=this._minimumHeightOverTerrain(),L=v[2]-S;if(L<=k)if(L<0||i){const F=this.locationCoordinate(this._center,this._centerAltitude),V=[v[0],v[1],F.z-v[2]],q=o.a6.vec3.length(V);V[2]-=(k-L)/this._pixelsPerMercatorPixel;const W=o.a6.vec3.length(V);if(W===0)return;o.a6.vec3.scale(V,V,q/W*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],F.z*this._pixelsPerMercatorPixel-V[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const W=this.center;return W.lat=o.ap(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(W.lng=o.ap(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const c=this._unmodified,{x:g,y:v}=this.point;let w=0,S=g,k=v;const L=this.width/2,F=this.height/2,V=this.worldMinY*this.scale,q=this.worldMaxY*this.scale;if(v-F<V&&(k=V+F),v+F>q&&(k=q-F),q-V<this.height&&(w=Math.max(w,this.height/(q-V)),k=(q+V)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,ae=this.worldSize/2-(W+K)/2;S=(g+ae+this.worldSize)%this.worldSize-ae,S-L<W&&(S=W+L),S+L>K&&(S=K-L),K-W<this.width&&(w=Math.max(w,this.width/(K-W)),S=(K+W)/2)}S===g&&k===v||(this.center=this.unproject(new o.P(S,k))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,c=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bD(1,this.center.lat)/o.bD(1,o.c4));const v=o.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?g:1,S=this._camera.getWorldToCamera(this.worldSize,w);let k;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-i.x/this.width,L[9]=2*i.y/this.height,this.isOrthographic){let Ze=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),rt=Ze*this.aspect,Je=-rt,Ye=-Ze;rt-=i.x,Je-=i.x,Ze+=i.y,Ye+=i.y,k=this._camera.getCameraToClipOrthographic(Je,rt,Ye,Ze,this._nearZ,this._farZ),((ht,Ct,Ft,At)=>{for(let Yt=0;Yt<16;Yt++)ht[Yt]=sc(Ct[Yt],Ft[Yt],At)})(k,k,L,Ml(this.pitch>=15?1:this.pitch/15))}else k=L;const F=o.a6.mat4.mul([],L,S);let V=o.a6.mat4.mul([],k,S);if(this.projection.isReprojectedInTileSpace){const Ze=this.locationCoordinate(this.center),rt=o.a6.mat4.identity([]);o.a6.mat4.translate(rt,rt,[Ze.x*this.worldSize,Ze.y*this.worldSize,0]),o.a6.mat4.multiply(rt,rt,o.bY(this)),o.a6.mat4.translate(rt,rt,[-Ze.x*this.worldSize,-Ze.y*this.worldSize,0]),o.a6.mat4.multiply(V,V,rt),o.a6.mat4.multiply(F,F,rt),this.inverseAdjustmentMatrix=o.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.mat4.scale([],V,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=V,this.invProjMatrix=o.a6.mat4.invert(new Float64Array(16),this.projMatrix),c){const Ze=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ze[8]=2*-i.x/this.width,Ze[9]=2*i.y/this.height,this.expandedFarZProjMatrix=o.a6.mat4.mul([],Ze,S)}else this.expandedFarZProjMatrix=this.projMatrix;const q=o.a6.mat4.invert([],k);this.frustumCorners=o.b_.fromInvProjectionMatrix(q,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const W=new Float32Array(16);o.a6.mat4.identity(W),o.a6.mat4.scale(W,W,[1,-1,1]),o.a6.mat4.rotateX(W,W,this._pitch),o.a6.mat4.rotateZ(W,W,this.angle);const K=o.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.mat4.clone(K);const ae=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-i.x/this.width,K[9]=2*(i.y+ae)/this.height,this.skyboxMatrix=o.a6.mat4.multiply(W,K,W);const le=this.point,ue=le.x,pe=le.y,Re=this.width%2/2,Oe=this.height%2/2,Ae=Math.cos(this.angle),Be=Math.sin(this.angle),Le=ue-Math.round(ue)+Ae*Re+Be*Oe,He=pe-Math.round(pe)+Ae*Oe+Be*Re,je=new Float64Array(V);if(o.a6.mat4.translate(je,je,[Le>.5?Le-1:Le,He>.5?He-1:He,0]),this.alignedProjMatrix=je,V=o.a6.mat4.create(),o.a6.mat4.scale(V,V,[this.width/2,-this.height/2,1]),o.a6.mat4.translate(V,V,[1,-1,0]),this.labelPlaneMatrix=V,V=o.a6.mat4.create(),o.a6.mat4.scale(V,V,[1,-1,1]),o.a6.mat4.translate(V,V,[-1,-1,0]),o.a6.mat4.scale(V,V,[2/this.width,2/this.height,1]),this.glCoordMatrix=V,this.pixelMatrix=o.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,F),this._calcFogMatrices(),this._distanceTileDataCache={},V=o.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!V)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=V,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.b$(this);const Ze=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.a6.vec3.transformMat4(Ze,Ze,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=V;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,c];o.a6.vec3.scale(w,w,v),o.a6.vec3.scale(g,g,-1),o.a6.vec3.multiply(g,g,w);const S=o.a6.mat4.create();o.a6.mat4.translate(S,S,g),o.a6.mat4.scale(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,v)}_computeCameraPosition(i){const c=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-i/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*w,v.y/this.worldSize-g[1]*w,i/this.worldSize*this._centerAltitude-g[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(w=Math.min((c-g)/v,1)),this._camera.position=o.a6.vec3.scaleAndAdd([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),w=o.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bB(this._maxPitch)),k=Math.max((i[2]-w)/Math.cos(g),S),L=this._zoomFromMercatorZ(k);o.a6.vec3.scaleAndAdd(i,i,c,k),this._pitch=o.ap(g,o.bB(this.minPitch),o.bB(this.maxPitch)),this.angle=o.bA(v,-Math.PI,Math.PI),this._setZoom(o.ap(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.a5(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let c=0,g=o.bU,v=0,w=1/0;for(;g-c>1e-6&&g>c;){const S=c+.5*(g-c),k=this.tileSize*Math.pow(2,S),L=this.getCameraToCenterDistance(this.projection,S,k),F=this.scaleZoom(L/(i*this.tileSize)),V=Math.abs(S-F);V<w&&(w=V,v=S),S<F?c=S:g=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,c){const g=Math.min(i.x,c.x),v=Math.max(i.x,c.x),w=Math.min(i.y,c.y),S=Math.max(i.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new o.P(g,w),new o.P(v,S),new o.P(g,S),new o.P(v,w)],L=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const V of k){const q=this.pointRayIntersection(V);if(q.t<0)return!0;const W=this.rayIntersectionCoordinate(q);if(W.x<L||W.y<0||W.x>F||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(i,c){const g=o.a6.vec3.length(o.a6.vec3.sub([],this._camera.position,i)),v=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([c,g,v],w){const S=[c,g,v,1];o.a6.vec4.transformMat4(S,S,w);const k=S[3]=Math.max(S[3],1e-6);return S[0]/=k,S[1]/=k,S[2]/=k,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,i))}}getCameraToCenterDistance(i,c=this.zoom,g=this.worldSize){const v=o.bX(i,c,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,g,v);let S=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(S=sc(1,S,Ml(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return o.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const kl=(m,i)=>{if(i>0&&m.terrain&&o.w("Cutoff is currently disabled on terrain"),i<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=m.transform,g=Math.max(Math.abs(c._zoom-(m.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?o.a7(60,45,c.pitch):o.a7(30,15,c.pitch),w=c._farZ-c._nearZ,S=i*c.height,k=((1-(L=v))*c.cameraToCenterDistance+L*(c._farZ+S))*g;var L;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(k-c._nearZ)/w,(k-S-c._nearZ)/w]}}},to={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Jd{constructor(i,c){this.aabb=i,this.lastCascade=c}}class fr{add(i,c){const g=this.receivers[i.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],c.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],c.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],c.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],c.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],c.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],c.max[2])):this.receivers[i.key]=new Jd(c,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,c,g){const v=o.c9.fromPoints(i.points);let w=0;for(const S in this.receivers){const k=this.receivers[S];if(!k||!v.intersectsAabb(k.aabb))continue;k.aabb.min=v.closestPoint(k.aabb.min),k.aabb.max=v.closestPoint(k.aabb.max);const L=k.aabb.getCorners();for(let F=0;F<g.length;F++){let V=!0;for(const q of L){const W=[q[0]*c,q[1]*c,q[2]];if(o.a6.vec3.transformMat4(W,W,g[F].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){V=!1;break}}if(k.lastCascade=F,w=Math.max(w,F),V)break}}return w+1}}class Qd{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new fr,this._depthMode=new Me(i.context.gl.LEQUAL,Me.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(to,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(to,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(to,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,c){const g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((ae,le)=>{const ue=g.style._mergedLayers[le];return ae+(ue.hasShadowPass()&&!ue.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=g.context,S=to.shadowMapResolution,k=to.shadowMapResolution;if(this._cascades.length===0||to.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ae=0;ae<to.cascadeCount;++ae){const le=g._shadowMapDebug,ue=w.gl,pe=w.createFramebuffer(S,k,le,"texture"),Re=new o.T(w,{width:S,height:k,data:null},ue.DEPTH_COMPONENT16);if(pe.depthAttachment.set(Re.texture),le){const Oe=new o.T(w,{width:S,height:k,data:null},ue.RGBA8);pe.colorAttachment.set(Oe.texture)}this._cascades.push({framebuffer:pe,texture:Re,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bN,scale:0})}}this.shadowDirection=Iu(c);let L=0;if(i.elevation){const ae=i.elevation,le=[1e4,-1e4];ae.visibleDemTiles.filter(ue=>ue.dem).forEach(ue=>{const pe=ue.dem.tree;le[0]=Math.min(le[0],pe.minimums[0]),le[1]=Math.max(le[1],pe.maximums[0])}),le[0]!==1e4&&(L=(le[1]-le[0])*ae.exaggeration())}const F=1.5*i.cameraToCenterDistance,V=3*F,q=new Float64Array(16);for(let ae=0;ae<this._cascades.length;++ae){const le=this._cascades[ae];let ue=i.height/50,pe=1;to.cascadeCount===1?pe=V:ae===0?pe=F:(ue=F,pe=V);const[Re,Oe]=Au(i,this.shadowDirection,ue,pe,to.shadowMapResolution,L);le.scale=i.scale,le.matrix=Re,le.boundingSphereRadius=Oe,o.a6.mat4.invert(q,le.matrix),le.frustum=o.bN.fromInvProjectionMatrix(q,1,0,!0),le.far=pe}const W=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[W].far,this._cascades[W].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/to.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=to.shadowMapResolution,this._uniformValues.u_shadowmap_0=No.ShadowMap0,this._uniformValues.u_shadowmap_1=No.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const K=g.transform.elevation;for(const ae of this._groundShadowTiles){let le={min:0,max:0};if(K){const ue=K.getMinMaxForTile(ae);ue&&(le=ue)}this.addShadowReceiver(ae.toUnwrapped(),le.min,le.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,c){if(!this.enabled)return;const g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,to.shadowMapResolution,to.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){g.currentShadowCascade=w,v.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),v.clear({color:o.bz.white,depth:1});for(const S of i.order){const k=i._mergedLayers[S];if(!k.hasShadowPass()||k.isHidden(g.transform.zoom))continue;const L=i.getLayerSourceCache(k),F=L?c[L.id]:void 0;(k.type==="model"||F&&F.length)&&g.renderLayer(g,L,k,F)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,c=i.style,g=i.context,v=c.directionalLight,w=c.ambientLight;if(!v||!w)return;const S=[],k=kl(i,i.longestCutoffRange);k.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const L=lc(c,v,w),F=new Me(g.gl.LEQUAL,Me.ReadOnly,i.depthRangeFor3D);for(const V of this._groundShadowTiles){const q=V.toUnwrapped(),W=i.isTileAffectedByFog(V),K=i.getOrCreateProgram("groundShadow",{defines:S,overrideFog:W});this.setupShadows(q,K),i.uploadCommonUniforms(g,K,q,null,k);const ae={u_matrix:i.transform.calculateProjMatrix(q),u_ground_shadow_factor:L};K.draw(i,g.gl.TRIANGLES,F,wt.disabled,de.multiply,Dr.disabled,ae,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?de.unblended:de.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const c=this.painter.transform,g=c.calculatePosMatrix(i,c.worldSize);return o.a6.mat4.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(i){return o.a6.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,c,g,v=0){if(!this.enabled)return;const w=this.painter.transform,S=this.painter.context,k=S.gl,L=this._uniformValues,F=new Float64Array(16),V=w.calculatePosMatrix(i,w.worldSize);for(let q=0;q<this._cascades.length;q++)o.a6.mat4.multiply(F,this._cascades[q].matrix,V),L[q===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(F),S.activeTexture.set(k.TEXTURE0+No.ShadowMap0+q),this._cascades[q].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){const q=o.c8(i.canonical),W=2/w.tileSize*o.ab/to.shadowMapResolution,K=W*this._cascades[0].boundingSphereRadius,ae=W*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(g==="vector-tile"?1:3)/Math.pow(2,v-i.canonical.z-(1-w.zoom+Math.floor(w.zoom)));L.u_shadow_normal_offset=[q,K*le,ae*le],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(S,L)}setupShadowsFromMatrix(i,c,g=!1){if(!this.enabled)return;const v=this.painter.context,w=v.gl,S=this._uniformValues,k=new Float64Array(16);for(let L=0;L<to.cascadeCount;L++)o.a6.mat4.multiply(k,this._cascades[L].matrix,i),S[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),v.activeTexture.set(w.TEXTURE0+No.ShadowMap0+L),this._cascades[L].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=g,g){const L=to.normalOffset;S.u_shadow_normal_offset=[1,L,L],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,c,g,v){if(v[2]>=0)return{};const w=function(L,F,V){const q=V/(1<<L.canonical.z);return new o.c9([L.canonical.x*q+L.wrap*V,L.canonical.y*q+L.wrap*V,0],[(L.canonical.x+1)*q+L.wrap*V,(L.canonical.y+1)*q+L.wrap*V,F])}(i,c,g).getCorners(),S=c/-v[2];v[0]<0?(o.a6.vec3.add(w[0],w[0],[v[0]*S,0,0]),o.a6.vec3.add(w[3],w[3],[v[0]*S,0,0])):v[0]>0&&(o.a6.vec3.add(w[1],w[1],[v[0]*S,0,0]),o.a6.vec3.add(w[2],w[2],[v[0]*S,0,0])),v[1]<0?(o.a6.vec3.add(w[0],w[0],[0,v[1]*S,0]),o.a6.vec3.add(w[1],w[1],[0,v[1]*S,0])):v[1]>0&&(o.a6.vec3.add(w[2],w[2],[0,v[1]*S,0]),o.a6.vec3.add(w[3],w[3],[0,v[1]*S,0]));const k={};return k.vertices=w,k.planes=[ac(w[1],w[0],w[4]),ac(w[2],w[1],w[5]),ac(w[3],w[2],w[6]),ac(w[0],w[3],w[7])],k}addShadowReceiver(i,c,g){this._receivers.add(i,o.c9.fromTileIdAndHeight(i,c,g))}getMaxCascadeForTile(i){const c=this._receivers.get(i);return c&&c.lastCascade?c.lastCascade:0}}function ac(m,i,c){const g=o.a6.vec3.sub([],c,i),v=o.a6.vec3.sub([],m,i),w=o.a6.vec3.cross([],g,v),S=o.a6.vec3.length(w);return S===0?[0,0,1,0]:(o.a6.vec3.scale(w,w,1/S),[w[0],w[1],w[2],-o.a6.vec3.dot(w,i)])}function Iu(m){const i=m.properties.get("direction"),c=o.c7(i.x,i.y,i.z);c[2]=o.ap(c[2],0,75);const g=o.ca([c[0],c[1],c[2]]);return o.a6.vec3.fromValues(g.x,g.y,g.z)}function lc(m,i,c){const g=i.properties.get("color"),v=i.properties.get("intensity"),w=i.properties.get("direction"),S=[w.x,w.y,w.z],k=c.properties.get("color"),L=c.properties.get("intensity"),F=Math.max(o.a6.vec3.dot([0,0,1],S),0),V=[0,0,0];o.a6.vec3.scale(V,k.toRenderColor(m.getLut(i.scope)).toArray01Linear().slice(0,3),L);const q=[0,0,0];return o.a6.vec3.scale(q,g.toRenderColor(m.getLut(c.scope)).toArray01Linear().slice(0,3),F*v),o.cb([V[0]>0?V[0]/(V[0]+q[0]):0,V[1]>0?V[1]/(V[1]+q[1]):0,V[2]>0?V[2]/(V[2]+q[2]):0])}function Au(m,i,c,g,v,w){const S=m.zoom,k=m.scale,L=m.worldSize,F=1/L,V=m.aspect,q=Math.sqrt(1+V*V)*Math.tan(.5*m.fovX),W=q*q,K=g-c,ae=g+c;let le,ue;W>K/ae?(le=g,ue=g*q):(le=.5*ae*(1+W),ue=.5*Math.sqrt(K*K+2*(g*g+c*c)*W+ae*ae*W*W));const pe=m.projection.pixelsPerMeter(m.center.lat,L),Re=m._camera.getCameraToWorldMercator(),Oe=[0,0,-le*F];o.a6.vec3.transformMat4(Oe,Oe,Re);let Ae=ue*F;const Be=m._edgeInsets;if(!(Be.left===0&&Be.top===0&&Be.right===0&&Be.bottom===0||Be.left===Be.right&&Be.top===Be.bottom)){const Qt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?pe:1),tr=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,c,g);tr[8]=2*-m.centerOffset.x/m.width,tr[9]=2*m.centerOffset.y/m.height;const Nt=new Float64Array(16);o.a6.mat4.mul(Nt,tr,Qt);const Ut=new Float64Array(16);o.a6.mat4.invert(Ut,Nt);const Nr=o.bN.fromInvProjectionMatrix(Ut,L,S,!0);for(const hr of Nr.points){const Sr=((Le=hr)[0]/=k,Le[1]/=k,Le[2]=o.bD(Le[2],m._center.lat),Le);Ae=Math.max(Ae,o.a6.vec3.len(o.a6.vec3.subtract([],Oe,Sr)))}}var Le;Ae*=v/(v-1);const He=Math.acos(i[2]),je=Math.atan2(-i[0],-i[1]),Ze=new Jo;Ze.position=Oe,Ze.setPitchBearing(He,je);const rt=Ze.getWorldToCamera(L,pe),Je=Ae*L,Ye=Math.min(m._mercatorZfromZoom(17)*L*-2,-2*Je),ht=Ze.getCameraToClipOrthographic(-Je,Je,-Je,Je,Ye,(Je+w*pe)/i[2]),Ct=new Float64Array(16);o.a6.mat4.multiply(Ct,ht,rt);const Ft=o.a6.vec3.fromValues(Math.floor(1e6*Oe[0])/1e6*L,Math.floor(1e6*Oe[1])/1e6*L,0),At=.5*v,Yt=[0,0,0];o.a6.vec3.transformMat4(Yt,Ft,Ct),o.a6.vec3.scale(Yt,Yt,At);const dt=[Math.floor(Yt[0]),Math.floor(Yt[1]),Math.floor(Yt[2])],Lt=[0,0,0];o.a6.vec3.sub(Lt,Yt,dt),o.a6.vec3.scale(Lt,Lt,-1/At);const kt=new Float64Array(16);return o.a6.mat4.identity(kt),o.a6.mat4.translate(kt,kt,Lt),o.a6.mat4.multiply(Ct,kt,Ct),[Ct,Je]}class Ya extends o.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,c){return o.aG(this.requestManager.transformRequest(c,o.R.Model).url).then(g=>{if(!g)return;const v=o.aH(g),w=new o.aI(i,void 0,void 0,v);return w.computeBoundsAndApplyParent(),w}).catch(g=>{if(g&&g.status===404)return null;this.fire(new o.t(new Error(`Could not load model ${i} from ${c}: ${g.message}`)))})}load(i,c){this.models[c]||(this.models[c]={});const g=Object.keys(i);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+g.length;const v=[];for(const w of g)v.push(this.loadModel(w,i[w]));Promise.allSettled(v).then(w=>{for(let S=0;S<w.length;S++){const{status:k,value:L}=w[S];k==="fulfilled"&&L&&(this.models[c][g[S]]={model:L,numReferences:1})}this.numModelsLoading[c]-=g.length,this.fire(new o.x("data",{dataType:"style"}))}).catch(w=>{this.fire(new o.t(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,c){return!!this.getModel(i,c)}getModel(i,c){return this.models[c]||(this.models[c]={}),this.models[c][i]?this.models[c][i].model:void 0}addModel(i,c,g){this.models[g]||(this.models[g]={}),this.hasModel(i,g)&&this.models[g][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(c)},g)}addModels(i,c){this.models[c]||(this.models[c]={});const g={};for(const v in i)this.models[c][v]={},g[v]=this.requestManager.normalizeModelURL(i[v]);this.load(g,c)}addModelsFromBucket(i,c){this.models[c]||(this.models[c]={});const g={};for(const v of i)this.hasModel(v,c)?this.models[c][v].numReferences++:g[v]=this.requestManager.normalizeModelURL(v);this.load(g,c)}removeModel(i,c){if(this.models[c]&&this.models[c][i]&&(this.models[c][i].numReferences--,this.models[c][i].numReferences===0)){const g=this.models[c][i].model;delete this.models[c][i],g.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,c){this.models[c]||(this.models[c]={});for(const g in this.models[c])this.models[c][g].model&&this.models[c][g].model.upload(i.context)}}const na=new o.a0({data:new o.a1(o._.colorTheme.data)}),pa=(m,i)=>st(m,i&&i.filter(c=>c.identifier!=="source.canvas")),Th=o.ar(it,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),cc=o.ar(it,["setCenter","setZoom","setBearing","setPitch"]),ef={version:8,layers:[],sources:{}},mp={duration:300,delay:0};class ma extends o.E{constructor(i,c={}){super(),this.map=i,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=o.l({},mp),this._buildingIndex=new ea(this),this.crossTileSymbolIndex=new B,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new $e,this.dispatcher=c.dispatcher?c.dispatcher:new o.cd(o.ce(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new zt,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.cf(i._requestManager,c.localFontFamily?o.cg.all:c.localIdeographFontFamily?o.cg.ideographs:o.cg.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Ya(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.ch());const g=this;this._rtlTextPluginCallback=ma.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(w,S)=>{if(o.ci(w),S&&S.every(k=>k))for(const k in g._sourceCaches){const L=g._sourceCaches[k],F=L.getSource().type;F!=="vector"&&F!=="geojson"||L.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.getOwnSource(v.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const k=this._layers[S];k.source===w.id&&this._validateLayer(k)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(o.f(i))return i;const c=o.cj(i);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.ck(JSON.stringify(i))}`}_diffStyle(i,c,g){this.globalId=this._getGlobalId(i);const v=(w,S)=>{try{S(null,this.setState(w,g))}catch(k){S(k,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),S=this.map._requestManager.transformRequest(w,o.R.Style);o.n(S,(k,L)=>{k?this.fire(new o.t(k)):L&&v(L,c)})}else typeof i=="object"&&v(i,c)}loadURL(i,c={}){this.fire(new o.x("dataloading",{dataType:"style"}));const g=typeof c.validate=="boolean"?c.validate:!o.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,c.accessToken),this.resolvedImports.add(i);const v=this.importsCache.get(i);if(v)return this._load(v,g);const w=this.map._requestManager.transformRequest(i,o.R.Style);this._request=o.n(w,(S,k)=>{if(this._request=null,S)this.fire(new o.t(S));else if(k)return this.importsCache.set(i,k),this._load(k,g)})}loadJSON(i,c={}){this.fire(new o.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=o.q.frame(()=>{this._request=null,this._load(i,c.validate!==!1)})}loadEmpty(){this.fire(new o.x("dataloading",{dataType:"style"})),this._load(ef,!1)}_loadImports(i,c,g){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of i){const S=this._createFragmentStyle(w),k=new Promise(V=>{S.once("style.import.load",V),S.once("error",V)}).then(()=>this.mergeAll());if(v.push(k),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const L=w.data||this.importsCache.get(w.url);L?(S.loadJSON(L,{validate:c}),this._isInternalStyle(L)&&(S.globalId=null)):w.url?S.loadURL(w.url,{validate:c}):S.loadEmpty();const F={style:S,id:w.id,config:w.config};if(g){const V=this.fragments.findIndex(({id:q})=>q===g);this.fragments=this.fragments.slice(0,V).concat(F).concat(this.fragments.slice(V))}else this.fragments.push(F)}return Promise.allSettled(v)}getImportGlobalIds(i=this,c=new Set){for(const g of i.fragments)g.style.globalId&&c.add(g.style.globalId),this.getImportGlobalIds(g.style,c);return[...c.values()]}_createFragmentStyle(i){const c=this.scope?o.av(i.id,this.scope):i.id;let g;const v=this._initialConfig&&this._initialConfig[c];(i.config||v)&&(g=o.l({},i.config,v));const w=new ma(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,c){const g=i.schema;if(this._isInternalStyle(i)){const S=o.l({},ef,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(S,c)}if(this.updateConfig(this._config,g),c&&pa(this,Lo(i)))return;this._loaded=!0,this.stylesheet=o.cl(i);const v=()=>{for(const F in i.sources)this.addSource(F,i.sources[F],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const S=Oa(this.stylesheet.layers);if(this._order=S.map(F=>F.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const F=this.stylesheet.lights[0];this.light=new at(F.properties,F.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const F of S){const V=o.cq(F,this.scope,this._styleColorTheme.lut,this.options);V.configDependencies.size!==0&&this._configDependentLayers.add(V.fqid),V.setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize();const q=this.getOwnLayerSourceCache(V),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();q&&V.canCastShadows()&&W&&(q.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const k=this.stylesheet.terrain;k&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(k,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.x("data",{dataType:"style"}));const L=this.isRootStyle();i.imports?this._loadImports(i.imports,c).then(()=>{this._reloadImports(),this.fire(new o.x(L?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.x(L?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const S=this._evaluateColorThemeData(w);this._loadColorTheme(S).then(()=>{v()}).catch(k=>{o.w(`Couldn't load color theme from the stylesheet: ${k}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,c,g,v,w,S,k,L;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(V=>{if(V.stylesheet){if(V.light!=null&&(i=V.light),V.stylesheet.lights)for(const q of V.stylesheet.lights)q.type==="ambient"&&V.ambientLight!=null&&(c=V.ambientLight),q.type==="directional"&&V.directionalLight!=null&&(g=V.directionalLight);v=this._prioritizeTerrain(v,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(w=V.fog),V.stylesheet.camera!=null&&(L=V.stylesheet.camera),V.stylesheet.projection!=null&&(S=V.stylesheet.projection),V.stylesheet.transition!=null&&(k=V.stylesheet.transition),F[V.scope]=V._styleColorTheme}}),this.light=i,this.ambientLight=c,this.directionalLight=g,this.fog=w,this._styleColorThemeForScope=F,v===null?delete this.terrain:this.terrain=v,this.camera=L||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=o.l({},mp,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const c=g=>{for(const v of g.fragments)c(v.style);i(g)};c(this)}_prioritizeTerrain(i,c,g){const v=i&&i.drapeRenderMode===0;return g===null?c&&c.drapeRenderMode===0?c:v?i:null:c!=null&&(!i||v||c&&c.drapeRenderMode===1)?c:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{i=this._prioritizeTerrain(i,c.terrain,c.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(i=c.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},c={},g={};this.forEachFragmentStyle(v=>{for(const w in v._sourceCaches){const S=o.av(w,v.scope);i[S]=v._sourceCaches[w]}for(const w in v._otherSourceCaches){const S=o.av(w,v.scope);c[S]=v._otherSourceCaches[w]}for(const w in v._symbolSourceCaches){const S=o.av(w,v.scope);g[S]=v._symbolSourceCaches[w]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=g}mergeLayers(){const i={},c=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const S of w._order){const k=w._layers[S];if(k.type==="slot"){const L=o.cm(S);if(i[L])continue;i[L]=[]}k.slot&&i[k.slot]?i[k.slot].push(k):c.push(k)}}),this._mergedOrder=[];const v=(w=[])=>{for(const S of w)if(S.type==="slot"){const k=o.cm(S.id);i[k]&&v(i[k]),this._mergedSlots.push(k)}else{const k=o.av(S.id,S.scope);this._mergedOrder.push(k),g[k]=S,S.is3D()&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};v(c),this._mergedOrder.sort((w,S)=>{const k=g[w],L=g[S];return k.hasInitialOcclusionOpacityProperties?L.is3D()?1:0:k.is3D()&&L.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=o.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(c,g,v){const w=o.l({},g);for(const k of Object.keys(o._.colorTheme))w[k]===void 0&&(w[k]=o._.colorTheme[k].default);const S=new o.$(na,c,new Map(v));return S.setTransitionOrValue(w,v),S.untransitioned().possiblyEvaluate(new o.a3(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,v)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let S=i;S.startsWith(w)||(S=w+S);const k="mapbox-reserved-lut",L=new Image;L.src=S,L.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},L.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void g();this._styleColorTheme.lutLoading=!1;const{width:F,height:V,data:q}=o.q.getImageData(L);if(V>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(F!==V*V)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(k)&&this.removeImage(k),this.addImage(k,{data:new o.r({width:F,height:V},q),pixelRatio:1,sdf:!1,version:0});const W=this.imageManager.getImage(k,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:i},g()):v(new Error("Missing LUT image."))}})}getLut(i){const c=this._styleColorThemeForScope[i];return c?c.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(c,g,v){let w,S,k;const L=o.q.devicePixelRatio>1?"@2x":"";let F=o.n(g.transformRequest(g.normalizeSpriteURL(c,L,".json"),o.R.SpriteJSON),(W,K)=>{F=null,k||(k=W,w=K,q())}),V=o.o(g.transformRequest(g.normalizeSpriteURL(c,L,".png"),o.R.SpriteImage),(W,K)=>{V=null,k||(k=W,S=K,q())});function q(){if(k)v(k);else if(w&&S){const W=o.q.getImageData(S),K={};for(const ae in w){const{width:le,height:ue,x:pe,y:Re,sdf:Oe,pixelRatio:Ae,stretchX:Be,stretchY:Le,content:He}=w[ae],je=new o.r({width:le,height:ue});o.r.copy(W,je,{x:pe,y:Re},{x:0,y:0},{width:le,height:ue},null),K[ae]={data:je,pixelRatio:Ae,sdf:Oe,stretchX:Be,stretchY:Le,content:He}}v(null,K)}}return{cancel(){F&&(F.cancel(),F=null),V&&(V.cancel(),V=null)}}}(i,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new o.t(c));else if(g)for(const v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.x("data",{dataType:"style"}))})}_validateLayer(i){const c=this.getOwnSource(i.source);if(!c)return;const g=i.sourceLayer;g&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.t(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,c)=>{const g=this.fragments[c];return g&&g.style&&(i.data=g.style.serialize()),i})}_serializeSources(){const i={};for(const c in this._sourceCaches){const g=this._sourceCaches[c].getSource();i[g.id]||(i[g.id]=g.serialize())}return i}_serializeLayers(i){const c=[];for(const g of i){const v=this._layers[g];v&&v.type!=="custom"&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const c=this.getOwnLayer(i);if(c)return c;this.fire(new o.t(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const c=this.getOwnSource(i);if(c)return c;this.fire(new o.t(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,c){const g=this.map.painter;if(g)for(let v=i.minzoom||0;v<(i.maxzoom||25.5);v++){const w=i.getProgramIds();if(w)for(const S of w){const k=i.getDefaultProgramParams(S,c.zoom,this._styleColorTheme.lut);k&&(g.style=this,this.fog&&(g._fogVisible=!0,k.overrideFog=!0,g.getOrCreateProgram(S,k)),g._fogVisible=!1,k.overrideFog=!1,g.getOrCreateProgram(S,k),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(k.overrideRtt=!0,g.getOrCreateProgram(S,k)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const c=this.calculateLightsBrightness();i.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const g=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const k in S){const{updatedIds:L,removedIds:F}=S[k];(L||F)&&(this._updateWorkerLayers(k,L,F),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const w={};for(const S in this._mergedSourceCaches){const k=this._mergedSourceCaches[S];w[S]=k.used,k.used=!1,k.tileCoverLift=0}for(const S of this._mergedOrder){const k=this._mergedLayers[S];if(k.recalculate(i,this._availableImages),!k.isHidden(i.zoom)){const L=this.getLayerSourceCache(k);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,k.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(k,i)}):this.precompilePrograms(k,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();for(const S in w){const k=this._mergedSourceCaches[S];w[S]!==k.used&&k.getSource().fire(new o.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:k.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new o.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,c,g){const v=this.getFragmentStyle(i);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:i,removedIds:g||[],options:v.options})}setState(i,c){if(this._checkLoaded(),pa(this,Lo(i)))return!1;(i=o.cl(i)).layers=Oa(i.layers);const g=function(S,k){if(!S)return[{command:it.setStyle,args:[k]}];let L=[];try{if(!o.bh(S.version,k.version))return[{command:it.setStyle,args:[k]}];if(o.bh(S.center,k.center)||L.push({command:it.setCenter,args:[k.center]}),o.bh(S.zoom,k.zoom)||L.push({command:it.setZoom,args:[k.zoom]}),o.bh(S.bearing,k.bearing)||L.push({command:it.setBearing,args:[k.bearing]}),o.bh(S.pitch,k.pitch)||L.push({command:it.setPitch,args:[k.pitch]}),o.bh(S.sprite,k.sprite)||L.push({command:it.setSprite,args:[k.sprite]}),o.bh(S.glyphs,k.glyphs)||L.push({command:it.setGlyphs,args:[k.glyphs]}),o.bh(S.imports,k.imports)||function(K=[],ae=[],le){ae=ae||[];const ue=(K=K||[]).map(Bi),pe=ae.map(Bi),Re=K.reduce(ai,{}),Oe=ae.reduce(ai,{}),Ae=ue.slice();let Be,Le,He,je;for(Be=0,Le=0;Be<ue.length;Be++)He=ue[Be],Oe.hasOwnProperty(He)?Le++:(le.push({command:it.removeImport,args:[He]}),Ae.splice(Ae.indexOf(He,Le),1));for(Be=0,Le=0;Be<pe.length;Be++)He=pe[pe.length-1-Be],Ae[Ae.length-1-Be]!==He&&(Re.hasOwnProperty(He)?(le.push({command:it.removeImport,args:[He]}),Ae.splice(Ae.lastIndexOf(He,Ae.length-Le),1)):Le++,je=Ae[Ae.length-Be],le.push({command:it.addImport,args:[Oe[He],je]}),Ae.splice(Ae.length-Be,0,He));for(const Ze of ae){const rt=Re[Ze.id];rt&&!o.bh(rt,Ze)&&le.push({command:it.updateImport,args:[Ze.id,Ze]})}}(S.imports,k.imports,L),o.bh(S.transition,k.transition)||L.push({command:it.setTransition,args:[k.transition]}),o.bh(S.light,k.light)||L.push({command:it.setLight,args:[k.light]}),o.bh(S.fog,k.fog)||L.push({command:it.setFog,args:[k.fog]}),o.bh(S.projection,k.projection)||L.push({command:it.setProjection,args:[k.projection]}),o.bh(S.lights,k.lights)||L.push({command:it.setLights,args:[k.lights]}),o.bh(S.camera,k.camera)||L.push({command:it.setCamera,args:[k.camera]}),!o.bh(S["color-theme"],k["color-theme"]))return[{command:it.setStyle,args:[k]}];const F={},V=[];(function(K,ae,le,ue){let pe;for(pe in ae=ae||{},K=K||{})K.hasOwnProperty(pe)&&(ae.hasOwnProperty(pe)||Zt(pe,le,ue));for(pe in ae){if(!ae.hasOwnProperty(pe))continue;const Re=ae[pe];K.hasOwnProperty(pe)?o.bh(K[pe],Re)||(K[pe].type==="geojson"&&Re.type==="geojson"&&vr(K,ae,pe)?le.push({command:it.setGeoJSONSourceData,args:[pe,Re.data]}):vn(pe,ae,le,ue)):Ht(pe,ae,le)}})(S.sources,k.sources,V,F);const q=[];S.layers&&S.layers.forEach(K=>{K.source&&F[K.source]?L.push({command:it.removeLayer,args:[K.id]}):q.push(K)});let W=S.terrain;W&&F[W.source]&&(L.push({command:it.setTerrain,args:[void 0]}),W=void 0),L=L.concat(V),o.bh(W,k.terrain)||L.push({command:it.setTerrain,args:[k.terrain]}),function(K,ae,le){ae=ae||[];const ue=(K=K||[]).map(Bi),pe=ae.map(Bi),Re=K.reduce(ai,{}),Oe=ae.reduce(ai,{}),Ae=ue.slice(),Be=Object.create(null);let Le,He,je,Ze,rt,Je,Ye;for(Le=0,He=0;Le<ue.length;Le++)je=ue[Le],Oe.hasOwnProperty(je)?He++:(le.push({command:it.removeLayer,args:[je]}),Ae.splice(Ae.indexOf(je,He),1));for(Le=0,He=0;Le<pe.length;Le++)je=pe[pe.length-1-Le],Ae[Ae.length-1-Le]!==je&&(Re.hasOwnProperty(je)?(le.push({command:it.removeLayer,args:[je]}),Ae.splice(Ae.lastIndexOf(je,Ae.length-He),1)):He++,Je=Ae[Ae.length-Le],le.push({command:it.addLayer,args:[Oe[je],Je]}),Ae.splice(Ae.length-Le,0,je),Be[je]=!0);for(Le=0;Le<pe.length;Le++)if(je=pe[Le],Ze=Re[je],rt=Oe[je],!Be[je]&&!o.bh(Ze,rt))if(o.bh(Ze.source,rt.source)&&o.bh(Ze["source-layer"],rt["source-layer"])&&o.bh(Ze.type,rt.type)){for(Ye in pi(Ze.layout,rt.layout,le,je,null,it.setLayoutProperty),pi(Ze.paint,rt.paint,le,je,null,it.setPaintProperty),o.bh(Ze.slot,rt.slot)||le.push({command:it.setSlot,args:[je,rt.slot]}),o.bh(Ze.filter,rt.filter)||le.push({command:it.setFilter,args:[je,rt.filter]}),o.bh(Ze.minzoom,rt.minzoom)&&o.bh(Ze.maxzoom,rt.maxzoom)||le.push({command:it.setLayerZoomRange,args:[je,rt.minzoom,rt.maxzoom]}),Ze)Ze.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?pi(Ze[Ye],rt[Ye],le,je,Ye.slice(6),it.setPaintProperty):o.bh(Ze[Ye],rt[Ye])||le.push({command:it.setLayerProperty,args:[je,Ye,rt[Ye]]}));for(Ye in rt)rt.hasOwnProperty(Ye)&&!Ze.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?pi(Ze[Ye],rt[Ye],le,je,Ye.slice(6),it.setPaintProperty):o.bh(Ze[Ye],rt[Ye])||le.push({command:it.setLayerProperty,args:[je,Ye,rt[Ye]]}))}else le.push({command:it.removeLayer,args:[je]}),Je=Ae[Ae.lastIndexOf(je)+1],le.push({command:it.addLayer,args:[rt,Je]})}(q,k.layers,L)}catch(F){console.warn("Unable to compute style diff:",F),L=[{command:it.setStyle,args:[k]}]}return L}(this.serialize(),i).filter(S=>!(S.command in cc));if(g.length===0)return!1;const v=g.filter(S=>!(S.command in Th));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);const w=[];return g.forEach(S=>{w.push(this[S.command].apply(this,S.args))}),c&&Promise.all(w).then(c),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,c){return this.getImage(i)?this.fire(new o.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,c),this._afterImageUpdated(i),this)}updateImage(i,c){this.imageManager.updateImage(i,this.scope,c)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new o.t(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,c,g={}){return this._checkLoaded(),this._validate(Ke,`models.${i}`,c,null,g)||(this.modelManager.addModel(i,c,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new o.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,c,g={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(jo,`sources.${i}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const v=Bo(i,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const w=S=>{const k=(S?"symbol:":"other:")+v.id,L=o.av(k,this.scope),F=this._sourceCaches[k]=new Ji(L,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=F,F.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const c=this.getOwnSource(i);if(!c)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===i)return this.fire(new o.t(new Error(`Source "${i}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new o.t(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const g=this.getOwnSourceCaches(i);for(const v of g){const w=o.cm(v.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(v.id),v.fire(new o.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getOwnSource(i).setData(c),this._changes.setDirty()}getOwnSource(i){const c=this.getOwnSourceCache(i);return c&&c.getSource()}getOwnSources(){const i=[];for(const c in this._otherSourceCaches){const g=this.getOwnSourceCache(c);g&&i.push(g.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const c in i){const g=i[c]._tiles;for(const v in g){const w=g[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const v of i){if(this._validate(Is,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(v),w.updateTransitions(c)}else this.ambientLight=new Tn(v,Yr||(Yr=new o.a0({color:new o.a1(o._.properties_light_ambient.color),intensity:new o.a1(o._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(v),w.updateTransitions(c)}else this.directionalLight=new Tn(v,On||(On=new o.a0({direction:new o.ad(o._.properties_light_directional.direction),color:new o.a1(o._.properties_light_directional.color),intensity:new o.a1(o._.properties_light_directional.intensity),"cast-shadows":new o.a1(o._.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.a1(o._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const g=new o.a3(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,c=this.ambientLight;if(!i||!c)return;const g=q=>.2126*(q[0]<=.03928?q[0]/12.92:Math.pow((q[0]+.055)/1.055,2.4))+.7152*(q[1]<=.03928?q[1]/12.92:Math.pow((q[1]+.055)/1.055,2.4))+.0722*(q[2]<=.03928?q[2]/12.92:Math.pow((q[2]+.055)/1.055,2.4)),v=i.properties.get("color").toRenderColor(null).toArray01(),w=i.properties.get("intensity"),S=i.properties.get("direction"),k=1-o.c7(S.x,S.y,S.z)[2]/90,L=g(v)*w*k,F=c.properties.get("color").toRenderColor(null).toArray01(),V=c.properties.get("intensity");return(L+g(F)*V)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(o.cn(i)){const c=o.co(i),g=this.fragments.find(({id:w})=>w===c);if(!g)throw new Error(`Style import not found: ${i}`);const v=o.cm(i);return g.style.getFragmentStyle(v)}{const c=this.fragments.find(({id:g})=>g===i);if(!c)throw new Error(`Style import not found: ${i}`);return c.style}}getConfigProperty(i,c){const g=this.getFragmentStyle(i);if(!g)return null;const v=o.av(c,g.scope),w=g.options.get(v),S=w?w.value||w.default:null;return S?S.serialize():null}setConfigProperty(i,c,g){const v=this.getFragmentStyle(i);if(!v)return;const w=v.stylesheet.schema;if(!w||!w[c])return;const S=o.M(g);if(S.result!=="success")return void pa(this,S.value);const k=S.value.expression,L=o.av(c,v.scope),F=v.options.get(L);if(!F)return;let V;const{minValue:q,maxValue:W,stepValue:K,type:ae,values:le}=w[c],ue=o.M(w[c].default);ue.result==="success"&&(V=ue.value.expression),V?(this.options.set(L,{...F,value:k,default:V,minValue:q,maxValue:W,stepValue:K,type:ae,values:le}),this.updateConfigDependencies(c)):this.fire(new o.t(new Error(`No schema defined for the config option "${c}" in the "${i}" fragment.`)))}getConfig(i){const c=this.getFragmentStyle(i);if(!c)return null;const g=c.stylesheet.schema;if(!g)return null;const v={};for(const w in g){const S=o.av(w,c.scope),k=c.options.get(S),L=k?k.value||k.default:null;v[w]=L?L.serialize():null}return v}setConfig(i,c){const g=this.getFragmentStyle(i);g&&(g.updateConfig(c,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const c=this.getFragmentStyle(i);return c?c.stylesheet.schema:null}setSchema(i,c){const g=this.getFragmentStyle(i);g&&(g.stylesheet.schema=c,g.updateConfig(g._config,c),this.updateConfigDependencies())}updateConfig(i,c){if(this._config=i,i||c)if(c)for(const g in c){let v,w;const S=o.M(c[g].default);if(S.result==="success"&&(v=S.value.expression),i&&i[g]!==void 0){const W=o.M(i[g]);W.result==="success"&&(w=W.value.expression)}const{minValue:k,maxValue:L,stepValue:F,type:V,values:q}=c[g];if(v){const W=o.av(g,this.scope);this.options.set(W,{default:v,value:w,minValue:k,maxValue:L,stepValue:F,type:V,values:q})}else this.fire(new o.t(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new o.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const c of this._configDependentLayers){const g=this.getLayer(c);if(g){if(i&&!g.configDependencies.has(i))continue;g.possiblyEvaluateVisibility(),this._updateLayer(g)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(c=>{if(c._styleColorTheme.colorTheme){const g=c._evaluateColorThemeData(c._styleColorTheme.colorTheme);(!c._styleColorTheme.lut&&g!==""||c._styleColorTheme.lut&&g!==c._styleColorTheme.lut.data)&&c.setColorTheme(c._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,c,g={}){this._checkLoaded();const v=i.id;if(this._layers[v])return void this.fire(new o.t(new Error(`Layer with id "${v}" already exists on this map`)));let w;if(i.type==="custom"){if(pa(this,o.cp(i)))return;w=o.cq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(v,i.source),i=o.cl(i),i=o.l(i,{source:v})),this._validate(pt,`layers.${v}`,i,{arrayIndex:-1},g))return;w=o.cq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[w.id]=w.serialize()}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let S=this._order.length;if(c){const V=this._order.indexOf(c);if(V===-1)return void this.fire(new o.t(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?S=V:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=w;const k=this.getOwnLayerSourceCache(w),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&w.canCastShadows()&&L&&(k.castsShadows=!0);const F=this._changes.getRemovedLayer(w);if(F&&w.source&&k&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const V=o.av(w.source,w.scope);F.type!==w.type?this._changes.updateSourceCache(V,"clear"):(this._changes.updateSourceCache(V,"reload"),k.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,c){this._checkLoaded();const g=this._checkLayer(i);if(!g||i===c)return;const v=this._order.indexOf(i);this._order.splice(v,1);let w=this._order.length;if(c){const S=this._order.indexOf(c);if(S===-1)return void this.fire(new o.t(new Error(`Layer with id "${c}" does not exist on this map.`)));g.slot===this._layers[c].slot?w=S:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const c=this._checkLayer(i);if(!c)return;c.setEventedParent(null);const g=this._order.indexOf(i);this._order.splice(g,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let w=!1;for(const S in this._layers)if(this._layers[S].source===c.source&&this._layers[S].canCastShadows()){w=!0;break}v.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,g){this._checkLoaded();const v=this._checkLayer(i);v&&(v.minzoom===c&&v.maxzoom===g||(c!=null&&(v.minzoom=c),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,c){this._checkLoaded();const g=this._checkLayer(i);g&&g.slot!==c&&(g.slot=c,this._updateLayer(g))}setFilter(i,c,g={}){this._checkLoaded();const v=this._checkLayer(i);if(v&&!o.bh(v.filter,c))return c==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(fe,`layers.${v.id}.filter`,c,{layerType:v.type},g)||(v.filter=o.cl(c),this._updateLayer(v)))}getFilter(i){const c=this._checkLayer(i);if(c)return o.cl(c.filter)}setLayoutProperty(i,c,g,v={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!o.bh(w.getLayoutProperty(c),g)){if(g!=null&&(!v||v.validate!==!1)&&pa(w,Ne.call(Lo,{key:`layers.${i}.layout.${c}`,layerType:w.type,objectKey:c,value:g,styleSpec:o._,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,g),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,c){const g=this._checkLayer(i);if(g)return g.getLayoutProperty(c)}setPaintProperty(i,c,g,v={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||o.bh(w.getPaintProperty(c),g)||g!=null&&(!v||v.validate!==!1)&&pa(w,xe.call(Lo,{key:`layers.${i}.paint.${c}`,layerType:w.type,objectKey:c,value:g,styleSpec:o._})))return;const S=w.setPaintProperty(c,g);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),S&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,c){const g=this._checkLayer(i);if(g)return g.getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();const g=i.source,v=i.sourceLayer,w=this._checkSource(g);if(!w)return;const S=w.type;if(S==="geojson"&&v)return void this.fire(new o.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided.")));const k=this.getOwnSourceCaches(g);for(const L of k)L.setFeatureState(v,i.id,c)}removeFeatureState(i,c){this._checkLoaded();const g=i.source,v=this._checkSource(g);if(!v)return;const w=v.type,S=w==="vector"?i.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new o.t(new Error("A feature id is required to remove its specific state property.")));const k=this.getOwnSourceCaches(g);for(const L of k)L.removeFeatureState(S,i.id,c)}getFeatureState(i){this._checkLoaded();const c=i.source,g=i.sourceLayer,v=this._checkSource(c);if(v){if(v.type!=="vector"||g)return i.id===void 0&&this.fire(new o.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(g,i.id);this.fire(new o.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=o.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return o.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),c=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return o.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const c=this.getLayerSourceCache(i),g=o.av(i.source,i.scope),v=this._changes.getUpdatedSourceCaches();i.source&&!v[g]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),c.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const c=k=>this._mergedLayers[k].is3D(),g=this.order,v={},w=[];for(let k=g.length-1;k>=0;k--){const L=g[k];if(c(L)){v[L]=k;for(const F of i){const V=F[L];if(V)for(const q of V)w.push(q)}}}w.sort((k,L)=>L.intersectionZ-k.intersectionZ);const S=[];for(let k=g.length-1;k>=0;k--){const L=g[k];if(c(L))for(let F=w.length-1;F>=0;F--){const V=w[F].feature;if(V.layer&&v[V.layer.id]<k)break;S.push(V),w.pop()}else for(const F of i){const V=F[L];if(V)for(const q of V)S.push(q.feature)}}return S}queryRenderedFeatures(i,c,g){c&&c.filter&&this._validate(fe,"queryRenderedFeatures.filter",c.filter,null,c),c.scope=this.scope,c.availableImages=this._availableImages,c.serializedLayers=this._serializedLayers;const v={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.t(new Error("parameters.layers must be an Array."))),[];for(const F of c.layers){const V=this._mergedLayers[F];if(!V)return this.fire(new o.t(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];v[V.source]=!0}}const w=[],S=c.serializedLayers||{},k=c&&c.layers?c.layers.some(F=>{const V=this.getLayer(F);return V&&V.is3D()}):this.has3DLayers(),L=Qn.createFromScreenPoints(i,g);for(const F in this._mergedSourceCaches){const V=this._mergedSourceCaches[F].getSource();if(!V||V.scope!==c.scope)continue;const q=this._mergedSourceCaches[F].getSource().id;c.layers&&!v[q]||w.push(la(this._mergedSourceCaches[F],this._mergedLayers,S,L,c,g,k,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(F,V,q,W,K,ae,le){const ue={},pe=ae.queryRenderedSymbols(W),Re=[];for(const Oe of Object.keys(pe).map(Number))Re.push(le[Oe]);Re.sort(Ys);for(const Oe of Re){const Ae=Oe.featureIndex.lookupSymbolFeatures(pe[Oe.bucketInstanceId],V,Oe.bucketIndex,Oe.sourceLayerIndex,K.filter,K.layers,K.availableImages,F);for(const Be in Ae){const Le=ue[Be]=ue[Be]||[],He=Ae[Be];He.sort((je,Ze)=>{const rt=Oe.featureSortOrder;if(rt){const Je=rt.indexOf(je.featureIndex);return rt.indexOf(Ze.featureIndex)-Je}return Ze.featureIndex-je.featureIndex});for(const je of He)Le.push(je)}}for(const Oe in ue)ue[Oe].forEach(Ae=>{const Be=Ae.feature,Le=q(F[Oe]);if(!Le)return;const He=Le.getFeatureState(Be.layer["source-layer"],Be.id);Be.source=Be.layer.source,Be.layer["source-layer"]&&(Be.sourceLayer=Be.layer["source-layer"]),Be.state=He});return ue}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),L.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,c){c&&c.filter&&this._validate(fe,"querySourceFeatures.filter",c.filter,null,c);const g=this.getOwnSourceCaches(i);let v=[];for(const w of g)v=v.concat(ca(w,c));return v}addSourceType(i,c,g){return ma.getSourceType(i)?g(new Error(`A source type called "${i}" already exists.`)):(ma.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,c,g={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const k in i)if(!o.bh(i[k],v[k])){w=!0;break}if(!w)return;const S=this._getTransitionParameters();this.light.setLight(i,c,g),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,c=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=i;const v=i.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof g.source=="object"){const k="terrain-dem-src";this.addSource(k,g.source),g=o.cl(g),g=o.l(g,{source:k})}const w=o.l({},g),S={};if(this.terrain&&v){w.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(S.style=k.serialize())}if(this._validate(Ks,"terrain",w,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,c),this.fire(new o.x("data",{dataType:"style"}))}else{const w=this.terrain,S=w.get();for(const k of Object.keys(o._.terrain))!g.hasOwnProperty(k)&&o._.terrain[k].default&&(g[k]=o._.terrain[k].default);for(const k in i)if(!o.bh(i[k],S[k])){w.set(i,this.options),this.stylesheet.terrain=i;const L=this._getTransitionParameters({duration:0});w.updateTransitions(L),this.fire(new o.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const c=this.fog=new yn(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!o.bh(c.get(),i)){c.set(i,this.options),this.stylesheet.fog=c.get();const g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const c=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void c();const g=this._evaluateColorThemeData(i);this._loadColorTheme(g).then(()=>{this.fire(new o.x("colorthemeset")),c()}).catch(v=>{o.w(`Couldn't set color theme: ${v}`)})}_getTransitionParameters(i){return{now:o.q.now(),transition:o.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],c=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?i.push(g):c.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i,c){const g=this.terrain=new St(i,c,this.scope,this.options);c===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="symbol"&&this._updateLayer(c)}}_validate(i,c,g,v,w={}){if(w&&w.validate===!1)return!1;const S=o.l({},this.serialize());return pa(this,i.call(Lo,o.l({key:c,style:S,value:g,styleSpec:o._},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const c=this.getSourceCaches(i);for(const g of c)g.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const c=this.getSourceCaches(i);for(const g of c)g.resume(),g.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let c;this.directionalLight&&(c=Iu(this.directionalLight));for(const g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(i,void 0,void 0,c)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const c=this._sourceCaches[i];c.resume(),c.reload()}}_updatePlacement(i,c,g,v,w,S,k=!1){let L=!1,F=!1;const V={},q={};for(const W of this._mergedOrder){const K=this._mergedLayers[W];if(K.type!=="symbol")continue;const ae=o.av(K.source,K.scope);let le=V[ae];if(!le){const pe=this.getLayerSourceCache(K);if(!pe)continue;const Re=pe.getRenderableIds(!0).map(Oe=>pe.getTileByID(Oe));q[ae]=Re.slice(),le=V[ae]=Re.sort((Oe,Ae)=>Ae.tileID.overscaledZ-Oe.tileID.overscaledZ||(Oe.tileID.isLessThan(Ae.tileID)?-1:1))}const ue=this.crossTileSymbolIndex.addLayer(K,le,c.center.lng,c.projection);L=L||ue}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),k=k||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.x("neworder")),(k||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),c.zoom))&&(this.pauseablePlacement=new Xa(c,this._mergedOrder,k,g,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,V,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),F=!0),L&&this.pauseablePlacement.placement.setStale()),F||L){this._buildingIndex.onNewFrame(c.zoom);for(let W=0;W<this._mergedOrder.length;W++){const K=this._mergedLayers[this._mergedOrder[W]];if(K.type!=="symbol")continue;const ae=this.isLayerClipped(K);this.placement.updateLayerOpacities(K,V[o.av(K.source,K.scope)],W,ae?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,c){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:w})=>w===i.id)!==-1)return void this.fire(new o.t(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!c)return g.push(i),this._loadImports([i],!0);const v=g.findIndex(({id:w})=>w===c);return v===-1&&this.fire(new o.t(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,v).concat(i).concat(g.slice(v)),this._loadImports([i],!0,c)}updateImport(i,c){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(i);return v===-1?this:typeof c=="string"?(this.setImportUrl(i,c),this):(c.url&&c.url!==g[v].url&&this.setImportUrl(i,c.url),o.bh(c.config,g[v].config)||this.setImportConfig(i,c.config),o.bh(c.data,g[v].data)||this.setImportData(i,c.data),this)}moveImport(i,c){this._checkLoaded();let g=this.stylesheet.imports||[];const v=this.getImportIndex(i);if(v===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const S=g[v],k=this.fragments[v];return g=g.filter(({id:L})=>L!==i),this.fragments=this.fragments.filter(({id:L})=>L!==i),this.stylesheet.imports=g.slice(0,w).concat(S).concat(g.slice(w)),this.fragments=this.fragments.slice(0,w).concat(k).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,c){this._checkLoaded();const g=this.stylesheet.imports||[],v=this.getImportIndex(i);if(v===-1)return this;g[v].url=c;const w=this.fragments[v];return w.style=this._createFragmentStyle(g[v]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(c),this}setImportData(i,c){this._checkLoaded();const g=this.getImportIndex(i),v=this.stylesheet.imports||[];return g===-1?this:c?(this.fragments[g].style.setState(c),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(i,v[g].url))}setImportConfig(i,c){this._checkLoaded();const g=this.getImportIndex(i),v=this.stylesheet.imports||[];if(g===-1)return this;c?v[g].config=c:delete v[g].config;const w=this.fragments[g],S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=c,w.style.updateConfig(c,S),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const c=this.stylesheet.imports||[],g=this.getImportIndex(i);g!==-1&&(c.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(i){const c=(this.stylesheet.imports||[]).findIndex(g=>g.id===i);return c===-1&&this.fire(new o.t(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),c}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const c in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[c];g&&i.push(g.getSource())}return i}getSource(i,c){const g=this.getSourceCache(i,c);return g&&g.getSource()}getLayerSource(i){const c=this.getLayerSourceCache(i);return c&&c.getSource()}getSourceCache(i,c){const g=o.av(i,c);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(i){const c=o.av(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[i]&&c.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&c.push(this._mergedSymbolSourceCaches[i]),c}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const c in i){const g=i[c];g==="reload"?this.reloadSource(c):g==="clear"&&this.clearSource(c)}}updateLayers(i){const c=this._changes.getUpdatedPaintProperties();for(const g of c){const v=this.getLayer(g);v&&v.updateTransitions(i)}}getImages(i,c,g){this.imageManager.getImages(c.icons,c.scope,g),this._updateTilesForChangedImages();const v=w=>{w&&w.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(i,c,g){this.glyphManager.getGlyphs(c.stacks,c.scope,g)}getResource(i,c,g){return o.ct(c,g)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}_isSourceCacheLoaded(i){const c=this.getOwnSourceCaches(i);return c.length===0?(this.fire(new o.t(new Error(`There is no source with ID '${i}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,c){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const g=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(g||c&&c.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ma.getSourceType=function(m){return Ma[m]},ma.setSourceType=function(m,i){Ma[m]=i},ma.registerForPluginStateChange=o.cc;var gp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,tf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,rf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Eh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",nf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,of=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Sh=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_p=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,sf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Hl=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ga=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Cu=[];Wl(gp,Cu),Wl(rf,Cu),Wl(tf,Cu);const Ru={"_prelude_fog.vertex.glsl":of,"_prelude_terrain.vertex.glsl":nf,"_prelude_shadow.vertex.glsl":Hl,"_prelude_fog.fragment.glsl":Sh,"_prelude_shadow.fragment.glsl":ga,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_p,"_prelude_raster_particle.glsl":sf},uc={};Ln("",nf),Ln(Sh,of),Ln(ga,Hl),Ln(_p,""),Ln(sf,"");const Uc=Ln(tf,rf),Pu=gp;var Ol={background:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ln("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ln(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ln("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ln("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ln(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ln(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ln(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ln("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ln("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ln(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ln("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ln(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Eh),skyboxGradient:Ln(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Eh),skyboxCapture:Ln(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ln(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ln(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Ln("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Wl(m,i){const c=m.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of c)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const w of v)i.includes(w)||i.push(w)}}function Ln(m,i){const c=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(F=>{const V=F.split(" ");return V[V.length-1]}),v=[...new Set(v)]);const w={},S=[],k=[];if(m=m.replace(c,(F,V)=>(k.push(V),"")),(i=i.replace(c,(F,V)=>(S.push(V),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...Cu];Wl(m,L),Wl(i,L);for(const F of[...S,...k])Ru[F]||console.error(`Undefined include: ${F}`),uc[F]||(uc[F]=[],Wl(Ru[F],uc[F])),L=[...L,...uc[F]];return{fragmentSource:m=m.replace(g,(F,V,q,W,K)=>(w[K]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${q} ${W} ${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:V==="initialize"?`
#ifdef HAS_UNIFORM_u_${K}
    ${q} ${W} ${K} = u_${K};
#endif
`:V==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${q} ${W} ${K};
#endif
`:V==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(g,(F,V,q,W,K)=>{const ae=W==="float"?"vec2":W,le=K.match(/color/)?"color":ae;return V==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${K}
in ${q} ${W} a_${K};
#endif
`:w[K]?V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${q} ${ae} a_${K};
out ${q} ${W} ${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:V==="initialize"?le==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${q} ${W} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = unpack_mix_${le}(a_${K}, u_${K}_t);
#else
    ${q} ${W} ${K} = u_${K};
#endif
`:V==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${q} ${W} a_${K};
    out ${q} ${W} ${K};
#endif
`:V==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${K} = a_${K};
#endif
`:void 0:V==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
in ${q} ${ae} a_${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:V==="define-instanced"?le==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${K}0;
in vec4 a_${K}1;
in vec4 a_${K}2;
in vec4 a_${K}3;
#else
uniform ${q} ${W} u_${K};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${q} ${ae} a_${K};
#else
uniform ${q} ${W} u_${K};
#endif
`:V==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${q} ${W} ${K} = a_${K};
#endif
`:le==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${q} ${W} ${K} = a_${K};
#else
    ${q} ${W} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    ${q} ${W} ${K} = unpack_mix_${le}(a_${K}, u_${K}_t);
#else
    ${q} ${W} ${K} = u_${K};
#endif
`}),staticAttributes:v,usedDefines:L,vertexIncludes:S,fragmentIncludes:k}}class jc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,c,g,v,w,S,k,L){this.context=i;let F=this.boundPaintVertexBuffers.length!==v.length;for(let q=0;!F&&q<v.length;q++)this.boundPaintVertexBuffers[q]!==v[q]&&(F=!0);let V=this.boundDynamicVertexBuffers.length!==k.length;for(let q=0;!V&&q<k.length;q++)this.boundDynamicVertexBuffers[q]!==k[q]&&(V=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||F||V||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(c,g,v,w,S,k,L);else{i.bindVertexArrayOES.set(this.vao);for(const q of k)q&&(q.bind(),L&&q.instanceCount&&q.setVertexAttribDivisor(i.gl,c,L));w&&w.dynamicDraw&&w.bind()}}freshBind(i,c,g,v,w,S,k){const L=i.numAttributes,F=this.context,V=F.gl;this.vao&&this.destroy(),this.vao=F.gl.createVertexArray(),F.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S,c.enableAttributes(V,i),c.bind(),c.setVertexAttribPointers(V,i,w);for(const q of g)q.enableAttributes(V,i),q.bind(),q.setVertexAttribPointers(V,i,w);for(const q of S)q&&(q.enableAttributes(V,i),q.bind(),q.setVertexAttribPointers(V,i,w),k&&q.instanceCount&&q.setVertexAttribDivisor(V,i,k));v&&v.bind(),F.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $c(m,i){const c=Math.pow(2,i.canonical.z),g=i.canonical.y;return[new o.a5(0,g/c).toLngLat().lat,new o.a5(0,(g+1)/c).toLngLat().lat]}function Mu(m,i,c,g,v,w,S){const k=m.context,L=k.gl,F=c.hillshadeFBO;if(!F)return;m.prepareDrawTile();const V=m.isTileAffectedByFog(i),q=m.getOrCreateProgram("hillshade",{overrideFog:V});k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get());const W=((ue,pe,Re,Oe)=>{const Ae=Re.paint.get("hillshade-shadow-color"),Be=Re.paint.get("hillshade-highlight-color"),Le=Re.paint.get("hillshade-accent-color"),He=Re.paint.get("hillshade-emissive-strength");let je=o.bB(Re.paint.get("hillshade-illumination-direction"));if(Re.paint.get("hillshade-illumination-anchor")==="viewport")je-=ue.transform.angle;else if(ue.style&&ue.style.enable3dLights()&&ue.style.directionalLight){const rt=ue.style.directionalLight.properties.get("direction"),Je=o.c7(rt.x,rt.y,rt.z);je=o.bB(Je[1])}const Ze=!ue.options.moving;return{u_matrix:Oe||ue.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),Ze),u_image:0,u_latrange:$c(0,pe.tileID),u_light:[Re.paint.get("hillshade-exaggeration"),je],u_shadow:Ae.toRenderColor(Re.lut),u_highlight:Be.toRenderColor(Re.lut),u_emissive_strength:He,u_accent:Le.toRenderColor(Re.lut)}})(m,c,g,m.terrain?i.projMatrix:null);m.uploadCommonUniforms(k,q,i.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:ae,tileBoundsSegments:le}=m.getTileBoundsBuffers(c);q.draw(m,L.TRIANGLES,v,w,S,Dr.disabled,W,g.id,K,ae,le)}function Ih(m,i,c){if(!i.needsDEMTextureUpload)return;const g=m.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||m.getTileTexture(c.stride);const w=c.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new o.T(g,w,v.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ku(m,i,c){const g=m.context,v=g.gl;if(!i.dem)return;const w=i.dem;if(g.activeTexture.set(v.TEXTURE1),Ih(m,i,w),!i.demTexture)return;i.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const S=w.dim;g.activeTexture.set(v.TEXTURE0);let k=i.hillshadeFBO;if(!k){const W=new o.T(g,{width:S,height:S,data:null},v.RGBA8);W.bind(v.LINEAR,v.CLAMP_TO_EDGE),k=i.hillshadeFBO=g.createFramebuffer(S,S,!0,"renderbuffer"),k.colorAttachment.set(W.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,S,S]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:V}=m.getMercatorTileBoundsBuffers(),q=[];m.linearFloatFilteringSupported()&&q.push("TERRAIN_DEM_FLOAT_FORMAT"),m.getOrCreateProgram("hillshadePrepare",{defines:q}).draw(m,v.TRIANGLES,Me.disabled,wt.disabled,de.unblended,Dr.disabled,((W,K)=>{const ae=K.stride,le=o.a6.mat4.create();return o.a6.mat4.ortho(le,0,o.ab,-o.ab,0,0,1),o.a6.mat4.translate(le,le,[0,-o.ab,0]),{u_matrix:le,u_image:1,u_dimension:[ae,ae],u_zoom:W.overscaledZ}})(i.tileID,w),c.id,L,F,V),i.needsHillshadePrepare=!1}class gi{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class af extends gi{getDefault(){return o.bz.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class yp extends gi{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Ja extends gi{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Ou extends gi{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Du extends gi{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class vp extends gi{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class bp extends gi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class xp extends gi{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Gc extends gi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class wp extends gi{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class dg extends gi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class fg extends gi{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class lf extends gi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class qc extends gi{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ah extends gi{getDefault(){return o.bz.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Ch extends gi{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class hc extends gi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class Rh extends gi{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Tp extends gi{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let pg=class extends gi{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class Lu extends gi{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Qa extends gi{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ep extends gi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class _a extends gi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Hc extends gi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Wc extends gi{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ph extends gi{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Mh extends gi{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class cf extends gi{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Dl extends gi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Bu extends gi{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Zc extends gi{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class kh extends Zc{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class uf extends Zc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Sp extends Zc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class cl extends uf{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const dc=(m,i,c)=>({u_matrix:m,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:c}),Ip=(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:k,u_frustum_br:L,u_frustum_bl:F,u_globe_pos:V,u_globe_radius:q,u_viewport:W,u_grid_matrix:le?Float32Array.from(le):new Float32Array(9),u_skirt_height:K,u_far_z_cutoff:ae});function Ap(m,i){return m!=null&&i!=null&&!(!m.hasData()||!i.hasData())&&m.demTexture!=null&&i.demTexture!=null&&m.tileID.key!==i.tileID.key}const Kc=new class{constructor(){this.operations={}}newMorphing(m,i,c,g,v){if(m in this.operations){const w=this.operations[m];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[m]={startTime:g,phase:0,duration:v,from:i,to:c,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const i=this.operations[m];return{from:i.from,to:i.to,phase:i.phase}}update(m){for(const i in this.operations){const c=this.operations[i];for(c.phase=(m-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,m)){delete this.operations[i];break}}}_nextOp(m,i){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=i,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Cp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Rp(m,i,c){if(i===0)return 0;const g=i<1&&c===514?.25/i:1;return 6*Math.pow(1.5,22-m)*Math.max(i,1)*g}function hf(m,i){const c=1<<m.z;return!i&&(m.x===0||m.x===c-1)||m.y===0||m.y===c-1}const zu=m=>({u_matrix:m});function Oh(m,i,c,g,v){if(v>0){const w=o.q.now(),S=(w-m.timeAdded)/v,k=i?(w-i.timeAdded)/v:-1,L=c.getSource(),F=g.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),V=!i||Math.abs(i.tileID.overscaledZ-F)>Math.abs(m.tileID.overscaledZ-F),q=V&&m.refreshedUponExpiration?1:o.ap(V?S:1-k,0,1);return m.refreshedUponExpiration&&S>=1&&(m.refreshedUponExpiration=!1),i?{opacity:1,mix:1-q}:{opacity:q,mix:0}}return{opacity:1,mix:0}}class fc extends Ji{constructor(i){const c={type:"raster-dem",maxzoom:i.transform.maxZoom},g=new o.cd(o.ce(),null),v=Bo("mock-dem",c,g,i.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,c){i.state="loaded",c(null)}}class Pp extends Ji{constructor(i){const c=Bo("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new o.cd(o.ce(),null),i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,g){if(i.freezeTileCoverage)return;this.transform=i;const v=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const k=new Ko(S,this._source.tileSize*S.overscaleFactor(),i.tileZoom);k.state="loaded",this._tiles[S.key]=k}return w},{});for(const w in this._tiles)w in v||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const c=this.proxyCachedFBO[i];if(c!==void 0){const g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Dh extends o.aA{constructor(i,c,g){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class Nu extends o.cE{constructor(i,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,w]=function(L){const F=new o.a_,V=new o.aO,q=131;F.reserve(17161),V.reserve(33800);const W=o.ab/128,K=o.ab+W/2,ae=K+W;for(let ue=-W;ue<ae;ue+=W)for(let pe=-W;pe<ae;pe+=W){const Re=pe<0||pe>K||ue<0||ue>K?24575:0,Oe=o.ap(Math.round(pe),0,o.ab),Ae=o.ap(Math.round(ue),0,o.ab);F.emplaceBack(Oe+Re,Ae)}const le=(ue,pe)=>{const Re=pe*q+ue;V.emplaceBack(Re+1,Re,Re+q),V.emplaceBack(Re+q,Re+q+1,Re+1)};for(let ue=1;ue<129;ue++)for(let pe=1;pe<129;pe++)le(pe,ue);return[0,129].forEach(ue=>{for(let pe=0;pe<130;pe++)le(pe,ue),le(ue,pe)}),[F,V,32768]}(),S=i.context;this.gridBuffer=S.createVertexBuffer(g,o.b0.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=o.b1.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=o.b1.simpleSegment(0,0,g.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pp(c.map),this.orthoMatrix=o.a6.mat4.create(),o.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.ab,0,o.ab,0,1);const k=S.gl;this._overlapStencilMode=new wt({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fc(c.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,c,g){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const v=i.terrain.properties,w=i.terrain.drapeRenderMode===0,S=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const k=i.terrain&&i.terrain.scope,L=v.get("source"),F=w?this._mockSourceCache:i.getSourceCache(L,k);if(!F)return void o.w(`Couldn't find terrain source "${L}".`);if(this.sourceCache=F,this._exaggeration=S?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const V=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const q=this.getScaledDemTileSize();this.sourceCache.update(c,q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,V(),this._initializing=!0),V(),c.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(i){const c=this._previousCameraAltitude,g=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=g;const v=c!=null?g-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const w=i.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(w);let k=w-this._previousZoom;const L=this._previousUpdateTimestamp;let F=w;this._evaluationZoom!=null&&(F=this._evaluationZoom,Math.abs(w-F)>.5&&(k=.5*(w-F+k)),k*v<0&&(F+=k)),this._evaluationZoom=F;const V=S.getExaggeration(F),q=V===S.getExaggeration(Math.max(0,F-.1));if(q&&Math.abs(V-this._exaggeration)<.01)return V;let W=Math.min(.1,.00375*(this._updateTimestamp-L));return(q||V<.1||Math.abs(k)<1e-4)&&(W=Math.min(.2,4*W)),o.aa(this._exaggeration,V,W)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(o.a5.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=c.getIds().map(L=>{const F=c.getTileByID(L).tileID;return F.projMatrix=g.calculateProjMatrix(F.toUnwrapped()),F});(function(L,F){const V=F.transform.pointCoordinate(F.transform.getCameraPoint()),q=new o.P(V.x,V.y);L.sort((W,K)=>{if(K.overscaledZ-W.overscaledZ)return K.overscaledZ-W.overscaledZ;const ae=new o.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),le=new o.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ue=q.mult(1<<W.canonical.z);return ue.x-=.5,ue.y-=.5,ue.distSqr(ae)-ue.distSqr(le)})})(v,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},v.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const L in S){const F=S[L];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,i[L],w),F.usedForTerrain))continue;const V=i[L];F.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[c.id]=v.map(L=>new Dh(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const F=this.terrainTileForTile[L.key];if(!F)continue;const V=F.tileID.key;V in k||(this._visibleDemTiles.push(F),k[V]=V)}}_assignTerrainTiles(i){this._initializing||i.forEach(c=>{if(this.terrainTileForTile[c.key])return;const g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){const i=this.painter.context,c=i.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],w=v.dem;!w||v.demTexture&&!v.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),Ih(this.painter,v,w))}}_prepareDemTileUniforms(i,c,g,v){if(!c||c.demTexture==null)return!1;const w=i.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-w.z),k=v||"";return g[`u_dem_tl${k}`]=[w.x*S%1,w.y*S%1],g[`u_dem_scale${k}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const c=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const w=v.dem.tree.minimums[0];return w>0&&i++,g+w},0);return i?c/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new o.cF({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(v,{premultiply:!1}):w=this._emptyDEMTexture=new o.T(i,v,c.R32F,{premultiply:!1}),w}setupElevationDraw(i,c,g){const v=this.painter.context,w=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let k=null,L=null,F=1;if(g&&g.morphing&&this._useVertexMorphing){const K=g.morphing.srcDemTile,ae=g.morphing.dstDemTile;F=g.morphing.phase,K&&ae&&(this._prepareDemTileUniforms(i,K,S,"_prev")&&(L=K),this._prepareDemTileUniforms(i,ae,S)&&(k=ae))}const V=K=>K&&K.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let q=null;var W;if(this.enabled?L&&k?(q=k.demTexture,v.activeTexture.set(w.TEXTURE4),L.demTexture.bind(V(L),w.CLAMP_TO_EDGE),S.u_dem_lerp=F):(k=this.terrainTileForTile[i.tileID.key],q=this._prepareDemTileUniforms(i,k,S)?k.demTexture:this.emptyDEMTexture):q=this.emptyDEMTexture,v.activeTexture.set(w.TEXTURE2),q&&(S.u_dem_size=(W=q).size[0]===1?1:W.size[0]-2,q.bind(V(k),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,c,S),g&&g.useMeterToDem&&k){const K=(1<<k.tileID.canonical.z)*o.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=K}if(g&&g.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,i.tileID.canonical,g&&g.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,K)}}globeUniformValues(i,c,g){const v=i.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,o.ab,0),u_tile_br_up:v.upVector(c,o.ab,o.ab),u_tile_bl_up:v.upVector(c,0,o.ab),u_tile_up_scale:g?o.cG(1):v.upVectorScale(c,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const c=this.painter,g=this.painter.context;i.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,w,S,k,L){if(v.transform.projection.name==="globe")(function(F,V,q,W,K){const ae=F.context,le=ae.gl;let ue,pe;const Re=F.transform,Oe=o.cx(F,ae,Re),Ae=(ht,Ct)=>{if(pe===Ct)return;const Ft=[Cp[Ct],"PROJECTION_GLOBE_VIEW"];Oe&&Ft.push("CUSTOM_ANTIALIASING");const At=F.isTileAffectedByFog(ht);ue=F.getOrCreateProgram("globeRaster",{defines:Ft,overrideFog:At}),pe=Ct},Be=F.colorModeForRenderPass(),Le=new Me(le.LEQUAL,Me.ReadWrite,F.depthRangeFor3D);Kc.update(K);const He=o.cy(Re),je=[o.am(Re.center.lng),o.at(Re.center.lat)],Ze=F.globeSharedBuffers,rt=[Re.width*o.q.devicePixelRatio,Re.height*o.q.devicePixelRatio],Je=Float32Array.from(Re.globeMatrix),Ye={useDenormalizedUpVectorScale:!0};{const ht=F.transform,Ct=Rp(ht.zoom,V.exaggeration(),V.sourceCache._source.tileSize);pe=-1;const Ft=le.TRIANGLES;for(const At of W){const Yt=q.getTile(At),dt=wt.disabled,Lt=V.prevTerrainTileForTile[At.key],kt=V.terrainTileForTile[At.key];Ap(Lt,kt)&&Kc.newMorphing(At.key,Lt,kt,K,250),ae.activeTexture.set(le.TEXTURE0),Yt.texture&&Yt.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const Qt=Kc.getMorphValuesForProxy(At.key),tr=Qt?1:0;Qt&&o.C(Ye,{morphing:{srcDemTile:Qt.from,dstDemTile:Qt.to,phase:o.cw(Qt.phase)}});const Nt=o.cz(At.canonical),Ut=o.cA(Nt.getCenter().lat),Nr=o.cB(At.canonical,Nt,Ut,ht.worldSize/ht._pixelsPerMercatorPixel),hr=o.b5(o.cC(At.canonical)),Sr=Ip(ht.expandedFarZProjMatrix,Je,He,hr,o.a9(ht.zoom),je,ht.frustumCorners.TL,ht.frustumCorners.TR,ht.frustumCorners.BR,ht.frustumCorners.BL,ht.globeCenterInViewSpace,ht.globeRadius,rt,Ct,ht._farZ,Nr);if(Ae(At,tr),ue&&(V.setupElevationDraw(Yt,ue,Ye),F.uploadCommonUniforms(ae,ue,At.toUnwrapped()),Ze)){const[Jr,Pr,Hr]=Ze.getGridBuffers(Ut,Ct!==0);ue.draw(F,Ft,Le,dt,Be,Dr.backCCW,Sr,"globe_raster",Jr,Pr,Hr)}}}if(Ze&&(F.renderDefaultNorthPole||F.renderDefaultSouthPole)){const ht=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Oe&&ht.push("CUSTOM_ANTIALIASING"),ue=F.getOrCreateProgram("globeRaster",{defines:ht});for(const Ct of W){const{x:Ft,y:At,z:Yt}=Ct.canonical,dt=At===0,Lt=At===(1<<Yt)-1,[kt,Qt,tr,Nt]=Ze.getPoleBuffers(Yt,!1);if(Nt&&(dt||Lt)){const Ut=q.getTile(Ct);ae.activeTexture.set(le.TEXTURE0),Ut.texture&&Ut.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);let Nr=o.cD(Yt,Ft,Re);const hr=o.b5(o.cC(Ct.canonical)),Sr=(Jr,Pr)=>Jr.draw(F,le.TRIANGLES,Le,wt.disabled,Be,Dr.disabled,Ip(Re.expandedFarZProjMatrix,Nr,Nr,hr,0,je,Re.frustumCorners.TL,Re.frustumCorners.TR,Re.frustumCorners.BR,Re.frustumCorners.BL,Re.globeCenterInViewSpace,Re.globeRadius,rt,0,Re._farZ),"globe_pole_raster",Pr,tr,Nt);V.setupElevationDraw(Ut,ue,Ye),F.uploadCommonUniforms(ae,ue,Ct.toUnwrapped()),dt&&F.renderDefaultNorthPole&&Sr(ue,kt),Lt&&F.renderDefaultSouthPole&&(Nr=o.a6.mat4.scale(o.a6.mat4.create(),Nr,[1,-1,1]),Sr(ue,Qt))}}}})(v,w,S,k,L);else{const F=v.context,V=F.gl;let q,W;const K=v.shadowRenderer,ae=kl(v,v.longestCutoffRange),le=Be=>{if(W===Be)return;const Le=[];Le.push(Cp[Be]),ae.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),q=v.getOrCreateProgram("terrainRaster",{defines:Le}),W=Be},ue=v.colorModeForRenderPass(),pe=new Me(V.LEQUAL,Me.ReadWrite,v.depthRangeFor3D);Kc.update(L);const Re=v.transform,Oe=Rp(Re.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let Ae=[0,0,0];if(K){const Be=v.style.directionalLight,Le=v.style.ambientLight;Be&&Le&&(Ae=lc(v.style,Be,Le))}{W=-1;const Be=V.TRIANGLES,[Le,He]=[w.gridIndexBuffer,w.gridSegments];for(const je of k){const Ze=S.getTile(je),rt=wt.disabled,Je=w.prevTerrainTileForTile[je.key],Ye=w.terrainTileForTile[je.key];Ap(Je,Ye)&&Kc.newMorphing(je.key,Je,Ye,L,250),F.activeTexture.set(V.TEXTURE0),Ze.texture&&Ze.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ht=Kc.getMorphValuesForProxy(je.key),Ct=ht?1:0;let Ft;ht&&(Ft={morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:o.cw(ht.phase)}});const At=dc(je.projMatrix,hf(je.canonical,Re.renderWorldCopies)?Oe/10:Oe,Ae);if(le(Ct),!q)continue;w.setupElevationDraw(Ze,q,Ft);const Yt=je.toUnwrapped();K&&K.setupShadows(Yt,q),v.uploadCommonUniforms(F,q,Yt,null,ae),q.draw(v,Be,pe,rt,ue,Dr.backCCW,At,"terrain_raster",w.gridBuffer,Le,He)}}}}(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const c=this.painter,g=this.painter.context,v=this.proxySourceCache,w=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),k=c.style.order,L=[];let F=0;for(const V of w){const q=v.getTileByID(V.proxyTileKey),W=v.proxyCachedFBO[V.key]?v.proxyCachedFBO[V.key][i]:void 0,K=W!==void 0?v.renderCache[W]:this.pool[F++],ae=W!==void 0;if(q.texture=K.tex,ae&&!K.dirty){L.push(q.tileID);continue}let le;g.bindFramebuffer.set(K.fb.framebuffer),this.renderedToTile=!1,K.dirty&&(g.clear({color:o.bz.transparent,stencil:0}),K.dirty=!1);for(let ue=S.start;ue<=S.end;++ue){const pe=c.style._mergedLayers[k[ue]];if(pe.isHidden(c.transform.zoom))continue;const Re=c.style.getLayerSourceCache(pe),Oe=Re?this.proxyToSource[V.key][Re.id]:[V];if(!Oe)continue;const Ae=Oe;g.viewport.set([0,0,K.fb.width,K.fb.height]),le!==(Re?Re.id:null)&&(this._setupStencil(K,Oe,pe,Re),le=Re?Re.id:null),c.renderLayer(c,Re,pe,Ae)}if(this._drapedRenderBatches.length===0)for(const ue of this._pendingGroundEffectLayers){const pe=c.style._mergedLayers[k[ue]];if(pe.isHidden(c.transform.zoom))continue;const Re=c.style.getLayerSourceCache(pe),Oe=Re?this.proxyToSource[V.key][Re.id]:[V];if(!Oe)continue;const Ae=Oe;g.viewport.set([0,0,K.fb.width,K.fb.height]),le!==(Re?Re.id:null)&&(this._setupStencil(K,Oe,pe,Re),le=Re?Re.id:null),c.renderLayer(c,Re,pe,Ae)}this.renderedToTile?(K.dirty=!0,L.push(q.tileID)):ae||--F,F===5&&(F=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}isLayerOrderingCorrect(i){const c=i.order.length;let g=-1,v=c;for(let w=0;w<c;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?g=Math.max(g,w):v=Math.min(v,w);return v>g}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{i=Math.min(i,c.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,c,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,k=1<<S.overscaledZ,{x:L,y:F}=S.canonical,V=L/k,q=(L+1)/k,W=F/k,K=(F+1)/k;return{minx:V,miny:W,maxx:q,maxy:K,t:w.dem.tree.raycastRoot(V,W,q,K,i,c,g),tile:w}});v.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const w of v){if(w.t==null)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,c,g);if(S!=null)return S}return null}_createFBO(){const i=this.painter.context,c=i.gl,g=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);const v=new o.T(i,{width:g[0],height:g[1],data:null},c.RGBA8);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=i.createFramebuffer(g[0],g[1],!0,null);return w.colorAttachment.set(v.texture),w.depthAttachment=new cl(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const c=this._style._mergedLayers[i],g=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!g&&c.shouldRedrape():!g&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const g of this._style.getSources())if(g instanceof Ka){i=!0;break}if(!i)return;const c={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(v);if(w&&!c[w.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof o.a4){c[w.id]=!0;for(const S of this.proxyCoords){const k=this.proxyToSource[S.key][w.id];if(k)for(const L of k)this._clearRenderCacheForTile(w.id,L)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof As){i=!0;break}if(!i)return;const c={};for(let g=0;g<this._style.order.length;++g){const v=this._style._mergedLayers[this._style.order[g]],w=this._style.getLayerSourceCache(v);if(!w||c[w.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const S=v.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const L=this.proxyToSource[k.key][w.id];if(L)for(const F of L){const V=Oh(w.getTile(F),w.findLoadedParent(F,0),w,this.painter.transform,S);(V.opacity!==1||V.mix!==0)&&this._clearRenderCacheForTile(w.id,F)}}}}_setupDrapedRenderBatches(){const i=this._style.order,c=i.length;if(c===0)return;const g=[];this._pendingGroundEffectLayers=[];let v,w=0,S=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<c;)S=this._style._mergedLayers[i[w]];for(;w<c;++w){const k=this._style._mergedLayers[i[w]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?v===void 0&&(v=w):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),v!==void 0&&(g.push({start:v,end:w-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:w-1}),g.length!==0){const k=g[g.length-1];this._pendingGroundEffectLayers.every(L=>L>k.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(i){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let k=0;k<S.length;++k){const L=Object.values(S[k]);c.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let S=g.length-1;S>=0;S--){const k=g[S];if(c.getTileByID(k.key),c.proxyCachedFBO[k.key]!==void 0){const L=i[k.key],F=this.proxyToSource[k.key];let V=0;for(const q in F){const W=F[q],K=L[q];if(!K||K.length!==W.length||W.some((ae,le)=>ae!==K[le]||v[q]&&v[q].hasOwnProperty(ae.key))){V=-1;break}++V}for(const q in c.proxyCachedFBO[k.key])c.renderCache[c.proxyCachedFBO[k.key][q]].dirty=V<0||V!==Object.values(L).length}}const w=[...this._drapedRenderBatches];w.sort((S,k)=>k.end-k.start-(S.end-S.start));for(const S of w)for(const k of g){if(c.proxyCachedFBO[k.key])continue;let L=c.renderCachePool.pop();L===void 0&&c.renderCache.length<50&&(L=c.renderCache.length,c.renderCache.push(this._createFBO())),L!==void 0&&(c.proxyCachedFBO[k.key]={},c.proxyCachedFBO[k.key][S.start]=L,c.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let k;if(g.isTileClipped())k=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):wt.disabled}_renderTileClippingMasks(i,c){const g=this.painter,v=this.painter.context,w=v.gl;g._tileClippingMaskIDs={},v.setColorMode(de.disabled),v.setDepthMode(Me.disabled);const S=g.getOrCreateProgram("clippingMask");for(const k of i){const L=g._tileClippingMaskIDs[k.key]=--c;S.draw(g,w.TRIANGLES,Me.disabled,new wt({func:w.ALWAYS,mask:0},L,255,w.KEEP,w.KEEP,w.REPLACE),de.disabled,Dr.disabled,zu(k.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(i){const c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;const g=[i.x,i.y,1,1];o.a6.vec4.transformMat4(g,g,c.pixelMatrixInverse),o.a6.vec4.scale(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;const v=c._camera.position,w=o.bD(1,c.center.lat),S=[v[0],v[1],v[2]/w,0],k=o.a6.vec3.subtract([],g.slice(0,3),S);o.a6.vec3.normalize(k,k);const L=this.raycast(S,k,this._exaggeration);return L!==null&&L?(o.a6.vec3.scaleAndAdd(S,S,k,L),S[3]=S[2],S[2]*=w,S):null}_setupProxiedCoordsForOrtho(i,c,g){if(i.getSource()instanceof o.aD)return this._setupProxiedCoordsForImageSource(i,c,g);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const v=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let L=0;L<w.length;L++){const F=w[L],V=this._findTileCoveringTileID(F,i);if(V){const q=this._createProxiedId(F,V,g[F.key]&&g[F.key][i.id]);v.push(q),this.proxyToSource[F.key][i.id]=[q]}}let S=!1;const k=new Set;for(let L=0;L<c.length;L++){const F=i.getTile(c[L]);if(!F||!F.hasData())continue;const V=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==F.tileID.canonical.z){const q=this.proxyToSource[V.tileID.key][i.id],W=this._createProxiedId(V.tileID,F,g[V.tileID.key]&&g[V.tileID.key][i.id]);q?q.splice(q.length-1,0,W):this.proxyToSource[V.tileID.key][i.id]=[W];const K=this.proxyToSource[V.tileID.key][i.id];k.has(K)||k.add(K),v.push(W),S=!0}}if(this._sourceTilesOverlap[i.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const L of k)L.sort((F,V)=>V.overscaledZ-F.overscaledZ)}_setupProxiedCoordsForImageSource(i,c,g){if(!i.getSource().loaded())return;const v=this.proxiedCoords[i.id]=[],w=this.proxyCoords,S=i.getSource(),k=S.tileID;if(!k)return;const L=new o.P(k.x,k.y)._div(1<<k.z),F=S.coordinates.map(o.a5.fromLngLat).reduce((q,W)=>(q.min.x=Math.min(q.min.x,W.x-L.x),q.min.y=Math.min(q.min.y,W.y-L.y),q.max.x=Math.max(q.max.x,W.x-L.x),q.max.y=Math.max(q.max.y,W.y-L.y),q),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=(q,W)=>{const K=q.wrap+q.canonical.x/(1<<q.canonical.z),ae=q.canonical.y/(1<<q.canonical.z),le=o.ab/(1<<q.canonical.z),ue=W.wrap+W.canonical.x/(1<<W.canonical.z),pe=W.canonical.y/(1<<W.canonical.z);return K+le<ue+F.min.x||K>ue+F.max.x||ae+le<pe+F.min.y||ae>pe+F.max.y};for(let q=0;q<w.length;q++){const W=w[q];for(let K=0;K<c.length;K++){const ae=i.getTile(c[K]);if(!ae||!ae.hasData()||V(W,ae.tileID))continue;const le=this._createProxiedId(W,ae,g[W.key]&&g[W.key][i.id]),ue=this.proxyToSource[W.key][i.id];ue?ue.push(le):this.proxyToSource[W.key][i.id]=[le],v.push(le)}}}_createProxiedId(i,c,g){let v=this.orthoMatrix;if(g){const w=g.find(S=>S.key===c.tileID.key);if(w)return w}if(c.tileID.key!==i.key){const w=i.canonical.z-c.tileID.canonical.z;let S,k,L;v=o.a6.mat4.create();const F=c.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(S=o.ab>>w,k=S*((c.tileID.canonical.x<<w)-i.canonical.x+F),L=S*((c.tileID.canonical.y<<w)-i.canonical.y)):(S=o.ab<<-w,k=o.ab*(c.tileID.canonical.x-(i.canonical.x+F<<-w)),L=o.ab*(c.tileID.canonical.y-(i.canonical.y<<-w))),o.a6.mat4.ortho(v,0,S,0,S,0,1),o.a6.mat4.translate(v,v,[k,L,0])}return new Dh(c.tileID,i.key,v)}_findTileCoveringTileID(i,c){let g=c.getTile(i);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[c.id],w=v[i.key];if(g=w?c.getTileByID(w):null,g&&g.hasData()||w===null)return g;let S=g?g.tileID:i,k=S.overscaledZ;const L=c.getSource().minzoom,F=[];if(!w){const q=c.getSource().maxzoom;if(i.canonical.z>=q){const W=i.canonical.z-q;c.getSource().reparseOverscaled?(k=Math.max(i.canonical.z+2,c.transform.tileZoom),S=new o.aA(k,i.wrap,q,i.canonical.x>>W,i.canonical.y>>W)):W!==0&&(k=q,S=new o.aA(k,i.wrap,q,i.canonical.x>>W,i.canonical.y>>W))}S.key!==i.key&&(F.push(S.key),g=c.getTile(S))}const V=q=>{F.forEach(W=>{v[W]=q}),F.length=0};for(k-=1;k>=L&&(!g||!g.hasData());k--){g&&V(g.tileID.key);const q=S.calculateScaledKey(k);if(g=c.getTileByID(q),g&&g.hasData())break;const W=v[q];if(W===null)break;W===void 0?F.push(q):g=c.getTileByID(W)}return V(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let g=this._tilesDirty[i];g||(g=this._tilesDirty[i]={}),g[c.key]=!0}}function Lh(m,i,c){const g=function(k,L,F){const V=o.a6.vec3.dot(L,k),q=o.a6.vec3.dot(F,[.2126,.7152,.0722]),W=(ae,le,ue)=>(1-ue)*ae+ue*le,K=W(1-.3*Math.min(q,1),1,Math.min(V+1,1));return W(.92,1,Math.asin(o.ap(L[2],-1,1))/Math.PI+.5)*K}(m,[0,0,1],i),v=[0,0,0];o.a6.vec3.scale(v,c.slice(0,3),g);const w=[0,0,0];o.a6.vec3.scale(w,i.slice(0,3),m[2]);const S=[0,0,0];return o.a6.vec3.add(S,v,w),o.cb(S)}const ya=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],df=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class ul{static cacheKey(i,c,g,v){let w=`${c}${v?v.cacheKey:""}`;for(const S of g)i.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(i,c,g,v,w,S){const k=i.gl;this.program=k.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...S];const L=v?v.getBinderAttributes():[],F=(g.staticAttributes||[]).concat(L);let V=v?v.defines():[];V=V.concat(S.map(ue=>`#define ${ue}`));const q=`#version 300 es
`;let W=q+V.concat("precision mediump float;",Pu,Uc.fragmentSource).join(`
`);for(const ue of g.fragmentIncludes)W+=`
${Ru[ue]}`;W+=`
${g.fragmentSource}`;let K=q+V.concat("precision highp float;",Pu,Uc.vertexSource).join(`
`);for(const ue of g.vertexIncludes)K+=`
${Ru[ue]}`;K+=`
${g.vertexSource}`;const ae=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ae,W),k.compileShader(ae),k.attachShader(this.program,ae);const le=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(le,K),k.compileShader(le),k.attachShader(this.program,le),this.attributes={},this.numAttributes=F.length;for(let ue=0;ue<this.numAttributes;ue++)if(F[ue]){const pe=F[ue].startsWith("a_")?F[ue]:`a_${F[ue]}`;k.bindAttribLocation(this.program,ue,pe),this.attributes[pe]=ue}k.linkProgram(this.program),k.deleteShader(le),k.deleteShader(ae),this.fixedUniforms=w(i),this.binderUniforms=v?v.getUniforms(i):[],(S.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(ue=>({u_dem:new o.bJ(ue),u_dem_prev:new o.bJ(ue),u_dem_tl:new o.bG(ue),u_dem_scale:new o.bI(ue),u_dem_tl_prev:new o.bG(ue),u_dem_scale_prev:new o.bI(ue),u_dem_size:new o.bI(ue),u_dem_lerp:new o.bI(ue),u_exaggeration:new o.bI(ue),u_depth:new o.bJ(ue),u_depth_size_inv:new o.bG(ue),u_depth_range_unpack:new o.bG(ue),u_occluder_half_size:new o.bI(ue),u_occlusion_depth_offset:new o.bI(ue),u_meter_to_dem:new o.bI(ue),u_label_plane_matrix_inv:new o.bF(ue)}))(i)),S.includes("GLOBE")&&(this.globeUniforms=(ue=>({u_tile_tl_up:new o.bH(ue),u_tile_tr_up:new o.bH(ue),u_tile_br_up:new o.bH(ue),u_tile_bl_up:new o.bH(ue),u_tile_up_scale:new o.bI(ue)}))(i)),S.includes("FOG")&&(this.fogUniforms=(ue=>({u_fog_matrix:new o.bF(ue),u_fog_range:new o.bG(ue),u_fog_color:new o.c6(ue),u_fog_horizon_blend:new o.bI(ue),u_fog_vertical_limit:new o.bG(ue),u_fog_temporal_offset:new o.bI(ue),u_frustum_tl:new o.bH(ue),u_frustum_tr:new o.bH(ue),u_frustum_br:new o.bH(ue),u_frustum_bl:new o.bH(ue),u_globe_pos:new o.bH(ue),u_globe_radius:new o.bI(ue),u_globe_transition:new o.bI(ue),u_is_globe:new o.bJ(ue),u_viewport:new o.bG(ue)}))(i)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ue=>({u_cutoff_params:new o.c6(ue)}))(i)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ue=>({u_lighting_ambient_color:new o.bH(ue),u_lighting_directional_dir:new o.bH(ue),u_lighting_directional_color:new o.bH(ue),u_ground_radiance:new o.bH(ue)}))(i)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ue=>({u_light_matrix_0:new o.bF(ue),u_light_matrix_1:new o.bF(ue),u_fade_range:new o.bG(ue),u_shadow_normal_offset:new o.bH(ue),u_shadow_intensity:new o.bI(ue),u_shadow_texel_size:new o.bI(ue),u_shadow_map_resolution:new o.bI(ue),u_shadow_direction:new o.bH(ue),u_shadow_bias:new o.bH(ue),u_shadowmap_0:new o.bJ(ue),u_shadowmap_1:new o.bJ(ue)}))(i))}}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)g[v]&&g[v].set(this.program,v,c[v])}}setGlobeUniformValues(i,c){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)g[v]&&g[v].set(this.program,v,c[v])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setCutoffUniformValues(i,c){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setLightsUniformValues(i,c){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}}setShadowUniformValues(i,c){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;i.program.set(this.program);for(const v in c)g[v].set(this.program,v,c[v])}_drawDebugWireframe(i,c,g,v,w,S,k,L,F,V){const q=i.options.wireframe;if(q.terrain===!1&&q.layers2D===!1&&q.layers3D===!1)return;const W=i.context;if(!(!(!q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!q.layers2D||i._terrain&&i._terrain.renderingToTexture||!ya.includes(this.name))||!(!q.layers3D||!df.includes(this.name))))return;const K=W.gl,ae=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,W);if(!ae)return;const le=[...this.fixedDefines];le.push("DEBUG_WIREFRAME");const ue=i.getOrCreateProgram(this.name,{config:this.configuration,defines:le});W.program.set(ue.program);const pe=(Ae,Be,Le)=>{if(Be[Ae]&&Le[Ae])for(const He in Be[Ae])Le[Ae][He]&&Le[Ae][He].set(Le.program,He,Be[Ae][He].current)};F&&F.setUniforms(ue.program,W,ue.binderUniforms,k,{zoom:L}),pe("fixedUniforms",this,ue),pe("terrainUniforms",this,ue),pe("globeUniforms",this,ue),pe("fogUniforms",this,ue),pe("lightsUniforms",this,ue),pe("shadowUniforms",this,ue),ae.bind(),W.setColorMode(new de([K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ZERO,K.ONE],o.bz.transparent,[!0,!0,!0,!1])),W.setDepthMode(new Me(c.func===K.LESS?K.LEQUAL:c.func,Me.ReadOnly,c.range)),W.setStencilMode(wt.disabled);const Re=3*S.primitiveLength*2,Oe=3*S.primitiveOffset*2*2;V&&V>1?K.drawElementsInstanced(K.LINES,Re,K.UNSIGNED_SHORT,Oe,V):K.drawElements(K.LINES,Re,K.UNSIGNED_SHORT,Oe),w.bind(),W.program.set(this.program),W.setDepthMode(c),W.setStencilMode(g),W.setColorMode(v)}draw(i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue){const pe=i.context,Re=pe.gl;if(this.failedToCreate)return;pe.program.set(this.program),pe.setDepthMode(g),pe.setStencilMode(v),pe.setColorMode(w),pe.setCullFace(S);for(const Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(this.program,Be,k[Be]);ae&&ae.setUniforms(this.program,pe,this.binderUniforms,W,{zoom:K});const Oe={[Re.POINTS]:1,[Re.LINES]:2,[Re.TRIANGLES]:3,[Re.LINE_STRIP]:1}[c],Ae=ue&&ue>0?1:void 0;for(const Be of q.get()){const Le=Be.vaos||(Be.vaos={});(Le[L]||(Le[L]=new jc)).bind(pe,this,F,ae?ae.getPaintVertexBuffers():[],V,Be.vertexOffset,le||[],Ae),ue&&ue>1?Re.drawElementsInstanced(c,Be.primitiveLength*Oe,Re.UNSIGNED_SHORT,Be.primitiveOffset*Oe*2,ue):V?Re.drawElements(c,Be.primitiveLength*Oe,Re.UNSIGNED_SHORT,Be.primitiveOffset*Oe*2):Re.drawArrays(c,Be.vertexOffset,Be.vertexLength),c===Re.TRIANGLES&&V&&this._drawDebugWireframe(i,g,v,w,V,Be,W,K,ae,ue)}}}function Bh(m,i){const c=Math.pow(2,i.tileID.overscaledZ),g=i.tileSize*Math.pow(2,m.transform.tileZoom)/c,v=g*(i.tileID.canonical.x+i.tileID.wrap*c),w=g*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ak(i,1,m.transform.tileZoom),u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const Xc=o.a6.mat4.create(),zh=(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le)=>{const ue=i.style.light,pe=ue.properties.get("position"),Re=[pe.x,pe.y,pe.z],Oe=o.a6.mat3.create();ue.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(Oe,-i.transform.angle),o.a6.vec3.transformMat3(Re,Re,Oe));const Ae=ue.properties.get("color"),Be=i.transform,Le={u_matrix:m,u_lightpos:Re,u_lightintensity:ue.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Xc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:w,u_width_scale:S,u_flood_light_color:W,u_vertical_scale:K,u_flood_light_intensity:ae,u_ground_shadow_factor:le};return Be.projection.name==="globe"&&(Le.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],Le.u_zoom_transition=F,Le.u_inv_rot_matrix=q,Le.u_merc_center=V,Le.u_up_dir=Be.projection.upVector(new o.bP(0,0,0),V[0]*o.ab,V[1]*o.ab),Le.u_height_lift=L),Le},Nh=(m,i,c,g)=>({u_matrix:m,u_edge_radius:i,u_width_scale:c,u_vertical_scale:g}),ff=(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae)=>{const le=zh(m,i,c,g,v,w,S,k,F,V,q,W,K,ae,1,[0,0,0]),ue={u_height_factor:-Math.pow(2,k.overscaledZ)/L.tileSize/8};return o.l(le,Bh(i,L),ue)},hl=(m,i)=>({u_matrix:m,u_emissive_strength:i}),Ll=(m,i,c,g)=>o.l(hl(m,i),Bh(c,g)),Mp=(m,i,c)=>({u_matrix:m,u_world:c,u_emissive_strength:i}),Fu=(m,i,c,g,v)=>o.l(Ll(m,i,c,g),{u_world:v}),mg=(m,i,c,g)=>{const v=o.ab/c.tileSize;return{u_matrix:m,u_camera_to_center_distance:i.getCameraToCenterDistance(g),u_extrude_scale:[i.pixelsToGLUnits[0]/v,i.pixelsToGLUnits[1]/v]}},kp=(m,i,c=1)=>({u_matrix:m,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),Op=o.a6.mat4.create(),gg=(m,i,c,g,v,w,S)=>{const k=m.transform,L=k.projection.name==="globe",F=L?o.cI(k.zoom,i.canonical)*k._pixelsPerMercatorPixel:o.ak(c,1,w),V={u_matrix:i.projMatrix,u_extrude_scale:F,u_intensity:S,u_inv_rot_matrix:Op,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){V.u_inv_rot_matrix=g,V.u_merc_center=v,V.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],V.u_zoom_transition=o.a9(k.zoom);const q=v[0]*o.ab,W=v[1]*o.ab;V.u_up_dir=k.projection.upVector(new o.bP(0,0,0),q,W)}return V};function Fh(m,[i,c,g,v],[w,S]){if(w===S)return[0,0,0,0];const k=255*(m-1)/(m*(S-w));return[i*k,c*k,g*k,v*k]}function Vh(m,i,[c,g]){return c===g?0:.5/m+(i-c)*(m-1)/(m*(g-c))}const Yc=(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue,pe,Re,Oe,Ae)=>({u_matrix:m,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:F,u_fade_t:V.mix,u_opacity:V.opacity*q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:q.paint.get("raster-brightness-min"),u_brightness_high:q.paint.get("raster-brightness-max"),u_saturation_factor:o.cJ(q.paint.get("raster-saturation")),u_contrast_factor:o.cK(q.paint.get("raster-contrast")),u_spin_weights:Jc(q.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:K,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:L,u_colorization_mix:Fh(o.cL,le,pe),u_colorization_offset:Vh(o.cL,ue,pe),u_color_ramp:ae,u_texture_offset:[Oe/(Re+2*Oe),Re/(Re+2*Oe)],u_texture_res:[Re+2*Oe,Re+2*Oe],u_emissive_strength:Ae});function Jc(m){m*=Math.PI/180;const i=Math.sin(m),c=Math.cos(m);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const va=.05,Dp=(m,i,c,g,v,w,S,k,L,F,V,q)=>({u_matrix:m,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:w,u_scale_parent:F,u_fade_t:V.mix,u_opacity:V.opacity,u_image0:0,u_image1:1,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:k,u_cutoff_params:L}),Uh=(m,i,c,g,v,w,S,k,L,F)=>({u_particle_texture:m,u_particle_texture_side_len:i,u_tile_offset:c,u_velocity:g,u_color_ramp:w,u_velocity_res:v,u_max_speed:S,u_uv_offset:k,u_data_scale:[255*L[0],255*L[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[va,va]}),Zl=(m,i,c,g,v,w,S,k,L,F)=>({u_particle_texture:m,u_particle_texture_side_len:i,u_velocity:c,u_velocity_res:g,u_max_speed:v,u_speed_factor:w,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:k,u_data_scale:[255*L[0],255*L[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[va,va]}),Ie=o.a6.mat4.create(),$=(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue,pe,Re,Oe,Ae)=>{const Be=v.transform,Le={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Be.getCameraToCenterDistance(Re),u_rotate_symbol:+c,u_aspect_ratio:Be.width/Be.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+F,u_elevation_from_sea:L?1:0,u_pitch_with_map:+g,u_texsize:V,u_texsize_icon:q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ie,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ie,u_up_vector:[0,-1,0],u_color_adj_mat:Oe,u_icon_transition:Ae||0,u_gamma_scale:g?v.transform.getCameraToCenterDistance(Re)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:+W};return Re.name==="globe"&&(Le.u_tile_id=[K.canonical.x,K.canonical.y,1<<K.canonical.z],Le.u_zoom_transition=ae,Le.u_inv_rot_matrix=ue,Le.u_merc_center=le,Le.u_camera_forward=Be._camera.forward(),Le.u_ecef_origin=o.cM(Be.globeMatrix,K.toUnwrapped()),Le.u_tile_matrix=Float32Array.from(Be.globeMatrix),Le.u_up_vector=pe),Le},ce=(m,i,c,g)=>({u_matrix:m,u_emissive_strength:i,u_opacity:c,u_color:g}),Ue=(m,i,c,g,v,w,S,k,L)=>o.l(function(F,V,q,W,K,ae){const{width:le,height:ue}=W.imageManager.getPixelSize(V),pe=Math.pow(2,ae.tileID.overscaledZ),Re=ae.tileSize*Math.pow(2,W.transform.tileZoom)/pe,Oe=Re*(ae.tileID.canonical.x+ae.tileID.wrap*pe),Ae=Re*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl:q.tl,u_pattern_br:q.br,u_texsize:[le,ue],u_pattern_size:q.displaySize,u_pattern_units_to_pixels:K?[W.transform.width,-1*W.transform.height]:[1/o.ak(ae,1,W.transform.tileZoom),1/o.ak(ae,1,W.transform.tileZoom)],u_pixel_coord_upper:[Oe>>16,Ae>>16],u_pixel_coord_lower:[65535&Oe,65535&Ae]}}(0,w,S,g,k,L),{u_matrix:m,u_emissive_strength:i,u_opacity:c}),It=new Float32Array(o.a6.mat4.identity([])),et=(m,i,c,g,v,w,S,k,L,F,V,q,W,K=[0,0,0],ae)=>{const le=v.style.light,ue=le.properties.get("position"),pe=[-ue.x,-ue.y,ue.z],Re=o.a6.mat3.create();le.properties.get("anchor")==="viewport"&&(o.a6.mat3.fromRotation(Re,-v.transform.angle),o.a6.vec3.transformMat3(pe,pe,Re));const Oe=V.alphaMode==="MASK",Ae=le.properties.get("color").toRenderColor(null),Be=W.paint.get("model-ambient-occlusion-intensity"),Le=W.paint.get("model-color").constantOr(o.bz.white).toRenderColor(null),He=W.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:m,u_lighting_matrix:i,u_normal_matrix:c,u_node_matrix:g||It,u_lightpos:pe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_camera_pos:K,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+Oe,u_alphaCutoff:V.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[k[0],k[1],k[2],1],u_metallicFactor:L,u_roughnessFactor:F,u_baseColorTexture:No.BaseColor,u_metallicRoughnessTexture:No.MetallicRoughness,u_normalTexture:No.Normal,u_occlusionTexture:No.Occlusion,u_emissionTexture:No.Emission,u_lutTexture:No.LUT,u_color_mix:[Le.r,Le.g,Le.b,He],u_aoIntensity:Be,u_emissive_strength:q,u_occlusionTextureTransform:ae||[0,0,0,0]}},Jt=(m,i=It,c=It)=>({u_matrix:m,u_instance:i,u_node_matrix:c}),br={fillExtrusion:m=>({u_matrix:new o.bF(m),u_lightpos:new o.bH(m),u_lightintensity:new o.bI(m),u_lightcolor:new o.bH(m),u_vertical_gradient:new o.bI(m),u_opacity:new o.bI(m),u_edge_radius:new o.bI(m),u_width_scale:new o.bI(m),u_ao:new o.bG(m),u_tile_id:new o.bH(m),u_zoom_transition:new o.bI(m),u_inv_rot_matrix:new o.bF(m),u_merc_center:new o.bG(m),u_up_dir:new o.bH(m),u_height_lift:new o.bI(m),u_flood_light_color:new o.bH(m),u_vertical_scale:new o.bI(m),u_flood_light_intensity:new o.bI(m),u_ground_shadow_factor:new o.bH(m)}),fillExtrusionDepth:m=>({u_matrix:new o.bF(m),u_edge_radius:new o.bI(m),u_width_scale:new o.bI(m),u_vertical_scale:new o.bI(m)}),fillExtrusionPattern:m=>({u_matrix:new o.bF(m),u_lightpos:new o.bH(m),u_lightintensity:new o.bI(m),u_lightcolor:new o.bH(m),u_vertical_gradient:new o.bI(m),u_height_factor:new o.bI(m),u_edge_radius:new o.bI(m),u_width_scale:new o.bI(m),u_ao:new o.bG(m),u_tile_id:new o.bH(m),u_zoom_transition:new o.bI(m),u_inv_rot_matrix:new o.bF(m),u_merc_center:new o.bG(m),u_up_dir:new o.bH(m),u_height_lift:new o.bI(m),u_image:new o.bJ(m),u_texsize:new o.bG(m),u_pixel_coord_upper:new o.bG(m),u_pixel_coord_lower:new o.bG(m),u_tile_units_to_pixels:new o.bI(m),u_opacity:new o.bI(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new o.bF(m),u_opacity:new o.bI(m),u_ao_pass:new o.bI(m),u_meter_to_tile:new o.bI(m),u_ao:new o.bG(m),u_flood_light_intensity:new o.bI(m),u_flood_light_color:new o.bH(m),u_attenuation:new o.bI(m),u_edge_radius:new o.bI(m),u_fb:new o.bJ(m),u_fb_size:new o.bI(m),u_dynamic_offset:new o.bI(m)}),fill:m=>({u_matrix:new o.bF(m),u_emissive_strength:new o.bI(m)}),fillPattern:m=>({u_matrix:new o.bF(m),u_emissive_strength:new o.bI(m),u_image:new o.bJ(m),u_texsize:new o.bG(m),u_pixel_coord_upper:new o.bG(m),u_pixel_coord_lower:new o.bG(m),u_tile_units_to_pixels:new o.bI(m)}),fillOutline:m=>({u_matrix:new o.bF(m),u_emissive_strength:new o.bI(m),u_world:new o.bG(m)}),fillOutlinePattern:m=>({u_matrix:new o.bF(m),u_emissive_strength:new o.bI(m),u_world:new o.bG(m),u_image:new o.bJ(m),u_texsize:new o.bG(m),u_pixel_coord_upper:new o.bG(m),u_pixel_coord_lower:new o.bG(m),u_tile_units_to_pixels:new o.bI(m)}),circle:o.cN,collisionBox:m=>({u_matrix:new o.bF(m),u_camera_to_center_distance:new o.bI(m),u_extrude_scale:new o.bG(m)}),collisionCircle:m=>({u_matrix:new o.bF(m),u_inv_matrix:new o.bF(m),u_camera_to_center_distance:new o.bI(m),u_viewport_size:new o.bG(m)}),debug:m=>({u_color:new o.cu(m),u_matrix:new o.bF(m),u_overlay:new o.bJ(m),u_overlay_scale:new o.bI(m)}),clippingMask:m=>({u_matrix:new o.bF(m)}),heatmap:m=>({u_extrude_scale:new o.bI(m),u_intensity:new o.bI(m),u_matrix:new o.bF(m),u_inv_rot_matrix:new o.bF(m),u_merc_center:new o.bG(m),u_tile_id:new o.bH(m),u_zoom_transition:new o.bI(m),u_up_dir:new o.bH(m)}),heatmapTexture:m=>({u_image:new o.bJ(m),u_color_ramp:new o.bJ(m),u_opacity:new o.bI(m)}),hillshade:m=>({u_matrix:new o.bF(m),u_image:new o.bJ(m),u_latrange:new o.bG(m),u_light:new o.bG(m),u_shadow:new o.cu(m),u_highlight:new o.cu(m),u_emissive_strength:new o.bI(m),u_accent:new o.cu(m)}),hillshadePrepare:m=>({u_matrix:new o.bF(m),u_image:new o.bJ(m),u_dimension:new o.bG(m),u_zoom:new o.bI(m)}),line:o.cO,linePattern:o.cP,raster:m=>({u_matrix:new o.bF(m),u_normalize_matrix:new o.bF(m),u_globe_matrix:new o.bF(m),u_merc_matrix:new o.bF(m),u_grid_matrix:new o.cv(m),u_tl_parent:new o.bG(m),u_scale_parent:new o.bI(m),u_fade_t:new o.bI(m),u_opacity:new o.bI(m),u_image0:new o.bJ(m),u_image1:new o.bJ(m),u_brightness_low:new o.bI(m),u_brightness_high:new o.bI(m),u_saturation_factor:new o.bI(m),u_contrast_factor:new o.bI(m),u_spin_weights:new o.bH(m),u_perspective_transform:new o.bG(m),u_raster_elevation:new o.bI(m),u_zoom_transition:new o.bI(m),u_merc_center:new o.bG(m),u_cutoff_params:new o.c6(m),u_colorization_mix:new o.c6(m),u_colorization_offset:new o.bI(m),u_color_ramp:new o.bJ(m),u_texture_offset:new o.bG(m),u_texture_res:new o.bG(m),u_emissive_strength:new o.bI(m)}),rasterParticle:m=>({u_matrix:new o.bF(m),u_normalize_matrix:new o.bF(m),u_globe_matrix:new o.bF(m),u_merc_matrix:new o.bF(m),u_grid_matrix:new o.cv(m),u_tl_parent:new o.bG(m),u_scale_parent:new o.bI(m),u_fade_t:new o.bI(m),u_opacity:new o.bI(m),u_image0:new o.bJ(m),u_image1:new o.bJ(m),u_raster_elevation:new o.bI(m),u_zoom_transition:new o.bI(m),u_merc_center:new o.bG(m),u_cutoff_params:new o.c6(m)}),rasterParticleTexture:m=>({u_texture:new o.bJ(m),u_opacity:new o.bI(m)}),rasterParticleDraw:m=>({u_particle_texture:new o.bJ(m),u_particle_texture_side_len:new o.bI(m),u_tile_offset:new o.bG(m),u_velocity:new o.bJ(m),u_color_ramp:new o.bJ(m),u_velocity_res:new o.bG(m),u_max_speed:new o.bI(m),u_uv_offset:new o.bG(m),u_data_scale:new o.bG(m),u_data_offset:new o.bI(m),u_particle_pos_scale:new o.bI(m),u_particle_pos_offset:new o.bG(m)}),rasterParticleUpdate:m=>({u_particle_texture:new o.bJ(m),u_particle_texture_side_len:new o.bI(m),u_velocity:new o.bJ(m),u_velocity_res:new o.bG(m),u_max_speed:new o.bI(m),u_speed_factor:new o.bI(m),u_reset_rate:new o.bI(m),u_rand_seed:new o.bI(m),u_uv_offset:new o.bG(m),u_data_scale:new o.bG(m),u_data_offset:new o.bI(m),u_particle_pos_scale:new o.bI(m),u_particle_pos_offset:new o.bG(m)}),symbol:m=>({u_is_size_zoom_constant:new o.bJ(m),u_is_size_feature_constant:new o.bJ(m),u_size_t:new o.bI(m),u_size:new o.bI(m),u_camera_to_center_distance:new o.bI(m),u_rotate_symbol:new o.bJ(m),u_aspect_ratio:new o.bI(m),u_fade_change:new o.bI(m),u_matrix:new o.bF(m),u_label_plane_matrix:new o.bF(m),u_coord_matrix:new o.bF(m),u_is_text:new o.bJ(m),u_elevation_from_sea:new o.bJ(m),u_pitch_with_map:new o.bJ(m),u_texsize:new o.bG(m),u_texsize_icon:new o.bG(m),u_texture:new o.bJ(m),u_texture_icon:new o.bJ(m),u_gamma_scale:new o.bI(m),u_device_pixel_ratio:new o.bI(m),u_tile_id:new o.bH(m),u_zoom_transition:new o.bI(m),u_inv_rot_matrix:new o.bF(m),u_merc_center:new o.bG(m),u_camera_forward:new o.bH(m),u_tile_matrix:new o.bF(m),u_up_vector:new o.bH(m),u_ecef_origin:new o.bH(m),u_is_halo:new o.bJ(m),u_icon_transition:new o.bI(m),u_color_adj_mat:new o.bF(m)}),background:m=>({u_matrix:new o.bF(m),u_emissive_strength:new o.bI(m),u_opacity:new o.bI(m),u_color:new o.cu(m)}),backgroundPattern:m=>({u_matrix:new o.bF(m),u_emissive_strength:new o.bI(m),u_opacity:new o.bI(m),u_image:new o.bJ(m),u_pattern_tl:new o.bG(m),u_pattern_br:new o.bG(m),u_texsize:new o.bG(m),u_pattern_size:new o.bG(m),u_pixel_coord_upper:new o.bG(m),u_pixel_coord_lower:new o.bG(m),u_pattern_units_to_pixels:new o.bG(m)}),terrainRaster:m=>({u_matrix:new o.bF(m),u_image0:new o.bJ(m),u_skirt_height:new o.bI(m),u_ground_shadow_factor:new o.bH(m)}),skybox:m=>({u_matrix:new o.bF(m),u_sun_direction:new o.bH(m),u_cubemap:new o.bJ(m),u_opacity:new o.bI(m),u_temporal_offset:new o.bI(m)}),skyboxGradient:m=>({u_matrix:new o.bF(m),u_color_ramp:new o.bJ(m),u_center_direction:new o.bH(m),u_radius:new o.bI(m),u_opacity:new o.bI(m),u_temporal_offset:new o.bI(m)}),skyboxCapture:m=>({u_matrix_3f:new o.cv(m),u_sun_direction:new o.bH(m),u_sun_intensity:new o.bI(m),u_color_tint_r:new o.c6(m),u_color_tint_m:new o.c6(m),u_luminance:new o.bI(m)}),globeRaster:m=>({u_proj_matrix:new o.bF(m),u_globe_matrix:new o.bF(m),u_normalize_matrix:new o.bF(m),u_merc_matrix:new o.bF(m),u_zoom_transition:new o.bI(m),u_merc_center:new o.bG(m),u_image0:new o.bJ(m),u_grid_matrix:new o.cv(m),u_skirt_height:new o.bI(m),u_far_z_cutoff:new o.bI(m),u_frustum_tl:new o.bH(m),u_frustum_tr:new o.bH(m),u_frustum_br:new o.bH(m),u_frustum_bl:new o.bH(m),u_globe_pos:new o.bH(m),u_globe_radius:new o.bI(m),u_viewport:new o.bG(m)}),globeAtmosphere:m=>({u_frustum_tl:new o.bH(m),u_frustum_tr:new o.bH(m),u_frustum_br:new o.bH(m),u_frustum_bl:new o.bH(m),u_horizon:new o.bI(m),u_transition:new o.bI(m),u_fadeout_range:new o.bI(m),u_color:new o.c6(m),u_high_color:new o.c6(m),u_space_color:new o.c6(m),u_temporal_offset:new o.bI(m),u_horizon_angle:new o.bI(m)}),model:m=>({u_matrix:new o.bF(m),u_lighting_matrix:new o.bF(m),u_normal_matrix:new o.bF(m),u_node_matrix:new o.bF(m),u_lightpos:new o.bH(m),u_lightintensity:new o.bI(m),u_lightcolor:new o.bH(m),u_camera_pos:new o.bH(m),u_opacity:new o.bI(m),u_baseColorFactor:new o.c6(m),u_emissiveFactor:new o.c6(m),u_metallicFactor:new o.bI(m),u_roughnessFactor:new o.bI(m),u_baseTextureIsAlpha:new o.bJ(m),u_alphaMask:new o.bJ(m),u_alphaCutoff:new o.bI(m),u_baseColorTexture:new o.bJ(m),u_metallicRoughnessTexture:new o.bJ(m),u_normalTexture:new o.bJ(m),u_occlusionTexture:new o.bJ(m),u_emissionTexture:new o.bJ(m),u_lutTexture:new o.bJ(m),u_color_mix:new o.c6(m),u_aoIntensity:new o.bI(m),u_emissive_strength:new o.bI(m),u_occlusionTextureTransform:new o.c6(m)}),modelDepth:m=>({u_matrix:new o.bF(m),u_instance:new o.bF(m),u_node_matrix:new o.bF(m)}),groundShadow:m=>({u_matrix:new o.bF(m),u_ground_shadow_factor:new o.bH(m)}),stars:m=>({u_matrix:new o.bF(m),u_up:new o.bH(m),u_right:new o.bH(m),u_intensity_multiplier:new o.bI(m)}),occlusion:m=>({u_matrix:new o.bF(m),u_anchorPos:new o.bH(m),u_screenSizePx:new o.bG(m),u_occluderSizePx:new o.bG(m),u_color:new o.c6(m)})};class Ar{constructor(i,c,g,v){this.id=Ar.uniqueIdxCounter,Ar.uniqueIdxCounter++,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||v||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Ar.uniqueIdxCounter,Ar.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ar.uniqueIdxCounter=0;const Kr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Gt{constructor(i,c,g,v,w,S){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=i;const k=i.gl;this.buffer=k.createBuffer(),i.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let g=0;g<this.attributes.length;g++){const v=c.attributes[this.attributes[g].name];v!==void 0&&i.enableVertexAttribArray(v)}}setVertexAttribPointers(i,c,g){for(let v=0;v<this.attributes.length;v++){const w=this.attributes[v],S=c.attributes[w.name];S!==void 0&&i.vertexAttribPointer(S,w.components,i[Kr[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(i,c,g){for(let v=0;v<this.attributes.length;v++){const w=c.attributes[this.attributes[v].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gr{constructor(i,c,g,v,w){this.context=i,this.width=c,this.height=g;const S=this.framebuffer=i.gl.createFramebuffer();v&&(this.colorAttachment=new kh(i,S)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new uf(i,S):new Sp(i,S))}destroy(){const i=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&i.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&i.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&i.deleteTexture(c)}i.deleteFramebuffer(this.framebuffer)}}class Hn{constructor(i,c){this.gl=i,this.clearColor=new af(this),this.clearDepth=new yp(this),this.clearStencil=new Ja(this),this.colorMask=new Ou(this),this.depthMask=new Du(this),this.stencilMask=new vp(this),this.stencilFunc=new bp(this),this.stencilOp=new xp(this),this.stencilTest=new Gc(this),this.depthRange=new wp(this),this.depthTest=new dg(this),this.depthFunc=new fg(this),this.blend=new lf(this),this.blendFunc=new qc(this),this.blendColor=new Ah(this),this.blendEquation=new Ch(this),this.cullFace=new hc(this),this.cullFaceSide=new Rh(this),this.frontFace=new Tp(this),this.program=new pg(this),this.activeTexture=new Lu(this),this.viewport=new Qa(this),this.bindFramebuffer=new Ep(this),this.bindRenderbuffer=new _a(this),this.bindTexture=new Hc(this),this.bindVertexBuffer=new Wc(this),this.bindElementBuffer=new Ph(this),this.bindVertexArrayOES=new Mh(this),this.pixelStoreUnpack=new cf(this),this.pixelStoreUnpackPremultiplyAlpha=new Dl(this),this.pixelStoreUnpackFlipY=new Bu(this),this.options=c?{...c}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c,g){return new Ar(this,i,c,g)}createVertexBuffer(i,c,g,v,w){return new Gt(this,i,c,g,v,w)}createRenderbuffer(i,c,g){const v=this.gl,w=v.createRenderbuffer();return this.bindRenderbuffer.set(w),v.renderbufferStorage(v.RENDERBUFFER,i,c,g),this.bindRenderbuffer.set(null),w}createFramebuffer(i,c,g,v){return new Gr(this,i,c,g,v)}clear({color:i,depth:c,stencil:g,colorMask:v}){const w=this.gl;let S=0;i&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(v||[!0,!0,!0,!0])),c!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),g!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),w.clear(S)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){o.bh(i.blendFunction,de.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bn;function Mn(m,i,c,g,v,w,S){const k=m.context,L=k.gl,F=m.transform,V=m.getOrCreateProgram("collisionBox"),q=[];let W=0,K=0;for(let Ae=0;Ae<g.length;Ae++){const Be=g[Ae],Le=i.getTile(Be),He=Le.getBucket(c);if(!He)continue;const je=xi(Be,He,F);let Ze=je;v[0]===0&&v[1]===0||(Ze=m.translatePosMatrix(je,Le,v,w));const rt=S?He.textCollisionBox:He.iconCollisionBox,Je=He.collisionCircleArray;if(Je.length>0){const Ye=o.a6.mat4.create(),ht=Ze;o.a6.mat4.mul(Ye,He.placementInvProjMatrix,F.glCoordMatrix),o.a6.mat4.mul(Ye,Ye,He.placementViewportMatrix),q.push({circleArray:Je,circleOffset:K,transform:ht,invTransform:Ye,projection:He.getProjection()}),W+=Je.length/4,K=W}rt&&(m.terrain&&m.terrain.setupElevationDraw(Le,V),V.draw(m,L.LINES,Me.disabled,wt.disabled,m.colorModeForRenderPass(),Dr.disabled,mg(Ze,F,Le,He.getProjection()),c.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,F.zoom,null,[rt.collisionVertexBuffer,rt.collisionVertexBufferExt]))}if(!S||!q.length)return;const ae=m.getOrCreateProgram("collisionCircle"),le=new o.cQ;le.resize(4*W),le._trim();let ue=0;for(const Ae of q)for(let Be=0;Be<Ae.circleArray.length/4;Be++){const Le=4*Be,He=Ae.circleArray[Le+0],je=Ae.circleArray[Le+1],Ze=Ae.circleArray[Le+2],rt=Ae.circleArray[Le+3];le.emplace(ue++,He,je,Ze,rt,0),le.emplace(ue++,He,je,Ze,rt,1),le.emplace(ue++,He,je,Ze,rt,2),le.emplace(ue++,He,je,Ze,rt,3)}(!bn||bn.length<2*W)&&(bn=function(Ae){const Be=2*Ae,Le=new o.aO;Le.resize(Be),Le._trim();for(let He=0;He<Be;He++){const je=6*He;Le.uint16[je+0]=4*He+0,Le.uint16[je+1]=4*He+1,Le.uint16[je+2]=4*He+2,Le.uint16[je+3]=4*He+2,Le.uint16[je+4]=4*He+3,Le.uint16[je+5]=4*He+0}return Le}(W));const pe=k.createIndexBuffer(bn,!0),Re=k.createVertexBuffer(le,o.cR.members,!0);for(const Ae of q){const Be={u_matrix:Ae.transform,u_inv_matrix:Ae.invTransform,u_camera_to_center_distance:(Oe=F).getCameraToCenterDistance(Ae.projection),u_viewport_size:[Oe.width,Oe.height]};ae.draw(m,L.TRIANGLES,Me.disabled,wt.disabled,m.colorModeForRenderPass(),Dr.disabled,Be,c.id,Re,pe,o.b1.simpleSegment(0,2*Ae.circleOffset,Ae.circleArray.length,Ae.circleArray.length/2),null,F.zoom)}var Oe;Re.destroy(),pe.destroy()}const En=o.a6.mat4.create();function Bn(m){const i=m._camera.getWorldToCamera(m.worldSize,1),c=o.a6.mat4.multiply([],i,m.globeMatrix);o.a6.mat4.invert(c,c);const g=[0,0,0],v=[0,1,0,0];return o.a6.vec4.transformMat4(v,v,c),g[0]=v[0],g[1]=v[1],g[2]=v[2],o.a6.vec3.normalize(g,g),g}function ro({width:m,height:i,anchor:c,textOffset:g,textScale:v},w){const{horizontalAlign:S,verticalAlign:k}=o.bx(c),L=-(S-.5)*m,F=-(k-.5)*i,V=o.bw(c,g);return new o.P((L/v+V[0])*w,(F/v+V[1])*w)}function po(m,i,c,g,v,w,S,k,L,F,V){const q=m.text.placedSymbolArray,W=m.text.dynamicLayoutVertexArray,K=m.icon.dynamicLayoutVertexArray,ae={},le=m.getProjection(),ue=fo(k,le,w),pe=w.elevation,Re=le.upVectorScale(k.canonical,w.center.lat,w.worldSize).metersToTile;W.clear();for(let Oe=0;Oe<q.length;Oe++){const Ae=q.get(Oe),{tileAnchorX:Be,tileAnchorY:Le,numGlyphs:He}=Ae,je=Ae.hidden||!Ae.crossTileID||m.allowVerticalPlacement&&!Ae.placedOrientation?null:g[Ae.crossTileID];if(je){let Ze=0,rt=0,Je=0;if(pe){const kt=pe?pe.getAtTileOffset(k,Be,Le):0,[Qt,tr,Nt]=le.upVector(k.canonical,Be,Le);Ze=kt*Qt*Re,rt=kt*tr*Re,Je=kt*Nt*Re}let[Ye,ht,Ct,Ft]=$i(Ae.projectedAnchorX+Ze,Ae.projectedAnchorY+rt,Ae.projectedAnchorZ+Je,c?ue:S);const At=on(w.getCameraToCenterDistance(le),Ft);let Yt=v.evaluateSizeForFeature(m.textSizeData,F,Ae)*At/o.bq;c&&(Yt*=m.tilePixelRatio/L);const dt=ro(je,Yt);c?({x:Ye,y:ht,z:Ct}=le.projectTilePoint(Be+dt.x,Le+dt.y,k.canonical),[Ye,ht,Ct]=$i(Ye+Ze,ht+rt,Ct+Je,S)):(i&&dt._rotate(-w.angle),Ye+=dt.x,ht+=dt.y,Ct=0);const Lt=m.allowVerticalPlacement&&Ae.placedOrientation===o.bk.vertical?Math.PI/2:0;for(let kt=0;kt<He;kt++)o.bn(W,Ye,ht,Ct,Lt);V&&Ae.associatedIconIndex>=0&&(ae[Ae.associatedIconIndex]={x:Ye,y:ht,z:Ct,angle:Lt})}else Dn(He,W)}if(V){K.clear();const Oe=m.icon.placedSymbolArray;for(let Ae=0;Ae<Oe.length;Ae++){const Be=Oe.get(Ae),{numGlyphs:Le}=Be,He=ae[Ae];if(Be.hidden||!He)Dn(Le,K);else{const{x:je,y:Ze,z:rt,angle:Je}=He;for(let Ye=0;Ye<Le;Ye++)o.bn(K,je,Ze,rt,Je)}}m.icon.dynamicLayoutVertexBuffer.updateData(K)}m.text.dynamicLayoutVertexBuffer.updateData(W)}function $n(m,i,c,g,v,w,S={}){const k=c.paint.get("icon-translate"),L=c.paint.get("text-translate"),F=c.paint.get("icon-translate-anchor"),V=c.paint.get("text-translate-anchor"),q=c.layout.get("icon-rotation-alignment"),W=c.layout.get("text-rotation-alignment"),K=c.layout.get("icon-pitch-alignment"),ae=c.layout.get("text-pitch-alignment"),le=c.layout.get("icon-keep-upright"),ue=c.layout.get("text-keep-upright"),pe=c.paint.get("icon-color-saturation"),Re=c.paint.get("icon-color-contrast"),Oe=c.paint.get("icon-color-brightness-min"),Ae=c.paint.get("icon-color-brightness-max"),Be=c.paint.get("symbol-elevation-reference")==="sea",Le=c.paint.get("text-occlusion-opacity").constantOr(0),He=m.context,je=He.gl,Ze=m.transform,rt=q==="map",Je=W==="map",Ye=K==="map",ht=ae==="map",Ct=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ft=!1;const At=m.depthModeForSublayer(0,Me.ReadOnly),Yt=[o.am(Ze.center.lng),o.at(Ze.center.lat)],dt=c.layout.get("text-variable-anchor"),Lt=Ze.projection.name==="globe",kt=[],Qt=[0,-1,0];for(const tr of g){const Nt=i.getTile(tr),Ut=Nt.getBucket(c);if(!Ut||Ut.projection.name==="mercator"&&Lt||Ut.fullyClipped)continue;const Nr=Ut.projection.name==="globe",hr=Nr?o.a9(Ze.zoom):0,Sr=fo(tr,Ut.getProjection(),Ze),Jr=Ze.calculatePixelsToTileUnitsMatrix(Nt),Pr=dt&&Ut.hasTextData(),Hr=Ut.hasIconTextFit()&&Pr&&Ut.hasIconData(),_n=Ut.getProjection().createInversionMatrix(Ze,tr.canonical),pn=vi=>{Ze.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||m.terrain)&&(vi.push("DEPTH_D24"),vi.push("DEPTH_OCCLUSION"))},fi=()=>{const vi=rt&&c.layout.get("symbol-placement")!=="point",mn=[];pn(mn);const Zn=vi||Hr,ci=c.paint.get("icon-image-cross-fade").constantOr(0);m.terrainRenderModeElevated()&&Ye&&mn.push("PITCH_WITH_MAP_TERRAIN"),Nr&&(mn.push("PROJECTION_GLOBE_VIEW"),Zn&&mn.push("PROJECTED_POS_ON_VIEWPORT")),ci>0&&mn.push("ICON_TRANSITION"),Ut.icon.zOffsetVertexBuffer&&mn.push("Z_OFFSET"),pe===0&&Re===0&&Oe===0&&Ae===1||mn.push("COLOR_ADJUSTMENT"),Ut.sdfIcons&&mn.push("RENDER_SDF");const Eo=Ut.icon.programConfigurations.get(c.id),Vo=m.getOrCreateProgram("symbol",{config:Eo,defines:mn}),Nn=Nt.imageAtlasTexture?Nt.imageAtlasTexture.size:[0,0],cs=Ut.iconSizeData,ys=o.bj(cs,Ze.zoom),us=Ye||Ze.pitch!==0,Ni=cn(Sr,Nt.tileID.canonical,Ye,rt,Ze,Ut.getProjection(),Jr),wa=oo(Sr,Nt.tileID.canonical,Ye,rt,Ze,Ut.getProjection(),Jr),Ta=m.translatePosMatrix(wa,Nt,k,F,!0),pl=m.translatePosMatrix(Sr,Nt,k,F),nl=Zn?En:Ni,za=rt&&!Ye&&!vi;let ml=Qt;!Lt&&!Ze.mercatorFromTransition||rt||(ml=Bn(Ze));const Sc=Nr?ml:Qt,ou=c.getColorAdjustmentMatrix(pe,Re,Oe,Ae),Jl=$(cs.kind,ys,za,Ye,m,pl,nl,Ta,Be,!1,Nn,[0,0],!0,tr,hr,Yt,_n,Sc,Ut.getProjection(),ou,ci),Kh=Nt.imageAtlasTexture?Nt.imageAtlasTexture:null,Xh=c.layout.get("icon-size").constantOr(0)!==1||Ut.iconsNeedLinear,Zp=Ut.sdfIcons||m.options.rotating||m.options.zooming||Xh||us?je.LINEAR:je.NEAREST,Yh=Ut.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Fi=m.terrain&&Ye&&vi?o.a6.mat4.invert(o.a6.mat4.create(),Ni):En;if(vi&&Ut.icon){const Wu=Ze.elevation,ax=Wu?Wu.getAtTileOffsetFunc(tr,Ze.center.lat,Ze.worldSize,Ut.getProjection()):null,Qy=fn(Sr,Nt.tileID.canonical,Ye,rt,Ze,Ut.getProjection(),Jr);ss(Ut,Sr,m,!1,Qy,wa,Ye,le,ax,tr)}return{program:Vo,buffers:Ut.icon,uniformValues:Jl,atlasTexture:Kh,atlasTextureIcon:null,atlasInterpolation:Zp,atlasInterpolationIcon:null,isSDF:Ut.sdfIcons,hasHalo:Yh,tile:Nt,labelPlaneMatrixInv:Fi}},Ti=()=>{const vi=Je&&c.layout.get("symbol-placement")!=="point",mn=[],Zn=vi||dt||Hr;m.terrainRenderModeElevated()&&ht&&mn.push("PITCH_WITH_MAP_TERRAIN"),Nr&&(mn.push("PROJECTION_GLOBE_VIEW"),Zn&&mn.push("PROJECTED_POS_ON_VIEWPORT")),Ut.text.zOffsetVertexBuffer&&mn.push("Z_OFFSET"),Ut.iconsInText&&mn.push("RENDER_TEXT_AND_SYMBOL"),mn.push("RENDER_SDF"),pn(mn);const ci=Ut.text.programConfigurations.get(c.id),Eo=m.getOrCreateProgram("symbol",{config:ci,defines:mn});let Vo,Nn=[0,0],cs=null;const ys=Ut.textSizeData;Ut.iconsInText&&(Nn=Nt.imageAtlasTexture?Nt.imageAtlasTexture.size:[0,0],cs=Nt.imageAtlasTexture?Nt.imageAtlasTexture:null,Vo=ht||Ze.pitch!==0||m.options.rotating||m.options.zooming||ys.kind==="composite"||ys.kind==="camera"?je.LINEAR:je.NEAREST);const us=Nt.glyphAtlasTexture?Nt.glyphAtlasTexture.size:[0,0],Ni=o.bj(ys,Ze.zoom),wa=cn(Sr,Nt.tileID.canonical,ht,Je,Ze,Ut.getProjection(),Jr),Ta=oo(Sr,Nt.tileID.canonical,ht,Je,Ze,Ut.getProjection(),Jr),pl=m.translatePosMatrix(Ta,Nt,L,V,!0),nl=m.translatePosMatrix(Sr,Nt,L,V),za=Zn?En:wa,ml=Je&&!ht&&!vi;let Sc=Qt;!Lt&&!Ze.mercatorFromTransition||Je||(Sc=Bn(Ze));const ou=$(ys.kind,Ni,ml,ht,m,nl,za,pl,Be,!0,us,Nn,!0,tr,hr,Yt,_n,Nr?Sc:Qt,Ut.getProjection(),Le),Jl=Nt.glyphAtlasTexture?Nt.glyphAtlasTexture:null,Kh=je.LINEAR,Xh=c.paint.get("text-halo-width").constantOr(1)!==0,Zp=m.terrain&&ht&&vi?o.a6.mat4.invert(o.a6.mat4.create(),wa):En;if(vi&&Ut.text){const Yh=Ze.elevation,Fi=Yh?Yh.getAtTileOffsetFunc(tr,Ze.center.lat,Ze.worldSize,Ut.getProjection()):null,Wu=fn(Sr,Nt.tileID.canonical,ht,Je,Ze,Ut.getProjection(),Jr);ss(Ut,Sr,m,!0,Wu,Ta,ht,ue,Fi,tr)}return{program:Eo,buffers:Ut.text,uniformValues:ou,atlasTexture:Jl,atlasTextureIcon:cs,atlasInterpolation:Kh,atlasInterpolationIcon:Vo,isSDF:!0,hasHalo:Xh,tile:Nt,labelPlaneMatrixInv:Zp}},Hi=Ut.icon.segments.get().length,fl=Ut.text.segments.get().length,Fo=Hi&&!S.onlyText?fi():null,Cn=fl&&!S.onlyIcons?Ti():null,bi=c.paint.get("icon-opacity").constantOr(1),lo=c.paint.get("text-opacity").constantOr(1);if(Ct&&Ut.canOverlap){Ft=!0;const vi=bi&&!S.onlyText?Ut.icon.segments.get():[],mn=lo&&!S.onlyIcons?Ut.text.segments.get():[];for(const Zn of vi)kt.push({segments:new o.b1([Zn]),sortKey:Zn.sortKey,state:Fo});for(const Zn of mn)kt.push({segments:new o.b1([Zn]),sortKey:Zn.sortKey,state:Cn})}else S.onlyText||kt.push({segments:bi?Ut.icon.segments:new o.b1([]),sortKey:0,state:Fo}),S.onlyIcons||kt.push({segments:lo?Ut.text.segments:new o.b1([]),sortKey:0,state:Cn})}Ft&&kt.sort((tr,Nt)=>tr.sortKey-Nt.sortKey);for(const tr of kt){const Nt=tr.state;if(Nt)if(m.terrain?m.terrain.setupElevationDraw(Nt.tile,Nt.program,{useDepthForOcclusion:Ze.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Nt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(Ze.depthOcclusionForSymbolsAndCircles,Nt.program),He.activeTexture.set(je.TEXTURE0),Nt.atlasTexture&&Nt.atlasTexture.bind(Nt.atlasInterpolation,je.CLAMP_TO_EDGE,!0),Nt.atlasTextureIcon&&(He.activeTexture.set(je.TEXTURE1),Nt.atlasTextureIcon&&Nt.atlasTextureIcon.bind(Nt.atlasInterpolationIcon,je.CLAMP_TO_EDGE,!0)),m.uploadCommonLightUniforms(m.context,Nt.program),Nt.hasHalo){const Ut=Nt.uniformValues;Ut.u_is_halo=1,_i(Nt.buffers,tr.segments,c,m,Nt.program,At,v,w,Ut,2),Ut.u_is_halo=0}else{if(Nt.isSDF){const Ut=Nt.uniformValues;Nt.hasHalo&&(Ut.u_is_halo=1,_i(Nt.buffers,tr.segments,c,m,Nt.program,At,v,w,Ut,1)),Ut.u_is_halo=0}_i(Nt.buffers,tr.segments,c,m,Nt.program,At,v,w,Nt.uniformValues,1)}}}function _i(m,i,c,g,v,w,S,k,L,F){const V=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer];v.draw(g,g.context.gl.TRIANGLES,w,S,k,Dr.disabled,L,c.id,m.layoutVertexBuffer,m.indexBuffer,i,c.paint,g.transform.zoom,m.programConfigurations.get(c.id),V,F)}function Vn(m,i,c,g,v,w,S){const k=m.context.gl,L=c.paint.get("fill-pattern"),F=c.is3D(),V=F?m.stencilModeFor3D():wt.disabled,q=L&&L.constantOr(1);let W,K,ae,le,ue;S?(K=q&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",W=k.LINES):(K=q?"fillPattern":"fill",W=k.TRIANGLES);for(const pe of g){const Re=i.getTile(pe);if(q&&!Re.patternsLoaded())continue;const Oe=Re.getBucket(c);if(!Oe)continue;m.prepareDrawTile();const Ae=Oe.programConfigurations.get(c.id),Be=m.isTileAffectedByFog(pe),Le=m.getOrCreateProgram(K,{config:Ae,overrideFog:Be});q&&(m.context.activeTexture.set(k.TEXTURE0),Re.imageAtlasTexture&&Re.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ae.updatePaintBuffers());const He=L.constantOr(null);if(He&&Re.imageAtlas){const rt=Re.imageAtlas.patternPositions[He.toString()];rt&&Ae.setConstantPatternPositions(rt)}const je=m.translatePosMatrix(pe.projMatrix,Re,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Ze=c.paint.get("fill-emissive-strength");if(S){le=Oe.indexBuffer2,ue=Oe.segments2;const rt=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ae=K==="fillOutlinePattern"&&q?Fu(je,Ze,m,Re,rt):Mp(je,Ze,rt)}else le=Oe.indexBuffer,ue=Oe.segments,ae=q?Ll(je,Ze,m,Re):hl(je,Ze);m.uploadCommonUniforms(m.context,Le,pe.toUnwrapped()),Le.draw(m,W,v,F?V:m.stencilModeForClipping(pe),w,Dr.disabled,ae,c.id,Oe.layoutVertexBuffer,le,ue,c.paint,m.transform.zoom,Ae,void 0)}}function Xn(m,i,c,g,v,w,S,k){c.resetLayerRenderingStats(m);const L=m.context,F=L.gl,V=m.transform,q=c.paint.get("fill-extrusion-pattern"),W=q.constantOr(1),K=c.paint.get("fill-extrusion-opacity"),ae=m.style.enable3dLights(),le=c.paint.get(ae&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ue=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),le],pe=c.layout.get("fill-extrusion-edge-radius"),Re=pe>0&&!c.paint.get("fill-extrusion-rounded-roof"),Oe=Re?0:pe,Ae=V.projection.name==="globe"?o.c_():0,Be=V.projection.name==="globe",Le=Be?o.a9(V.zoom):0,He=[o.am(V.center.lng),o.at(V.center.lat)],je=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),Ze=c.paint.get("fill-extrusion-flood-light-intensity"),rt=c.paint.get("fill-extrusion-vertical-scale"),Je=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ye=kl(m,c.paint.get("fill-extrusion-cutoff-fade-range")),ht=[];let Ct;Be&&ht.push("PROJECTION_GLOBE_VIEW"),ue[0]>0&&ht.push("FAUX_AO"),Re&&ht.push("ZERO_ROOF_RADIUS"),k&&ht.push("HAS_CENTROID"),Ze>0&&ht.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&ht.push("RENDER_CUTOFF"),Je&&ht.push("RENDER_WALL_MODE");const Ft=m.renderPass==="shadow",At=m.shadowRenderer,Yt=Ft&&!!At;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let dt=[0,0,0];if(At){const Qt=m.style.directionalLight,tr=m.style.ambientLight;Qt&&tr&&(dt=lc(m.style,Qt,tr)),Ct=ht.concat(["SHADOWS_SINGLE_CASCADE"])}const Lt=Yt?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",kt=c.getLayerRenderingStats();for(const Qt of g){const tr=i.getTile(Qt),Nt=tr.getBucket(c);if(!Nt||Nt.projection.name!==V.projection.name)continue;let Ut=!1;At&&(Ut=At.getMaxCascadeForTile(Qt.toUnwrapped())===0);const Nr=m.isTileAffectedByFog(Qt),hr=Nt.programConfigurations.get(c.id),Sr=m.getOrCreateProgram(Lt,{config:hr,defines:Ut?Ct:ht,overrideFog:Nr});if(m.terrain&&m.terrain.setupElevationDraw(tr,Sr,{useMeterToDem:!0}),!Nt.centroidVertexBuffer){const Ti=Sr.attributes.a_centroid_pos;Ti!==void 0&&F.vertexAttrib2f(Ti,0,0)}!Ft&&At&&At.setupShadows(tr.tileID.toUnwrapped(),Sr,"vector-tile",tr.tileID.overscaledZ),W&&(m.context.activeTexture.set(F.TEXTURE0),tr.imageAtlasTexture&&tr.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),hr.updatePaintBuffers());const Jr=q.constantOr(null);if(Jr&&tr.imageAtlas){const Ti=tr.imageAtlas.patternPositions[Jr.toString()];Ti&&hr.setConstantPatternPositions(Ti)}const Pr=c.paint.get("fill-extrusion-vertical-gradient"),Hr=1/Nt.tileToMeter;let _n;if(Ft&&At){if(ba(tr.tileID,Nt,m))continue;const Ti=At.calculateShadowPassMatrixFromTile(tr.tileID.toUnwrapped());_n=Nh(Ti,Oe,Hr,rt)}else{const Ti=m.translatePosMatrix(Qt.expandedProjMatrix,tr,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Hi=V.projection.createInversionMatrix(V,Qt.canonical);_n=W?ff(Ti,m,Pr,K,ue,Oe,Hr,Qt,tr,Ae,Le,He,Hi,je,rt):zh(Ti,m,Pr,K,ue,Oe,Hr,Qt,Ae,Le,He,Hi,je,rt,Ze,dt)}m.uploadCommonUniforms(L,Sr,Qt.toUnwrapped(),null,Ye);let pn=Nt.segments;if(V.projection.name==="mercator"&&!Ft&&(pn=Nt.getVisibleSegments(tr.tileID,m.terrain,m.transform.getFrustum(0)),!pn.get().length))continue;if(kt)if(Ft)for(const Ti of pn.get())kt.numRenderedVerticesInShadowPass+=Ti.primitiveLength;else for(const Ti of pn.get())kt.numRenderedVerticesInTransparentPass+=Ti.primitiveLength;const fi=[];(m.terrain||k)&&fi.push(Nt.centroidVertexBuffer),Be&&fi.push(Nt.layoutVertexExtBuffer),Je&&fi.push(Nt.wallVertexBuffer),Sr.draw(m,L.gl.TRIANGLES,v,w,S,Dr.backCCW,_n,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,pn,c.paint,m.transform.zoom,hr,fi)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}function kn(m,i,c,g,v,w,S,k,L,F,V,q,W,K,ae,le,ue,pe,Re){const Oe=m.context,Ae=Oe.gl,Be=m.transform,Le=m.transform.zoom,He=[],je=kl(m,c.paint.get("fill-extrusion-cutoff-fade-range"));F==="clear"?(He.push("CLEAR_SUBPASS"),Re&&(He.push("CLEAR_FROM_TEXTURE"),Oe.activeTexture.set(Ae.TEXTURE0),Re.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE))):F==="sdf"&&He.push("SDF_SUBPASS"),ue&&He.push("HAS_CENTROID"),je.shouldRenderCutoff&&He.push("RENDER_CUTOFF");const Ze=c.layout.get("fill-extrusion-edge-radius"),rt=(Je,Ye,ht,Ct,Ft)=>{const At=Ye.programConfigurations.get(c.id),Yt=m.isTileAffectedByFog(Je),dt=m.getOrCreateProgram("fillExtrusionGroundEffect",{config:At,defines:He,overrideFog:Yt}),Lt=((Qt,tr,Nt,Ut,Nr,hr,Sr,Jr,Pr,Hr,_n)=>({u_matrix:tr,u_opacity:Nt,u_ao_pass:Ut?1:0,u_meter_to_tile:Nr,u_ao:hr,u_flood_light_intensity:Sr,u_flood_light_color:Jr,u_attenuation:Pr,u_edge_radius:Hr,u_fb:0,u_fb_size:_n,u_dynamic_offset:1}))(0,Ct,V,L,Ft,[q,W*Ft],K,ae,le,Le>=17?0:Ze*Ft,Re?Re.size[0]:0),kt=[];ue&&kt.push(Ye.hiddenByLandmarkVertexBuffer),m.uploadCommonUniforms(Oe,dt,Je.toUnwrapped(),null,je),dt.draw(m,Oe.gl.TRIANGLES,v,w,S,k,Lt,c.id,Ye.vertexBuffer,Ye.indexBuffer,ht,c.paint,Le,At,kt)};for(const Je of g){const Ye=i.getTile(Je),ht=Ye.getBucket(c);if(!ht||ht.projection.name!==Be.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const Ct=ht.groundEffect,Ft=1/ht.tileToMeter;{const At=m.translatePosMatrix(Je.projMatrix,Ye,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Yt=Ct.getDefaultSegment();rt(Je,Ct,Yt,At,Ft)}if(pe)for(let At=0;At<4;At++){const Yt=o.c$[At](Je),dt=i.getTile(Yt);if(!dt)continue;const Lt=dt.getBucket(c);if(!Lt||Lt.projection.name!==Be.projection.name||!Lt.groundEffect||Lt.groundEffect&&!Lt.groundEffect.hasData())continue;const kt=Lt.groundEffect;let Qt,tr;At===0?(Qt=[-o.ab,0,0],tr=1):At===1?(Qt=[o.ab,0,0],tr=0):At===2?(Qt=[0,-o.ab,0],tr=3):(Qt=[0,o.ab,0],tr=2);const Nt=kt.regionSegments[tr];if(!Nt)continue;const Ut=new Float32Array(16);o.a6.mat4.translate(Ut,Je.projMatrix,Qt),rt(Je,kt,Nt,m.translatePosMatrix(Ut,Ye,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ft)}}}function yi(m,i,c,g,v,w,S){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const k=w?w.findDEMTileFor(c):null;if(!(k&&k.dem||S))return;const L=pe=>new o.P(Math.ceil((pe+o.d2)*o.d3),0),F=pe=>{const Re=i.getSource().minzoom,Oe=Be=>{const Le=i.getTileByID(Be);if(Le&&Le.hasData())return Le.getBucket(v)},Ae=[0,-1,1];for(const Be of Ae){if(pe.overscaledZ+Be<Re)continue;const Le=Oe(pe.calculateScaledKey(pe.overscaledZ+Be));if(Le)return Le}},V=[0,0,0],q=(pe,Re)=>(V[0]=Math.min(pe.min.y,Re.min.y),V[1]=Math.max(pe.max.y,Re.max.y),V[2]=o.ab-Re.min.x>pe.max.x?Re.min.x-o.ab:pe.max.x,V),W=(pe,Re)=>(V[0]=Math.min(pe.min.x,Re.min.x),V[1]=Math.max(pe.max.x,Re.max.x),V[2]=o.ab-Re.min.y>pe.max.y?Re.min.y-o.ab:pe.max.y,V),K=[(pe,Re)=>q(pe,Re),(pe,Re)=>q(Re,pe),(pe,Re)=>W(pe,Re),(pe,Re)=>W(Re,pe)],ae=(pe,Re,Oe,Ae,Be,Le,He)=>{if(!w)return 0;const je=[[Le?Oe:pe,Le?pe:Oe,0],[Le?Oe:Re,Le?Re:Oe,0]],Ze=He<0?o.ab+He:He,rt=[Le?Ze:(pe+Re)/2,Le?(pe+Re)/2:Ze,0];return Oe===0&&He<0||Oe!==0&&He>0?w.getForTilePoints(Be,[rt],!0,Ae):je.push(rt),w.getForTilePoints(c,je,!0,k),Math.max(je[0][2],je[1][2],rt[2])/w.exaggeration()};for(let pe=0;pe<4;pe++){const Re=g.borderFeatureIndices[pe];if(Re.length===0)continue;const Oe=o.c$[pe](c),Ae=F(Oe);if(!(Ae&&Ae instanceof o.d0)||g.borderDoneWithNeighborZ[pe]===Ae.canonical.z)continue;Ae.centroidVertexArray.length===0&&Ae.createCentroidsBuffer();const Be=w?w.findDEMTileFor(Oe):null;if(!(Be&&Be.dem||S))continue;const Le=(pe<2?1:5)-pe,He=Ae.borderDoneWithNeighborZ[Le]!==g.canonical.z,je=Ae.borderFeatureIndices[Le];let Ze=0;if(g.canonical.z!==Ae.canonical.z){for(const rt of Re)g.showCentroid(g.featuresOnBorder[rt]);if(He)for(const rt of je)Ae.showCentroid(Ae.featuresOnBorder[rt]);g.borderDoneWithNeighborZ[pe]=Ae.canonical.z,Ae.borderDoneWithNeighborZ[Le]=g.canonical.z}for(const rt of Re){const Je=g.featuresOnBorder[rt],Ye=g.centroidData[Je.centroidDataIndex],ht=Je.borders[pe];let Ct;for(;Ze<je.length;){Ct=Ae.featuresOnBorder[je[Ze]];const Ft=Ct.borders[Le];if(Ft[1]>ht[0]+3||Ft[0]>ht[0]-3)break;Ae.showCentroid(Ct),Ze++}if(Ct&&Ze<je.length){const Ft=Ze;let At=0;for(;!(Ct.borders[Le][0]>ht[1]-3)&&(At++,++Ze!==je.length);)Ct=Ae.featuresOnBorder[je[Ze]];Ct=Ae.featuresOnBorder[je[Ft]];let Yt=!1;if(At>=1){const kt=Ct.borders[Le];Math.abs(ht[0]-kt[0])<3&&Math.abs(ht[1]-kt[1])<3&&(At=1,Yt=!0,Ze=Ft+1)}else if(At===0){g.showCentroid(Je);continue}const dt=Ae.centroidData[Ct.centroidDataIndex];S&&Yt&&(((le=Ye).flags|(ue=dt).flags)&o.d1?(le.flags|=o.d1,ue.flags|=o.d1):(le.flags&=~o.d1,ue.flags&=~o.d1));const Lt=Je.intersectsCount()>1||Ct.intersectsCount()>1;if(At>1)Ze=Ft,Ye.centroidXY=dt.centroidXY=new o.P(0,0);else if(Be&&Be.dem&&!Lt){const kt=K[pe](Ye,dt),Qt=pe%2?o.ab-1:0,tr=ae(kt[0],Math.min(o.ab-1,kt[1]),Qt,Be,Oe,pe<2,kt[2]);Ye.centroidXY=dt.centroidXY=L(tr)}else Lt?Ye.centroidXY=dt.centroidXY=new o.P(0,0):(Ye.centroidXY=g.encodeBorderCentroid(Je),dt.centroidXY=Ae.encodeBorderCentroid(Ct));g.writeCentroidToBuffer(Ye),Ae.writeCentroidToBuffer(dt)}else g.showCentroid(Je)}g.borderDoneWithNeighborZ[pe]=Ae.canonical.z,Ae.borderDoneWithNeighborZ[Le]=g.canonical.z}var le,ue;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const Gi=[1,0,0],Po=[0,1,0],Us=[0,0,1];function ba(m,i,c){const g=c.transform,v=c.shadowRenderer;if(!v)return!0;const w=m.toUnwrapped(),S=g.tileSize*v._cascades[c.currentShadowCascade].scale;let k=i.maxHeight;if(g.elevation){const le=g.elevation.getMinMaxForTile(m);le&&(k+=le.max)}const L=[...v.shadowDirection];L[2]=-L[2];const F=v.computeSimplifiedTileShadowVolume(w,k,S,L);if(!F)return!1;const V=[Gi,Po,Us,L,[L[0],0,L[2]],[0,L[1],L[2]]],q=g.projection.name==="globe",W=g.scaleZoom(S),K=o.bN.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,W,!q),ae=v.getCurrentCascadeFrustum();return K.intersectsPrecise(F.vertices,F.planes,V)===0||ae.intersectsPrecise(F.vertices,F.planes,V)===0}function xs(m){return[m[0]*o.d4,m[1]*o.d4,m[2]*o.d4,0]}function vo(m,i,c,g,v,w,S,k,L){const F=g.getSource(),V=c.globeSharedBuffers;if(!V)return;let q,W,K;if(i&&(q=g.getTile(i)),F instanceof o.aD?(W=F.texture,K=o.cD(0,0,c.transform)):q&&i&&(W=q.texture,K=o.cD(i.canonical.z,i.canonical.x,c.transform)),!W||!K)return;m||(K=o.a6.mat4.scale(o.a6.mat4.create(),K,[1,-1,1]));const ae=c.context,le=ae.gl,ue=v.paint.get("raster-resampling")==="nearest"?le.NEAREST:le.LINEAR,pe=c.colorModeForDrapableLayerRenderPass(w),Re=S.defines;Re.push("GLOBE_POLES");const Oe=new Me(le.LEQUAL,Me.ReadWrite,c.depthRangeFor3D),Ae=Float32Array.from(c.transform.expandedFarZProjMatrix),Be=Float32Array.from(o.b5(o.cC(new o.bP(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ae.activeTexture.set(le.TEXTURE0),W.bind(ue,le.CLAMP_TO_EDGE),ae.activeTexture.set(le.TEXTURE1),W.bind(ue,le.CLAMP_TO_EDGE),W.useMipmap&&ae.extTextureFilterAnisotropic&&c.transform.pitch>20&&le.texParameterf(le.TEXTURE_2D,ae.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ae.extTextureFilterAnisotropicMax);const[Le,He,je,Ze]=i?V.getPoleBuffers(i.canonical.z,!1):V.getPoleBuffers(0,!0),rt=v.paint.get("raster-elevation");let Je;m?(Je=Le,c.renderDefaultNorthPole=rt!==0):(Je=He,c.renderDefaultSouthPole=rt!==0);const Ye=xs(S.mix),ht=((Ft,At,Yt,dt,Lt,kt,Qt,tr,Nt,Ut,Nr,hr,Sr)=>Yc(Ft,At,Yt,new Float32Array(16),new Float32Array(9),[0,0],dt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},kt,[0,0],tr,2,Ut,Nr,hr,1,0,Sr))(Ae,Be,K,o.a9(c.transform.zoom),0,v,0,rt,0,Ye,S.offset,S.range,w),Ct=c.getOrCreateProgram("raster",{defines:Re});c.uploadCommonUniforms(ae,Ct,null),Ct.draw(c,le.TRIANGLES,Oe,L,pe,k,ht,v.id,Je,je,Ze)}function li(m){const i=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-i,v=.2*m.height,w=i+v;return[i,c,(w-v-i)/g,(w-i)/g]}function bo(m,i,c,g){if(m)return i instanceof Xs&&m instanceof ei?i.getTextureDescriptor(m,c,!0):{texture:m.texture,mix:xs(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Da=o.d5([{name:"a_index",type:"Int16",components:1}]);class el{constructor(i,c,g,v){const w={width:g[0],height:g[1],data:null},S=i.gl;this.targetColorTexture=new o.T(i,w,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(i,w,S.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(c,v),this.lastInvalidatedAt=0}updateParticleTexture(i,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,v=c.width*c.height;this.particleTexture0=new o.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,g.RGBA8,{premultiply:!1,useMipmap:!1});const w=new o.d6;w.reserve(v);for(let S=0;S<v;S++)w.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(w,Da.members,!0),this.particleSegment=o.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function pc(m,i,c){if(!m)return null;const g=i.getTextureDescriptor(m,c,!0);if(!g)return null;let{texture:v,mix:w,offset:S,tileSize:k,buffer:L,format:F}=g;if(!v||!F)return null;let V=!1;return F==="uint32"&&(V=!0,w[3]=0,w=Fh(o.d7,w,[0,c.paint.get("raster-particle-max-speed")]),S=Vh(o.d7,S,[0,c.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[L/(k+2*L),k/(k+2*L)],tileSize:k,scalarData:V,scale:w,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[F]]}}function ls(m){const i=m._nearZ,c=m.projection.farthestPixelDistance(m),g=c-i,v=.2*m.height,w=i+v;return[i,c,(w-v-i)/g,(w-i)/g]}const ao=new o.bz(1,0,0,1),Qo=new o.bz(0,1,0,1),ws=new o.bz(0,0,1,1),Xt=new o.bz(1,0,1,1),Mr=new o.bz(0,1,1,1);function La(m,i,c,g,v,w,S){const k=m.context,L=m.transform,F=k.gl,V=L.projection.name==="globe",q=V?["PROJECTION_GLOBE_VIEW"]:[];let W=o.a6.mat4.clone(c.projMatrix);if(V&&o.a9(L.zoom)>0){const Ye=o.b4(c.canonical,L),ht=o.d8(Ye);W=o.a6.mat4.multiply(new Float32Array(16),L.globeMatrix,ht),o.a6.mat4.multiply(W,L.projMatrix,W)}const K=o.a6.mat4.create();K[12]+=2*v/(o.q.devicePixelRatio*L.width),K[13]+=2*w/(o.q.devicePixelRatio*L.height),o.a6.mat4.multiply(W,K,W);const ae=m.getOrCreateProgram("debug",{defines:q}),le=i.getTileByID(c.key);m.terrain&&m.terrain.setupElevationDraw(le,ae);const ue=Me.disabled,pe=wt.disabled,Re=m.colorModeForRenderPass(),Oe="$debug";k.activeTexture.set(F.TEXTURE0),m.emptyTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),V?le._makeGlobeTileDebugBuffers(m.context,L):le._makeDebugTileBoundsBuffers(m.context,L.projection);const Ae=le._tileDebugBuffer||m.debugBuffer,Be=le._tileDebugIndexBuffer||m.debugIndexBuffer,Le=le._tileDebugSegments||m.debugSegments;if(ae.draw(m,F.LINE_STRIP,ue,pe,Re,Dr.disabled,kp(W,g),Oe,Ae,Be,Le,null,null,null,[le._globeTileDebugBorderBuffer]),S){const Ye=le.latestRawTileData,ht=Math.floor((Ye&&Ye.byteLength||0)/1024);let Ct=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ct+=` => ${c.overscaledZ}`),Ct+=` ${le.state}`,Ct+=` ${ht}kb`,function(Ft,At){Ft.initDebugOverlayCanvas();const Yt=Ft.debugOverlayCanvas,dt=Ft.context.gl,Lt=Ft.debugOverlayCanvas.getContext("2d");Lt.clearRect(0,0,Yt.width,Yt.height),Lt.shadowColor="white",Lt.shadowBlur=2,Lt.lineWidth=1.5,Lt.strokeStyle="white",Lt.textBaseline="top",Lt.font="bold 36px Open Sans, sans-serif",Lt.fillText(At,5,5),Lt.strokeText(At,5,5),Ft.debugOverlayTexture.update(Yt),Ft.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(m,Ct)}const He=i.getTile(c).tileSize,je=512/Math.min(He,512)*(c.overscaledZ/L.zoom)*.5,Ze=le._tileDebugTextBuffer||m.debugBuffer,rt=le._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Je=le._tileDebugTextSegments||m.debugSegments;ae.draw(m,F.TRIANGLES,ue,pe,de.alphaBlended,Dr.disabled,kp(W,o.bz.transparent,je),Oe,Ze,rt,Je,null,null,null,[le._globeTileDebugTextBuffer])}function qi(m,i,c,g){Vu(m,0,i+c/2,m.transform.width,c,g)}function mt(m,i,c,g){Vu(m,i-c/2,0,c,m.transform.height,g)}function Vu(m,i,c,g,v,w){const S=m.context,k=S.gl;k.enable(k.SCISSOR_TEST),k.scissor(i*o.q.devicePixelRatio,c*o.q.devicePixelRatio,g*o.q.devicePixelRatio,v*o.q.devicePixelRatio),S.clear({color:w}),k.disable(k.SCISSOR_TEST)}const jh=o.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Uu}=jh;function tl(m,i,c,g){m.emplaceBack(i,c,g)}class $h{constructor(i){this.vertexArray=new o.d9,this.indices=new o.aO,tl(this.vertexArray,-1,-1,1),tl(this.vertexArray,1,-1,1),tl(this.vertexArray,-1,1,1),tl(this.vertexArray,1,1,1),tl(this.vertexArray,-1,-1,-1),tl(this.vertexArray,1,-1,-1),tl(this.vertexArray,-1,1,-1),tl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Uu),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=o.b1.simpleSegment(0,0,36,12)}}function mc(m,i,c,g,v,w){const S=m.context.gl,k=i.paint.get("sky-atmosphere-color"),L=i.paint.get("sky-atmosphere-halo-color"),F=i.paint.get("sky-atmosphere-sun-intensity"),V=((q,W,K,ae,le)=>({u_matrix_3f:q,u_sun_direction:W,u_sun_intensity:K,u_color_tint_r:[ae.r,ae.g,ae.b,ae.a],u_color_tint_m:[le.r,le.g,le.b,le.a],u_luminance:5e-5}))(o.a6.mat3.fromMat4(o.a6.mat3.create(),g),v,F,k,L);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),c.draw(m,S.TRIANGLES,Me.disabled,wt.disabled,de.unblended,Dr.frontCW,V,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const gc=o.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Lp{constructor(i){const c=new o.da;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const g=new o.aO;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(c,gc.members),this.indexBuffer=i.createIndexBuffer(g),this.segments=o.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const _g=o.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Bp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class dl{constructor(i){this.colorModeAlphaBlendedWriteRGB=new de([1,ee,1,ee],o.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new de([1,0,1,0],o.bz.transparent,[!1,!1,!1,!0]),this.params=new Bp,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const c=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Lp(c);const g=this.params.sizeRange,v=this.params.intensityRange,w=function(V){const q=o.dd(30),W=[];for(let K=0;K<V;++K){const ae=2*Math.PI*q(),le=Math.acos(1-2*q())-.5*Math.PI;W.push(o.a6.vec3.fromValues(Math.cos(le)*Math.cos(ae),Math.cos(le)*Math.sin(ae),Math.sin(le)))}return W}(this.params.starsCount),S=o.dd(300),k=new o.db,L=new o.aO;let F=0;for(let V=0;V<w.length;++V){const q=o.a6.vec3.scale([],w[V],200),W=Math.max(0,1+.01*g*(1*S()-.5)),K=Math.max(0,1+.01*v*(1*S()-.5));k.emplaceBack(q[0],q[1],q[2],-1,-1,W,K),k.emplaceBack(q[0],q[1],q[2],1,-1,W,K),k.emplaceBack(q[0],q[1],q[2],1,1,W,K),k.emplaceBack(q[0],q[1],q[2],-1,1,W,K),L.emplaceBack(F+0,F+1,F+2),L.emplaceBack(F+0,F+2,F+3),F+=4}this.starsVx=c.createVertexBuffer(k,_g.members),this.starsIdx=c.createIndexBuffer(L),this.starsSegments=o.b1.simpleSegment(0,0,k.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,c){const g=i.context,v=g.gl,w=i.transform,S=new Me(v.LEQUAL,Me.ReadOnly,[0,1]),k=o.a9(w.zoom),L=i.style.getLut(c.scope),F=c.properties.get("color").toRenderColor(L).toArray01(),V=c.properties.get("high-color").toRenderColor(L).toArray01(),q=c.properties.get("space-color").toRenderColor(L).toArray01PremultipliedAlpha(),W=5e-4,K=o.dc(c.properties.get("horizon-blend"),0,1,W,.25),ae=o.cx(i,g,w)&&K===W?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,le=i.frameCounter/1e3%1,ue=o.a6.vec3.length(w.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(ue,2)-Math.pow(ae,2)),Re=Math.acos(pe/ue),Oe=Ae=>{const Be=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ae&&Be.push("ALPHA_PASS");const Le=i.getOrCreateProgram("globeAtmosphere",{defines:Be}),He=((Ze,rt,Je,Ye,ht,Ct,Ft,At,Yt,dt,Lt,kt)=>({u_frustum_tl:Ze,u_frustum_tr:rt,u_frustum_br:Je,u_frustum_bl:Ye,u_horizon:ht,u_transition:Ct,u_fadeout_range:Ft,u_color:At,u_high_color:Yt,u_space_color:dt,u_temporal_offset:Lt,u_horizon_angle:kt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,k,K,F,V,q,le,Re);i.uploadCommonUniforms(g,Le);const je=this.atmosphereBuffer;je&&Le.draw(i,v.TRIANGLES,S,wt.disabled,Ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Dr.backCW,He,Ae?"atmosphere_glow_alpha":"atmosphere_glow",je.vertexBuffer,je.indexBuffer,je.segments)};Oe(!1),Oe(!0)}drawStars(i,c){const g=o.ap(c.properties.get("star-intensity"),0,1);if(g===0)return;const v=i.context,w=v.gl,S=i.transform,k=i.getOrCreateProgram("stars"),L=o.a6.quat.identity([]);o.a6.quat.rotateX(L,L,-S._pitch),o.a6.quat.rotateZ(L,L,-S.angle),o.a6.quat.rotateX(L,L,o.bB(S._center.lat)),o.a6.quat.rotateY(L,L,-o.bB(S._center.lng));const F=o.a6.mat4.fromQuat(new Float32Array(16),L),V=o.a6.mat4.multiply([],S.starsProjMatrix,F),q=o.a6.mat3.fromMat4([],F),W=o.a6.mat3.invert([],q),K=[0,1,0];o.a6.vec3.transformMat3(K,K,W),o.a6.vec3.scale(K,K,this.params.sizeMultiplier);const ae=[1,0,0];o.a6.vec3.transformMat3(ae,ae,W),o.a6.vec3.scale(ae,ae,this.params.sizeMultiplier);const le=(ue=K,pe=ae,Re=g,{u_matrix:Float32Array.from(V),u_up:ue,u_right:pe,u_intensity_multiplier:Re});var ue,pe,Re;i.uploadCommonUniforms(v,k),this.starsVx&&this.starsIdx&&k.draw(i,w.TRIANGLES,Me.disabled,wt.disabled,this.colorModeAlphaBlendedWriteRGB,Dr.disabled,le,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function _c(m,i){const c=[...m],g=i.cameraWorldSizeForFog/i.worldSize,v=o.a6.mat4.identity([]);return o.a6.mat4.scale(v,v,[g,g,1]),o.a6.mat4.multiply(c,v,c),o.a6.mat4.multiply(c,i.worldToFogMatrix,c),c}function ju(m,i,c,g,v){const w=c.material,S=g.context,{baseColorTexture:k,metallicRoughnessTexture:L}=w.pbrMetallicRoughness,{normalTexture:F,occlusionTexture:V,emissionTexture:q}=w;function W(K,ae,le){if(K&&(m.push(ae),S.activeTexture.set(S.gl.TEXTURE0+le),K.gfxTexture)){const{minFilter:ue,magFilter:pe,wrapS:Re,wrapT:Oe}=K.sampler;K.gfxTexture.bindExtraParam(ue,pe,Re,Oe)}}W(k,"HAS_TEXTURE_u_baseColorTexture",No.BaseColor),W(L,"HAS_TEXTURE_u_metallicRoughnessTexture",No.MetallicRoughness),W(F,"HAS_TEXTURE_u_normalTexture",No.Normal),W(V,"HAS_TEXTURE_u_occlusionTexture",No.Occlusion),W(q,"HAS_TEXTURE_u_emissionTexture",No.Emission),v&&(v.texture||(v.texture=new o.df(g.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+No.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(c.texcoordBuffer)),c.colorBuffer&&(m.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(c.colorBuffer)),c.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(c.normalBuffer)),c.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||m.push("DIFFUSE_SHADED"),m.push("USE_STANDARD_DERIVATIVES")}function Qc(m,i,c,g,v,w){const S=c.paint.get("model-opacity"),k=i.context,L=new Me(i.context.gl.LEQUAL,Me.ReadWrite,i.depthRangeFor3D),F=i.transform,V=m.mesh,q=V.material,W=q.pbrMetallicRoughness,K=i.style.fog;let ae;ae=i.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:o.a6.mat4.multiply([],g.zScaleMatrix,m.nodeModelMatrix),o.a6.mat4.multiply(ae,g.negCameraPosMatrix,ae);const le=o.a6.mat4.invert([],ae);o.a6.mat4.transpose(le,le);const ue=c.paint.get("model-emissive-strength").constantOr(0),pe=et(new Float32Array(m.worldViewProjection),new Float32Array(ae),new Float32Array(le),null,i,S,W.baseColorFactor.toRenderColor(null),q.emissiveFactor,W.metallicFactor,W.roughnessFactor,q,ue,c),Re={defines:[]},Oe=[];ju(Re.defines,Oe,V,i,c.lut);const Ae=i.shadowRenderer;Ae&&(Ae.useNormalOffset=!1);let Be=null;if(K){const je=_c(m.nodeModelMatrix,i.transform);if(Be=new Float32Array(je),F.projection.name!=="globe"){const Ze=V.aabb.min,rt=V.aabb.max,[Je,Ye]=K.getOpacityForBounds(je,Ze[0],Ze[1],rt[0],rt[1]);Re.overrideFog=Je>=ur||Ye>=ur}}const Le=kl(i,c.paint.get("model-cutoff-fade-range"));Le.shouldRenderCutoff&&Re.defines.push("RENDER_CUTOFF");const He=i.getOrCreateProgram("model",Re);i.uploadCommonUniforms(k,He,null,Be,Le),i.renderPass!=="shadow"&&Ae&&Ae.setupShadowsFromMatrix(m.nodeModelMatrix,He),He.draw(i,k.gl.TRIANGLES,L,v,w,V.material.doubleSided?Dr.disabled:Dr.backCCW,pe,c.id,V.vertexBuffer,V.indexBuffer,V.segments,c.paint,i.transform.zoom,void 0,Oe)}function yc(m,i,c,g,v,w,S){let k;k=m.projection.name==="globe"?o.dg(c,m):[...c],o.a6.mat4.multiply(k,k,i.matrix);const L=o.a6.mat4.multiply([],g,k);if(i.meshes)for(const F of i.meshes){if(F.material.alphaMode!=="BLEND"){S.push({mesh:F,depth:0,modelIndex:v,worldViewProjection:L,nodeModelMatrix:k});continue}const V=o.a6.vec3.transformMat4([],F.centroid,L);V[2]>0&&w.push({mesh:F,depth:V[2],modelIndex:v,worldViewProjection:L,nodeModelMatrix:k})}if(i.children)for(const F of i.children)yc(m,F,c,g,v,w,S)}function vc(m,i,c,g){const v=c.shadowRenderer;if(!v)return;const w=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),k=v.calculateShadowPassMatrixFromMatrix(i),L=Jt(k);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,wt.disabled,S,Dr.backCCW,L,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,c.transform.zoom,void 0,void 0)}function pf(m,i,c){const g=i.updateZoomBasedPaintProperties(),v=function(w,S,k){let L,F,V,q=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&q>0){const W=w.terrain,K=W.findDEMTileFor(k);K&&K.dem?L=o.di.create(W,k,K):q=0}if(q===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),q===S.validForExaggeration&&(q===0||L&&L._demTile&&L._demTile.tileID===S.validForDEMTile.id&&L._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const W in S.instancesPerModel){const K=S.instancesPerModel[W];for(let ae=0;ae<K.instancedDataArray.length;++ae){const le=(L?q*L.getElevationAt(0|K.instancedDataArray.float32[16*ae],0|K.instancedDataArray.float32[16*ae+1],!0,!0):0)+K.instancesEvaluatedElevation[ae];K.instancedDataArray.float32[16*ae+6]=le,F=F?Math.min(S.terrainElevationMin,le):le,V=V?Math.max(S.terrainElevationMax,le):le}}return S.terrainElevationMin=F||0,S.terrainElevationMax=V||0,S.validForExaggeration=q,S.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,i,c);(g||v)&&(i.uploaded=!1,i.upload(m.context))}const Ba={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.c9([0,0,0],[o.ab,o.ab,0])};function zp(m,i){const c=1<<m.canonical.z,g=i.getFreeCameraOptions().position,v=i.elevation,w=m.canonical.x/c,S=(m.canonical.x+1)/c,k=m.canonical.y/c,L=(m.canonical.y+1)/c;let F=i._centerAltitude;if(v){const K=v.getMinMaxForTile(m);K&&K.max>F&&(F=K.max)}const V=o.ap(g.x,w,S)-g.x,q=o.ap(g.y,k,L)-g.y,W=o.bD(F,i.center.lat)-g.z;return i._zoomFromMercatorZ(Math.sqrt(V*V+q*q+W*W))}function Ps(m,i,c,g,v,w,S){const k=m.context,L=m.renderPass==="shadow",F=m.shadowRenderer,V=L&&F?F.getShadowPassDepthMode():new Me(k.gl.LEQUAL,Me.ReadWrite,m.depthRangeFor3D),q=m.isTileAffectedByFog(w);if(c.meshes)for(const W of c.meshes){const K=["MODEL_POSITION_ON_GPU"],ae=[];let le,ue,pe;g.instancedDataArray.length>20&&K.push("INSTANCED_ARRAYS");const Re=kl(m,i.paint.get("model-cutoff-fade-range"));if(Re.shouldRenderCutoff&&K.push("RENDER_CUTOFF"),L&&F)le=m.getOrCreateProgram("modelDepth",{defines:K}),ue=Jt(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(c.matrix)),pe=F.getShadowPassColorMode();else{ju(K,ae,W,m,i.lut),le=m.getOrCreateProgram("model",{defines:K,overrideFog:q});const Ae=W.material,Be=Ae.pbrMetallicRoughness,Le=i.paint.get("model-opacity"),He=i.paint.get("model-emissive-strength").constantOr(0);ue=et(w.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,m,Le,Be.baseColorFactor.toRenderColor(null),Ae.emissiveFactor,Be.metallicFactor,Be.roughnessFactor,Ae,He,i,v),F&&(S.shadowUniformsInitialized?le.setShadowUniformValues(k,F.getShadowUniformValues()):(F.setupShadows(w.toUnwrapped(),le,"model-tile",w.overscaledZ),S.shadowUniformsInitialized=!0)),pe=Re.shouldRenderCutoff||Le<1||Ae.alphaMode!=="OPAQUE"?de.alphaBlended:de.unblended}m.uploadCommonUniforms(k,le,w.toUnwrapped(),null,Re);const Oe=W.material.doubleSided?Dr.disabled:Dr.backCCW;if(g.instancedDataArray.length>20)ae.push(g.instancedDataBuffer),le.draw(m,k.gl.TRIANGLES,V,wt.disabled,pe,Oe,ue,i.id,W.vertexBuffer,W.indexBuffer,W.segments,i.paint,m.transform.zoom,void 0,ae,g.instancedDataArray.length);else{const Ae=L?"u_instance":"u_normal_matrix";for(let Be=0;Be<g.instancedDataArray.length;++Be)ue[Ae]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Be,16),le.draw(m,k.gl.TRIANGLES,V,wt.disabled,pe,Oe,ue,i.id,W.vertexBuffer,W.indexBuffer,W.segments,i.paint,m.transform.zoom,void 0,ae)}}if(c.children)for(const W of c.children)Ps(m,i,W,g,v,w,S)}const yg=[1,-1,1];function bc(m,i,c,g){if(!c.modelManager)return!0;const v=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,S=i.aabb;let k=!0,L=m.maxHeight;if(L===0){let V=0;for(const q in m.instancesPerModel){const W=v.getModel(q,g);W?V=Math.max(V,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):k=!1}L=m.maxScale*V*1.41+m.maxVerticalOffset,k&&(m.maxHeight=L)}S.max[2]=L,S.min[2]+=m.terrainElevationMin,S.max[2]+=m.terrainElevationMax,o.a6.vec3.transformMat4(S.min,S.min,i.tileMatrix),o.a6.vec3.transformMat4(S.max,S.max,i.tileMatrix);const F=S.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=F===2),F===0}function Pi(m,i){const c=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],v=m.uniformValues.u_cutoff_params[2],w=m.uniformValues.u_cutoff_params[3];return g===c||w===v?1:o.ap(((i-c)/(g-c)-v)/(w-v),0,1)}function Wn(m,i,c,g){if(i.pitch<20)return 1;const v=i.getWorldToCameraMatrix();o.a6.mat4.multiply(v,v,m);const w=o.a6.vec4.fromValues(c.min[0],c.min[1],c.min[2],1);let S=o.a6.vec4.transformMat4(o.a6.vec4.create(),w,v),k=S,L=S;w[1]=c.max[1],S=o.a6.vec4.transformMat4(o.a6.vec4.create(),w,v),k=S[1]<k[1]?S:k,L=S[1]>L[1]?S:L,w[0]=c.max[0],S=o.a6.vec4.transformMat4(o.a6.vec4.create(),w,v),k=S[1]<k[1]?S:k,L=S[1]>L[1]?S:L,w[1]=c.min[1],S=o.a6.vec4.transformMat4(o.a6.vec4.create(),w,v),k=S[1]<k[1]?S:k,L=S[1]>L[1]?S:L;const F=o.ap(g[0],0,1),V=100*i.pixelsPerMeter*o.ap(g[1],0,1),q=o.ap(g[2],0,1),W=o.a6.vec4.lerp(o.a6.vec4.create(),k,L,F),K=Math.tan(.5*i.fovX),ae=-W[2]*K;if(V===0)return W[1]<-Math.abs(ae)?q:1;const le=(-Math.abs(ae)-W[1])/V,ue=(Re,Oe,Ae)=>(1-Ae)*Re+Ae*Oe,pe=o.ap(ue(1,q,le),q,1);return ue(1,pe,o.ap((i.pitch-20)/20,0,1))}class Uy{}class eu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,c,g){{const q=this._storage.get(c.id);if(q)return q.lastUsedFrameIdx=i,q.buf}const v=g.gl,w=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(w),k=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const L=new o.dk;for(let q=0;q<w/2;q+=3){const W=k[q],K=k[q+1],ae=k[q+2];L.emplaceBack(W,K),L.emplaceBack(K,ae),L.emplaceBack(ae,W)}const F=g.bindVertexArrayOES.current,V=new Uy;return V.buf=new Ar(g,L),V.lastUsedFrameIdx=i,this._storage.set(c.id,V),g.bindVertexArrayOES.set(F),V.buf}update(i){for(const[c,g]of this._storage)i-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(c))}destroy(){for(const[i,c]of this._storage)c.buf.destroy(),this._storage.delete(i)}}class Np{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const tu={symbol:function(m,i,c,g,v){if(m.renderPass!=="translucent")return;const w=wt.disabled,S=m.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(F,V,q,W,K,ae,le){const ue=V.transform,pe=K==="map",Re=ae==="map";for(const Oe of F){const Ae=W.getTile(Oe),Be=Ae.getBucket(q);if(!Be||!Be.text||!Be.text.segments.get().length)continue;const Le=o.bj(Be.textSizeData,ue.zoom),He=fo(Oe,Be.getProjection(),ue),je=ue.calculatePixelsToTileUnitsMatrix(Ae),Ze=cn(He,Ae.tileID.canonical,Re,pe,ue,Be.getProjection(),je),rt=Be.hasIconTextFit()&&Be.hasIconData();if(Le){const Je=Math.pow(2,ue.zoom-Ae.tileID.overscaledZ);po(Be,pe,Re,le,o.cS,ue,Ze,Oe,Je,Le,rt)}}}(g,m,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v);const k=c.paint.get("icon-opacity").constantOr(1)!==0,L=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||L)?$n(m,i,c,g,w,S):(k&&$n(m,i,c,g,w,S,{onlyIcons:!0}),L&&$n(m,i,c,g,w,S,{onlyText:!0})),i.map.showCollisionBoxes&&(Mn(m,i,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Mn(m,i,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(m,i,c,g){if(m.renderPass!=="translucent")return;const v=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),k=c.layout.get("circle-sort-key").constantOr(1)!==void 0,L=c.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const F=m.context,V=F.gl,q=m.transform,W=m.depthModeForSublayer(0,Me.ReadOnly),K=wt.disabled,ae=m.colorModeForDrapableLayerRenderPass(L),le=q.projection.name==="globe",ue=[o.am(q.center.lng),o.at(q.center.lat)],pe=[];for(let Oe=0;Oe<g.length;Oe++){const Ae=g[Oe],Be=i.getTile(Ae),Le=Be.getBucket(c);if(!Le||Le.projection.name!==q.projection.name)continue;const He=Le.programConfigurations.get(c.id),je=o.cT(c),Ze=m.isTileAffectedByFog(Ae);le&&je.push("PROJECTION_GLOBE_VIEW"),je.push("DEPTH_D24"),m.terrain&&q.depthOcclusionForSymbolsAndCircles&&je.push("DEPTH_OCCLUSION");const rt=m.getOrCreateProgram("circle",{config:He,defines:je,overrideFog:Ze}),Je=Le.layoutVertexBuffer,Ye=Le.globeExtVertexBuffer,ht=Le.indexBuffer,Ct=q.projection.createInversionMatrix(q,Ae.canonical),Ft={programConfiguration:He,program:rt,layoutVertexBuffer:Je,globeExtVertexBuffer:Ye,indexBuffer:ht,uniformValues:o.cU(m,Ae,Be,Ct,ue,c),tile:Be};if(k){const At=Le.segments.get();for(const Yt of At)pe.push({segments:new o.b1([Yt]),sortKey:Yt.sortKey,state:Ft})}else pe.push({segments:Le.segments,sortKey:0,state:Ft})}k&&pe.sort((Oe,Ae)=>Oe.sortKey-Ae.sortKey);const Re={useDepthForOcclusion:q.depthOcclusionForSymbolsAndCircles};for(const Oe of pe){const{programConfiguration:Ae,program:Be,layoutVertexBuffer:Le,globeExtVertexBuffer:He,indexBuffer:je,uniformValues:Ze,tile:rt}=Oe.state,Je=Oe.segments;m.terrain&&m.terrain.setupElevationDraw(rt,Be,Re),m.uploadCommonUniforms(F,Be,rt.tileID.toUnwrapped()),Be.draw(m,V.TRIANGLES,W,K,ae,Dr.disabled,Ze,c.id,Le,je,Je,c.paint,q.zoom,Ae,[He])}},heatmap:function(m,i,c,g){if(c.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const v=m.context,w=v.gl,S=wt.disabled,k=new de([w.ONE,w.ONE,w.ONE,w.ONE],o.bz.transparent,[!0,!0,!0,!0]);(function(K,ae,le,ue){const pe=K.gl,Re=ae.width*ue,Oe=ae.height*ue;K.activeTexture.set(pe.TEXTURE1),K.viewport.set([0,0,Re,Oe]);let Ae=le.heatmapFbo;if(!Ae||Ae&&(Ae.width!==Re||Ae.height!==Oe)){Ae&&Ae.destroy();const Be=pe.createTexture();pe.bindTexture(pe.TEXTURE_2D,Be),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_2D,pe.TEXTURE_MAG_FILTER,pe.LINEAR),Ae=le.heatmapFbo=K.createFramebuffer(Re,Oe,!0,null),function(Le,He,je,Ze,rt,Je){const Ye=Le.gl;Ye.texImage2D(Ye.TEXTURE_2D,0,Le.extRenderToTextureHalfFloat?Ye.RGBA16F:Ye.RGBA,rt,Je,0,Ye.RGBA,Le.extRenderToTextureHalfFloat?Ye.HALF_FLOAT:Ye.UNSIGNED_BYTE,null),Ze.colorAttachment.set(je)}(K,0,Be,Ae,Re,Oe)}else pe.bindTexture(pe.TEXTURE_2D,Ae.colorAttachment.get()),K.bindFramebuffer.set(Ae.framebuffer)})(v,m,c,m.transform.projection.name==="globe"?.5:.25),v.clear({color:o.bz.transparent});const L=m.transform,F=L.projection.name==="globe",V=F?["PROJECTION_GLOBE_VIEW"]:[],q=F?Dr.frontCCW:Dr.disabled,W=[o.am(L.center.lng),o.at(L.center.lat)];for(let K=0;K<g.length;K++){const ae=g[K];if(i.hasRenderableParent(ae))continue;const le=i.getTile(ae),ue=le.getBucket(c);if(!ue||ue.projection.name!==L.projection.name)continue;const pe=m.isTileAffectedByFog(ae),Re=ue.programConfigurations.get(c.id),Oe=m.getOrCreateProgram("heatmap",{config:Re,defines:V,overrideFog:pe}),{zoom:Ae}=m.transform;m.terrain&&m.terrain.setupElevationDraw(le,Oe),m.uploadCommonUniforms(v,Oe,ae.toUnwrapped());const Be=L.projection.createInversionMatrix(L,ae.canonical);Oe.draw(m,w.TRIANGLES,Me.disabled,S,k,q,gg(m,ae,le,Be,W,Ae,c.paint.get("heatmap-intensity")),c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,c.paint,m.transform.zoom,Re,F?[ue.globeExtVertexBuffer]:null)}v.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(v,w){const S=v.context,k=S.gl,L=w.heatmapFbo;if(!L)return;S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get()),S.activeTexture.set(k.TEXTURE1);let F=w.colorRampTexture;F||(F=w.colorRampTexture=new o.T(S,w.colorRamp,k.RGBA8)),F.bind(k.LINEAR,k.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,k.TRIANGLES,Me.disabled,wt.disabled,v.colorModeForRenderPass(),Dr.disabled,((V,q,W,K)=>({u_image:0,u_color_ramp:1,u_opacity:q.paint.get("heatmap-opacity")}))(0,w),w.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,w.paint,v.transform.zoom)}(m,c))},line:function(m,i,c,g){if(m.renderPass!=="translucent")return;const v=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(v.constantOr(1)===0||w.constantOr(1)===0)return;const S=c.paint.get("line-emissive-strength"),k=c.paint.get("line-occlusion-opacity"),L=m.context,F=L.gl,V=c.layout.get("line-z-offset"),q=!V.isConstant()||!!V.constantOr(0),W=q?new Me(m.depthOcclusion?F.GREATER:F.LEQUAL,Me.ReadOnly,m.depthRangeFor3D):m.depthModeForSublayer(0,Me.ReadOnly),K=m.colorModeForDrapableLayerRenderPass(S),ae=m.terrain&&m.terrain.renderingToTexture,le=ae?1:o.q.devicePixelRatio,ue=c.paint.get("line-dasharray"),pe=ue.constantOr(1),Re=c.layout.get("line-cap"),Oe=ue.constantOr(null),Ae=Re.constantOr(null),Be=c.paint.get("line-pattern"),Le=Be.constantOr(1),He=Be.constantOr(null),je=c.paint.get("line-opacity").constantOr(1);let Ze=!Le&&je!==1||m.depthOcclusion&&k>0&&k<1;const rt=c.paint.get("line-gradient"),Je=Le?"linePattern":"line",Ye=o.cV(c);let ht;if(ae&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(Ze=!1),k!==0&&m.depthOcclusion){const Ft=c.paint._values["line-opacity"];Ft&&Ft.value&&Ft.value.kind==="constant"?ht=Ft.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}if(q&&(m.forceTerrainMode=!0),!q&&k!==0&&m.terrain&&!ae)return void o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Ct=Ze&&q?m.stencilModeFor3D():wt.disabled;for(const Ft of g){const At=i.getTile(Ft);if(Le&&!At.patternsLoaded())continue;const Yt=At.getBucket(c);if(!Yt)continue;m.prepareDrawTile();const dt=Yt.programConfigurations.get(c.id),Lt=m.isTileAffectedByFog(Ft),kt=m.getOrCreateProgram(Je,{config:dt,defines:q?[...Ye,"ELEVATED"]:Ye,overrideFog:Lt});if(He&&At.imageAtlas){const hr=At.imageAtlas.patternPositions[He.toString()];hr&&dt.setConstantPatternPositions(hr)}if(!Le&&Oe&&Ae&&At.lineAtlas){const hr=At.lineAtlas.getDash(Oe,Ae);hr&&dt.setConstantPatternPositions(hr)}let[Qt,tr]=c.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Qt!==tr&&(Qt===0&&(Qt-=1),tr===1&&(tr+=1));const Nt=ae?Ft.projMatrix:null,Ut=Le?o.cW(m,At,c,Nt,le,[Qt,tr]):o.cX(m,At,c,Nt,Yt.lineClipsArray.length,le,[Qt,tr]);if(rt){const hr=Yt.gradients[c.id];let Sr=hr.texture;if(c.gradientVersion!==hr.version){let Jr=256;if(c.stepInterpolant){const Pr=i.getSource().maxzoom,Hr=Ft.canonical.z===Pr?Math.ceil(1<<m.transform.maxZoom-Ft.canonical.z):1;Jr=o.ap(o.cY(Yt.maxLineLength/o.ab*1024*Hr),256,L.maxTextureSize)}hr.gradient=o.cZ({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Jr,image:hr.gradient||void 0,clips:Yt.lineClipsArray}),hr.texture?hr.texture.update(hr.gradient):hr.texture=new o.T(L,hr.gradient,F.RGBA8),hr.version=c.gradientVersion,Sr=hr.texture}L.activeTexture.set(F.TEXTURE1),Sr.bind(c.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}pe&&(L.activeTexture.set(F.TEXTURE0),At.lineAtlasTexture&&At.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),dt.updatePaintBuffers()),Le&&(L.activeTexture.set(F.TEXTURE0),At.imageAtlasTexture&&At.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),dt.updatePaintBuffers()),q&&m.terrain.setupElevationDraw(At,kt),m.uploadCommonUniforms(L,kt,Ft.toUnwrapped());const Nr=hr=>{ht!=null&&(ht.value=je*k),kt.draw(m,F.TRIANGLES,W,hr,K,Dr.disabled,Ut,c.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Yt.segments,c.paint,m.transform.zoom,dt,[Yt.layoutVertexBuffer2,Yt.patternVertexBuffer,Yt.zOffsetVertexBuffer]),ht!=null&&(ht.value=je)};if(Ze&&!q){const hr=m.stencilModeForClipping(Ft).ref;hr===0&&ae&&L.clear({stencil:0});const Sr={func:F.EQUAL,mask:255};Ut.u_alpha_discard_threshold=.8,Nr(new wt(Sr,hr,255,F.KEEP,F.KEEP,F.INVERT)),Ut.u_alpha_discard_threshold=0,Nr(new wt(Sr,hr,255,F.KEEP,F.KEEP,F.KEEP))}else Ze&&q&&(Ut.u_alpha_discard_threshold=.001),Nr(q?Ct:m.stencilModeForClipping(Ft))}Ze&&(m.resetStencilClippingMasks(),ae&&L.clear({stencil:0})),k===0||m.depthOcclusion||ae||m.layersWithOcclusionOpacity.push(m.currentLayer),q&&(m.forceTerrainMode=!1)},fill:function(m,i,c,g){const v=c.paint.get("fill-color"),w=c.paint.get("fill-opacity"),S=c.is3D(),k=new Me(m.context.gl.LEQUAL,Me.ReadWrite,m.depthRangeFor3D);if(w.constantOr(1)===0)return;const L=c.paint.get("fill-emissive-strength"),F=m.colorModeForDrapableLayerRenderPass(L),V=c.paint.get("fill-pattern"),q=m.opaquePassEnabledForLayer()&&!V.constantOr(1)&&v.constantOr(o.bz.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===q){const W=S?k:m.depthModeForSublayer(1,m.renderPass==="opaque"?Me.ReadWrite:Me.ReadOnly);Vn(m,i,c,g,W,F,!1)}if(!S&&m.renderPass==="translucent"&&c.paint.get("fill-antialias")){const W=S?k:m.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,Me.ReadOnly);Vn(m,i,c,g,W,F,!0)}},"fill-extrusion":function(m,i,c,g){const v=c.paint.get("fill-extrusion-opacity"),w=m.context,S=w.gl,k=m.terrain,L=k&&k.renderingToTexture;if(v===0)return;const F=m.conflationActive&&m.style.isLayerClipped(c,i.getSource()),V=m.style.order.indexOf(c.fqid);if(F&&function(q,W,K,ae,le){for(const ue of ae){const pe=W.getTile(ue).getBucket(K);pe&&(pe.updateReplacement(ue,q.replacementSource,le),pe.uploadCentroid(q.context))}}(m,i,c,g,V),k||F)for(const q of g){const W=i.getTile(q).getBucket(c);W&&yi(m.context,i,q,W,c,k,F)}if(m.renderPass==="shadow"&&m.shadowRenderer){const q=m.shadowRenderer;if(k&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.a4)return;const W=q.getShadowPassDepthMode(),K=q.getShadowPassColorMode();Xn(m,i,c,g,W,wt.disabled,K,F)}else if(m.renderPass==="translucent"){const q=!c.paint.get("fill-extrusion-pattern").constantOr(1),W=c.paint.get("fill-extrusion-color").constantOr(o.bz.white);if(!L&&W.a!==0){const K=new Me(m.context.gl.LEQUAL,Me.ReadWrite,m.depthRangeFor3D);v===1&&q?Xn(m,i,c,g,K,wt.disabled,de.unblended,F):(Xn(m,i,c,g,K,wt.disabled,de.disabled,F),Xn(m,i,c,g,K,m.stencilModeFor3D(),m.colorModeForRenderPass(),F),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&q&&(!k&&m.transform.projection.name!=="globe"||L)){const K=c.paint.get("fill-extrusion-opacity"),ae=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),le=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ue=c.paint.get("fill-extrusion-flood-light-intensity"),pe=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),Re=ae>0&&le>0,Oe=ue>0,Ae=(Le,He,je)=>(1-je)*Le+je*He,Be=Le=>{const He=m.depthModeForSublayer(1,Me.ReadOnly,S.LEQUAL,!0),je=c.paint.get(Le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ze=Ae(.1,3,je),rt=m._showOverdrawInspector;if(!rt){const Je=new wt({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ye=new de([S.ONE,S.ONE,S.ONE,S.ONE],o.bz.transparent,[!1,!1,!1,!0],S.MIN);kn(m,i,c,g,He,Je,Ye,Dr.disabled,Le,"sdf",K,ae,le,ue,pe,Ze,F,!1)}{const Je=rt?wt.disabled:new wt({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ye=rt?m.colorModeForRenderPass():new de([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.bz.transparent,[!0,!0,!0,!0]);kn(m,i,c,g,He,Je,Ye,Dr.disabled,Le,"color",K,ae,le,ue,pe,Ze,F,!1)}};if(L){const Le=(He,je,Ze)=>{const rt=m.depthModeForSublayer(1,Me.ReadOnly,S.LEQUAL,!1),Je=c.paint.get(He?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=Ae(.1,3,Je);{const ht=new de([S.ONE,S.ONE,S.ONE,S.ONE],o.bz.transparent,[!1,!1,!1,!0]);kn(m,i,c,g,rt,wt.disabled,ht,Dr.disabled,He,"clear",K,ae,le,ue,pe,Ye,F,je)}{const ht=new wt({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Ct=new de([S.ONE,S.ONE,S.ONE,S.ONE],o.bz.transparent,[!1,!1,!1,!0],S.MIN);kn(m,i,c,g,rt,ht,Ct,Dr.disabled,He,"sdf",K,ae,le,ue,pe,Ye,F,je)}{const ht=He?S.ZERO:S.ONE_MINUS_DST_ALPHA,Ct=new wt({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Ft=new de([ht,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.bz.transparent,[!0,!0,!0,!0]);kn(m,i,c,g,rt,Ct,Ft,Dr.disabled,He,"color",K,ae,le,ue,pe,Ye,F,je)}{const ht=new de([S.ONE,S.ONE,S.ONE,He?S.ZERO:S.ONE],o.bz.transparent,[!1,!1,!1,!0],He?S.FUNC_ADD:S.MAX);kn(m,i,c,g,rt,wt.disabled,ht,Dr.disabled,He,"clear",K,ae,le,ue,pe,Ye,F,je,Ze)}};if(Re||Oe){let He;if(m.prepareDrawTile(),k){const je=k.drapeBufferSize[0],Ze=k.drapeBufferSize[1];He=k.framebufferCopyTexture,He&&(!He||He.size[0]===je&&He.size[1]===Ze)||(He&&He.destroy(),He=k.framebufferCopyTexture=new o.T(w,new o.r({width:je,height:Ze}),S.RGBA8)),He.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,je,Ze,0)}Re&&Le(!0,!1,He),Oe&&Le(!1,!0,He)}}else Re&&Be(!0),Oe&&Be(!1),(Re||Oe)&&m.resetStencilClippingMasks()}}},hillshade:function(m,i,c,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const v=m.context,w=m.terrain&&m.terrain.renderingToTexture,[S,k]=m.renderPass!=="translucent"||w?[{},g]:m.stencilConfigForOverlap(g);for(const L of k){const F=i.getTile(L);if(F.needsHillshadePrepare&&m.renderPass==="offscreen")ku(m,F,c);else if(m.renderPass==="translucent"){const V=m.depthModeForSublayer(0,Me.ReadOnly),q=c.paint.get("hillshade-emissive-strength"),W=m.colorModeForDrapableLayerRenderPass(q),K=w&&m.terrain?m.terrain.stencilModeForRTTOverlap(L):S[L.overscaledZ];Mu(m,L,F,c,V,K,W)}}v.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,i,c,g,v,w){if(m.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const S=m.transform.projection.name==="globe",k=c.paint.get("raster-elevation")!==0,L=k&&S;if(m.renderElevatedRasterBackface&&!L)return;const F=m.context,V=F.gl,q=i.getSource(),W=function(Le,He,je,Ze){const rt=He.paint.get("raster-color"),Je=Le.type==="raster-array",Ye=[],ht=He.paint.get("raster-resampling"),Ct=He.paint.get("raster-color-mix");let Ft=He.paint.get("raster-color-range");const At=[Ct[0],Ct[1],Ct[2],0],Yt=Ct[3];let dt=ht==="nearest"?Ze.NEAREST:Ze.LINEAR;if(Je&&(Ye.push("RASTER_ARRAY"),rt||Ye.push("RASTER_COLOR"),ht==="linear"&&Ye.push("RASTER_ARRAY_LINEAR"),dt=Ze.NEAREST,!Ft&&Le.rasterLayers)){const Lt=Le.rasterLayers.find(({id:kt})=>kt===He.sourceLayer);Lt&&Lt.fields&&Lt.fields.range&&(Ft=Lt.fields.range)}if(Ft=Ft||[0,1],rt){Ye.push("RASTER_COLOR"),je.activeTexture.set(Ze.TEXTURE2),He.updateColorRamp(Ft);let Lt=He.colorRampTexture;Lt||(Lt=He.colorRampTexture=new o.T(je,He.colorRamp,Ze.RGBA8)),Lt.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}return{mix:At,range:Ft,offset:Yt,defines:Ye,resampling:dt}}(q,c,F,V);if(q instanceof o.aD&&!g.length&&!S)return;const K=c.paint.get("raster-emissive-strength"),ae=m.colorModeForDrapableLayerRenderPass(K),le=m.terrain&&m.terrain.renderingToTexture,ue=!m.options.moving,pe=c.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;if(q instanceof o.aD&&!g.length&&(q.onNorthPole||q.onSouthPole)){const Le=k?m.stencilModeFor3D():wt.disabled;return void vo(!!q.onNorthPole,null,m,i,c,K,W,Dr.disabled,Le)}if(!g.length)return;const[Re,Oe]=q instanceof o.aD||le?[{},g]:m.stencilConfigForOverlap(g),Ae=Oe[Oe.length-1].overscaledZ;L&&W.defines.push("PROJECTION_GLOBE_VIEW"),k&&W.defines.push("RENDER_CUTOFF");const Be=(Le,He,je)=>{for(const Ze of Le){const rt=Ze.toUnwrapped(),Je=i.getTile(Ze);if(le&&(!Je||!Je.hasData()))continue;F.activeTexture.set(V.TEXTURE0);const Ye=bo(Je,q,c,W);if(!Ye||!Ye.texture)continue;const{texture:ht,mix:Ct,offset:Ft,tileSize:At,buffer:Yt}=Ye;let dt,Lt;le?(dt=Me.disabled,Lt=Ze.projMatrix):k?(dt=new Me(V.LEQUAL,Me.ReadWrite,m.depthRangeFor3D),Lt=S?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(rt,ue)):(dt=m.depthModeForSublayer(Ze.overscaledZ-Ae,c.paint.get("raster-opacity")===1?Me.ReadWrite:Me.ReadOnly,V.LESS),Lt=m.transform.calculateProjMatrix(rt,ue));const kt=m.terrain&&le?m.terrain.stencilModeForRTTOverlap(Ze):Re[Ze.overscaledZ],Qt=w?0:c.paint.get("raster-fade-duration");Je.registerFadeDuration(Qt);const tr=i.findLoadedParent(Ze,0),Nt=Oh(Je,tr,i,m.transform,Qt);let Ut,Nr;m.terrain&&m.terrain.prepareDrawTile(),F.activeTexture.set(V.TEXTURE0),ht.bind(pe,V.CLAMP_TO_EDGE),F.activeTexture.set(V.TEXTURE1),tr?(tr.texture&&tr.texture.bind(pe,V.CLAMP_TO_EDGE),Ut=Math.pow(2,tr.tileID.overscaledZ-Je.tileID.overscaledZ),Nr=[Je.tileID.canonical.x*Ut%1,Je.tileID.canonical.y*Ut%1]):ht.bind(pe,V.CLAMP_TO_EDGE),ht.useMipmap&&F.extTextureFilterAnisotropic&&m.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const hr=m.transform;let Sr;const Jr=k?li(hr):[0,0,0,0];let Pr,Hr,_n,pn,fi,Ti=0;if(L&&q instanceof o.aD&&q.coordinates.length>3)Pr=Float32Array.from(o.b5(o.cC(new o.bP(0,0,0)))),Hr=Float32Array.from(hr.globeMatrix),_n=Float32Array.from(o.cy(hr)),pn=[o.am(hr.center.lng),o.at(hr.center.lat)],Sr=q.elevatedGlobePerspectiveTransform,fi=q.elevatedGlobeGridMatrix||new Float32Array(9);else if(L){const Cn=o.cz(Ze.canonical);Ti=o.cA(Cn.getCenter().lat),Pr=Float32Array.from(o.b5(o.cC(Ze.canonical))),Hr=Float32Array.from(hr.globeMatrix),_n=Float32Array.from(o.cy(hr)),pn=[o.am(hr.center.lng),o.at(hr.center.lat)],Sr=[0,0],fi=Float32Array.from(o.cB(Ze.canonical,Cn,Ti,hr.worldSize/hr._pixelsPerMercatorPixel))}else Sr=q instanceof o.aD?q.perspectiveTransform:[0,0],Pr=new Float32Array(16),Hr=new Float32Array(9),_n=new Float32Array(16),pn=[0,0],fi=new Float32Array(9);const Hi=Yc(Lt,Pr,Hr,_n,fi,Nr||[0,0],o.a9(m.transform.zoom),pn,Jr,Ut||1,Nt,c,Sr,k?c.paint.get("raster-elevation"):0,2,Ct,Ft,W.range,At,Yt,K),fl=m.isTileAffectedByFog(Ze),Fo=m.getOrCreateProgram("raster",{defines:W.defines,overrideFog:fl});if(m.uploadCommonUniforms(F,Fo,rt),q instanceof o.aD){const Cn=q.elevatedGlobeVertexBuffer,bi=q.elevatedGlobeIndexBuffer;if(le||!S)q.boundsBuffer&&q.boundsSegments&&Fo.draw(m,V.TRIANGLES,dt,wt.disabled,ae,Dr.disabled,Hi,c.id,q.boundsBuffer,m.quadTriangleIndexBuffer,q.boundsSegments);else if(Cn&&bi){const lo=hr.zoom<=o.c2?q.elevatedGlobeSegments:q.getSegmentsForLongitude(hr.center.lng);lo&&Fo.draw(m,V.TRIANGLES,dt,wt.disabled,ae,He,Hi,c.id,Cn,bi,lo)}}else if(L){dt=new Me(V.LEQUAL,Me.ReadOnly,m.depthRangeFor3D);const Cn=m.globeSharedBuffers;if(Cn){const[bi,lo,vi]=Cn.getGridBuffers(Ti,!1);Fo.draw(m,V.TRIANGLES,dt,je||kt,m.colorModeForRenderPass(),He,Hi,c.id,bi,lo,vi)}}else{const{tileBoundsBuffer:Cn,tileBoundsIndexBuffer:bi,tileBoundsSegments:lo}=m.getTileBoundsBuffers(Je);Fo.draw(m,V.TRIANGLES,dt,kt,ae,Dr.disabled,Hi,c.id,Cn,bi,lo)}}if(!(q instanceof o.aD)&&L)for(const Ze of Le){const rt=Ze.canonical.y===(1<<Ze.canonical.z)-1;Ze.canonical.y===0&&vo(!0,Ze,m,i,c,K,W,He,je||wt.disabled),rt&&vo(!1,Ze,m,i,c,K,W,He===Dr.frontCW?Dr.backCW:Dr.frontCW,je||wt.disabled)}};L?Be(Oe,m.renderElevatedRasterBackface?Dr.backCW:Dr.frontCW,m.stencilModeFor3D()):Be(Oe,Dr.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,i,c,g,v,w){m.renderPass==="offscreen"&&function(S,k,L,F){if(!F.length)return;const V=S.context,q=V.gl,W=k.getSource();if(!(W instanceof Xs))return;const K=Math.ceil(Math.sqrt(L.paint.get("raster-particle-count")));let ae=L.particlePositionRGBAImage;if(!ae||ae.width!==K){const Oe=function(Ae){const Be=Ae*Ae,Le=new Uint8Array(4*Be),He=function(Ze){return Ze|=0,Ze=Math.imul(2747636419^Ze,2654435769),Ze=Math.imul(Ze^Ze>>>16,2654435769),((Ze=Math.imul(Ze^Ze>>>16,2654435769))>>>0)/4294967296},je=1/1.1;for(let Ze=0;Ze<Be;Ze++){const rt=je*(He(2*Ze+0)+va),Je=je*(He(2*Ze+1)+va),Ye=255*rt%1,ht=255*Je%1,Ct=Ye,Ft=Je-ht/255,At=ht;Le[4*Ze+0]=255*(rt-Ye/255),Le[4*Ze+1]=255*Ct,Le[4*Ze+2]=255*Ft,Le[4*Ze+3]=255*At}return Le}(K);ae=L.particlePositionRGBAImage=new o.r({width:K,height:K},Oe)}let le=L.particleFramebuffer;le?le.width!==K&&(le.destroy(),le=L.particleFramebuffer=V.createFramebuffer(K,K,!0,null)):le=L.particleFramebuffer=V.createFramebuffer(K,K,!0,null);const ue=[];for(const Oe of F){const Ae=k.getTile(Oe);if(!(Ae instanceof ei))continue;const Be=pc(Ae,W,L);if(!Be)continue;const Le=[Ae.tileSize,Ae.tileSize];let He=L.tileFramebuffer;He||(He=L.tileFramebuffer=V.createFramebuffer(Le[0],Le[1],!0,null));let je=Ae.rasterParticleState;je||(je=Ae.rasterParticleState=new el(V,Oe,Le,ae));const Ze=je.update(L.lastInvalidatedAt);je.particleTextureDimension!==K&&je.updateParticleTexture(Oe,ae);const rt=je.targetColorTexture;je.targetColorTexture=je.backgroundColorTexture,je.backgroundColorTexture=rt;const Je=je.particleTexture0;je.particleTexture0=je.particleTexture1,je.particleTexture1=Je,ue.push([Oe,Be,je,Ze])}if(ue.length===0)return;const pe=o.q.now(),Re=L.previousDrawTimestamp?.001*(pe-L.previousDrawTimestamp):.0167;if(L.previousDrawTimestamp=pe,L.hasColorMap()){V.activeTexture.set(q.TEXTURE0+2);let Oe=L.colorRampTexture;Oe||(Oe=L.colorRampTexture=new o.T(V,L.colorRamp,q.RGBA8)),Oe.bind(q.LINEAR,q.CLAMP_TO_EDGE)}V.bindFramebuffer.set(L.tileFramebuffer.framebuffer),function(Oe,Ae,Be){const Le=Oe.context,He=Le.gl,je=Ae.tileFramebuffer;Le.activeTexture.set(He.TEXTURE0);const Ze={u_texture:0,u_opacity:1.05*(Je=Ae.paint.get("raster-particle-fade-opacity-factor"))/(Je+.05)},rt=Oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Je;for(const Ye of Be){const[,,ht,Ct]=Ye;je.colorAttachment.set(ht.targetColorTexture.texture),Le.viewport.set([0,0,je.width,je.height]),Le.clear({color:o.bz.transparent}),Ct&&(ht.backgroundColorTexture.bind(He.NEAREST,He.CLAMP_TO_EDGE),rt.draw(Oe,He.TRIANGLES,Me.disabled,wt.disabled,de.alphaBlended,Dr.disabled,Ze,Ae.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments))}}(S,L,ue),function(Oe,Ae,Be,Le){const He=Oe.context,je=He.gl,Ze=Be.tileFramebuffer,rt=Oe.transform.projection.name==="globe",Je=Be.paint.get("raster-particle-max-speed");for(const Ye of Le){const[ht,Ct,Ft]=Ye;He.activeTexture.set(je.TEXTURE0+0),Ct.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE),Ze.colorAttachment.set(Ft.targetColorTexture.texture);const At=Oe.getOrCreateProgram("rasterParticleDraw",{defines:Ct.defines,overrideFog:!1});He.activeTexture.set(je.TEXTURE0+1);const Yt=Ct.scalarData?[]:[0,1,2,3].map(kt=>o.c$[kt](ht));Yt.push(ht);const dt=ht.canonical.x,Lt=ht.canonical.y;for(const kt of Yt){const Qt=Ae.getTile(rt?kt.wrapped():kt);if(!Qt)continue;const tr=Qt.rasterParticleState;if(!tr)continue;const Nt=kt.canonical.x+(1<<kt.canonical.z)*(kt.wrap-ht.wrap),Ut=kt.canonical.y;tr.particleTexture0.bind(je.NEAREST,je.CLAMP_TO_EDGE);const Nr=Uh(1,tr.particleTexture0.size[0],[Nt-dt,Ut-Lt],0,Ct.texture.size,2,Je,Ct.textureOffset,Ct.scale,Ct.offset);At.draw(Oe,je.POINTS,Me.disabled,wt.disabled,de.alphaBlended,Dr.disabled,Nr,Be.id,tr.particleIndexBuffer,void 0,tr.particleSegment)}}}(S,k,L,ue),V.bindFramebuffer.set(L.particleFramebuffer.framebuffer),function(Oe,Ae,Be,Le){const He=Oe.context,je=He.gl,Ze=Ae.paint.get("raster-particle-max-speed"),rt=Le*Ae.paint.get("raster-particle-speed-factor")*.15,Je=function(ht){return Math.pow(ht,6)}(.01+1*Ae.paint.get("raster-particle-reset-rate-factor")),Ye=Ae.particleFramebuffer;He.viewport.set([0,0,Ye.width,Ye.height]);for(const ht of Be){const[,Ct,Ft]=ht;He.activeTexture.set(je.TEXTURE0+0),Ct.texture.bind(je.LINEAR,je.CLAMP_TO_EDGE),He.activeTexture.set(je.TEXTURE0+1);const At=Ft.particleTexture0;At.bind(je.NEAREST,je.CLAMP_TO_EDGE);const Yt=Zl(1,At.size[0],0,Ct.texture.size,Ze,rt,Je,Ct.textureOffset,Ct.scale,Ct.offset);Ye.colorAttachment.set(Ft.particleTexture1.texture),He.clear({color:o.bz.transparent}),Oe.getOrCreateProgram("rasterParticleUpdate",{defines:Ct.defines}).draw(Oe,je.TRIANGLES,Me.disabled,wt.disabled,de.unblended,Dr.disabled,Yt,Ae.id,Oe.viewportBuffer,Oe.quadTriangleIndexBuffer,Oe.viewportSegments)}}(S,L,ue,Re)}(m,i,c,g),m.renderPass==="translucent"&&(function(S,k,L,F,V){const q=S.context,W=q.gl,K=k.getSource().tileSize,ae=5*(1-o.a7(o.bU,o.bU+1,S.transform.zoom))*K+L.paint.get("raster-particle-elevation"),le=!S.options.moving,ue=S.transform.projection.name==="globe";if(!F.length)return;const[pe,Re]=S.stencilConfigForOverlap(F),Oe=[];ue&&Oe.push("PROJECTION_GLOBE_VIEW");const Ae=S.stencilModeFor3D();for(const Be of Re){const Le=Be.toUnwrapped(),He=k.getTile(Be);if(!He.rasterParticleState)continue;const je=He.rasterParticleState,Ze=100;He.registerFadeDuration(Ze);const rt=k.findLoadedParent(Be,0),Je=Oh(He,rt,k,S.transform,Ze);let Ye,ht;S.terrain&&S.terrain.prepareDrawTile(),q.activeTexture.set(W.TEXTURE0),je.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),q.activeTexture.set(W.TEXTURE1),rt&&rt.rasterParticleState?(rt.rasterParticleState.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Ye=Math.pow(2,rt.tileID.overscaledZ-He.tileID.overscaledZ),ht=[He.tileID.canonical.x*Ye%1,He.tileID.canonical.y*Ye%1]):je.targetColorTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const Ct=ue?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Le,le),Ft=S.transform,At=ls(Ft),Yt=o.cz(Be.canonical),dt=o.cA(Yt.getCenter().lat);let Lt,kt,Qt,tr,Nt;ue?(Lt=Float32Array.from(o.b5(o.cC(Be.canonical))),kt=Float32Array.from(Ft.globeMatrix),Qt=Float32Array.from(o.cy(Ft)),tr=[o.am(Ft.center.lng),o.at(Ft.center.lat)],Nt=Float32Array.from(o.cB(Be.canonical,Yt,dt,Ft.worldSize/Ft._pixelsPerMercatorPixel))):(Lt=new Float32Array(16),kt=new Float32Array(9),Qt=new Float32Array(16),tr=[0,0],Nt=new Float32Array(9));const Ut=Dp(Ct,Lt,kt,Qt,Nt,ht||[0,0],o.a9(S.transform.zoom),tr,At,Ye||1,Je,ae),Nr=S.isTileAffectedByFog(Be),hr=S.getOrCreateProgram("rasterParticle",{defines:Oe,overrideFog:Nr});if(S.uploadCommonUniforms(q,hr,Le),ue){const Sr=new Me(W.LEQUAL,Me.ReadOnly,S.depthRangeFor3D),Jr=0,Pr=S.globeSharedBuffers;if(Pr){const[Hr,_n,pn]=Pr.getGridBuffers(dt,Jr!==0);hr.draw(S,W.TRIANGLES,Sr,Ae,de.alphaBlended,S.renderElevatedRasterBackface?Dr.frontCCW:Dr.backCCW,Ut,L.id,Hr,_n,pn)}}else{const Sr=S.depthModeForSublayer(0,Me.ReadOnly),Jr=pe[Be.overscaledZ],{tileBoundsBuffer:Pr,tileBoundsIndexBuffer:Hr,tileBoundsSegments:_n}=S.getTileBoundsBuffers(He);hr.draw(S,W.TRIANGLES,Sr,Jr,de.alphaBlended,Dr.disabled,Ut,L.id,Pr,Hr,_n)}}S.resetStencilClippingMasks()}(m,i,c,g),m.style.map.triggerRepaint())},background:function(m,i,c,g){const v=c.paint.get("background-color"),w=c.paint.get("background-opacity"),S=c.paint.get("background-emissive-strength"),k=c.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const L=m.context,F=L.gl,V=m.transform,q=V.tileSize,W=c.paint.get("background-pattern");let K;if(W!==void 0&&(W===null||(K=m.imageManager.getPattern(W.toString(),c.scope,m.style.getLut(c.scope)),!K)))return;const ae=!W&&v.a===1&&w===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ae)return;const le=wt.disabled,ue=m.depthModeForSublayer(0,ae==="opaque"?Me.ReadWrite:Me.ReadOnly),pe=m.colorModeForDrapableLayerRenderPass(S),Re=W?"backgroundPattern":"background";let Oe,Ae=g;if(Ae||(Oe=m.getBackgroundTiles(),Ae=Object.values(Oe).map(Be=>Be.tileID)),W&&(L.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,c.scope)),k){const Be=m.getOrCreateProgram(Re,{overrideFog:!1,overrideRtt:!0}),Le=new Float32Array(o.a6.mat4.identity([])),He=new o.aA(0,0,0,0,0),je=W?Ue(Le,S,w,m,0,c.scope,K,k,{tileID:He,tileSize:q}):ce(Le,S,w,v.toRenderColor(c.lut));Be.draw(m,F.TRIANGLES,ue,le,pe,Dr.disabled,je,c.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}else for(const Be of Ae){const Le=m.isTileAffectedByFog(Be),He=m.getOrCreateProgram(Re,{overrideFog:Le}),je=Be.toUnwrapped(),Ze=g?Be.projMatrix:m.transform.calculateProjMatrix(je);m.prepareDrawTile();const rt=i?i.getTile(Be):Oe?Oe[Be.key]:new Ko(Be,q,V.zoom,m),Je=W?Ue(Ze,S,w,m,0,c.scope,K,k,{tileID:Be,tileSize:q}):ce(Ze,S,w,v.toRenderColor(c.lut));m.uploadCommonUniforms(L,He,je);const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:ht,tileBoundsSegments:Ct}=m.getTileBoundsBuffers(rt);He.draw(m,F.TRIANGLES,ue,le,pe,Dr.disabled,Je,c.id,Ye,ht,Ct)}},sky:function(m,i,c){const g=m._atmosphere?o.a9(m.transform.zoom):1,v=c.paint.get("sky-opacity")*g;if(v===0)return;const w=m.context,S=c.paint.get("sky-type"),k=new Me(w.gl.LEQUAL,Me.ReadOnly,[0,1]),L=m.frameCounter/1e3%1;S==="atmosphere"?m.renderPass==="offscreen"?c.needsSkyboxCapture(m)&&(function(F,V,q,W){const K=F.context,ae=K.gl;let le=V.skyboxFbo;if(!le){le=V.skyboxFbo=K.createFramebuffer(32,32,!0,null),V.skyboxGeometry=new $h(K),V.skyboxTexture=K.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,V.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let Oe=0;Oe<6;++Oe)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+Oe,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(le.framebuffer),K.viewport.set([0,0,32,32]);const ue=V.getCenter(F,!0),pe=F.getOrCreateProgram("skyboxCapture"),Re=new Float64Array(16);o.a6.mat4.identity(Re),o.a6.mat4.rotateY(Re,Re,.5*-Math.PI),mc(F,V,pe,Re,ue,0),o.a6.mat4.identity(Re),o.a6.mat4.rotateY(Re,Re,.5*Math.PI),mc(F,V,pe,Re,ue,1),o.a6.mat4.identity(Re),o.a6.mat4.rotateX(Re,Re,.5*-Math.PI),mc(F,V,pe,Re,ue,2),o.a6.mat4.identity(Re),o.a6.mat4.rotateX(Re,Re,.5*Math.PI),mc(F,V,pe,Re,ue,3),o.a6.mat4.identity(Re),mc(F,V,pe,Re,ue,4),o.a6.mat4.identity(Re),o.a6.mat4.rotateY(Re,Re,Math.PI),mc(F,V,pe,Re,ue,5),K.viewport.set([0,0,F.width,F.height])}(m,c),c.markSkyboxValid(m)):m.renderPass==="sky"&&function(F,V,q,W,K){const ae=F.context,le=ae.gl,ue=F.transform,pe=F.getOrCreateProgram("skybox");ae.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,V.skyboxTexture);const Re=((Oe,Ae,Be,Le,He)=>({u_matrix:Oe,u_sun_direction:Ae,u_cubemap:0,u_opacity:Le,u_temporal_offset:He}))(ue.skyboxMatrix,V.getCenter(F,!1),0,W,K);F.uploadCommonUniforms(ae,pe),pe.draw(F,le.TRIANGLES,q,wt.disabled,F.colorModeForRenderPass(),Dr.backCW,Re,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(m,c,k,v,L):S==="gradient"&&m.renderPass==="sky"&&function(F,V,q,W,K){const ae=F.context,le=ae.gl,ue=F.transform,pe=F.getOrCreateProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new $h(ae)),ae.activeTexture.set(le.TEXTURE0);let Re=V.colorRampTexture;Re||(Re=V.colorRampTexture=new o.T(ae,V.colorRamp,le.RGBA8)),Re.bind(le.LINEAR,le.CLAMP_TO_EDGE);const Oe=((Ae,Be,Le,He,je)=>({u_matrix:Ae,u_color_ramp:0,u_center_direction:Be,u_radius:o.bB(Le),u_opacity:He,u_temporal_offset:je}))(ue.skyboxMatrix,V.getCenter(F,!1),V.paint.get("sky-gradient-radius"),W,K);F.uploadCommonUniforms(ae,pe),pe.draw(F,le.TRIANGLES,q,wt.disabled,F.colorModeForRenderPass(),Dr.backCW,Oe,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)}(m,c,k,v,L)},debug:function(m,i,c,g,v,w){for(let S=0;S<c.length;S++)if(v){const F=new o.bz(g.r*.8,g.g*.8,g.b*.8,1);La(m,i,c[S],g,-1,-1,w),La(m,i,c[S],g,-1,1,w),La(m,i,c[S],g,1,1,w),La(m,i,c[S],g,1,-1,w),La(m,i,c[S],F,0,0,w)}else La(m,i,c[S],g,0,0,w)},custom:function(m,i,c,g){const v=m.context,w=c.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&c.isDraped(i)){if(m.renderPass==="offscreen"){const S=w.prerender;if(S){if(m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const k=m.transform.pointMerc;S.call(w,v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.a9(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else S.call(w,v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const k=w.renderToTile;if(k){const L=g[0].canonical,F=new o.a5(L.x+g[0].wrap*(1<<L.z),L.y,L.z);v.setDepthMode(Me.disabled),v.setStencilMode(wt.disabled),v.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),k.call(w,v.gl,F),v.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),v.setColorMode(m.colorModeForRenderPass()),v.setStencilMode(wt.disabled);const S=w.renderingMode==="3d"?new Me(m.context.gl.LEQUAL,Me.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Me.ReadOnly);if(v.setDepthMode(S),m.transform.projection.name==="globe"){const k=m.transform.pointMerc;w.render(v.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.a9(m.transform.zoom),[k.x,k.y],m.transform.pixelsPerMeterRatio)}else w.render(v.gl,m.transform.customLayerMatrix());v.setDirty(),m.setBaseState(),v.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,i,c,g){if(m.renderPass==="opaque")return;const v=c.paint.get("model-opacity");if(v===0)return;const w=c.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!w||m.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.a4))return;const S=m.shadowRenderer,k=c.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,k||(S.enabled=!1));const L=()=>{S&&(S.useNormalOffset=!0,k||(S.enabled=!0))},F=i.getSource();if(m.renderPass==="light-beam"&&F.type!=="batched-model")return;if(F.type==="vector"||F.type==="geojson")return function(pe,Re,Oe,Ae,Be){const Le=pe.transform;if(Le.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Le.projection.name} projection is not yet implemented`);const He=Le.getFreeCameraOptions().position;if(!pe.modelManager)return;const je=pe.modelManager;Oe.modelManager=je;const Ze=pe.shadowRenderer;if(!Oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const rt=Oe._unevaluatedLayout._values["model-id"],Je={...Oe.layout.get("model-id").parameters},Ye=pe.style.order.indexOf(Oe.fqid);for(const ht of Ae){const Ct=Re.getTile(ht).getBucket(Oe);if(!Ct||Ct.projection.name!==Le.projection.name)continue;const Ft=Ct.getModelUris();Ft&&!Ct.modelsRequested&&(je.addModelsFromBucket(Ft,Be),Ct.modelsRequested=!0);const At=zp(ht,Le);Je.zoom=At;const Yt=rt.possiblyEvaluate(Je);if(pf(pe,Ct,ht),Ba.shadowUniformsInitialized=!1,Ba.useSingleShadowCascade=!!Ze&&Ze.getMaxCascadeForTile(ht.toUnwrapped())===0,pe.renderPass==="shadow"&&Ze){if(pe.currentShadowCascade===1&&Ct.isInsideFirstShadowMapFrustum)continue;const kt=Le.calculatePosMatrix(ht.toUnwrapped(),Le.worldSize);if(Ba.tileMatrix.set(kt),Ba.shadowTileMatrix=Float32Array.from(Ze.calculateShadowPassMatrixFromMatrix(kt)),Ba.aabb.min.fill(0),Ba.aabb.max[0]=Ba.aabb.max[1]=o.ab,Ba.aabb.max[2]=0,bc(Ct,Ba,pe,Oe.scope))continue}const dt=1<<ht.canonical.z,Lt=[((He.x-ht.wrap)*dt-ht.canonical.x)*o.ab,(He.y*dt-ht.canonical.y)*o.ab,He.z*dt*o.ab];pe.conflationActive&&Object.keys(Ct.instancesPerModel).length>0&&pe.style.isLayerClipped(Oe,Re.getSource())&&Ct.updateReplacement(ht,pe.replacementSource,Ye,Be)&&(Ct.uploaded=!1,Ct.upload(pe.context));for(let kt in Ct.instancesPerModel){const Qt=Ct.instancesPerModel[kt];Qt.features.length>0&&(kt=Yt.evaluate(Qt.features[0].feature,{}));const tr=je.getModel(kt,Be);if(tr&&tr.uploaded)for(const Nt of tr.nodes)Ps(pe,Oe,Nt,Qt,Lt,ht,Ba)}}}(m,i,c,g,F.type==="vector"?c.scope:""),void L();if(!F.loaded())return;if(F.type==="batched-model")return function(pe,Re,Oe,Ae){Oe.resetLayerRenderingStats(pe);const Be=pe.context,Le=pe.transform,He=pe.style.fog,je=pe.shadowRenderer;if(Le.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Le.projection.name} projection is not yet implemented`);const Ze=pe.transform.getFreeCameraOptions().position,rt=o.a6.vec3.scale([],[Ze.x,Ze.y,Ze.z],pe.transform.worldSize),Je=o.a6.vec3.negate([],rt),Ye=o.a6.mat4.identity([]),ht=o.de(Le.center.lat,Le.zoom),Ct=o.a6.mat4.fromScaling([],[1,1,1/ht]);o.a6.mat4.translate(Ye,Ye,Je);const Ft=Oe.paint.get("model-opacity"),At=new Me(Be.gl.LEQUAL,Me.ReadWrite,pe.depthRangeFor3D),Yt=new Me(Be.gl.LEQUAL,Me.ReadOnly,pe.depthRangeFor3D),dt=new o.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Lt=pe.renderPass==="shadow",kt=Lt&&je?je.getCurrentCascadeFrustum():Le.getFrustum(Le.scaleZoom(Le.worldSize)),Qt=Oe.paint.get("model-front-cutoff"),tr=Qt[2]<1,Nt=kl(pe,Oe.paint.get("model-cutoff-fade-range")),Ut=Oe.getLayerRenderingStats();(function(Nr,hr,Sr,Jr){const Pr=Nr.terrain?Nr.terrain.exaggeration():0,Hr=Nr.transform.zoom;for(const _n of Jr){const pn=hr.getTile(_n).getBucket(Sr);pn&&(Nr.conflationActive&&pn.updateReplacement(_n,Nr.replacementSource),pn.evaluateScale(Nr,Sr),Nr.terrain&&Pr>0&&pn.elevationUpdate(Nr.terrain,Pr,_n,Sr.source),pn.needsReEvaluation(Nr,Hr,Sr)&&pn.evaluate(Sr))}})(pe,Re,Oe,Ae),function(){let Nr,hr,Sr;tr?(Nr=Ae.length-1,hr=-1,Sr=-1):(Nr=0,hr=Ae.length,Sr=1);const Jr=new Float64Array(16),Pr=o.a6.vec3.create(),Hr=new o.P(0,0);for(let _n=Nr;_n!==hr;_n+=Sr){const pn=Ae[_n],fi=Re.getTile(pn).getBucket(Oe);if(!fi||!fi.uploaded)continue;let Ti=!1;je&&(Ti=je.getMaxCascadeForTile(pn.toUnwrapped())===0);const Hi=Le.calculatePosMatrix(pn.toUnwrapped(),Le.worldSize),fl=fi.modelTraits;!Lt&&tr&&(o.a6.mat4.invert(Jr,Hi),o.a6.vec3.transformMat4(Pr,rt,Jr),Hr.x=Pr[0],Hr.y=Pr[1]);const Fo=[];for(const Cn of fi.getNodesInfo()){if(Cn.hiddenByReplacement||!Cn.node.meshes)continue;const bi=Cn.node;let lo=0;pe.terrain&&bi.elevation&&(lo=bi.elevation*pe.terrain.exaggeration());const vi=(()=>{const Ni=Cn.aabb;return dt.min=[...Ni.min],dt.max=[...Ni.max],dt.min[2]+=lo,dt.max[2]+=lo,o.a6.vec3.transformMat4(dt.min,dt.min,Hi),o.a6.vec3.transformMat4(dt.max,dt.max,Hi),dt})(),mn=Cn.evaluatedScale;if(mn[0]<=1&&mn[1]<=1&&mn[2]<=1&&vi.intersects(kt)===0)continue;if(!Lt&&tr){const Ni=.16666666666666666;Cn.cameraCollisionOpacity=rt[0]>vi.min[0]&&rt[0]<vi.max[0]&&rt[1]>vi.min[1]&&rt[1]<vi.max[1]&&rt[2]*ht<vi.max[2]&&bi.footprint&&o.bu(Hr,bi.footprint)?Math.max(Cn.cameraCollisionOpacity-Ni,0):Math.min(1,Cn.cameraCollisionOpacity+Ni)}const Zn=[...Hi],ci=bi.anchor?bi.anchor[0]:0,Eo=bi.anchor?bi.anchor[1]:0;o.a6.mat4.translate(Zn,Zn,[ci*(mn[0]-1),Eo*(mn[1]-1),lo]),o.a6.vec3.exactEquals(mn,o.dh)||o.a6.mat4.scale(Zn,Zn,mn);const Vo=o.a6.mat4.multiply([],Zn,bi.matrix),Nn=o.a6.mat4.multiply([],Le.expandedFarZProjMatrix,Vo),cs=o.a6.mat4.multiply([],Le.expandedFarZProjMatrix,Zn),ys=o.a6.vec4.transformMat4([],[ci,Eo,lo,1],Nn)[2];bi.hidden=!1;let us=Ft;Lt||(tr&&(us*=Cn.cameraCollisionOpacity,us*=Wn(Zn,Le,Cn.aabb,Qt)),us*=Pi(Nt,ys)),us!==0?Fo.push({nodeInfo:Cn,depth:ys,opacity:us,wvpForNode:Nn,wvpForTile:cs,nodeModelMatrix:Vo,tileModelMatrix:Zn}):bi.hidden=!0}Lt||Fo.sort((Cn,bi)=>!tr||Cn.opacity===1&&bi.opacity===1?Cn.depth<bi.depth?-1:1:Cn.opacity===1?-1:bi.opacity===1?1:Cn.depth>bi.depth?-1:1);for(const Cn of Fo){const bi=Cn.nodeInfo,lo=bi.node;let vi=o.a6.mat4.multiply([],Ct,Cn.tileModelMatrix);o.a6.mat4.multiply(vi,Ye,vi);const mn=o.a6.mat4.invert([],vi);o.a6.mat4.transpose(mn,mn),o.a6.mat4.scale(mn,mn,yg),vi=o.a6.mat4.multiply(vi,vi,lo.matrix);const Zn=pe.renderPass==="light-beam",ci=fl&o.dj.HasMapboxMeshFeatures,Eo=ci?0:bi.evaluatedRMEA[0][2];for(let Vo=0;Vo<lo.meshes.length;++Vo){const Nn=lo.meshes[Vo],cs=Vo===lo.lightMeshIndex;let ys=Cn.wvpForNode;if(cs){if(!Zn&&!pe.terrain&&pe.shadowRenderer){pe.currentLayer<pe.firstLightBeamLayer&&(pe.firstLightBeamLayer=pe.currentLayer);continue}ys=Cn.wvpForTile}else if(Zn)continue;const us={defines:[]},Ni=[];if(ju(us.defines,Ni,Nn,pe,Oe.lut),ci||us.defines.push("DIFFUSE_SHADED"),Ti&&us.defines.push("SHADOWS_SINGLE_CASCADE"),Ut&&(Lt?Ut.numRenderedVerticesInShadowPass+=Nn.vertexArray.length:Ut.numRenderedVerticesInTransparentPass+=Nn.vertexArray.length),Lt){vc(Nn,Cn.nodeModelMatrix,pe,Oe);continue}let wa=null;if(He){const Sc=_c(Cn.nodeModelMatrix,pe.transform);if(wa=new Float32Array(Sc),Le.projection.name!=="globe"){const ou=Nn.aabb.min,Jl=Nn.aabb.max,[Kh,Xh]=He.getOpacityForBounds(Sc,ou[0],ou[1],Jl[0],Jl[1]);us.overrideFog=Kh>=ur||Xh>=ur}}const Ta=Nn.material;let pl;Ta.occlusionTexture&&Ta.occlusionTexture.offsetScale&&(pl=Ta.occlusionTexture.offsetScale,us.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Lt&&je&&(je.useNormalOffset=!!Nn.normalBuffer);const nl=pe.getOrCreateProgram("model",us);!Lt&&je&&je.setupShadowsFromMatrix(Cn.tileModelMatrix,nl,je.useNormalOffset),pe.uploadCommonUniforms(Be,nl,null,wa);const za=Ta.pbrMetallicRoughness;za.metallicFactor=.9,za.roughnessFactor=.5;const ml=et(new Float32Array(ys),new Float32Array(vi),new Float32Array(mn),new Float32Array(lo.matrix),pe,Cn.opacity,za.baseColorFactor.toRenderColor(null),Ta.emissiveFactor,za.metallicFactor,za.roughnessFactor,Ta,Eo,Oe,[0,0,0],pl);!cs&&(bi.hasTranslucentParts||Cn.opacity<1)&&nl.draw(pe,Be.gl.TRIANGLES,At,wt.disabled,de.disabled,Dr.backCCW,ml,Oe.id,Nn.vertexBuffer,Nn.indexBuffer,Nn.segments,Oe.paint,pe.transform.zoom,void 0,Ni),nl.draw(pe,Be.gl.TRIANGLES,cs?Yt:At,wt.disabled,cs||Cn.opacity<1||bi.hasTranslucentParts?de.alphaBlended:de.unblended,Dr.backCCW,ml,Oe.id,Nn.vertexBuffer,Nn.indexBuffer,Nn.segments,Oe.paint,pe.transform.zoom,void 0,Ni)}}}}()}(m,i,c,g),void L();if(F.type!=="model")return;const V=F.getModels(),q=[],W=m.transform.getFreeCameraOptions().position,K=o.a6.vec3.scale([],[W.x,W.y,W.z],m.transform.worldSize);o.a6.vec3.negate(K,K);const ae=[],le=[];let ue=0;for(const pe of V){const Re=c.paint.get("model-rotation").constantOr(null),Oe=c.paint.get("model-scale").constantOr(null),Ae=c.paint.get("model-translation").constantOr(null);pe.computeModelMatrix(m,Re,Oe,Ae,!0,!0,!1);const Be=o.a6.mat4.identity([]),Le=o.de(pe.position.lat,m.transform.zoom),He=o.a6.mat4.fromScaling([],[1,1,1/Le]);o.a6.mat4.translate(Be,Be,K),q.push({zScaleMatrix:He,negCameraPosMatrix:Be});for(const je of pe.nodes)yc(m.transform,je,pe.matrix,m.transform.expandedFarZProjMatrix,ue,ae,le);ue++}if(ae.sort((pe,Re)=>Re.depth-pe.depth),m.renderPass!=="shadow"){if(v===1)for(const pe of le)Qc(pe,m,c,q[pe.modelIndex],wt.disabled,m.colorModeForRenderPass());else{for(const pe of le)Qc(pe,m,c,q[pe.modelIndex],wt.disabled,de.disabled);for(const pe of le)Qc(pe,m,c,q[pe.modelIndex],m.stencilModeFor3D(),m.colorModeForRenderPass());m.resetStencilClippingMasks()}for(const pe of ae)Qc(pe,m,c,q[pe.modelIndex],wt.disabled,m.colorModeForRenderPass());L()}else{for(const pe of le)vc(pe.mesh,pe.nodeModelMatrix,m,c);for(const pe of ae)vc(pe.mesh,pe.nodeModelMatrix,m,c);L()}}},Fp={model:function(m,i,c){const g=i.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,g.type==="vector"?m.scope:""));if(g.type==="batched-model"||g.type!=="model")return;const v=g.getModels();for(const w of v)w.upload(c.context)},raster:function(m,i,c){const g=i.getSource();if(!(g instanceof Xs&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const w=m.paint.get("raster-array-band")||g.getInitialBand(v);if(w==null)return;const S=i.getIds().map(k=>i.getTileByID(k));for(const k of S)k.updateNeeded(v,w)&&g.prepareTile(k,v,w)},"raster-particle":function(m,i,c){const g=i.getSource();if(!(g instanceof Xs&&g.loaded()))return;const v=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!v)return;const w=m.paint.get("raster-particle-array-band")||g.getInitialBand(v);if(w==null)return;const S=i.getIds().map(k=>i.getTileByID(k));for(const k of S)k.updateNeeded(v,w)&&g.prepareTile(k,v,w)}};class vg{constructor(i,c,g,v){this.context=new Hn(i,c),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const k of w)this._debugParams.enabledLayers[k]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of w)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new Np(v),this.setup(),this.numSublayers=Ji.maxUnderzooming+Ji.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Qd(this),this._wireframeDebugCache=new eu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const S=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,S,i.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(i,c){const g=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Nu(this,i));const v=this._terrain;this.transform.elevation=g?v:null,v.update(i,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(i){const c=i.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=c.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const w=g+.78*(v-g);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new Nu(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,c){if(this.width=i*o.q.devicePixelRatio,this.height=c*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const i=this.context,c=new o.a_;c.emplaceBack(0,0),c.emplaceBack(o.ab,0),c.emplaceBack(0,o.ab),c.emplaceBack(o.ab,o.ab),this.tileExtentBuffer=i.createVertexBuffer(c,o.b0.members),this.tileExtentSegments=o.b1.simpleSegment(0,0,4,2);const g=new o.a_;g.emplaceBack(0,0),g.emplaceBack(o.ab,0),g.emplaceBack(0,o.ab),g.emplaceBack(o.ab,o.ab),this.debugBuffer=i.createVertexBuffer(g,o.b0.members),this.debugSegments=o.b1.simpleSegment(0,0,4,5);const v=new o.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,o.b0.members),this.viewportSegments=o.b1.simpleSegment(0,0,4,2);const w=new o.aN;w.emplaceBack(0,0,0,0),w.emplaceBack(o.ab,0,o.ab,0),w.emplaceBack(0,o.ab,0,o.ab),w.emplaceBack(o.ab,o.ab,o.ab,o.ab),this.mercatorBoundsBuffer=i.createVertexBuffer(w,o.b3.members),this.mercatorBoundsSegments=o.b1.simpleSegment(0,0,4,2);const S=new o.aO;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(S);const k=new o.a$;for(const F of[0,1,3,2,0])k.emplaceBack(F);this.debugIndexBuffer=i.createIndexBuffer(k),this.emptyTexture=new o.T(i,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=o.a6.mat4.create();const L=this.context.gl;this.stencilClearMode=new wt({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Me.disabled,this.stencilClearMode,de.disabled,Dr.disabled,zu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,c,g){if(!c||this.currentStencilSource===c.id||!i.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const L of g)if(this._tileClippingMaskIDs[L.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=c.id;const v=this.context,w=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(de.disabled),v.setDepthMode(Me.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of g){const L=c.getTile(k),F=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:q,tileBoundsSegments:W}=this.getTileBoundsBuffers(L);S.draw(this,w.TRIANGLES,Me.disabled,new wt({func:w.ALWAYS,mask:0},F,255,w.KEEP,w.KEEP,w.REPLACE),de.disabled,Dr.disabled,zu(k.projMatrix),"$clipping",V,q,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new wt({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const c=this.context.gl;return new wt({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,g=i.sort((S,k)=>k.overscaledZ-S.overscaledZ),v=g[g.length-1].overscaledZ,w=g[0].overscaledZ-v+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let k=0;k<w;k++)S[k+v]=new wt({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[S,g]}return[{[v]:wt.disabled},g]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new de([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new o.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?de.unblended:de.alphaBlended}colorModeForDrapableLayerRenderPass(i){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new de([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.bz(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,c,g,v=!1){if(this.depthOcclusion)return new Me(this.context.gl.GREATER,Me.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Me.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Me(g||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,c=Math.ceil(this.width),g=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&g!==0&&(this.depthFBO=new Gr(this.context,c,g,!1,"texture"),this.depthTexture=new o.T(this.context,{width:c,height:g,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),i.bindTexture(i.TEXTURE_2D,w),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,c,g,0,0,c,g,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,c)=>i+c/this._fpsHistory.length,0))}render(i,c){const g=o.q.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=c;const v=this.style._mergedLayers,w=this.style.order.filter(Je=>{const Ye=v[Je];return!(Ye.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ye.type]});let S=!1,k=!1;for(const Je of w){const Ye=v[Je];Ye.type==="circle"&&(S=!0),Ye.type==="symbol"&&(Ye.hasInitialOcclusionOpacityProperties?k=!0:S=!0)}const L=w.map(Je=>v[Je]),F=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let V=0,q=!1;for(const Je in F){const Ye=F[Je];Ye.used&&(Ye.prepare(this.context),Ye.getSource().usedInConflation&&++V)}let W=!1;for(const Je of L)Je.isHidden(this.transform.zoom)||(Je.type==="clip"&&(W=!0),this.prepareLayer(Je));const K={},ae={},le={},ue={},pe={};for(const Je in F){const Ye=F[Je];K[Je]=Ye.getVisibleCoordinates(),ae[Je]=K[Je].slice().reverse(),le[Je]=Ye.getVisibleCoordinates(!0).reverse(),ue[Je]=Ye.getShadowCasterCoordinates(),pe[Je]=Ye.sortCoordinatesByDistance(K[Je])}const Re=Je=>{const Ye=this.style.getLayerSourceCache(Je);return Ye&&Ye.used?Ye.getSource():null};if(V||W||this._clippingActiveLastFrame){const Je=[],Ye=[];let ht=0;for(const Ct of L)this.isSourceForClippingOrConflation(Ct,Re(Ct))&&(Je.push(Ct),Ye.push(ht)),ht++;if(Je&&(W||Je.length>1)||this._clippingActiveLastFrame){W=!1;const Ct=[];for(let Ft=0;Ft<Je.length;Ft++){const At=Je[Ft],Yt=Ye[Ft],dt=this.style.getLayerSourceCache(At);if(!dt||!dt.used||!dt.getSource().usedInConflation&&At.type!=="clip")continue;let Lt=o.dn,kt=o.bs.None;const Qt=[];let tr=!0;if(At.type==="clip"){Lt=Yt;for(const Nt of At.layout.get("clip-layer-types"))kt|=Nt==="model"?o.bs.Model:Nt==="symbol"?o.bs.Symbol:o.bs.FillExtrusion;for(const Nt of At.layout.get("clip-layer-scope"))Qt.push(Nt);At.isHidden(this.transform.zoom)?tr=!1:W=!0}tr&&Ct.push({layer:At.fqid,cache:dt,order:Lt,clipMask:kt,clipScope:Qt})}this.replacementSource.setSources(Ct),q=!0}}this._clippingActiveLastFrame=W,q||this.replacementSource.clear(),this.conflationActive=q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Je=0;Je<L.length;Je++){const Ye=L[Je],ht=Ye.cutoffRange();if(this.longestCutoffRange=Math.max(ht,this.longestCutoffRange),ht>0){const Ct=Re(Ye);Ct&&(this.minCutoffZoom=Math.max(Ct.minzoom,this.minCutoffZoom)),Ye.minzoom&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom))}Ye.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Je),this._lastOcclusionLayer=Je)}const Oe=this.style&&this.style.fog;Oe?(this._fogVisible=Oe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Oe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(le),this.opaquePassCutoff=0);const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Je in F)for(const Ye of K[Je]){let ht={min:0,max:0};this.terrain&&(ht=this.terrain.getMinMaxForTile(Ye)||ht),Ae.addShadowReceiver(Ye.toUnwrapped(),ht.min,ht.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new dl(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Kt.has(this.context.gl))return;this.renderPass="offscreen";for(const Je of L){const Ye=i.getLayerSourceCache(Je);if(!Je.hasOffscreenPass()||Je.isHidden(this.transform.zoom))continue;const ht=Ye?ae[Ye.id]:void 0;(Je.type==="custom"||Je.type==="raster"||Je.type==="raster-particle"||Je.isSky()||ht&&ht.length)&&this.renderLayer(this,Ye,Je,ht)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ue)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Be=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Le=(()=>{if(c.showOverdrawInspector)return o.bz.black;const Je=this.style.fog;if(Je&&this.transform.projection.supportsFog){const Ye=this.style.getLut(Je.scope);if(!Be){const ht=Je.properties.get("color").toRenderColor(Ye).toArray01();return new o.bz(...ht)}if(Be){const ht=Je.properties.get("space-color").toRenderColor(Ye).toArray01();return new o.bz(...ht)}}return o.bz.transparent})();if(this.context.clear({color:Le,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Je=L[this.currentLayer],Ye=i.getLayerSourceCache(Je);if(Je.isSky())continue;const ht=Ye?(Je.is3D()?pe:ae)[Ye.id]:void 0;this._renderTileClippingMasks(Je,Ye,ht),this.renderLayer(this,Ye,Je,ht)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Je=L[this.currentLayer],Ye=i.getLayerSourceCache(Je);Je.isSky()&&this.renderLayer(this,Ye,Je,Ye?ae[Ye.id]:void 0)}function He(Je,Ye){let ht;return Ye&&(ht=(Je.type==="symbol"?le:Je.is3D()?pe:ae)[Ye.id]),ht}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Je=L[this.currentLayer];if(Je.type==="raster"||Je.type==="raster-particle"){const Ye=i.getLayerSourceCache(Je);this.renderLayer(this,Ye,Je,He(Je,Ye))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let je=0;Ae&&(je=Ae.getShadowCastingLayerCount());let Ze=!1,rt=-1;for(let Je=0;Je<w.length;++Je){const Ye=L[Je];Ye.isHidden(this.transform.zoom)||Ye.is3D()&&(rt=Je)}for(k&&rt===-1&&(S=!0);this.currentLayer<w.length;){const Je=L[this.currentLayer],Ye=i.getLayerSourceCache(Je);if(Je.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Je)){if(Je.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(S&&!Ze&&this.terrain&&!this.transform.isOrthographic&&(Ze=!0,this.blitDepth()),k&&rt!==-1&&this.currentLayer===rt+1&&!this.transform.isOrthographic&&this.blitDepth(),Je.is3D()||this.terrain||this._renderTileClippingMasks(Je,Ye,Ye?K[Ye.id]:void 0),this.renderLayer(this,Ye,Je,He(Je,Ye)),!this.terrain&&Ae&&je>0&&Je.hasShadowPass()&&--je==0&&(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ht=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ht;this.currentLayer++){const Ct=L[this.currentLayer];if(!Ct.hasLightBeamPass())continue;const Ft=i.getLayerSourceCache(Ct);this.renderLayer(this,Ft,Ct,Ft?ae[Ft.id]:void 0)}this.currentLayer=ht,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ht=this.currentLayer;this.depthOcclusion=!0;for(const Ct of this.layersWithOcclusionOpacity){this.currentLayer=Ct;const Ft=L[this.currentLayer],At=i.getLayerSourceCache(Ft),Yt=At?ae[At.id]:void 0;Ft.is3D()||this.terrain||this._renderTileClippingMasks(Ft,At,At?K[At.id]:void 0),this.renderLayer(this,At,Ft,Yt)}this.depthOcclusion=!1,this.currentLayer=ht,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Je=null;L.forEach(Ye=>{const ht=i.getLayerSourceCache(Ye);ht&&!Ye.isHidden(this.transform.zoom)&&ht.getVisibleCoordinates().length&&(!Je||Je.getSource().maxzoom<ht.getSource().maxzoom)&&(Je=ht)}),Je&&this.options.showTileBoundaries&&tu.debug(this,Je,Je.getVisibleCoordinates(),o.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&tu.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Je){const Ye=Je.transform.padding;qi(Je,Je.transform.height-(Ye.top||0),3,ao),qi(Je,Ye.bottom||0,3,Qo),mt(Je,Ye.left||0,3,ws),mt(Je,Je.transform.width-(Ye.right||0),3,Xt);const ht=Je.transform.centerPoint;(function(Ct,Ft,At,Yt){Vu(Ct,Ft-1,At-10,2,20,Yt),Vu(Ct,Ft-10,At-1,20,2,Yt)})(Je,ht.x,Je.transform.height-ht.y,Mr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),q||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:c}=this.transform.projection,g=!c||!c.includes(i.type);if(Fp[i.type]&&(g||this.terrain&&i.type==="custom")){const v=this.style.getLayerSourceCache(i);Fp[i.type](i,v,this)}this.gpuTimingEnd()}renderLayer(i,c,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(g.type)&&(!i.terrain||g.type!=="custom")||g.type==="clip"||tu[g.type](i,c,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,g=this.context.gl;let v=this.gpuTimers[i.id];v||(v=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,c=this.context.gl,g=c.createQuery();this.deferredRenderGpuTimeQueries.push(g),c.beginQuery(i.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const c={};for(const g in i){const v=i[g],w=this.context.extTimerQuery,S=w.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(v.query),c[g]=S}return c}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery,g=this.context.gl;let v=0;for(const w of i)v+=c.getQueryParameter(w,g.QUERY_RESULT)/1e6,c.deleteQueryEXT(w);return v}translatePosMatrix(i,c,g,v,w){if(!g[0]&&!g[1])return i;const S=w?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){const F=Math.sin(S),V=Math.cos(S);g=[g[0]*V-g[1]*F,g[0]*F+g[1]*V]}const k=[w?g[0]:o.ak(c,g[0],this.transform.zoom),w?g[1]:o.ak(c,g[1],this.transform.zoom),0],L=new Float32Array(16);return o.a6.mat4.translate(L,i,k),L}saveTileTexture(i){const c=i.size[0],g=this._tileTextures[c];g?g.push(i):this._tileTextures[c]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,c,g){const v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||v||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),v&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,c){this.cache=this.cache||{};const g=c&&c.defines||[],v=c&&c.config,w=this.currentGlobalDefines(i,c&&c.overrideFog,c&&c.overrideRtt).concat(g),S=ul.cacheKey(Ol[i],i,w,v);return this.cache[S]||(this.cache[S]=new ul(this.context,i,Ol[i],v,br[i],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,c){if(this.style.enable3dLights()){const g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){const w=((S,k,L)=>{const F=S.properties.get("direction"),V=S.properties.get("color").toRenderColor(L.getLut(S.scope)).toArray01(),q=S.properties.get("intensity"),W=k.properties.get("color").toRenderColor(L.getLut(k.scope)).toArray01(),K=k.properties.get("intensity"),ae=[F.x,F.y,F.z],le=o.cH(W,K),ue=o.cH(V,q);return{u_lighting_ambient_color:le,u_lighting_directional_dir:ae,u_lighting_directional_color:ue,u_ground_radiance:Lh(ae,ue,le)}})(g,v,this.style);c.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,c,g,v,w){if(this.uploadCommonLightUniforms(i,c),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const k=S.getOpacity(this.transform.pitch),L=((F,V,q,W,K,ae,le,ue,pe,Re,Oe,Ae)=>{const Be=F.transform,Le=V.properties.get("color").toRenderColor(F.style.getLut(V.scope)).toArray01();Le[3]=W;const He=F.frameCounter/1e3%1,[je,Ze]=V.properties.get("vertical-range");return{u_fog_matrix:q?Be.calculateFogTileMatrix(q):Ae||F.identityMat,u_fog_range:V.getFovAdjustedRange(Be._fov),u_fog_color:Le,u_fog_horizon_blend:V.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(je,Ze),Ze],u_fog_temporal_offset:He,u_frustum_tl:K,u_frustum_tr:ae,u_frustum_br:le,u_frustum_bl:ue,u_globe_pos:pe,u_globe_radius:Re,u_viewport:Oe,u_globe_transition:o.a9(Be.zoom),u_is_globe:+(Be.projection.name==="globe")}})(this,S,g,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],v);c.setFogUniformValues(i,L)}w&&c.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)c[v.key]=i[v.key]||new Ko(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,c){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[i.key];return c||(this._cachedTileFogOpacities[i.key]=c=this.style.fog.getOpacityForTile(i)),c[0]>=ur||c[1]>=ur}setupDepthForOcclusion(i,c,g){const v=this.context,w=v.gl,S=!!g;var k;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(w.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((k=this.depthRangeFor3D)[1]-k[0]),-1-2*k[0]/(k[1]-k[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),v.activeTexture.set(w.TEXTURE0),S||c.setTerrainUniformValues(v,g)}}function xc(m,i){let c=!1,g=null;const v=()=>{g=null,c&&(m(),g=setTimeout(v,i),c=!1)};return()=>(c=!0,g||v(),g)}class ru{constructor(i){this._hashName=i&&encodeURIComponent(i),o.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xc(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const c=wc(i);if(this._hashName){const g=this._hashName;let v=!1;const w=location.hash.slice(1).split("&").map(S=>{const k=S.split("=")[0];return k===g?(v=!0,`${k}=${c}`):S}).filter(S=>S);return v||w.push(`${g}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(g))){const g=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(c[3]||0):i.getBearing();return i.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function wc(m,i){const c=m.getCenter(),g=Math.round(100*m.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,v),S=Math.round(c.lng*w)/w,k=Math.round(c.lat*w)/w,L=m.getBearing(),F=m.getPitch();let V=i?`/${S}/${k}/${g}`:`${g}/${k}/${S}`;return(L||F)&&(V+="/"+Math.round(10*L)/10),F&&(V+=`/${Math.round(F)}`),V}const $u={linearity:.3,easing:o.dp(0,0,.3,1)},Vp=o.l({deceleration:2500,maxSpeed:1400},$u),bg=o.l({deceleration:20,maxSpeed:1400},$u),xg=o.l({deceleration:1e3,maxSpeed:360},$u),wg=o.l({deceleration:1e3,maxSpeed:90},$u);class nu{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=o.q.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){const w=Gu(c.pan.mag(),g,o.l({},Vp,i||{}));v.offset=c.pan.mult(w.amount/c.pan.mag()),v.center=this._map.transform.center,Gh(v,w)}if(c.zoom){const w=Gu(c.zoom,g,bg);v.zoom=this._map.transform.zoom+w.amount,Gh(v,w)}if(c.bearing){const w=Gu(c.bearing,g,xg);v.bearing=this._map.transform.bearing+o.ap(w.amount,-179,179),Gh(v,w)}if(c.pitch){const w=Gu(c.pitch,g,wg);v.pitch=this._map.transform.pitch+w.amount,Gh(v,w)}if(v.zoom||v.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;v.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Gh(m,i){(!m.duration||m.duration<i.duration)&&(m.duration=i.duration,m.easing=i.easing)}function Gu(m,i,c){const{maxSpeed:g,linearity:v,deceleration:w}=c,S=o.ap(m*v/(i/1e3),-g,g),k=Math.abs(S)/(w*v);return{easing:c.easing,duration:1e3*k,amount:S*(k/2)}}class xa extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g,v={}){const w=ne(c.getCanvasContainer(),g),S=c.unproject(w);super(i,o.l({point:w,lngLat:S,originalEvent:g},v)),this._defaultPrevented=!1,this.target=c}}class qh extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,g){const v=i==="touchend"?g.changedTouches:g.touches,w=te(c.getCanvasContainer(),v),S=w.map(L=>c.unproject(L)),k=w.reduce((L,F,V,q)=>L.add(F.div(q.length)),new o.P(0,0));super(i,{points:w,point:k,lngLats:S,lngLat:c.unproject(k),originalEvent:g}),this._defaultPrevented=!1}}class Ms extends o.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Tg{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Ms(this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new xa(i.type,this._map,i))}mouseup(i){this._map.fire(new xa(i.type,this._map,i))}preclick(i){const c=o.l({},i);c.type="preclick",this._map.fire(new xa(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new xa(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new xa(i.type,this._map,i))}mouseover(i){this._map.fire(new xa(i.type,this._map,i))}mouseout(i){this._map.fire(new xa(i.type,this._map,i))}touchstart(i){return this._firePreventable(new qh(i.type,this._map,i))}touchmove(i){this._map.fire(new qh(i.type,this._map,i))}touchend(i){this._map.fire(new qh(i.type,this._map,i))}touchcancel(i){this._map.fire(new qh(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eg{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new xa(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new xa(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hh{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(be(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const g=c,v=this._startPos,w=this._lastPos;if(!v||!w||w.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const S=Math.min(v.x,g.x),k=Math.max(v.x,g.x),L=Math.min(v.y,g.y),F=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${L}px)`,this._box.style.width=k-S+"px",this._box.style.height=F-L+"px")})}mouseupWindow(i,c){if(!this._active)return;const g=this._startPos,v=c;if(g&&i.button===0){if(this.reset(),ie(),g.x!==v.x||g.y!==v.y)return this._map.fire(new o.x("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ze(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new o.x(i,{originalEvent:c}))}}function Tc(m,i){const c={};for(let g=0;g<m.length;g++)c[m[g].identifier]=i[g];return c}class Sg{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const w=new o.P(0,0);for(const S of v)w._add(S);return w.div(v.length)}(c),this.touches=Tc(g,c)))}touchmove(i,c,g){if(this.aborted||!this.centroid)return;const v=Tc(g,c);for(const w in this.touches){const S=v[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,c,g){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class mf{constructor(i){this.singleTap=new Sg(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,c,g){this.singleTap.touchstart(i,c,g)}touchmove(i,c,g){this.singleTap.touchmove(i,c,g)}touchend(i,c,g){const v=this.singleTap.touchend(i,c,g);if(v){const w=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(w&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Ig{constructor(){this._zoomIn=new mf({numTouches:1,numTaps:2}),this._zoomOut=new mf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,g){this._zoomIn.touchstart(i,c,g),this._zoomOut.touchstart(i,c,g)}touchmove(i,c,g){this._zoomIn.touchmove(i,c,g),this._zoomOut.touchmove(i,c,g)}touchend(i,c,g){const v=this._zoomIn.touchend(i,c,g),w=this._zoomOut.touchend(i,c,g);return v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gf={0:1,2:2};class _f{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;const g=re(i);this._correctButton(i,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(i,c){const g=this._lastPoint;if(g){if(i.preventDefault(),this._eventButton!=null&&function(v,w){const S=gf[w];return v.buttons===void 0||(v.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}}mouseupWindow(i){this._lastPoint&&re(i)===this._eventButton&&(this._moved&&ie(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Up extends _f{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return c===0&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class jp extends _f{_correctButton(i,c){return c===0&&i.ctrlKey||c===2}_move(i,c){const g=.8*(c.x-i.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(i){i.preventDefault()}}class $p extends _f{_correctButton(i,c){return c===0&&i.ctrlKey||c===2}_move(i,c){const g=-.5*(c.y-i.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(i){i.preventDefault()}}class jy{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(i,c,g){return this._calculateTransform(i,c,g)}touchmove(i,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!o.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,c,g)}}touchend(i,c,g){this._calculateTransform(i,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,g){g.length>0&&(this._active=!0);const v=Tc(g,c),w=new o.P(0,0),S=new o.P(0,0);let k=0;for(const F in v){const V=v[F],q=this._touches[F];q&&(w._add(V),S._add(V.sub(q)),k++,v[F]=V)}if(this._touches=v,k<this._minTouches||!S.mag())return;const L=S.div(k);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(k),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Gp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,c,g){return{}}touchstart(i,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,g){const v=this._firstTwoTouches;if(!v)return;i.preventDefault();const[w,S]=v,k=yf(g,c,w),L=yf(g,c,S);if(!k||!L)return;const F=this._aroundCenter?null:k.add(L).div(2);return this._move([k,L],F,i)}touchend(i,c,g){if(!this._firstTwoTouches)return;const[v,w]=this._firstTwoTouches,S=yf(g,c,v),k=yf(g,c,w);S&&k||(this._active&&ie(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yf(m,i,c){for(let g=0;g<m.length;g++)if(m[g].identifier===c)return i[g]}function Ag(m,i){return Math.log(m/i)/Math.LN2}class $y extends Gp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const g=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Ag(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ag(this._distance,g),pinchAround:c}}}function Cg(m,i){return 180*m.angleWith(i)/Math.PI}class Gy extends Gp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const g=this._vector;if(this._vector=i[0].sub(i[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Cg(this._vector,g),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=Cg(i,g);return Math.abs(v)<c}}function qp(m){return Math.abs(m.y)>Math.abs(m.x)}class qy extends Gp{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,qp(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,g){const v=this._lastPoints;if(!v)return;const w=i[0].sub(v[0]),S=i[1].sub(v[1]);return this._map._cooperativeGestures&&!o.dq()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,g.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(i,c,g){if(this._valid!==void 0)return this._valid;const v=i.mag()>=2,w=c.mag()>=2;if(!v&&!w)return;if(!v||!w)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const S=i.y>0==c.y>0;return qp(i)&&qp(c)&&S}}const Hy={panStep:100,bearingStep:15,pitchStep:10};class Wy{constructor(){const i=Hy;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,g=0,v=0,w=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?g=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?g=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?v=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?v=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:k=>{const L=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Zy,zoom:c?Math.round(L)+c*(i.shiftKey?2:1):L,bearing:k.getBearing()+g*this._bearingStep,pitch:k.getPitch()+v*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:k.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zy(m){return m*(2-m)}const Rg=4.000244140625,Jb=1/450;class Qb{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Jb,o.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||o.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const g=o.q.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,c!==0&&c%Rg==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ne(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>Rg?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&V!==0&&(V=1/V);const q=c(),W=Math.pow(2,q),K=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(K*V))),this._type==="wheel"&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:c(),v=this._startZoom,w=this._easing;let S,k=!1;if(this._type==="wheel"&&v&&w){const F=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),V=w(F);S=o.aa(v,g,V),F<1?this._frameId||(this._frameId=!0):k=!0}else S=g,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=S-c();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=o.dr;if(this._prevEase){const g=this._prevEase,v=(o.q.now()-g.start)/g.duration,w=g.easing(v+.01)-g.easing(v),S=.27/Math.sqrt(w*w+1e-4)*.01,k=Math.sqrt(.0729-S*S);c=o.dp(S,k,.25,1)}return this._prevEase={start:o.q.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class To{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ky{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(i.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ex{constructor(){this._tap=new mf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,c,g){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(i,c,g))}touchmove(i,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=c[0],w=v.y-this._swipePoint.y;return this._swipePoint=v,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,c,g)}touchend(i,c,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(i,c,g)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tx{constructor(i,c,g){this._el=i,this._mousePan=c,this._touchPan=g}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vf{constructor(i,c,g){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xy{constructor(i,c,g,v){this._el=i,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wh=m=>m.zoom||m.drag||m.pitch||m.rotate;class Hp extends o.x{}class Ec{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){const g=o.a6.vec3.sub([],c,i);this.radius=o.a6.vec3.length(g[2]<0?o.a6.vec3.div([],g,this.constants):[g[0],g[1],0])}projectRay(i){o.a6.vec3.div(i,i,this.constants),o.a6.vec3.normalize(i,i),o.a6.vec3.mul(i,i,this.constants);const c=o.a6.vec3.scale([],i,this.radius);if(c[2]>0){const g=o.a6.vec3.scale([],[0,0,1],o.a6.vec3.dot(c,[0,0,1])),v=o.a6.vec3.scale([],o.a6.vec3.normalize([],[c[0],c[1],0]),this.radius),w=o.a6.vec3.add([],c,o.a6.vec3.scale([],o.a6.vec3.sub([],o.a6.vec3.add([],v,g),c),2));c[0]=w[0],c[1]=w[1]}return c}}function qu(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class ia{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nu(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ec,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aJ(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,w,S]of this._listeners){const k=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(w,k,S)}}destroy(){for(const[i,c,g]of this._listeners){const v=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(c,v,g)}}_addDefaultHandlers(i){const c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new Tg(c,i));const v=c.boxZoom=new Hh(c,i);this._add("boxZoom",v);const w=new Ig,S=new Ky;c.doubleClickZoom=new To(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const k=new ex;this._add("tapDragZoom",k);const L=c.touchPitch=new qy(c);this._add("touchPitch",L);const F=new jp(i),V=new $p(i);c.dragRotate=new vf(i,F,V),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const q=new Up(i),W=new jy(c,i);c.dragPan=new tx(g,q,W),this._add("mousePan",q),this._add("touchPan",W,["touchZoom","touchRotate"]);const K=new Gy,ae=new $y;c.touchZoomRotate=new Xy(g,ae,K,k),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Eg(c));const le=c.scrollZoom=new Qb(c,this);this._add("scrollZoom",le,["mousePan"]);const ue=c.keyboard=new Wy;this._add("keyboard",ue);for(const pe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[pe]&&c[pe].enable(i[pe])}_add(i,c,g){this._handlers.push({handlerName:i,handler:c,allowed:g}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,c,g){for(const v in i)if(v!==g&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const g of i)this._el.contains(g.target)&&c.push(g);return c}handleEvent(i,c){this._updatingCamera=!0;const g=i.type==="renderFrame",v=g?void 0:i,w={needsRenderFrame:!1},S={},k={},L=i.touches?this._getMapTouches(i.touches):void 0,F=L?te(this._el,L):g?void 0:ne(this._el,i);for(const{handlerName:W,handler:K,allowed:ae}of this._handlers){if(!K.isEnabled())continue;let le;this._blockedByActive(k,ae,W)?K.reset():K[c||i.type]&&(le=K[c||i.type](i,F,L),this.mergeHandlerResult(w,S,le,W,v),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||K.isActive())&&(k[W]=K)}const V={};for(const W in this._previousActiveHandlers)k[W]||(V[W]=v);this._previousActiveHandlers=k,(Object.keys(V).length||qu(w))&&(this._changes.push([w,S,V]),this._triggerRenderFrame()),(Object.keys(k).length||qu(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=w;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))}mergeHandlerResult(i,c,g,v,w){if(!g)return;o.l(i,g);const S={handlerName:v,originalEvent:g.originalEvent||w};g.zoomDelta!==void 0&&(c.zoom=S),g.panDelta!==void 0&&(c.drag=S),g.pitchDelta!==void 0&&(c.pitch=S),g.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const i={},c={},g={};for(const[v,w,S]of this._changes)v.panDelta&&(i.panDelta=(i.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(i.around=v.around),v.aroundCoord!==void 0&&(i.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(i.pinchAround=v.pinchAround),v.noInertia&&(i.noInertia=v.noInertia),o.l(c,w),o.l(g,S);this._updateMapTransform(i,c,g),this._changes=[]}_updateMapTransform(i,c,g){const v=this._map,w=v.transform,S=Re=>[Re.x,Re.y,Re.z];if((Re=>{const Oe=this._eventsInProgress.drag;return Oe&&!this._handlersById[Oe.handlerName].isActive()})()&&!qu(i)){const Re=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),Re!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&v._stop(!0),!qu(i))return void this._fireEvents(c,g,!0);let{panDelta:k,zoomDelta:L,bearingDelta:F,pitchDelta:V,around:q,aroundCoord:W,pinchAround:K}=i;w._isCameraConstrained&&(L>0&&(L=0),w._isCameraConstrained=!1),K!==void 0&&(q=K),(L||(Re=>c[Re]&&!this._eventsInProgress[Re])("drag"))&&q&&(this._dragOrigin=S(w.pointCoordinate3D(q)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",v._stop(!0),q=q||v.transform.centerPoint,F&&(w.bearing+=F),V&&(w.pitch+=V),w._updateCameraState();const ae=[0,0,0];if(k)if(w.projection.name==="mercator"){const Re=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(q).dir),Oe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(q.sub(k)).dir);ae[0]=Oe[0]-Re[0],ae[1]=Oe[1]-Re[1]}else{const Re=w.pointCoordinate(q);if(w.projection.name==="globe"){k=k.rotate(-w.angle);const Oe=w._pixelsPerMercatorPixel/w.worldSize;ae[0]=-k.x*o.ds(o.aM(Re.y))*Oe,ae[1]=-k.y*o.ds(w.center.lat)*Oe}else{const Oe=w.pointCoordinate(q.sub(k));Re&&Oe&&(ae[0]=Oe.x-Re.x,ae[1]=Oe.y-Re.y)}}const le=w.zoom,ue=[0,0,0];if(L){const Re=S(W||w.pointCoordinate3D(q)),Oe={dir:o.a6.vec3.normalize([],o.a6.vec3.sub([],Re,w._camera.position))};if(Oe.dir[2]<0){const Ae=w.zoomDeltaToMovement(Re,L);o.a6.vec3.scale(ue,Oe.dir,Ae)}}const pe=o.a6.vec3.add(ae,ae,ue);w._translateCameraConstrained(pe),L&&Math.abs(w.zoom-le)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,g,!0)}_fireEvents(i,c,g){const v=Wh(this._eventsInProgress),w=Wh(i),S={};for(const V in i){const{originalEvent:q}=i[V];this._eventsInProgress[V]||(S[`${V}start`]=q),this._eventsInProgress[V]=i[V]}!v&&w&&this._fireEvent("movestart",w.originalEvent);for(const V in S)this._fireEvent(V,S[V]);w&&this._fireEvent("move",w.originalEvent);for(const V in i){const{originalEvent:q}=i[V];this._fireEvent(V,q)}const k={};let L;for(const V in this._eventsInProgress){const{handlerName:q,originalEvent:W}=this._eventsInProgress[V];this._handlersById[q].isActive()||(delete this._eventsInProgress[V],L=c[q]||W,k[`${V}end`]=L)}for(const V in k)this._fireEvent(V,k[V]);const F=Wh(this._eventsInProgress);if(g&&(v||w)&&!F){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;V?(q(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:L})):(this._map.fire(new o.x("moveend",{originalEvent:L})),q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new o.x(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Hp("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Kl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Pg extends o.E{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aJ(["_renderFrameCallback"],this)}getCenter(){return new o.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,g){return i=o.P.convert(i).mult(-1),this.panTo(this.transform.center,o.l({offset:i},c),g)}panTo(i,c,g){return this.easeTo(o.l({center:i},c),g)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,g){return this.easeTo(o.l({zoom:i},c),g)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,g){return this.easeTo(o.l({bearing:i},c),g)}resetNorth(i,c){return this.rotateTo(0,o.l({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(o.l({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=o.as.convert(i);const g=c&&c.bearing||0,v=c&&c.pitch||0,w=i.getNorthWest(),S=i.getSouthEast();return this._cameraForBounds(this.transform,w,S,g,v,c)}_extendPadding(i){const c={top:0,right:0,bottom:0,left:0};return i==null?o.l({},c,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:o.l({},c,i)}_extendCameraOptions(i){return(i=o.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,c){const g=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return g/v>i.aspect?g/(2*Math.tan(.5*i.fovX)*i.aspect):v/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,c,g,v,w,S){const k=i.clone(),L=this._extendCameraOptions(S);k.bearing=v,k.pitch=w;const F=o.bK.convert(c),V=o.bK.convert(g),q=.5*(F.lat+V.lat),W=.5*(F.lng+V.lng),K=o.dt(q,W),ae=o.a6.vec3.normalize([],K),le=o.a6.vec3.normalize([],o.a6.vec3.cross([],ae,[0,1,0])),ue=o.a6.vec3.cross([],le,ae),pe=[le[0],le[1],le[2],0,ue[0],ue[1],ue[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],Re=[K,o.dt(F.lat,F.lng),o.dt(V.lat,F.lng),o.dt(V.lat,V.lng),o.dt(F.lat,V.lng),o.dt(q,F.lng),o.dt(q,V.lng),o.dt(F.lat,W),o.dt(V.lat,W)];let Oe=o.c9.fromPoints(Re.map(kt=>[o.a6.vec3.dot(le,kt),o.a6.vec3.dot(ue,kt),o.a6.vec3.dot(ae,kt)]));const Ae=o.a6.vec3.transformMat4([],Oe.center,pe);o.a6.vec3.squaredLength(Ae)===0&&o.a6.vec3.set(Ae,0,0,1),o.a6.vec3.normalize(Ae,Ae),o.a6.vec3.scale(Ae,Ae,o.aq),k.center=o.du(Ae);const Be=k.getWorldToCameraMatrix(),Le=o.a6.mat4.invert(new Float64Array(16),Be);Oe=o.c9.applyTransform(Oe,o.a6.mat4.multiply([],Be,pe));const He=this._extendAABB(Oe,k,L,v);if(!He)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Oe=He,o.a6.vec3.transformMat4(Ae,Ae,Be);const je=.5*(Oe.max[2]-Oe.min[2]),Ze=this._minimumAABBFrustumDistance(k,Oe),rt=o.a6.vec3.scale([],[0,0,1],je),Je=o.a6.vec3.add(rt,Ae,rt),Ye=Ze+(k.pitch===0?0:o.a6.vec3.distance(Ae,Je)),ht=k.globeCenterInViewSpace,Ct=o.a6.vec3.sub([],Ae,[ht[0],ht[1],ht[2]]);o.a6.vec3.normalize(Ct,Ct),o.a6.vec3.scale(Ct,Ct,Ye);const Ft=o.a6.vec3.add([],Ae,Ct);o.a6.vec3.transformMat4(Ft,Ft,Le);const At=o.dw/o.aq,Yt=o.a6.vec3.length(Ft),dt=o.bD(Math.max(Yt*At-o.dw,Number.EPSILON),0),Lt=Math.min(k.zoomFromMercatorZAdjusted(dt),L.maxZoom);return Lt>.5*(o.c2+o.bU)?(k.setProjection({name:"mercator"}),k.zoom=Lt,this._cameraForBounds(k,c,g,v,w,S)):{center:k.center,zoom:Lt,bearing:v,pitch:w}}_extendAABB(i,c,g,v){const w=.5*((g.padding.left||0)+(g.padding.right||0)),S=.5*((g.padding.top||0)+(g.padding.bottom||0)),k=S,L=w,F=w,V=S,q=c.width-(L+F),W=c.height-(k+V),K=o.a6.vec3.sub([],i.max,i.min),ae=Math.min(q/K[0],W/K[1]),le=Math.min(c.scaleZoom(c.scale*ae),g.maxZoom);if(isNaN(le))return null;const ue=c.scale/c.zoomScale(le),pe=new o.c9([i.min[0]-L*ue,i.min[1]-V*ue,i.min[2]],[i.max[0]+F*ue,i.max[1]+k*ue,i.max[2]]),Re=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new o.P(g.offset.x,g.offset.y):o.P.convert(g.offset)).rotate(-o.bB(v));return pe.center[0]-=Re.x*ue,pe.center[1]+=Re.y*ue,pe}queryTerrainElevation(i,c){const g=this.transform.elevation;return g?(c=o.l({},{exaggerated:!0},c),g.getAtPoint(o.a5.fromLngLat(i),null,c.exaggerated)):null}_cameraForBounds(i,c,g,v,w,S){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,c,g,v,w,S);const k=i.clone(),L=this._extendCameraOptions(S);k.bearing=v,k.pitch=w;const F=o.bK.convert(c),V=o.bK.convert(g),q=new o.bK(F.lng,V.lat),W=new o.bK(V.lng,F.lat),K=k.project(F),ae=k.project(V),le=this.queryTerrainElevation(F),ue=this.queryTerrainElevation(V),pe=this.queryTerrainElevation(q),Re=this.queryTerrainElevation(W),Oe=[[K.x,K.y,Math.min(le||0,ue||0,pe||0,Re||0)],[ae.x,ae.y,Math.max(le||0,ue||0,pe||0,Re||0)]];let Ae=o.c9.fromPoints(Oe);const Be=k.getWorldToCameraMatrix(),Le=o.a6.mat4.invert(new Float64Array(16),Be);Ae=o.c9.applyTransform(Ae,Be);const He=this._extendAABB(Ae,k,L,v);if(!He)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ae=He;const je=.5*o.a6.vec3.sub([],Ae.max,Ae.min)[2],Ze=this._minimumAABBFrustumDistance(k,Ae),rt=[0,0,1,0];o.a6.vec4.transformMat4(rt,rt,Be),o.a6.vec4.normalize(rt,rt);const Je=o.a6.vec3.scale([],rt,Ze+je),Ye=o.a6.vec3.add([],Ae.center,Je);o.a6.vec3.transformMat4(Ae.center,Ae.center,Le),o.a6.vec3.transformMat4(Ye,Ye,Le);const ht=k.unproject(new o.P(Ae.center[0],Ae.center[1])),Ct=o.dv(k.projection,ht),Ft=Math.pow(2,Ct),At=Math.min(k._zoomFromMercatorZ(Ye[2]*k.pixelsPerMeter*Ft/k.worldSize),L.maxZoom);return k.mercatorFromTransition&&At<.5*(o.c2+o.bU)?(k.setProjection({name:"globe"}),k.zoom=At,this._cameraForBounds(k,c,g,v,w,S)):{center:ht,zoom:At,bearing:v,pitch:w}}fitBounds(i,c,g){const v=this.cameraForBounds(i,c);return this._fitInternal(v,c,g)}fitScreenCoordinates(i,c,g,v,w){const S=o.P.convert(i),k=o.P.convert(c),L=new o.P(Math.min(S.x,k.x),Math.min(S.y,k.y)),F=new o.P(Math.max(S.x,k.x),Math.max(S.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,k))return this;const V=this.transform.pointLocation3D(L),q=this.transform.pointLocation3D(F),W=this.transform.pointLocation3D(new o.P(L.x,F.y)),K=this.transform.pointLocation3D(new o.P(F.x,L.y)),ae=[Math.min(V.lng,q.lng,W.lng,K.lng),Math.min(V.lat,q.lat,W.lat,K.lat)],le=[Math.max(V.lng,q.lng,W.lng,K.lng),Math.max(V.lat,q.lat,W.lat,K.lat)],ue=v&&v.pitch?v.pitch:this.getPitch(),pe=this._cameraForBounds(this.transform,ae,le,g,ue,v);return this._fitInternal(pe,v,w)}_fitInternal(i,c,g){return i?(c=o.l(i,c)).linear?this.easeTo(c,g):this.flyTo(c,g):this}jumpTo(i,c){this.stop();const g=i.preloadOnly?this.transform.clone():this.transform;let v=!1,w=!1,S=!1;"zoom"in i&&g.zoom!==+i.zoom&&(v=!0,g.zoom=+i.zoom),i.center!==void 0&&(g.center=o.bK.convert(i.center)),"bearing"in i&&g.bearing!==+i.bearing&&(w=!0,g.bearing=+i.bearing),"pitch"in i&&g.pitch!==+i.pitch&&(S=!0,g.pitch=+i.pitch);const k=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!g.isPaddingEqual(k))if(i.retainPadding===!1){const L=g.clone();L.padding=k,g.setLocationAtPoint(g.center,L.centerPoint)}else g.padding=k;return i.preloadOnly?(this._preloadTiles(g),this):(this.fire(new o.x("movestart",c)).fire(new o.x("move",c)),v&&this.fire(new o.x("zoomstart",c)).fire(new o.x("zoom",c)).fire(new o.x("zoomend",c)),w&&this.fire(new o.x("rotatestart",c)).fire(new o.x("rotate",c)).fire(new o.x("rotateend",c)),S&&this.fire(new o.x("pitchstart",c)).fire(new o.x("pitch",c)).fire(new o.x("pitchend",c)),this.fire(new o.x("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Kl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){const g=this.transform;if(!g.projection.supportsFreeCamera)return o.w(Kl),this;this.stop();const v=g.zoom,w=g.pitch,S=g.bearing;g.setFreeCameraOptions(i);const k=v!==g.zoom,L=w!==g.pitch,F=S!==g.bearing;return this.fire(new o.x("movestart",c)).fire(new o.x("move",c)),k&&this.fire(new o.x("zoomstart",c)).fire(new o.x("zoom",c)).fire(new o.x("zoomend",c)),F&&this.fire(new o.x("rotatestart",c)).fire(new o.x("rotate",c)).fire(new o.x("rotateend",c)),L&&this.fire(new o.x("pitchstart",c)).fire(new o.x("pitch",c)).fire(new o.x("pitchend",c)),this.fire(new o.x("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),((i=o.l({offset:[0,0],duration:500,easing:o.dr},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const g=this.transform,v=this.getZoom(),w=this.getBearing(),S=this.getPitch(),k=this.getPadding(),L="zoom"in i?+i.zoom:v,F="bearing"in i?this._normalizeBearing(i.bearing,w):w,V="pitch"in i?+i.pitch:S,q=this._extendPadding(i.padding),W=o.P.convert(i.offset);let K,ae,le;if(g.projection.name==="globe"){const rt=o.a5.fromLngLat(g.center),Je=W.rotate(-g.angle);rt.x+=Je.x/g.worldSize,rt.y+=Je.y/g.worldSize;const Ye=rt.toLngLat(),ht=o.bK.convert(i.center||Ye);this._normalizeCenter(ht),K=g.centerPoint.add(Je),ae=new o.P(rt.x,rt.y).mult(g.worldSize),le=new o.P(o.am(ht.lng),o.at(ht.lat)).mult(g.worldSize).sub(ae)}else{K=g.centerPoint.add(W);const rt=g.pointLocation(K),Je=o.bK.convert(i.center||rt);this._normalizeCenter(Je),ae=g.project(rt),le=g.project(Je).sub(ae)}const ue=g.zoomScale(L-v);let pe,Re;i.around&&(pe=o.bK.convert(i.around),Re=g.locationPoint(pe));const Oe=this._zooming||L!==v,Ae=this._rotating||w!==F,Be=this._pitching||V!==S,Le=!g.isPaddingEqual(q),He=i.retainPadding===!1?g.clone():g,je=rt=>Je=>{if(Oe&&(rt.zoom=o.aa(v,L,Je)),Ae&&(rt.bearing=o.aa(w,F,Je)),Be&&(rt.pitch=o.aa(S,V,Je)),Le&&(He.interpolatePadding(k,q,Je),K=He.centerPoint.add(W)),pe)rt.setLocationAtPoint(pe,Re);else{const Ye=rt.zoomScale(rt.zoom-v),ht=L>v?Math.min(2,ue):Math.max(.5,ue),Ct=Math.pow(ht,1-Je),Ft=rt.unproject(ae.add(le.mult(Je*Ct)).mult(Ye));rt.setLocationAtPoint(rt.renderWorldCopies?Ft.wrap():Ft,K)}return i.preloadOnly||this._fireMoveEvents(c),rt};if(i.preloadOnly){const rt=this._emulate(je,i.duration,g);return this._preloadTiles(rt),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Oe,this._rotating=Ae,this._pitching=Be,this._padding=Le,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,Ze),this._ease(je(g),rt=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(c,rt)},i),this}_prepareEase(i,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||g.moving||this.fire(new o.x("movestart",i)),this._zooming&&!g.zooming&&this.fire(new o.x("zoomstart",i)),this._rotating&&!g.rotating&&this.fire(new o.x("rotatestart",i)),this._pitching&&!g.pitching&&this.fire(new o.x("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.x("move",i)),this._zooming&&this.fire(new o.x("zoom",i)),this._rotating&&this.fire(new o.x("rotate",i)),this._pitching&&this.fire(new o.x("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new o.x("zoomend",i)),v&&this.fire(new o.x("rotateend",i)),w&&this.fire(new o.x("pitchend",i)),this.fire(new o.x("moveend",i))}flyTo(i,c){if(this._prefersReducedMotion(i)){const kt=o.ar(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(kt,c)}this.stop(),i=o.l({offset:[0,0],speed:1.2,curve:1.42,easing:o.dr},i);const g=this.transform,v=this.getZoom(),w=this.getBearing(),S=this.getPitch(),k=this.getPadding(),L="zoom"in i?o.ap(+i.zoom,g.minZoom,g.maxZoom):v,F="bearing"in i?this._normalizeBearing(i.bearing,w):w,V="pitch"in i?+i.pitch:S,q=this._extendPadding(i.padding),W=g.zoomScale(L-v),K=o.P.convert(i.offset);let ae=g.centerPoint.add(K);const le=g.pointLocation(ae),ue=o.bK.convert(i.center||le);this._normalizeCenter(ue);const pe=g.project(le),Re=g.project(ue).sub(pe);let Oe=i.curve;const Ae=Math.max(g.width,g.height),Be=Ae/W,Le=Re.mag();if("minZoom"in i){const kt=o.ap(Math.min(i.minZoom,v,L),g.minZoom,g.maxZoom),Qt=Ae/g.zoomScale(kt-v);Oe=Math.sqrt(Qt/Le*2)}const He=Oe*Oe;function je(kt){const Qt=(Be*Be-Ae*Ae+(kt?-1:1)*He*He*Le*Le)/(2*(kt?Be:Ae)*He*Le);return Math.log(Math.sqrt(Qt*Qt+1)-Qt)}function Ze(kt){return(Math.exp(kt)-Math.exp(-kt))/2}function rt(kt){return(Math.exp(kt)+Math.exp(-kt))/2}const Je=je(0);let Ye=function(kt){return rt(Je)/rt(Je+Oe*kt)},ht=function(kt){return Ae*((rt(Je)*(Ze(Qt=Je+Oe*kt)/rt(Qt))-Ze(Je))/He)/Le;var Qt},Ct=(je(1)-Je)/Oe;if(Math.abs(Le)<1e-6||!isFinite(Ct)){if(Math.abs(Ae-Be)<1e-6)return this.easeTo(i,c);const kt=Be<Ae?-1:1;Ct=Math.abs(Math.log(Be/Ae))/Oe,ht=function(){return 0},Ye=function(Qt){return Math.exp(kt*Oe*Qt)}}i.duration="duration"in i?+i.duration:1e3*Ct/("screenSpeed"in i?+i.screenSpeed/Oe:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Ft=w!==F,At=V!==S,Yt=!g.isPaddingEqual(q),dt=i.retainPadding===!1?g.clone():g,Lt=kt=>Qt=>{const tr=Qt*Ct,Nt=1/Ye(tr);kt.zoom=Qt===1?L:v+kt.scaleZoom(Nt),Ft&&(kt.bearing=o.aa(w,F,Qt)),At&&(kt.pitch=o.aa(S,V,Qt)),Yt&&(dt.interpolatePadding(k,q,Qt),ae=dt.centerPoint.add(K));const Ut=Qt===1?ue:kt.unproject(pe.add(Re.mult(ht(tr))).mult(Nt));return kt.setLocationAtPoint(kt.renderWorldCopies?Ut.wrap():Ut,ae),kt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(c),kt};if(i.preloadOnly){const kt=this._emulate(Lt,i.duration,g);return this._preloadTiles(kt),this}return this._zooming=!0,this._rotating=Ft,this._pitching=At,this._padding=Yt,this._prepareEase(c,!1),this._ease(Lt(g),()=>this._afterEase(c),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!i){const g=this.handlers;g&&g.stop(!1)}return this}_ease(i,c,g){g.animate===!1||g.duration===0?(i(1),c()):(this._easeStart=o.q.now(),this._easeOptions=g,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=o.bA(i,-180,180);const g=Math.abs(i-c);return Math.abs(i-360-c)<g&&(i-=360),Math.abs(i+360-c)<g&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const g=i.lng-c.center.lng;i.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,c,g){const v=Math.ceil(15*c/1e3),w=[],S=i(g.clone());for(let k=0;k<=v;k++){const L=S(k/v);w.push(L.clone())}return w}_preloadTiles(i,c){}}class Wp{constructor(i={}){this.options=i,o.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const c=this.options&&this.options.compact,g=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ye("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const v=ye("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",g),this._innerContainer=ye("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(i){const g=c.reduce((v,w,S)=>(w.value&&(v+=`${w.key}=${w.value}${S<c.length-1?"&":""}`),v),"?");i.href=`${o.e.FEEDBACK_URL}/${g}#${wc(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const c=this._map.style._mergedSourceCaches;for(const v in c){const w=c[v];if(w.used){const S=w.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort((v,w)=>v.length-w.length),i=i.filter((v,w)=>{for(let S=w+1;S<i.length;S++)if(i[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const g=i.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,i.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mg{constructor(){o.aJ(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ye("div","mapboxgl-ctrl");const c=ye("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const c in i){const g=i[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Yy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(const v of g)if(v.id===i)return void(v.cancelled=!0)}run(i=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const g of c)if(!g.cancelled&&(g.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class bf{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const c=o.cw((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,g){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+g}}const rx={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class nx{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class kg{constructor(i){this.map=i,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(i,c){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const{type:g,filter:v}=c;if(v){const S=o.M(v,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(S.result==="error")throw new Error(S.value.map(k=>`${k.key}: ${k.message}`).join(", "));this.filters.set(i,S.value)}const w=this.interactionsByType.get(g)||new Map;w.size===0&&(this.map.on(g,this.handleType),this.interactionsByType.set(g,w)),w.set(i,c),this.typeById.set(i,g)}remove(i){const c=this.typeById.get(i);if(!c)return;this.typeById.delete(i),this.filters.delete(i);const g=this.interactionsByType.get(c);g&&(g.delete(i),g.size===0&&this.map.off(c,this.handleType))}handleType(i){const c=i.features||this.map.queryRenderedFeatures(i.point);if(!c)return;const g=this.interactionsByType.get(i.type),v={zoom:0};for(const[w,S]of g){const k=this.filters.get(w),{handler:L,layers:F}=S;for(const V of c)if((!F||F.includes(V.layer.id))&&(!k||k.evaluate(v,V))&&L({id:w,feature:V,interaction:S})!==!1)break}}}const Og={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},xf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zh{constructor(i,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new jp({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,g&&(this.mousePitch=new $p({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),be()}move(i,c){const g=this.map,v=this.mouseRotate.mousemoveWindow(i,c),w=v&&v.bearingDelta;if(w&&g.setBearing(g.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(i,c),k=S&&S.pitchDelta;k&&g.setPitch(g.getPitch()+k)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ze(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(o.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ne(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ne(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=te(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Xl(m,i,c){if(m=new o.bK(m.lng,m.lat),i){const g=new o.bK(m.lng-360,m.lat),v=new o.bK(m.lng+360,m.lat),w=360*Math.ceil(Math.abs(m.lng-c.center.lng)/360),S=c.locationPoint(m).distSqr(i),k=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint(g).distSqr(i)<S&&(k||Math.abs(g.lng-c.center.lng)<w)?m=g:c.locationPoint(v).distSqr(i)<S&&(k||Math.abs(v.lng-c.center.lng)<w)&&(m=v)}for(;Math.abs(m.lng-c.center.lng)>180;){const g=c.locationPoint(m);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;m.lng>c.center.lng?m.lng-=360:m.lng+=360}return m}const rl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Yl extends o.E{constructor(i,c){if(super(),(i instanceof HTMLElement||c)&&(i=o.l({element:i},c)),o.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=o.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ye("div");const w=41,S=27,k=ke("svg",{display:"block",height:w*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${w}`},this._element),L=ke("radialGradient",{id:"shadowGradient"},ke("defs",{},k));ke("stop",{offset:"10%","stop-opacity":.4},L),ke("stop",{offset:"100%","stop-opacity":.05},L),ke("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),ke("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),ke("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),ke("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=o.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const g=this._element.classList;for(const w in rl)g.remove(`mapboxgl-marker-anchor-${w}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);const v=i&&i.className?i.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.bK.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const c=i.code,g=i.charCode||i.keyCode;c!=="Space"&&c!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,c=this._pos;if(!i||!c)return!1;const g=i.unproject(c),v=i.getFreeCameraOptions();if(!v.position)return!1;const w=v.position.toLngLat();return w.distanceTo(g)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const c=this._pos;if(!c||c.x<0||c.x>i.transform.width||c.y<0||c.y>i.transform.height)return void this._clearFadeTimer();const g=i.unproject(c);let v;i._showingGlobe()&&o.dz(i.transform,this._lngLat)?v=0:(v=1-i._queryFogOpacity(g),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${rl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const i=this._pos,c=this._map,g=this.getPitchAlignment();if(!c||!i||g!=="map")return"";if(!c._showingGlobe()){const L=c.getPitch();return L?`rotateX(${L}deg)`:""}const v=o.c0(o.dA(c.transform,this._lngLat)),w=i.sub(o.dB(c.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";const k=v/S;return`rotateX(${-w.y*k}deg) rotateY(${w.x*k}deg)`}_calculateZTransform(){const i=this._pos,c=this._map;if(!c||!i)return"";let g=0;const v=this.getRotationAlignment();if(v==="map")if(c._showingGlobe()){const w=c.project(new o.bK(this._lngLat.lng,this._lngLat.lat+.001)),S=c.project(new o.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);g=o.c0(Math.atan2(S.y,S.x))-90}else g=-c.getBearing();else if(v==="horizon"){const w=o.a7(4,6,c.getZoom()),S=o.dB(c.transform);S.y+=w*c.transform.height;const k=i.sub(S),L=o.c0(Math.atan2(k.y,k.x));g=(L>90?L-270:L+90)*(1-w)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Xl(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=o.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const c=this._map;if(!c)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(i.point.dist(g)<w)return;this._isDragging=!0}this._pos=i.point.sub(v),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.x("dragstart"))),this.fire(new o.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.x("dragend")),this._state="inactive"}_addDragHandler(i){const c=this._map,g=this._pos;c&&g&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(g),this._pointerdownPos=i.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const c=this._map;return c&&(i?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Hu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},iu={maxWidth:100,unit:"metric"},ix={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ox={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sx=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jy(m=new o.P(0,0),i="bottom"){if(typeof m=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(i){case"top":return new o.P(0,m);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-m);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(m,0);case"right":return new o.P(-m,0)}return new o.P(0,0)}return m instanceof o.P||Array.isArray(m)?o.P.convert(m):o.P.convert(m[i]||[0,0])}return{version:O,supported:ge.supported,setRTLTextPlugin:o.dC,getRTLTextPluginStatus:o.dD,Map:class extends Pg{constructor(m){U.mark(z.create);const i=m;if((m=o.l({},Og,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&o.dx(window)&&(m.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new wh(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new Yy,this._domRenderTaskQueue=new Yy,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aP(),this._locale=o.l({},rx,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new bf(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new Et(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?{...m.contextCreateOptions}:{},typeof m.container=="string"){const c=document.getElementById(m.container);if(!c)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=c}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),o.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new nx),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ia(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||o.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new ru(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const c=m.bounds;c&&(this.resize(),this.fitBounds(c,o.l({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new Wp({customAttribution:m.customAttribution})),this._logoControl=new Mg,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.x(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.x(`${c.dataType}dataloading`,c))}),this._interactions=new kg(this)}_getMapId(){return this._mapId}addControl(m,i){if(i===void 0&&(i=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[i];return i.indexOf("bottom")!==-1?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(m);return i>-1&&this._controls.splice(i,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new o.x("movestart",m)).fire(new o.x("move",m)),this.fire(new o.x("resize",m)),i&&this.fire(new o.x("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(o.as.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new o.x("zoomstart")).fire(new o.x("zoom")).fire(new o.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new o.x("pitchstart")).fire(new o.x("pitch")).fire(new o.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(i=>i==="auto"?navigator.language:i):m}setLanguage(m){const i=this._parseLanguage(m);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,i=m.projection.name;let c;i==="globe"&&m.zoom>=o.bU?(m.setMercatorFromTransition(),c=!0):i==="mercator"&&m.zoom<o.bU&&(m.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(m,i){return this._updateProjection(m||i||{name:"mercator"})}_updateProjection(m){let i;return i=m.name==="globe"&&this.transform.zoom>=o.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m){return this.transform.locationPoint3D(o.bK.convert(m))}unproject(m){return this.transform.pointLocation3D(o.P.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,i,c){if(m==="mouseenter"||m==="mouseover"){let g=!1;const v=S=>{const k=i.filter(F=>this.getLayer(F)),L=k.length?this.queryRenderedFeatures(S.point,{layers:k}):[];L.length?g||(g=!0,c.call(this,new xa(m,this,S.originalEvent,{features:L}))):g=!1},w=()=>{g=!1};return{layers:new Set(i),listener:c,delegates:{mousemove:v,mouseout:w}}}if(m==="mouseleave"||m==="mouseout"){let g=!1;const v=S=>{const k=i.filter(L=>this.getLayer(L));(k.length?this.queryRenderedFeatures(S.point,{layers:k}):[]).length?g=!0:g&&(g=!1,c.call(this,new xa(m,this,S.originalEvent)))},w=S=>{g&&(g=!1,c.call(this,new xa(m,this,S.originalEvent)))};return{layers:new Set(i),listener:c,delegates:{mousemove:v,mouseout:w}}}{const g=v=>{const w=i.filter(k=>this.getLayer(k)),S=w.length?this.queryRenderedFeatures(v.point,{layers:w}):[];S.length&&(v.features=S,c.call(this,v),delete v.features)};return{layers:new Set(i),listener:c,delegates:{[m]:g}}}}on(m,i,c){if(typeof i=="function"||c===void 0)return super.on(m,i);if(Array.isArray(i)||(i=[i]),i){for(const v of i)if(!this._isValidId(v))return this}const g=this._createDelegatedListener(m,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(m,i,c){if(typeof i=="function"||c===void 0)return super.once(m,i);if(Array.isArray(i)||(i=[i]),i){for(const v of i)if(!this._isValidId(v))return this}const g=this._createDelegatedListener(m,i,c);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(m,i,c){if(typeof i=="function"||c===void 0)return super.off(m,i);const g=new Set(Array.isArray(i)?i:[i]);for(const S of g)if(!this._isValidId(S))return this;const v=(S,k)=>{if(S.size!==k.size)return!1;for(const L of S)if(!k.has(L))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[m]:void 0;return w&&(S=>{for(let k=0;k<S.length;k++){const L=S[k];if(L.listener===c&&v(L.layers,g)){for(const F in L.delegates)this.off(F,L.delegates[F]);return S.splice(k,1),this}}})(w),this}queryRenderedFeatures(m,i){if(!this.style)return[];if(i!==void 0||m===void 0||m instanceof o.P||Array.isArray(m)||(i=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const c of i.layers)if(!this._isValidId(c))return[]}return this.style.queryRenderedFeatures(m,i,this.transform)}querySourceFeatures(m,i){return this._isValidId(m)?this.style.querySourceFeatures(m,i):[]}isPointOnSurface(m){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&o.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(m))}addInteraction(m,i){return this._interactions.add(m,i),this}removeInteraction(m){return this._interactions.remove(m),this}setStyle(m,i){return i=o.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&m&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(m,(c,g)=>{c?(o.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(m,i)):g&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(m,i))}_getUIString(m){const i=this._locale[m];if(i==null)throw new Error(`Missing UI string '${m}'`);return i}_updateStyle(m,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const c=o.l({},i);i&&i.config&&(c.initialConfig=i.config,delete c.config),this.style=new ma(this,c).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ma(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new o.t(new Error("IDs can't be empty."))),!1):!o.cn(m)||(this.fire(new o.t(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}addSource(m,i){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,i),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,i,c){this._lazyInitEmptyStyle(),this.style.addSourceType(m,i,c)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,i,{pixelRatio:c=1,sdf:g=!1,stretchX:v,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:k,height:L,data:F}=o.q.getImageData(i);this.style.addImage(m,{data:new o.r({width:k,height:L},F),pixelRatio:c,stretchX:v,stretchY:w,content:S,sdf:g,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new o.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:L}=i,F=i;this.style.addImage(m,{data:new o.r({width:k,height:L},new Uint8Array(F.data)),pixelRatio:c,stretchX:v,stretchY:w,content:S,sdf:g,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,i){this._lazyInitEmptyStyle();const c=this.style.getImage(m);if(!c)return void this.fire(new o.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?o.q.getImageData(i):i,{width:v,height:w,data:S}=g;if(v===void 0||w===void 0)return void this.fire(new o.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==c.data.width||w!==c.data.height)return void this.fire(new o.t(new Error(`The width and height of the updated image (${v}, ${w})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const k=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);c.data.replace(S,k),this.style.updateImage(m,c)}hasImage(m){return m?!!this.style&&!!this.style.getImage(m):(this.fire(new o.t(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,i){o.o(this._requestManager.transformRequest(m,o.R.Image),(c,g)=>{i(c,g instanceof HTMLImageElement?o.q.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(m,i){this._lazyInitEmptyStyle(),this.style.addModel(m,i)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new o.t(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,i){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,i),this._update(!0)):this}getSlot(m){const i=this.getLayer(m);return i&&i.slot||null}setSlot(m,i){return this.style.setSlot(m,i),this.style.mergeLayers(),this._update(!0)}addImport(m,i){return this.style.addImport(m,i),this}updateImport(m,i){return typeof i!="string"&&i.id!==m?(this.removeImport(m),this.addImport(i)):(this.style.updateImport(m,i),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,i){return this.style.moveImport(m,i),this._update(!0)}moveLayer(m,i){return this._isValidId(m)?(this.style.moveLayer(m,i),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const i=this.style.getOwnLayer(m);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,i,c){return this._isValidId(m)?(this.style.setLayerZoomRange(m,i,c),this._update(!0)):this}setFilter(m,i,c={}){return this._isValidId(m)?(this.style.setFilter(m,i,c),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,i,c,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,i,c,g),this._update(!0)):this}getPaintProperty(m,i){return this._isValidId(m)?this.style.getPaintProperty(m,i):null}setLayoutProperty(m,i,c,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,i,c,g),this._update(!0)):this}getLayoutProperty(m,i){return this._isValidId(m)?this.style.getLayoutProperty(m,i):null}getSchema(m){return this.style.getSchema(m)}setSchema(m,i){return this.style.setSchema(m,i),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,i){return this.style.setConfig(m,i),this._update(!0)}getConfigProperty(m,i){return this.style.getConfigProperty(m,i)}setConfigProperty(m,i,c){return this.style.setConfigProperty(m,i,c),this._update(!0)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const i=m[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bK.convert(m),this.transform):0}setFeatureState(m,i){return this._isValidId(m.source)?(this.style.setFeatureState(m,i),this._update()):this}removeFeatureState(m,i){return this._isValidId(m.source)?(this.style.removeFeatureState(m,i),this._update()):this}getFeatureState(m){return this._isValidId(m.source)?this.style.getFeatureState(m):null}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let c,g,v,w=this._container;for(;w&&(!g||!v);){const S=window.getComputedStyle(w).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(g=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(v=c[3])),w=w.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=v?Math.abs(i/v):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=ye("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ye("div","mapboxgl-canvas-container",m);this._canvas=ye("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=ye("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{g[v]=ye("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,i){const c=o.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(m),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${i}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const i=this._markers.indexOf(m);i!==-1&&this._markers.splice(i,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const i=this._popups.indexOf(m);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const m=o.l({},ge.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",m);i?(Fe(i,!0),this.painter=new vg(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.m.testSupport(i)):this.fire(new o.t(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.x("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new o.x("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let i;this.fire(new o.x("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,g=o.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,V=this.transform.pitch,q=o.q.now(),W=new o.a3(F,{now:q,fadeDuration:w,pitch:V,transition:this.style.transition});this.style.update(W)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(g);const k=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(k&&(this._placementDirty=k.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,U.mark(z.load),this.fire(new o.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const F=o.q.now()-g;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const V=v.getQueryParameter(i,v.QUERY_RESULT)/1e6;v.deleteQuery(i),this.fire(new o.x("gpu-timing-frame",{cpuTime:F,gpuTime:V}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const V=this.painter.queryGpuTimers(F);this.fire(new o.x("gpu-timing-layer",{layerTimes:V}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const V=this.painter.queryGpuTimeDeferredRender(F);this.fire(new o.x("gpu-timing-deferred-render",{gpuTime:V}))},50)}const L=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(L||this._repaint)this.triggerRepaint();else{const F=this.idle();if(F&&(S=this._updateAverageElevation(g,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new o.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new o.x("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||L||(this._fullyLoaded=!0,U.mark(z.fullLoad),this._performanceMetricsCollection&&Ot(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const i of this._markers)m&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!m||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(m,i=!1){const c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(i||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const v=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const S=Math.abs(v-w);if(S>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,m,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(m)&&c(this._averageElevation.getValue(m))}_authenticate(){Se(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===tt||m.status===401)){const i=this.painter.context.gl;Fe(i,!1),this._logoControl instanceof Mg&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Dt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&vt(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const c=this.painter.context.gl,g=c.createFramebuffer();function v(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(v(m),i.canvasCopies.map(v),i.timeStamps)}_canvasPixelComparison(m,i,c){let g=c[1]-c[0];const v=m.length/4;for(let w=0;w<i.length;w++){const S=i[w];let k=0;for(let L=0;L<S.length;L+=4)S[L]===m[L]&&S[L+1]===m[L+1]&&S[L+2]===m[L+2]&&S[L+3]===m[L+3]&&(k+=1);g+=(c[w+2]-c[w+1])*(1-k/v)}return g}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Kt.delete(this.painter.context.gl),lr.remove(),pr.remove(),this._removed=!0,this.fire(new o.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=o.q.frame(i=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)}))}_preloadTiles(m){const i=this.style?this.style.getSourceCaches():[];return o.bf(i,(c,g)=>c._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this._tp.refreshUI(),m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,this._tp.refreshUI(),m&&this._update())}_setCacheLimits(m,i){o.dy(m,i)}get version(){return O}},NavigationControl:class{constructor(m={}){this.options=o.l({},xf,m),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:i}):c.resetNorth({},{originalEvent:i}))}),this._compassIcon=ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const i=m.getZoom(),c=i===m.getMaxZoom(),g=i===m.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zh(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,i){const c=ye("button",m,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(m,i){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${i}`);m.setAttribute("aria-label",c),m.firstElementChild&&m.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(m={}){super();const i=navigator.geolocation;this.options=o.l({geolocation:i},Hu,m),o.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const i=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,m(c)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>i(c.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(m){const i=this._map.getMaxBounds(),c=m.coords;return!!i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new o.x("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("geolocate",m)),this._finish()}}_updateCamera(m){const i=new o.bK(m.coords.longitude,m.coords.latitude),c=m.coords.accuracy,g=this._map.getBearing(),v=o.l({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),v,{geolocateSource:!0})}_updateMarker(m){if(m){const i=new o.bK(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,i=o.bD(1,m._center.lat)*m.worldSize,c=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.x("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ye("button","mapboxgl-ctrl-geolocate",this._container),ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye("div","mapboxgl-user-location"),this._dotElement.appendChild(ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.x("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Wp,ScaleControl:class{constructor(m={}){this.options=o.l({},iu,m),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,i=this._map,c=i._containerHeight/2,g=i._containerWidth/2-m/2,v=i.unproject([g,c]),w=i.unproject([g+m,c]),S=v.distanceTo(w);if(this.options.unit==="imperial"){const k=3.2808*S;k>5280?this._setScale(m,k/5280,"mile"):this._setScale(m,k,"foot")}else this.options.unit==="nautical"?this._setScale(m,S/1852,"nautical-mile"):S>=1e3?this._setScale(m,S/1e3,"kilometer"):this._setScale(m,S,"meter")}_setScale(m,i,c){this._map._requestDomTask(()=>{const g=function(w){const S=Math.pow(10,`${Math.floor(w)}`.length-1);let k=w/S;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(k),S*k}(i),v=g/i;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(g):`${g}&nbsp;${ix[c]}`,this._container.style.width=m*v+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),o.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ye("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(m){super(),this.options=o.l(Object.create(ox),m),o.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new o.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new o.x("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=o.bK.convert(m),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const i=document.createDocumentFragment(),c=document.createElement("body");let g;for(c.innerHTML=m;g=c.firstChild,g;)i.appendChild(g);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ye("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(m),this.options.closeButton){const c=this._closeButton=ye("button","mapboxgl-popup-close-button",i);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let i;return this._classList.delete(m)?i=!1:(this._classList.add(m),i=!0),this._updateClassList(),i}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const i=this._map,c=this._container,g=this._pos;if(!i||!c||!g)return"bottom";const v=c.offsetWidth,w=c.offsetHeight,S=g.x<v/2,k=g.x>i.transform.width-v/2;if(g.y+m<w)return S?"top-left":k?"top-right":"top";if(g.y>i.transform.height-w){if(S)return"bottom-left";if(k)return"bottom-right"}return S?"left":k?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),m.className=i.join(" ")}_update(m){const i=this._map,c=this._content;if(!i||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=ye("div","mapboxgl-popup",i.getContainer()),this._tip=ye("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xl(this._lngLat,this._pos,i.transform)),!this._trackPointer||m){const v=this._pos=this._trackPointer&&m instanceof o.P?m:i.project(this._lngLat),w=Jy(this.options.offset),S=this._anchor=this._getAnchor(w.y),k=Jy(this.options.offset,S),L=v.add(k).round();i._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${rl[S]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&i._showingGlobe()){const v=o.dz(i.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(sx);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Yl,Style:ma,LngLat:o.bK,LngLatBounds:o.as,Point:o.P,MercatorCoordinate:o.a5,FreeCameraOptions:Rs,Evented:o.E,config:o.e,prewarm:o.dE,clearPrewarmedResources:o.dF,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(m){o.e.ACCESS_TOKEN=m},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(m){o.e.API_URL=m},get workerCount(){return o.dG.workerCount},set workerCount(m){o.dG.workerCount=m},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){o.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){o.dH(m)},get workerUrl(){return o.dI.workerUrl},set workerUrl(m){o.dI.workerUrl=m},get workerClass(){return o.dI.workerClass},set workerClass(m){o.dI.workerClass=m},get workerParams(){return o.dI.workerParams},set workerParams(m){o.dI.workerParams=m},get dracoUrl(){return o.dJ()},set dracoUrl(m){o.dK(m)},get meshoptUrl(){return o.dL()},set meshoptUrl(m){o.dM(m)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var E=p;return E})})(nD);var Aj=nD.exports;const Yu=ub(Aj);var Ym=Rj,Cj=Object.prototype.hasOwnProperty;function Rj(){for(var t={},e=0;e<arguments.length;e++){var r=arguments[e];for(var s in r)Cj.call(r,s)&&(t[s]=r[s])}return t}var oD={exports:{}};(function(t,e){(function(){var r={};t.exports=r,r.simpleFilter=function(s,h){return h.filter(function(p){return r.test(s,p)})},r.test=function(s,h){return r.match(s,h)!==null},r.match=function(s,h,p){p=p||{};var b=0,E=[],o=h.length,O=0,z=0,U=p.pre||"",H=p.post||"",Y=p.caseSensitive&&h||h.toLowerCase(),Q;s=p.caseSensitive&&s||s.toLowerCase();for(var ge=0;ge<o;ge++)Q=h[ge],Y[ge]===s[b]?(Q=U+Q+H,b+=1,z+=1+z):z=0,O+=z,E[E.length]=Q;return b===s.length?(O=Y===s?1/0:O,{rendered:E.join(""),score:O}):null},r.filter=function(s,h,p){return!h||h.length===0?[]:typeof s!="string"?h:(p=p||{},h.reduce(function(b,E,o,O){var z=E;p.extract&&(z=p.extract(E));var U=r.match(s,z,p);return U!=null&&(b[b.length]={string:U.rendered,score:U.score,index:o,original:E}),b},[]).sort(function(b,E){var o=E.score-b.score;return o||b.index-E.index}))}})()})(oD);var Pj=oD.exports,Al=function(t){return this.component=t,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,t.el.parentNode.insertBefore(this.wrapper,t.el.nextSibling),this};Al.prototype.show=function(){this.element.style.display="block"};Al.prototype.hide=function(){this.element.style.display="none"};Al.prototype.add=function(t){this.items.push(t)};Al.prototype.clear=function(){this.items=[],this.active=0};Al.prototype.isEmpty=function(){return!this.items.length};Al.prototype.isVisible=function(){return this.element.style.display==="block"};Al.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var t=0;t<this.items.length;t++)this.drawItem(this.items[t],this.active===t);this.show()};Al.prototype.drawItem=function(t,e){var r=document.createElement("li"),s=document.createElement("a");e&&(r.className+=" active"),s.innerHTML=t.string,r.appendChild(s),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,t)}).bind(this))};Al.prototype.handleMouseUp=function(t){this.selectingListItem=!1,this.component.value(t.original),this.clear(),this.draw()};Al.prototype.move=function(t){this.active=t,this.draw()};Al.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Al.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Al.prototype.drawError=function(t){var e=document.createElement("li");e.innerHTML=t,this.element.appendChild(e),this.show()};var Mj=Al,kj=Ym,Oj=Pj,Dj=Mj,Za=function(t,e,r){return r=r||{},this.options=kj({minLength:2,limit:5,filter:!0,hideOnBlur:!0},r),this.el=t,this.data=e||[],this.list=new Dj(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(s){this.handleKeyUp(s.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(s){this.handleKeyDown(s)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(s){this.handlePaste(s)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Za.prototype.handleKeyUp=function(t){t===40||t===38||t===27||t===13||t===9||this.handleInputChange(this.el.value)};Za.prototype.handleKeyDown=function(t){switch(t.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&t.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Za.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Za.prototype.handlePaste=function(t){if(t.clipboardData)this.handleInputChange(t.clipboardData.getData("Text"));else{var e=this;setTimeout(function(){e.handleInputChange(t.target.value)},100)}};Za.prototype.handleInputChange=function(t){if(this.query=this.normalize(t),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(e){for(var r=0;r<e.length&&(this.list.add(e[r]),r!==this.options.limit-1);r++);this.list.draw()}).bind(this))};Za.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Za.prototype.update=function(t){this.data=t,this.handleKeyUp()};Za.prototype.clear=function(){this.data=[],this.list.clear()};Za.prototype.normalize=function(t){return t=t.toLowerCase(),t};Za.prototype.match=function(t,e){return t.indexOf(e)>-1};Za.prototype.value=function(t){if(this.selected=t,this.el.value=this.getItemValue(t),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("change",!0,!1),this.el.dispatchEvent(e)}else this.el.fireEvent("onchange")};Za.prototype.getCandidates=function(t){var e={pre:"<strong>",post:"</strong>",extract:(function(s){return this.getItemValue(s)}).bind(this)},r;this.options.filter?(r=Oj.filter(this.query,this.data,e),r=r.map((function(s){return{original:s.original,string:this.render(s.original,s.string)}}).bind(this))):r=this.data.map((function(s){var h=this.render(s);return{original:s,string:h}}).bind(this)),t(r)};Za.prototype.getItemValue=function(t){return t};Za.prototype.render=function(t,e){if(e)return e;for(var r=t.original?this.getItemValue(t.original):this.getItemValue(t),s=this.normalize(r),h=s.lastIndexOf(this.query);h>-1;){var p=h+this.query.length;r=r.slice(0,h)+"<strong>"+r.slice(h,p)+"</strong>"+r.slice(p),h=s.slice(0,h).lastIndexOf(this.query)}return r};Za.prototype.renderError=function(t){this.list.drawError(t)};var Lj=Za,sD=Lj,Bj=sD;typeof window<"u"&&(window.Suggestions=sD);var zj="Expected a function",DR=NaN,Nj="[object Symbol]",Fj=/^\s+|\s+$/g,Vj=/^[-+]0x[0-9a-f]+$/i,Uj=/^0b[01]+$/i,jj=/^0o[0-7]+$/i,$j=parseInt,Gj=typeof Os=="object"&&Os&&Os.Object===Object&&Os,qj=typeof self=="object"&&self&&self.Object===Object&&self,Hj=Gj||qj||Function("return this")(),Wj=Object.prototype,Zj=Wj.toString,Kj=Math.max,Xj=Math.min,V1=function(){return Hj.Date.now()};function Yj(t,e,r){var s,h,p,b,E,o,O=0,z=!1,U=!1,H=!0;if(typeof t!="function")throw new TypeError(zj);e=LR(e)||0,Uw(r)&&(z=!!r.leading,U="maxWait"in r,p=U?Kj(LR(r.maxWait)||0,e):p,H="trailing"in r?!!r.trailing:H);function Y(ze){var Te=s,ie=h;return s=h=void 0,O=ze,b=t.apply(ie,Te),b}function Q(ze){return O=ze,E=setTimeout(ke,e),z?Y(ze):b}function ge(ze){var Te=ze-o,ie=ze-O,ne=e-Te;return U?Xj(ne,p-ie):ne}function ye(ze){var Te=ze-o,ie=ze-O;return o===void 0||Te>=e||Te<0||U&&ie>=p}function ke(){var ze=V1();if(ye(ze))return he(ze);E=setTimeout(ke,ge(ze))}function he(ze){return E=void 0,H&&s?Y(ze):(s=h=void 0,b)}function oe(){E!==void 0&&clearTimeout(E),O=0,s=o=h=E=void 0}function ve(){return E===void 0?b:he(V1())}function be(){var ze=V1(),Te=ye(ze);if(s=arguments,h=this,o=ze,Te){if(E===void 0)return Q(o);if(U)return E=setTimeout(ke,e),Y(o)}return E===void 0&&(E=setTimeout(ke,e)),b}return be.cancel=oe,be.flush=ve,be}function Uw(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function Jj(t){return!!t&&typeof t=="object"}function Qj(t){return typeof t=="symbol"||Jj(t)&&Zj.call(t)==Nj}function LR(t){if(typeof t=="number")return t;if(Qj(t))return DR;if(Uw(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Uw(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(Fj,"");var r=Uj.test(t);return r||jj.test(t)?$j(t.slice(2),r?2:8):Vj.test(t)?DR:+t}var e$=Yj,QT={exports:{}},Sm=typeof Reflect=="object"?Reflect:null,BR=Sm&&typeof Sm.apply=="function"?Sm.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},f0;Sm&&typeof Sm.ownKeys=="function"?f0=Sm.ownKeys:Object.getOwnPropertySymbols?f0=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:f0=function(e){return Object.getOwnPropertyNames(e)};function t$(t){console&&console.warn&&console.warn(t)}var aD=Number.isNaN||function(e){return e!==e};function Io(){Io.init.call(this)}QT.exports=Io;QT.exports.once=o$;Io.EventEmitter=Io;Io.prototype._events=void 0;Io.prototype._eventsCount=0;Io.prototype._maxListeners=void 0;var zR=10;function Ab(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Io,"defaultMaxListeners",{enumerable:!0,get:function(){return zR},set:function(t){if(typeof t!="number"||t<0||aD(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");zR=t}});Io.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Io.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||aD(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function lD(t){return t._maxListeners===void 0?Io.defaultMaxListeners:t._maxListeners}Io.prototype.getMaxListeners=function(){return lD(this)};Io.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var h=e==="error",p=this._events;if(p!==void 0)h=h&&p.error===void 0;else if(!h)return!1;if(h){var b;if(r.length>0&&(b=r[0]),b instanceof Error)throw b;var E=new Error("Unhandled error."+(b?" ("+b.message+")":""));throw E.context=b,E}var o=p[e];if(o===void 0)return!1;if(typeof o=="function")BR(o,this,r);else for(var O=o.length,z=fD(o,O),s=0;s<O;++s)BR(z[s],this,r);return!0};function cD(t,e,r,s){var h,p,b;if(Ab(r),p=t._events,p===void 0?(p=t._events=Object.create(null),t._eventsCount=0):(p.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),p=t._events),b=p[e]),b===void 0)b=p[e]=r,++t._eventsCount;else if(typeof b=="function"?b=p[e]=s?[r,b]:[b,r]:s?b.unshift(r):b.push(r),h=lD(t),h>0&&b.length>h&&!b.warned){b.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+b.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=t,E.type=e,E.count=b.length,t$(E)}return t}Io.prototype.addListener=function(e,r){return cD(this,e,r,!1)};Io.prototype.on=Io.prototype.addListener;Io.prototype.prependListener=function(e,r){return cD(this,e,r,!0)};function r$(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function uD(t,e,r){var s={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},h=r$.bind(s);return h.listener=r,s.wrapFn=h,h}Io.prototype.once=function(e,r){return Ab(r),this.on(e,uD(this,e,r)),this};Io.prototype.prependOnceListener=function(e,r){return Ab(r),this.prependListener(e,uD(this,e,r)),this};Io.prototype.removeListener=function(e,r){var s,h,p,b,E;if(Ab(r),h=this._events,h===void 0)return this;if(s=h[e],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete h[e],h.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){for(p=-1,b=s.length-1;b>=0;b--)if(s[b]===r||s[b].listener===r){E=s[b].listener,p=b;break}if(p<0)return this;p===0?s.shift():n$(s,p),s.length===1&&(h[e]=s[0]),h.removeListener!==void 0&&this.emit("removeListener",e,E||r)}return this};Io.prototype.off=Io.prototype.removeListener;Io.prototype.removeAllListeners=function(e){var r,s,h;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[e]),this;if(arguments.length===0){var p=Object.keys(s),b;for(h=0;h<p.length;++h)b=p[h],b!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(h=r.length-1;h>=0;h--)this.removeListener(e,r[h]);return this};function hD(t,e,r){var s=t._events;if(s===void 0)return[];var h=s[e];return h===void 0?[]:typeof h=="function"?r?[h.listener||h]:[h]:r?i$(h):fD(h,h.length)}Io.prototype.listeners=function(e){return hD(this,e,!0)};Io.prototype.rawListeners=function(e){return hD(this,e,!1)};Io.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):dD.call(t,e)};Io.prototype.listenerCount=dD;function dD(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Io.prototype.eventNames=function(){return this._eventsCount>0?f0(this._events):[]};function fD(t,e){for(var r=new Array(e),s=0;s<e;++s)r[s]=t[s];return r}function n$(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function i$(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function o$(t,e){return new Promise(function(r,s){function h(b){t.removeListener(e,p),s(b)}function p(){typeof t.removeListener=="function"&&t.removeListener("error",h),r([].slice.call(arguments))}pD(t,e,p,{once:!0}),e!=="error"&&s$(t,h,{once:!0})})}function s$(t,e,r){typeof t.on=="function"&&pD(t,"error",e,r)}function pD(t,e,r,s){if(typeof t.on=="function")s.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function h(p){s.once&&t.removeEventListener(e,h),r(p)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var a$=QT.exports,l$={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function c$(t){var e=t.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return e?{key:e[1],value:e[2]}:null}function u$(t){var e=t.match(/<?([^>]*)>(.*)/);if(!e)return null;var r=e[1],s=e[2].split(";"),h=null,p=s.reduce(function(b,E){var o=c$(E);return o?o.key==="rel"?(h||(h=o.value),b):(b[o.key]=o.value,b):b},{});return h?{url:r,rel:h,params:p}:null}function h$(t){return t?t.split(/,\s*</).reduce(function(e,r){var s=u$(r);if(!s)return e;var h=s.rel.split(/\s+/);return h.forEach(function(p){e[p]||(e[p]={url:s.url,params:s.params})}),e},{}):{}}var d$=h$,f$=d$;function eE(t,e){this.request=t,this.headers=e.headers,this.rawBody=e.body,this.statusCode=e.statusCode;try{this.body=JSON.parse(e.body||"{}")}catch{this.body=e.body}this.links=f$(this.headers.link)}eE.prototype.hasNextPage=function(){return!!this.links.next};eE.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var p$=eE,Cb={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},NR=Cb;function m$(t){var e=t.type||NR.ERROR_HTTP,r;if(t.body)try{r=JSON.parse(t.body)}catch{r=t.body}else r=null;var s=t.message||null;s||(typeof r=="string"?s=r:r&&typeof r.message=="string"?s=r.message:e===NR.ERROR_REQUEST_ABORTED&&(s="Request aborted")),this.message=s,this.type=e,this.statusCode=t.statusCode||null,this.request=t.request,this.body=r}var g$=m$;function _$(t){var e=t.indexOf(":"),r=t.substring(0,e).trim().toLowerCase(),s=t.substring(e+1).trim();return{name:r,value:s}}function y$(t){var e={};return t&&t.trim().split(/[\r|\n]+/).forEach(function(r){var s=_$(r);e[s.name]=s.value}),e}var v$=y$,b$=p$,FR=g$,U1=Cb,x$=v$,F0={};function w$(t){var e=F0[t.id];e&&(e.abort(),delete F0[t.id])}function T$(t,e){return new b$(t,{body:e.response,headers:x$(e.getAllResponseHeaders()),statusCode:e.status})}function VR(t){var e=t.total,r=t.loaded,s=100*r/e;return{total:e,transferred:r,percent:s}}function mD(t,e){return new Promise(function(r,s){e.onprogress=function(b){t.emitter.emit(U1.EVENT_PROGRESS_DOWNLOAD,VR(b))};var h=t.file;h&&(e.upload.onprogress=function(b){t.emitter.emit(U1.EVENT_PROGRESS_UPLOAD,VR(b))}),e.onerror=function(b){s(b)},e.onabort=function(){var b=new FR({request:t,type:U1.ERROR_REQUEST_ABORTED});s(b)},e.onload=function(){if(delete F0[t.id],e.status<200||e.status>=400){var b=new FR({request:t,body:e.response,statusCode:e.status});s(b);return}r(e)};var p=t.body;typeof p=="string"?e.send(p):p?e.send(JSON.stringify(p)):h?e.send(h):e.send(),F0[t.id]=e}).then(function(r){return T$(t,r)})}function gD(t,e){var r=t.url(e),s=new window.XMLHttpRequest;return s.open(t.method,r),Object.keys(t.headers).forEach(function(h){s.setRequestHeader(h,t.headers[h])}),s}function E$(t){return Promise.resolve().then(function(){var e=gD(t,t.client.accessToken);return mD(t,e)})}var S$={browserAbort:w$,sendRequestXhr:mD,browserSend:E$,createRequestXhr:gD},V0={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */V0.exports;(function(t,e){(function(r){var s=e,h=t&&t.exports==s&&t,p=typeof Os=="object"&&Os;(p.global===p||p.window===p)&&(r=p);var b=function(Q){this.message=Q};b.prototype=new Error,b.prototype.name="InvalidCharacterError";var E=function(Q){throw new b(Q)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=/[\t\n\f\r ]/g,z=function(Q){Q=String(Q).replace(O,"");var ge=Q.length;ge%4==0&&(Q=Q.replace(/==?$/,""),ge=Q.length),(ge%4==1||/[^+a-zA-Z0-9/]/.test(Q))&&E("Invalid character: the string to be decoded is not correctly encoded.");for(var ye=0,ke,he,oe="",ve=-1;++ve<ge;)he=o.indexOf(Q.charAt(ve)),ke=ye%4?ke*64+he:he,ye++%4&&(oe+=String.fromCharCode(255&ke>>(-2*ye&6)));return oe},U=function(Q){Q=String(Q),/[^\0-\xFF]/.test(Q)&&E("The string to be encoded contains characters outside of the Latin1 range.");for(var ge=Q.length%3,ye="",ke=-1,he,oe,ve,be,ze=Q.length-ge;++ke<ze;)he=Q.charCodeAt(ke)<<16,oe=Q.charCodeAt(++ke)<<8,ve=Q.charCodeAt(++ke),be=he+oe+ve,ye+=o.charAt(be>>18&63)+o.charAt(be>>12&63)+o.charAt(be>>6&63)+o.charAt(be&63);return ge==2?(he=Q.charCodeAt(ke)<<8,oe=Q.charCodeAt(++ke),be=he+oe,ye+=o.charAt(be>>10)+o.charAt(be>>4&63)+o.charAt(be<<2&63)+"="):ge==1&&(be=Q.charCodeAt(ke),ye+=o.charAt(be>>2)+o.charAt(be<<4&63)+"=="),ye},H={encode:U,decode:z,version:"0.1.0"};if(s&&!s.nodeType)if(h)h.exports=H;else for(var Y in H)H.hasOwnProperty(Y)&&(s[Y]=H[Y]);else r.base64=H})(Os)})(V0,V0.exports);var I$=V0.exports,A$=I$,j1={};function C$(t){if(j1[t])return j1[t];var e=t.split("."),r=e[0],s=e[1];if(!s)throw new Error("Invalid token");var h=R$(s),p={usage:r,user:h.u};return Of(h,"a")&&(p.authorization=h.a),Of(h,"exp")&&(p.expires=h.exp*1e3),Of(h,"iat")&&(p.created=h.iat*1e3),Of(h,"scopes")&&(p.scopes=h.scopes),Of(h,"client")&&(p.client=h.client),Of(h,"ll")&&(p.lastLogin=h.ll),Of(h,"iu")&&(p.impersonator=h.iu),j1[t]=p,p}function R$(t){try{return JSON.parse(A$.decode(t))}catch{throw new Error("Invalid token")}}function Of(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var _D=C$,yD={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,r="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function h(o,O,z){this.fn=o,this.context=O,this.once=z||!1}function p(o,O,z,U,H){if(typeof z!="function")throw new TypeError("The listener must be a function");var Y=new h(z,U||o,H),Q=r?r+O:O;return o._events[Q]?o._events[Q].fn?o._events[Q]=[o._events[Q],Y]:o._events[Q].push(Y):(o._events[Q]=Y,o._eventsCount++),o}function b(o,O){--o._eventsCount===0?o._events=new s:delete o._events[O]}function E(){this._events=new s,this._eventsCount=0}E.prototype.eventNames=function(){var O=[],z,U;if(this._eventsCount===0)return O;for(U in z=this._events)e.call(z,U)&&O.push(r?U.slice(1):U);return Object.getOwnPropertySymbols?O.concat(Object.getOwnPropertySymbols(z)):O},E.prototype.listeners=function(O){var z=r?r+O:O,U=this._events[z];if(!U)return[];if(U.fn)return[U.fn];for(var H=0,Y=U.length,Q=new Array(Y);H<Y;H++)Q[H]=U[H].fn;return Q},E.prototype.listenerCount=function(O){var z=r?r+O:O,U=this._events[z];return U?U.fn?1:U.length:0},E.prototype.emit=function(O,z,U,H,Y,Q){var ge=r?r+O:O;if(!this._events[ge])return!1;var ye=this._events[ge],ke=arguments.length,he,oe;if(ye.fn){switch(ye.once&&this.removeListener(O,ye.fn,void 0,!0),ke){case 1:return ye.fn.call(ye.context),!0;case 2:return ye.fn.call(ye.context,z),!0;case 3:return ye.fn.call(ye.context,z,U),!0;case 4:return ye.fn.call(ye.context,z,U,H),!0;case 5:return ye.fn.call(ye.context,z,U,H,Y),!0;case 6:return ye.fn.call(ye.context,z,U,H,Y,Q),!0}for(oe=1,he=new Array(ke-1);oe<ke;oe++)he[oe-1]=arguments[oe];ye.fn.apply(ye.context,he)}else{var ve=ye.length,be;for(oe=0;oe<ve;oe++)switch(ye[oe].once&&this.removeListener(O,ye[oe].fn,void 0,!0),ke){case 1:ye[oe].fn.call(ye[oe].context);break;case 2:ye[oe].fn.call(ye[oe].context,z);break;case 3:ye[oe].fn.call(ye[oe].context,z,U);break;case 4:ye[oe].fn.call(ye[oe].context,z,U,H);break;default:if(!he)for(be=1,he=new Array(ke-1);be<ke;be++)he[be-1]=arguments[be];ye[oe].fn.apply(ye[oe].context,he)}}return!0},E.prototype.on=function(O,z,U){return p(this,O,z,U,!1)},E.prototype.once=function(O,z,U){return p(this,O,z,U,!0)},E.prototype.removeListener=function(O,z,U,H){var Y=r?r+O:O;if(!this._events[Y])return this;if(!z)return b(this,Y),this;var Q=this._events[Y];if(Q.fn)Q.fn===z&&(!H||Q.once)&&(!U||Q.context===U)&&b(this,Y);else{for(var ge=0,ye=[],ke=Q.length;ge<ke;ge++)(Q[ge].fn!==z||H&&!Q[ge].once||U&&Q[ge].context!==U)&&ye.push(Q[ge]);ye.length?this._events[Y]=ye.length===1?ye[0]:ye:b(this,Y)}return this},E.prototype.removeAllListeners=function(O){var z;return O?(z=r?r+O:O,this._events[z]&&b(this,z)):(this._events=new s,this._eventsCount=0),this},E.prototype.off=E.prototype.removeListener,E.prototype.addListener=E.prototype.on,E.prefixed=r,E.EventEmitter=E,t.exports=E})(yD);var P$=yD.exports;function M$(t){return t.map(encodeURIComponent).join(",")}function vD(t){return Array.isArray(t)?M$(t):encodeURIComponent(String(t))}function bD(t,e,r){if(r===!1||r===null)return t;var s=/\?/.test(t)?"&":"?",h=encodeURIComponent(e);return r!==void 0&&r!==""&&r!==!0&&(h+="="+vD(r)),""+t+s+h}function k$(t,e){if(!e)return t;var r=t;return Object.keys(e).forEach(function(s){var h=e[s];h!==void 0&&(Array.isArray(h)&&(h=h.filter(function(p){return p!=null}).join(",")),r=bD(r,s,h))}),r}function O$(t,e){if(!e||t.slice(0,4)==="http")return t;var r=t[0]==="/"?"":"/";return""+e.replace(/\/$/,"")+r+t}function D$(t,e){return e?t.replace(/\/:([a-zA-Z0-9]+)/g,function(r,s){var h=e[s];if(h===void 0)throw new Error("Unspecified route parameter "+s);var p=vD(h);return"/"+p}):t}var L$={appendQueryObject:k$,appendQueryParam:bD,prependOrigin:O$,interpolateRouteParams:D$},B$=_D,tE=Ym,z$=P$,t0=L$,UR=Cb,N$=1;function Fd(t,e){if(!t)throw new Error("MapiRequest requires a client");if(!e||!e.path||!e.method)throw new Error("MapiRequest requires an options object with path and method properties");var r={};e.body&&(r["content-type"]="application/json");var s=tE(r,e.headers),h=Object.keys(s).reduce(function(p,b){return p[b.toLowerCase()]=s[b],p},{});this.id=N$++,this._options=e,this.emitter=new z$,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=e.path,this.method=e.method,this.origin=e.origin||t.origin,this.query=e.query||{},this.params=e.params||{},this.body=e.body||null,this.file=e.file||null,this.encoding=e.encoding||"utf8",this.sendFileAs=e.sendFileAs||null,this.headers=h}Fd.prototype.url=function(e){var r=t0.prependOrigin(this.path,this.origin);r=t0.appendQueryObject(r,this.query);var s=this.params,h=e??this.client.accessToken;if(h){r=t0.appendQueryParam(r,"access_token",h);var p=B$(h).user;s=tE({ownerId:p},s)}return r=t0.interpolateRouteParams(r,s),r};Fd.prototype.send=function(){var e=this;if(e.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return e.sent=!0,e.client.sendRequest(e).then(function(r){return e.response=r,e.emitter.emit(UR.EVENT_RESPONSE,r),r},function(r){throw e.error=r,e.emitter.emit(UR.EVENT_ERROR,r),r})};Fd.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Fd.prototype.eachPage=function(e){var r=this;function s(b){function E(){delete r._nextPageRequest;var o=b.nextPage();o&&(r._nextPageRequest=o,p(o))}e(null,b,E)}function h(b){e(b,null,function(){})}function p(b){b.send().then(s,h)}p(this)};Fd.prototype.clone=function(){return this._extend()};Fd.prototype._extend=function(e){var r=tE(this._options,e);return new Fd(this.client,r)};var F$=Fd,V$=_D,U$=F$,j$=Cb;function xD(t){if(!t||!t.accessToken)throw new Error("Cannot create a client without an access token");V$(t.accessToken),this.accessToken=t.accessToken,this.origin=t.origin||j$.API_ORIGIN}xD.prototype.createRequest=function(e){return new U$(this,e)};var wD=xD,TD=S$,ED=wD;function zm(t){ED.call(this,t)}zm.prototype=Object.create(ED.prototype);zm.prototype.constructor=zm;zm.prototype.sendRequest=TD.browserSend;zm.prototype.abortRequest=TD.browserAbort;function $$(t){return new zm(t)}var SD=$$,G$=SD,q$=G$,H$=Object.prototype.toString,W$=function(t){var e;return H$.call(t)==="[object Object]"&&(e=Object.getPrototypeOf(t),e===null||e===Object.getPrototypeOf({}))},Z$=W$,K$=Ym,ID="value",$1=`
  `,Uo={};Uo.assert=function(t,e){return e=e||{},function(r){var s=Vd(t,r);if(s){var h=rE(s,e);throw e.apiName&&(h=e.apiName+": "+h),new Error(h)}}};Uo.shape=function(e){var r=Q$(e);return function(h){var p=Vd(Uo.plainObject,h);if(p)return p;for(var b,E,o=[],O=0;O<r.length;O++)b=r[O].key,E=r[O].value,p=Vd(E,h[b]),p&&o.push([b].concat(p));return o.length<2?o[0]:function(z){o=o.map(function(Y){var Q=Y[0],ge=rE(Y,z).split(`
`).join($1);return"- "+Q+": "+ge});var U=z.path.join("."),H=U===ID?"":" of "+U;return"The following properties"+H+" have invalid values:"+$1+o.join($1)}}};Uo.strictShape=function(e){var r=Uo.shape(e);return function(h){var p=r(h);if(p)return p;var b=Object.keys(h).reduce(function(E,o){return e[o]===void 0&&E.push(o),E},[]);if(b.length!==0)return function(){return"The following keys are invalid: "+b.join(", ")}}};Uo.arrayOf=function(e){return AD(e)};Uo.tuple=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return AD(e)};function AD(t){var e=Array.isArray(t),r=function(s){return e?t[s]:t};return function(h){var p=Vd(Uo.plainArray,h);if(p)return p;if(e&&h.length!==t.length)return"an array with "+t.length+" items";for(var b=0;b<h.length;b++)if(p=Vd(r(b),h[b]),p)return[b].concat(p)}}Uo.required=function(e){function r(s){return s==null?function(h){return CD(h,RD(h.path)?"cannot be undefined/null.":"is required.")}:e.apply(this,arguments)}return r.__required=!0,r};Uo.oneOfType=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(s){var h=e.map(function(p){return Vd(p,s)}).filter(Boolean);if(h.length===e.length)return h.every(function(p){return p.length===1&&typeof p[0]=="string"})?X$(h.map(function(p){return p[0]})):h.reduce(function(p,b){return b.length>p.length?b:p})}};Uo.equal=function(e){return function(s){if(s!==e)return JSON.stringify(e)}};Uo.oneOf=function(){var e=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),r=e.map(function(s){return Uo.equal(s)});return Uo.oneOfType.apply(this,r)};Uo.range=function(e){var r=e[0],s=e[1];return function(p){var b=Vd(Uo.number,p);if(b||p<r||p>s)return"number between "+r+" & "+s+" (inclusive)"}};Uo.any=function(){};Uo.boolean=function(e){if(typeof e!="boolean")return"boolean"};Uo.number=function(e){if(typeof e!="number")return"number"};Uo.plainArray=function(e){if(!Array.isArray(e))return"array"};Uo.plainObject=function(e){if(!Z$(e))return"object"};Uo.string=function(e){if(typeof e!="string")return"string"};Uo.func=function(e){if(typeof e!="function")return"function"};function Vd(t,e){if(!(e==null&&!t.hasOwnProperty("__required"))){var r=t(e);if(r)return Array.isArray(r)?r:[r]}}function rE(t,e){var r=t.length,s=t[r-1],h=t.slice(0,r-1);return h.length===0&&(h=[ID]),e=K$(e,{path:h}),typeof s=="function"?s(e):CD(e,Y$(s))}function X$(t){return t.length<2?t[0]:t.length===2?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t.slice(-1)}function Y$(t){return"must be "+J$(t)+"."}function J$(t){return/^an? /.test(t)?t:/^[aeiou]/i.test(t)?"an "+t:/^[a-z]/i.test(t)?"a "+t:t}function CD(t,e){var r=RD(t.path),s=t.path.join(".")+" "+e,h=r?"Item at position ":"";return h+s}function RD(t){return typeof t[t.length-1]=="number"||typeof t[0]=="number"}function Q$(t){return Object.keys(t||{}).map(function(e){return{key:e,value:t[e]}})}Uo.validate=Vd;Uo.processMessage=rE;var e3=Uo,t3=Ym,Im=e3;function r3(t){if(typeof window<"u")return t instanceof Os.Blob||t instanceof Os.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof t=="string"||t.pipe!==void 0))return"Filename or Readable stream"}function n3(t,e){return Im.assert(Im.strictShape(t),e)}function i3(t){var e="date";if(typeof t=="boolean")return e;try{var r=new Date(t);if(r.getTime&&isNaN(r.getTime()))return e}catch{return e}}function o3(t){return Im.tuple(Im.number,Im.number)(t)}var s3=t3(Im,{file:r3,date:i3,coordinates:o3,assertShape:n3});function a3(t,e){var r=function(s,h){return e.indexOf(s)!==-1&&h!==void 0};return typeof e=="function"&&(r=e),Object.keys(t).filter(function(s){return r(s,t[s])}).reduce(function(s,h){return s[h]=t[h],s},{})}var l3=a3;function c3(t,e){return Object.keys(t).reduce(function(r,s){return r[s]=e(s,t[s]),r},{})}var u3=c3,h3=u3;function d3(t){return h3(t,function(e,r){return typeof r=="boolean"?JSON.stringify(r):r})}var f3=d3,p3=wD,m3=SD;function g3(t){return function(e){var r;p3.prototype.isPrototypeOf(e)?r=e:r=m3(e);var s=Object.create(t);return s.client=r,s}}var _3=g3,PD=Ym,Si=s3,U0=l3,MD=f3,y3=_3,nE={},kD=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];nE.forwardGeocode=function(t){Si.assertShape({query:Si.required(Si.string),mode:Si.oneOf("mapbox.places","mapbox.places-permanent"),countries:Si.arrayOf(Si.string),proximity:Si.oneOf(Si.coordinates,"ip"),types:Si.arrayOf(Si.oneOf(kD)),autocomplete:Si.boolean,bbox:Si.arrayOf(Si.number),limit:Si.number,language:Si.arrayOf(Si.string),routing:Si.boolean,fuzzyMatch:Si.boolean,worldview:Si.string,session_token:Si.string})(t),t.mode=t.mode||"mapbox.places";var e=MD(PD({country:t.countries},U0(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:U0(t,["mode","query"]),query:e})};nE.reverseGeocode=function(t){Si.assertShape({query:Si.required(Si.coordinates),mode:Si.oneOf("mapbox.places","mapbox.places-permanent"),countries:Si.arrayOf(Si.string),types:Si.arrayOf(Si.oneOf(kD)),bbox:Si.arrayOf(Si.number),limit:Si.number,language:Si.arrayOf(Si.string),reverseMode:Si.oneOf("distance","score"),routing:Si.boolean,worldview:Si.string,session_token:Si.string})(t),t.mode=t.mode||"mapbox.places";var e=MD(PD({country:t.countries},U0(t,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:U0(t,["mode","query"]),query:e})};var v3=y3(nE);let b3="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",OD=t=>crypto.getRandomValues(new Uint8Array(t)),DD=(t,e,r)=>{let s=(2<<Math.log(t.length-1)/Math.LN2)-1,h=-~(1.6*s*e/t.length);return(p=e)=>{let b="";for(;;){let E=r(h),o=h;for(;o--;)if(b+=t[E[o]&s]||"",b.length===p)return b}}},x3=(t,e=21)=>DD(t,e,OD),w3=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,r)=>(r&=63,r<36?e+=r.toString(36):r<62?e+=(r-26).toString(36).toUpperCase():r>62?e+="-":e+="_",e),"");const T3=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:x3,customRandom:DD,nanoid:w3,random:OD,urlAlphabet:b3},Symbol.toStringTag,{value:"Module"})),E3=DM(T3);var S3=E3.nanoid;function LD(t){this.origin=t.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=t.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=t,this.send=this.send.bind(this),this.countries=t.countries?t.countries.split(","):null,this.types=t.types?t.types.split(","):null,this.bbox=t.bbox?t.bbox:null,this.language=t.language?t.language.split(","):null,this.limit=t.limit?+t.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(t),this.eventQueue=new Array,this.flushInterval=t.flushInterval||1e3,this.maxQueueSize=t.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}LD.prototype={select:function(t,e){var r=this.getEventPayload("search.select",e,{selectedFeature:t});if(r&&!(r.resultIndex===this.lastSentIndex&&r.queryString===this.lastSentInput||r.resultIndex==-1))return this.lastSentIndex=r.resultIndex,this.lastSentInput=r.queryString,this.push(r)},start:function(t){var e=this.getEventPayload("search.start",t);if(e)return this.push(e)},keyevent:function(t,e){if(t.key&&!(t.metaKey||[9,27,37,39,13,38,40].indexOf(t.keyCode)!==-1)){var r=this.getEventPayload("search.keystroke",e,{key:t.key});if(r)return this.push(r)}},send:function(t,e){if(!this.enableEventLogging)return e?e():void 0;var r=this.getRequestOptions(t);this.request(r,(function(s){if(s)return this.handleError(s,e);if(e)return e()}).bind(this))},getRequestOptions:function(t){Array.isArray(t)||(t=[t]);var e={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)};return e},getEventPayload:function(t,e,r={}){if(t==="search.select"&&!r.selectedFeature||t==="search.keystroke"&&!r.key)return null;var s;if(!e.options.proximity)s=null;else if(typeof e.options.proximity=="object")s=[e.options.proximity.longitude,e.options.proximity.latitude];else if(e.options.proximity==="ip"){var h=e._headers?e._headers["ip-proximity"]:null;h&&typeof h=="string"?s=h.split(",").map(parseFloat):s=[999,999]}else s=e.options.proximity;var p=e._map?e._map.getZoom():void 0,b={event:t,version:this.getEventSchemaVersion(t),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:e.options.autocomplete,fuzzyMatch:e.options.fuzzyMatch,proximity:s,limit:e.options.limit,routing:e.options.routing,worldview:e.options.worldview,mapZoom:p,keyboardLocale:this.locale};if(t==="search.select"?b.queryString=e.inputString:t!="search.select"&&e._inputEl?b.queryString=e._inputEl.value:b.queryString=e.inputString,["search.keystroke","search.select"].includes(t)&&(b.path="geocoding/v5/mapbox.places"),t==="search.keystroke"&&r.key)b.lastAction=r.key;else if(t==="search.select"&&r.selectedFeature){var E=r.selectedFeature,o=this.getSelectedIndex(E,e);if(b.resultIndex=o,b.resultPlaceName=E.place_name,b.resultId=E.id,E.properties&&(b.resultMapboxId=E.properties.mapbox_id),e._typeahead){var O=e._typeahead.data;O&&O.length>0&&(b.suggestionIds=this.getSuggestionIds(O),b.suggestionNames=this.getSuggestionNames(O),b.suggestionTypes=this.getSuggestionTypes(O),b.suggestionSources=this.getSuggestionSources(O))}}return this.validatePayload(b)?b:null},request:function(t,e){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(this.readyState==4)return this.status==204?e(null):e(this.statusText)},r.open(t.method,t.host+"/"+t.path,!0);for(var s in t.headers){var h=t.headers[s];r.setRequestHeader(s,h)}r.send(t.body)},handleError:function(t,e){if(e)return e(t)},generateSessionID:function(){return S3()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(t,e){if(e._typeahead){var r=e._typeahead.data,s=t.id,h=r.map(function(b){return b.id}),p=h.indexOf(s);return p}},getSuggestionIds:function(t){return t.map(function(e){return e.properties?e.properties.mapbox_id||"":e.id||""})},getSuggestionNames:function(t){return t.map(function(e){return e.place_name||""})},getSuggestionTypes:function(t){return t.map(function(e){return e.place_type&&Array.isArray(e.place_type)&&e.place_type[0]||""})},getSuggestionSources:function(t){return t.map(function(e){return e._source||""})},getEventSchemaVersion:function(t){return["search.keystroke","search.select"].includes(t)?"2.2":"2.0"},validatePayload:function(t){if(!t||!t.event)return!1;var e=["event","created","sessionIdentifier","queryString"],r=["event","created","sessionIdentifier","queryString","lastAction"],s=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],h=t.event;return h==="search.start"?this.objectHasRequiredProps(t,e):h==="search.keystroke"?this.objectHasRequiredProps(t,r):h==="search.select"?this.objectHasRequiredProps(t,s):!0},objectHasRequiredProps:function(t,e){return e.every(function(r){return r==="queryString"?typeof t[r]=="string"&&t[r].length>0:t[r]!==void 0})},shouldEnableLogging:function(t){return!(t.enableEventLogging===!1||t.origin&&t.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(t,e){this.eventQueue.push(t),(this.eventQueue.length>=this.maxQueueSize||e)&&this.flush()},remove:function(){this.flush()}};var I3=LD,A3={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},C3={placeholder:A3},BD={exports:{}};(function(t){(function(e,r,s){t.exports?t.exports=s():e[r]=s()})(Os,"subtag",function(){var e="",r=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function s(o){return o.match(r)||[]}function h(o){return s(o).filter(function(O,z){return O&&z})}function p(o){return o=s(o),{language:o[1]||e,extlang:o[2]||e,script:o[3]||e,region:o[4]||e}}function b(o,O,z){Object.defineProperty(o,O,{value:z,enumerable:!0})}function E(o,O,z){function U(H){return s(H)[o]||e}b(U,"pattern",O),b(p,z,U)}return E(1,/^[a-zA-Z]{2,3}$/,"language"),E(2,/^[a-zA-Z]{3}$/,"extlang"),E(3,/^[a-zA-Z]{4}$/,"script"),E(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),b(p,"split",h),p})})(BD);var R3=BD.exports;function zD(){}zD.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const t={enableHighAccuracy:!0};return new Promise(function(e,r){window.navigator.geolocation.getCurrentPosition(e,r,t)})}};var P3=zD;function M3(t,e){const r=ND(t),s=["address","street","place","country"];var h;if(typeof e=="function")return e(r);const p=s.indexOf(e);return p===-1?h=s:h=s.slice(p),h.reduce(function(b,E){return r[E]?(b!==""&&(b=b+", "),b+r[E]):b},"")}function ND(t){const e=t.address||"",r=t.text||"",s=t.place_name||"",p={address:s.split(",")[0],houseNumber:e,street:r,placeName:s};return t.context.forEach(function(b){const E=b.id.split(".")[0];p[E]=b.text}),p}const k3=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var O3={transformFeatureToGeolocationText:M3,getAddressInfo:ND,REVERSE_GEOCODE_COORD_RGX:k3},D3=Bj,L3=e$,Df=Ym,B3=a$.EventEmitter,jR=l$,G1=q$,q1=v3,z3=I3,N3=C3,F3=R3,V3=P3,$R=O3;const hd={FORWARD:0,LOCAL:1,REVERSE:2};function U3(){var t=document.createElement("div");return t.className="mapboxgl-ctrl-geocoder--powered-by",t.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',t}function FD(t){this._eventEmitter=new B3,this.options=Df({},this.options,t),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new V3}FD.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(t){return t.place_name},render:function(t){var e=t.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+e[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+e.splice(1,e.length).join(",")+"</div></div>"}},_headers:{},addTo:function(t){function e(r,s){if(!document.body.contains(s))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const h=r.onAdd();s.appendChild(h)}if(t._controlContainer)t.addControl(this);else if(t instanceof HTMLElement)e(this,t);else if(typeof t=="string"){const r=document.querySelectorAll(t);if(r.length===0)throw new Error("Element ",t,"not found.");if(r.length>1)throw new Error("Geocoder can only be added to a single html element");e(this,r[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(t){if(t&&typeof t!="string"&&(this._map=t),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=q1(G1({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new z3(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var e=this.container=document.createElement("div");e.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var r=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",L3(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(O){this.eventManager.keyevent(O,this)}).bind(this));var s=document.createElement("div");s.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var h=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(h),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),s.appendChild(this._clearEl),s.appendChild(this._loadingEl),e.appendChild(r),e.appendChild(this._inputEl),e.appendChild(s),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var p=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(p),s.appendChild(this._geolocateEl),this._showGeolocateButton()}var b=this._typeahead=new D3(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),b.getItemValue=this.options.getItemValue;var E=b.list.draw,o=this._footerNode=U3();return b.list.draw=function(){E.call(this),o.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),o.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(o)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),e},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(t){this._hideLoadingIcon();const e={geometry:{type:"Point",coordinates:[t.coords.longitude,t.coords.latitude]}};this._handleMarker(e),this._fly(e),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(e),this._showClearButton(),this.fresh=!1;const r={limit:1,language:[this.options.language],query:e.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const s=e.geometry.coordinates[0]+","+e.geometry.coordinates[1];this._setInputValue(s),this._eventEmitter.emit("result",{result:e})}else this.geocoderService.reverseGeocode(r).send().then((function(s){const h=s.body.features[0];if(h){const p=$R.transformFeatureToGeolocationText(h,this.options.addressAccuracy);this._setInputValue(p),h.user_coordinates=e.geometry.coordinates,this._eventEmitter.emit("result",{result:h})}else this._eventEmitter.emit("result",{result:{user_coordinates:e.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(t){t.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg","svg");return r.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+t),r.setAttribute("viewBox","0 0 18 18"),r.setAttribute("xml:space","preserve"),r.setAttribute("width",18),r.setAttribute("height",18),r.innerHTML=e,r},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(t){this._inputEl.value=t,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(t){var e=(t.clipboardData||window.clipboardData).getData("text");e.length>=this.options.minLength&&this._geocode(e)},_onKeyDown:function(t){var e=27,r=9;if(t.keyCode===e&&this.options.clearAndBlurOnEsc)return this._clear(t),this._inputEl.blur();var s=t.target&&t.target.shadowRoot?t.target.shadowRoot.activeElement:t.target,h=s?s.value:"";if(!h)return this.fresh=!0,t.keyCode!==r&&this.clear(t),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(t.metaKey||[r,e,37,39,13,38,40].indexOf(t.keyCode)!==-1)&&s.value.length>=this.options.minLength&&this._geocode(s.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(t){this.options.clearOnBlur&&this._clearOnBlur(t),this.options.collapsed&&this._collapse()},_onChange:function(){var t=this._typeahead.selected;t&&JSON.stringify(t)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(t),this.options.marker&&this._mapboxgl&&this._handleMarker(t),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(t),this._eventEmitter.emit("result",{result:t}),this.eventManager.select(t,this))},_fly:function(t){var e;if(t.properties&&jR[t.properties.short_code])e=Df({},this.options.flyTo),this._map&&this._map.fitBounds(jR[t.properties.short_code].bbox,e);else if(t.bbox){var r=t.bbox;e=Df({},this.options.flyTo),this._map&&this._map.fitBounds([[r[0],r[1]],[r[2],r[3]]],e)}else{var s={zoom:this.options.zoom};e=Df({},s,this.options.flyTo),t.center?e.center=t.center:t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&(e.center=t.geometry.coordinates),this._map&&this._map.flyTo(e)}},_requestType:function(t,e){var r;return t.localGeocoderOnly?r=hd.LOCAL:t.reverseGeocode&&$R.REVERSE_GEOCODE_COORD_RGX.test(e)?r=hd.REVERSE:r=hd.FORWARD,r},_setupConfig:function(t,e){const r=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],s=/[\s,]+/;var h=this,p=r.reduce(function(E,o){if(h.options[o]===void 0||h.options[o]===null)return E;["countries","types","language"].indexOf(o)>-1?E[o]=h.options[o].split(s):E[o]=h.options[o];const O=typeof h.options[o].longitude=="number"&&typeof h.options[o].latitude=="number";if(o==="proximity"&&O){const z=h.options[o].longitude,U=h.options[o].latitude;E[o]=[z,U]}return E},{});switch(t){case hd.REVERSE:{var b=e.split(s).map(function(E){return parseFloat(E,10)});h.options.flipCoordinates||b.reverse(),p.types&&p.types[0],p=Df(p,{query:b,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(E){E in p&&delete p[E]})}break;case hd.FORWARD:{const E=e.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(E)&&(e=e.replace(/,/g," ")),p=Df(p,{query:e})}break}return p.session_token=this.eventManager.getSessionId(),p},_geocode:function(t){this.inputString=t,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:t});const e=this._requestType(this.options,t),r=this._setupConfig(e,t);var s;switch(e){case hd.LOCAL:s=Promise.resolve();break;case hd.FORWARD:s=this.geocoderService.forwardGeocode(r).send();break;case hd.REVERSE:s=this.geocoderService.reverseGeocode(r).send();break}var h=this.options.localGeocoder?this.options.localGeocoder(t)||[]:[],p=[],b=null;return s.catch((function(E){b=E}).bind(this)).then((function(E){this._hideLoadingIcon();var o={};return E?E.statusCode=="200"&&(o=E.body,o.request=E.request,o.headers=E.headers,this._headers=E.headers):o={type:"FeatureCollection",features:[]},o.config=r,this.fresh&&(this.eventManager.start(this),this.fresh=!1),o.features&&o.features.length&&o.features.map(function(O){O._source="mapbox"}),o.features=o.features?h.concat(o.features):h,this.options.externalGeocoder?(p=this.options.externalGeocoder(t,o.features)||Promise.resolve([]),p.then(function(O){return o.features=o.features?O.concat(o.features):O,o},function(){return o})):o}).bind(this)).then((function(E){if(b)throw b;this.options.filter&&E.features.length&&(E.features=E.features.filter(this.options.filter)),E.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",E),this._typeahead.update(E.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",E))}).bind(this)).catch((function(E){this._hideLoadingIcon(),this._hideAttribution(),h.length&&this.options.localGeocoder||p.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(h)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:h}),this._eventEmitter.emit("error",{error:E})}).bind(this)),s},_clear:function(t){t&&t.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(t){this._clear(t),this._inputEl.focus()},_clearOnBlur:function(t){var e=this;t.relatedTarget&&e._clear(t)},_onQueryResult:function(t){var e=t.body;if(e.features.length){var r=e.features[0];this._typeahead.selected=r,this._inputEl.value=r.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var t=this._map.getCenter().wrap();this.setProximity({longitude:t.lng,latitude:t.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(t){return this._geocode(t).then(this._onQueryResult),this},_renderError:function(){var t="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(t)},_renderLocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(t)},_renderNoResults:function(){var t="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(t)},_renderUserDeniedGeolocationError:function(){var t="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(t)},_renderMessage:function(t){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(t)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var t=this.options.language.split(",")[0],e=F3.language(t),r=N3.placeholder[e];if(r)return r}return"Search"},setInput:function(t,e){return e===void 0&&(e=!1),this._inputEl.value=t,this._typeahead.selected=null,this._typeahead.clear(),t.length>=this.options.minLength&&(e?this._geocode(t):this._onChange()),this},setProximity:function(t,e=!0){return this.options.proximity=t,e&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(t){return t&&typeof t=="function"&&(this._typeahead.render=t),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(t){var e=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=t||this.options.language||e,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(t){return this.options.zoom=t,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(t){return this.options.flyTo=t,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(t){return this.options.placeholder=t||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(t){return this.options.bbox=t,this},getCountries:function(){return this.options.countries},setCountries:function(t){return this.options.countries=t,this},getTypes:function(){return this.options.types},setTypes:function(t){return this.options.types=t,this},getMinLength:function(){return this.options.minLength},setMinLength:function(t){return this.options.minLength=t,this._typeahead&&(this._typeahead.options.minLength=t),this},getLimit:function(){return this.options.limit},setLimit:function(t){return this.options.limit=t,this._typeahead&&(this._typeahead.options.limit=t),this},getFilter:function(){return this.options.filter},setFilter:function(t){return this.options.filter=t,this},setOrigin:function(t){return this.options.origin=t,this.geocoderService=q1(G1({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(t){return this.options.accessToken=t,this.geocoderService=q1(G1({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(t){return this.options.autocomplete=t,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(t){return this.options.fuzzyMatch=t,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(t){return this.options.routing=t,this},getRouting:function(){return this.options.routing},setWorldview:function(t){return this.options.worldview=t,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(t){if(this._map){this._removeMarker();var e={color:"#4668F2"},r=Df({},e,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(r),t.center?this.mapMarker.setLngLat(t.center).addTo(this._map):t.geometry&&t.geometry.type&&t.geometry.type==="Point"&&t.geometry.coordinates&&this.mapMarker.setLngLat(t.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(t,e){return this._eventEmitter.on(t,e),this},off:function(t,e){return this._eventEmitter.removeListener(t,e),this.eventManager.remove(),this}};var j3=FD;const $3=ub(j3);function r0(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var VD={exports:{}};(function(t,e){(function(r){t.exports=r()})(function(){return function(){function r(s,h,p){function b(O,z){if(!h[O]){if(!s[O]){var U=typeof r0=="function"&&r0;if(!z&&U)return U(O,!0);if(E)return E(O,!0);var H=new Error("Cannot find module '"+O+"'");throw H.code="MODULE_NOT_FOUND",H}var Y=h[O]={exports:{}};s[O][0].call(Y.exports,function(Q){var ge=s[O][1][Q];return b(ge||Q)},Y,Y.exports,r,s,h,p)}return h[O].exports}for(var E=typeof r0=="function"&&r0,o=0;o<p.length;o++)b(p[o]);return b}return r}()({1:[function(r,s,h){var p=r("./toPropertyKey.js");function b(E,o,O){return o=p(o),o in E?Object.defineProperty(E,o,{value:O,enumerable:!0,configurable:!0,writable:!0}):E[o]=O,E}s.exports=b,s.exports.__esModule=!0,s.exports.default=s.exports},{"./toPropertyKey.js":4}],2:[function(r,s,h){var p=r("./defineProperty.js");function b(o,O){var z=Object.keys(o);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(o);O&&(U=U.filter(function(H){return Object.getOwnPropertyDescriptor(o,H).enumerable})),z.push.apply(z,U)}return z}function E(o){for(var O=1;O<arguments.length;O++){var z=arguments[O]!=null?arguments[O]:{};O%2?b(Object(z),!0).forEach(function(U){p(o,U,z[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(z)):b(Object(z)).forEach(function(U){Object.defineProperty(o,U,Object.getOwnPropertyDescriptor(z,U))})}return o}s.exports=E,s.exports.__esModule=!0,s.exports.default=s.exports},{"./defineProperty.js":1}],3:[function(r,s,h){var p=r("./typeof.js").default;function b(E,o){if(p(E)!=="object"||E===null)return E;var O=E[Symbol.toPrimitive];if(O!==void 0){var z=O.call(E,o||"default");if(p(z)!=="object")return z;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(E)}s.exports=b,s.exports.__esModule=!0,s.exports.default=s.exports},{"./typeof.js":5}],4:[function(r,s,h){var p=r("./typeof.js").default,b=r("./toPrimitive.js");function E(o){var O=b(o,"string");return p(O)==="symbol"?O:String(O)}s.exports=E,s.exports.__esModule=!0,s.exports.default=s.exports},{"./toPrimitive.js":3,"./typeof.js":5}],5:[function(r,s,h){function p(b){"@babel/helpers - typeof";return s.exports=p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},s.exports.__esModule=!0,s.exports.default=s.exports,p(b)}s.exports=p,s.exports.__esModule=!0,s.exports.default=s.exports},{}],6:[function(r,s,h){var p={};function b(O){return Math.floor(Math.abs(O)+.5)*(O>=0?1:-1)}function E(O,z,U){O=b(O*U),z=b(z*U);var H=O-z;H<<=1,O-z<0&&(H=~H);for(var Y="";H>=32;)Y+=String.fromCharCode((32|H&31)+63),H>>=5;return Y+=String.fromCharCode(H+63),Y}p.decode=function(O,z){for(var U=0,H=0,Y=0,Q=[],ge=0,ye=0,ke=null,he,oe,ve=Math.pow(10,Number.isInteger(z)?z:5);U<O.length;){ke=null,ge=0,ye=0;do ke=O.charCodeAt(U++)-63,ye|=(ke&31)<<ge,ge+=5;while(ke>=32);he=ye&1?~(ye>>1):ye>>1,ge=ye=0;do ke=O.charCodeAt(U++)-63,ye|=(ke&31)<<ge,ge+=5;while(ke>=32);oe=ye&1?~(ye>>1):ye>>1,H+=he,Y+=oe,Q.push([H/ve,Y/ve])}return Q},p.encode=function(O,z){if(!O.length)return"";for(var U=Math.pow(10,Number.isInteger(z)?z:5),H=E(O[0][0],0,U)+E(O[0][1],0,U),Y=1;Y<O.length;Y++){var Q=O[Y],ge=O[Y-1];H+=E(Q[0],ge[0],U),H+=E(Q[1],ge[1],U)}return H};function o(O){for(var z=[],U=0;U<O.length;U++){var H=O[U].slice();z.push([H[1],H[0]])}return z}p.fromGeoJSON=function(O,z){if(O&&O.type==="Feature"&&(O=O.geometry),!O||O.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return p.encode(o(O.coordinates),z)},p.toGeoJSON=function(O,z){var U=p.decode(O,z);return{type:"LineString",coordinates:o(U)}},typeof s=="object"&&s.exports&&(s.exports=p)},{}],7:[function(r,s,h){var p=typeof Reflect=="object"?Reflect:null,b=p&&typeof p.apply=="function"?p.apply:function(te,re,me){return Function.prototype.apply.call(te,re,me)},E;p&&typeof p.ownKeys=="function"?E=p.ownKeys:Object.getOwnPropertySymbols?E=function(te){return Object.getOwnPropertyNames(te).concat(Object.getOwnPropertySymbols(te))}:E=function(te){return Object.getOwnPropertyNames(te)};function o(ne){console&&console.warn&&console.warn(ne)}var O=Number.isNaN||function(te){return te!==te};function z(){z.init.call(this)}s.exports=z,s.exports.once=ze,z.EventEmitter=z,z.prototype._events=void 0,z.prototype._eventsCount=0,z.prototype._maxListeners=void 0;var U=10;function H(ne){if(typeof ne!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ne)}Object.defineProperty(z,"defaultMaxListeners",{enumerable:!0,get:function(){return U},set:function(ne){if(typeof ne!="number"||ne<0||O(ne))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ne+".");U=ne}}),z.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},z.prototype.setMaxListeners=function(te){if(typeof te!="number"||te<0||O(te))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+te+".");return this._maxListeners=te,this};function Y(ne){return ne._maxListeners===void 0?z.defaultMaxListeners:ne._maxListeners}z.prototype.getMaxListeners=function(){return Y(this)},z.prototype.emit=function(te){for(var re=[],me=1;me<arguments.length;me++)re.push(arguments[me]);var we=te==="error",tt=this._events;if(tt!==void 0)we=we&&tt.error===void 0;else if(!we)return!1;if(we){var Et;if(re.length>0&&(Et=re[0]),Et instanceof Error)throw Et;var ft=new Error("Unhandled error."+(Et?" ("+Et.message+")":""));throw ft.context=Et,ft}var rr=tt[te];if(rr===void 0)return!1;if(typeof rr=="function")b(rr,this,re);else for(var or=rr.length,Fr=oe(rr,or),me=0;me<or;++me)b(Fr[me],this,re);return!0};function Q(ne,te,re,me){var we,tt,Et;if(H(re),tt=ne._events,tt===void 0?(tt=ne._events=Object.create(null),ne._eventsCount=0):(tt.newListener!==void 0&&(ne.emit("newListener",te,re.listener?re.listener:re),tt=ne._events),Et=tt[te]),Et===void 0)Et=tt[te]=re,++ne._eventsCount;else if(typeof Et=="function"?Et=tt[te]=me?[re,Et]:[Et,re]:me?Et.unshift(re):Et.push(re),we=Y(ne),we>0&&Et.length>we&&!Et.warned){Et.warned=!0;var ft=new Error("Possible EventEmitter memory leak detected. "+Et.length+" "+String(te)+" listeners added. Use emitter.setMaxListeners() to increase limit");ft.name="MaxListenersExceededWarning",ft.emitter=ne,ft.type=te,ft.count=Et.length,o(ft)}return ne}z.prototype.addListener=function(te,re){return Q(this,te,re,!1)},z.prototype.on=z.prototype.addListener,z.prototype.prependListener=function(te,re){return Q(this,te,re,!0)};function ge(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ye(ne,te,re){var me={fired:!1,wrapFn:void 0,target:ne,type:te,listener:re},we=ge.bind(me);return we.listener=re,me.wrapFn=we,we}z.prototype.once=function(te,re){return H(re),this.on(te,ye(this,te,re)),this},z.prototype.prependOnceListener=function(te,re){return H(re),this.prependListener(te,ye(this,te,re)),this},z.prototype.removeListener=function(te,re){var me,we,tt,Et,ft;if(H(re),we=this._events,we===void 0)return this;if(me=we[te],me===void 0)return this;if(me===re||me.listener===re)--this._eventsCount===0?this._events=Object.create(null):(delete we[te],we.removeListener&&this.emit("removeListener",te,me.listener||re));else if(typeof me!="function"){for(tt=-1,Et=me.length-1;Et>=0;Et--)if(me[Et]===re||me[Et].listener===re){ft=me[Et].listener,tt=Et;break}if(tt<0)return this;tt===0?me.shift():ve(me,tt),me.length===1&&(we[te]=me[0]),we.removeListener!==void 0&&this.emit("removeListener",te,ft||re)}return this},z.prototype.off=z.prototype.removeListener,z.prototype.removeAllListeners=function(te){var re,me,we;if(me=this._events,me===void 0)return this;if(me.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):me[te]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete me[te]),this;if(arguments.length===0){var tt=Object.keys(me),Et;for(we=0;we<tt.length;++we)Et=tt[we],Et!=="removeListener"&&this.removeAllListeners(Et);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(re=me[te],typeof re=="function")this.removeListener(te,re);else if(re!==void 0)for(we=re.length-1;we>=0;we--)this.removeListener(te,re[we]);return this};function ke(ne,te,re){var me=ne._events;if(me===void 0)return[];var we=me[te];return we===void 0?[]:typeof we=="function"?re?[we.listener||we]:[we]:re?be(we):oe(we,we.length)}z.prototype.listeners=function(te){return ke(this,te,!0)},z.prototype.rawListeners=function(te){return ke(this,te,!1)},z.listenerCount=function(ne,te){return typeof ne.listenerCount=="function"?ne.listenerCount(te):he.call(ne,te)},z.prototype.listenerCount=he;function he(ne){var te=this._events;if(te!==void 0){var re=te[ne];if(typeof re=="function")return 1;if(re!==void 0)return re.length}return 0}z.prototype.eventNames=function(){return this._eventsCount>0?E(this._events):[]};function oe(ne,te){for(var re=new Array(te),me=0;me<te;++me)re[me]=ne[me];return re}function ve(ne,te){for(;te+1<ne.length;te++)ne[te]=ne[te+1];ne.pop()}function be(ne){for(var te=new Array(ne.length),re=0;re<te.length;++re)te[re]=ne[re].listener||ne[re];return te}function ze(ne,te){return new Promise(function(re,me){function we(Et){ne.removeListener(te,tt),me(Et)}function tt(){typeof ne.removeListener=="function"&&ne.removeListener("error",we),re([].slice.call(arguments))}ie(ne,te,tt,{once:!0}),te!=="error"&&Te(ne,we,{once:!0})})}function Te(ne,te,re){typeof ne.on=="function"&&ie(ne,"error",te,re)}function ie(ne,te,re,me){if(typeof ne.on=="function")me.once?ne.once(te,re):ne.on(te,re);else if(typeof ne.addEventListener=="function")ne.addEventListener(te,function we(tt){me.once&&ne.removeEventListener(te,we),re(tt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ne)}},{}],8:[function(r,s,h){(function(){var p=this,b={};typeof h<"u"?s.exports=b:p.fuzzy=b,b.simpleFilter=function(E,o){return o.filter(function(O){return b.test(E,O)})},b.test=function(E,o){return b.match(E,o)!==null},b.match=function(E,o,O){O=O||{};var z=0,U=[],H=o.length,Y=0,Q=0,ge=O.pre||"",ye=O.post||"",ke=O.caseSensitive&&o||o.toLowerCase(),he;E=O.caseSensitive&&E||E.toLowerCase();for(var oe=0;oe<H;oe++)he=o[oe],ke[oe]===E[z]?(he=ge+he+ye,z+=1,Q+=1+Q):Q=0,Y+=Q,U[U.length]=he;return z===E.length?(Y=ke===E?1/0:Y,{rendered:U.join(""),score:Y}):null},b.filter=function(E,o,O){return!o||o.length===0?[]:typeof E!="string"?o:(O=O||{},o.reduce(function(z,U,H,Y){var Q=U;O.extract&&(Q=O.extract(U));var ge=b.match(E,Q,O);return ge!=null&&(z[z.length]={string:ge.rendered,score:ge.score,index:H,original:U}),z},[]).sort(function(z,U){var H=U.score-z.score;return H||z.index-U.index}))}})()},{}],9:[function(r,s,h){var p=/<%=([\s\S]+?)%>/g;s.exports=p},{}],10:[function(r,s,h){(function(p){(function(){var b="Expected a function",E=NaN,o="[object Symbol]",O=/^\s+|\s+$/g,z=/^[-+]0x[0-9a-f]+$/i,U=/^0b[01]+$/i,H=/^0o[0-7]+$/i,Y=parseInt,Q=typeof p=="object"&&p&&p.Object===Object&&p,ge=typeof self=="object"&&self&&self.Object===Object&&self,ye=Q||ge||Function("return this")(),ke=Object.prototype,he=ke.toString,oe=Math.max,ve=Math.min,be=function(){return ye.Date.now()};function ze(re,me,we){var tt,Et,ft,rr,or,Fr,gt=0,jr=!1,Ur=!1,Xr=!0;if(typeof re!="function")throw new TypeError(b);me=te(me)||0,Te(we)&&(jr=!!we.leading,Ur="maxWait"in we,ft=Ur?oe(te(we.maxWait)||0,me):ft,Xr="trailing"in we?!!we.trailing:Xr);function pr(Fe){var $e=tt,We=Et;return tt=Et=void 0,gt=Fe,rr=re.apply(We,$e),rr}function Dt(Fe){return gt=Fe,or=setTimeout(Pt,me),jr?pr(Fe):rr}function ar(Fe){var $e=Fe-Fr,We=Fe-gt,zt=me-$e;return Ur?ve(zt,ft-We):zt}function vt(Fe){var $e=Fe-Fr,We=Fe-gt;return Fr===void 0||$e>=me||$e<0||Ur&&We>=ft}function Pt(){var Fe=be();if(vt(Fe))return Ot(Fe);or=setTimeout(Pt,ar(Fe))}function Ot(Fe){return or=void 0,Xr&&tt?pr(Fe):(tt=Et=void 0,rr)}function lr(){or!==void 0&&clearTimeout(or),gt=0,tt=Fr=Et=or=void 0}function Se(){return or===void 0?rr:Ot(be())}function Kt(){var Fe=be(),$e=vt(Fe);if(tt=arguments,Et=this,Fr=Fe,$e){if(or===void 0)return Dt(Fr);if(Ur)return or=setTimeout(Pt,me),pr(Fr)}return or===void 0&&(or=setTimeout(Pt,me)),rr}return Kt.cancel=lr,Kt.flush=Se,Kt}function Te(re){var me=typeof re;return!!re&&(me=="object"||me=="function")}function ie(re){return!!re&&typeof re=="object"}function ne(re){return typeof re=="symbol"||ie(re)&&he.call(re)==o}function te(re){if(typeof re=="number")return re;if(ne(re))return E;if(Te(re)){var me=typeof re.valueOf=="function"?re.valueOf():re;re=Te(me)?me+"":me}if(typeof re!="string")return re===0?re:+re;re=re.replace(O,"");var we=U.test(re);return we||H.test(re)?Y(re.slice(2),we?2:8):z.test(re)?E:+re}s.exports=ze}).call(this)}).call(this,typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{})},{}],11:[function(r,s,h){(function(p){(function(){var b=200,E="__lodash_hash_undefined__",o=1,O=2,z=9007199254740991,U="[object Arguments]",H="[object Array]",Y="[object AsyncFunction]",Q="[object Boolean]",ge="[object Date]",ye="[object Error]",ke="[object Function]",he="[object GeneratorFunction]",oe="[object Map]",ve="[object Number]",be="[object Null]",ze="[object Object]",Te="[object Promise]",ie="[object Proxy]",ne="[object RegExp]",te="[object Set]",re="[object String]",me="[object Symbol]",we="[object Undefined]",tt="[object WeakMap]",Et="[object ArrayBuffer]",ft="[object DataView]",rr="[object Float32Array]",or="[object Float64Array]",Fr="[object Int8Array]",gt="[object Int16Array]",jr="[object Int32Array]",Ur="[object Uint8Array]",Xr="[object Uint8ClampedArray]",pr="[object Uint16Array]",Dt="[object Uint32Array]",ar=/[\\^$.*+?()[\]{}|]/g,vt=/^\[object .+?Constructor\]$/,Pt=/^(?:0|[1-9]\d*)$/,Ot={};Ot[rr]=Ot[or]=Ot[Fr]=Ot[gt]=Ot[jr]=Ot[Ur]=Ot[Xr]=Ot[pr]=Ot[Dt]=!0,Ot[U]=Ot[H]=Ot[Et]=Ot[Q]=Ot[ft]=Ot[ge]=Ot[ye]=Ot[ke]=Ot[oe]=Ot[ve]=Ot[ze]=Ot[ne]=Ot[te]=Ot[re]=Ot[tt]=!1;var lr=typeof p=="object"&&p&&p.Object===Object&&p,Se=typeof self=="object"&&self&&self.Object===Object&&self,Kt=lr||Se||Function("return this")(),Fe=typeof h=="object"&&h&&!h.nodeType&&h,$e=Fe&&typeof s=="object"&&s&&!s.nodeType&&s,We=$e&&$e.exports===Fe,zt=We&&lr.process,$t=function(){try{return zt&&zt.binding&&zt.binding("util")}catch{}}(),_r=$t&&$t.isTypedArray;function Wt(Xe,Rt){for(var gr=-1,$r=Xe==null?0:Xe.length,Dn=0,An=[];++gr<$r;){var Pn=Xe[gr];Rt(Pn,gr,Xe)&&(An[Dn++]=Pn)}return An}function mr(Xe,Rt){for(var gr=-1,$r=Rt.length,Dn=Xe.length;++gr<$r;)Xe[Dn+gr]=Rt[gr];return Xe}function Tr(Xe,Rt){for(var gr=-1,$r=Xe==null?0:Xe.length;++gr<$r;)if(Rt(Xe[gr],gr,Xe))return!0;return!1}function yr(Xe,Rt){for(var gr=-1,$r=Array(Xe);++gr<Xe;)$r[gr]=Rt(gr);return $r}function Lr(Xe){return function(Rt){return Xe(Rt)}}function qr(Xe,Rt){return Xe.has(Rt)}function nr(Xe,Rt){return Xe==null?void 0:Xe[Rt]}function Wr(Xe){var Rt=-1,gr=Array(Xe.size);return Xe.forEach(function($r,Dn){gr[++Rt]=[Dn,$r]}),gr}function Zr(Xe,Rt){return function(gr){return Xe(Rt(gr))}}function Rn(Xe){var Rt=-1,gr=Array(Xe.size);return Xe.forEach(function($r){gr[++Rt]=$r}),gr}var ln=Array.prototype,jn=Function.prototype,uo=Object.prototype,ho=Kt["__core-js_shared__"],vs=jn.toString,Ai=uo.hasOwnProperty,ns=function(){var Xe=/[^.]+$/.exec(ho&&ho.keys&&ho.keys.IE_PROTO||"");return Xe?"Symbol(src)_1."+Xe:""}(),ki=uo.toString,Oi=RegExp("^"+vs.call(Ai).replace(ar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zo=We?Kt.Buffer:void 0,en=Kt.Symbol,Do=Kt.Uint8Array,bs=uo.propertyIsEnumerable,Lo=ln.splice,jo=en?en.toStringTag:void 0,is=Object.getOwnPropertySymbols,Is=Zo?Zo.isBuffer:void 0,Ks=Zr(Object.keys,Object),$o=ea(Kt,"DataView"),pt=ea(Kt,"Map"),fe=ea(Kt,"Promise"),xe=ea(Kt,"Set"),Ne=ea(Kt,"WeakMap"),Ke=ea(Object,"create"),Ge=Bi($o),st=Bi(pt),_t=Bi(fe),at=Bi(xe),bt=Bi(Ne),St=en?en.prototype:void 0,xt=St?St.valueOf:void 0;function jt(Xe){var Rt=-1,gr=Xe==null?0:Xe.length;for(this.clear();++Rt<gr;){var $r=Xe[Rt];this.set($r[0],$r[1])}}function ur(){this.__data__=Ke?Ke(null):{},this.size=0}function ir(Xe){var Rt=this.has(Xe)&&delete this.__data__[Xe];return this.size-=Rt?1:0,Rt}function Rr(Xe){var Rt=this.__data__;if(Ke){var gr=Rt[Xe];return gr===E?void 0:gr}return Ai.call(Rt,Xe)?Rt[Xe]:void 0}function Br(Xe){var Rt=this.__data__;return Ke?Rt[Xe]!==void 0:Ai.call(Rt,Xe)}function kr(Xe,Rt){var gr=this.__data__;return this.size+=this.has(Xe)?0:1,gr[Xe]=Ke&&Rt===void 0?E:Rt,this}jt.prototype.clear=ur,jt.prototype.delete=ir,jt.prototype.get=Rr,jt.prototype.has=Br,jt.prototype.set=kr;function zr(Xe){var Rt=-1,gr=Xe==null?0:Xe.length;for(this.clear();++Rt<gr;){var $r=Xe[Rt];this.set($r[0],$r[1])}}function yn(){this.__data__=[],this.size=0}function Tn(Xe){var Rt=this.__data__,gr=eo(Rt,Xe);if(gr<0)return!1;var $r=Rt.length-1;return gr==$r?Rt.pop():Lo.call(Rt,gr,1),--this.size,!0}function Yr(Xe){var Rt=this.__data__,gr=eo(Rt,Xe);return gr<0?void 0:Rt[gr][1]}function On(Xe){return eo(this.__data__,Xe)>-1}function Qn(Xe,Rt){var gr=this.__data__,$r=eo(gr,Xe);return $r<0?(++this.size,gr.push([Xe,Rt])):gr[$r][1]=Rt,this}zr.prototype.clear=yn,zr.prototype.delete=Tn,zr.prototype.get=Yr,zr.prototype.has=On,zr.prototype.set=Qn;function Kn(Xe){var Rt=-1,gr=Xe==null?0:Xe.length;for(this.clear();++Rt<gr;){var $r=Xe[Rt];this.set($r[0],$r[1])}}function Di(){this.size=0,this.__data__={hash:new jt,map:new(pt||zr),string:new jt}}function Li(Xe){var Rt=Ao(this,Xe).delete(Xe);return this.size-=Rt?1:0,Rt}function mo(Xe){return Ao(this,Xe).get(Xe)}function os(Xe){return Ao(this,Xe).has(Xe)}function Ka(Xe,Rt){var gr=Ao(this,Xe),$r=gr.size;return gr.set(Xe,Rt),this.size+=gr.size==$r?0:1,this}Kn.prototype.clear=Di,Kn.prototype.delete=Li,Kn.prototype.get=mo,Kn.prototype.has=os,Kn.prototype.set=Ka;function As(Xe){var Rt=-1,gr=Xe==null?0:Xe.length;for(this.__data__=new Kn;++Rt<gr;)this.add(Xe[Rt])}function Xs(Xe){return this.__data__.set(Xe,E),this}function Ma(Xe){return this.__data__.has(Xe)}As.prototype.add=As.prototype.push=Xs,As.prototype.has=Ma;function Bo(Xe){var Rt=this.__data__=new zr(Xe);this.size=Rt.size}function ka(){this.__data__=new zr,this.size=0}function la(Xe){var Rt=this.__data__,gr=Rt.delete(Xe);return this.size=Rt.size,gr}function ca(Xe){return this.__data__.get(Xe)}function Ys(Xe){return this.__data__.has(Xe)}function Xi(Xe,Rt){var gr=this.__data__;if(gr instanceof zr){var $r=gr.__data__;if(!pt||$r.length<b-1)return $r.push([Xe,Rt]),this.size=++gr.size,this;gr=this.__data__=new Kn($r)}return gr.set(Xe,Rt),this.size=gr.size,this}Bo.prototype.clear=ka,Bo.prototype.delete=la,Bo.prototype.get=ca,Bo.prototype.has=Ys,Bo.prototype.set=Xi;function ji(Xe,Rt){var gr=Ri(Xe),$r=!gr&&_o(Xe),Dn=!gr&&!$r&&cr(Xe),An=!gr&&!$r&&!Dn&&Bs(Xe),Pn=gr||$r||Dn||An,ti=Pn?yr(Xe.length,String):[],hi=ti.length;for(var xi in Xe)Ai.call(Xe,xi)&&!(Pn&&(xi=="length"||Dn&&(xi=="offset"||xi=="parent")||An&&(xi=="buffer"||xi=="byteLength"||xi=="byteOffset")||Ht(xi,hi)))&&ti.push(xi);return ti}function eo(Xe,Rt){for(var gr=Xe.length;gr--;)if(ai(Xe[gr][0],Rt))return gr;return-1}function Ci(Xe,Rt,gr){var $r=Rt(Xe);return Ri(Xe)?$r:mr($r,gr(Xe))}function Yi(Xe){return Xe==null?Xe===void 0?we:be:jo&&jo in Object(Xe)?Xo(Xe):pi(Xe)}function go(Xe){return on(Xe)&&Yi(Xe)==U}function io(Xe,Rt,gr,$r,Dn){return Xe===Rt?!0:Xe==null||Rt==null||!on(Xe)&&!on(Rt)?Xe!==Xe&&Rt!==Rt:_s(Xe,Rt,gr,$r,io,Dn)}function _s(Xe,Rt,gr,$r,Dn,An){var Pn=Ri(Xe),ti=Ri(Rt),hi=Pn?H:it(Xe),xi=ti?H:it(Rt);hi=hi==U?ze:hi,xi=xi==U?ze:xi;var fo=hi==ze,qn=xi==ze,ni=hi==xi;if(ni&&cr(Xe)){if(!cr(Rt))return!1;Pn=!0,fo=!1}if(ni&&!fo)return An||(An=new Bo),Pn||Bs(Xe)?Js(Xe,Rt,gr,$r,Dn,An):Ji(Xe,Rt,hi,gr,$r,Dn,An);if(!(gr&o)){var so=fo&&Ai.call(Xe,"__wrapped__"),ii=qn&&Ai.call(Rt,"__wrapped__");if(so||ii){var zs=so?Xe.value():Xe,yo=ii?Rt.value():Rt;return An||(An=new Bo),Dn(zs,yo,gr,$r,An)}}return ni?(An||(An=new Bo),Cs(Xe,Rt,gr,$r,Dn,An)):!1}function Ko(Xe){if(!$i(Xe)||vn(Xe))return!1;var Rt=fn(Xe)?Oi:vt;return Rt.test(Bi(Xe))}function ei(Xe){return on(Xe)&&oo(Xe.length)&&!!Ot[Yi(Xe)]}function ua(Xe){if(!vr(Xe))return Ks(Xe);var Rt=[];for(var gr in Object(Xe))Ai.call(Xe,gr)&&gr!="constructor"&&Rt.push(gr);return Rt}function Js(Xe,Rt,gr,$r,Dn,An){var Pn=gr&o,ti=Xe.length,hi=Rt.length;if(ti!=hi&&!(Pn&&hi>ti))return!1;var xi=An.get(Xe);if(xi&&An.get(Rt))return xi==Rt;var fo=-1,qn=!0,ni=gr&O?new As:void 0;for(An.set(Xe,Rt),An.set(Rt,Xe);++fo<ti;){var so=Xe[fo],ii=Rt[fo];if($r)var zs=Pn?$r(ii,so,fo,Rt,Xe,An):$r(so,ii,fo,Xe,Rt,An);if(zs!==void 0){if(zs)continue;qn=!1;break}if(ni){if(!Tr(Rt,function(yo,Ro){if(!qr(ni,Ro)&&(so===yo||Dn(so,yo,gr,$r,An)))return ni.push(Ro)})){qn=!1;break}}else if(!(so===ii||Dn(so,ii,gr,$r,An))){qn=!1;break}}return An.delete(Xe),An.delete(Rt),qn}function Ji(Xe,Rt,gr,$r,Dn,An,Pn){switch(gr){case ft:if(Xe.byteLength!=Rt.byteLength||Xe.byteOffset!=Rt.byteOffset)return!1;Xe=Xe.buffer,Rt=Rt.buffer;case Et:return!(Xe.byteLength!=Rt.byteLength||!An(new Do(Xe),new Do(Rt)));case Q:case ge:case ve:return ai(+Xe,+Rt);case ye:return Xe.name==Rt.name&&Xe.message==Rt.message;case ne:case re:return Xe==Rt+"";case oe:var ti=Wr;case te:var hi=$r&o;if(ti||(ti=Rn),Xe.size!=Rt.size&&!hi)return!1;var xi=Pn.get(Xe);if(xi)return xi==Rt;$r|=O,Pn.set(Xe,Rt);var fo=Js(ti(Xe),ti(Rt),$r,Dn,An,Pn);return Pn.delete(Xe),fo;case me:if(xt)return xt.call(Xe)==xt.call(Rt)}return!1}function Cs(Xe,Rt,gr,$r,Dn,An){var Pn=gr&o,ti=Qs(Xe),hi=ti.length,xi=Qs(Rt),fo=xi.length;if(hi!=fo&&!Pn)return!1;for(var qn=hi;qn--;){var ni=ti[qn];if(!(Pn?ni in Rt:Ai.call(Rt,ni)))return!1}var so=An.get(Xe);if(so&&An.get(Rt))return so==Rt;var ii=!0;An.set(Xe,Rt),An.set(Rt,Xe);for(var zs=Pn;++qn<hi;){ni=ti[qn];var yo=Xe[ni],Ro=Rt[ni];if($r)var ha=Pn?$r(Ro,yo,ni,Rt,Xe,An):$r(yo,Ro,ni,Xe,Rt,An);if(!(ha===void 0?yo===Ro||Dn(yo,Ro,gr,$r,An):ha)){ii=!1;break}zs||(zs=ni=="constructor")}if(ii&&!zs){var Ns=Xe.constructor,Fs=Rt.constructor;Ns!=Fs&&"constructor"in Xe&&"constructor"in Rt&&!(typeof Ns=="function"&&Ns instanceof Ns&&typeof Fs=="function"&&Fs instanceof Fs)&&(ii=!1)}return An.delete(Xe),An.delete(Rt),ii}function Qs(Xe){return Ci(Xe,ss,Oa)}function Ao(Xe,Rt){var gr=Xe.__data__;return Zt(Rt)?gr[typeof Rt=="string"?"string":"hash"]:gr.map}function ea(Xe,Rt){var gr=nr(Xe,Rt);return Ko(gr)?gr:void 0}function Xo(Xe){var Rt=Ai.call(Xe,jo),gr=Xe[jo];try{Xe[jo]=void 0;var $r=!0}catch{}var Dn=ki.call(Xe);return $r&&(Rt?Xe[jo]=gr:delete Xe[jo]),Dn}var Oa=is?function(Xe){return Xe==null?[]:(Xe=Object(Xe),Wt(is(Xe),function(Rt){return bs.call(Xe,Rt)}))}:mi,it=Yi;($o&&it(new $o(new ArrayBuffer(1)))!=ft||pt&&it(new pt)!=oe||fe&&it(fe.resolve())!=Te||xe&&it(new xe)!=te||Ne&&it(new Ne)!=tt)&&(it=function(Xe){var Rt=Yi(Xe),gr=Rt==ze?Xe.constructor:void 0,$r=gr?Bi(gr):"";if($r)switch($r){case Ge:return ft;case st:return oe;case _t:return Te;case at:return te;case bt:return tt}return Rt});function Ht(Xe,Rt){return Rt=Rt??z,!!Rt&&(typeof Xe=="number"||Pt.test(Xe))&&Xe>-1&&Xe%1==0&&Xe<Rt}function Zt(Xe){var Rt=typeof Xe;return Rt=="string"||Rt=="number"||Rt=="symbol"||Rt=="boolean"?Xe!=="__proto__":Xe===null}function vn(Xe){return!!ns&&ns in Xe}function vr(Xe){var Rt=Xe&&Xe.constructor,gr=typeof Rt=="function"&&Rt.prototype||uo;return Xe===gr}function pi(Xe){return ki.call(Xe)}function Bi(Xe){if(Xe!=null){try{return vs.call(Xe)}catch{}try{return Xe+""}catch{}}return""}function ai(Xe,Rt){return Xe===Rt||Xe!==Xe&&Rt!==Rt}var _o=go(function(){return arguments}())?go:function(Xe){return on(Xe)&&Ai.call(Xe,"callee")&&!bs.call(Xe,"callee")},Ri=Array.isArray;function Yo(Xe){return Xe!=null&&oo(Xe.length)&&!fn(Xe)}var cr=Is||Co;function cn(Xe,Rt){return io(Xe,Rt)}function fn(Xe){if(!$i(Xe))return!1;var Rt=Yi(Xe);return Rt==ke||Rt==he||Rt==Y||Rt==ie}function oo(Xe){return typeof Xe=="number"&&Xe>-1&&Xe%1==0&&Xe<=z}function $i(Xe){var Rt=typeof Xe;return Xe!=null&&(Rt=="object"||Rt=="function")}function on(Xe){return Xe!=null&&typeof Xe=="object"}var Bs=_r?Lr(_r):ei;function ss(Xe){return Yo(Xe)?ji(Xe):ua(Xe)}function mi(){return[]}function Co(){return!1}s.exports=cn}).call(this)}).call(this,typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{})},{}],12:[function(r,s,h){(function(p){(function(){var b=r("lodash._reinterpolate"),E=r("lodash.templatesettings"),o=800,O=16,z=1/0,U=9007199254740991,H="[object Arguments]",Y="[object Array]",Q="[object AsyncFunction]",ge="[object Boolean]",ye="[object Date]",ke="[object DOMException]",he="[object Error]",oe="[object Function]",ve="[object GeneratorFunction]",be="[object Map]",ze="[object Number]",Te="[object Null]",ie="[object Object]",ne="[object Proxy]",te="[object RegExp]",re="[object Set]",me="[object String]",we="[object Symbol]",tt="[object Undefined]",Et="[object WeakMap]",ft="[object ArrayBuffer]",rr="[object DataView]",or="[object Float32Array]",Fr="[object Float64Array]",gt="[object Int8Array]",jr="[object Int16Array]",Ur="[object Int32Array]",Xr="[object Uint8Array]",pr="[object Uint8ClampedArray]",Dt="[object Uint16Array]",ar="[object Uint32Array]",vt=/\b__p \+= '';/g,Pt=/\b(__p \+=) '' \+/g,Ot=/(__e\(.*?\)|\b__t\)) \+\n'';/g,lr=/[\\^$.*+?()[\]{}|]/g,Se=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Kt=/^\[object .+?Constructor\]$/,Fe=/^(?:0|[1-9]\d*)$/,$e=/($^)/,We=/['\n\r\u2028\u2029\\]/g,zt={};zt[or]=zt[Fr]=zt[gt]=zt[jr]=zt[Ur]=zt[Xr]=zt[pr]=zt[Dt]=zt[ar]=!0,zt[H]=zt[Y]=zt[ft]=zt[ge]=zt[rr]=zt[ye]=zt[he]=zt[oe]=zt[be]=zt[ze]=zt[ie]=zt[te]=zt[re]=zt[me]=zt[Et]=!1;var $t={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},_r=typeof p=="object"&&p&&p.Object===Object&&p,Wt=typeof self=="object"&&self&&self.Object===Object&&self,mr=_r||Wt||Function("return this")(),Tr=typeof h=="object"&&h&&!h.nodeType&&h,yr=Tr&&typeof s=="object"&&s&&!s.nodeType&&s,Lr=yr&&yr.exports===Tr,qr=Lr&&_r.process,nr=function(){try{var it=yr&&yr.require&&yr.require("util").types;return it||qr&&qr.binding&&qr.binding("util")}catch{}}(),Wr=nr&&nr.isTypedArray;function Zr(it,Ht,Zt){switch(Zt.length){case 0:return it.call(Ht);case 1:return it.call(Ht,Zt[0]);case 2:return it.call(Ht,Zt[0],Zt[1]);case 3:return it.call(Ht,Zt[0],Zt[1],Zt[2])}return it.apply(Ht,Zt)}function Rn(it,Ht){for(var Zt=-1,vn=it==null?0:it.length,vr=Array(vn);++Zt<vn;)vr[Zt]=Ht(it[Zt],Zt,it);return vr}function ln(it,Ht){for(var Zt=-1,vn=Array(it);++Zt<it;)vn[Zt]=Ht(Zt);return vn}function jn(it){return function(Ht){return it(Ht)}}function uo(it,Ht){return Rn(Ht,function(Zt){return it[Zt]})}function ho(it){return"\\"+$t[it]}function vs(it,Ht){return it==null?void 0:it[Ht]}function Ai(it,Ht){return function(Zt){return it(Ht(Zt))}}var ns=Function.prototype,ki=Object.prototype,Oi=mr["__core-js_shared__"],Zo=ns.toString,en=ki.hasOwnProperty,Do=function(){var it=/[^.]+$/.exec(Oi&&Oi.keys&&Oi.keys.IE_PROTO||"");return it?"Symbol(src)_1."+it:""}(),bs=ki.toString,Lo=Zo.call(Object),jo=RegExp("^"+Zo.call(en).replace(lr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),is=Lr?mr.Buffer:void 0,Is=mr.Symbol,Ks=Ai(Object.getPrototypeOf,Object),$o=ki.propertyIsEnumerable,pt=Is?Is.toStringTag:void 0,fe=function(){try{var it=Qn(Object,"defineProperty");return it({},"",{}),it}catch{}}(),xe=is?is.isBuffer:void 0,Ne=Ai(Object.keys,Object),Ke=Math.max,Ge=Date.now,st=Is?Is.prototype:void 0,_t=st?st.toString:void 0;function at(it,Ht){var Zt=Ys(it),vn=!Zt&&ca(it),vr=!Zt&&!vn&&ji(it),pi=!Zt&&!vn&&!vr&&ei(it),Bi=Zt||vn||vr||pi,ai=Bi?ln(it.length,String):[],_o=ai.length;for(var Ri in it)(Ht||en.call(it,Ri))&&!(Bi&&(Ri=="length"||vr&&(Ri=="offset"||Ri=="parent")||pi&&(Ri=="buffer"||Ri=="byteLength"||Ri=="byteOffset")||Di(Ri,_o)))&&ai.push(Ri);return ai}function bt(it,Ht,Zt){var vn=it[Ht];(!(en.call(it,Ht)&&la(vn,Zt))||Zt===void 0&&!(Ht in it))&&St(it,Ht,Zt)}function St(it,Ht,Zt){Ht=="__proto__"&&fe?fe(it,Ht,{configurable:!0,enumerable:!0,value:Zt,writable:!0}):it[Ht]=Zt}function xt(it){return it==null?it===void 0?tt:Te:pt&&pt in Object(it)?Kn(it):As(it)}function jt(it){return io(it)&&xt(it)==H}function ur(it){if(!go(it)||mo(it))return!1;var Ht=Ci(it)?jo:Kt;return Ht.test(ka(it))}function ir(it){return io(it)&&Yi(it.length)&&!!zt[xt(it)]}function Rr(it){if(!os(it))return Ne(it);var Ht=[];for(var Zt in Object(it))en.call(it,Zt)&&Zt!="constructor"&&Ht.push(Zt);return Ht}function Br(it){if(!go(it))return Ka(it);var Ht=os(it),Zt=[];for(var vn in it)vn=="constructor"&&(Ht||!en.call(it,vn))||Zt.push(vn);return Zt}function kr(it,Ht){return Ma(Xs(it,Ht,Xo),it+"")}var zr=fe?function(it,Ht){return fe(it,"toString",{configurable:!0,enumerable:!1,value:ea(Ht),writable:!0})}:Xo;function yn(it){if(typeof it=="string")return it;if(Ys(it))return Rn(it,yn)+"";if(Ko(it))return _t?_t.call(it):"";var Ht=it+"";return Ht=="0"&&1/it==-z?"-0":Ht}function Tn(it,Ht,Zt,vn){var vr=!Zt;Zt||(Zt={});for(var pi=-1,Bi=Ht.length;++pi<Bi;){var ai=Ht[pi],_o=vn?vn(Zt[ai],it[ai],ai,Zt,it):void 0;_o===void 0&&(_o=it[ai]),vr?St(Zt,ai,_o):bt(Zt,ai,_o)}return Zt}function Yr(it){return kr(function(Ht,Zt){var vn=-1,vr=Zt.length,pi=vr>1?Zt[vr-1]:void 0,Bi=vr>2?Zt[2]:void 0;for(pi=it.length>3&&typeof pi=="function"?(vr--,pi):void 0,Bi&&Li(Zt[0],Zt[1],Bi)&&(pi=vr<3?void 0:pi,vr=1),Ht=Object(Ht);++vn<vr;){var ai=Zt[vn];ai&&it(Ht,ai,vn,pi)}return Ht})}function On(it,Ht,Zt,vn){return it===void 0||la(it,ki[Zt])&&!en.call(vn,Zt)?Ht:it}function Qn(it,Ht){var Zt=vs(it,Ht);return ur(Zt)?Zt:void 0}function Kn(it){var Ht=en.call(it,pt),Zt=it[pt];try{it[pt]=void 0;var vn=!0}catch{}var vr=bs.call(it);return vn&&(Ht?it[pt]=Zt:delete it[pt]),vr}function Di(it,Ht){var Zt=typeof it;return Ht=Ht??U,!!Ht&&(Zt=="number"||Zt!="symbol"&&Fe.test(it))&&it>-1&&it%1==0&&it<Ht}function Li(it,Ht,Zt){if(!go(Zt))return!1;var vn=typeof Ht;return(vn=="number"?Xi(Zt)&&Di(Ht,Zt.length):vn=="string"&&Ht in Zt)?la(Zt[Ht],it):!1}function mo(it){return!!Do&&Do in it}function os(it){var Ht=it&&it.constructor,Zt=typeof Ht=="function"&&Ht.prototype||ki;return it===Zt}function Ka(it){var Ht=[];if(it!=null)for(var Zt in Object(it))Ht.push(Zt);return Ht}function As(it){return bs.call(it)}function Xs(it,Ht,Zt){return Ht=Ke(Ht===void 0?it.length-1:Ht,0),function(){for(var vn=arguments,vr=-1,pi=Ke(vn.length-Ht,0),Bi=Array(pi);++vr<pi;)Bi[vr]=vn[Ht+vr];vr=-1;for(var ai=Array(Ht+1);++vr<Ht;)ai[vr]=vn[vr];return ai[Ht]=Zt(Bi),Zr(it,this,ai)}}var Ma=Bo(zr);function Bo(it){var Ht=0,Zt=0;return function(){var vn=Ge(),vr=O-(vn-Zt);if(Zt=vn,vr>0){if(++Ht>=o)return arguments[0]}else Ht=0;return it.apply(void 0,arguments)}}function ka(it){if(it!=null){try{return Zo.call(it)}catch{}try{return it+""}catch{}}return""}function la(it,Ht){return it===Ht||it!==it&&Ht!==Ht}var ca=jt(function(){return arguments}())?jt:function(it){return io(it)&&en.call(it,"callee")&&!$o.call(it,"callee")},Ys=Array.isArray;function Xi(it){return it!=null&&Yi(it.length)&&!Ci(it)}var ji=xe||Oa;function eo(it){if(!io(it))return!1;var Ht=xt(it);return Ht==he||Ht==ke||typeof it.message=="string"&&typeof it.name=="string"&&!_s(it)}function Ci(it){if(!go(it))return!1;var Ht=xt(it);return Ht==oe||Ht==ve||Ht==Q||Ht==ne}function Yi(it){return typeof it=="number"&&it>-1&&it%1==0&&it<=U}function go(it){var Ht=typeof it;return it!=null&&(Ht=="object"||Ht=="function")}function io(it){return it!=null&&typeof it=="object"}function _s(it){if(!io(it)||xt(it)!=ie)return!1;var Ht=Ks(it);if(Ht===null)return!0;var Zt=en.call(Ht,"constructor")&&Ht.constructor;return typeof Zt=="function"&&Zt instanceof Zt&&Zo.call(Zt)==Lo}function Ko(it){return typeof it=="symbol"||io(it)&&xt(it)==we}var ei=Wr?jn(Wr):ir;function ua(it){return it==null?"":yn(it)}var Js=Yr(function(it,Ht,Zt,vn){Tn(Ht,Cs(Ht),it,vn)});function Ji(it){return Xi(it)?at(it):Rr(it)}function Cs(it){return Xi(it)?at(it,!0):Br(it)}function Qs(it,Ht,Zt){var vn=E.imports._.templateSettings||E;Zt&&Li(it,Ht,Zt)&&(Ht=void 0),it=ua(it),Ht=Js({},Ht,vn,On);var vr=Js({},Ht.imports,vn.imports,On),pi=Ji(vr),Bi=uo(vr,pi),ai,_o,Ri=0,Yo=Ht.interpolate||$e,cr="__p += '",cn=RegExp((Ht.escape||$e).source+"|"+Yo.source+"|"+(Yo===b?Se:$e).source+"|"+(Ht.evaluate||$e).source+"|$","g"),fn=en.call(Ht,"sourceURL")?"//# sourceURL="+(Ht.sourceURL+"").replace(/[\r\n]/g," ")+`
`:"";it.replace(cn,function(on,Bs,ss,mi,Co,Xe){return ss||(ss=mi),cr+=it.slice(Ri,Xe).replace(We,ho),Bs&&(ai=!0,cr+=`' +
__e(`+Bs+`) +
'`),Co&&(_o=!0,cr+=`';
`+Co+`;
__p += '`),ss&&(cr+=`' +
((__t = (`+ss+`)) == null ? '' : __t) +
'`),Ri=Xe+on.length,on}),cr+=`';
`;var oo=en.call(Ht,"variable")&&Ht.variable;oo||(cr=`with (obj) {
`+cr+`
}
`),cr=(_o?cr.replace(vt,""):cr).replace(Pt,"$1").replace(Ot,"$1;"),cr="function("+(oo||"obj")+`) {
`+(oo?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ai?", __e = _.escape":"")+(_o?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+cr+`return __p
}`;var $i=Ao(function(){return Function(pi,fn+"return "+cr).apply(void 0,Bi)});if($i.source=cr,eo($i))throw $i;return $i}var Ao=kr(function(it,Ht){try{return Zr(it,void 0,Ht)}catch(Zt){return eo(Zt)?Zt:new Error(Zt)}});function ea(it){return function(){return it}}function Xo(it){return it}function Oa(){return!1}s.exports=Qs}).call(this)}).call(this,typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9,"lodash.templatesettings":13}],13:[function(r,s,h){(function(p){(function(){var b=r("lodash._reinterpolate"),E=1/0,o="[object Symbol]",O=/[&<>"'`]/g,z=RegExp(O.source),U=/<%-([\s\S]+?)%>/g,H=/<%([\s\S]+?)%>/g,Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Q=typeof p=="object"&&p&&p.Object===Object&&p,ge=typeof self=="object"&&self&&self.Object===Object&&self,ye=Q||ge||Function("return this")();function ke(tt){return function(Et){return tt==null?void 0:tt[Et]}}var he=ke(Y),oe=Object.prototype,ve=oe.toString,be=ye.Symbol,ze=be?be.prototype:void 0,Te=ze?ze.toString:void 0,ie={escape:U,evaluate:H,interpolate:b,variable:"",imports:{_:{escape:we}}};function ne(tt){if(typeof tt=="string")return tt;if(re(tt))return Te?Te.call(tt):"";var Et=tt+"";return Et=="0"&&1/tt==-E?"-0":Et}function te(tt){return!!tt&&typeof tt=="object"}function re(tt){return typeof tt=="symbol"||te(tt)&&ve.call(tt)==o}function me(tt){return tt==null?"":ne(tt)}function we(tt){return tt=me(tt),tt&&z.test(tt)?tt.replace(O,he):tt}s.exports=ie}).call(this)}).call(this,typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9}],14:[function(r,s,h){const p=r("is-plain-obj"),{hasOwnProperty:b}=Object.prototype,{propertyIsEnumerable:E}=Object,o=(he,oe,ve)=>Object.defineProperty(he,oe,{value:ve,writable:!0,enumerable:!0,configurable:!0}),O=this,z={concatArrays:!1,ignoreUndefined:!1},U=he=>{const oe=[];for(const ve in he)b.call(he,ve)&&oe.push(ve);if(Object.getOwnPropertySymbols){const ve=Object.getOwnPropertySymbols(he);for(const be of ve)E.call(he,be)&&oe.push(be)}return oe};function H(he){return Array.isArray(he)?Y(he):p(he)?Q(he):he}function Y(he){const oe=he.slice(0,0);return U(he).forEach(ve=>{o(oe,ve,H(he[ve]))}),oe}function Q(he){const oe=Object.getPrototypeOf(he)===null?Object.create(null):{};return U(he).forEach(ve=>{o(oe,ve,H(he[ve]))}),oe}const ge=(he,oe,ve,be)=>(ve.forEach(ze=>{typeof oe[ze]>"u"&&be.ignoreUndefined||(ze in he&&he[ze]!==Object.getPrototypeOf(he)?o(he,ze,ke(he[ze],oe[ze],be)):o(he,ze,H(oe[ze])))}),he),ye=(he,oe,ve)=>{let be=he.slice(0,0),ze=0;return[he,oe].forEach(Te=>{const ie=[];for(let ne=0;ne<Te.length;ne++)b.call(Te,ne)&&(ie.push(String(ne)),Te===he?o(be,ze++,Te[ne]):o(be,ze++,H(Te[ne])));be=ge(be,Te,U(Te).filter(ne=>!ie.includes(ne)),ve)}),be};function ke(he,oe,ve){return ve.concatArrays&&Array.isArray(he)&&Array.isArray(oe)?ye(he,oe,ve):!p(oe)||!p(he)?H(oe):ge(he,oe,U(oe),ve)}s.exports=function(...he){const oe=ke(H(z),this!==O&&this||{},z);let ve={_:{}};for(const be of he)if(be!==void 0){if(!p(be))throw new TypeError("`"+be+"` is not an Option Object");ve=ke(ve,{_:be},oe)}return ve._}},{"is-plain-obj":15}],15:[function(r,s,h){s.exports=p=>{if(Object.prototype.toString.call(p)!=="[object Object]")return!1;const b=Object.getPrototypeOf(p);return b===null||b===Object.prototype}},{}],16:[function(r,s,h){var p=s.exports={},b,E;function o(){throw new Error("setTimeout has not been defined")}function O(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?b=setTimeout:b=o}catch{b=o}try{typeof clearTimeout=="function"?E=clearTimeout:E=O}catch{E=O}})();function z(ve){if(b===setTimeout)return setTimeout(ve,0);if((b===o||!b)&&setTimeout)return b=setTimeout,setTimeout(ve,0);try{return b(ve,0)}catch{try{return b.call(null,ve,0)}catch{return b.call(this,ve,0)}}}function U(ve){if(E===clearTimeout)return clearTimeout(ve);if((E===O||!E)&&clearTimeout)return E=clearTimeout,clearTimeout(ve);try{return E(ve)}catch{try{return E.call(null,ve)}catch{return E.call(this,ve)}}}var H=[],Y=!1,Q,ge=-1;function ye(){!Y||!Q||(Y=!1,Q.length?H=Q.concat(H):ge=-1,H.length&&ke())}function ke(){if(!Y){var ve=z(ye);Y=!0;for(var be=H.length;be;){for(Q=H,H=[];++ge<be;)Q&&Q[ge].run();ge=-1,be=H.length}Q=null,Y=!1,U(ve)}}p.nextTick=function(ve){var be=new Array(arguments.length-1);if(arguments.length>1)for(var ze=1;ze<arguments.length;ze++)be[ze-1]=arguments[ze];H.push(new he(ve,be)),H.length===1&&!Y&&z(ke)};function he(ve,be){this.fun=ve,this.array=be}he.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={};function oe(){}p.on=oe,p.addListener=oe,p.once=oe,p.off=oe,p.removeListener=oe,p.removeAllListeners=oe,p.emit=oe,p.prependListener=oe,p.prependOnceListener=oe,p.listeners=function(ve){return[]},p.binding=function(ve){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(ve){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},{}],17:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;function p(o){var O=function(U){var H=U.dispatch,Y=U.getState;return function(Q){return function(ge){return typeof ge=="function"?ge(H,Y,o):Q(ge)}}};return O}var b=p();b.withExtraArgument=p;var E=b;h.default=E},{}],18:[function(r,s,h){(function(p){(function(){Object.defineProperty(h,"__esModule",{value:!0});var b=r("@babel/runtime/helpers/objectSpread2");function E(tt){return tt&&typeof tt=="object"&&"default"in tt?tt:{default:tt}}var o=E(b);function O(tt){return"Minified Redux error #"+tt+"; visit https://redux.js.org/Errors?code="+tt+" for the full message or use the non-minified dev environment for full errors. "}var z=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),U=function(){return Math.random().toString(36).substring(7).split("").join(".")},H={INIT:"@@redux/INIT"+U(),REPLACE:"@@redux/REPLACE"+U(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+U()}};function Y(tt){if(typeof tt!="object"||tt===null)return!1;for(var Et=tt;Object.getPrototypeOf(Et)!==null;)Et=Object.getPrototypeOf(Et);return Object.getPrototypeOf(tt)===Et}function Q(tt){if(tt===void 0)return"undefined";if(tt===null)return"null";var Et=typeof tt;switch(Et){case"boolean":case"string":case"number":case"symbol":case"function":return Et}if(Array.isArray(tt))return"array";if(ke(tt))return"date";if(ye(tt))return"error";var ft=ge(tt);switch(ft){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return ft}return Et.slice(8,-1).toLowerCase().replace(/\s/g,"")}function ge(tt){return typeof tt.constructor=="function"?tt.constructor.name:null}function ye(tt){return tt instanceof Error||typeof tt.message=="string"&&tt.constructor&&typeof tt.constructor.stackTraceLimit=="number"}function ke(tt){return tt instanceof Date?!0:typeof tt.toDateString=="function"&&typeof tt.getDate=="function"&&typeof tt.setDate=="function"}function he(tt){var Et=typeof tt;return p.env.NODE_ENV!=="production"&&(Et=Q(tt)),Et}function oe(tt,Et,ft){var rr;if(typeof Et=="function"&&typeof ft=="function"||typeof ft=="function"&&typeof arguments[3]=="function")throw new Error(p.env.NODE_ENV==="production"?O(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof Et=="function"&&typeof ft>"u"&&(ft=Et,Et=void 0),typeof ft<"u"){if(typeof ft!="function")throw new Error(p.env.NODE_ENV==="production"?O(1):"Expected the enhancer to be a function. Instead, received: '"+he(ft)+"'");return ft(oe)(tt,Et)}if(typeof tt!="function")throw new Error(p.env.NODE_ENV==="production"?O(2):"Expected the root reducer to be a function. Instead, received: '"+he(tt)+"'");var or=tt,Fr=Et,gt=[],jr=gt,Ur=!1;function Xr(){jr===gt&&(jr=gt.slice())}function pr(){if(Ur)throw new Error(p.env.NODE_ENV==="production"?O(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return Fr}function Dt(Ot){if(typeof Ot!="function")throw new Error(p.env.NODE_ENV==="production"?O(4):"Expected the listener to be a function. Instead, received: '"+he(Ot)+"'");if(Ur)throw new Error(p.env.NODE_ENV==="production"?O(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var lr=!0;return Xr(),jr.push(Ot),function(){if(lr){if(Ur)throw new Error(p.env.NODE_ENV==="production"?O(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");lr=!1,Xr();var Kt=jr.indexOf(Ot);jr.splice(Kt,1),gt=null}}}function ar(Ot){if(!Y(Ot))throw new Error(p.env.NODE_ENV==="production"?O(7):"Actions must be plain objects. Instead, the actual type was: '"+he(Ot)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof Ot.type>"u")throw new Error(p.env.NODE_ENV==="production"?O(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(Ur)throw new Error(p.env.NODE_ENV==="production"?O(9):"Reducers may not dispatch actions.");try{Ur=!0,Fr=or(Fr,Ot)}finally{Ur=!1}for(var lr=gt=jr,Se=0;Se<lr.length;Se++){var Kt=lr[Se];Kt()}return Ot}function vt(Ot){if(typeof Ot!="function")throw new Error(p.env.NODE_ENV==="production"?O(10):"Expected the nextReducer to be a function. Instead, received: '"+he(Ot));or=Ot,ar({type:H.REPLACE})}function Pt(){var Ot,lr=Dt;return Ot={subscribe:function(Kt){if(typeof Kt!="object"||Kt===null)throw new Error(p.env.NODE_ENV==="production"?O(11):"Expected the observer to be an object. Instead, received: '"+he(Kt)+"'");function Fe(){Kt.next&&Kt.next(pr())}Fe();var $e=lr(Fe);return{unsubscribe:$e}}},Ot[z]=function(){return this},Ot}return ar({type:H.INIT}),rr={dispatch:ar,subscribe:Dt,getState:pr,replaceReducer:vt},rr[z]=Pt,rr}var ve=oe;function be(tt){typeof console<"u"&&typeof console.error=="function"&&console.error(tt);try{throw new Error(tt)}catch{}}function ze(tt,Et,ft,rr){var or=Object.keys(Et),Fr=ft&&ft.type===H.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(or.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!Y(tt))return"The "+Fr+' has unexpected type of "'+he(tt)+'". Expected argument to be an object with the following '+('keys: "'+or.join('", "')+'"');var gt=Object.keys(tt).filter(function(jr){return!Et.hasOwnProperty(jr)&&!rr[jr]});if(gt.forEach(function(jr){rr[jr]=!0}),!(ft&&ft.type===H.REPLACE)&&gt.length>0)return"Unexpected "+(gt.length>1?"keys":"key")+" "+('"'+gt.join('", "')+'" found in '+Fr+". ")+"Expected to find one of the known reducer keys instead: "+('"'+or.join('", "')+'". Unexpected keys will be ignored.')}function Te(tt){Object.keys(tt).forEach(function(Et){var ft=tt[Et],rr=ft(void 0,{type:H.INIT});if(typeof rr>"u")throw new Error(p.env.NODE_ENV==="production"?O(12):'The slice reducer for key "'+Et+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof ft(void 0,{type:H.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(p.env.NODE_ENV==="production"?O(13):'The slice reducer for key "'+Et+'" returned undefined when probed with a random type. '+("Don't try to handle '"+H.INIT+`' or other actions in "redux/*" `)+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function ie(tt){for(var Et=Object.keys(tt),ft={},rr=0;rr<Et.length;rr++){var or=Et[rr];p.env.NODE_ENV!=="production"&&typeof tt[or]>"u"&&be('No reducer provided for key "'+or+'"'),typeof tt[or]=="function"&&(ft[or]=tt[or])}var Fr=Object.keys(ft),gt;p.env.NODE_ENV!=="production"&&(gt={});var jr;try{Te(ft)}catch(Ur){jr=Ur}return function(Xr,pr){if(Xr===void 0&&(Xr={}),jr)throw jr;if(p.env.NODE_ENV!=="production"){var Dt=ze(Xr,ft,pr,gt);Dt&&be(Dt)}for(var ar=!1,vt={},Pt=0;Pt<Fr.length;Pt++){var Ot=Fr[Pt],lr=ft[Ot],Se=Xr[Ot],Kt=lr(Se,pr);if(typeof Kt>"u"){var Fe=pr&&pr.type;throw new Error(p.env.NODE_ENV==="production"?O(14):"When called with an action of type "+(Fe?'"'+String(Fe)+'"':"(unknown type)")+', the slice reducer for key "'+Ot+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}vt[Ot]=Kt,ar=ar||Kt!==Se}return ar=ar||Fr.length!==Object.keys(Xr).length,ar?vt:Xr}}function ne(tt,Et){return function(){return Et(tt.apply(this,arguments))}}function te(tt,Et){if(typeof tt=="function")return ne(tt,Et);if(typeof tt!="object"||tt===null)throw new Error(p.env.NODE_ENV==="production"?O(16):"bindActionCreators expected an object or a function, but instead received: '"+he(tt)+`'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`);var ft={};for(var rr in tt){var or=tt[rr];typeof or=="function"&&(ft[rr]=ne(or,Et))}return ft}function re(){for(var tt=arguments.length,Et=new Array(tt),ft=0;ft<tt;ft++)Et[ft]=arguments[ft];return Et.length===0?function(rr){return rr}:Et.length===1?Et[0]:Et.reduce(function(rr,or){return function(){return rr(or.apply(void 0,arguments))}})}function me(){for(var tt=arguments.length,Et=new Array(tt),ft=0;ft<tt;ft++)Et[ft]=arguments[ft];return function(rr){return function(){var or=rr.apply(void 0,arguments),Fr=function(){throw new Error(p.env.NODE_ENV==="production"?O(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},gt={getState:or.getState,dispatch:function(){return Fr.apply(void 0,arguments)}},jr=Et.map(function(Ur){return Ur(gt)});return Fr=re.apply(void 0,jr)(or.dispatch),o.default(o.default({},or),{},{dispatch:Fr})}}}function we(){}p.env.NODE_ENV!=="production"&&typeof we.name=="string"&&we.name!=="isCrushed"&&be('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),h.__DO_NOT_USE__ActionTypes=H,h.applyMiddleware=me,h.bindActionCreators=te,h.combineReducers=ie,h.compose=re,h.createStore=oe,h.legacy_createStore=ve}).call(this)}).call(this,r("_process"))},{"@babel/runtime/helpers/objectSpread2":2,_process:16}],19:[function(r,s,h){var p=r("./src/suggestions");s.exports=p,typeof window<"u"&&(window.Suggestions=p)},{"./src/suggestions":21}],20:[function(r,s,h){var p=function(b){return this.component=b,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,b.el.parentNode.insertBefore(this.wrapper,b.el.nextSibling),this};p.prototype.show=function(){this.element.style.display="block"},p.prototype.hide=function(){this.element.style.display="none"},p.prototype.add=function(b){this.items.push(b)},p.prototype.clear=function(){this.items=[],this.active=0},p.prototype.isEmpty=function(){return!this.items.length},p.prototype.isVisible=function(){return this.element.style.display==="block"},p.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var b=0;b<this.items.length;b++)this.drawItem(this.items[b],this.active===b);this.show()},p.prototype.drawItem=function(b,E){var o=document.createElement("li"),O=document.createElement("a");E&&(o.className+=" active"),O.innerHTML=b.string,o.appendChild(O),this.element.appendChild(o),o.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),o.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,b)}).bind(this))},p.prototype.handleMouseUp=function(b){this.selectingListItem=!1,this.component.value(b.original),this.clear(),this.draw()},p.prototype.move=function(b){this.active=b,this.draw()},p.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},p.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},p.prototype.drawError=function(b){var E=document.createElement("li");E.innerHTML=b,this.element.appendChild(E),this.show()},s.exports=p},{}],21:[function(r,s,h){var p=r("xtend"),b=r("fuzzy"),E=r("./list"),o=function(O,z,U){return U=U||{},this.options=p({minLength:2,limit:5,filter:!0,hideOnBlur:!0},U),this.el=O,this.data=z||[],this.list=new E(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(H){this.handleKeyUp(H.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(H){this.handleKeyDown(H)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(H){this.handlePaste(H)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};o.prototype.handleKeyUp=function(O){O===40||O===38||O===27||O===13||O===9||this.handleInputChange(this.el.value)},o.prototype.handleKeyDown=function(O){switch(O.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&O.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},o.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},o.prototype.handlePaste=function(O){if(O.clipboardData)this.handleInputChange(O.clipboardData.getData("Text"));else{var z=this;setTimeout(function(){z.handleInputChange(O.target.value)},100)}},o.prototype.handleInputChange=function(O){if(this.query=this.normalize(O),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(z){for(var U=0;U<z.length&&(this.list.add(z[U]),U!==this.options.limit-1);U++);this.list.draw()}).bind(this))},o.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},o.prototype.update=function(O){this.data=O,this.handleKeyUp()},o.prototype.clear=function(){this.data=[],this.list.clear()},o.prototype.normalize=function(O){return O=O.toLowerCase(),O},o.prototype.match=function(O,z){return O.indexOf(z)>-1},o.prototype.value=function(O){if(this.selected=O,this.el.value=this.getItemValue(O),document.createEvent){var z=document.createEvent("HTMLEvents");z.initEvent("change",!0,!1),this.el.dispatchEvent(z)}else this.el.fireEvent("onchange")},o.prototype.getCandidates=function(O){var z={pre:"<strong>",post:"</strong>",extract:(function(H){return this.getItemValue(H)}).bind(this)},U;this.options.filter?(U=b.filter(this.query,this.data,z),U=U.map((function(H){return{original:H.original,string:this.render(H.original,H.string)}}).bind(this))):U=this.data.map((function(H){var Y=this.render(H);return{original:H,string:Y}}).bind(this)),O(U)},o.prototype.getItemValue=function(O){return O},o.prototype.render=function(O,z){if(z)return z;for(var U=O.original?this.getItemValue(O.original):this.getItemValue(O),H=this.normalize(U),Y=H.lastIndexOf(this.query);Y>-1;){var Q=Y+this.query.length;U=U.slice(0,Y)+"<strong>"+U.slice(Y,Q)+"</strong>"+U.slice(Q),Y=H.slice(0,Y).lastIndexOf(this.query)}return U},o.prototype.renderError=function(O){this.list.drawError(O)},s.exports=o},{"./list":20,fuzzy:8,xtend:24}],22:[function(r,s,h){var p=r("turf-meta").coordEach;s.exports=function(b){var E=[1/0,1/0,-1/0,-1/0];return p(b,function(o){E[0]>o[0]&&(E[0]=o[0]),E[1]>o[1]&&(E[1]=o[1]),E[2]<o[0]&&(E[2]=o[0]),E[3]<o[1]&&(E[3]=o[1])}),E}},{"turf-meta":23}],23:[function(r,s,h){function p(O,z,U){var H,Y,Q,ge,ye,ke,he,oe,ve=0,be,ze=O.type==="FeatureCollection",Te=O.type==="Feature",ie=ze?O.features.length:1;for(H=0;H<ie;H++)for(oe=ze?O.features[H].geometry:Te?O.geometry:O,be=oe.type==="GeometryCollection",ke=be?oe.geometries.length:1,ge=0;ge<ke;ge++)if(ye=be?oe.geometries[ge]:oe,he=ye.coordinates,ve=U&&(ye.type==="Polygon"||ye.type==="MultiPolygon")?1:0,ye.type==="Point")z(he);else if(ye.type==="LineString"||ye.type==="MultiPoint")for(Y=0;Y<he.length;Y++)z(he[Y]);else if(ye.type==="Polygon"||ye.type==="MultiLineString")for(Y=0;Y<he.length;Y++)for(Q=0;Q<he[Y].length-ve;Q++)z(he[Y][Q]);else if(ye.type==="MultiPolygon")for(Y=0;Y<he.length;Y++)for(Q=0;Q<he[Y].length;Q++)for(l=0;l<he[Y][Q].length-ve;l++)z(he[Y][Q][l]);else throw new Error("Unknown Geometry Type")}s.exports.coordEach=p;function b(O,z,U,H){return p(O,function(Y){U=z(U,Y)},H),U}s.exports.coordReduce=b;function E(O,z){var U;switch(O.type){case"FeatureCollection":for(features=O.features,U=0;U<O.features.length;U++)z(O.features[U].properties);break;case"Feature":z(O.properties);break}}s.exports.propEach=E;function o(O,z,U){return E(O,function(H){U=z(U,H)}),U}s.exports.propReduce=o},{}],24:[function(r,s,h){s.exports=b;var p=Object.prototype.hasOwnProperty;function b(){for(var E={},o=0;o<arguments.length;o++){var O=arguments[o];for(var z in O)p.call(O,z)&&(E[z]=O[z])}return E}},{}],25:[function(r,s,h){function p(Dt){"@babel/helpers - typeof";return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ar){return typeof ar}:function(ar){return ar&&typeof Symbol=="function"&&ar.constructor===Symbol&&ar!==Symbol.prototype?"symbol":typeof ar},p(Dt)}Object.defineProperty(h,"__esModule",{value:!0}),h.addWaypoint=gt,h.clearDestination=te,h.clearOrigin=ne,h.createDestination=Et,h.createOrigin=tt,h.eventEmit=pr,h.eventSubscribe=Xr,h.hoverMarker=me,h.queryDestination=ze,h.queryDestinationCoordinates=ie,h.queryOrigin=be,h.queryOriginCoordinates=Te,h.removeWaypoint=Ur,h.reverse=rr,h.setDestinationFromCoordinates=Fr,h.setOptions=re,h.setOriginFromCoordinates=or,h.setProfile=ft,h.setRouteIndex=we,h.setWaypoint=jr;var b=z(r("../constants/action_types")),E=o(r("../utils"));function o(Dt){return Dt&&Dt.__esModule?Dt:{default:Dt}}function O(Dt){if(typeof WeakMap!="function")return null;var ar=new WeakMap,vt=new WeakMap;return(O=function(Ot){return Ot?vt:ar})(Dt)}function z(Dt,ar){if(Dt&&Dt.__esModule)return Dt;if(Dt===null||p(Dt)!=="object"&&typeof Dt!="function")return{default:Dt};var vt=O(ar);if(vt&&vt.has(Dt))return vt.get(Dt);var Pt={},Ot=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var lr in Dt)if(lr!=="default"&&Object.prototype.hasOwnProperty.call(Dt,lr)){var Se=Ot?Object.getOwnPropertyDescriptor(Dt,lr):null;Se&&(Se.get||Se.set)?Object.defineProperty(Pt,lr,Se):Pt[lr]=Dt[lr]}return Pt.default=Dt,vt&&vt.set(Dt,Pt),Pt}function U(Dt){return function(ar){var vt=E.default.createPoint(Dt,{id:"origin","marker-symbol":"A"});ar({type:b.ORIGIN,origin:vt}),ar(pr("origin",{feature:vt}))}}function H(Dt){return function(ar){var vt=E.default.createPoint(Dt,{id:"destination","marker-symbol":"B"});ar({type:b.DESTINATION,destination:vt}),ar(pr("destination",{feature:vt}))}}function Y(Dt){return function(ar){ar({type:b.DIRECTIONS_REQUEST_START,request:Dt})}}function Q(Dt){return function(ar){ar({type:b.DIRECTIONS,directions:Dt}),ar(pr("route",{route:Dt}))}}function ge(Dt){return{type:b.WAYPOINTS,waypoints:Dt}}function ye(Dt){return{type:b.HOVER_MARKER,hoverMarker:Dt}}function ke(){return function(Dt,ar){var vt=ar(),Pt=vt.api,Ot=vt.accessToken,lr=vt.routeIndex,Se=vt.profile,Kt=vt.alternatives,Fe=vt.congestion,$e=vt.destination,We=vt.language,zt=vt.exclude,$t=vt.fetchDirectionsRequest;if($e&&$e.geometry){$t&&$t.abort();var _r=he(ar),Wt=[];Wt.push("geometries=polyline"),Kt&&Wt.push("alternatives=true"),Fe&&Wt.push("annotations=congestion"),Wt.push("steps=true"),Wt.push("overview=full"),We&&Wt.push("language="+We),zt&&Wt.push("exclude="+zt),Ot&&Wt.push("access_token="+Ot);var mr=new XMLHttpRequest;mr.open("GET","".concat(Pt).concat(Se,"/").concat(_r,".json?").concat(Wt.join("&")),!0),Dt(Y(mr)),mr.onload=function(){if(mr.status>=200&&mr.status<400){var Tr=JSON.parse(mr.responseText);if(Tr.error)return Dt(Q([])),Dt(ve(Tr.error));if(Tr.message==="No route found")return Dt(ve("No route found"));Dt(ve(null)),Tr.routes[lr]||Dt(we(0)),Dt(Q(Tr.routes)),Dt(U(Tr.waypoints[0].location)),Dt(H(Tr.waypoints[Tr.waypoints.length-1].location))}else return Dt(Q([])),Dt(ve(JSON.parse(mr.responseText).message))},mr.onerror=function(){return Dt(Q([])),mr.responseText?Dt(ve(JSON.parse(mr.responseText).message)):Dt(ve("Error"))},mr.send()}}}function he(Dt){var ar=Dt(),vt=ar.origin,Pt=ar.destination,Ot=ar.waypoints,lr=[];return lr.push(vt.geometry.coordinates.join(",")),lr.push(";"),Ot.length&&Ot.forEach(function(Se){lr.push(Se.geometry.coordinates.join(",")),lr.push(";")}),lr.push(Pt.geometry.coordinates.join(",")),encodeURIComponent(lr.join(""))}function oe(Dt){var ar={id:"waypoint"};return Object.assign(Dt,{properties:Dt.properties?Object.assign(Dt.properties,ar):ar})}function ve(Dt){return function(ar){ar({type:"ERROR",error:Dt}),Dt&&ar(pr("error",{error:Dt}))}}function be(Dt){return{type:b.ORIGIN_QUERY,query:Dt}}function ze(Dt){return{type:b.DESTINATION_QUERY,query:Dt}}function Te(Dt){return{type:b.ORIGIN_FROM_COORDINATES,coordinates:Dt}}function ie(Dt){return{type:b.DESTINATION_FROM_COORDINATES,coordinates:Dt}}function ne(){return function(Dt){Dt({type:b.ORIGIN_CLEAR}),Dt(pr("clear",{type:"origin"})),Dt(ve(null))}}function te(){return function(Dt,ar){var vt=ar(),Pt=vt.fetchDirectionsRequest;Pt&&Pt.abort(),Dt({type:b.DESTINATION_CLEAR}),Dt(pr("clear",{type:"destination"})),Dt(ve(null))}}function re(Dt){return{type:b.SET_OPTIONS,options:Dt}}function me(Dt){return function(ar){var vt=Dt?E.default.createPoint(Dt,{id:"hover"}):{};ar(ye(vt))}}function we(Dt){return{type:b.ROUTE_INDEX,routeIndex:Dt}}function tt(Dt){return function(ar,vt){var Pt=vt(),Ot=Pt.destination;ar(U(Dt)),Ot.geometry&&ar(ke())}}function Et(Dt){return function(ar,vt){var Pt=vt(),Ot=Pt.origin;ar(H(Dt)),Ot.geometry&&ar(ke())}}function ft(Dt){return function(ar,vt){var Pt=vt(),Ot=Pt.origin,lr=Pt.destination;ar({type:b.DIRECTIONS_PROFILE,profile:Dt}),ar(pr("profile",{profile:Dt})),Ot.geometry&&lr.geometry&&ar(ke())}}function rr(){return function(Dt,ar){var vt=ar();vt.destination.geometry&&Dt(U(vt.destination.geometry.coordinates)),vt.origin.geometry&&Dt(H(vt.origin.geometry.coordinates)),vt.origin.geometry&&vt.destination.geometry&&Dt(ke());for(var Pt=document.getElementsByClassName("suggestions"),Ot=0;Ot<Pt.length;Ot++)Pt[Ot].style.visibility="hidden"}}function or(Dt){return function(ar){if(E.default.validCoords(Dt)||(Dt=[E.default.wrap(Dt[0]),E.default.wrap(Dt[1])]),isNaN(Dt[0])&&isNaN(Dt[1]))return ar(ve(new Error("Coordinates are not valid")));ar(Te(Dt)),ar(tt(Dt))}}function Fr(Dt){return function(ar){if(E.default.validCoords(Dt)||(Dt=[E.default.wrap(Dt[0]),E.default.wrap(Dt[1])]),isNaN(Dt[0])&&isNaN(Dt[1]))return ar(ve(new Error("Coordinates are not valid")));ar(Et(Dt)),ar(ie(Dt))}}function gt(Dt,ar){return function(vt,Pt){var Ot=Pt(),lr=Ot.destination,Se=Ot.waypoints;Se.splice(Dt,0,oe(ar)),vt(ge(Se)),lr.geometry&&vt(ke())}}function jr(Dt,ar){return function(vt,Pt){var Ot=Pt(),lr=Ot.destination,Se=Ot.waypoints;Se[Dt]=oe(ar),vt(ge(Se)),lr.geometry&&vt(ke())}}function Ur(Dt){return function(ar,vt){var Pt=vt(),Ot=Pt.destination,lr=Pt.waypoints;lr=lr.filter(function(Se){return!E.default.coordinateMatch(Se,Dt)}),ar(ge(lr)),Ot.geometry&&ar(ke())}}function Xr(Dt,ar){return function(vt,Pt){var Ot=Pt(),lr=Ot.events;return lr[Dt]=lr[Dt]||[],lr[Dt].push(ar),{type:b.EVENTS,events:lr}}}function pr(Dt,ar){var vt=this;return function(Pt,Ot){var lr=Ot(),Se=lr.events;if(!Se[Dt])return{type:b.EVENTS,events:Se};for(var Kt=Se[Dt].slice(),Fe=0;Fe<Kt.length;Fe++)Kt[Fe].call(vt,ar)}}},{"../constants/action_types":26,"../utils":34}],26:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.WAYPOINTS=h.SET_OPTIONS=h.ROUTE_INDEX=h.ORIGIN_QUERY=h.ORIGIN_FROM_COORDINATES=h.ORIGIN_CLEAR=h.ORIGIN=h.HOVER_MARKER=h.EVENTS=h.ERROR=h.DIRECTIONS_REQUEST_START=h.DIRECTIONS_PROFILE=h.DIRECTIONS=h.DESTINATION_QUERY=h.DESTINATION_FROM_COORDINATES=h.DESTINATION_CLEAR=h.DESTINATION=void 0;var p="DESTINATION";h.DESTINATION=p;var b="DESTINATION_CLEAR";h.DESTINATION_CLEAR=b;var E="DESTINATION_QUERY";h.DESTINATION_QUERY=E;var o="DESTINATION_FROM_COORDINATES";h.DESTINATION_FROM_COORDINATES=o;var O="DIRECTIONS";h.DIRECTIONS=O;var z="DIRECTIONS_REQUEST_START";h.DIRECTIONS_REQUEST_START=z;var U="DIRECTIONS_PROFILE";h.DIRECTIONS_PROFILE=U;var H="EVENTS";h.EVENTS=H;var Y="ERROR";h.ERROR=Y;var Q="HOVER_MARKER";h.HOVER_MARKER=Q;var ge="ORIGIN";h.ORIGIN=ge;var ye="ORIGIN_CLEAR";h.ORIGIN_CLEAR=ye;var ke="ORIGIN_QUERY";h.ORIGIN_QUERY=ke;var he="ORIGIN_FROM_COORDINATES";h.ORIGIN_FROM_COORDINATES=he;var oe="ROUTE_INDEX";h.ROUTE_INDEX=oe;var ve="SET_OPTIONS";h.SET_OPTIONS=ve;var be="WAYPOINTS";h.WAYPOINTS=be},{}],27:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=O(r("suggestions")),b=O(r("lodash.debounce")),E=r("events"),o=O(r("../utils"));function O(ke){return ke&&ke.__esModule?ke:{default:ke}}function z(ke){"@babel/helpers - typeof";return z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(he){return typeof he}:function(he){return he&&typeof Symbol=="function"&&he.constructor===Symbol&&he!==Symbol.prototype?"symbol":typeof he},z(ke)}function U(ke,he){if(!(ke instanceof he))throw new TypeError("Cannot call a class as a function")}function H(ke,he){for(var oe=0;oe<he.length;oe++){var ve=he[oe];ve.enumerable=ve.enumerable||!1,ve.configurable=!0,"value"in ve&&(ve.writable=!0),Object.defineProperty(ke,Q(ve.key),ve)}}function Y(ke,he,oe){return he&&H(ke.prototype,he),Object.defineProperty(ke,"prototype",{writable:!1}),ke}function Q(ke){var he=ge(ke,"string");return z(he)==="symbol"?he:String(he)}function ge(ke,he){if(z(ke)!=="object"||ke===null)return ke;var oe=ke[Symbol.toPrimitive];if(oe!==void 0){var ve=oe.call(ke,he);if(z(ve)!=="object")return ve;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ke)}var ye=function(){function ke(he){U(this,ke),this._ev=new E.EventEmitter,this.options=he,this.api=he&&he.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return Y(ke,[{key:"onAdd",value:function(oe){this._map=oe,this.request=new XMLHttpRequest;var ve=document.createElement("div");ve.className="mapboxgl-ctrl-geocoder";var be=document.createElement("span");be.className="geocoder-icon geocoder-icon-search";var ze=this._inputEl=document.createElement("input");ze.type="text",ze.placeholder=this.options.placeholder,ze.addEventListener("keydown",(0,b.default)((function(te){if(!te.target.value)return this._clearEl.classList.remove("active");te.metaKey||[9,27,37,39,13,38,40].indexOf(te.keyCode)!==-1||this._queryFromInput(te.target.value)}).bind(this)),200),ze.addEventListener("change",(function(te){te.target.value&&this._clearEl.classList.add("active");var re=this._typeahead.selected;if(re){if(this.options.flyTo)if(re.bbox&&re.context&&re.context.length<=3||re.bbox&&!re.context){var me=re.bbox;oe.fitBounds([[me[0],me[1]],[me[2],me[3]]])}else oe.flyTo({center:re.center,zoom:this.options.zoom});this._input=re,this.fire("result",{result:re})}}).bind(this));var Te=document.createElement("div");Te.classList.add("geocoder-pin-right");var ie=this._clearEl=document.createElement("button");ie.className="geocoder-icon geocoder-icon-close",ie.addEventListener("click",this._clear.bind(this));var ne=this._loadingEl=document.createElement("span");return ne.className="geocoder-icon geocoder-icon-loading",Te.appendChild(ie),Te.appendChild(ne),ve.appendChild(be),ve.appendChild(ze),ve.appendChild(Te),this.options.container&&(this.options.position=!1),this._typeahead=new p.default(ze,[],{filter:!1}),this._typeahead.getItemValue=function(te){return te.place_name},ve}},{key:"_geocode",value:function(oe,ve){this._loadingEl.classList.add("active"),this.fire("loading");var be=this.options,ze=["placeholder","zoom","flyTo","accessToken","api"],Te=Object.keys(this.options).filter(function(ne){return ze.indexOf(ne)===-1}).map(function(ne){return ne+"="+be[ne]}),ie=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;Te.push("access_token="+ie),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(oe.trim())+".json?"+Te.join("&"),!0),this.request.onload=(function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var ne=JSON.parse(this.request.responseText);return ne.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:ne.features}),this._typeahead.update(ne.features),ve(ne.features)}else this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.onerror=(function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.send()}},{key:"_queryFromInput",value:function(oe){oe=oe.trim(),oe||this._clear(),oe.length>2&&this._geocode(oe,(function(ve){this._results=ve}).bind(this))}},{key:"_change",value:function(){var oe=document.createEvent("HTMLEvents");oe.initEvent("change",!0,!1),this._inputEl.dispatchEvent(oe)}},{key:"_query",value:function(oe){oe&&(z(oe)==="object"&&oe.length&&(oe=[o.default.wrap(oe[0]),o.default.wrap(oe[1])].join()),this._geocode(oe,(function(ve){if(ve.length){var be=ve[0];this._results=ve,this._typeahead.selected=be,this._inputEl.value=be.place_name,this._change()}}).bind(this)))}},{key:"_setInput",value:function(oe){oe&&(z(oe)==="object"&&oe.length&&(oe=[o.default.roundWithOriginalPrecision(o.default.wrap(oe[0]),oe[0]),o.default.roundWithOriginalPrecision(o.default.wrap(oe[1]),oe[1])].join()),this._inputEl.value=oe,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(oe){return this._query(oe),this}},{key:"setInput",value:function(oe){return this._setInput(oe),this}},{key:"on",value:function(oe,ve){return this._ev.on(oe,ve),this._ev.on("error",function(be){console.log(be)}),this}},{key:"fire",value:function(oe,ve){return this._ev.emit(oe,ve),this}},{key:"off",value:function(oe,ve){return this._ev.removeListener(oe,ve),this}}]),ke}();h.default=ye},{"../utils":34,events:7,"lodash.debounce":10,suggestions:19}],28:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=O(r("./geocoder")),b=O(r("lodash.template")),E=O(r("lodash.isequal")),o=O(r("turf-extent"));function O(he){return he&&he.__esModule?he:{default:he}}function z(he){"@babel/helpers - typeof";return z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe},z(he)}function U(he,oe){if(!(he instanceof oe))throw new TypeError("Cannot call a class as a function")}function H(he,oe){for(var ve=0;ve<oe.length;ve++){var be=oe[ve];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(he,Q(be.key),be)}}function Y(he,oe,ve){return oe&&H(he.prototype,oe),Object.defineProperty(he,"prototype",{writable:!1}),he}function Q(he){var oe=ge(he,"string");return z(oe)==="symbol"?oe:String(oe)}function ge(he,oe){if(z(he)!=="object"||he===null)return he;var ve=he[Symbol.toPrimitive];if(ve!==void 0){var be=ve.call(he,oe);if(z(be)!=="object")return be;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(he)}var ye=(0,b.default)(`<div class='mapbox-directions-component mapbox-directions-inputs'>
  <div class='mapbox-directions-component-keyline'>
    <div class='mapbox-directions-origin'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-depart'></span>
      </label>
      <div id='mapbox-directions-origin-input'></div>
    </div>

    <button
      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'
      title='Reverse origin &amp; destination'>
    </button>

    <div class='mapbox-directions-destination'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-arrive'></span>
      </label>
      <div id='mapbox-directions-destination-input'></div>
    </div>
  </div>

  <% if (controls.profileSwitcher) { %>
  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input
      id='mapbox-directions-profile-driving-traffic'
      type='radio'
      name='profile'
      value='mapbox/driving-traffic'
      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>
    <input
      id='mapbox-directions-profile-driving'
      type='radio'
      name='profile'
      value='mapbox/driving'
      <% if (profile === 'mapbox/driving') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving'>Driving</label>
    <input
      id='mapbox-directions-profile-walking'
      type='radio'
      name='profile'
      value='mapbox/walking'
      <% if (profile === 'mapbox/walking') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-walking'>Walking</label>
    <input
      id='mapbox-directions-profile-cycling'
      type='radio'
      name='profile'
      value='mapbox/cycling'
      <% if (profile === 'mapbox/cycling') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-cycling'>Cycling</label>
  </div>
  <% } %>
</div>
`),ke=function(){function he(oe,ve,be,ze){U(this,he);var Te=ve.getState(),ie=Te.originQuery,ne=Te.destinationQuery,te=Te.profile,re=Te.controls;oe.innerHTML=ye({originQuery:ie,destinationQuery:ne,profile:te,controls:re}),this.container=oe,this.actions=be,this.store=ve,this._map=ze,this.onAdd(),this.render()}return Y(he,[{key:"animateToCoordinates",value:function(ve,be){var ze=this.store.getState(),Te=ze.origin,ie=ze.destination,ne=ze.routePadding;if(Te.geometry&&ie.geometry&&!(0,E.default)(Te.geometry,ie.geometry)){var te=(0,o.default)({type:"FeatureCollection",features:[Te,ie]});this._map.fitBounds([[te[0],te[1]],[te[2],te[3]]],{padding:ne})}else this._map.flyTo({center:be})}},{key:"onAdd",value:function(){var ve=this,be=this.actions,ze=be.clearOrigin,Te=be.clearDestination,ie=be.createOrigin,ne=be.createDestination,te=be.setProfile,re=be.reverse,me=this.store.getState(),we=me.geocoder,tt=me.accessToken,Et=me.flyTo,ft=me.placeholderOrigin,rr=me.placeholderDestination,or=me.zoom;this.originInput=new p.default(Object.assign({},{accessToken:tt},we,{flyTo:Et,placeholder:ft,zoom:or}));var Fr=this.originInput.onAdd(this._map),gt=this.container.querySelector("#mapbox-directions-origin-input");gt.appendChild(Fr),this.destinationInput=new p.default(Object.assign({},{accessToken:tt},we,{flyTo:Et,placeholder:rr,zoom:or}));var jr=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(jr),this.originInput.on("result",function(Xr){var pr=Xr.result.center;ie(pr),ve.animateToCoordinates("origin",pr)}),this.originInput.on("clear",ze),this.destinationInput.on("result",function(Xr){var pr=Xr.result.center;ne(pr),ve.animateToCoordinates("destination",pr)}),this.destinationInput.on("clear",Te);var Ur=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Ur,function(Xr){Xr.addEventListener("change",function(){te(Xr.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var Xr=ve.store.getState(),pr=Xr.origin,Dt=Xr.destination;pr&&ve.actions.queryDestination(pr.geometry.coordinates),Dt&&ve.actions.queryOrigin(Dt.geometry.coordinates),re()})}},{key:"render",value:function(){var ve=this;this.store.subscribe(function(){var be=ve.store.getState(),ze=be.originQuery,Te=be.destinationQuery,ie=be.originQueryCoordinates,ne=be.destinationQueryCoordinates;ze&&(ve.originInput.query(ze),ve.actions.queryOrigin(null)),Te&&(ve.destinationInput.query(Te),ve.actions.queryDestination(null)),ie&&(ve.originInput.setInput(ie),ve.animateToCoordinates("origin",ie),ve.actions.queryOriginCoordinates(null)),ne&&(ve.destinationInput.setInput(ne),ve.animateToCoordinates("destination",ne),ve.actions.queryDestinationCoordinates(null))})}}]),he}();h.default=ke},{"./geocoder":27,"lodash.isequal":11,"lodash.template":12,"turf-extent":22}],29:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=o(r("../utils")),b=o(r("lodash.template")),E=o(r("lodash.isequal"));function o(he){return he&&he.__esModule?he:{default:he}}function O(he){"@babel/helpers - typeof";return O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe},O(he)}function z(he,oe){if(!(he instanceof oe))throw new TypeError("Cannot call a class as a function")}function U(he,oe){for(var ve=0;ve<oe.length;ve++){var be=oe[ve];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(he,Y(be.key),be)}}function H(he,oe,ve){return oe&&U(he.prototype,oe),Object.defineProperty(he,"prototype",{writable:!1}),he}function Y(he){var oe=Q(he,"string");return O(oe)==="symbol"?oe:String(oe)}function Q(he,oe){if(O(he)!=="object"||he===null)return he;var ve=he[Symbol.toPrimitive];if(ve!==void 0){var be=ve.call(he,oe);if(O(be)!=="object")return be;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(he)}var ge=(0,b.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>
    <% if (routes > 1) { %>
    <div class='mapbox-directions-routes mapbox-directions-clearfix'>
      <% for (var i = 0; i < routes; i++) { %>
        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>
        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>
      <% } %>
    </div>
    <% } %>
    <h1><%- duration %></h1>
    <span><%- distance %></span>
  </div>

  <div class='mapbox-directions-instructions'>
    <div class='mapbox-directions-instructions-wrapper'>
      <ol class='mapbox-directions-steps'>
        <% steps.forEach(function(step) { %>
          <%
            var distance = step.distance ? format(step.distance) : false;
            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();

            if (['arrive', 'depart', 'waypoint'].includes(step.maneuver.type)) {
              icon = step.maneuver.type;
            }

            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {
              icon = 'roundabout';
            }

            var lng = step.maneuver.location[0];
            var lat = step.maneuver.location[1];
          %>
          <li
            data-lat='<%= lat %>'
            data-lng='<%= lng %>'
            class='mapbox-directions-step'>
            <span class='directions-icon directions-icon-<%= icon %>'></span>
            <div class='mapbox-directions-step-maneuver'>
              <%= step.maneuver.instruction %>
            </div>
            <% if (distance) { %>
              <div class='mapbox-directions-step-distance'>
                <%= distance %>
              </div>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </div>
</div>
`),ye=(0,b.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-error'>
    <%= error %>
  </div>
</div>
`),ke=function(){function he(oe,ve,be,ze){z(this,he),this.container=oe,this.actions=be,this.store=ve,this._map=ze,this.directions={},this.render()}return H(he,[{key:"render",value:function(){var ve=this;this.store.subscribe(function(){var be=ve.actions,ze=be.hoverMarker,Te=be.setRouteIndex,ie=ve.store.getState(),ne=ie.routeIndex,te=ie.unit,re=ie.directions,me=ie.error,we=ie.compile,tt=ie.instructions,Et=!(0,E.default)(re[ne],ve.directions);if(me){ve.container.innerHTML=ye({error:me});return}var ft=tt.showWaypointInstructions?void 0:function(jr){return jr.maneuver.type!=="waypoint"};if(re.length&&Et){var rr=ve.directions=re[ne],or=p.default.getAllSteps(rr,ft);we&&rr.legs.forEach(function(jr){jr.steps.forEach(function(Ur){Ur.maneuver.instruction=we("en",Ur)})}),ve.container.innerHTML=ge({routeIndex:ne,routes:re.length,steps:or,format:p.default.format[te],duration:p.default.format.duration(rr.duration),distance:p.default.format[te](rr.distance)});var Fr=ve.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(Fr,function(jr){var Ur=jr.getAttribute("data-lng"),Xr=jr.getAttribute("data-lat");jr.addEventListener("mouseover",function(){ze([Ur,Xr])}),jr.addEventListener("mouseout",function(){ze(null)}),jr.addEventListener("click",function(){ve._map.flyTo({center:[Ur,Xr],zoom:16})})});var gt=ve.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(gt,function(jr){jr.addEventListener("change",function(Ur){Te(parseInt(Ur.target.id,10))})})}else ve.container.innerHTML&&Et&&(ve.container.innerHTML="")})}}]),he}();h.default=ke},{"../utils":34,"lodash.isequal":11,"lodash.template":12}],30:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=r("redux"),b=ye(r("redux-thunk")),E=r("@mapbox/polyline"),o=ye(r("./utils")),O=ye(r("./reducers")),z=ge(r("./actions")),U=ye(r("./directions_style")),H=ye(r("./controls/inputs")),Y=ye(r("./controls/instructions"));function Q(ie){if(typeof WeakMap!="function")return null;var ne=new WeakMap,te=new WeakMap;return(Q=function(me){return me?te:ne})(ie)}function ge(ie,ne){if(ie&&ie.__esModule)return ie;if(ie===null||ke(ie)!=="object"&&typeof ie!="function")return{default:ie};var te=Q(ne);if(te&&te.has(ie))return te.get(ie);var re={},me=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var we in ie)if(we!=="default"&&Object.prototype.hasOwnProperty.call(ie,we)){var tt=me?Object.getOwnPropertyDescriptor(ie,we):null;tt&&(tt.get||tt.set)?Object.defineProperty(re,we,tt):re[we]=ie[we]}return re.default=ie,te&&te.set(ie,re),re}function ye(ie){return ie&&ie.__esModule?ie:{default:ie}}function ke(ie){"@babel/helpers - typeof";return ke=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ne){return typeof ne}:function(ne){return ne&&typeof Symbol=="function"&&ne.constructor===Symbol&&ne!==Symbol.prototype?"symbol":typeof ne},ke(ie)}function he(ie,ne){if(!(ie instanceof ne))throw new TypeError("Cannot call a class as a function")}function oe(ie,ne){for(var te=0;te<ne.length;te++){var re=ne[te];re.enumerable=re.enumerable||!1,re.configurable=!0,"value"in re&&(re.writable=!0),Object.defineProperty(ie,be(re.key),re)}}function ve(ie,ne,te){return ne&&oe(ie.prototype,ne),Object.defineProperty(ie,"prototype",{writable:!1}),ie}function be(ie){var ne=ze(ie,"string");return ke(ne)==="symbol"?ne:String(ne)}function ze(ie,ne){if(ke(ie)!=="object"||ie===null)return ie;var te=ie[Symbol.toPrimitive];if(te!==void 0){var re=te.call(ie,ne);if(ke(re)!=="object")return re;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ie)}var Te=function(){function ie(ne){he(this,ie),this._directions=null,this._stateSnapshot=null,this._store=this._initStore(),this.actions=(0,p.bindActionCreators)(z,this._store.dispatch),this.actions.setOptions(ne||{}),this.options=ne||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return ve(ie,[{key:"onAdd",value:function(te){var re=this;this._map=te;var me=this._store.getState(),we=me.controls,tt=this.container=document.createElement("div");tt.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var Et=document.createElement("div");Et.className="directions-control directions-control-inputs",new H.default(Et,this._store,this.actions,this._map);var ft=document.createElement("div");return ft.className="directions-control directions-control-instructions",new Y.default(ft,this._store,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),we.inputs&&tt.appendChild(Et),we.instructions&&tt.appendChild(ft),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return re.mapState()}),tt}},{key:"onRemove",value:function(te){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),te.off("mousedown",this.onDragDown),te.off("mousemove",this.move),te.off("touchstart",this.onDragDown),te.off("touchstart",this.move),te.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),U.default.forEach(function(re){te.getLayer(re.id)&&te.removeLayer(re.id)}),te.getSource("directions")&&te.removeSource("directions"),te.getSource("directions:markers")&&te.removeSource("directions:markers"),this._map=null,this}},{key:"mapState",value:function(){var te=this,re=this._store.getState(),me=re.profile;re.alternatives,re.congestion;var we=re.styles,tt=re.interactive;re.compile,this.actions.eventEmit("profile",{profile:me});var Et={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._map.addSource("directions",Et),this._map.addSource("directions:markers",Et),we&&we.length&&we.forEach(function(ft){return te._map.addLayer(ft)}),U.default.forEach(function(ft){te._map.getLayer(ft.id)||te._map.addLayer(ft)}),tt&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"_areMarkersChangedOnly",value:function(te){var re=this,me=[];return this._stateSnapshot?(ie.SUBSCRIPTION_FIELDS.forEach(function(we){re._stateSnapshot[we]!==te[we]&&me.push(we)}),me.length<=ie.MARKER_FIELDS.length&&me.every(function(we){return ie.MARKER_FIELDS.includes(we)})):!1}},{key:"subscribedActions",value:function(){var te=this;this.storeUnsubscribe=this._store.subscribe(function(){var re=te._store.getState(),me=re.origin,we=re.destination,tt=re.hoverMarker,Et=re.directions,ft=re.routeIndex,rr=te._areMarkersChangedOnly(re);te._stateSnapshot=re;var or={type:"FeatureCollection",features:[me,we,tt].filter(function(gt){return gt.geometry})};if(te._map.style&&te._map.getSource("directions:markers")&&te._map.getSource("directions:markers").setData(or),!rr){var Fr={type:"FeatureCollection",features:[]};Et.length&&Et.forEach(function(gt,jr){var Ur=[],Xr=(0,E.decode)(gt.geometry,5).map(function(Dt){return Dt.reverse()}),pr=o.default.getAllSteps(gt);Xr.forEach(function(Dt,ar){var vt=Ur[Ur.length-1],Pt=gt.legs[0].annotation&&gt.legs[0].annotation.congestion&&gt.legs[0].annotation.congestion[ar-1];if(vt&&(!Pt||vt.properties.congestion===Pt))vt.geometry.coordinates.push(Dt);else{var Ot={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":jr,route:jr===ft?"selected":"alternate"}};vt&&Ot.geometry.coordinates.push(vt.geometry.coordinates[vt.geometry.coordinates.length-1]),Ot.geometry.coordinates.push(Dt),Pt&&(Ot.properties.congestion=gt.legs[0].annotation.congestion[ar-1]),Ur.push(Ot)}}),Fr.features=Fr.features.concat(Ur),jr===ft&&pr.forEach(function(Dt){Dt.maneuver.type==="waypoint"&&Fr.features.push({type:"Feature",geometry:{type:"Point",coordinates:Dt.maneuver.location},properties:{id:"waypoint"}})})}),te._map.style&&te._map.getSource("directions")&&te._map.getSource("directions").setData(Fr)}})}},{key:"_initStore",value:function(){var te=(0,p.applyMiddleware)(b.default)(p.createStore);return te(O.default)}},{key:"_clickHandler",value:function(){var te=null,re=250;return function(me){if(te)clearTimeout(te),te=null,this._map.zoomIn();else{var we=this._onSingleClick.bind(this);te=setTimeout(function(){we(me),te=null},re)}}}},{key:"_onSingleClick",value:function(te){var re=this,me=this._store.getState(),we=me.origin,tt=[te.lngLat.lng,te.lngLat.lat];if(!we.geometry)this.actions.setOriginFromCoordinates(tt);else{var Et=this._map.queryRenderedFeatures(te.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});if(Et.length){if(Et.forEach(function(rr){rr.layer.id==="directions-waypoint-point"&&re.actions.removeWaypoint(rr)}),Et[0].properties.route==="alternate"){var ft=Et[0].properties["route-index"];this.actions.setRouteIndex(ft)}}else this.actions.setDestinationFromCoordinates(tt),this._map.flyTo({center:tt})}}},{key:"_move",value:function(te){var re=this,me=this._store.getState(),we=me.hoverMarker,tt=this._map.queryRenderedFeatures(te.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=tt.length?"pointer":"",tt.length?(this.isCursorOverPoint=tt[0],this._map.dragPan.disable(),tt.forEach(function(Et){Et.layer.id==="directions-route-line"?re.actions.hoverMarker([te.lngLat.lng,te.lngLat.lat]):we.geometry&&re.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){this.isCursorOverPoint&&(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(te){if(this.isDragging){var re=[te.lngLat.lng,te.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(re);break;case"directions-destination-point":this.actions.createDestination(re);break;case"directions-hover-point":this.actions.hoverMarker(re);break}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var te=this._store.getState(),re=te.hoverMarker,me=te.origin,we=te.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(me.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(we.geometry.coordinates);break;case"directions-hover-point":re.geometry&&!o.default.coordinateMatch(this.isDragging,re)&&this.actions.addWaypoint(0,re);break}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(te){return te?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return this._store.getState().origin}},{key:"setOrigin",value:function(te){return typeof te=="string"?this.actions.queryOrigin(te):this.actions.setOriginFromCoordinates(te),this}},{key:"getDestination",value:function(){return this._store.getState().destination}},{key:"setDestination",value:function(te){return typeof te=="string"?this.actions.queryDestination(te):this.actions.setDestinationFromCoordinates(te),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(te,re){return re.type||(re=o.default.createPoint(re,{id:"waypoint"})),this.actions.addWaypoint(te,re),this}},{key:"setWaypoint",value:function(te,re){return re.type||(re=o.default.createPoint(re,{id:"waypoint"})),this.actions.setWaypoint(te,re),this}},{key:"removeWaypoint",value:function(te){var re=this._store.getState(),me=re.waypoints;return this.actions.removeWaypoint(me[te]),this}},{key:"getWaypoints",value:function(){return this._store.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(te,re){return this.actions.eventSubscribe(te,re),this}}]),ie}();h.default=Te,Te.MARKER_FIELDS=["origin","destination","hoverMarker"],Te.SUBSCRIPTION_FIELDS=["origin","destination","hovedMarker","directions","routeIndex"]},{"./actions":25,"./controls/inputs":28,"./controls/instructions":29,"./directions_style":31,"./reducers":33,"./utils":34,"@mapbox/polyline":6,redux:18,"redux-thunk":17}],31:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var p=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions:markers",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions:markers",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}],b=p;h.default=b},{}],32:[function(r,s,h){var p=b(r("./directions"));function b(E){return E&&E.__esModule?E:{default:E}}s.exports=p.default},{"./directions":30}],33:[function(r,s,h){function p(Q){"@babel/helpers - typeof";return p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ge){return typeof ge}:function(ge){return ge&&typeof Symbol=="function"&&ge.constructor===Symbol&&ge!==Symbol.prototype?"symbol":typeof ge},p(Q)}Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var b=z(r("../constants/action_types.js")),E=o(r("merge-options"));function o(Q){return Q&&Q.__esModule?Q:{default:Q}}function O(Q){if(typeof WeakMap!="function")return null;var ge=new WeakMap,ye=new WeakMap;return(O=function(he){return he?ye:ge})(Q)}function z(Q,ge){if(Q&&Q.__esModule)return Q;if(Q===null||p(Q)!=="object"&&typeof Q!="function")return{default:Q};var ye=O(ge);if(ye&&ye.has(Q))return ye.get(Q);var ke={},he=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var oe in Q)if(oe!=="default"&&Object.prototype.hasOwnProperty.call(Q,oe)){var ve=he?Object.getOwnPropertyDescriptor(Q,oe):null;ve&&(ve.get||ve.set)?Object.defineProperty(ke,oe,ve):ke[oe]=Q[oe]}return ke.default=Q,ye&&ye.set(Q,ke),ke}var U=function(){return{api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},instructions:{showWaypointInstructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],fetchDirectionsRequest:null,routeIndex:0,routePadding:80}};function H(){var Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U(),ge=arguments.length>1?arguments[1]:void 0;switch(ge.type){case b.SET_OPTIONS:return(0,E.default)({},Q,ge.options);case b.DIRECTIONS_PROFILE:return Object.assign({},Q,{profile:ge.profile});case b.ORIGIN:return Object.assign({},Q,{origin:ge.origin,hoverMarker:{}});case b.DESTINATION:return Object.assign({},Q,{destination:ge.destination,hoverMarker:{}});case b.HOVER_MARKER:return Object.assign({},Q,{hoverMarker:ge.hoverMarker});case b.WAYPOINTS:return Object.assign({},Q,{waypoints:ge.waypoints});case b.ORIGIN_QUERY:return Object.assign({},Q,{originQuery:ge.query});case b.DESTINATION_QUERY:return Object.assign({},Q,{destinationQuery:ge.query});case b.ORIGIN_FROM_COORDINATES:return Object.assign({},Q,{originQueryCoordinates:ge.coordinates});case b.DESTINATION_FROM_COORDINATES:return Object.assign({},Q,{destinationQueryCoordinates:ge.coordinates});case b.ORIGIN_CLEAR:return Object.assign({},Q,{origin:{},originQuery:"",waypoints:[],directions:[]});case b.DESTINATION_CLEAR:return Object.assign({},Q,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case b.DIRECTIONS_REQUEST_START:return Object.assign({},Q,{fetchDirectionsRequest:ge.request});case b.DIRECTIONS:return Object.assign({},Q,{directions:ge.directions,fetchDirectionsRequest:null});case b.ROUTE_INDEX:return Object.assign({},Q,{routeIndex:ge.routeIndex});case b.ERROR:return Object.assign({},Q,{error:ge.error});default:return Q}}var Y=H;h.default=Y},{"../constants/action_types.js":26,"merge-options":14}],34:[function(r,s,h){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;function p(Y){return Y[0]>=-180&&Y[0]<=180&&Y[1]>=-90&&Y[1]<=90}function b(Y,Q){return Y=Y.geometry.coordinates,Q=Q.geometry.coordinates,Y.join()===Q.join()||Y[0].toFixed(3)===Q[0].toFixed(3)&&Y[1].toFixed(3)===Q[1].toFixed(3)}function E(Y){var Q=360,ge=((Y- -180)%Q+Q)%Q+-180;return ge===-180?180:ge}function o(Y,Q){var ge=0;return Math.floor(Q)!==Q&&(ge=Q.toString().split(".")[1].length),Y.toFixed(Math.min(ge,5))}function O(Y,Q){return{type:"Feature",geometry:{type:"Point",coordinates:Y},properties:Q||{}}}function z(Y,Q){return Y.legs.reduce(function(ge,ye,ke){ke>0&&(ge[ge.length-1].maneuver.type="waypoint",ye.steps[0].maneuver.type="");var he=ge.concat(ye.steps);return Q?he.filter(Q):he},[])}var U={duration:function(Q){var ge=Math.floor(Q/60),ye=Math.floor(ge/60);return Q%=60,ge%=60,ye===0&&ge===0?Q+"s":ye===0?ge+"min":ye+"h "+ge+"min"},imperial:function(Q){var ge=Q/1609.344;return ge>=100?ge.toFixed(0)+"mi":ge>=10?ge.toFixed(1)+"mi":ge>=.1?ge.toFixed(2)+"mi":(ge*5280).toFixed(0)+"ft"},metric:function(Q){return Q>=1e5?(Q/1e3).toFixed(0)+"km":Q>=1e4?(Q/1e3).toFixed(1)+"km":Q>=100?(Q/1e3).toFixed(2)+"km":Q.toFixed(0)+"m"}},H={format:U,coordinateMatch:b,createPoint:O,validCoords:p,wrap:E,roundWithOriginalPrecision:o,getAllSteps:z};h.default=H},{}]},{},[32])(32)})})(VD);var G3=VD.exports;const q3=ub(G3),Cl=(t,e)=>{const r=t.__vccOpts||t;for(const[s,h]of e)r[s]=h;return r},H3=t=>(xu("data-v-dedb6751"),t=t(),wu(),t),W3={class:"page-container"},Z3={class:"content-wrapper"},K3={class:"top-section"},X3=["src","alt"],Y3={class:"bottom-section"},J3=H3(()=>ct("h1",null,"Find Nearby Hospitals",-1)),GR="pk.eyJ1IjoienFpYTAwMjIiLCJhIjoiY20yNnp1MDduMHFibjJrcHp4NzlsNXQwYSJ9.vyeXz5N4tw9jkXUdxAIySg",Q3={__name:"HomeView",setup(t){const e=Qr([{src:X6,alt:"Image 1"},{src:Y6,alt:"Image 2"},{src:J6,alt:"Image 3"}]),r={loop:!0,autoplay:{delay:500,disableOnInteraction:!1},pagination:{clickable:!0},navigation:!0},s=Qr(null),h=Qr(null),p=Qr(null),b=Qr(null);Yu.accessToken=GR,ic(()=>{E()});const E=()=>{h.value=new Yu.Map({container:s.value,style:"mapbox://styles/mapbox/streets-v11",center:[0,0],zoom:2}),h.value.addControl(new Yu.NavigationControl);const O=new Yu.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0});h.value.addControl(O);const z=new $3({accessToken:Yu.accessToken,mapboxgl:Yu,marker:{color:"#0078A8"},placeholder:"Search for a location",bbox:[-180,-90,180,90],types:"address,poi"});h.value.addControl(z,"top-left"),z.on("result",H=>{const{result:Y}=H,Q=Y.geometry.coordinates;h.value.getSource("search-result")?h.value.getSource("search-result").setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:Q}}]}):(h.value.addSource("search-result",{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:Q}}]}}),h.value.addLayer({id:"search-result",type:"circle",source:"search-result",paint:{"circle-radius":10,"circle-color":"#0078A8"}})),h.value.flyTo({center:Q,zoom:14})}),b.value=new q3({accessToken:Yu.accessToken,unit:"metric",profile:"mapbox/driving",controls:{inputs:!0,instructions:!0}}),h.value.addControl(b.value,"top-left");class U{onAdd(Y){return this._map=Y,this._container=document.createElement("div"),this._container.className="mapboxgl-ctrl mapboxgl-ctrl-group",this._container.innerHTML='<button class="mapboxgl-ctrl-icon" type="button" title="Find Nearby Hospitals"><span class="mapboxgl-ctrl-icon" aria-hidden="true">🏥</span></button>',this._container.onclick=o,this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}}h.value.addControl(new U,"top-right"),h.value.on("load",()=>{O.trigger()}),O.on("geolocate",H=>{p.value=[H.coords.longitude,H.coords.latitude]})},o=async()=>{if(!p.value){alert("User location not available. Please allow location access.");return}const[O,z]=p.value,H=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/hospital.json?access_token=${GR}&proximity=${O},${z}&limit=5`)).json();h.value.getLayer("nearby-hospitals")&&h.value.removeLayer("nearby-hospitals"),h.value.getSource("nearby-hospitals")&&h.value.removeSource("nearby-hospitals"),h.value.addSource("nearby-hospitals",{type:"geojson",data:{type:"FeatureCollection",features:H.features.map(Q=>({type:"Feature",geometry:{type:"Point",coordinates:Q.center},properties:{title:Q.text,description:Q.place_name}}))}}),h.value.addLayer({id:"nearby-hospitals",type:"symbol",source:"nearby-hospitals",layout:{"icon-image":"hospital-15","icon-allow-overlap":!0,"text-field":["get","title"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,.6],"text-anchor":"top"}}),h.value.on("click","nearby-hospitals",Q=>{const ge=Q.features[0].geometry.coordinates.slice(),{title:ye,description:ke}=Q.features[0].properties;new Yu.Popup().setLngLat(ge).setHTML(`<h3>${ye}</h3><p>${ke}</p><button onclick="setDestination('${ke}', [${ge}])">Navigate Here</button>`).addTo(h.value)});const Y=new Yu.LngLatBounds;H.features.forEach(Q=>Y.extend(Q.center)),h.value.fitBounds(Y,{padding:50})};return window.setDestination=(O,z)=>{b.value.setOrigin(p.value),b.value.setDestination(z)},(O,z)=>(sn(),Sn("div",W3,[ct("div",Z3,[ct("div",K3,[Un(Ws(Sj),{options:r,class:"swiper"},{default:sl(()=>[(sn(!0),Sn(ts,null,Gf(e.value,(U,H)=>(sn(),Oc(Ws(Ij),{key:H},{default:sl(()=>[ct("img",{src:U.src,alt:U.alt},null,8,X3)]),_:2},1024))),128))]),_:1})]),ct("div",Y3,[J3,ct("div",{id:"map",ref_key:"mapContainer",ref:s,class:"map-container"},null,512),ct("div",{class:"map-controls"},[ct("button",{onClick:o},"Find Nearby Hospitals")])])])]))}},e8=Cl(Q3,[["__scopeId","data-v-dedb6751"]]),t8="/FIT5032-SoulClam/assets/couple-looking-outward-e0tMGow9.svg",r8="About Soul Calm",n8="For more than 20 years, people in Australia have placed their trust in Soul Calm as a reliable source of mental health information, support, and hope.",i8="We are one of Australia's most well-known, trusted, and visited mental health organisations. We never take this for granted. With it comes a deep responsibility to listen, to understand people's needs and aspirations, and to ensure they are at the heart of everything we do.",o8="We are a big blue door for many in the community: a safe and reliable place for millions of people to access information, advice and support – whether they're well and want to stay that way, unsettled or struggling and need support, or in recovery and want to reconnect.",s8={title:r8,description:n8,description1:i8,description2:o8},a8=t=>(xu("data-v-5d86da75"),t=t(),wu(),t),l8={class:"about-container"},c8={class:"blue-container"},u8={class:"about-content"},h8={class:"text-section"},d8=a8(()=>ct("div",{class:"image-section"},[ct("img",{src:t8,alt:"Couple looking outward"})],-1)),f8={class:"white-container"},p8={class:"about-content"},m8={class:"text-section"},g8={__name:"AboutView",setup(t){const e=Qr({});ic(()=>{r()});const r=()=>{e.value=s8};return(s,h)=>(sn(),Sn("div",l8,[ct("div",c8,[ct("div",u8,[ct("div",h8,[ct("h1",null,Ii(e.value.title),1),ct("p",null,Ii(e.value.description),1)]),d8])]),ct("div",f8,[ct("div",p8,[ct("div",m8,[ct("p",null,Ii(e.value.description1),1),ct("p",null,Ii(e.value.description2),1)])])])]))}},_8=Cl(g8,[["__scopeId","data-v-5d86da75"]]),y8={class:"container"},v8=ct("h1",{class:"text-center"},"Community",-1),b8=ct("p",{class:"text-center"},"Welcome to the community page!",-1),x8=[v8,b8],w8={__name:"CommunityView",setup(t){return(e,r)=>(sn(),Sn("div",y8,x8))}},T8="/FIT5032-SoulClam/assets/coach-BR_Rtpvw.svg",E8="/FIT5032-SoulClam/assets/professional-tnrFklQt.svg",Jm=t=>(xu("data-v-11e1c68e"),t=t(),wu(),t),S8={class:"help-container"},I8={class:"help-card"},A8=Jm(()=>ct("div",{class:"help-card-image"},[ct("img",{src:T8,alt:"Mental Health Coach"})],-1)),C8={class:"help-card-content"},R8=Jm(()=>ct("h2",null,"Get 6 free sessions with a mental health coach",-1)),P8=Jm(()=>ct("p",null," Stressed or overwhelmed about everyday life issues? Our NewAccess mental health coaching program may be right for you if you're not currently seeing a psychologist or psychiatrist. ",-1)),M8={class:"help-card"},k8=Jm(()=>ct("div",{class:"help-card-image"},[ct("img",{src:E8,alt:"Mental Health Professional"})],-1)),O8={class:"help-card-content"},D8=Jm(()=>ct("h2",null,"Find a mental health professional",-1)),L8=Jm(()=>ct("p",null," Looking for ongoing mental health services? We explain what different mental health professionals do and how to find one near you. ",-1)),B8={__name:"HelpView",setup(t){const e=K6(),r=s=>{e.push({name:s})};return(s,h)=>(sn(),Sn("div",S8,[ct("div",I8,[A8,ct("div",C8,[R8,P8,ct("button",{class:"help-card-button",onClick:h[0]||(h[0]=p=>r("GetMentalHealthCoach"))}," Learn more about mental health coaching ")])]),ct("div",M8,[k8,ct("div",O8,[D8,L8,ct("button",{class:"help-card-button",onClick:h[1]||(h[1]=p=>r("GetMentalHealthProfessional"))}," Find a mental health professional ")])])]))}},z8=Cl(B8,[["__scopeId","data-v-11e1c68e"]]),N8={},F8={class:"container"},V8=ct("div",{class:"container"},[ct("div",null,[ct("h1",{class:"text-center"},"Involved"),ct("p",{class:"text-center mb-3"},"Welcome to the Involved page!")])],-1),U8=[V8];function j8(t,e){return sn(),Sn("div",F8,U8)}const $8=Cl(N8,[["render",j8]]),G8={},q8={class:"container"},H8=ct("div",{class:"container"},[ct("div",null,[ct("h1",{class:"text-center"},"Learn"),ct("p",{class:"text-center mb-3"},"Welcome to the Learn page!")])],-1),W8=[H8];function Z8(t,e){return sn(),Sn("div",q8,W8)}const K8=Cl(G8,[["render",Z8]]),X8={},Y8={class:"container"},J8=ct("div",{class:"container"},[ct("div",null,[ct("h1",{class:"text-center"},"News and Events"),ct("p",{class:"text-center mb-3"},"Welcome to the News and Events page!")])],-1),Q8=[J8];function eG(t,e){return sn(),Sn("div",Y8,Q8)}const tG=Cl(X8,[["render",eG]]);var qR={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=function(t){const e=[];let r=0;for(let s=0;s<t.length;s++){let h=t.charCodeAt(s);h<128?e[r++]=h:h<2048?(e[r++]=h>>6|192,e[r++]=h&63|128):(h&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(h=65536+((h&1023)<<10)+(t.charCodeAt(++s)&1023),e[r++]=h>>18|240,e[r++]=h>>12&63|128,e[r++]=h>>6&63|128,e[r++]=h&63|128):(e[r++]=h>>12|224,e[r++]=h>>6&63|128,e[r++]=h&63|128)}return e},rG=function(t){const e=[];let r=0,s=0;for(;r<t.length;){const h=t[r++];if(h<128)e[s++]=String.fromCharCode(h);else if(h>191&&h<224){const p=t[r++];e[s++]=String.fromCharCode((h&31)<<6|p&63)}else if(h>239&&h<365){const p=t[r++],b=t[r++],E=t[r++],o=((h&7)<<18|(p&63)<<12|(b&63)<<6|E&63)-65536;e[s++]=String.fromCharCode(55296+(o>>10)),e[s++]=String.fromCharCode(56320+(o&1023))}else{const p=t[r++],b=t[r++];e[s++]=String.fromCharCode((h&15)<<12|(p&63)<<6|b&63)}}return e.join("")},jD={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let h=0;h<t.length;h+=3){const p=t[h],b=h+1<t.length,E=b?t[h+1]:0,o=h+2<t.length,O=o?t[h+2]:0,z=p>>2,U=(p&3)<<4|E>>4;let H=(E&15)<<2|O>>6,Y=O&63;o||(Y=64,b||(H=64)),s.push(r[z],r[U],r[H],r[Y])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(UD(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):rG(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let h=0;h<t.length;){const p=r[t.charAt(h++)],E=h<t.length?r[t.charAt(h)]:0;++h;const O=h<t.length?r[t.charAt(h)]:64;++h;const U=h<t.length?r[t.charAt(h)]:64;if(++h,p==null||E==null||O==null||U==null)throw new nG;const H=p<<2|E>>4;if(s.push(H),O!==64){const Y=E<<4&240|O>>2;if(s.push(Y),U!==64){const Q=O<<6&192|U;s.push(Q)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class nG extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const iG=function(t){const e=UD(t);return jD.encodeByteArray(e,!0)},j0=function(t){return iG(t).replace(/\./g,"")},$D=function(t){try{return jD.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oG(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sG=()=>oG().__FIREBASE_DEFAULTS__,aG=()=>{if(typeof process>"u"||typeof qR>"u")return;const t=qR.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},lG=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&$D(t[1]);return e&&JSON.parse(e)},Rb=()=>{try{return sG()||aG()||lG()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},GD=t=>{var e,r;return(r=(e=Rb())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},cG=t=>{const e=GD(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),s]:[e.substring(0,r),s]},qD=()=>{var t;return(t=Rb())===null||t===void 0?void 0:t.config},HD=t=>{var e;return(e=Rb())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uG{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,s)=>{r?this.reject(r):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hG(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},s=e||"demo-project",h=t.iat||0,p=t.sub||t.user_id;if(!p)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const b=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:h,exp:h+3600,auth_time:h,sub:p,user_id:p,firebase:{sign_in_provider:"custom",identities:{}}},t);return[j0(JSON.stringify(r)),j0(JSON.stringify(b)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wa(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function dG(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wa())}function fG(){var t;const e=(t=Rb())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function pG(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function mG(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function gG(){const t=Wa();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function _G(){return!fG()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function yG(){try{return typeof indexedDB=="object"}catch{return!1}}function vG(){return new Promise((t,e)=>{try{let r=!0;const s="validate-browser-context-for-indexeddb-analytics-module",h=self.indexedDB.open(s);h.onsuccess=()=>{h.result.close(),r||self.indexedDB.deleteDatabase(s),t(!0)},h.onupgradeneeded=()=>{r=!1},h.onerror=()=>{var p;e(((p=h.error)===null||p===void 0?void 0:p.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bG="FirebaseError";class _h extends Error{constructor(e,r,s){super(r),this.code=e,this.customData=s,this.name=bG,Object.setPrototypeOf(this,_h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ty.prototype.create)}}class Ty{constructor(e,r,s){this.service=e,this.serviceName=r,this.errors=s}create(e,...r){const s=r[0]||{},h=`${this.service}/${e}`,p=this.errors[e],b=p?xG(p,s):"Error",E=`${this.serviceName}: ${b} (${h}).`;return new _h(h,E,s)}}function xG(t,e){return t.replace(wG,(r,s)=>{const h=e[s];return h!=null?String(h):`<${s}?>`})}const wG=/\{\$([^}]+)}/g;function TG(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function $0(t,e){if(t===e)return!0;const r=Object.keys(t),s=Object.keys(e);for(const h of r){if(!s.includes(h))return!1;const p=t[h],b=e[h];if(HR(p)&&HR(b)){if(!$0(p,b))return!1}else if(p!==b)return!1}for(const h of s)if(!r.includes(h))return!1;return!0}function HR(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ey(t){const e=[];for(const[r,s]of Object.entries(t))Array.isArray(s)?s.forEach(h=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(h))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function T_(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[h,p]=s.split("=");e[decodeURIComponent(h)]=decodeURIComponent(p)}}),e}function E_(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function EG(t,e){const r=new SG(t,e);return r.subscribe.bind(r)}class SG{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,s){let h;if(e===void 0&&r===void 0&&s===void 0)throw new Error("Missing Observer.");IG(e,["next","error","complete"])?h=e:h={next:e,error:r,complete:s},h.next===void 0&&(h.next=H1),h.error===void 0&&(h.error=H1),h.complete===void 0&&(h.complete=H1);const p=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?h.error(this.finalError):h.complete()}catch{}}),this.observers.push(h),p}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function IG(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function H1(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ra(t){return t&&t._delegate?t._delegate:t}class ep{constructor(e,r,s){this.name=e,this.instanceFactory=r,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lf="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AG{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const s=new uG;if(this.instancesDeferred.set(r,s),this.isInitialized(r)||this.shouldAutoInitialize())try{const h=this.getOrInitializeService({instanceIdentifier:r});h&&s.resolve(h)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),h=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(p){if(h)return null;throw p}else{if(h)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(RG(e))try{this.getOrInitializeService({instanceIdentifier:Lf})}catch{}for(const[r,s]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(r);try{const p=this.getOrInitializeService({instanceIdentifier:h});s.resolve(p)}catch{}}}}clearInstance(e=Lf){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Lf){return this.instances.has(e)}getOptions(e=Lf){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const h=this.getOrInitializeService({instanceIdentifier:s,options:r});for(const[p,b]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(p);s===E&&b.resolve(h)}return h}onInit(e,r){var s;const h=this.normalizeInstanceIdentifier(r),p=(s=this.onInitCallbacks.get(h))!==null&&s!==void 0?s:new Set;p.add(e),this.onInitCallbacks.set(h,p);const b=this.instances.get(h);return b&&e(b,h),()=>{p.delete(e)}}invokeOnInitCallbacks(e,r){const s=this.onInitCallbacks.get(r);if(s)for(const h of s)try{h(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:CG(e),options:r}),this.instances.set(e,s),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Lf){return this.component?this.component.multipleInstances?e:Lf:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function CG(t){return t===Lf?void 0:t}function RG(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PG{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new AG(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ui;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Ui||(Ui={}));const MG={debug:Ui.DEBUG,verbose:Ui.VERBOSE,info:Ui.INFO,warn:Ui.WARN,error:Ui.ERROR,silent:Ui.SILENT},kG=Ui.INFO,OG={[Ui.DEBUG]:"log",[Ui.VERBOSE]:"log",[Ui.INFO]:"info",[Ui.WARN]:"warn",[Ui.ERROR]:"error"},DG=(t,e,...r)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),h=OG[e];if(h)console[h](`[${s}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class iE{constructor(e){this.name=e,this._logLevel=kG,this._logHandler=DG,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ui))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?MG[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ui.DEBUG,...e),this._logHandler(this,Ui.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ui.VERBOSE,...e),this._logHandler(this,Ui.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ui.INFO,...e),this._logHandler(this,Ui.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ui.WARN,...e),this._logHandler(this,Ui.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ui.ERROR,...e),this._logHandler(this,Ui.ERROR,...e)}}const LG=(t,e)=>e.some(r=>t instanceof r);let WR,ZR;function BG(){return WR||(WR=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zG(){return ZR||(ZR=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const WD=new WeakMap,jw=new WeakMap,ZD=new WeakMap,W1=new WeakMap,oE=new WeakMap;function NG(t){const e=new Promise((r,s)=>{const h=()=>{t.removeEventListener("success",p),t.removeEventListener("error",b)},p=()=>{r(Rd(t.result)),h()},b=()=>{s(t.error),h()};t.addEventListener("success",p),t.addEventListener("error",b)});return e.then(r=>{r instanceof IDBCursor&&WD.set(r,t)}).catch(()=>{}),oE.set(e,t),e}function FG(t){if(jw.has(t))return;const e=new Promise((r,s)=>{const h=()=>{t.removeEventListener("complete",p),t.removeEventListener("error",b),t.removeEventListener("abort",b)},p=()=>{r(),h()},b=()=>{s(t.error||new DOMException("AbortError","AbortError")),h()};t.addEventListener("complete",p),t.addEventListener("error",b),t.addEventListener("abort",b)});jw.set(t,e)}let $w={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return jw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ZD.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Rd(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function VG(t){$w=t($w)}function UG(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const s=t.call(Z1(this),e,...r);return ZD.set(s,e.sort?e.sort():[e]),Rd(s)}:zG().includes(t)?function(...e){return t.apply(Z1(this),e),Rd(WD.get(this))}:function(...e){return Rd(t.apply(Z1(this),e))}}function jG(t){return typeof t=="function"?UG(t):(t instanceof IDBTransaction&&FG(t),LG(t,BG())?new Proxy(t,$w):t)}function Rd(t){if(t instanceof IDBRequest)return NG(t);if(W1.has(t))return W1.get(t);const e=jG(t);return e!==t&&(W1.set(t,e),oE.set(e,t)),e}const Z1=t=>oE.get(t);function $G(t,e,{blocked:r,upgrade:s,blocking:h,terminated:p}={}){const b=indexedDB.open(t,e),E=Rd(b);return s&&b.addEventListener("upgradeneeded",o=>{s(Rd(b.result),o.oldVersion,o.newVersion,Rd(b.transaction),o)}),r&&b.addEventListener("blocked",o=>r(o.oldVersion,o.newVersion,o)),E.then(o=>{p&&o.addEventListener("close",()=>p()),h&&o.addEventListener("versionchange",O=>h(O.oldVersion,O.newVersion,O))}).catch(()=>{}),E}const GG=["get","getKey","getAll","getAllKeys","count"],qG=["put","add","delete","clear"],K1=new Map;function KR(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(K1.get(e))return K1.get(e);const r=e.replace(/FromIndex$/,""),s=e!==r,h=qG.includes(r);if(!(r in(s?IDBIndex:IDBObjectStore).prototype)||!(h||GG.includes(r)))return;const p=async function(b,...E){const o=this.transaction(b,h?"readwrite":"readonly");let O=o.store;return s&&(O=O.index(E.shift())),(await Promise.all([O[r](...E),h&&o.done]))[0]};return K1.set(e,p),p}VG(t=>({...t,get:(e,r,s)=>KR(e,r)||t.get(e,r,s),has:(e,r)=>!!KR(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HG{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(WG(r)){const s=r.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(r=>r).join(" ")}}function WG(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Gw="@firebase/app",XR="0.10.10";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dh=new iE("@firebase/app"),ZG="@firebase/app-compat",KG="@firebase/analytics-compat",XG="@firebase/analytics",YG="@firebase/app-check-compat",JG="@firebase/app-check",QG="@firebase/auth",eq="@firebase/auth-compat",tq="@firebase/database",rq="@firebase/database-compat",nq="@firebase/functions",iq="@firebase/functions-compat",oq="@firebase/installations",sq="@firebase/installations-compat",aq="@firebase/messaging",lq="@firebase/messaging-compat",cq="@firebase/performance",uq="@firebase/performance-compat",hq="@firebase/remote-config",dq="@firebase/remote-config-compat",fq="@firebase/storage",pq="@firebase/storage-compat",mq="@firebase/firestore",gq="@firebase/vertexai-preview",_q="@firebase/firestore-compat",yq="firebase",vq="10.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qw="[DEFAULT]",bq={[Gw]:"fire-core",[ZG]:"fire-core-compat",[XG]:"fire-analytics",[KG]:"fire-analytics-compat",[JG]:"fire-app-check",[YG]:"fire-app-check-compat",[QG]:"fire-auth",[eq]:"fire-auth-compat",[tq]:"fire-rtdb",[rq]:"fire-rtdb-compat",[nq]:"fire-fn",[iq]:"fire-fn-compat",[oq]:"fire-iid",[sq]:"fire-iid-compat",[aq]:"fire-fcm",[lq]:"fire-fcm-compat",[cq]:"fire-perf",[uq]:"fire-perf-compat",[hq]:"fire-rc",[dq]:"fire-rc-compat",[fq]:"fire-gcs",[pq]:"fire-gcs-compat",[mq]:"fire-fst",[_q]:"fire-fst-compat",[gq]:"fire-vertex","fire-js":"fire-js",[yq]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0=new Map,xq=new Map,Hw=new Map;function YR(t,e){try{t.container.addComponent(e)}catch(r){dh.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function Nm(t){const e=t.name;if(Hw.has(e))return dh.debug(`There were multiple attempts to register component ${e}.`),!1;Hw.set(e,t);for(const r of G0.values())YR(r,t);for(const r of xq.values())YR(r,t);return!0}function sE(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}function du(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wq={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Pd=new Ty("app","Firebase",wq);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tq{constructor(e,r,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new ep("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Pd.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qm=vq;function KD(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:qw,automaticDataCollectionEnabled:!1},e),h=s.name;if(typeof h!="string"||!h)throw Pd.create("bad-app-name",{appName:String(h)});if(r||(r=qD()),!r)throw Pd.create("no-options");const p=G0.get(h);if(p){if($0(r,p.options)&&$0(s,p.config))return p;throw Pd.create("duplicate-app",{appName:h})}const b=new PG(h);for(const o of Hw.values())b.addComponent(o);const E=new Tq(r,s,b);return G0.set(h,E),E}function XD(t=qw){const e=G0.get(t);if(!e&&t===qw&&qD())return KD();if(!e)throw Pd.create("no-app",{appName:t});return e}function Md(t,e,r){var s;let h=(s=bq[t])!==null&&s!==void 0?s:t;r&&(h+=`-${r}`);const p=h.match(/\s|\//),b=e.match(/\s|\//);if(p||b){const E=[`Unable to register library "${h}" with version "${e}":`];p&&E.push(`library name "${h}" contains illegal characters (whitespace or "/")`),p&&b&&E.push("and"),b&&E.push(`version name "${e}" contains illegal characters (whitespace or "/")`),dh.warn(E.join(" "));return}Nm(new ep(`${h}-version`,()=>({library:h,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eq="firebase-heartbeat-database",Sq=1,Q_="firebase-heartbeat-store";let X1=null;function YD(){return X1||(X1=$G(Eq,Sq,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Q_)}catch(r){console.warn(r)}}}}).catch(t=>{throw Pd.create("idb-open",{originalErrorMessage:t.message})})),X1}async function Iq(t){try{const r=(await YD()).transaction(Q_),s=await r.objectStore(Q_).get(JD(t));return await r.done,s}catch(e){if(e instanceof _h)dh.warn(e.message);else{const r=Pd.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});dh.warn(r.message)}}}async function JR(t,e){try{const s=(await YD()).transaction(Q_,"readwrite");await s.objectStore(Q_).put(e,JD(t)),await s.done}catch(r){if(r instanceof _h)dh.warn(r.message);else{const s=Pd.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});dh.warn(s.message)}}}function JD(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aq=1024,Cq=30*24*60*60*1e3;class Rq{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new Mq(r),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,r;try{const h=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=QR();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(b=>b.date===p)?void 0:(this._heartbeatsCache.heartbeats.push({date:p,agent:h}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(b=>{const E=new Date(b.date).valueOf();return Date.now()-E<=Cq}),this._storage.overwrite(this._heartbeatsCache))}catch(s){dh.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=QR(),{heartbeatsToSend:s,unsentEntries:h}=Pq(this._heartbeatsCache.heartbeats),p=j0(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=r,h.length>0?(this._heartbeatsCache.heartbeats=h,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),p}catch(r){return dh.warn(r),""}}}function QR(){return new Date().toISOString().substring(0,10)}function Pq(t,e=Aq){const r=[];let s=t.slice();for(const h of t){const p=r.find(b=>b.agent===h.agent);if(p){if(p.dates.push(h.date),eP(r)>e){p.dates.pop();break}}else if(r.push({agent:h.agent,dates:[h.date]}),eP(r)>e){r.pop();break}s=s.slice(1)}return{heartbeatsToSend:r,unsentEntries:s}}class Mq{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return yG()?vG().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const r=await Iq(this.app);return r!=null&&r.heartbeats?r:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const h=await this.read();return JR(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:h.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const h=await this.read();return JR(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:h.lastSentHeartbeatDate,heartbeats:[...h.heartbeats,...e.heartbeats]})}else return}}function eP(t){return j0(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kq(t){Nm(new ep("platform-logger",e=>new HG(e),"PRIVATE")),Nm(new ep("heartbeat",e=>new Rq(e),"PRIVATE")),Md(Gw,XR,t),Md(Gw,XR,"esm2017"),Md("fire-js","")}kq("");var Oq="firebase",Dq="10.13.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Md(Oq,Dq,"app");function aE(t,e){var r={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var h=0,s=Object.getOwnPropertySymbols(t);h<s.length;h++)e.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(r[s[h]]=t[s[h]]);return r}function QD(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Lq=QD,eL=new Ty("auth","Firebase",QD());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0=new iE("@firebase/auth");function Bq(t,...e){q0.logLevel<=Ui.WARN&&q0.warn(`Auth (${Qm}): ${t}`,...e)}function p0(t,...e){q0.logLevel<=Ui.ERROR&&q0.error(`Auth (${Qm}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zc(t,...e){throw lE(t,...e)}function fu(t,...e){return lE(t,...e)}function tL(t,e,r){const s=Object.assign(Object.assign({},Lq()),{[e]:r});return new Ty("auth","Firebase",s).create(e,{appName:t.name})}function uh(t){return tL(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function lE(t,...e){if(typeof t!="string"){const r=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(r,...s)}return eL.create(t,...e)}function Fn(t,e,...r){if(!t)throw lE(e,...r)}function ih(t){const e="INTERNAL ASSERTION FAILED: "+t;throw p0(e),new Error(e)}function fh(t,e){t||ih(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ww(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function zq(){return tP()==="http:"||tP()==="https:"}function tP(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nq(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zq()||pG()||"connection"in navigator)?navigator.onLine:!0}function Fq(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sy{constructor(e,r){this.shortDelay=e,this.longDelay=r,fh(r>e,"Short delay should be less than long delay!"),this.isMobile=dG()||mG()}get(){return Nq()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cE(t,e){fh(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rL{static initialize(e,r,s){this.fetchImpl=e,r&&(this.headersImpl=r),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ih("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ih("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ih("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vq={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uq=new Sy(3e4,6e4);function Zd(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Kd(t,e,r,s,h={}){return nL(t,h,async()=>{let p={},b={};s&&(e==="GET"?b=s:p={body:JSON.stringify(s)});const E=Ey(Object.assign({key:t.config.apiKey},b)).slice(1),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/json",t.languageCode&&(o["X-Firebase-Locale"]=t.languageCode),rL.fetch()(iL(t,t.config.apiHost,r,E),Object.assign({method:e,headers:o,referrerPolicy:"no-referrer"},p))})}async function nL(t,e,r){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},Vq),e);try{const h=new $q(t),p=await Promise.race([r(),h.promise]);h.clearNetworkTimeout();const b=await p.json();if("needConfirmation"in b)throw n0(t,"account-exists-with-different-credential",b);if(p.ok&&!("errorMessage"in b))return b;{const E=p.ok?b.errorMessage:b.error.message,[o,O]=E.split(" : ");if(o==="FEDERATED_USER_ID_ALREADY_LINKED")throw n0(t,"credential-already-in-use",b);if(o==="EMAIL_EXISTS")throw n0(t,"email-already-in-use",b);if(o==="USER_DISABLED")throw n0(t,"user-disabled",b);const z=s[o]||o.toLowerCase().replace(/[_\s]+/g,"-");if(O)throw tL(t,z,O);zc(t,z)}}catch(h){if(h instanceof _h)throw h;zc(t,"network-request-failed",{message:String(h)})}}async function Iy(t,e,r,s,h={}){const p=await Kd(t,e,r,s,h);return"mfaPendingCredential"in p&&zc(t,"multi-factor-auth-required",{_serverResponse:p}),p}function iL(t,e,r,s){const h=`${e}${r}?${s}`;return t.config.emulator?cE(t.config,h):`${t.config.apiScheme}://${h}`}function jq(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class $q{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,s)=>{this.timer=setTimeout(()=>s(fu(this.auth,"network-request-failed")),Uq.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function n0(t,e,r){const s={appName:t.name};r.email&&(s.email=r.email),r.phoneNumber&&(s.phoneNumber=r.phoneNumber);const h=fu(t,e,s);return h.customData._tokenResponse=r,h}function rP(t){return t!==void 0&&t.enterprise!==void 0}class Gq{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return jq(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function qq(t,e){return Kd(t,"GET","/v2/recaptchaConfig",Zd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hq(t,e){return Kd(t,"POST","/v1/accounts:delete",e)}async function oL(t,e){return Kd(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z_(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Wq(t,e=!1){const r=Ra(t),s=await r.getIdToken(e),h=uE(s);Fn(h&&h.exp&&h.auth_time&&h.iat,r.auth,"internal-error");const p=typeof h.firebase=="object"?h.firebase:void 0,b=p==null?void 0:p.sign_in_provider;return{claims:h,token:s,authTime:z_(Y1(h.auth_time)),issuedAtTime:z_(Y1(h.iat)),expirationTime:z_(Y1(h.exp)),signInProvider:b||null,signInSecondFactor:(p==null?void 0:p.sign_in_second_factor)||null}}function Y1(t){return Number(t)*1e3}function uE(t){const[e,r,s]=t.split(".");if(e===void 0||r===void 0||s===void 0)return p0("JWT malformed, contained fewer than 3 sections"),null;try{const h=$D(r);return h?JSON.parse(h):(p0("Failed to decode base64 JWT payload"),null)}catch(h){return p0("Caught error parsing JWT payload as JSON",h==null?void 0:h.toString()),null}}function nP(t){const e=uE(t);return Fn(e,"internal-error"),Fn(typeof e.exp<"u","internal-error"),Fn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ey(t,e,r=!1){if(r)return e;try{return await e}catch(s){throw s instanceof _h&&Zq(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function Zq({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kq{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const h=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,h)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zw{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=z_(this.lastLoginAt),this.creationTime=z_(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H0(t){var e;const r=t.auth,s=await t.getIdToken(),h=await ey(t,oL(r,{idToken:s}));Fn(h==null?void 0:h.users.length,r,"internal-error");const p=h.users[0];t._notifyReloadListener(p);const b=!((e=p.providerUserInfo)===null||e===void 0)&&e.length?sL(p.providerUserInfo):[],E=Yq(t.providerData,b),o=t.isAnonymous,O=!(t.email&&p.passwordHash)&&!(E!=null&&E.length),z=o?O:!1,U={uid:p.localId,displayName:p.displayName||null,photoURL:p.photoUrl||null,email:p.email||null,emailVerified:p.emailVerified||!1,phoneNumber:p.phoneNumber||null,tenantId:p.tenantId||null,providerData:E,metadata:new Zw(p.createdAt,p.lastLoginAt),isAnonymous:z};Object.assign(t,U)}async function Xq(t){const e=Ra(t);await H0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Yq(t,e){return[...t.filter(s=>!e.some(h=>h.providerId===s.providerId)),...e]}function sL(t){return t.map(e=>{var{providerId:r}=e,s=aE(e,["providerId"]);return{providerId:r,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jq(t,e){const r=await nL(t,{},async()=>{const s=Ey({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:h,apiKey:p}=t.config,b=iL(t,h,"/v1/token",`key=${p}`),E=await t._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",rL.fetch()(b,{method:"POST",headers:E,body:s})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function Qq(t,e){return Kd(t,"POST","/v2/accounts:revokeToken",Zd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Fn(e.idToken,"internal-error"),Fn(typeof e.idToken<"u","internal-error"),Fn(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):nP(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}updateFromIdToken(e){Fn(e.length!==0,"internal-error");const r=nP(e);this.updateTokensAndExpiration(e,null,r)}async getToken(e,r=!1){return!r&&this.accessToken&&!this.isExpired?this.accessToken:(Fn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:s,refreshToken:h,expiresIn:p}=await Jq(e,r);this.updateTokensAndExpiration(s,h,Number(p))}updateTokensAndExpiration(e,r,s){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,r){const{refreshToken:s,accessToken:h,expirationTime:p}=r,b=new Am;return s&&(Fn(typeof s=="string","internal-error",{appName:e}),b.refreshToken=s),h&&(Fn(typeof h=="string","internal-error",{appName:e}),b.accessToken=h),p&&(Fn(typeof p=="number","internal-error",{appName:e}),b.expirationTime=p),b}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Am,this.toJSON())}_performRefresh(){return ih("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(t,e){Fn(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class oh{constructor(e){var{uid:r,auth:s,stsTokenManager:h}=e,p=aE(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Kq(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=s,this.stsTokenManager=h,this.accessToken=h.accessToken,this.displayName=p.displayName||null,this.email=p.email||null,this.emailVerified=p.emailVerified||!1,this.phoneNumber=p.phoneNumber||null,this.photoURL=p.photoURL||null,this.isAnonymous=p.isAnonymous||!1,this.tenantId=p.tenantId||null,this.providerData=p.providerData?[...p.providerData]:[],this.metadata=new Zw(p.createdAt||void 0,p.lastLoginAt||void 0)}async getIdToken(e){const r=await ey(this,this.stsTokenManager.getToken(this.auth,e));return Fn(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return Wq(this,e)}reload(){return Xq(this)}_assign(e){this!==e&&(Fn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new oh(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){Fn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),r&&await H0(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(du(this.auth.app))return Promise.reject(uh(this.auth));const e=await this.getIdToken();return await ey(this,Hq(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var s,h,p,b,E,o,O,z;const U=(s=r.displayName)!==null&&s!==void 0?s:void 0,H=(h=r.email)!==null&&h!==void 0?h:void 0,Y=(p=r.phoneNumber)!==null&&p!==void 0?p:void 0,Q=(b=r.photoURL)!==null&&b!==void 0?b:void 0,ge=(E=r.tenantId)!==null&&E!==void 0?E:void 0,ye=(o=r._redirectEventId)!==null&&o!==void 0?o:void 0,ke=(O=r.createdAt)!==null&&O!==void 0?O:void 0,he=(z=r.lastLoginAt)!==null&&z!==void 0?z:void 0,{uid:oe,emailVerified:ve,isAnonymous:be,providerData:ze,stsTokenManager:Te}=r;Fn(oe&&Te,e,"internal-error");const ie=Am.fromJSON(this.name,Te);Fn(typeof oe=="string",e,"internal-error"),dd(U,e.name),dd(H,e.name),Fn(typeof ve=="boolean",e,"internal-error"),Fn(typeof be=="boolean",e,"internal-error"),dd(Y,e.name),dd(Q,e.name),dd(ge,e.name),dd(ye,e.name),dd(ke,e.name),dd(he,e.name);const ne=new oh({uid:oe,auth:e,email:H,emailVerified:ve,displayName:U,isAnonymous:be,photoURL:Q,phoneNumber:Y,tenantId:ge,stsTokenManager:ie,createdAt:ke,lastLoginAt:he});return ze&&Array.isArray(ze)&&(ne.providerData=ze.map(te=>Object.assign({},te))),ye&&(ne._redirectEventId=ye),ne}static async _fromIdTokenResponse(e,r,s=!1){const h=new Am;h.updateFromServerResponse(r);const p=new oh({uid:r.localId,auth:e,stsTokenManager:h,isAnonymous:s});return await H0(p),p}static async _fromGetAccountInfoResponse(e,r,s){const h=r.users[0];Fn(h.localId!==void 0,"internal-error");const p=h.providerUserInfo!==void 0?sL(h.providerUserInfo):[],b=!(h.email&&h.passwordHash)&&!(p!=null&&p.length),E=new Am;E.updateFromIdToken(s);const o=new oh({uid:h.localId,auth:e,stsTokenManager:E,isAnonymous:b}),O={uid:h.localId,displayName:h.displayName||null,photoURL:h.photoUrl||null,email:h.email||null,emailVerified:h.emailVerified||!1,phoneNumber:h.phoneNumber||null,tenantId:h.tenantId||null,providerData:p,metadata:new Zw(h.createdAt,h.lastLoginAt),isAnonymous:!(h.email&&h.passwordHash)&&!(p!=null&&p.length)};return Object.assign(o,O),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iP=new Map;function sh(t){fh(t instanceof Function,"Expected a class definition");let e=iP.get(t);return e?(fh(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,iP.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aL{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}aL.type="NONE";const oP=aL;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m0(t,e,r){return`firebase:${t}:${e}:${r}`}class Cm{constructor(e,r,s){this.persistence=e,this.auth=r,this.userKey=s;const{config:h,name:p}=this.auth;this.fullUserKey=m0(this.userKey,h.apiKey,p),this.fullPersistenceKey=m0("persistence",h.apiKey,p),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?oh._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,s="authUser"){if(!r.length)return new Cm(sh(oP),e,s);const h=(await Promise.all(r.map(async O=>{if(await O._isAvailable())return O}))).filter(O=>O);let p=h[0]||sh(oP);const b=m0(s,e.config.apiKey,e.name);let E=null;for(const O of r)try{const z=await O._get(b);if(z){const U=oh._fromJSON(e,z);O!==p&&(E=U),p=O;break}}catch{}const o=h.filter(O=>O._shouldAllowMigration);return!p._shouldAllowMigration||!o.length?new Cm(p,e,s):(p=o[0],E&&await p._set(b,E.toJSON()),await Promise.all(r.map(async O=>{if(O!==p)try{await O._remove(b)}catch{}})),new Cm(p,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sP(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(hL(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lL(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fL(e))return"Blackberry";if(pL(e))return"Webos";if(cL(e))return"Safari";if((e.includes("chrome/")||uL(e))&&!e.includes("edge/"))return"Chrome";if(dL(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(r);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function lL(t=Wa()){return/firefox\//i.test(t)}function cL(t=Wa()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uL(t=Wa()){return/crios\//i.test(t)}function hL(t=Wa()){return/iemobile/i.test(t)}function dL(t=Wa()){return/android/i.test(t)}function fL(t=Wa()){return/blackberry/i.test(t)}function pL(t=Wa()){return/webos/i.test(t)}function hE(t=Wa()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function e9(t=Wa()){var e;return hE(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function t9(){return gG()&&document.documentMode===10}function mL(t=Wa()){return hE(t)||dL(t)||pL(t)||fL(t)||/windows phone/i.test(t)||hL(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gL(t,e=[]){let r;switch(t){case"Browser":r=sP(Wa());break;case"Worker":r=`${sP(Wa())}-${t}`;break;default:r=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${Qm}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r9{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const s=p=>new Promise((b,E)=>{try{const o=e(p);b(o)}catch(o){E(o)}});s.onAbort=r,this.queue.push(s);const h=this.queue.length-1;return()=>{this.queue[h]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const s of this.queue)await s(e),s.onAbort&&r.push(s.onAbort)}catch(s){r.reverse();for(const h of r)try{h()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function n9(t,e={}){return Kd(t,"GET","/v2/passwordPolicy",Zd(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i9=6;class o9{constructor(e){var r,s,h,p;const b=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=b.minPasswordLength)!==null&&r!==void 0?r:i9,b.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=b.maxPasswordLength),b.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=b.containsLowercaseCharacter),b.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=b.containsUppercaseCharacter),b.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=b.containsNumericCharacter),b.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=b.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(h=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&h!==void 0?h:"",this.forceUpgradeOnSignin=(p=e.forceUpgradeOnSignin)!==null&&p!==void 0?p:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,s,h,p,b,E;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=(r=o.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),o.isValid&&(o.isValid=(s=o.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),o.isValid&&(o.isValid=(h=o.containsLowercaseLetter)!==null&&h!==void 0?h:!0),o.isValid&&(o.isValid=(p=o.containsUppercaseLetter)!==null&&p!==void 0?p:!0),o.isValid&&(o.isValid=(b=o.containsNumericCharacter)!==null&&b!==void 0?b:!0),o.isValid&&(o.isValid=(E=o.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),o}validatePasswordLengthOptions(e,r){const s=this.customStrengthOptions.minPasswordLength,h=this.customStrengthOptions.maxPasswordLength;s&&(r.meetsMinPasswordLength=e.length>=s),h&&(r.meetsMaxPasswordLength=e.length<=h)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let s;for(let h=0;h<e.length;h++)s=e.charAt(h),this.updatePasswordCharacterOptionsStatuses(r,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,r,s,h,p){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=h)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s9{constructor(e,r,s,h){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=s,this.config=h,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new aP(this),this.idTokenSubscription=new aP(this),this.beforeStateQueue=new r9(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=eL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=h.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=sh(r)),this._initializationPromise=this.queue(async()=>{var s,h;if(!this._deleted&&(this.persistenceManager=await Cm.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((h=this.currentUser)===null||h===void 0?void 0:h.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const r=await oL(this,{idToken:e}),s=await oh._fromGetAccountInfoResponse(this,r,e);await this.directlySetCurrentUser(s)}catch(r){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",r),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var r;if(du(this.app)){const b=this.app.settings.authIdToken;return b?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(b).then(E,E))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let h=s,p=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const b=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,E=h==null?void 0:h._redirectEventId,o=await this.tryRedirectSignIn(e);(!b||b===E)&&(o!=null&&o.user)&&(h=o.user,p=!0)}if(!h)return this.directlySetCurrentUser(null);if(!h._redirectEventId){if(p)try{await this.beforeStateQueue.runMiddleware(h)}catch(b){h=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(b))}return h?this.reloadAndSetCurrentUserOrClear(h):this.directlySetCurrentUser(null)}return Fn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===h._redirectEventId?this.directlySetCurrentUser(h):this.reloadAndSetCurrentUserOrClear(h)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await H0(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Fq()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(du(this.app))return Promise.reject(uh(this));const r=e?Ra(e):null;return r&&Fn(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&Fn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return du(this.app)?Promise.reject(uh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return du(this.app)?Promise.reject(uh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(sh(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await n9(this),r=new o9(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ty("auth","Firebase",e())}onAuthStateChanged(e,r,s){return this.registerStateListener(this.authStateSubscription,e,r,s)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,s){return this.registerStateListener(this.idTokenSubscription,e,r,s)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(s.tenantId=this.tenantId),await Qq(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const s=await this.getOrInitRedirectPersistenceManager(r);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&sh(e)||this._popupRedirectResolver;Fn(r,this,"argument-error"),this.redirectPersistenceManager=await Cm.create(this,[sh(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,s;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,s,h){if(this._deleted)return()=>{};const p=typeof r=="function"?r:r.next.bind(r);let b=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Fn(E,this,"internal-error"),E.then(()=>{b||p(this.currentUser)}),typeof r=="function"){const o=e.addObserver(r,s,h);return()=>{b=!0,o()}}else{const o=e.addObserver(r);return()=>{b=!0,o()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Fn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gL(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(r["X-Firebase-Client"]=s);const h=await this._getAppCheckToken();return h&&(r["X-Firebase-AppCheck"]=h),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&Bq(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function hp(t){return Ra(t)}class aP{constructor(e){this.auth=e,this.observer=null,this.addObserver=EG(r=>this.observer=r)}get next(){return Fn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pb={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function a9(t){Pb=t}function _L(t){return Pb.loadJS(t)}function l9(){return Pb.recaptchaEnterpriseScript}function c9(){return Pb.gapiScript}function u9(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const h9="recaptcha-enterprise",d9="NO_RECAPTCHA";class f9{constructor(e){this.type=h9,this.auth=hp(e)}async verify(e="verify",r=!1){async function s(p){if(!r){if(p.tenantId==null&&p._agentRecaptchaConfig!=null)return p._agentRecaptchaConfig.siteKey;if(p.tenantId!=null&&p._tenantRecaptchaConfigs[p.tenantId]!==void 0)return p._tenantRecaptchaConfigs[p.tenantId].siteKey}return new Promise(async(b,E)=>{qq(p,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(o=>{if(o.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const O=new Gq(o);return p.tenantId==null?p._agentRecaptchaConfig=O:p._tenantRecaptchaConfigs[p.tenantId]=O,b(O.siteKey)}}).catch(o=>{E(o)})})}function h(p,b,E){const o=window.grecaptcha;rP(o)?o.enterprise.ready(()=>{o.enterprise.execute(p,{action:e}).then(O=>{b(O)}).catch(()=>{b(d9)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((p,b)=>{s(this.auth).then(E=>{if(!r&&rP(window.grecaptcha))h(E,p,b);else{if(typeof window>"u"){b(new Error("RecaptchaVerifier is only supported in browser"));return}let o=l9();o.length!==0&&(o+=E),_L(o).then(()=>{h(E,p,b)}).catch(O=>{b(O)})}}).catch(E=>{b(E)})})}}async function lP(t,e,r,s=!1){const h=new f9(t);let p;try{p=await h.verify(r)}catch{p=await h.verify(r,!0)}const b=Object.assign({},e);return s?Object.assign(b,{captchaResp:p}):Object.assign(b,{captchaResponse:p}),Object.assign(b,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(b,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),b}async function Kw(t,e,r,s){var h;if(!((h=t._getRecaptchaConfig())===null||h===void 0)&&h.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const p=await lP(t,e,r,r==="getOobCode");return s(t,p)}else return s(t,e).catch(async p=>{if(p.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const b=await lP(t,e,r,r==="getOobCode");return s(t,b)}else return Promise.reject(p)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p9(t,e){const r=sE(t,"auth");if(r.isInitialized()){const h=r.getImmediate(),p=r.getOptions();if($0(p,e??{}))return h;zc(h,"already-initialized")}return r.initialize({options:e})}function m9(t,e){const r=(e==null?void 0:e.persistence)||[],s=(Array.isArray(r)?r:[r]).map(sh);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function g9(t,e,r){const s=hp(t);Fn(s._canInitEmulator,s,"emulator-config-failed"),Fn(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const h=!1,p=yL(e),{host:b,port:E}=_9(e),o=E===null?"":`:${E}`;s.config.emulator={url:`${p}//${b}${o}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:b,port:E,protocol:p.replace(":",""),options:Object.freeze({disableWarnings:h})}),y9()}function yL(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function _9(t){const e=yL(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const s=r[2].split("@").pop()||"",h=/^(\[[^\]]+\])(:|$)/.exec(s);if(h){const p=h[1];return{host:p,port:cP(s.substr(p.length+1))}}else{const[p,b]=s.split(":");return{host:p,port:cP(b)}}}function cP(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function y9(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dE{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return ih("not implemented")}_getIdTokenResponse(e){return ih("not implemented")}_linkToIdToken(e,r){return ih("not implemented")}_getReauthenticationResolver(e){return ih("not implemented")}}async function v9(t,e){return Kd(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b9(t,e){return Iy(t,"POST","/v1/accounts:signInWithPassword",Zd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x9(t,e){return Iy(t,"POST","/v1/accounts:signInWithEmailLink",Zd(t,e))}async function w9(t,e){return Iy(t,"POST","/v1/accounts:signInWithEmailLink",Zd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty extends dE{constructor(e,r,s,h=null){super("password",s),this._email=e,this._password=r,this._tenantId=h}static _fromEmailAndPassword(e,r){return new ty(e,r,"password")}static _fromEmailAndCode(e,r,s=null){return new ty(e,r,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Kw(e,r,"signInWithPassword",b9);case"emailLink":return x9(e,{email:this._email,oobCode:this._password});default:zc(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const s={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Kw(e,s,"signUpPassword",v9);case"emailLink":return w9(e,{idToken:r,email:this._email,oobCode:this._password});default:zc(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rm(t,e){return Iy(t,"POST","/v1/accounts:signInWithIdp",Zd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T9="http://localhost";class tp extends dE{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new tp(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):zc("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:h}=r,p=aE(r,["providerId","signInMethod"]);if(!s||!h)return null;const b=new tp(s,h);return b.idToken=p.idToken||void 0,b.accessToken=p.accessToken||void 0,b.secret=p.secret,b.nonce=p.nonce,b.pendingToken=p.pendingToken||null,b}_getIdTokenResponse(e){const r=this.buildRequest();return Rm(e,r)}_linkToIdToken(e,r){const s=this.buildRequest();return s.idToken=r,Rm(e,s)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,Rm(e,r)}buildRequest(){const e={requestUri:T9,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=Ey(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E9(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function S9(t){const e=T_(E_(t)).link,r=e?T_(E_(e)).deep_link_id:null,s=T_(E_(t)).deep_link_id;return(s?T_(E_(s)).link:null)||s||r||e||t}class fE{constructor(e){var r,s,h,p,b,E;const o=T_(E_(e)),O=(r=o.apiKey)!==null&&r!==void 0?r:null,z=(s=o.oobCode)!==null&&s!==void 0?s:null,U=E9((h=o.mode)!==null&&h!==void 0?h:null);Fn(O&&z&&U,"argument-error"),this.apiKey=O,this.operation=U,this.code=z,this.continueUrl=(p=o.continueUrl)!==null&&p!==void 0?p:null,this.languageCode=(b=o.languageCode)!==null&&b!==void 0?b:null,this.tenantId=(E=o.tenantId)!==null&&E!==void 0?E:null}static parseLink(e){const r=S9(e);try{return new fE(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(){this.providerId=eg.PROVIDER_ID}static credential(e,r){return ty._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const s=fE.parseLink(r);return Fn(s,"argument-error"),ty._fromEmailAndCode(e,s.code,s.tenantId)}}eg.PROVIDER_ID="password";eg.EMAIL_PASSWORD_SIGN_IN_METHOD="password";eg.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vL{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay extends vL{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xd extends Ay{constructor(){super("facebook.com")}static credential(e){return tp._fromParams({providerId:xd.PROVIDER_ID,signInMethod:xd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xd.credentialFromTaggedObject(e)}static credentialFromError(e){return xd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return xd.credential(e.oauthAccessToken)}catch{return null}}}xd.FACEBOOK_SIGN_IN_METHOD="facebook.com";xd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd extends Ay{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return tp._fromParams({providerId:wd.PROVIDER_ID,signInMethod:wd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return wd.credentialFromTaggedObject(e)}static credentialFromError(e){return wd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:s}=e;if(!r&&!s)return null;try{return wd.credential(r,s)}catch{return null}}}wd.GOOGLE_SIGN_IN_METHOD="google.com";wd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td extends Ay{constructor(){super("github.com")}static credential(e){return tp._fromParams({providerId:Td.PROVIDER_ID,signInMethod:Td.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Td.credentialFromTaggedObject(e)}static credentialFromError(e){return Td.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Td.credential(e.oauthAccessToken)}catch{return null}}}Td.GITHUB_SIGN_IN_METHOD="github.com";Td.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ed extends Ay{constructor(){super("twitter.com")}static credential(e,r){return tp._fromParams({providerId:Ed.PROVIDER_ID,signInMethod:Ed.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Ed.credentialFromTaggedObject(e)}static credentialFromError(e){return Ed.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:s}=e;if(!r||!s)return null;try{return Ed.credential(r,s)}catch{return null}}}Ed.TWITTER_SIGN_IN_METHOD="twitter.com";Ed.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I9(t,e){return Iy(t,"POST","/v1/accounts:signUp",Zd(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,s,h=!1){const p=await oh._fromIdTokenResponse(e,s,h),b=uP(s);return new rp({user:p,providerId:b,_tokenResponse:s,operationType:r})}static async _forOperation(e,r,s){await e._updateTokensIfNecessary(s,!0);const h=uP(s);return new rp({user:e,providerId:h,_tokenResponse:s,operationType:r})}}function uP(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0 extends _h{constructor(e,r,s,h){var p;super(r.code,r.message),this.operationType=s,this.user=h,Object.setPrototypeOf(this,W0.prototype),this.customData={appName:e.name,tenantId:(p=e.tenantId)!==null&&p!==void 0?p:void 0,_serverResponse:r.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,r,s,h){return new W0(e,r,s,h)}}function bL(t,e,r,s){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(p=>{throw p.code==="auth/multi-factor-auth-required"?W0._fromErrorAndOperation(t,p,e,s):p})}async function A9(t,e,r=!1){const s=await ey(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return rp._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function C9(t,e,r=!1){const{auth:s}=t;if(du(s.app))return Promise.reject(uh(s));const h="reauthenticate";try{const p=await ey(t,bL(s,h,e,t),r);Fn(p.idToken,s,"internal-error");const b=uE(p.idToken);Fn(b,s,"internal-error");const{sub:E}=b;return Fn(t.uid===E,s,"user-mismatch"),rp._forOperation(t,h,p)}catch(p){throw(p==null?void 0:p.code)==="auth/user-not-found"&&zc(s,"user-mismatch"),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xL(t,e,r=!1){if(du(t.app))return Promise.reject(uh(t));const s="signIn",h=await bL(t,s,e),p=await rp._fromIdTokenResponse(t,s,h);return r||await t._updateCurrentUser(p.user),p}async function R9(t,e){return xL(hp(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wL(t){const e=hp(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function P9(t,e,r){if(du(t.app))return Promise.reject(uh(t));const s=hp(t),b=await Kw(s,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",I9).catch(o=>{throw o.code==="auth/password-does-not-meet-requirements"&&wL(t),o}),E=await rp._fromIdTokenResponse(s,"signIn",b);return await s._updateCurrentUser(E.user),E}function M9(t,e,r){return du(t.app)?Promise.reject(uh(t)):R9(Ra(t),eg.credential(e,r)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&wL(t),s})}function k9(t,e,r,s){return Ra(t).onIdTokenChanged(e,r,s)}function O9(t,e,r){return Ra(t).beforeAuthStateChanged(e,r)}function D9(t){return Ra(t).signOut()}const Z0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TL{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(Z0,"1"),this.storage.removeItem(Z0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L9=1e3,B9=10;class EL extends TL{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=mL(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const s=this.storage.getItem(r),h=this.localCache[r];s!==h&&e(r,h,s)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((b,E,o)=>{this.notifyListeners(b,o)});return}const s=e.key;r?this.detachListener():this.stopPolling();const h=()=>{const b=this.storage.getItem(s);!r&&this.localCache[s]===b||this.notifyListeners(s,b)},p=this.storage.getItem(s);t9()&&p!==e.newValue&&e.newValue!==e.oldValue?setTimeout(h,B9):h()}notifyListeners(e,r){this.localCache[e]=r;const s=this.listeners[e];if(s)for(const h of Array.from(s))h(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:s}),!0)})},L9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}EL.type="LOCAL";const z9=EL;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SL extends TL{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}SL.type="SESSION";const IL=SL;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N9(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mb{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(h=>h.isListeningto(e));if(r)return r;const s=new Mb(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:s,eventType:h,data:p}=r.data,b=this.handlersMap[h];if(!(b!=null&&b.size))return;r.ports[0].postMessage({status:"ack",eventId:s,eventType:h});const E=Array.from(b).map(async O=>O(r.origin,p)),o=await N9(E);r.ports[0].postMessage({status:"done",eventId:s,eventType:h,response:o})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Mb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pE(t="",e=10){let r="";for(let s=0;s<e;s++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F9{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,s=50){const h=typeof MessageChannel<"u"?new MessageChannel:null;if(!h)throw new Error("connection_unavailable");let p,b;return new Promise((E,o)=>{const O=pE("",20);h.port1.start();const z=setTimeout(()=>{o(new Error("unsupported_event"))},s);b={messageChannel:h,onMessage(U){const H=U;if(H.data.eventId===O)switch(H.data.status){case"ack":clearTimeout(z),p=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(p),E(H.data.response);break;default:clearTimeout(z),clearTimeout(p),o(new Error("invalid_response"));break}}},this.handlers.add(b),h.port1.addEventListener("message",b.onMessage),this.target.postMessage({eventType:e,eventId:O,data:r},[h.port2])}).finally(()=>{b&&this.removeMessageHandler(b)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pu(){return window}function V9(t){pu().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AL(){return typeof pu().WorkerGlobalScope<"u"&&typeof pu().importScripts=="function"}async function U9(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function j9(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function $9(){return AL()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CL="firebaseLocalStorageDb",G9=1,K0="firebaseLocalStorage",RL="fbase_key";class Cy{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function kb(t,e){return t.transaction([K0],e?"readwrite":"readonly").objectStore(K0)}function q9(){const t=indexedDB.deleteDatabase(CL);return new Cy(t).toPromise()}function Xw(){const t=indexedDB.open(CL,G9);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(K0,{keyPath:RL})}catch(h){r(h)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(K0)?e(s):(s.close(),await q9(),e(await Xw()))})})}async function hP(t,e,r){const s=kb(t,!0).put({[RL]:e,value:r});return new Cy(s).toPromise()}async function H9(t,e){const r=kb(t,!1).get(e),s=await new Cy(r).toPromise();return s===void 0?null:s.value}function dP(t,e){const r=kb(t,!0).delete(e);return new Cy(r).toPromise()}const W9=800,Z9=3;class PL{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Xw(),this.db)}async _withRetries(e){let r=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(r++>Z9)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return AL()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Mb._getInstance($9()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await U9(),!this.activeServiceWorker)return;this.sender=new F9(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((r=s[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||j9()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Xw();return await hP(e,Z0,"1"),await dP(e,Z0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(s=>hP(s,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(s=>H9(s,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>dP(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(h=>{const p=kb(h,!1).getAll();return new Cy(p).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],s=new Set;if(e.length!==0)for(const{fbase_key:h,value:p}of e)s.add(h),JSON.stringify(this.localCache[h])!==JSON.stringify(p)&&(this.notifyListeners(h,p),r.push(h));for(const h of Object.keys(this.localCache))this.localCache[h]&&!s.has(h)&&(this.notifyListeners(h,null),r.push(h));return r}notifyListeners(e,r){this.localCache[e]=r;const s=this.listeners[e];if(s)for(const h of Array.from(s))h(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),W9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}PL.type="LOCAL";const K9=PL;new Sy(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X9(t,e){return e?sh(e):(Fn(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE extends dE{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Rm(e,this._buildIdpRequest())}_linkToIdToken(e,r){return Rm(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return Rm(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Y9(t){return xL(t.auth,new mE(t),t.bypassAuthState)}function J9(t){const{auth:e,user:r}=t;return Fn(r,e,"internal-error"),C9(r,new mE(t),t.bypassAuthState)}async function Q9(t){const{auth:e,user:r}=t;return Fn(r,e,"internal-error"),A9(r,new mE(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ML{constructor(e,r,s,h,p=!1){this.auth=e,this.resolver=s,this.user=h,this.bypassAuthState=p,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:s,postBody:h,tenantId:p,error:b,type:E}=e;if(b){this.reject(b);return}const o={auth:this.auth,requestUri:r,sessionId:s,tenantId:p||void 0,postBody:h||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(o))}catch(O){this.reject(O)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Y9;case"linkViaPopup":case"linkViaRedirect":return Q9;case"reauthViaPopup":case"reauthViaRedirect":return J9;default:zc(this.auth,"internal-error")}}resolve(e){fh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){fh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eH=new Sy(2e3,1e4);class mm extends ML{constructor(e,r,s,h,p){super(e,r,h,p),this.provider=s,this.authWindow=null,this.pollId=null,mm.currentPopupAction&&mm.currentPopupAction.cancel(),mm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Fn(e,this.auth,"internal-error"),e}async onExecution(){fh(this.filter.length===1,"Popup operations only handle one event");const e=pE();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(fu(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(fu(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,mm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,s;if(!((s=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fu(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,eH.get())};e()}}mm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tH="pendingRedirect",g0=new Map;class rH extends ML{constructor(e,r,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,s),this.eventId=null}async execute(){let e=g0.get(this.auth._key());if(!e){try{const s=await nH(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(r){e=()=>Promise.reject(r)}g0.set(this.auth._key(),e)}return this.bypassAuthState||g0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nH(t,e){const r=sH(e),s=oH(t);if(!await s._isAvailable())return!1;const h=await s._get(r)==="true";return await s._remove(r),h}function iH(t,e){g0.set(t._key(),e)}function oH(t){return sh(t._redirectPersistence)}function sH(t){return m0(tH,t.config.apiKey,t.name)}async function aH(t,e,r=!1){if(du(t.app))return Promise.reject(uh(t));const s=hp(t),h=X9(s,e),b=await new rH(s,h,r).execute();return b&&!r&&(delete b.user._redirectEventId,await s._persistUserIfCurrent(b.user),await s._setRedirectUser(null,e)),b}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lH=10*60*1e3;class cH{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(r=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!uH(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var s;if(e.error&&!kL(e)){const h=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";r.onError(fu(this.auth,h))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const s=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=lH&&this.cachedEventUids.clear(),this.cachedEventUids.has(fP(e))}saveEventToCache(e){this.cachedEventUids.add(fP(e)),this.lastProcessedEventTime=Date.now()}}function fP(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function kL({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function uH(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return kL(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hH(t,e={}){return Kd(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dH=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,fH=/^https?/;async function pH(t){if(t.config.emulator)return;const{authorizedDomains:e}=await hH(t);for(const r of e)try{if(mH(r))return}catch{}zc(t,"unauthorized-domain")}function mH(t){const e=Ww(),{protocol:r,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const b=new URL(t);return b.hostname===""&&s===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&b.hostname===s}if(!fH.test(r))return!1;if(dH.test(t))return s===t;const h=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+h+"|"+h+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gH=new Sy(3e4,6e4);function pP(){const t=pu().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function _H(t){return new Promise((e,r)=>{var s,h,p;function b(){pP(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{pP(),r(fu(t,"network-request-failed"))},timeout:gH.get()})}if(!((h=(s=pu().gapi)===null||s===void 0?void 0:s.iframes)===null||h===void 0)&&h.Iframe)e(gapi.iframes.getContext());else if(!((p=pu().gapi)===null||p===void 0)&&p.load)b();else{const E=u9("iframefcb");return pu()[E]=()=>{gapi.load?b():r(fu(t,"network-request-failed"))},_L(`${c9()}?onload=${E}`).catch(o=>r(o))}}).catch(e=>{throw _0=null,e})}let _0=null;function yH(t){return _0=_0||_H(t),_0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vH=new Sy(5e3,15e3),bH="__/auth/iframe",xH="emulator/auth/iframe",wH={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},TH=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function EH(t){const e=t.config;Fn(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?cE(e,xH):`https://${t.config.authDomain}/${bH}`,s={apiKey:e.apiKey,appName:t.name,v:Qm},h=TH.get(t.config.apiHost);h&&(s.eid=h);const p=t._getFrameworks();return p.length&&(s.fw=p.join(",")),`${r}?${Ey(s).slice(1)}`}async function SH(t){const e=await yH(t),r=pu().gapi;return Fn(r,t,"internal-error"),e.open({where:document.body,url:EH(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:wH,dontclear:!0},s=>new Promise(async(h,p)=>{await s.restyle({setHideOnLeave:!1});const b=fu(t,"network-request-failed"),E=pu().setTimeout(()=>{p(b)},vH.get());function o(){pu().clearTimeout(E),h(s)}s.ping(o).then(o,()=>{p(b)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IH={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},AH=500,CH=600,RH="_blank",PH="http://localhost";class mP{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function MH(t,e,r,s=AH,h=CH){const p=Math.max((window.screen.availHeight-h)/2,0).toString(),b=Math.max((window.screen.availWidth-s)/2,0).toString();let E="";const o=Object.assign(Object.assign({},IH),{width:s.toString(),height:h.toString(),top:p,left:b}),O=Wa().toLowerCase();r&&(E=uL(O)?RH:r),lL(O)&&(e=e||PH,o.scrollbars="yes");const z=Object.entries(o).reduce((H,[Y,Q])=>`${H}${Y}=${Q},`,"");if(e9(O)&&E!=="_self")return kH(e||"",E),new mP(null);const U=window.open(e||"",E,z);Fn(U,t,"popup-blocked");try{U.focus()}catch{}return new mP(U)}function kH(t,e){const r=document.createElement("a");r.href=t,r.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OH="__/auth/handler",DH="emulator/auth/handler",LH=encodeURIComponent("fac");async function gP(t,e,r,s,h,p){Fn(t.config.authDomain,t,"auth-domain-config-required"),Fn(t.config.apiKey,t,"invalid-api-key");const b={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:s,v:Qm,eventId:h};if(e instanceof vL){e.setDefaultLanguage(t.languageCode),b.providerId=e.providerId||"",TG(e.getCustomParameters())||(b.customParameters=JSON.stringify(e.getCustomParameters()));for(const[z,U]of Object.entries({}))b[z]=U}if(e instanceof Ay){const z=e.getScopes().filter(U=>U!=="");z.length>0&&(b.scopes=z.join(","))}t.tenantId&&(b.tid=t.tenantId);const E=b;for(const z of Object.keys(E))E[z]===void 0&&delete E[z];const o=await t._getAppCheckToken(),O=o?`#${LH}=${encodeURIComponent(o)}`:"";return`${BH(t)}?${Ey(E).slice(1)}${O}`}function BH({config:t}){return t.emulator?cE(t,DH):`https://${t.authDomain}/${OH}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1="webStorageSupport";class zH{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=IL,this._completeRedirectFn=aH,this._overrideRedirectResult=iH}async _openPopup(e,r,s,h){var p;fh((p=this.eventManagers[e._key()])===null||p===void 0?void 0:p.manager,"_initialize() not called before _openPopup()");const b=await gP(e,r,s,Ww(),h);return MH(e,b,pE())}async _openRedirect(e,r,s,h){await this._originValidation(e);const p=await gP(e,r,s,Ww(),h);return V9(p),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:h,promise:p}=this.eventManagers[r];return h?Promise.resolve(h):(fh(p,"If manager is not set, promise should be"),p)}const s=this.initAndGetManager(e);return this.eventManagers[r]={promise:s},s.catch(()=>{delete this.eventManagers[r]}),s}async initAndGetManager(e){const r=await SH(e),s=new cH(e);return r.register("authEvent",h=>(Fn(h==null?void 0:h.authEvent,e,"invalid-auth-event"),{status:s.onEvent(h.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=r,s}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(J1,{type:J1},h=>{var p;const b=(p=h==null?void 0:h[0])===null||p===void 0?void 0:p[J1];b!==void 0&&r(!!b),zc(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=pH(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return mL()||cL()||hE()}}const NH=zH;var _P="@firebase/auth",yP="1.7.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FH{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){Fn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VH(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function UH(t){Nm(new ep("auth",(e,{options:r})=>{const s=e.getProvider("app").getImmediate(),h=e.getProvider("heartbeat"),p=e.getProvider("app-check-internal"),{apiKey:b,authDomain:E}=s.options;Fn(b&&!b.includes(":"),"invalid-api-key",{appName:s.name});const o={apiKey:b,authDomain:E,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gL(t)},O=new s9(s,h,p,o);return m9(O,r),O},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,s)=>{e.getProvider("auth-internal").initialize()})),Nm(new ep("auth-internal",e=>{const r=hp(e.getProvider("auth").getImmediate());return(s=>new FH(s))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),Md(_P,yP,VH(t)),Md(_P,yP,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jH=5*60,$H=HD("authIdTokenMaxAge")||jH;let vP=null;const GH=t=>async e=>{const r=e&&await e.getIdTokenResult(),s=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(s&&s>$H)return;const h=r==null?void 0:r.token;vP!==h&&(vP=h,await fetch(t,{method:h?"POST":"DELETE",headers:h?{Authorization:`Bearer ${h}`}:{}}))};function OL(t=XD()){const e=sE(t,"auth");if(e.isInitialized())return e.getImmediate();const r=p9(t,{popupRedirectResolver:NH,persistence:[K9,z9,IL]}),s=HD("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const p=new URL(s,location.origin);if(location.origin===p.origin){const b=GH(p.toString());O9(r,b,()=>b(r.currentUser)),k9(r,E=>b(E))}}const h=GD("auth");return h&&g9(r,`http://${h}`),r}function qH(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}a9({loadJS(t){return new Promise((e,r)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=h=>{const p=fu("internal-error");p.customData=h,r(p)},s.type="text/javascript",s.charset="UTF-8",qH().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});UH("Browser");var bP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Zf,DL;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Te,ie){function ne(){}ne.prototype=ie.prototype,Te.D=ie.prototype,Te.prototype=new ne,Te.prototype.constructor=Te,Te.C=function(te,re,me){for(var we=Array(arguments.length-2),tt=2;tt<arguments.length;tt++)we[tt-2]=arguments[tt];return ie.prototype[re].apply(te,we)}}function r(){this.blockSize=-1}function s(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(s,r),s.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function h(Te,ie,ne){ne||(ne=0);var te=Array(16);if(typeof ie=="string")for(var re=0;16>re;++re)te[re]=ie.charCodeAt(ne++)|ie.charCodeAt(ne++)<<8|ie.charCodeAt(ne++)<<16|ie.charCodeAt(ne++)<<24;else for(re=0;16>re;++re)te[re]=ie[ne++]|ie[ne++]<<8|ie[ne++]<<16|ie[ne++]<<24;ie=Te.g[0],ne=Te.g[1],re=Te.g[2];var me=Te.g[3],we=ie+(me^ne&(re^me))+te[0]+3614090360&4294967295;ie=ne+(we<<7&4294967295|we>>>25),we=me+(re^ie&(ne^re))+te[1]+3905402710&4294967295,me=ie+(we<<12&4294967295|we>>>20),we=re+(ne^me&(ie^ne))+te[2]+606105819&4294967295,re=me+(we<<17&4294967295|we>>>15),we=ne+(ie^re&(me^ie))+te[3]+3250441966&4294967295,ne=re+(we<<22&4294967295|we>>>10),we=ie+(me^ne&(re^me))+te[4]+4118548399&4294967295,ie=ne+(we<<7&4294967295|we>>>25),we=me+(re^ie&(ne^re))+te[5]+1200080426&4294967295,me=ie+(we<<12&4294967295|we>>>20),we=re+(ne^me&(ie^ne))+te[6]+2821735955&4294967295,re=me+(we<<17&4294967295|we>>>15),we=ne+(ie^re&(me^ie))+te[7]+4249261313&4294967295,ne=re+(we<<22&4294967295|we>>>10),we=ie+(me^ne&(re^me))+te[8]+1770035416&4294967295,ie=ne+(we<<7&4294967295|we>>>25),we=me+(re^ie&(ne^re))+te[9]+2336552879&4294967295,me=ie+(we<<12&4294967295|we>>>20),we=re+(ne^me&(ie^ne))+te[10]+4294925233&4294967295,re=me+(we<<17&4294967295|we>>>15),we=ne+(ie^re&(me^ie))+te[11]+2304563134&4294967295,ne=re+(we<<22&4294967295|we>>>10),we=ie+(me^ne&(re^me))+te[12]+1804603682&4294967295,ie=ne+(we<<7&4294967295|we>>>25),we=me+(re^ie&(ne^re))+te[13]+4254626195&4294967295,me=ie+(we<<12&4294967295|we>>>20),we=re+(ne^me&(ie^ne))+te[14]+2792965006&4294967295,re=me+(we<<17&4294967295|we>>>15),we=ne+(ie^re&(me^ie))+te[15]+1236535329&4294967295,ne=re+(we<<22&4294967295|we>>>10),we=ie+(re^me&(ne^re))+te[1]+4129170786&4294967295,ie=ne+(we<<5&4294967295|we>>>27),we=me+(ne^re&(ie^ne))+te[6]+3225465664&4294967295,me=ie+(we<<9&4294967295|we>>>23),we=re+(ie^ne&(me^ie))+te[11]+643717713&4294967295,re=me+(we<<14&4294967295|we>>>18),we=ne+(me^ie&(re^me))+te[0]+3921069994&4294967295,ne=re+(we<<20&4294967295|we>>>12),we=ie+(re^me&(ne^re))+te[5]+3593408605&4294967295,ie=ne+(we<<5&4294967295|we>>>27),we=me+(ne^re&(ie^ne))+te[10]+38016083&4294967295,me=ie+(we<<9&4294967295|we>>>23),we=re+(ie^ne&(me^ie))+te[15]+3634488961&4294967295,re=me+(we<<14&4294967295|we>>>18),we=ne+(me^ie&(re^me))+te[4]+3889429448&4294967295,ne=re+(we<<20&4294967295|we>>>12),we=ie+(re^me&(ne^re))+te[9]+568446438&4294967295,ie=ne+(we<<5&4294967295|we>>>27),we=me+(ne^re&(ie^ne))+te[14]+3275163606&4294967295,me=ie+(we<<9&4294967295|we>>>23),we=re+(ie^ne&(me^ie))+te[3]+4107603335&4294967295,re=me+(we<<14&4294967295|we>>>18),we=ne+(me^ie&(re^me))+te[8]+1163531501&4294967295,ne=re+(we<<20&4294967295|we>>>12),we=ie+(re^me&(ne^re))+te[13]+2850285829&4294967295,ie=ne+(we<<5&4294967295|we>>>27),we=me+(ne^re&(ie^ne))+te[2]+4243563512&4294967295,me=ie+(we<<9&4294967295|we>>>23),we=re+(ie^ne&(me^ie))+te[7]+1735328473&4294967295,re=me+(we<<14&4294967295|we>>>18),we=ne+(me^ie&(re^me))+te[12]+2368359562&4294967295,ne=re+(we<<20&4294967295|we>>>12),we=ie+(ne^re^me)+te[5]+4294588738&4294967295,ie=ne+(we<<4&4294967295|we>>>28),we=me+(ie^ne^re)+te[8]+2272392833&4294967295,me=ie+(we<<11&4294967295|we>>>21),we=re+(me^ie^ne)+te[11]+1839030562&4294967295,re=me+(we<<16&4294967295|we>>>16),we=ne+(re^me^ie)+te[14]+4259657740&4294967295,ne=re+(we<<23&4294967295|we>>>9),we=ie+(ne^re^me)+te[1]+2763975236&4294967295,ie=ne+(we<<4&4294967295|we>>>28),we=me+(ie^ne^re)+te[4]+1272893353&4294967295,me=ie+(we<<11&4294967295|we>>>21),we=re+(me^ie^ne)+te[7]+4139469664&4294967295,re=me+(we<<16&4294967295|we>>>16),we=ne+(re^me^ie)+te[10]+3200236656&4294967295,ne=re+(we<<23&4294967295|we>>>9),we=ie+(ne^re^me)+te[13]+681279174&4294967295,ie=ne+(we<<4&4294967295|we>>>28),we=me+(ie^ne^re)+te[0]+3936430074&4294967295,me=ie+(we<<11&4294967295|we>>>21),we=re+(me^ie^ne)+te[3]+3572445317&4294967295,re=me+(we<<16&4294967295|we>>>16),we=ne+(re^me^ie)+te[6]+76029189&4294967295,ne=re+(we<<23&4294967295|we>>>9),we=ie+(ne^re^me)+te[9]+3654602809&4294967295,ie=ne+(we<<4&4294967295|we>>>28),we=me+(ie^ne^re)+te[12]+3873151461&4294967295,me=ie+(we<<11&4294967295|we>>>21),we=re+(me^ie^ne)+te[15]+530742520&4294967295,re=me+(we<<16&4294967295|we>>>16),we=ne+(re^me^ie)+te[2]+3299628645&4294967295,ne=re+(we<<23&4294967295|we>>>9),we=ie+(re^(ne|~me))+te[0]+4096336452&4294967295,ie=ne+(we<<6&4294967295|we>>>26),we=me+(ne^(ie|~re))+te[7]+1126891415&4294967295,me=ie+(we<<10&4294967295|we>>>22),we=re+(ie^(me|~ne))+te[14]+2878612391&4294967295,re=me+(we<<15&4294967295|we>>>17),we=ne+(me^(re|~ie))+te[5]+4237533241&4294967295,ne=re+(we<<21&4294967295|we>>>11),we=ie+(re^(ne|~me))+te[12]+1700485571&4294967295,ie=ne+(we<<6&4294967295|we>>>26),we=me+(ne^(ie|~re))+te[3]+2399980690&4294967295,me=ie+(we<<10&4294967295|we>>>22),we=re+(ie^(me|~ne))+te[10]+4293915773&4294967295,re=me+(we<<15&4294967295|we>>>17),we=ne+(me^(re|~ie))+te[1]+2240044497&4294967295,ne=re+(we<<21&4294967295|we>>>11),we=ie+(re^(ne|~me))+te[8]+1873313359&4294967295,ie=ne+(we<<6&4294967295|we>>>26),we=me+(ne^(ie|~re))+te[15]+4264355552&4294967295,me=ie+(we<<10&4294967295|we>>>22),we=re+(ie^(me|~ne))+te[6]+2734768916&4294967295,re=me+(we<<15&4294967295|we>>>17),we=ne+(me^(re|~ie))+te[13]+1309151649&4294967295,ne=re+(we<<21&4294967295|we>>>11),we=ie+(re^(ne|~me))+te[4]+4149444226&4294967295,ie=ne+(we<<6&4294967295|we>>>26),we=me+(ne^(ie|~re))+te[11]+3174756917&4294967295,me=ie+(we<<10&4294967295|we>>>22),we=re+(ie^(me|~ne))+te[2]+718787259&4294967295,re=me+(we<<15&4294967295|we>>>17),we=ne+(me^(re|~ie))+te[9]+3951481745&4294967295,Te.g[0]=Te.g[0]+ie&4294967295,Te.g[1]=Te.g[1]+(re+(we<<21&4294967295|we>>>11))&4294967295,Te.g[2]=Te.g[2]+re&4294967295,Te.g[3]=Te.g[3]+me&4294967295}s.prototype.u=function(Te,ie){ie===void 0&&(ie=Te.length);for(var ne=ie-this.blockSize,te=this.B,re=this.h,me=0;me<ie;){if(re==0)for(;me<=ne;)h(this,Te,me),me+=this.blockSize;if(typeof Te=="string"){for(;me<ie;)if(te[re++]=Te.charCodeAt(me++),re==this.blockSize){h(this,te),re=0;break}}else for(;me<ie;)if(te[re++]=Te[me++],re==this.blockSize){h(this,te),re=0;break}}this.h=re,this.o+=ie},s.prototype.v=function(){var Te=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Te[0]=128;for(var ie=1;ie<Te.length-8;++ie)Te[ie]=0;var ne=8*this.o;for(ie=Te.length-8;ie<Te.length;++ie)Te[ie]=ne&255,ne/=256;for(this.u(Te),Te=Array(16),ie=ne=0;4>ie;++ie)for(var te=0;32>te;te+=8)Te[ne++]=this.g[ie]>>>te&255;return Te};function p(Te,ie){var ne=E;return Object.prototype.hasOwnProperty.call(ne,Te)?ne[Te]:ne[Te]=ie(Te)}function b(Te,ie){this.h=ie;for(var ne=[],te=!0,re=Te.length-1;0<=re;re--){var me=Te[re]|0;te&&me==ie||(ne[re]=me,te=!1)}this.g=ne}var E={};function o(Te){return-128<=Te&&128>Te?p(Te,function(ie){return new b([ie|0],0>ie?-1:0)}):new b([Te|0],0>Te?-1:0)}function O(Te){if(isNaN(Te)||!isFinite(Te))return U;if(0>Te)return ye(O(-Te));for(var ie=[],ne=1,te=0;Te>=ne;te++)ie[te]=Te/ne|0,ne*=4294967296;return new b(ie,0)}function z(Te,ie){if(Te.length==0)throw Error("number format error: empty string");if(ie=ie||10,2>ie||36<ie)throw Error("radix out of range: "+ie);if(Te.charAt(0)=="-")return ye(z(Te.substring(1),ie));if(0<=Te.indexOf("-"))throw Error('number format error: interior "-" character');for(var ne=O(Math.pow(ie,8)),te=U,re=0;re<Te.length;re+=8){var me=Math.min(8,Te.length-re),we=parseInt(Te.substring(re,re+me),ie);8>me?(me=O(Math.pow(ie,me)),te=te.j(me).add(O(we))):(te=te.j(ne),te=te.add(O(we)))}return te}var U=o(0),H=o(1),Y=o(16777216);t=b.prototype,t.m=function(){if(ge(this))return-ye(this).m();for(var Te=0,ie=1,ne=0;ne<this.g.length;ne++){var te=this.i(ne);Te+=(0<=te?te:4294967296+te)*ie,ie*=4294967296}return Te},t.toString=function(Te){if(Te=Te||10,2>Te||36<Te)throw Error("radix out of range: "+Te);if(Q(this))return"0";if(ge(this))return"-"+ye(this).toString(Te);for(var ie=O(Math.pow(Te,6)),ne=this,te="";;){var re=ve(ne,ie).g;ne=ke(ne,re.j(ie));var me=((0<ne.g.length?ne.g[0]:ne.h)>>>0).toString(Te);if(ne=re,Q(ne))return me+te;for(;6>me.length;)me="0"+me;te=me+te}},t.i=function(Te){return 0>Te?0:Te<this.g.length?this.g[Te]:this.h};function Q(Te){if(Te.h!=0)return!1;for(var ie=0;ie<Te.g.length;ie++)if(Te.g[ie]!=0)return!1;return!0}function ge(Te){return Te.h==-1}t.l=function(Te){return Te=ke(this,Te),ge(Te)?-1:Q(Te)?0:1};function ye(Te){for(var ie=Te.g.length,ne=[],te=0;te<ie;te++)ne[te]=~Te.g[te];return new b(ne,~Te.h).add(H)}t.abs=function(){return ge(this)?ye(this):this},t.add=function(Te){for(var ie=Math.max(this.g.length,Te.g.length),ne=[],te=0,re=0;re<=ie;re++){var me=te+(this.i(re)&65535)+(Te.i(re)&65535),we=(me>>>16)+(this.i(re)>>>16)+(Te.i(re)>>>16);te=we>>>16,me&=65535,we&=65535,ne[re]=we<<16|me}return new b(ne,ne[ne.length-1]&-2147483648?-1:0)};function ke(Te,ie){return Te.add(ye(ie))}t.j=function(Te){if(Q(this)||Q(Te))return U;if(ge(this))return ge(Te)?ye(this).j(ye(Te)):ye(ye(this).j(Te));if(ge(Te))return ye(this.j(ye(Te)));if(0>this.l(Y)&&0>Te.l(Y))return O(this.m()*Te.m());for(var ie=this.g.length+Te.g.length,ne=[],te=0;te<2*ie;te++)ne[te]=0;for(te=0;te<this.g.length;te++)for(var re=0;re<Te.g.length;re++){var me=this.i(te)>>>16,we=this.i(te)&65535,tt=Te.i(re)>>>16,Et=Te.i(re)&65535;ne[2*te+2*re]+=we*Et,he(ne,2*te+2*re),ne[2*te+2*re+1]+=me*Et,he(ne,2*te+2*re+1),ne[2*te+2*re+1]+=we*tt,he(ne,2*te+2*re+1),ne[2*te+2*re+2]+=me*tt,he(ne,2*te+2*re+2)}for(te=0;te<ie;te++)ne[te]=ne[2*te+1]<<16|ne[2*te];for(te=ie;te<2*ie;te++)ne[te]=0;return new b(ne,0)};function he(Te,ie){for(;(Te[ie]&65535)!=Te[ie];)Te[ie+1]+=Te[ie]>>>16,Te[ie]&=65535,ie++}function oe(Te,ie){this.g=Te,this.h=ie}function ve(Te,ie){if(Q(ie))throw Error("division by zero");if(Q(Te))return new oe(U,U);if(ge(Te))return ie=ve(ye(Te),ie),new oe(ye(ie.g),ye(ie.h));if(ge(ie))return ie=ve(Te,ye(ie)),new oe(ye(ie.g),ie.h);if(30<Te.g.length){if(ge(Te)||ge(ie))throw Error("slowDivide_ only works with positive integers.");for(var ne=H,te=ie;0>=te.l(Te);)ne=be(ne),te=be(te);var re=ze(ne,1),me=ze(te,1);for(te=ze(te,2),ne=ze(ne,2);!Q(te);){var we=me.add(te);0>=we.l(Te)&&(re=re.add(ne),me=we),te=ze(te,1),ne=ze(ne,1)}return ie=ke(Te,re.j(ie)),new oe(re,ie)}for(re=U;0<=Te.l(ie);){for(ne=Math.max(1,Math.floor(Te.m()/ie.m())),te=Math.ceil(Math.log(ne)/Math.LN2),te=48>=te?1:Math.pow(2,te-48),me=O(ne),we=me.j(ie);ge(we)||0<we.l(Te);)ne-=te,me=O(ne),we=me.j(ie);Q(me)&&(me=H),re=re.add(me),Te=ke(Te,we)}return new oe(re,Te)}t.A=function(Te){return ve(this,Te).h},t.and=function(Te){for(var ie=Math.max(this.g.length,Te.g.length),ne=[],te=0;te<ie;te++)ne[te]=this.i(te)&Te.i(te);return new b(ne,this.h&Te.h)},t.or=function(Te){for(var ie=Math.max(this.g.length,Te.g.length),ne=[],te=0;te<ie;te++)ne[te]=this.i(te)|Te.i(te);return new b(ne,this.h|Te.h)},t.xor=function(Te){for(var ie=Math.max(this.g.length,Te.g.length),ne=[],te=0;te<ie;te++)ne[te]=this.i(te)^Te.i(te);return new b(ne,this.h^Te.h)};function be(Te){for(var ie=Te.g.length+1,ne=[],te=0;te<ie;te++)ne[te]=Te.i(te)<<1|Te.i(te-1)>>>31;return new b(ne,Te.h)}function ze(Te,ie){var ne=ie>>5;ie%=32;for(var te=Te.g.length-ne,re=[],me=0;me<te;me++)re[me]=0<ie?Te.i(me+ne)>>>ie|Te.i(me+ne+1)<<32-ie:Te.i(me+ne);return new b(re,Te.h)}s.prototype.digest=s.prototype.v,s.prototype.reset=s.prototype.s,s.prototype.update=s.prototype.u,DL=s,b.prototype.add=b.prototype.add,b.prototype.multiply=b.prototype.j,b.prototype.modulo=b.prototype.A,b.prototype.compare=b.prototype.l,b.prototype.toNumber=b.prototype.m,b.prototype.toString=b.prototype.toString,b.prototype.getBits=b.prototype.i,b.fromNumber=O,b.fromString=z,Zf=b}).apply(typeof bP<"u"?bP:typeof self<"u"?self:typeof window<"u"?window:{});var i0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var LL,BL,S_,zL,y0,Yw,NL,FL,VL;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(B,ee,de){return B==Array.prototype||B==Object.prototype||(B[ee]=de.value),B};function r(B){B=[typeof globalThis=="object"&&globalThis,B,typeof window=="object"&&window,typeof self=="object"&&self,typeof i0=="object"&&i0];for(var ee=0;ee<B.length;++ee){var de=B[ee];if(de&&de.Math==Math)return de}throw Error("Cannot find global object")}var s=r(this);function h(B,ee){if(ee)e:{var de=s;B=B.split(".");for(var Me=0;Me<B.length-1;Me++){var Bt=B[Me];if(!(Bt in de))break e;de=de[Bt]}B=B[B.length-1],Me=de[B],ee=ee(Me),ee!=Me&&ee!=null&&e(de,B,{configurable:!0,writable:!0,value:ee})}}function p(B,ee){B instanceof String&&(B+="");var de=0,Me=!1,Bt={next:function(){if(!Me&&de<B.length){var wt=de++;return{value:ee(wt,B[wt]),done:!1}}return Me=!0,{done:!0,value:void 0}}};return Bt[Symbol.iterator]=function(){return Bt},Bt}h("Array.prototype.values",function(B){return B||function(){return p(this,function(ee,de){return de})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var b=b||{},E=this||self;function o(B){var ee=typeof B;return ee=ee!="object"?ee:B?Array.isArray(B)?"array":ee:"null",ee=="array"||ee=="object"&&typeof B.length=="number"}function O(B){var ee=typeof B;return ee=="object"&&B!=null||ee=="function"}function z(B,ee,de){return B.call.apply(B.bind,arguments)}function U(B,ee,de){if(!B)throw Error();if(2<arguments.length){var Me=Array.prototype.slice.call(arguments,2);return function(){var Bt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Bt,Me),B.apply(ee,Bt)}}return function(){return B.apply(ee,arguments)}}function H(B,ee,de){return H=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?z:U,H.apply(null,arguments)}function Y(B,ee){var de=Array.prototype.slice.call(arguments,1);return function(){var Me=de.slice();return Me.push.apply(Me,arguments),B.apply(this,Me)}}function Q(B,ee){function de(){}de.prototype=ee.prototype,B.aa=ee.prototype,B.prototype=new de,B.prototype.constructor=B,B.Qb=function(Me,Bt,wt){for(var Or=Array(arguments.length-2),wi=2;wi<arguments.length;wi++)Or[wi-2]=arguments[wi];return ee.prototype[Bt].apply(Me,Or)}}function ge(B){const ee=B.length;if(0<ee){const de=Array(ee);for(let Me=0;Me<ee;Me++)de[Me]=B[Me];return de}return[]}function ye(B,ee){for(let de=1;de<arguments.length;de++){const Me=arguments[de];if(o(Me)){const Bt=B.length||0,wt=Me.length||0;B.length=Bt+wt;for(let Or=0;Or<wt;Or++)B[Bt+Or]=Me[Or]}else B.push(Me)}}class ke{constructor(ee,de){this.i=ee,this.j=de,this.h=0,this.g=null}get(){let ee;return 0<this.h?(this.h--,ee=this.g,this.g=ee.next,ee.next=null):ee=this.i(),ee}}function he(B){return/^[\s\xa0]*$/.test(B)}function oe(){var B=E.navigator;return B&&(B=B.userAgent)?B:""}function ve(B){return ve[" "](B),B}ve[" "]=function(){};var be=oe().indexOf("Gecko")!=-1&&!(oe().toLowerCase().indexOf("webkit")!=-1&&oe().indexOf("Edge")==-1)&&!(oe().indexOf("Trident")!=-1||oe().indexOf("MSIE")!=-1)&&oe().indexOf("Edge")==-1;function ze(B,ee,de){for(const Me in B)ee.call(de,B[Me],Me,B)}function Te(B,ee){for(const de in B)ee.call(void 0,B[de],de,B)}function ie(B){const ee={};for(const de in B)ee[de]=B[de];return ee}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function te(B,ee){let de,Me;for(let Bt=1;Bt<arguments.length;Bt++){Me=arguments[Bt];for(de in Me)B[de]=Me[de];for(let wt=0;wt<ne.length;wt++)de=ne[wt],Object.prototype.hasOwnProperty.call(Me,de)&&(B[de]=Me[de])}}function re(B){var ee=1;B=B.split(":");const de=[];for(;0<ee&&B.length;)de.push(B.shift()),ee--;return B.length&&de.push(B.join(":")),de}function me(B){E.setTimeout(()=>{throw B},0)}function we(){var B=Fr;let ee=null;return B.g&&(ee=B.g,B.g=B.g.next,B.g||(B.h=null),ee.next=null),ee}class tt{constructor(){this.h=this.g=null}add(ee,de){const Me=Et.get();Me.set(ee,de),this.h?this.h.next=Me:this.g=Me,this.h=Me}}var Et=new ke(()=>new ft,B=>B.reset());class ft{constructor(){this.next=this.g=this.h=null}set(ee,de){this.h=ee,this.g=de,this.next=null}reset(){this.next=this.g=this.h=null}}let rr,or=!1,Fr=new tt,gt=()=>{const B=E.Promise.resolve(void 0);rr=()=>{B.then(jr)}};var jr=()=>{for(var B;B=we();){try{B.h.call(B.g)}catch(de){me(de)}var ee=Et;ee.j(B),100>ee.h&&(ee.h++,B.next=ee.g,ee.g=B)}or=!1};function Ur(){this.s=this.s,this.C=this.C}Ur.prototype.s=!1,Ur.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ur.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Xr(B,ee){this.type=B,this.g=this.target=ee,this.defaultPrevented=!1}Xr.prototype.h=function(){this.defaultPrevented=!0};var pr=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var B=!1,ee=Object.defineProperty({},"passive",{get:function(){B=!0}});try{const de=()=>{};E.addEventListener("test",de,ee),E.removeEventListener("test",de,ee)}catch{}return B}();function Dt(B,ee){if(Xr.call(this,B?B.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,B){var de=this.type=B.type,Me=B.changedTouches&&B.changedTouches.length?B.changedTouches[0]:null;if(this.target=B.target||B.srcElement,this.g=ee,ee=B.relatedTarget){if(be){e:{try{ve(ee.nodeName);var Bt=!0;break e}catch{}Bt=!1}Bt||(ee=null)}}else de=="mouseover"?ee=B.fromElement:de=="mouseout"&&(ee=B.toElement);this.relatedTarget=ee,Me?(this.clientX=Me.clientX!==void 0?Me.clientX:Me.pageX,this.clientY=Me.clientY!==void 0?Me.clientY:Me.pageY,this.screenX=Me.screenX||0,this.screenY=Me.screenY||0):(this.clientX=B.clientX!==void 0?B.clientX:B.pageX,this.clientY=B.clientY!==void 0?B.clientY:B.pageY,this.screenX=B.screenX||0,this.screenY=B.screenY||0),this.button=B.button,this.key=B.key||"",this.ctrlKey=B.ctrlKey,this.altKey=B.altKey,this.shiftKey=B.shiftKey,this.metaKey=B.metaKey,this.pointerId=B.pointerId||0,this.pointerType=typeof B.pointerType=="string"?B.pointerType:ar[B.pointerType]||"",this.state=B.state,this.i=B,B.defaultPrevented&&Dt.aa.h.call(this)}}Q(Dt,Xr);var ar={2:"touch",3:"pen",4:"mouse"};Dt.prototype.h=function(){Dt.aa.h.call(this);var B=this.i;B.preventDefault?B.preventDefault():B.returnValue=!1};var vt="closure_listenable_"+(1e6*Math.random()|0),Pt=0;function Ot(B,ee,de,Me,Bt){this.listener=B,this.proxy=null,this.src=ee,this.type=de,this.capture=!!Me,this.ha=Bt,this.key=++Pt,this.da=this.fa=!1}function lr(B){B.da=!0,B.listener=null,B.proxy=null,B.src=null,B.ha=null}function Se(B){this.src=B,this.g={},this.h=0}Se.prototype.add=function(B,ee,de,Me,Bt){var wt=B.toString();B=this.g[wt],B||(B=this.g[wt]=[],this.h++);var Or=Fe(B,ee,Me,Bt);return-1<Or?(ee=B[Or],de||(ee.fa=!1)):(ee=new Ot(ee,this.src,wt,!!Me,Bt),ee.fa=de,B.push(ee)),ee};function Kt(B,ee){var de=ee.type;if(de in B.g){var Me=B.g[de],Bt=Array.prototype.indexOf.call(Me,ee,void 0),wt;(wt=0<=Bt)&&Array.prototype.splice.call(Me,Bt,1),wt&&(lr(ee),B.g[de].length==0&&(delete B.g[de],B.h--))}}function Fe(B,ee,de,Me){for(var Bt=0;Bt<B.length;++Bt){var wt=B[Bt];if(!wt.da&&wt.listener==ee&&wt.capture==!!de&&wt.ha==Me)return Bt}return-1}var $e="closure_lm_"+(1e6*Math.random()|0),We={};function zt(B,ee,de,Me,Bt){if(Array.isArray(ee)){for(var wt=0;wt<ee.length;wt++)zt(B,ee[wt],de,Me,Bt);return null}return de=nr(de),B&&B[vt]?B.K(ee,de,O(Me)?!!Me.capture:!!Me,Bt):$t(B,ee,de,!1,Me,Bt)}function $t(B,ee,de,Me,Bt,wt){if(!ee)throw Error("Invalid event type");var Or=O(Bt)?!!Bt.capture:!!Bt,wi=Lr(B);if(wi||(B[$e]=wi=new Se(B)),de=wi.add(ee,de,Me,Or,wt),de.proxy)return de;if(Me=_r(),de.proxy=Me,Me.src=B,Me.listener=de,B.addEventListener)pr||(Bt=Or),Bt===void 0&&(Bt=!1),B.addEventListener(ee.toString(),Me,Bt);else if(B.attachEvent)B.attachEvent(Tr(ee.toString()),Me);else if(B.addListener&&B.removeListener)B.addListener(Me);else throw Error("addEventListener and attachEvent are unavailable.");return de}function _r(){function B(de){return ee.call(B.src,B.listener,de)}const ee=yr;return B}function Wt(B,ee,de,Me,Bt){if(Array.isArray(ee))for(var wt=0;wt<ee.length;wt++)Wt(B,ee[wt],de,Me,Bt);else Me=O(Me)?!!Me.capture:!!Me,de=nr(de),B&&B[vt]?(B=B.i,ee=String(ee).toString(),ee in B.g&&(wt=B.g[ee],de=Fe(wt,de,Me,Bt),-1<de&&(lr(wt[de]),Array.prototype.splice.call(wt,de,1),wt.length==0&&(delete B.g[ee],B.h--)))):B&&(B=Lr(B))&&(ee=B.g[ee.toString()],B=-1,ee&&(B=Fe(ee,de,Me,Bt)),(de=-1<B?ee[B]:null)&&mr(de))}function mr(B){if(typeof B!="number"&&B&&!B.da){var ee=B.src;if(ee&&ee[vt])Kt(ee.i,B);else{var de=B.type,Me=B.proxy;ee.removeEventListener?ee.removeEventListener(de,Me,B.capture):ee.detachEvent?ee.detachEvent(Tr(de),Me):ee.addListener&&ee.removeListener&&ee.removeListener(Me),(de=Lr(ee))?(Kt(de,B),de.h==0&&(de.src=null,ee[$e]=null)):lr(B)}}}function Tr(B){return B in We?We[B]:We[B]="on"+B}function yr(B,ee){if(B.da)B=!0;else{ee=new Dt(ee,this);var de=B.listener,Me=B.ha||B.src;B.fa&&mr(B),B=de.call(Me,ee)}return B}function Lr(B){return B=B[$e],B instanceof Se?B:null}var qr="__closure_events_fn_"+(1e9*Math.random()>>>0);function nr(B){return typeof B=="function"?B:(B[qr]||(B[qr]=function(ee){return B.handleEvent(ee)}),B[qr])}function Wr(){Ur.call(this),this.i=new Se(this),this.M=this,this.F=null}Q(Wr,Ur),Wr.prototype[vt]=!0,Wr.prototype.removeEventListener=function(B,ee,de,Me){Wt(this,B,ee,de,Me)};function Zr(B,ee){var de,Me=B.F;if(Me)for(de=[];Me;Me=Me.F)de.push(Me);if(B=B.M,Me=ee.type||ee,typeof ee=="string")ee=new Xr(ee,B);else if(ee instanceof Xr)ee.target=ee.target||B;else{var Bt=ee;ee=new Xr(Me,B),te(ee,Bt)}if(Bt=!0,de)for(var wt=de.length-1;0<=wt;wt--){var Or=ee.g=de[wt];Bt=Rn(Or,Me,!0,ee)&&Bt}if(Or=ee.g=B,Bt=Rn(Or,Me,!0,ee)&&Bt,Bt=Rn(Or,Me,!1,ee)&&Bt,de)for(wt=0;wt<de.length;wt++)Or=ee.g=de[wt],Bt=Rn(Or,Me,!1,ee)&&Bt}Wr.prototype.N=function(){if(Wr.aa.N.call(this),this.i){var B=this.i,ee;for(ee in B.g){for(var de=B.g[ee],Me=0;Me<de.length;Me++)lr(de[Me]);delete B.g[ee],B.h--}}this.F=null},Wr.prototype.K=function(B,ee,de,Me){return this.i.add(String(B),ee,!1,de,Me)},Wr.prototype.L=function(B,ee,de,Me){return this.i.add(String(B),ee,!0,de,Me)};function Rn(B,ee,de,Me){if(ee=B.i.g[String(ee)],!ee)return!0;ee=ee.concat();for(var Bt=!0,wt=0;wt<ee.length;++wt){var Or=ee[wt];if(Or&&!Or.da&&Or.capture==de){var wi=Or.listener,Dr=Or.ha||Or.src;Or.fa&&Kt(B.i,Or),Bt=wi.call(Dr,Me)!==!1&&Bt}}return Bt&&!Me.defaultPrevented}function ln(B,ee,de){if(typeof B=="function")de&&(B=H(B,de));else if(B&&typeof B.handleEvent=="function")B=H(B.handleEvent,B);else throw Error("Invalid listener argument");return 2147483647<Number(ee)?-1:E.setTimeout(B,ee||0)}function jn(B){B.g=ln(()=>{B.g=null,B.i&&(B.i=!1,jn(B))},B.l);const ee=B.h;B.h=null,B.m.apply(null,ee)}class uo extends Ur{constructor(ee,de){super(),this.m=ee,this.l=de,this.h=null,this.i=!1,this.g=null}j(ee){this.h=arguments,this.g?this.i=!0:jn(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ho(B){Ur.call(this),this.h=B,this.g={}}Q(ho,Ur);var vs=[];function Ai(B){ze(B.g,function(ee,de){this.g.hasOwnProperty(de)&&mr(ee)},B),B.g={}}ho.prototype.N=function(){ho.aa.N.call(this),Ai(this)},ho.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ns=E.JSON.stringify,ki=E.JSON.parse,Oi=class{stringify(B){return E.JSON.stringify(B,void 0)}parse(B){return E.JSON.parse(B,void 0)}};function Zo(){}Zo.prototype.h=null;function en(B){return B.h||(B.h=B.i())}function Do(){}var bs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Lo(){Xr.call(this,"d")}Q(Lo,Xr);function jo(){Xr.call(this,"c")}Q(jo,Xr);var is={},Is=null;function Ks(){return Is=Is||new Wr}is.La="serverreachability";function $o(B){Xr.call(this,is.La,B)}Q($o,Xr);function pt(B){const ee=Ks();Zr(ee,new $o(ee))}is.STAT_EVENT="statevent";function fe(B,ee){Xr.call(this,is.STAT_EVENT,B),this.stat=ee}Q(fe,Xr);function xe(B){const ee=Ks();Zr(ee,new fe(ee,B))}is.Ma="timingevent";function Ne(B,ee){Xr.call(this,is.Ma,B),this.size=ee}Q(Ne,Xr);function Ke(B,ee){if(typeof B!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){B()},ee)}function Ge(){this.g=!0}Ge.prototype.xa=function(){this.g=!1};function st(B,ee,de,Me,Bt,wt){B.info(function(){if(B.g)if(wt)for(var Or="",wi=wt.split("&"),Dr=0;Dr<wi.length;Dr++){var di=wi[Dr].split("=");if(1<di.length){var zi=di[0];di=di[1];var Go=zi.split("_");Or=2<=Go.length&&Go[1]=="type"?Or+(zi+"="+di+"&"):Or+(zi+"=redacted&")}}else Or=null;else Or=wt;return"XMLHTTP REQ ("+Me+") [attempt "+Bt+"]: "+ee+`
`+de+`
`+Or})}function _t(B,ee,de,Me,Bt,wt,Or){B.info(function(){return"XMLHTTP RESP ("+Me+") [ attempt "+Bt+"]: "+ee+`
`+de+`
`+wt+" "+Or})}function at(B,ee,de,Me){B.info(function(){return"XMLHTTP TEXT ("+ee+"): "+St(B,de)+(Me?" "+Me:"")})}function bt(B,ee){B.info(function(){return"TIMEOUT: "+ee})}Ge.prototype.info=function(){};function St(B,ee){if(!B.g)return ee;if(!ee)return null;try{var de=JSON.parse(ee);if(de){for(B=0;B<de.length;B++)if(Array.isArray(de[B])){var Me=de[B];if(!(2>Me.length)){var Bt=Me[1];if(Array.isArray(Bt)&&!(1>Bt.length)){var wt=Bt[0];if(wt!="noop"&&wt!="stop"&&wt!="close")for(var Or=1;Or<Bt.length;Or++)Bt[Or]=""}}}}return ns(de)}catch{return ee}}var xt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},jt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ur;function ir(){}Q(ir,Zo),ir.prototype.g=function(){return new XMLHttpRequest},ir.prototype.i=function(){return{}},ur=new ir;function Rr(B,ee,de,Me){this.j=B,this.i=ee,this.l=de,this.R=Me||1,this.U=new ho(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Br}function Br(){this.i=null,this.g="",this.h=!1}var kr={},zr={};function yn(B,ee,de){B.L=1,B.v=ua(go(ee)),B.m=de,B.P=!0,Tn(B,null)}function Tn(B,ee){B.F=Date.now(),Qn(B),B.A=go(B.v);var de=B.A,Me=B.R;Array.isArray(Me)||(Me=[String(Me)]),vr(de.i,"t",Me),B.C=0,de=B.j.J,B.h=new Br,B.g=Pl(B.j,de?ee:null,!B.m),0<B.O&&(B.M=new uo(H(B.Y,B,B.g),B.O)),ee=B.U,de=B.g,Me=B.ca;var Bt="readystatechange";Array.isArray(Bt)||(Bt&&(vs[0]=Bt.toString()),Bt=vs);for(var wt=0;wt<Bt.length;wt++){var Or=zt(de,Bt[wt],Me||ee.handleEvent,!1,ee.h||ee);if(!Or)break;ee.g[Or.key]=Or}ee=B.H?ie(B.H):{},B.m?(B.u||(B.u="POST"),ee["Content-Type"]="application/x-www-form-urlencoded",B.g.ea(B.A,B.u,B.m,ee)):(B.u="GET",B.g.ea(B.A,B.u,null,ee)),pt(),st(B.i,B.u,B.A,B.l,B.R,B.m)}Rr.prototype.ca=function(B){B=B.target;const ee=this.M;ee&&Pn(B)==3?ee.j():this.Y(B)},Rr.prototype.Y=function(B){try{if(B==this.g)e:{const Go=Pn(this.g);var ee=this.g.Ba();const Rs=this.g.Z();if(!(3>Go)&&(Go!=3||this.g&&(this.h.h||this.g.oa()||ti(this.g)))){this.J||Go!=4||ee==7||(ee==8||0>=Rs?pt(3):pt(2)),Di(this);var de=this.g.Z();this.X=de;t:if(Yr(this)){var Me=ti(this.g);B="";var Bt=Me.length,wt=Pn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){mo(this),Li(this);var Or="";break t}this.h.i=new E.TextDecoder}for(ee=0;ee<Bt;ee++)this.h.h=!0,B+=this.h.i.decode(Me[ee],{stream:!(wt&&ee==Bt-1)});Me.length=0,this.h.g+=B,this.C=0,Or=this.h.g}else Or=this.g.oa();if(this.o=de==200,_t(this.i,this.u,this.A,this.l,this.R,Go,de),this.o){if(this.T&&!this.K){t:{if(this.g){var wi,Dr=this.g;if((wi=Dr.g?Dr.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!he(wi)){var di=wi;break t}}di=null}if(de=di)at(this.i,this.l,de,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,os(this,de);else{this.o=!1,this.s=3,xe(12),mo(this),Li(this);break e}}if(this.P){de=!0;let Jo;for(;!this.J&&this.C<Or.length;)if(Jo=On(this,Or),Jo==zr){Go==4&&(this.s=4,xe(14),de=!1),at(this.i,this.l,null,"[Incomplete Response]");break}else if(Jo==kr){this.s=4,xe(15),at(this.i,this.l,Or,"[Invalid Chunk]"),de=!1;break}else at(this.i,this.l,Jo,null),os(this,Jo);if(Yr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Go!=4||Or.length!=0||this.h.h||(this.s=1,xe(16),de=!1),this.o=this.o&&de,!de)at(this.i,this.l,Or,"[Invalid Chunked Response]"),mo(this),Li(this);else if(0<Or.length&&!this.W){this.W=!0;var zi=this.j;zi.g==this&&zi.ba&&!zi.M&&(zi.j.info("Great, no buffering proxy detected. Bytes received: "+Or.length),ta(zi),zi.M=!0,xe(11))}}else at(this.i,this.l,Or,null),os(this,Or);Go==4&&mo(this),this.o&&!this.J&&(Go==4?as(this.j,this):(this.o=!1,Qn(this)))}else hi(this.g),de==400&&0<Or.indexOf("Unknown SID")?(this.s=3,xe(12)):(this.s=0,xe(13)),mo(this),Li(this)}}}catch{}finally{}};function Yr(B){return B.g?B.u=="GET"&&B.L!=2&&B.j.Ca:!1}function On(B,ee){var de=B.C,Me=ee.indexOf(`
`,de);return Me==-1?zr:(de=Number(ee.substring(de,Me)),isNaN(de)?kr:(Me+=1,Me+de>ee.length?zr:(ee=ee.slice(Me,Me+de),B.C=Me+de,ee)))}Rr.prototype.cancel=function(){this.J=!0,mo(this)};function Qn(B){B.S=Date.now()+B.I,Kn(B,B.I)}function Kn(B,ee){if(B.B!=null)throw Error("WatchDog timer not null");B.B=Ke(H(B.ba,B),ee)}function Di(B){B.B&&(E.clearTimeout(B.B),B.B=null)}Rr.prototype.ba=function(){this.B=null;const B=Date.now();0<=B-this.S?(bt(this.i,this.A),this.L!=2&&(pt(),xe(17)),mo(this),this.s=2,Li(this)):Kn(this,this.S-B)};function Li(B){B.j.G==0||B.J||as(B.j,B)}function mo(B){Di(B);var ee=B.M;ee&&typeof ee.ma=="function"&&ee.ma(),B.M=null,Ai(B.U),B.g&&(ee=B.g,B.g=null,ee.abort(),ee.ma())}function os(B,ee){try{var de=B.j;if(de.G!=0&&(de.g==B||Bo(de.h,B))){if(!B.K&&Bo(de.h,B)&&de.G==3){try{var Me=de.Da.g.parse(ee)}catch{Me=null}if(Array.isArray(Me)&&Me.length==3){var Bt=Me;if(Bt[0]==0){e:if(!de.u){if(de.g)if(de.g.F+3e3<B.F)da(de),ni(de);else break e;Fs(de),xe(18)}}else de.za=Bt[1],0<de.za-de.T&&37500>Bt[2]&&de.F&&de.v==0&&!de.C&&(de.C=Ke(H(de.Za,de),6e3));if(1>=Ma(de.h)&&de.ca){try{de.ca()}catch{}de.ca=void 0}}else fa(de,11)}else if((B.K||de.g==B)&&da(de),!he(ee))for(Bt=de.Da.g.parse(ee),ee=0;ee<Bt.length;ee++){let di=Bt[ee];if(de.T=di[0],di=di[1],de.G==2)if(di[0]=="c"){de.K=di[1],de.ia=di[2];const zi=di[3];zi!=null&&(de.la=zi,de.j.info("VER="+de.la));const Go=di[4];Go!=null&&(de.Aa=Go,de.j.info("SVER="+de.Aa));const Rs=di[5];Rs!=null&&typeof Rs=="number"&&0<Rs&&(Me=1.5*Rs,de.L=Me,de.j.info("backChannelRequestTimeoutMs_="+Me)),Me=de;const Jo=B.g;if(Jo){const No=Jo.g?Jo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(No){var wt=Me.h;wt.g||No.indexOf("spdy")==-1&&No.indexOf("quic")==-1&&No.indexOf("h2")==-1||(wt.j=wt.l,wt.g=new Set,wt.h&&(ka(wt,wt.h),wt.h=null))}if(Me.D){const ql=Jo.g?Jo.g.getResponseHeader("X-HTTP-Session-Id"):null;ql&&(Me.ya=ql,ei(Me.I,Me.D,ql))}}de.G=3,de.l&&de.l.ua(),de.ba&&(de.R=Date.now()-B.F,de.j.info("Handshake RTT: "+de.R+"ms")),Me=de;var Or=B;if(Me.qa=Rl(Me,Me.J?Me.ia:null,Me.W),Or.K){la(Me.h,Or);var wi=Or,Dr=Me.L;Dr&&(wi.I=Dr),wi.B&&(Di(wi),Qn(wi)),Me.g=Or}else Ns(Me);0<de.i.length&&ii(de)}else di[0]!="stop"&&di[0]!="close"||fa(de,7);else de.G==3&&(di[0]=="stop"||di[0]=="close"?di[0]=="stop"?fa(de,7):qn(de):di[0]!="noop"&&de.l&&de.l.ta(di),de.v=0)}}pt(4)}catch{}}var Ka=class{constructor(B,ee){this.g=B,this.map=ee}};function As(B){this.l=B||10,E.PerformanceNavigationTiming?(B=E.performance.getEntriesByType("navigation"),B=0<B.length&&(B[0].nextHopProtocol=="hq"||B[0].nextHopProtocol=="h2")):B=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=B?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Xs(B){return B.h?!0:B.g?B.g.size>=B.j:!1}function Ma(B){return B.h?1:B.g?B.g.size:0}function Bo(B,ee){return B.h?B.h==ee:B.g?B.g.has(ee):!1}function ka(B,ee){B.g?B.g.add(ee):B.h=ee}function la(B,ee){B.h&&B.h==ee?B.h=null:B.g&&B.g.has(ee)&&B.g.delete(ee)}As.prototype.cancel=function(){if(this.i=ca(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const B of this.g.values())B.cancel();this.g.clear()}};function ca(B){if(B.h!=null)return B.i.concat(B.h.D);if(B.g!=null&&B.g.size!==0){let ee=B.i;for(const de of B.g.values())ee=ee.concat(de.D);return ee}return ge(B.i)}function Ys(B){if(B.V&&typeof B.V=="function")return B.V();if(typeof Map<"u"&&B instanceof Map||typeof Set<"u"&&B instanceof Set)return Array.from(B.values());if(typeof B=="string")return B.split("");if(o(B)){for(var ee=[],de=B.length,Me=0;Me<de;Me++)ee.push(B[Me]);return ee}ee=[],de=0;for(Me in B)ee[de++]=B[Me];return ee}function Xi(B){if(B.na&&typeof B.na=="function")return B.na();if(!B.V||typeof B.V!="function"){if(typeof Map<"u"&&B instanceof Map)return Array.from(B.keys());if(!(typeof Set<"u"&&B instanceof Set)){if(o(B)||typeof B=="string"){var ee=[];B=B.length;for(var de=0;de<B;de++)ee.push(de);return ee}ee=[],de=0;for(const Me in B)ee[de++]=Me;return ee}}}function ji(B,ee){if(B.forEach&&typeof B.forEach=="function")B.forEach(ee,void 0);else if(o(B)||typeof B=="string")Array.prototype.forEach.call(B,ee,void 0);else for(var de=Xi(B),Me=Ys(B),Bt=Me.length,wt=0;wt<Bt;wt++)ee.call(void 0,Me[wt],de&&de[wt],B)}var eo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ci(B,ee){if(B){B=B.split("&");for(var de=0;de<B.length;de++){var Me=B[de].indexOf("="),Bt=null;if(0<=Me){var wt=B[de].substring(0,Me);Bt=B[de].substring(Me+1)}else wt=B[de];ee(wt,Bt?decodeURIComponent(Bt.replace(/\+/g," ")):"")}}}function Yi(B){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,B instanceof Yi){this.h=B.h,io(this,B.j),this.o=B.o,this.g=B.g,_s(this,B.s),this.l=B.l;var ee=B.i,de=new it;de.i=ee.i,ee.g&&(de.g=new Map(ee.g),de.h=ee.h),Ko(this,de),this.m=B.m}else B&&(ee=String(B).match(eo))?(this.h=!1,io(this,ee[1]||"",!0),this.o=Js(ee[2]||""),this.g=Js(ee[3]||"",!0),_s(this,ee[4]),this.l=Js(ee[5]||"",!0),Ko(this,ee[6]||"",!0),this.m=Js(ee[7]||"")):(this.h=!1,this.i=new it(null,this.h))}Yi.prototype.toString=function(){var B=[],ee=this.j;ee&&B.push(Ji(ee,Qs,!0),":");var de=this.g;return(de||ee=="file")&&(B.push("//"),(ee=this.o)&&B.push(Ji(ee,Qs,!0),"@"),B.push(encodeURIComponent(String(de)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),de=this.s,de!=null&&B.push(":",String(de))),(de=this.l)&&(this.g&&de.charAt(0)!="/"&&B.push("/"),B.push(Ji(de,de.charAt(0)=="/"?ea:Ao,!0))),(de=this.i.toString())&&B.push("?",de),(de=this.m)&&B.push("#",Ji(de,Oa)),B.join("")};function go(B){return new Yi(B)}function io(B,ee,de){B.j=de?Js(ee,!0):ee,B.j&&(B.j=B.j.replace(/:$/,""))}function _s(B,ee){if(ee){if(ee=Number(ee),isNaN(ee)||0>ee)throw Error("Bad port number "+ee);B.s=ee}else B.s=null}function Ko(B,ee,de){ee instanceof it?(B.i=ee,Bi(B.i,B.h)):(de||(ee=Ji(ee,Xo)),B.i=new it(ee,B.h))}function ei(B,ee,de){B.i.set(ee,de)}function ua(B){return ei(B,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),B}function Js(B,ee){return B?ee?decodeURI(B.replace(/%25/g,"%2525")):decodeURIComponent(B):""}function Ji(B,ee,de){return typeof B=="string"?(B=encodeURI(B).replace(ee,Cs),de&&(B=B.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),B):null}function Cs(B){return B=B.charCodeAt(0),"%"+(B>>4&15).toString(16)+(B&15).toString(16)}var Qs=/[#\/\?@]/g,Ao=/[#\?:]/g,ea=/[#\?]/g,Xo=/[#\?@]/g,Oa=/#/g;function it(B,ee){this.h=this.g=null,this.i=B||null,this.j=!!ee}function Ht(B){B.g||(B.g=new Map,B.h=0,B.i&&Ci(B.i,function(ee,de){B.add(decodeURIComponent(ee.replace(/\+/g," ")),de)}))}t=it.prototype,t.add=function(B,ee){Ht(this),this.i=null,B=pi(this,B);var de=this.g.get(B);return de||this.g.set(B,de=[]),de.push(ee),this.h+=1,this};function Zt(B,ee){Ht(B),ee=pi(B,ee),B.g.has(ee)&&(B.i=null,B.h-=B.g.get(ee).length,B.g.delete(ee))}function vn(B,ee){return Ht(B),ee=pi(B,ee),B.g.has(ee)}t.forEach=function(B,ee){Ht(this),this.g.forEach(function(de,Me){de.forEach(function(Bt){B.call(ee,Bt,Me,this)},this)},this)},t.na=function(){Ht(this);const B=Array.from(this.g.values()),ee=Array.from(this.g.keys()),de=[];for(let Me=0;Me<ee.length;Me++){const Bt=B[Me];for(let wt=0;wt<Bt.length;wt++)de.push(ee[Me])}return de},t.V=function(B){Ht(this);let ee=[];if(typeof B=="string")vn(this,B)&&(ee=ee.concat(this.g.get(pi(this,B))));else{B=Array.from(this.g.values());for(let de=0;de<B.length;de++)ee=ee.concat(B[de])}return ee},t.set=function(B,ee){return Ht(this),this.i=null,B=pi(this,B),vn(this,B)&&(this.h-=this.g.get(B).length),this.g.set(B,[ee]),this.h+=1,this},t.get=function(B,ee){return B?(B=this.V(B),0<B.length?String(B[0]):ee):ee};function vr(B,ee,de){Zt(B,ee),0<de.length&&(B.i=null,B.g.set(pi(B,ee),ge(de)),B.h+=de.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const B=[],ee=Array.from(this.g.keys());for(var de=0;de<ee.length;de++){var Me=ee[de];const wt=encodeURIComponent(String(Me)),Or=this.V(Me);for(Me=0;Me<Or.length;Me++){var Bt=wt;Or[Me]!==""&&(Bt+="="+encodeURIComponent(String(Or[Me]))),B.push(Bt)}}return this.i=B.join("&")};function pi(B,ee){return ee=String(ee),B.j&&(ee=ee.toLowerCase()),ee}function Bi(B,ee){ee&&!B.j&&(Ht(B),B.i=null,B.g.forEach(function(de,Me){var Bt=Me.toLowerCase();Me!=Bt&&(Zt(this,Me),vr(this,Bt,de))},B)),B.j=ee}function ai(B,ee){const de=new Ge;if(E.Image){const Me=new Image;Me.onload=Y(Ri,de,"TestLoadImage: loaded",!0,ee,Me),Me.onerror=Y(Ri,de,"TestLoadImage: error",!1,ee,Me),Me.onabort=Y(Ri,de,"TestLoadImage: abort",!1,ee,Me),Me.ontimeout=Y(Ri,de,"TestLoadImage: timeout",!1,ee,Me),E.setTimeout(function(){Me.ontimeout&&Me.ontimeout()},1e4),Me.src=B}else ee(!1)}function _o(B,ee){const de=new Ge,Me=new AbortController,Bt=setTimeout(()=>{Me.abort(),Ri(de,"TestPingServer: timeout",!1,ee)},1e4);fetch(B,{signal:Me.signal}).then(wt=>{clearTimeout(Bt),wt.ok?Ri(de,"TestPingServer: ok",!0,ee):Ri(de,"TestPingServer: server error",!1,ee)}).catch(()=>{clearTimeout(Bt),Ri(de,"TestPingServer: error",!1,ee)})}function Ri(B,ee,de,Me,Bt){try{Bt&&(Bt.onload=null,Bt.onerror=null,Bt.onabort=null,Bt.ontimeout=null),Me(de)}catch{}}function Yo(){this.g=new Oi}function cr(B,ee,de){const Me=de||"";try{ji(B,function(Bt,wt){let Or=Bt;O(Bt)&&(Or=ns(Bt)),ee.push(Me+wt+"="+encodeURIComponent(Or))})}catch(Bt){throw ee.push(Me+"type="+encodeURIComponent("_badmap")),Bt}}function cn(B){this.l=B.Ub||null,this.j=B.eb||!1}Q(cn,Zo),cn.prototype.g=function(){return new fn(this.l,this.j)},cn.prototype.i=function(B){return function(){return B}}({});function fn(B,ee){Wr.call(this),this.D=B,this.o=ee,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Q(fn,Wr),t=fn.prototype,t.open=function(B,ee){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=B,this.A=ee,this.readyState=1,on(this)},t.send=function(B){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const ee={headers:this.u,method:this.B,credentials:this.m,cache:void 0};B&&(ee.body=B),(this.D||E).fetch(new Request(this.A,ee)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,$i(this)),this.readyState=0},t.Sa=function(B){if(this.g&&(this.l=B,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=B.headers,this.readyState=2,on(this)),this.g&&(this.readyState=3,on(this),this.g)))if(this.responseType==="arraybuffer")B.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in B){if(this.j=B.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;oo(this)}else B.text().then(this.Ra.bind(this),this.ga.bind(this))};function oo(B){B.j.read().then(B.Pa.bind(B)).catch(B.ga.bind(B))}t.Pa=function(B){if(this.g){if(this.o&&B.value)this.response.push(B.value);else if(!this.o){var ee=B.value?B.value:new Uint8Array(0);(ee=this.v.decode(ee,{stream:!B.done}))&&(this.response=this.responseText+=ee)}B.done?$i(this):on(this),this.readyState==3&&oo(this)}},t.Ra=function(B){this.g&&(this.response=this.responseText=B,$i(this))},t.Qa=function(B){this.g&&(this.response=B,$i(this))},t.ga=function(){this.g&&$i(this)};function $i(B){B.readyState=4,B.l=null,B.j=null,B.v=null,on(B)}t.setRequestHeader=function(B,ee){this.u.append(B,ee)},t.getResponseHeader=function(B){return this.h&&this.h.get(B.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const B=[],ee=this.h.entries();for(var de=ee.next();!de.done;)de=de.value,B.push(de[0]+": "+de[1]),de=ee.next();return B.join(`\r
`)};function on(B){B.onreadystatechange&&B.onreadystatechange.call(B)}Object.defineProperty(fn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(B){this.m=B?"include":"same-origin"}});function Bs(B){let ee="";return ze(B,function(de,Me){ee+=Me,ee+=":",ee+=de,ee+=`\r
`}),ee}function ss(B,ee,de){e:{for(Me in de){var Me=!1;break e}Me=!0}Me||(de=Bs(de),typeof B=="string"?de!=null&&encodeURIComponent(String(de)):ei(B,ee,de))}function mi(B){Wr.call(this),this.headers=new Map,this.o=B||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Q(mi,Wr);var Co=/^https?$/i,Xe=["POST","PUT"];t=mi.prototype,t.Ha=function(B){this.J=B},t.ea=function(B,ee,de,Me){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+B);ee=ee?ee.toUpperCase():"GET",this.D=B,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ur.g(),this.v=this.o?en(this.o):en(ur),this.g.onreadystatechange=H(this.Ea,this);try{this.B=!0,this.g.open(ee,String(B),!0),this.B=!1}catch(wt){Rt(this,wt);return}if(B=de||"",de=new Map(this.headers),Me)if(Object.getPrototypeOf(Me)===Object.prototype)for(var Bt in Me)de.set(Bt,Me[Bt]);else if(typeof Me.keys=="function"&&typeof Me.get=="function")for(const wt of Me.keys())de.set(wt,Me.get(wt));else throw Error("Unknown input type for opt_headers: "+String(Me));Me=Array.from(de.keys()).find(wt=>wt.toLowerCase()=="content-type"),Bt=E.FormData&&B instanceof E.FormData,!(0<=Array.prototype.indexOf.call(Xe,ee,void 0))||Me||Bt||de.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[wt,Or]of de)this.g.setRequestHeader(wt,Or);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{An(this),this.u=!0,this.g.send(B),this.u=!1}catch(wt){Rt(this,wt)}};function Rt(B,ee){B.h=!1,B.g&&(B.j=!0,B.g.abort(),B.j=!1),B.l=ee,B.m=5,gr(B),Dn(B)}function gr(B){B.A||(B.A=!0,Zr(B,"complete"),Zr(B,"error"))}t.abort=function(B){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=B||7,Zr(this,"complete"),Zr(this,"abort"),Dn(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Dn(this,!0)),mi.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?$r(this):this.bb())},t.bb=function(){$r(this)};function $r(B){if(B.h&&typeof b<"u"&&(!B.v[1]||Pn(B)!=4||B.Z()!=2)){if(B.u&&Pn(B)==4)ln(B.Ea,0,B);else if(Zr(B,"readystatechange"),Pn(B)==4){B.h=!1;try{const Or=B.Z();e:switch(Or){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ee=!0;break e;default:ee=!1}var de;if(!(de=ee)){var Me;if(Me=Or===0){var Bt=String(B.D).match(eo)[1]||null;!Bt&&E.self&&E.self.location&&(Bt=E.self.location.protocol.slice(0,-1)),Me=!Co.test(Bt?Bt.toLowerCase():"")}de=Me}if(de)Zr(B,"complete"),Zr(B,"success");else{B.m=6;try{var wt=2<Pn(B)?B.g.statusText:""}catch{wt=""}B.l=wt+" ["+B.Z()+"]",gr(B)}}finally{Dn(B)}}}}function Dn(B,ee){if(B.g){An(B);const de=B.g,Me=B.v[0]?()=>{}:null;B.g=null,B.v=null,ee||Zr(B,"ready");try{de.onreadystatechange=Me}catch{}}}function An(B){B.I&&(E.clearTimeout(B.I),B.I=null)}t.isActive=function(){return!!this.g};function Pn(B){return B.g?B.g.readyState:0}t.Z=function(){try{return 2<Pn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(B){if(this.g){var ee=this.g.responseText;return B&&ee.indexOf(B)==0&&(ee=ee.substring(B.length)),ki(ee)}};function ti(B){try{if(!B.g)return null;if("response"in B.g)return B.g.response;switch(B.H){case"":case"text":return B.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in B.g)return B.g.mozResponseArrayBuffer}return null}catch{return null}}function hi(B){const ee={};B=(B.g&&2<=Pn(B)&&B.g.getAllResponseHeaders()||"").split(`\r
`);for(let Me=0;Me<B.length;Me++){if(he(B[Me]))continue;var de=re(B[Me]);const Bt=de[0];if(de=de[1],typeof de!="string")continue;de=de.trim();const wt=ee[Bt]||[];ee[Bt]=wt,wt.push(de)}Te(ee,function(Me){return Me.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function xi(B,ee,de){return de&&de.internalChannelParams&&de.internalChannelParams[B]||ee}function fo(B){this.Aa=0,this.i=[],this.j=new Ge,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=xi("failFast",!1,B),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=xi("baseRetryDelayMs",5e3,B),this.cb=xi("retryDelaySeedMs",1e4,B),this.Wa=xi("forwardChannelMaxRetries",2,B),this.wa=xi("forwardChannelRequestTimeoutMs",2e4,B),this.pa=B&&B.xmlHttpFactory||void 0,this.Xa=B&&B.Tb||void 0,this.Ca=B&&B.useFetchStreams||!1,this.L=void 0,this.J=B&&B.supportsCrossDomainXhr||!1,this.K="",this.h=new As(B&&B.concurrentRequestLimit),this.Da=new Yo,this.P=B&&B.fastHandshake||!1,this.O=B&&B.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=B&&B.Rb||!1,B&&B.xa&&this.j.xa(),B&&B.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&B&&B.detectBufferingProxy||!1,this.ja=void 0,B&&B.longPollingTimeout&&0<B.longPollingTimeout&&(this.ja=B.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=fo.prototype,t.la=8,t.G=1,t.connect=function(B,ee,de,Me){xe(0),this.W=B,this.H=ee||{},de&&Me!==void 0&&(this.H.OSID=de,this.H.OAID=Me),this.F=this.X,this.I=Rl(this,null,this.W),ii(this)};function qn(B){if(so(B),B.G==3){var ee=B.U++,de=go(B.I);if(ei(de,"SID",B.K),ei(de,"RID",ee),ei(de,"TYPE","terminate"),Ro(B,de),ee=new Rr(B,B.j,ee),ee.L=2,ee.v=ua(go(de)),de=!1,E.navigator&&E.navigator.sendBeacon)try{de=E.navigator.sendBeacon(ee.v.toString(),"")}catch{}!de&&E.Image&&(new Image().src=ee.v,de=!0),de||(ee.g=Pl(ee.j,null),ee.g.ea(ee.v)),ee.F=Date.now(),Qn(ee)}Su(B)}function ni(B){B.g&&(ta(B),B.g.cancel(),B.g=null)}function so(B){ni(B),B.u&&(E.clearTimeout(B.u),B.u=null),da(B),B.h.cancel(),B.s&&(typeof B.s=="number"&&E.clearTimeout(B.s),B.s=null)}function ii(B){if(!Xs(B.h)&&!B.s){B.s=!0;var ee=B.Ga;rr||gt(),or||(rr(),or=!0),Fr.add(ee,B),B.B=0}}function zs(B,ee){return Ma(B.h)>=B.h.j-(B.s?1:0)?!1:B.s?(B.i=ee.D.concat(B.i),!0):B.G==1||B.G==2||B.B>=(B.Va?0:B.Wa)?!1:(B.s=Ke(H(B.Ga,B,ee),vh(B,B.B)),B.B++,!0)}t.Ga=function(B){if(this.s)if(this.s=null,this.G==1){if(!B){this.U=Math.floor(1e5*Math.random()),B=this.U++;const Bt=new Rr(this,this.j,B);let wt=this.o;if(this.S&&(wt?(wt=ie(wt),te(wt,this.S)):wt=this.S),this.m!==null||this.O||(Bt.H=wt,wt=null),this.P)e:{for(var ee=0,de=0;de<this.i.length;de++){t:{var Me=this.i[de];if("__data__"in Me.map&&(Me=Me.map.__data__,typeof Me=="string")){Me=Me.length;break t}Me=void 0}if(Me===void 0)break;if(ee+=Me,4096<ee){ee=de;break e}if(ee===4096||de===this.i.length-1){ee=de+1;break e}}ee=1e3}else ee=1e3;ee=ha(this,Bt,ee),de=go(this.I),ei(de,"RID",B),ei(de,"CVER",22),this.D&&ei(de,"X-HTTP-Session-Id",this.D),Ro(this,de),wt&&(this.O?ee="headers="+encodeURIComponent(String(Bs(wt)))+"&"+ee:this.m&&ss(de,this.m,wt)),ka(this.h,Bt),this.Ua&&ei(de,"TYPE","init"),this.P?(ei(de,"$req",ee),ei(de,"SID","null"),Bt.T=!0,yn(Bt,de,null)):yn(Bt,de,ee),this.G=2}}else this.G==3&&(B?yo(this,B):this.i.length==0||Xs(this.h)||yo(this))};function yo(B,ee){var de;ee?de=ee.l:de=B.U++;const Me=go(B.I);ei(Me,"SID",B.K),ei(Me,"RID",de),ei(Me,"AID",B.T),Ro(B,Me),B.m&&B.o&&ss(Me,B.m,B.o),de=new Rr(B,B.j,de,B.B+1),B.m===null&&(de.H=B.o),ee&&(B.i=ee.D.concat(B.i)),ee=ha(B,de,1e3),de.I=Math.round(.5*B.wa)+Math.round(.5*B.wa*Math.random()),ka(B.h,de),yn(de,Me,ee)}function Ro(B,ee){B.H&&ze(B.H,function(de,Me){ei(ee,Me,de)}),B.l&&ji({},function(de,Me){ei(ee,Me,de)})}function ha(B,ee,de){de=Math.min(B.i.length,de);var Me=B.l?H(B.l.Na,B.l,B):null;e:{var Bt=B.i;let wt=-1;for(;;){const Or=["count="+de];wt==-1?0<de?(wt=Bt[0].g,Or.push("ofs="+wt)):wt=0:Or.push("ofs="+wt);let wi=!0;for(let Dr=0;Dr<de;Dr++){let di=Bt[Dr].g;const zi=Bt[Dr].map;if(di-=wt,0>di)wt=Math.max(0,Bt[Dr].g-100),wi=!1;else try{cr(zi,Or,"req"+di+"_")}catch{Me&&Me(zi)}}if(wi){Me=Or.join("&");break e}}}return B=B.i.splice(0,de),ee.D=B,Me}function Ns(B){if(!B.g&&!B.u){B.Y=1;var ee=B.Fa;rr||gt(),or||(rr(),or=!0),Fr.add(ee,B),B.v=0}}function Fs(B){return B.g||B.u||3<=B.v?!1:(B.Y++,B.u=Ke(H(B.Fa,B),vh(B,B.v)),B.v++,!0)}t.Fa=function(){if(this.u=null,Eu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var B=2*this.R;this.j.info("BP detection timer enabled: "+B),this.A=Ke(H(this.ab,this),B)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,xe(10),ni(this),Eu(this))};function ta(B){B.A!=null&&(E.clearTimeout(B.A),B.A=null)}function Eu(B){B.g=new Rr(B,B.j,"rpc",B.Y),B.m===null&&(B.g.H=B.o),B.g.O=0;var ee=go(B.qa);ei(ee,"RID","rpc"),ei(ee,"SID",B.K),ei(ee,"AID",B.T),ei(ee,"CI",B.F?"0":"1"),!B.F&&B.ja&&ei(ee,"TO",B.ja),ei(ee,"TYPE","xmlhttp"),Ro(B,ee),B.m&&B.o&&ss(ee,B.m,B.o),B.L&&(B.g.I=B.L);var de=B.g;B=B.ia,de.L=1,de.v=ua(go(ee)),de.m=null,de.P=!0,Tn(de,B)}t.Za=function(){this.C!=null&&(this.C=null,ni(this),Fs(this),xe(19))};function da(B){B.C!=null&&(E.clearTimeout(B.C),B.C=null)}function as(B,ee){var de=null;if(B.g==ee){da(B),ta(B),B.g=null;var Me=2}else if(Bo(B.h,ee))de=ee.D,la(B.h,ee),Me=1;else return;if(B.G!=0){if(ee.o)if(Me==1){de=ee.m?ee.m.length:0,ee=Date.now()-ee.F;var Bt=B.B;Me=Ks(),Zr(Me,new Ne(Me,de)),ii(B)}else Ns(B);else if(Bt=ee.s,Bt==3||Bt==0&&0<ee.X||!(Me==1&&zs(B,ee)||Me==2&&Fs(B)))switch(de&&0<de.length&&(ee=B.h,ee.i=ee.i.concat(de)),Bt){case 1:fa(B,5);break;case 4:fa(B,10);break;case 3:fa(B,6);break;default:fa(B,2)}}}function vh(B,ee){let de=B.Ta+Math.floor(Math.random()*B.cb);return B.isActive()||(de*=2),de*ee}function fa(B,ee){if(B.j.info("Error code "+ee),ee==2){var de=H(B.fb,B),Me=B.Xa;const Bt=!Me;Me=new Yi(Me||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||io(Me,"https"),ua(Me),Bt?ai(Me.toString(),de):_o(Me.toString(),de)}else xe(2);B.G=0,B.l&&B.l.sa(ee),Su(B),so(B)}t.fb=function(B){B?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))};function Su(B){if(B.G=0,B.ka=[],B.l){const ee=ca(B.h);(ee.length!=0||B.i.length!=0)&&(ye(B.ka,ee),ye(B.ka,B.i),B.h.i.length=0,ge(B.i),B.i.length=0),B.l.ra()}}function Rl(B,ee,de){var Me=de instanceof Yi?go(de):new Yi(de);if(Me.g!="")ee&&(Me.g=ee+"."+Me.g),_s(Me,Me.s);else{var Bt=E.location;Me=Bt.protocol,ee=ee?ee+"."+Bt.hostname:Bt.hostname,Bt=+Bt.port;var wt=new Yi(null);Me&&io(wt,Me),ee&&(wt.g=ee),Bt&&_s(wt,Bt),de&&(wt.l=de),Me=wt}return de=B.D,ee=B.ya,de&&ee&&ei(Me,de,ee),ei(Me,"VER",B.la),Ro(B,Me),Me}function Pl(B,ee,de){if(ee&&!B.J)throw Error("Can't create secondary domain capable XhrIo object.");return ee=B.Ca&&!B.pa?new mi(new cn({eb:de})):new mi(B.pa),ee.Ha(B.J),ee}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function bh(){}t=bh.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Xa(){}Xa.prototype.g=function(B,ee){return new zo(B,ee)};function zo(B,ee){Wr.call(this),this.g=new fo(ee),this.l=B,this.h=ee&&ee.messageUrlParams||null,B=ee&&ee.messageHeaders||null,ee&&ee.clientProtocolHeaderRequired&&(B?B["X-Client-Protocol"]="webchannel":B={"X-Client-Protocol":"webchannel"}),this.g.o=B,B=ee&&ee.initMessageHeaders||null,ee&&ee.messageContentType&&(B?B["X-WebChannel-Content-Type"]=ee.messageContentType:B={"X-WebChannel-Content-Type":ee.messageContentType}),ee&&ee.va&&(B?B["X-WebChannel-Client-Profile"]=ee.va:B={"X-WebChannel-Client-Profile":ee.va}),this.g.S=B,(B=ee&&ee.Sb)&&!he(B)&&(this.g.m=B),this.v=ee&&ee.supportsCrossDomainXhr||!1,this.u=ee&&ee.sendRawJson||!1,(ee=ee&&ee.httpSessionIdParam)&&!he(ee)&&(this.g.D=ee,B=this.h,B!==null&&ee in B&&(B=this.h,ee in B&&delete B[ee])),this.j=new Vs(this)}Q(zo,Wr),zo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},zo.prototype.close=function(){qn(this.g)},zo.prototype.o=function(B){var ee=this.g;if(typeof B=="string"){var de={};de.__data__=B,B=de}else this.u&&(de={},de.__data__=ns(B),B=de);ee.i.push(new Ka(ee.Ya++,B)),ee.G==3&&ii(ee)},zo.prototype.N=function(){this.g.l=null,delete this.j,qn(this.g),delete this.g,zo.aa.N.call(this)};function xh(B){Lo.call(this),B.__headers__&&(this.headers=B.__headers__,this.statusCode=B.__status__,delete B.__headers__,delete B.__status__);var ee=B.__sm__;if(ee){e:{for(const de in ee){B=de;break e}B=void 0}(this.i=B)&&(B=this.i,ee=ee!==null&&B in ee?ee[B]:void 0),this.data=ee}else this.data=B}Q(xh,Lo);function ra(){jo.call(this),this.status=1}Q(ra,jo);function Vs(B){this.g=B}Q(Vs,bh),Vs.prototype.ua=function(){Zr(this.g,"a")},Vs.prototype.ta=function(B){Zr(this.g,new xh(B))},Vs.prototype.sa=function(B){Zr(this.g,new ra)},Vs.prototype.ra=function(){Zr(this.g,"b")},Xa.prototype.createWebChannel=Xa.prototype.g,zo.prototype.send=zo.prototype.o,zo.prototype.open=zo.prototype.m,zo.prototype.close=zo.prototype.close,VL=function(){return new Xa},FL=function(){return Ks()},NL=is,Yw={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},xt.NO_ERROR=0,xt.TIMEOUT=8,xt.HTTP_ERROR=6,y0=xt,jt.COMPLETE="complete",zL=jt,Do.EventType=bs,bs.OPEN="a",bs.CLOSE="b",bs.ERROR="c",bs.MESSAGE="d",Wr.prototype.listen=Wr.prototype.K,S_=Do,BL=cn,mi.prototype.listenOnce=mi.prototype.L,mi.prototype.getLastError=mi.prototype.Ka,mi.prototype.getLastErrorCode=mi.prototype.Ba,mi.prototype.getStatus=mi.prototype.Z,mi.prototype.getResponseJson=mi.prototype.Oa,mi.prototype.getResponseText=mi.prototype.oa,mi.prototype.send=mi.prototype.ea,mi.prototype.setWithCredentials=mi.prototype.Ha,LL=mi}).apply(typeof i0<"u"?i0:typeof self<"u"?self:typeof window<"u"?window:{});const xP="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ua.UNAUTHENTICATED=new Ua(null),Ua.GOOGLE_CREDENTIALS=new Ua("google-credentials-uid"),Ua.FIRST_PARTY=new Ua("first-party-uid"),Ua.MOCK_USER=new Ua("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tg="10.13.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const np=new iE("@firebase/firestore");function g_(){return np.logLevel}function dn(t,...e){if(np.logLevel<=Ui.DEBUG){const r=e.map(gE);np.debug(`Firestore (${tg}): ${t}`,...r)}}function ph(t,...e){if(np.logLevel<=Ui.ERROR){const r=e.map(gE);np.error(`Firestore (${tg}): ${t}`,...r)}}function Fm(t,...e){if(np.logLevel<=Ui.WARN){const r=e.map(gE);np.warn(`Firestore (${tg}): ${t}`,...r)}}function gE(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gn(t="Unexpected state"){const e=`FIRESTORE (${tg}) INTERNAL ASSERTION FAILED: `+t;throw ph(e),new Error(e)}function Oo(t,e){t||Gn()}function Jn(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Er={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nn extends _h{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(){this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UL{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class HH{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Ua.UNAUTHENTICATED))}shutdown(){}}class WH{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class ZH{constructor(e){this.t=e,this.currentUser=Ua.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,r){let s=this.i;const h=o=>this.i!==s?(s=this.i,r(o)):Promise.resolve();let p=new hh;this.o=()=>{this.i++,this.currentUser=this.u(),p.resolve(),p=new hh,e.enqueueRetryable(()=>h(this.currentUser))};const b=()=>{const o=p;e.enqueueRetryable(async()=>{await o.promise,await h(this.currentUser)})},E=o=>{dn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=o,this.auth.addAuthTokenListener(this.o),b()};this.t.onInit(o=>E(o)),setTimeout(()=>{if(!this.auth){const o=this.t.getImmediate({optional:!0});o?E(o):(dn("FirebaseAuthCredentialsProvider","Auth not yet detected"),p.resolve(),p=new hh)}},0),b()}getToken(){const e=this.i,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(s=>this.i!==e?(dn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):s?(Oo(typeof s.accessToken=="string"),new UL(s.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Oo(e===null||typeof e=="string"),new Ua(e)}}class KH{constructor(e,r,s){this.l=e,this.h=r,this.P=s,this.type="FirstParty",this.user=Ua.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class XH{constructor(e,r,s){this.l=e,this.h=r,this.P=s}getToken(){return Promise.resolve(new KH(this.l,this.h,this.P))}start(e,r){e.enqueueRetryable(()=>r(Ua.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class YH{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class JH{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,r){const s=p=>{p.error!=null&&dn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${p.error.message}`);const b=p.token!==this.R;return this.R=p.token,dn("FirebaseAppCheckTokenProvider",`Received ${b?"new":"existing"} token.`),b?r(p.token):Promise.resolve()};this.o=p=>{e.enqueueRetryable(()=>s(p))};const h=p=>{dn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=p,this.appCheck.addTokenListener(this.o)};this.A.onInit(p=>h(p)),setTimeout(()=>{if(!this.appCheck){const p=this.A.getImmediate({optional:!0});p?h(p):dn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(r=>r?(Oo(typeof r.token=="string"),this.R=r.token,new YH(r.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QH(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let s=0;s<t;s++)r[s]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jL{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let s="";for(;s.length<20;){const h=QH(40);for(let p=0;p<h.length;++p)s.length<20&&h[p]<r&&(s+=e.charAt(h[p]%e.length))}return s}}function no(t,e){return t<e?-1:t>e?1:0}function Vm(t,e,r){return t.length===e.length&&t.every((s,h)=>r(s,e[h]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new nn(Er.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new nn(Er.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new nn(Er.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new nn(Er.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Zs.fromMillis(Date.now())}static fromDate(e){return Zs.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),s=Math.floor(1e6*(e-1e3*r));return new Zs(r,s)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?no(this.nanoseconds,e.nanoseconds):no(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Yn(e)}static min(){return new Yn(new Zs(0,0))}static max(){return new Yn(new Zs(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry{constructor(e,r,s){r===void 0?r=0:r>e.length&&Gn(),s===void 0?s=e.length-r:s>e.length-r&&Gn(),this.segments=e,this.offset=r,this.len=s}get length(){return this.len}isEqual(e){return ry.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof ry?e.forEach(s=>{r.push(s)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,s=this.limit();r<s;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const s=Math.min(e.length,r.length);for(let h=0;h<s;h++){const p=e.get(h),b=r.get(h);if(p<b)return-1;if(p>b)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class Wo extends ry{construct(e,r,s){return new Wo(e,r,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const r=[];for(const s of e){if(s.indexOf("//")>=0)throw new nn(Er.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);r.push(...s.split("/").filter(h=>h.length>0))}return new Wo(r)}static emptyPath(){return new Wo([])}}const e7=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ia extends ry{construct(e,r,s){return new Ia(e,r,s)}static isValidIdentifier(e){return e7.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ia.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ia(["__name__"])}static fromServerFormat(e){const r=[];let s="",h=0;const p=()=>{if(s.length===0)throw new nn(Er.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(s),s=""};let b=!1;for(;h<e.length;){const E=e[h];if(E==="\\"){if(h+1===e.length)throw new nn(Er.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const o=e[h+1];if(o!=="\\"&&o!=="."&&o!=="`")throw new nn(Er.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=o,h+=2}else E==="`"?(b=!b,h++):E!=="."||b?(s+=E,h++):(p(),h++)}if(p(),b)throw new nn(Er.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ia(r)}static emptyPath(){return new Ia([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this.path=e}static fromPath(e){return new In(Wo.fromString(e))}static fromName(e){return new In(Wo.fromString(e).popFirst(5))}static empty(){return new In(Wo.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Wo.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return Wo.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new In(new Wo(e.slice()))}}function t7(t,e){const r=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,h=Yn.fromTimestamp(s===1e9?new Zs(r+1,0):new Zs(r,s));return new Ud(h,In.empty(),e)}function r7(t){return new Ud(t.readTime,t.key,-1)}class Ud{constructor(e,r,s){this.readTime=e,this.documentKey=r,this.largestBatchId=s}static min(){return new Ud(Yn.min(),In.empty(),-1)}static max(){return new Ud(Yn.max(),In.empty(),-1)}}function n7(t,e){let r=t.readTime.compareTo(e.readTime);return r!==0?r:(r=In.comparator(t.documentKey,e.documentKey),r!==0?r:no(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i7="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class o7{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ry(t){if(t.code!==Er.FAILED_PRECONDITION||t.message!==i7)throw t;dn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(r=>{this.isDone=!0,this.result=r,this.nextCallback&&this.nextCallback(r)},r=>{this.isDone=!0,this.error=r,this.catchCallback&&this.catchCallback(r)})}catch(e){return this.next(void 0,e)}next(e,r){return this.callbackAttached&&Gn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(r,this.error):this.wrapSuccess(e,this.result):new Cr((s,h)=>{this.nextCallback=p=>{this.wrapSuccess(e,p).next(s,h)},this.catchCallback=p=>{this.wrapFailure(r,p).next(s,h)}})}toPromise(){return new Promise((e,r)=>{this.next(e,r)})}wrapUserFunction(e){try{const r=e();return r instanceof Cr?r:Cr.resolve(r)}catch(r){return Cr.reject(r)}}wrapSuccess(e,r){return e?this.wrapUserFunction(()=>e(r)):Cr.resolve(r)}wrapFailure(e,r){return e?this.wrapUserFunction(()=>e(r)):Cr.reject(r)}static resolve(e){return new Cr((r,s)=>{r(e)})}static reject(e){return new Cr((r,s)=>{s(e)})}static waitFor(e){return new Cr((r,s)=>{let h=0,p=0,b=!1;e.forEach(E=>{++h,E.next(()=>{++p,b&&p===h&&r()},o=>s(o))}),b=!0,p===h&&r()})}static or(e){let r=Cr.resolve(!1);for(const s of e)r=r.next(h=>h?Cr.resolve(h):s());return r}static forEach(e,r){const s=[];return e.forEach((h,p)=>{s.push(r.call(this,h,p))}),this.waitFor(s)}static mapArray(e,r){return new Cr((s,h)=>{const p=e.length,b=new Array(p);let E=0;for(let o=0;o<p;o++){const O=o;r(e[O]).next(z=>{b[O]=z,++E,E===p&&s(b)},z=>h(z))}})}static doWhile(e,r){return new Cr((s,h)=>{const p=()=>{e()===!0?r().next(()=>{p()},h):s()};p()})}}function s7(t){const e=t.match(/Android ([\d.]+)/i),r=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function Py(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _E{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=s=>this.ie(s),this.se=s=>r.writeSequenceNumber(s))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}_E.oe=-1;function Ob(t){return t==null}function X0(t){return t===0&&1/t==-1/0}function a7(t){return typeof t=="number"&&Number.isInteger(t)&&!X0(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wP(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function dp(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}function $L(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,r){this.comparator=e,this.root=r||Sa.EMPTY}insert(e,r){return new ms(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,Sa.BLACK,null,null))}remove(e){return new ms(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Sa.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return r.value;s<0?r=r.left:s>0&&(r=r.right)}return null}indexOf(e){let r=0,s=this.root;for(;!s.isEmpty();){const h=this.comparator(e,s.key);if(h===0)return r+s.left.size;h<0?s=s.left:(r+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,s)=>(e(r,s),!1))}toString(){const e=[];return this.inorderTraversal((r,s)=>(e.push(`${r}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new o0(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new o0(this.root,e,this.comparator,!1)}getReverseIterator(){return new o0(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new o0(this.root,e,this.comparator,!0)}}class o0{constructor(e,r,s,h){this.isReverse=h,this.nodeStack=[];let p=1;for(;!e.isEmpty();)if(p=r?s(e.key,r):1,r&&h&&(p*=-1),p<0)e=this.isReverse?e.left:e.right;else{if(p===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Sa{constructor(e,r,s,h,p){this.key=e,this.value=r,this.color=s??Sa.RED,this.left=h??Sa.EMPTY,this.right=p??Sa.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,s,h,p){return new Sa(e??this.key,r??this.value,s??this.color,h??this.left,p??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,s){let h=this;const p=s(e,h.key);return h=p<0?h.copy(null,null,null,h.left.insert(e,r,s),null):p===0?h.copy(null,r,null,null,null):h.copy(null,null,null,null,h.right.insert(e,r,s)),h.fixUp()}removeMin(){if(this.left.isEmpty())return Sa.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let s,h=this;if(r(e,h.key)<0)h.left.isEmpty()||h.left.isRed()||h.left.left.isRed()||(h=h.moveRedLeft()),h=h.copy(null,null,null,h.left.remove(e,r),null);else{if(h.left.isRed()&&(h=h.rotateRight()),h.right.isEmpty()||h.right.isRed()||h.right.left.isRed()||(h=h.moveRedRight()),r(e,h.key)===0){if(h.right.isEmpty())return Sa.EMPTY;s=h.right.min(),h=h.copy(s.key,s.value,null,null,h.right.removeMin())}h=h.copy(null,null,null,null,h.right.remove(e,r))}return h.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Sa.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Sa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Gn();const e=this.left.check();if(e!==this.right.check())throw Gn();return e+(this.isRed()?0:1)}}Sa.EMPTY=null,Sa.RED=!0,Sa.BLACK=!1;Sa.EMPTY=new class{constructor(){this.size=0}get key(){throw Gn()}get value(){throw Gn()}get color(){throw Gn()}get left(){throw Gn()}get right(){throw Gn()}copy(e,r,s,h,p){return this}insert(e,r,s){return new Sa(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(e){this.comparator=e,this.data=new ms(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,s)=>(e(r),!1))}forEachInRange(e,r){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const h=s.getNext();if(this.comparator(h.key,e[1])>=0)return;r(h.key)}}forEachWhile(e,r){let s;for(s=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new TP(this.data.getIterator())}getIteratorFrom(e){return new TP(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(s=>{r=r.add(s)}),r}isEqual(e){if(!(e instanceof Aa)||this.size!==e.size)return!1;const r=this.data.getIterator(),s=e.data.getIterator();for(;r.hasNext();){const h=r.getNext().key,p=s.getNext().key;if(this.comparator(h,p)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Aa(this.comparator);return r.data=e,r}}class TP{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e){this.fields=e,e.sort(Ia.comparator)}static empty(){return new Ul([])}unionWith(e){let r=new Aa(Ia.comparator);for(const s of this.fields)r=r.add(s);for(const s of e)r=r.add(s);return new Ul(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return Vm(this.fields,e.fields,(r,s)=>r.isEqual(s))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GL extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pa{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(h){try{return atob(h)}catch(p){throw typeof DOMException<"u"&&p instanceof DOMException?new GL("Invalid base64 string: "+p):p}}(e);return new Pa(r)}static fromUint8Array(e){const r=function(h){let p="";for(let b=0;b<h.length;++b)p+=String.fromCharCode(h[b]);return p}(e);return new Pa(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const s=new Uint8Array(r.length);for(let h=0;h<r.length;h++)s[h]=r.charCodeAt(h);return s}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return no(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Pa.EMPTY_BYTE_STRING=new Pa("");const l7=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jd(t){if(Oo(!!t),typeof t=="string"){let e=0;const r=l7.exec(t);if(Oo(!!r),r[1]){let h=r[1];h=(h+"000000000").substr(0,9),e=Number(h)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ss(t.seconds),nanos:Ss(t.nanos)}}function Ss(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ip(t){return typeof t=="string"?Pa.fromBase64String(t):Pa.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yE(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function vE(t){const e=t.mapValue.fields.__previous_value__;return yE(e)?vE(e):e}function ny(t){const e=jd(t.mapValue.fields.__local_write_time__.timestampValue);return new Zs(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c7{constructor(e,r,s,h,p,b,E,o,O){this.databaseId=e,this.appId=r,this.persistenceKey=s,this.host=h,this.ssl=p,this.forceLongPolling=b,this.autoDetectLongPolling=E,this.longPollingOptions=o,this.useFetchStreams=O}}class iy{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new iy("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof iy&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s0={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function op(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?yE(t)?4:h7(t)?9007199254740991:u7(t)?10:11:Gn()}function bu(t,e){if(t===e)return!0;const r=op(t);if(r!==op(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ny(t).isEqual(ny(e));case 3:return function(h,p){if(typeof h.timestampValue=="string"&&typeof p.timestampValue=="string"&&h.timestampValue.length===p.timestampValue.length)return h.timestampValue===p.timestampValue;const b=jd(h.timestampValue),E=jd(p.timestampValue);return b.seconds===E.seconds&&b.nanos===E.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(h,p){return ip(h.bytesValue).isEqual(ip(p.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(h,p){return Ss(h.geoPointValue.latitude)===Ss(p.geoPointValue.latitude)&&Ss(h.geoPointValue.longitude)===Ss(p.geoPointValue.longitude)}(t,e);case 2:return function(h,p){if("integerValue"in h&&"integerValue"in p)return Ss(h.integerValue)===Ss(p.integerValue);if("doubleValue"in h&&"doubleValue"in p){const b=Ss(h.doubleValue),E=Ss(p.doubleValue);return b===E?X0(b)===X0(E):isNaN(b)&&isNaN(E)}return!1}(t,e);case 9:return Vm(t.arrayValue.values||[],e.arrayValue.values||[],bu);case 10:case 11:return function(h,p){const b=h.mapValue.fields||{},E=p.mapValue.fields||{};if(wP(b)!==wP(E))return!1;for(const o in b)if(b.hasOwnProperty(o)&&(E[o]===void 0||!bu(b[o],E[o])))return!1;return!0}(t,e);default:return Gn()}}function oy(t,e){return(t.values||[]).find(r=>bu(r,e))!==void 0}function Um(t,e){if(t===e)return 0;const r=op(t),s=op(e);if(r!==s)return no(r,s);switch(r){case 0:case 9007199254740991:return 0;case 1:return no(t.booleanValue,e.booleanValue);case 2:return function(p,b){const E=Ss(p.integerValue||p.doubleValue),o=Ss(b.integerValue||b.doubleValue);return E<o?-1:E>o?1:E===o?0:isNaN(E)?isNaN(o)?0:-1:1}(t,e);case 3:return EP(t.timestampValue,e.timestampValue);case 4:return EP(ny(t),ny(e));case 5:return no(t.stringValue,e.stringValue);case 6:return function(p,b){const E=ip(p),o=ip(b);return E.compareTo(o)}(t.bytesValue,e.bytesValue);case 7:return function(p,b){const E=p.split("/"),o=b.split("/");for(let O=0;O<E.length&&O<o.length;O++){const z=no(E[O],o[O]);if(z!==0)return z}return no(E.length,o.length)}(t.referenceValue,e.referenceValue);case 8:return function(p,b){const E=no(Ss(p.latitude),Ss(b.latitude));return E!==0?E:no(Ss(p.longitude),Ss(b.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return SP(t.arrayValue,e.arrayValue);case 10:return function(p,b){var E,o,O,z;const U=p.fields||{},H=b.fields||{},Y=(E=U.value)===null||E===void 0?void 0:E.arrayValue,Q=(o=H.value)===null||o===void 0?void 0:o.arrayValue,ge=no(((O=Y==null?void 0:Y.values)===null||O===void 0?void 0:O.length)||0,((z=Q==null?void 0:Q.values)===null||z===void 0?void 0:z.length)||0);return ge!==0?ge:SP(Y,Q)}(t.mapValue,e.mapValue);case 11:return function(p,b){if(p===s0.mapValue&&b===s0.mapValue)return 0;if(p===s0.mapValue)return 1;if(b===s0.mapValue)return-1;const E=p.fields||{},o=Object.keys(E),O=b.fields||{},z=Object.keys(O);o.sort(),z.sort();for(let U=0;U<o.length&&U<z.length;++U){const H=no(o[U],z[U]);if(H!==0)return H;const Y=Um(E[o[U]],O[z[U]]);if(Y!==0)return Y}return no(o.length,z.length)}(t.mapValue,e.mapValue);default:throw Gn()}}function EP(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return no(t,e);const r=jd(t),s=jd(e),h=no(r.seconds,s.seconds);return h!==0?h:no(r.nanos,s.nanos)}function SP(t,e){const r=t.values||[],s=e.values||[];for(let h=0;h<r.length&&h<s.length;++h){const p=Um(r[h],s[h]);if(p)return p}return no(r.length,s.length)}function jm(t){return Jw(t)}function Jw(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(r){const s=jd(r);return`time(${s.seconds},${s.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(r){return ip(r).toBase64()}(t.bytesValue):"referenceValue"in t?function(r){return In.fromName(r).toString()}(t.referenceValue):"geoPointValue"in t?function(r){return`geo(${r.latitude},${r.longitude})`}(t.geoPointValue):"arrayValue"in t?function(r){let s="[",h=!0;for(const p of r.values||[])h?h=!1:s+=",",s+=Jw(p);return s+"]"}(t.arrayValue):"mapValue"in t?function(r){const s=Object.keys(r.fields||{}).sort();let h="{",p=!0;for(const b of s)p?p=!1:h+=",",h+=`${b}:${Jw(r.fields[b])}`;return h+"}"}(t.mapValue):Gn()}function IP(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Qw(t){return!!t&&"integerValue"in t}function bE(t){return!!t&&"arrayValue"in t}function AP(t){return!!t&&"nullValue"in t}function CP(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function v0(t){return!!t&&"mapValue"in t}function u7(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="__vector__"}function N_(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return dp(t.mapValue.fields,(r,s)=>e.mapValue.fields[r]=N_(s)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=N_(t.arrayValue.values[r]);return e}return Object.assign({},t)}function h7(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xl{constructor(e){this.value=e}static empty(){return new xl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let s=0;s<e.length-1;++s)if(r=(r.mapValue.fields||{})[e.get(s)],!v0(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=N_(r)}setAll(e){let r=Ia.emptyPath(),s={},h=[];e.forEach((b,E)=>{if(!r.isImmediateParentOf(E)){const o=this.getFieldsMap(r);this.applyChanges(o,s,h),s={},h=[],r=E.popLast()}b?s[E.lastSegment()]=N_(b):h.push(E.lastSegment())});const p=this.getFieldsMap(r);this.applyChanges(p,s,h)}delete(e){const r=this.field(e.popLast());v0(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return bu(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let s=0;s<e.length;++s){let h=r.mapValue.fields[e.get(s)];v0(h)&&h.mapValue.fields||(h={mapValue:{fields:{}}},r.mapValue.fields[e.get(s)]=h),r=h}return r.mapValue.fields}applyChanges(e,r,s){dp(r,(h,p)=>e[h]=p);for(const h of s)delete e[h]}clone(){return new xl(N_(this.value))}}function qL(t){const e=[];return dp(t.fields,(r,s)=>{const h=new Ia([r]);if(v0(s)){const p=qL(s.mapValue).fields;if(p.length===0)e.push(h);else for(const b of p)e.push(h.child(b))}else e.push(h)}),new Ul(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e,r,s,h,p,b,E){this.key=e,this.documentType=r,this.version=s,this.readTime=h,this.createTime=p,this.data=b,this.documentState=E}static newInvalidDocument(e){return new $a(e,0,Yn.min(),Yn.min(),Yn.min(),xl.empty(),0)}static newFoundDocument(e,r,s,h){return new $a(e,1,r,Yn.min(),s,h,0)}static newNoDocument(e,r){return new $a(e,2,r,Yn.min(),Yn.min(),xl.empty(),0)}static newUnknownDocument(e,r){return new $a(e,3,r,Yn.min(),Yn.min(),xl.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(Yn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Yn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $a&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $a(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y0{constructor(e,r){this.position=e,this.inclusive=r}}function RP(t,e,r){let s=0;for(let h=0;h<t.position.length;h++){const p=e[h],b=t.position[h];if(p.field.isKeyField()?s=In.comparator(In.fromName(b.referenceValue),r.key):s=Um(b,r.data.field(p.field)),p.dir==="desc"&&(s*=-1),s!==0)break}return s}function PP(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let r=0;r<t.position.length;r++)if(!bu(t.position[r],e.position[r]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(e,r="asc"){this.field=e,this.dir=r}}function d7(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HL{}class Ls extends HL{constructor(e,r,s){super(),this.field=e,this.op=r,this.value=s}static create(e,r,s){return e.isKeyField()?r==="in"||r==="not-in"?this.createKeyFieldInFilter(e,r,s):new p7(e,r,s):r==="array-contains"?new _7(e,s):r==="in"?new y7(e,s):r==="not-in"?new v7(e,s):r==="array-contains-any"?new b7(e,s):new Ls(e,r,s)}static createKeyFieldInFilter(e,r,s){return r==="in"?new m7(e,s):new g7(e,s)}matches(e){const r=e.data.field(this.field);return this.op==="!="?r!==null&&this.matchesComparison(Um(r,this.value)):r!==null&&op(this.value)===op(r)&&this.matchesComparison(Um(r,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Gn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Nc extends HL{constructor(e,r){super(),this.filters=e,this.op=r,this.ae=null}static create(e,r){return new Nc(e,r)}matches(e){return WL(this)?this.filters.find(r=>!r.matches(e))===void 0:this.filters.find(r=>r.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,r)=>e.concat(r.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function WL(t){return t.op==="and"}function ZL(t){return f7(t)&&WL(t)}function f7(t){for(const e of t.filters)if(e instanceof Nc)return!1;return!0}function eT(t){if(t instanceof Ls)return t.field.canonicalString()+t.op.toString()+jm(t.value);if(ZL(t))return t.filters.map(e=>eT(e)).join(",");{const e=t.filters.map(r=>eT(r)).join(",");return`${t.op}(${e})`}}function KL(t,e){return t instanceof Ls?function(s,h){return h instanceof Ls&&s.op===h.op&&s.field.isEqual(h.field)&&bu(s.value,h.value)}(t,e):t instanceof Nc?function(s,h){return h instanceof Nc&&s.op===h.op&&s.filters.length===h.filters.length?s.filters.reduce((p,b,E)=>p&&KL(b,h.filters[E]),!0):!1}(t,e):void Gn()}function XL(t){return t instanceof Ls?function(r){return`${r.field.canonicalString()} ${r.op} ${jm(r.value)}`}(t):t instanceof Nc?function(r){return r.op.toString()+" {"+r.getFilters().map(XL).join(" ,")+"}"}(t):"Filter"}class p7 extends Ls{constructor(e,r,s){super(e,r,s),this.key=In.fromName(s.referenceValue)}matches(e){const r=In.comparator(e.key,this.key);return this.matchesComparison(r)}}class m7 extends Ls{constructor(e,r){super(e,"in",r),this.keys=YL("in",r)}matches(e){return this.keys.some(r=>r.isEqual(e.key))}}class g7 extends Ls{constructor(e,r){super(e,"not-in",r),this.keys=YL("not-in",r)}matches(e){return!this.keys.some(r=>r.isEqual(e.key))}}function YL(t,e){var r;return(((r=e.arrayValue)===null||r===void 0?void 0:r.values)||[]).map(s=>In.fromName(s.referenceValue))}class _7 extends Ls{constructor(e,r){super(e,"array-contains",r)}matches(e){const r=e.data.field(this.field);return bE(r)&&oy(r.arrayValue,this.value)}}class y7 extends Ls{constructor(e,r){super(e,"in",r)}matches(e){const r=e.data.field(this.field);return r!==null&&oy(this.value.arrayValue,r)}}class v7 extends Ls{constructor(e,r){super(e,"not-in",r)}matches(e){if(oy(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const r=e.data.field(this.field);return r!==null&&!oy(this.value.arrayValue,r)}}class b7 extends Ls{constructor(e,r){super(e,"array-contains-any",r)}matches(e){const r=e.data.field(this.field);return!(!bE(r)||!r.arrayValue.values)&&r.arrayValue.values.some(s=>oy(this.value.arrayValue,s))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x7{constructor(e,r=null,s=[],h=[],p=null,b=null,E=null){this.path=e,this.collectionGroup=r,this.orderBy=s,this.filters=h,this.limit=p,this.startAt=b,this.endAt=E,this.ue=null}}function MP(t,e=null,r=[],s=[],h=null,p=null,b=null){return new x7(t,e,r,s,h,p,b)}function xE(t){const e=Jn(t);if(e.ue===null){let r=e.path.canonicalString();e.collectionGroup!==null&&(r+="|cg:"+e.collectionGroup),r+="|f:",r+=e.filters.map(s=>eT(s)).join(","),r+="|ob:",r+=e.orderBy.map(s=>function(p){return p.field.canonicalString()+p.dir}(s)).join(","),Ob(e.limit)||(r+="|l:",r+=e.limit),e.startAt&&(r+="|lb:",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(s=>jm(s)).join(",")),e.endAt&&(r+="|ub:",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(s=>jm(s)).join(",")),e.ue=r}return e.ue}function wE(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let r=0;r<t.orderBy.length;r++)if(!d7(t.orderBy[r],e.orderBy[r]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(!KL(t.filters[r],e.filters[r]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!PP(t.startAt,e.startAt)&&PP(t.endAt,e.endAt)}function tT(t){return In.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class My{constructor(e,r=null,s=[],h=[],p=null,b="F",E=null,o=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=s,this.filters=h,this.limit=p,this.limitType=b,this.startAt=E,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function w7(t,e,r,s,h,p,b,E){return new My(t,e,r,s,h,p,b,E)}function TE(t){return new My(t)}function kP(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function JL(t){return t.collectionGroup!==null}function F_(t){const e=Jn(t);if(e.ce===null){e.ce=[];const r=new Set;for(const p of e.explicitOrderBy)e.ce.push(p),r.add(p.field.canonicalString());const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(b){let E=new Aa(Ia.comparator);return b.filters.forEach(o=>{o.getFlattenedFilters().forEach(O=>{O.isInequality()&&(E=E.add(O.field))})}),E})(e).forEach(p=>{r.has(p.canonicalString())||p.isKeyField()||e.ce.push(new J0(p,s))}),r.has(Ia.keyField().canonicalString())||e.ce.push(new J0(Ia.keyField(),s))}return e.ce}function mu(t){const e=Jn(t);return e.le||(e.le=T7(e,F_(t))),e.le}function T7(t,e){if(t.limitType==="F")return MP(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(h=>{const p=h.dir==="desc"?"asc":"desc";return new J0(h.field,p)});const r=t.endAt?new Y0(t.endAt.position,t.endAt.inclusive):null,s=t.startAt?new Y0(t.startAt.position,t.startAt.inclusive):null;return MP(t.path,t.collectionGroup,e,t.filters,t.limit,r,s)}}function rT(t,e){const r=t.filters.concat([e]);return new My(t.path,t.collectionGroup,t.explicitOrderBy.slice(),r,t.limit,t.limitType,t.startAt,t.endAt)}function nT(t,e,r){return new My(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,r,t.startAt,t.endAt)}function Db(t,e){return wE(mu(t),mu(e))&&t.limitType===e.limitType}function QL(t){return`${xE(mu(t))}|lt:${t.limitType}`}function dm(t){return`Query(target=${function(r){let s=r.path.canonicalString();return r.collectionGroup!==null&&(s+=" collectionGroup="+r.collectionGroup),r.filters.length>0&&(s+=`, filters: [${r.filters.map(h=>XL(h)).join(", ")}]`),Ob(r.limit)||(s+=", limit: "+r.limit),r.orderBy.length>0&&(s+=`, orderBy: [${r.orderBy.map(h=>function(b){return`${b.field.canonicalString()} (${b.dir})`}(h)).join(", ")}]`),r.startAt&&(s+=", startAt: ",s+=r.startAt.inclusive?"b:":"a:",s+=r.startAt.position.map(h=>jm(h)).join(",")),r.endAt&&(s+=", endAt: ",s+=r.endAt.inclusive?"a:":"b:",s+=r.endAt.position.map(h=>jm(h)).join(",")),`Target(${s})`}(mu(t))}; limitType=${t.limitType})`}function Lb(t,e){return e.isFoundDocument()&&function(s,h){const p=h.key.path;return s.collectionGroup!==null?h.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(p):In.isDocumentKey(s.path)?s.path.isEqual(p):s.path.isImmediateParentOf(p)}(t,e)&&function(s,h){for(const p of F_(s))if(!p.field.isKeyField()&&h.data.field(p.field)===null)return!1;return!0}(t,e)&&function(s,h){for(const p of s.filters)if(!p.matches(h))return!1;return!0}(t,e)&&function(s,h){return!(s.startAt&&!function(b,E,o){const O=RP(b,E,o);return b.inclusive?O<=0:O<0}(s.startAt,F_(s),h)||s.endAt&&!function(b,E,o){const O=RP(b,E,o);return b.inclusive?O>=0:O>0}(s.endAt,F_(s),h))}(t,e)}function E7(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function eB(t){return(e,r)=>{let s=!1;for(const h of F_(t)){const p=S7(h,e,r);if(p!==0)return p;s=s||h.field.isKeyField()}return 0}}function S7(t,e,r){const s=t.field.isKeyField()?In.comparator(e.key,r.key):function(p,b,E){const o=b.data.field(p),O=E.data.field(p);return o!==null&&O!==null?Um(o,O):Gn()}(t.field,e,r);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Gn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rg{constructor(e,r){this.mapKeyFn=e,this.equalsFn=r,this.inner={},this.innerSize=0}get(e){const r=this.mapKeyFn(e),s=this.inner[r];if(s!==void 0){for(const[h,p]of s)if(this.equalsFn(h,e))return p}}has(e){return this.get(e)!==void 0}set(e,r){const s=this.mapKeyFn(e),h=this.inner[s];if(h===void 0)return this.inner[s]=[[e,r]],void this.innerSize++;for(let p=0;p<h.length;p++)if(this.equalsFn(h[p][0],e))return void(h[p]=[e,r]);h.push([e,r]),this.innerSize++}delete(e){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return!1;for(let h=0;h<s.length;h++)if(this.equalsFn(s[h][0],e))return s.length===1?delete this.inner[r]:s.splice(h,1),this.innerSize--,!0;return!1}forEach(e){dp(this.inner,(r,s)=>{for(const[h,p]of s)e(h,p)})}isEmpty(){return $L(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I7=new ms(In.comparator);function mh(){return I7}const tB=new ms(In.comparator);function I_(...t){let e=tB;for(const r of t)e=e.insert(r.key,r);return e}function rB(t){let e=tB;return t.forEach((r,s)=>e=e.insert(r,s.overlayedDocument)),e}function Nf(){return V_()}function nB(){return V_()}function V_(){return new rg(t=>t.toString(),(t,e)=>t.isEqual(e))}const A7=new ms(In.comparator),C7=new Aa(In.comparator);function Mi(...t){let e=C7;for(const r of t)e=e.add(r);return e}const R7=new Aa(no);function P7(){return R7}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EE(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:X0(e)?"-0":e}}function iB(t){return{integerValue:""+t}}function M7(t,e){return a7(e)?iB(e):EE(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(){this._=void 0}}function k7(t,e,r){return t instanceof Q0?function(h,p){const b={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:h.seconds,nanos:h.nanoseconds}}}};return p&&yE(p)&&(p=vE(p)),p&&(b.fields.__previous_value__=p),{mapValue:b}}(r,e):t instanceof sy?sB(t,e):t instanceof ay?aB(t,e):function(h,p){const b=oB(h,p),E=OP(b)+OP(h.Pe);return Qw(b)&&Qw(h.Pe)?iB(E):EE(h.serializer,E)}(t,e)}function O7(t,e,r){return t instanceof sy?sB(t,e):t instanceof ay?aB(t,e):r}function oB(t,e){return t instanceof eb?function(s){return Qw(s)||function(p){return!!p&&"doubleValue"in p}(s)}(e)?e:{integerValue:0}:null}class Q0 extends Bb{}class sy extends Bb{constructor(e){super(),this.elements=e}}function sB(t,e){const r=lB(e);for(const s of t.elements)r.some(h=>bu(h,s))||r.push(s);return{arrayValue:{values:r}}}class ay extends Bb{constructor(e){super(),this.elements=e}}function aB(t,e){let r=lB(e);for(const s of t.elements)r=r.filter(h=>!bu(h,s));return{arrayValue:{values:r}}}class eb extends Bb{constructor(e,r){super(),this.serializer=e,this.Pe=r}}function OP(t){return Ss(t.integerValue||t.doubleValue)}function lB(t){return bE(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function D7(t,e){return t.field.isEqual(e.field)&&function(s,h){return s instanceof sy&&h instanceof sy||s instanceof ay&&h instanceof ay?Vm(s.elements,h.elements,bu):s instanceof eb&&h instanceof eb?bu(s.Pe,h.Pe):s instanceof Q0&&h instanceof Q0}(t.transform,e.transform)}class L7{constructor(e,r){this.version=e,this.transformResults=r}}class gu{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new gu}static exists(e){return new gu(void 0,e)}static updateTime(e){return new gu(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function b0(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class zb{}function cB(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new hB(t.key,gu.none()):new ky(t.key,t.data,gu.none());{const r=t.data,s=xl.empty();let h=new Aa(Ia.comparator);for(let p of e.fields)if(!h.has(p)){let b=r.field(p);b===null&&p.length>1&&(p=p.popLast(),b=r.field(p)),b===null?s.delete(p):s.set(p,b),h=h.add(p)}return new Xd(t.key,s,new Ul(h.toArray()),gu.none())}}function B7(t,e,r){t instanceof ky?function(h,p,b){const E=h.value.clone(),o=LP(h.fieldTransforms,p,b.transformResults);E.setAll(o),p.convertToFoundDocument(b.version,E).setHasCommittedMutations()}(t,e,r):t instanceof Xd?function(h,p,b){if(!b0(h.precondition,p))return void p.convertToUnknownDocument(b.version);const E=LP(h.fieldTransforms,p,b.transformResults),o=p.data;o.setAll(uB(h)),o.setAll(E),p.convertToFoundDocument(b.version,o).setHasCommittedMutations()}(t,e,r):function(h,p,b){p.convertToNoDocument(b.version).setHasCommittedMutations()}(0,e,r)}function U_(t,e,r,s){return t instanceof ky?function(p,b,E,o){if(!b0(p.precondition,b))return E;const O=p.value.clone(),z=BP(p.fieldTransforms,o,b);return O.setAll(z),b.convertToFoundDocument(b.version,O).setHasLocalMutations(),null}(t,e,r,s):t instanceof Xd?function(p,b,E,o){if(!b0(p.precondition,b))return E;const O=BP(p.fieldTransforms,o,b),z=b.data;return z.setAll(uB(p)),z.setAll(O),b.convertToFoundDocument(b.version,z).setHasLocalMutations(),E===null?null:E.unionWith(p.fieldMask.fields).unionWith(p.fieldTransforms.map(U=>U.field))}(t,e,r,s):function(p,b,E){return b0(p.precondition,b)?(b.convertToNoDocument(b.version).setHasLocalMutations(),null):E}(t,e,r)}function z7(t,e){let r=null;for(const s of t.fieldTransforms){const h=e.data.field(s.field),p=oB(s.transform,h||null);p!=null&&(r===null&&(r=xl.empty()),r.set(s.field,p))}return r||null}function DP(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(s,h){return s===void 0&&h===void 0||!(!s||!h)&&Vm(s,h,(p,b)=>D7(p,b))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ky extends zb{constructor(e,r,s,h=[]){super(),this.key=e,this.value=r,this.precondition=s,this.fieldTransforms=h,this.type=0}getFieldMask(){return null}}class Xd extends zb{constructor(e,r,s,h,p=[]){super(),this.key=e,this.data=r,this.fieldMask=s,this.precondition=h,this.fieldTransforms=p,this.type=1}getFieldMask(){return this.fieldMask}}function uB(t){const e=new Map;return t.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const s=t.data.field(r);e.set(r,s)}}),e}function LP(t,e,r){const s=new Map;Oo(t.length===r.length);for(let h=0;h<r.length;h++){const p=t[h],b=p.transform,E=e.data.field(p.field);s.set(p.field,O7(b,E,r[h]))}return s}function BP(t,e,r){const s=new Map;for(const h of t){const p=h.transform,b=r.data.field(h.field);s.set(h.field,k7(p,b,e))}return s}class hB extends zb{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class N7 extends zb{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{constructor(e,r,s,h){this.batchId=e,this.localWriteTime=r,this.baseMutations=s,this.mutations=h}applyToRemoteDocument(e,r){const s=r.mutationResults;for(let h=0;h<this.mutations.length;h++){const p=this.mutations[h];p.key.isEqual(e.key)&&B7(p,e,s[h])}}applyToLocalView(e,r){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(r=U_(s,e,r,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(r=U_(s,e,r,this.localWriteTime));return r}applyToLocalDocumentSet(e,r){const s=nB();return this.mutations.forEach(h=>{const p=e.get(h.key),b=p.overlayedDocument;let E=this.applyToLocalView(b,p.mutatedFields);E=r.has(h.key)?null:E;const o=cB(b,E);o!==null&&s.set(h.key,o),b.isValidDocument()||b.convertToNoDocument(Yn.min())}),s}keys(){return this.mutations.reduce((e,r)=>e.add(r.key),Mi())}isEqual(e){return this.batchId===e.batchId&&Vm(this.mutations,e.mutations,(r,s)=>DP(r,s))&&Vm(this.baseMutations,e.baseMutations,(r,s)=>DP(r,s))}}class SE{constructor(e,r,s,h){this.batch=e,this.commitVersion=r,this.mutationResults=s,this.docVersions=h}static from(e,r,s){Oo(e.mutations.length===s.length);let h=function(){return A7}();const p=e.mutations;for(let b=0;b<p.length;b++)h=h.insert(p[b].key,s[b].version);return new SE(e,r,s,h)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V7{constructor(e,r){this.largestBatchId=e,this.mutation=r}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U7{constructor(e,r){this.count=e,this.unchangedNames=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ks,Zi;function j7(t){switch(t){default:return Gn();case Er.CANCELLED:case Er.UNKNOWN:case Er.DEADLINE_EXCEEDED:case Er.RESOURCE_EXHAUSTED:case Er.INTERNAL:case Er.UNAVAILABLE:case Er.UNAUTHENTICATED:return!1;case Er.INVALID_ARGUMENT:case Er.NOT_FOUND:case Er.ALREADY_EXISTS:case Er.PERMISSION_DENIED:case Er.FAILED_PRECONDITION:case Er.ABORTED:case Er.OUT_OF_RANGE:case Er.UNIMPLEMENTED:case Er.DATA_LOSS:return!0}}function dB(t){if(t===void 0)return ph("GRPC error has no .code"),Er.UNKNOWN;switch(t){case ks.OK:return Er.OK;case ks.CANCELLED:return Er.CANCELLED;case ks.UNKNOWN:return Er.UNKNOWN;case ks.DEADLINE_EXCEEDED:return Er.DEADLINE_EXCEEDED;case ks.RESOURCE_EXHAUSTED:return Er.RESOURCE_EXHAUSTED;case ks.INTERNAL:return Er.INTERNAL;case ks.UNAVAILABLE:return Er.UNAVAILABLE;case ks.UNAUTHENTICATED:return Er.UNAUTHENTICATED;case ks.INVALID_ARGUMENT:return Er.INVALID_ARGUMENT;case ks.NOT_FOUND:return Er.NOT_FOUND;case ks.ALREADY_EXISTS:return Er.ALREADY_EXISTS;case ks.PERMISSION_DENIED:return Er.PERMISSION_DENIED;case ks.FAILED_PRECONDITION:return Er.FAILED_PRECONDITION;case ks.ABORTED:return Er.ABORTED;case ks.OUT_OF_RANGE:return Er.OUT_OF_RANGE;case ks.UNIMPLEMENTED:return Er.UNIMPLEMENTED;case ks.DATA_LOSS:return Er.DATA_LOSS;default:return Gn()}}(Zi=ks||(ks={}))[Zi.OK=0]="OK",Zi[Zi.CANCELLED=1]="CANCELLED",Zi[Zi.UNKNOWN=2]="UNKNOWN",Zi[Zi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zi[Zi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zi[Zi.NOT_FOUND=5]="NOT_FOUND",Zi[Zi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zi[Zi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zi[Zi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zi[Zi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zi[Zi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zi[Zi.ABORTED=10]="ABORTED",Zi[Zi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zi[Zi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zi[Zi.INTERNAL=13]="INTERNAL",Zi[Zi.UNAVAILABLE=14]="UNAVAILABLE",Zi[Zi.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $7(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G7=new Zf([4294967295,4294967295],0);function zP(t){const e=$7().encode(t),r=new DL;return r.update(e),new Uint8Array(r.digest())}function NP(t){const e=new DataView(t.buffer),r=e.getUint32(0,!0),s=e.getUint32(4,!0),h=e.getUint32(8,!0),p=e.getUint32(12,!0);return[new Zf([r,s],0),new Zf([h,p],0)]}class IE{constructor(e,r,s){if(this.bitmap=e,this.padding=r,this.hashCount=s,r<0||r>=8)throw new A_(`Invalid padding: ${r}`);if(s<0)throw new A_(`Invalid hash count: ${s}`);if(e.length>0&&this.hashCount===0)throw new A_(`Invalid hash count: ${s}`);if(e.length===0&&r!==0)throw new A_(`Invalid padding when bitmap length is 0: ${r}`);this.Ie=8*e.length-r,this.Te=Zf.fromNumber(this.Ie)}Ee(e,r,s){let h=e.add(r.multiply(Zf.fromNumber(s)));return h.compare(G7)===1&&(h=new Zf([h.getBits(0),h.getBits(1)],0)),h.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const r=zP(e),[s,h]=NP(r);for(let p=0;p<this.hashCount;p++){const b=this.Ee(s,h,p);if(!this.de(b))return!1}return!0}static create(e,r,s){const h=e%8==0?0:8-e%8,p=new Uint8Array(Math.ceil(e/8)),b=new IE(p,h,r);return s.forEach(E=>b.insert(E)),b}insert(e){if(this.Ie===0)return;const r=zP(e),[s,h]=NP(r);for(let p=0;p<this.hashCount;p++){const b=this.Ee(s,h,p);this.Ae(b)}}Ae(e){const r=Math.floor(e/8),s=e%8;this.bitmap[r]|=1<<s}}class A_ extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(e,r,s,h,p){this.snapshotVersion=e,this.targetChanges=r,this.targetMismatches=s,this.documentUpdates=h,this.resolvedLimboDocuments=p}static createSynthesizedRemoteEventForCurrentChange(e,r,s){const h=new Map;return h.set(e,Oy.createSynthesizedTargetChangeForCurrentChange(e,r,s)),new Nb(Yn.min(),h,new ms(no),mh(),Mi())}}class Oy{constructor(e,r,s,h,p){this.resumeToken=e,this.current=r,this.addedDocuments=s,this.modifiedDocuments=h,this.removedDocuments=p}static createSynthesizedTargetChangeForCurrentChange(e,r,s){return new Oy(s,r,Mi(),Mi(),Mi())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,r,s,h){this.Re=e,this.removedTargetIds=r,this.key=s,this.Ve=h}}class fB{constructor(e,r){this.targetId=e,this.me=r}}class pB{constructor(e,r,s=Pa.EMPTY_BYTE_STRING,h=null){this.state=e,this.targetIds=r,this.resumeToken=s,this.cause=h}}class FP{constructor(){this.fe=0,this.ge=UP(),this.pe=Pa.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Mi(),r=Mi(),s=Mi();return this.ge.forEach((h,p)=>{switch(p){case 0:e=e.add(h);break;case 2:r=r.add(h);break;case 1:s=s.add(h);break;default:Gn()}}),new Oy(this.pe,this.ye,e,r,s)}Ce(){this.we=!1,this.ge=UP()}Fe(e,r){this.we=!0,this.ge=this.ge.insert(e,r)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,Oo(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class q7{constructor(e){this.Le=e,this.Be=new Map,this.ke=mh(),this.qe=VP(),this.Qe=new ms(no)}Ke(e){for(const r of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(r,e.Ve):this.Ue(r,e.key,e.Ve);for(const r of e.removedTargetIds)this.Ue(r,e.key,e.Ve)}We(e){this.forEachTarget(e,r=>{const s=this.Ge(r);switch(e.state){case 0:this.ze(r)&&s.De(e.resumeToken);break;case 1:s.Oe(),s.Se||s.Ce(),s.De(e.resumeToken);break;case 2:s.Oe(),s.Se||this.removeTarget(r);break;case 3:this.ze(r)&&(s.Ne(),s.De(e.resumeToken));break;case 4:this.ze(r)&&(this.je(r),s.De(e.resumeToken));break;default:Gn()}})}forEachTarget(e,r){e.targetIds.length>0?e.targetIds.forEach(r):this.Be.forEach((s,h)=>{this.ze(h)&&r(h)})}He(e){const r=e.targetId,s=e.me.count,h=this.Je(r);if(h){const p=h.target;if(tT(p))if(s===0){const b=new In(p.path);this.Ue(r,b,$a.newNoDocument(b,Yn.min()))}else Oo(s===1);else{const b=this.Ye(r);if(b!==s){const E=this.Ze(e),o=E?this.Xe(E,e,b):1;if(o!==0){this.je(r);const O=o===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(r,O)}}}}}Ze(e){const r=e.me.unchangedNames;if(!r||!r.bits)return null;const{bits:{bitmap:s="",padding:h=0},hashCount:p=0}=r;let b,E;try{b=ip(s).toUint8Array()}catch(o){if(o instanceof GL)return Fm("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{E=new IE(b,h,p)}catch(o){return Fm(o instanceof A_?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return E.Ie===0?null:E}Xe(e,r,s){return r.me.count===s-this.nt(e,r.targetId)?0:2}nt(e,r){const s=this.Le.getRemoteKeysForTarget(r);let h=0;return s.forEach(p=>{const b=this.Le.tt(),E=`projects/${b.projectId}/databases/${b.database}/documents/${p.path.canonicalString()}`;e.mightContain(E)||(this.Ue(r,p,null),h++)}),h}rt(e){const r=new Map;this.Be.forEach((p,b)=>{const E=this.Je(b);if(E){if(p.current&&tT(E.target)){const o=new In(E.target.path);this.ke.get(o)!==null||this.it(b,o)||this.Ue(b,o,$a.newNoDocument(o,e))}p.be&&(r.set(b,p.ve()),p.Ce())}});let s=Mi();this.qe.forEach((p,b)=>{let E=!0;b.forEachWhile(o=>{const O=this.Je(o);return!O||O.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(s=s.add(p))}),this.ke.forEach((p,b)=>b.setReadTime(e));const h=new Nb(e,r,this.Qe,this.ke,s);return this.ke=mh(),this.qe=VP(),this.Qe=new ms(no),h}$e(e,r){if(!this.ze(e))return;const s=this.it(e,r.key)?2:0;this.Ge(e).Fe(r.key,s),this.ke=this.ke.insert(r.key,r),this.qe=this.qe.insert(r.key,this.st(r.key).add(e))}Ue(e,r,s){if(!this.ze(e))return;const h=this.Ge(e);this.it(e,r)?h.Fe(r,1):h.Me(r),this.qe=this.qe.insert(r,this.st(r).delete(e)),s&&(this.ke=this.ke.insert(r,s))}removeTarget(e){this.Be.delete(e)}Ye(e){const r=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let r=this.Be.get(e);return r||(r=new FP,this.Be.set(e,r)),r}st(e){let r=this.qe.get(e);return r||(r=new Aa(no),this.qe=this.qe.insert(e,r)),r}ze(e){const r=this.Je(e)!==null;return r||dn("WatchChangeAggregator","Detected inactive target",e),r}Je(e){const r=this.Be.get(e);return r&&r.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new FP),this.Le.getRemoteKeysForTarget(e).forEach(r=>{this.Ue(e,r,null)})}it(e,r){return this.Le.getRemoteKeysForTarget(e).has(r)}}function VP(){return new ms(In.comparator)}function UP(){return new ms(In.comparator)}const H7={asc:"ASCENDING",desc:"DESCENDING"},W7={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Z7={and:"AND",or:"OR"};class K7{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function iT(t,e){return t.useProto3Json||Ob(e)?e:{value:e}}function tb(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function mB(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function X7(t,e){return tb(t,e.toTimestamp())}function _u(t){return Oo(!!t),Yn.fromTimestamp(function(r){const s=jd(r);return new Zs(s.seconds,s.nanos)}(t))}function AE(t,e){return oT(t,e).canonicalString()}function oT(t,e){const r=function(h){return new Wo(["projects",h.projectId,"databases",h.database])}(t).child("documents");return e===void 0?r:r.child(e)}function gB(t){const e=Wo.fromString(t);return Oo(xB(e)),e}function sT(t,e){return AE(t.databaseId,e.path)}function Q1(t,e){const r=gB(e);if(r.get(1)!==t.databaseId.projectId)throw new nn(Er.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new nn(Er.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new In(yB(r))}function _B(t,e){return AE(t.databaseId,e)}function Y7(t){const e=gB(t);return e.length===4?Wo.emptyPath():yB(e)}function aT(t){return new Wo(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function yB(t){return Oo(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function jP(t,e,r){return{name:sT(t,e),fields:r.value.mapValue.fields}}function J7(t,e){let r;if("targetChange"in e){e.targetChange;const s=function(O){return O==="NO_CHANGE"?0:O==="ADD"?1:O==="REMOVE"?2:O==="CURRENT"?3:O==="RESET"?4:Gn()}(e.targetChange.targetChangeType||"NO_CHANGE"),h=e.targetChange.targetIds||[],p=function(O,z){return O.useProto3Json?(Oo(z===void 0||typeof z=="string"),Pa.fromBase64String(z||"")):(Oo(z===void 0||z instanceof Buffer||z instanceof Uint8Array),Pa.fromUint8Array(z||new Uint8Array))}(t,e.targetChange.resumeToken),b=e.targetChange.cause,E=b&&function(O){const z=O.code===void 0?Er.UNKNOWN:dB(O.code);return new nn(z,O.message||"")}(b);r=new pB(s,h,p,E||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const h=Q1(t,s.document.name),p=_u(s.document.updateTime),b=s.document.createTime?_u(s.document.createTime):Yn.min(),E=new xl({mapValue:{fields:s.document.fields}}),o=$a.newFoundDocument(h,p,b,E),O=s.targetIds||[],z=s.removedTargetIds||[];r=new x0(O,z,o.key,o)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const h=Q1(t,s.document),p=s.readTime?_u(s.readTime):Yn.min(),b=$a.newNoDocument(h,p),E=s.removedTargetIds||[];r=new x0([],E,b.key,b)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const h=Q1(t,s.document),p=s.removedTargetIds||[];r=new x0([],p,h,null)}else{if(!("filter"in e))return Gn();{e.filter;const s=e.filter;s.targetId;const{count:h=0,unchangedNames:p}=s,b=new U7(h,p),E=s.targetId;r=new fB(E,b)}}return r}function Q7(t,e){let r;if(e instanceof ky)r={update:jP(t,e.key,e.value)};else if(e instanceof hB)r={delete:sT(t,e.key)};else if(e instanceof Xd)r={update:jP(t,e.key,e.data),updateMask:lW(e.fieldMask)};else{if(!(e instanceof N7))return Gn();r={verify:sT(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(s=>function(p,b){const E=b.transform;if(E instanceof Q0)return{fieldPath:b.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof sy)return{fieldPath:b.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof ay)return{fieldPath:b.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof eb)return{fieldPath:b.field.canonicalString(),increment:E.Pe};throw Gn()}(0,s))),e.precondition.isNone||(r.currentDocument=function(h,p){return p.updateTime!==void 0?{updateTime:X7(h,p.updateTime)}:p.exists!==void 0?{exists:p.exists}:Gn()}(t,e.precondition)),r}function eW(t,e){return t&&t.length>0?(Oo(e!==void 0),t.map(r=>function(h,p){let b=h.updateTime?_u(h.updateTime):_u(p);return b.isEqual(Yn.min())&&(b=_u(p)),new L7(b,h.transformResults||[])}(r,e))):[]}function tW(t,e){return{documents:[_B(t,e.path)]}}function rW(t,e){const r={structuredQuery:{}},s=e.path;let h;e.collectionGroup!==null?(h=s,r.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(h=s.popLast(),r.structuredQuery.from=[{collectionId:s.lastSegment()}]),r.parent=_B(t,h);const p=function(O){if(O.length!==0)return bB(Nc.create(O,"and"))}(e.filters);p&&(r.structuredQuery.where=p);const b=function(O){if(O.length!==0)return O.map(z=>function(H){return{field:fm(H.field),direction:oW(H.dir)}}(z))}(e.orderBy);b&&(r.structuredQuery.orderBy=b);const E=iT(t,e.limit);return E!==null&&(r.structuredQuery.limit=E),e.startAt&&(r.structuredQuery.startAt=function(O){return{before:O.inclusive,values:O.position}}(e.startAt)),e.endAt&&(r.structuredQuery.endAt=function(O){return{before:!O.inclusive,values:O.position}}(e.endAt)),{_t:r,parent:h}}function nW(t){let e=Y7(t.parent);const r=t.structuredQuery,s=r.from?r.from.length:0;let h=null;if(s>0){Oo(s===1);const z=r.from[0];z.allDescendants?h=z.collectionId:e=e.child(z.collectionId)}let p=[];r.where&&(p=function(U){const H=vB(U);return H instanceof Nc&&ZL(H)?H.getFilters():[H]}(r.where));let b=[];r.orderBy&&(b=function(U){return U.map(H=>function(Q){return new J0(pm(Q.field),function(ye){switch(ye){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Q.direction))}(H))}(r.orderBy));let E=null;r.limit&&(E=function(U){let H;return H=typeof U=="object"?U.value:U,Ob(H)?null:H}(r.limit));let o=null;r.startAt&&(o=function(U){const H=!!U.before,Y=U.values||[];return new Y0(Y,H)}(r.startAt));let O=null;return r.endAt&&(O=function(U){const H=!U.before,Y=U.values||[];return new Y0(Y,H)}(r.endAt)),w7(e,h,b,p,E,"F",o,O)}function iW(t,e){const r=function(h){switch(h){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Gn()}}(e.purpose);return r==null?null:{"goog-listen-tags":r}}function vB(t){return t.unaryFilter!==void 0?function(r){switch(r.unaryFilter.op){case"IS_NAN":const s=pm(r.unaryFilter.field);return Ls.create(s,"==",{doubleValue:NaN});case"IS_NULL":const h=pm(r.unaryFilter.field);return Ls.create(h,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const p=pm(r.unaryFilter.field);return Ls.create(p,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const b=pm(r.unaryFilter.field);return Ls.create(b,"!=",{nullValue:"NULL_VALUE"});default:return Gn()}}(t):t.fieldFilter!==void 0?function(r){return Ls.create(pm(r.fieldFilter.field),function(h){switch(h){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Gn()}}(r.fieldFilter.op),r.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(r){return Nc.create(r.compositeFilter.filters.map(s=>vB(s)),function(h){switch(h){case"AND":return"and";case"OR":return"or";default:return Gn()}}(r.compositeFilter.op))}(t):Gn()}function oW(t){return H7[t]}function sW(t){return W7[t]}function aW(t){return Z7[t]}function fm(t){return{fieldPath:t.canonicalString()}}function pm(t){return Ia.fromServerFormat(t.fieldPath)}function bB(t){return t instanceof Ls?function(r){if(r.op==="=="){if(CP(r.value))return{unaryFilter:{field:fm(r.field),op:"IS_NAN"}};if(AP(r.value))return{unaryFilter:{field:fm(r.field),op:"IS_NULL"}}}else if(r.op==="!="){if(CP(r.value))return{unaryFilter:{field:fm(r.field),op:"IS_NOT_NAN"}};if(AP(r.value))return{unaryFilter:{field:fm(r.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fm(r.field),op:sW(r.op),value:r.value}}}(t):t instanceof Nc?function(r){const s=r.getFilters().map(h=>bB(h));return s.length===1?s[0]:{compositeFilter:{op:aW(r.op),filters:s}}}(t):Gn()}function lW(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function xB(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id{constructor(e,r,s,h,p=Yn.min(),b=Yn.min(),E=Pa.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=r,this.purpose=s,this.sequenceNumber=h,this.snapshotVersion=p,this.lastLimboFreeSnapshotVersion=b,this.resumeToken=E,this.expectedCount=o}withSequenceNumber(e){return new Id(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,r){return new Id(this.target,this.targetId,this.purpose,this.sequenceNumber,r,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Id(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Id(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cW{constructor(e){this.ct=e}}function uW(t){const e=nW({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?nT(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hW{constructor(){this.un=new dW}addToCollectionParentIndex(e,r){return this.un.add(r),Cr.resolve()}getCollectionParents(e,r){return Cr.resolve(this.un.getEntries(r))}addFieldIndex(e,r){return Cr.resolve()}deleteFieldIndex(e,r){return Cr.resolve()}deleteAllFieldIndexes(e){return Cr.resolve()}createTargetIndexes(e,r){return Cr.resolve()}getDocumentsMatchingTarget(e,r){return Cr.resolve(null)}getIndexType(e,r){return Cr.resolve(0)}getFieldIndexes(e,r){return Cr.resolve([])}getNextCollectionGroupToUpdate(e){return Cr.resolve(null)}getMinOffset(e,r){return Cr.resolve(Ud.min())}getMinOffsetFromCollectionGroup(e,r){return Cr.resolve(Ud.min())}updateCollectionGroup(e,r,s){return Cr.resolve()}updateIndexEntries(e,r){return Cr.resolve()}}class dW{constructor(){this.index={}}add(e){const r=e.lastSegment(),s=e.popLast(),h=this.index[r]||new Aa(Wo.comparator),p=!h.has(s);return this.index[r]=h.add(s),p}has(e){const r=e.lastSegment(),s=e.popLast(),h=this.index[r];return h&&h.has(s)}getEntries(e){return(this.index[e]||new Aa(Wo.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new $m(0)}static kn(){return new $m(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fW{constructor(){this.changes=new rg(e=>e.toString(),(e,r)=>e.isEqual(r)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,r){this.assertNotApplied(),this.changes.set(e,$a.newInvalidDocument(e).setReadTime(r))}getEntry(e,r){this.assertNotApplied();const s=this.changes.get(r);return s!==void 0?Cr.resolve(s):this.getFromCache(e,r)}getEntries(e,r){return this.getAllFromCache(e,r)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pW{constructor(e,r){this.overlayedDocument=e,this.mutatedFields=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mW{constructor(e,r,s,h){this.remoteDocumentCache=e,this.mutationQueue=r,this.documentOverlayCache=s,this.indexManager=h}getDocument(e,r){let s=null;return this.documentOverlayCache.getOverlay(e,r).next(h=>(s=h,this.remoteDocumentCache.getEntry(e,r))).next(h=>(s!==null&&U_(s.mutation,h,Ul.empty(),Zs.now()),h))}getDocuments(e,r){return this.remoteDocumentCache.getEntries(e,r).next(s=>this.getLocalViewOfDocuments(e,s,Mi()).next(()=>s))}getLocalViewOfDocuments(e,r,s=Mi()){const h=Nf();return this.populateOverlays(e,h,r).next(()=>this.computeViews(e,r,h,s).next(p=>{let b=I_();return p.forEach((E,o)=>{b=b.insert(E,o.overlayedDocument)}),b}))}getOverlayedDocuments(e,r){const s=Nf();return this.populateOverlays(e,s,r).next(()=>this.computeViews(e,r,s,Mi()))}populateOverlays(e,r,s){const h=[];return s.forEach(p=>{r.has(p)||h.push(p)}),this.documentOverlayCache.getOverlays(e,h).next(p=>{p.forEach((b,E)=>{r.set(b,E)})})}computeViews(e,r,s,h){let p=mh();const b=V_(),E=function(){return V_()}();return r.forEach((o,O)=>{const z=s.get(O.key);h.has(O.key)&&(z===void 0||z.mutation instanceof Xd)?p=p.insert(O.key,O):z!==void 0?(b.set(O.key,z.mutation.getFieldMask()),U_(z.mutation,O,z.mutation.getFieldMask(),Zs.now())):b.set(O.key,Ul.empty())}),this.recalculateAndSaveOverlays(e,p).next(o=>(o.forEach((O,z)=>b.set(O,z)),r.forEach((O,z)=>{var U;return E.set(O,new pW(z,(U=b.get(O))!==null&&U!==void 0?U:null))}),E))}recalculateAndSaveOverlays(e,r){const s=V_();let h=new ms((b,E)=>b-E),p=Mi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,r).next(b=>{for(const E of b)E.keys().forEach(o=>{const O=r.get(o);if(O===null)return;let z=s.get(o)||Ul.empty();z=E.applyToLocalView(O,z),s.set(o,z);const U=(h.get(E.batchId)||Mi()).add(o);h=h.insert(E.batchId,U)})}).next(()=>{const b=[],E=h.getReverseIterator();for(;E.hasNext();){const o=E.getNext(),O=o.key,z=o.value,U=nB();z.forEach(H=>{if(!p.has(H)){const Y=cB(r.get(H),s.get(H));Y!==null&&U.set(H,Y),p=p.add(H)}}),b.push(this.documentOverlayCache.saveOverlays(e,O,U))}return Cr.waitFor(b)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,r){return this.remoteDocumentCache.getEntries(e,r).next(s=>this.recalculateAndSaveOverlays(e,s))}getDocumentsMatchingQuery(e,r,s,h){return function(b){return In.isDocumentKey(b.path)&&b.collectionGroup===null&&b.filters.length===0}(r)?this.getDocumentsMatchingDocumentQuery(e,r.path):JL(r)?this.getDocumentsMatchingCollectionGroupQuery(e,r,s,h):this.getDocumentsMatchingCollectionQuery(e,r,s,h)}getNextDocuments(e,r,s,h){return this.remoteDocumentCache.getAllFromCollectionGroup(e,r,s,h).next(p=>{const b=h-p.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,r,s.largestBatchId,h-p.size):Cr.resolve(Nf());let E=-1,o=p;return b.next(O=>Cr.forEach(O,(z,U)=>(E<U.largestBatchId&&(E=U.largestBatchId),p.get(z)?Cr.resolve():this.remoteDocumentCache.getEntry(e,z).next(H=>{o=o.insert(z,H)}))).next(()=>this.populateOverlays(e,O,p)).next(()=>this.computeViews(e,o,O,Mi())).next(z=>({batchId:E,changes:rB(z)})))})}getDocumentsMatchingDocumentQuery(e,r){return this.getDocument(e,new In(r)).next(s=>{let h=I_();return s.isFoundDocument()&&(h=h.insert(s.key,s)),h})}getDocumentsMatchingCollectionGroupQuery(e,r,s,h){const p=r.collectionGroup;let b=I_();return this.indexManager.getCollectionParents(e,p).next(E=>Cr.forEach(E,o=>{const O=function(U,H){return new My(H,null,U.explicitOrderBy.slice(),U.filters.slice(),U.limit,U.limitType,U.startAt,U.endAt)}(r,o.child(p));return this.getDocumentsMatchingCollectionQuery(e,O,s,h).next(z=>{z.forEach((U,H)=>{b=b.insert(U,H)})})}).next(()=>b))}getDocumentsMatchingCollectionQuery(e,r,s,h){let p;return this.documentOverlayCache.getOverlaysForCollection(e,r.path,s.largestBatchId).next(b=>(p=b,this.remoteDocumentCache.getDocumentsMatchingQuery(e,r,s,p,h))).next(b=>{p.forEach((o,O)=>{const z=O.getKey();b.get(z)===null&&(b=b.insert(z,$a.newInvalidDocument(z)))});let E=I_();return b.forEach((o,O)=>{const z=p.get(o);z!==void 0&&U_(z.mutation,O,Ul.empty(),Zs.now()),Lb(r,O)&&(E=E.insert(o,O))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gW{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,r){return Cr.resolve(this.hr.get(r))}saveBundleMetadata(e,r){return this.hr.set(r.id,function(h){return{id:h.id,version:h.version,createTime:_u(h.createTime)}}(r)),Cr.resolve()}getNamedQuery(e,r){return Cr.resolve(this.Pr.get(r))}saveNamedQuery(e,r){return this.Pr.set(r.name,function(h){return{name:h.name,query:uW(h.bundledQuery),readTime:_u(h.readTime)}}(r)),Cr.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _W{constructor(){this.overlays=new ms(In.comparator),this.Ir=new Map}getOverlay(e,r){return Cr.resolve(this.overlays.get(r))}getOverlays(e,r){const s=Nf();return Cr.forEach(r,h=>this.getOverlay(e,h).next(p=>{p!==null&&s.set(h,p)})).next(()=>s)}saveOverlays(e,r,s){return s.forEach((h,p)=>{this.ht(e,r,p)}),Cr.resolve()}removeOverlaysForBatchId(e,r,s){const h=this.Ir.get(s);return h!==void 0&&(h.forEach(p=>this.overlays=this.overlays.remove(p)),this.Ir.delete(s)),Cr.resolve()}getOverlaysForCollection(e,r,s){const h=Nf(),p=r.length+1,b=new In(r.child("")),E=this.overlays.getIteratorFrom(b);for(;E.hasNext();){const o=E.getNext().value,O=o.getKey();if(!r.isPrefixOf(O.path))break;O.path.length===p&&o.largestBatchId>s&&h.set(o.getKey(),o)}return Cr.resolve(h)}getOverlaysForCollectionGroup(e,r,s,h){let p=new ms((O,z)=>O-z);const b=this.overlays.getIterator();for(;b.hasNext();){const O=b.getNext().value;if(O.getKey().getCollectionGroup()===r&&O.largestBatchId>s){let z=p.get(O.largestBatchId);z===null&&(z=Nf(),p=p.insert(O.largestBatchId,z)),z.set(O.getKey(),O)}}const E=Nf(),o=p.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((O,z)=>E.set(O,z)),!(E.size()>=h)););return Cr.resolve(E)}ht(e,r,s){const h=this.overlays.get(s.key);if(h!==null){const b=this.Ir.get(h.largestBatchId).delete(s.key);this.Ir.set(h.largestBatchId,b)}this.overlays=this.overlays.insert(s.key,new V7(r,s));let p=this.Ir.get(r);p===void 0&&(p=Mi(),this.Ir.set(r,p)),this.Ir.set(r,p.add(s.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yW{constructor(){this.sessionToken=Pa.EMPTY_BYTE_STRING}getSessionToken(e){return Cr.resolve(this.sessionToken)}setSessionToken(e,r){return this.sessionToken=r,Cr.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CE{constructor(){this.Tr=new Aa(sa.Er),this.dr=new Aa(sa.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,r){const s=new sa(e,r);this.Tr=this.Tr.add(s),this.dr=this.dr.add(s)}Rr(e,r){e.forEach(s=>this.addReference(s,r))}removeReference(e,r){this.Vr(new sa(e,r))}mr(e,r){e.forEach(s=>this.removeReference(s,r))}gr(e){const r=new In(new Wo([])),s=new sa(r,e),h=new sa(r,e+1),p=[];return this.dr.forEachInRange([s,h],b=>{this.Vr(b),p.push(b.key)}),p}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const r=new In(new Wo([])),s=new sa(r,e),h=new sa(r,e+1);let p=Mi();return this.dr.forEachInRange([s,h],b=>{p=p.add(b.key)}),p}containsKey(e){const r=new sa(e,0),s=this.Tr.firstAfterOrEqual(r);return s!==null&&e.isEqual(s.key)}}class sa{constructor(e,r){this.key=e,this.wr=r}static Er(e,r){return In.comparator(e.key,r.key)||no(e.wr,r.wr)}static Ar(e,r){return no(e.wr,r.wr)||In.comparator(e.key,r.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vW{constructor(e,r){this.indexManager=e,this.referenceDelegate=r,this.mutationQueue=[],this.Sr=1,this.br=new Aa(sa.Er)}checkEmpty(e){return Cr.resolve(this.mutationQueue.length===0)}addMutationBatch(e,r,s,h){const p=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const b=new F7(p,r,s,h);this.mutationQueue.push(b);for(const E of h)this.br=this.br.add(new sa(E.key,p)),this.indexManager.addToCollectionParentIndex(e,E.key.path.popLast());return Cr.resolve(b)}lookupMutationBatch(e,r){return Cr.resolve(this.Dr(r))}getNextMutationBatchAfterBatchId(e,r){const s=r+1,h=this.vr(s),p=h<0?0:h;return Cr.resolve(this.mutationQueue.length>p?this.mutationQueue[p]:null)}getHighestUnacknowledgedBatchId(){return Cr.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return Cr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,r){const s=new sa(r,0),h=new sa(r,Number.POSITIVE_INFINITY),p=[];return this.br.forEachInRange([s,h],b=>{const E=this.Dr(b.wr);p.push(E)}),Cr.resolve(p)}getAllMutationBatchesAffectingDocumentKeys(e,r){let s=new Aa(no);return r.forEach(h=>{const p=new sa(h,0),b=new sa(h,Number.POSITIVE_INFINITY);this.br.forEachInRange([p,b],E=>{s=s.add(E.wr)})}),Cr.resolve(this.Cr(s))}getAllMutationBatchesAffectingQuery(e,r){const s=r.path,h=s.length+1;let p=s;In.isDocumentKey(p)||(p=p.child(""));const b=new sa(new In(p),0);let E=new Aa(no);return this.br.forEachWhile(o=>{const O=o.key.path;return!!s.isPrefixOf(O)&&(O.length===h&&(E=E.add(o.wr)),!0)},b),Cr.resolve(this.Cr(E))}Cr(e){const r=[];return e.forEach(s=>{const h=this.Dr(s);h!==null&&r.push(h)}),r}removeMutationBatch(e,r){Oo(this.Fr(r.batchId,"removed")===0),this.mutationQueue.shift();let s=this.br;return Cr.forEach(r.mutations,h=>{const p=new sa(h.key,r.batchId);return s=s.delete(p),this.referenceDelegate.markPotentiallyOrphaned(e,h.key)}).next(()=>{this.br=s})}On(e){}containsKey(e,r){const s=new sa(r,0),h=this.br.firstAfterOrEqual(s);return Cr.resolve(r.isEqual(h&&h.key))}performConsistencyCheck(e){return this.mutationQueue.length,Cr.resolve()}Fr(e,r){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const r=this.vr(e);return r<0||r>=this.mutationQueue.length?null:this.mutationQueue[r]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bW{constructor(e){this.Mr=e,this.docs=function(){return new ms(In.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,r){const s=r.key,h=this.docs.get(s),p=h?h.size:0,b=this.Mr(r);return this.docs=this.docs.insert(s,{document:r.mutableCopy(),size:b}),this.size+=b-p,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const r=this.docs.get(e);r&&(this.docs=this.docs.remove(e),this.size-=r.size)}getEntry(e,r){const s=this.docs.get(r);return Cr.resolve(s?s.document.mutableCopy():$a.newInvalidDocument(r))}getEntries(e,r){let s=mh();return r.forEach(h=>{const p=this.docs.get(h);s=s.insert(h,p?p.document.mutableCopy():$a.newInvalidDocument(h))}),Cr.resolve(s)}getDocumentsMatchingQuery(e,r,s,h){let p=mh();const b=r.path,E=new In(b.child("")),o=this.docs.getIteratorFrom(E);for(;o.hasNext();){const{key:O,value:{document:z}}=o.getNext();if(!b.isPrefixOf(O.path))break;O.path.length>b.length+1||n7(r7(z),s)<=0||(h.has(z.key)||Lb(r,z))&&(p=p.insert(z.key,z.mutableCopy()))}return Cr.resolve(p)}getAllFromCollectionGroup(e,r,s,h){Gn()}Or(e,r){return Cr.forEach(this.docs,s=>r(s))}newChangeBuffer(e){return new xW(this)}getSize(e){return Cr.resolve(this.size)}}class xW extends fW{constructor(e){super(),this.cr=e}applyChanges(e){const r=[];return this.changes.forEach((s,h)=>{h.isValidDocument()?r.push(this.cr.addEntry(e,h)):this.cr.removeEntry(s)}),Cr.waitFor(r)}getFromCache(e,r){return this.cr.getEntry(e,r)}getAllFromCache(e,r){return this.cr.getEntries(e,r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wW{constructor(e){this.persistence=e,this.Nr=new rg(r=>xE(r),wE),this.lastRemoteSnapshotVersion=Yn.min(),this.highestTargetId=0,this.Lr=0,this.Br=new CE,this.targetCount=0,this.kr=$m.Bn()}forEachTarget(e,r){return this.Nr.forEach((s,h)=>r(h)),Cr.resolve()}getLastRemoteSnapshotVersion(e){return Cr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Cr.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Cr.resolve(this.highestTargetId)}setTargetsMetadata(e,r,s){return s&&(this.lastRemoteSnapshotVersion=s),r>this.Lr&&(this.Lr=r),Cr.resolve()}Kn(e){this.Nr.set(e.target,e);const r=e.targetId;r>this.highestTargetId&&(this.kr=new $m(r),this.highestTargetId=r),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,r){return this.Kn(r),this.targetCount+=1,Cr.resolve()}updateTargetData(e,r){return this.Kn(r),Cr.resolve()}removeTargetData(e,r){return this.Nr.delete(r.target),this.Br.gr(r.targetId),this.targetCount-=1,Cr.resolve()}removeTargets(e,r,s){let h=0;const p=[];return this.Nr.forEach((b,E)=>{E.sequenceNumber<=r&&s.get(E.targetId)===null&&(this.Nr.delete(b),p.push(this.removeMatchingKeysForTargetId(e,E.targetId)),h++)}),Cr.waitFor(p).next(()=>h)}getTargetCount(e){return Cr.resolve(this.targetCount)}getTargetData(e,r){const s=this.Nr.get(r)||null;return Cr.resolve(s)}addMatchingKeys(e,r,s){return this.Br.Rr(r,s),Cr.resolve()}removeMatchingKeys(e,r,s){this.Br.mr(r,s);const h=this.persistence.referenceDelegate,p=[];return h&&r.forEach(b=>{p.push(h.markPotentiallyOrphaned(e,b))}),Cr.waitFor(p)}removeMatchingKeysForTargetId(e,r){return this.Br.gr(r),Cr.resolve()}getMatchingKeysForTargetId(e,r){const s=this.Br.yr(r);return Cr.resolve(s)}containsKey(e,r){return Cr.resolve(this.Br.containsKey(r))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TW{constructor(e,r){this.qr={},this.overlays={},this.Qr=new _E(0),this.Kr=!1,this.Kr=!0,this.$r=new yW,this.referenceDelegate=e(this),this.Ur=new wW(this),this.indexManager=new hW,this.remoteDocumentCache=function(h){return new bW(h)}(s=>this.referenceDelegate.Wr(s)),this.serializer=new cW(r),this.Gr=new gW(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let r=this.overlays[e.toKey()];return r||(r=new _W,this.overlays[e.toKey()]=r),r}getMutationQueue(e,r){let s=this.qr[e.toKey()];return s||(s=new vW(r,this.referenceDelegate),this.qr[e.toKey()]=s),s}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,r,s){dn("MemoryPersistence","Starting transaction:",e);const h=new EW(this.Qr.next());return this.referenceDelegate.zr(),s(h).next(p=>this.referenceDelegate.jr(h).next(()=>p)).toPromise().then(p=>(h.raiseOnCommittedEvent(),p))}Hr(e,r){return Cr.or(Object.values(this.qr).map(s=>()=>s.containsKey(e,r)))}}class EW extends o7{constructor(e){super(),this.currentSequenceNumber=e}}class RE{constructor(e){this.persistence=e,this.Jr=new CE,this.Yr=null}static Zr(e){return new RE(e)}get Xr(){if(this.Yr)return this.Yr;throw Gn()}addReference(e,r,s){return this.Jr.addReference(s,r),this.Xr.delete(s.toString()),Cr.resolve()}removeReference(e,r,s){return this.Jr.removeReference(s,r),this.Xr.add(s.toString()),Cr.resolve()}markPotentiallyOrphaned(e,r){return this.Xr.add(r.toString()),Cr.resolve()}removeTarget(e,r){this.Jr.gr(r.targetId).forEach(h=>this.Xr.add(h.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,r.targetId).next(h=>{h.forEach(p=>this.Xr.add(p.toString()))}).next(()=>s.removeTargetData(e,r))}zr(){this.Yr=new Set}jr(e){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Cr.forEach(this.Xr,s=>{const h=In.fromPath(s);return this.ei(e,h).next(p=>{p||r.removeEntry(h,Yn.min())})}).next(()=>(this.Yr=null,r.apply(e)))}updateLimboDocument(e,r){return this.ei(e,r).next(s=>{s?this.Xr.delete(r.toString()):this.Xr.add(r.toString())})}Wr(e){return 0}ei(e,r){return Cr.or([()=>Cr.resolve(this.Jr.containsKey(r)),()=>this.persistence.getTargetCache().containsKey(e,r),()=>this.persistence.Hr(e,r)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PE{constructor(e,r,s,h){this.targetId=e,this.fromCache=r,this.$i=s,this.Ui=h}static Wi(e,r){let s=Mi(),h=Mi();for(const p of r.docChanges)switch(p.type){case 0:s=s.add(p.doc.key);break;case 1:h=h.add(p.doc.key)}return new PE(e,r.fromCache,s,h)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SW{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IW{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return _G()?8:s7(Wa())>0?6:4}()}initialize(e,r){this.Ji=e,this.indexManager=r,this.Gi=!0}getDocumentsMatchingQuery(e,r,s,h){const p={result:null};return this.Yi(e,r).next(b=>{p.result=b}).next(()=>{if(!p.result)return this.Zi(e,r,h,s).next(b=>{p.result=b})}).next(()=>{if(p.result)return;const b=new SW;return this.Xi(e,r,b).next(E=>{if(p.result=E,this.zi)return this.es(e,r,b,E.size)})}).next(()=>p.result)}es(e,r,s,h){return s.documentReadCount<this.ji?(g_()<=Ui.DEBUG&&dn("QueryEngine","SDK will not create cache indexes for query:",dm(r),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Cr.resolve()):(g_()<=Ui.DEBUG&&dn("QueryEngine","Query:",dm(r),"scans",s.documentReadCount,"local documents and returns",h,"documents as results."),s.documentReadCount>this.Hi*h?(g_()<=Ui.DEBUG&&dn("QueryEngine","The SDK decides to create cache indexes for query:",dm(r),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,mu(r))):Cr.resolve())}Yi(e,r){if(kP(r))return Cr.resolve(null);let s=mu(r);return this.indexManager.getIndexType(e,s).next(h=>h===0?null:(r.limit!==null&&h===1&&(r=nT(r,null,"F"),s=mu(r)),this.indexManager.getDocumentsMatchingTarget(e,s).next(p=>{const b=Mi(...p);return this.Ji.getDocuments(e,b).next(E=>this.indexManager.getMinOffset(e,s).next(o=>{const O=this.ts(r,E);return this.ns(r,O,b,o.readTime)?this.Yi(e,nT(r,null,"F")):this.rs(e,O,r,o)}))})))}Zi(e,r,s,h){return kP(r)||h.isEqual(Yn.min())?Cr.resolve(null):this.Ji.getDocuments(e,s).next(p=>{const b=this.ts(r,p);return this.ns(r,b,s,h)?Cr.resolve(null):(g_()<=Ui.DEBUG&&dn("QueryEngine","Re-using previous result from %s to execute query: %s",h.toString(),dm(r)),this.rs(e,b,r,t7(h,-1)).next(E=>E))})}ts(e,r){let s=new Aa(eB(e));return r.forEach((h,p)=>{Lb(e,p)&&(s=s.add(p))}),s}ns(e,r,s,h){if(e.limit===null)return!1;if(s.size!==r.size)return!0;const p=e.limitType==="F"?r.last():r.first();return!!p&&(p.hasPendingWrites||p.version.compareTo(h)>0)}Xi(e,r,s){return g_()<=Ui.DEBUG&&dn("QueryEngine","Using full collection scan to execute query:",dm(r)),this.Ji.getDocumentsMatchingQuery(e,r,Ud.min(),s)}rs(e,r,s,h){return this.Ji.getDocumentsMatchingQuery(e,s,h).next(p=>(r.forEach(b=>{p=p.insert(b.key,b)}),p))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AW{constructor(e,r,s,h){this.persistence=e,this.ss=r,this.serializer=h,this.os=new ms(no),this._s=new rg(p=>xE(p),wE),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(s)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mW(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",r=>e.collect(r,this.os))}}function CW(t,e,r,s){return new AW(t,e,r,s)}async function wB(t,e){const r=Jn(t);return await r.persistence.runTransaction("Handle user change","readonly",s=>{let h;return r.mutationQueue.getAllMutationBatches(s).next(p=>(h=p,r.ls(e),r.mutationQueue.getAllMutationBatches(s))).next(p=>{const b=[],E=[];let o=Mi();for(const O of h){b.push(O.batchId);for(const z of O.mutations)o=o.add(z.key)}for(const O of p){E.push(O.batchId);for(const z of O.mutations)o=o.add(z.key)}return r.localDocuments.getDocuments(s,o).next(O=>({hs:O,removedBatchIds:b,addedBatchIds:E}))})})}function RW(t,e){const r=Jn(t);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",s=>{const h=e.batch.keys(),p=r.cs.newChangeBuffer({trackRemovals:!0});return function(E,o,O,z){const U=O.batch,H=U.keys();let Y=Cr.resolve();return H.forEach(Q=>{Y=Y.next(()=>z.getEntry(o,Q)).next(ge=>{const ye=O.docVersions.get(Q);Oo(ye!==null),ge.version.compareTo(ye)<0&&(U.applyToRemoteDocument(ge,O),ge.isValidDocument()&&(ge.setReadTime(O.commitVersion),z.addEntry(ge)))})}),Y.next(()=>E.mutationQueue.removeMutationBatch(o,U))}(r,s,e,p).next(()=>p.apply(s)).next(()=>r.mutationQueue.performConsistencyCheck(s)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(s,h,e.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(s,function(E){let o=Mi();for(let O=0;O<E.mutationResults.length;++O)E.mutationResults[O].transformResults.length>0&&(o=o.add(E.batch.mutations[O].key));return o}(e))).next(()=>r.localDocuments.getDocuments(s,h))})}function TB(t){const e=Jn(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",r=>e.Ur.getLastRemoteSnapshotVersion(r))}function PW(t,e){const r=Jn(t),s=e.snapshotVersion;let h=r.os;return r.persistence.runTransaction("Apply remote event","readwrite-primary",p=>{const b=r.cs.newChangeBuffer({trackRemovals:!0});h=r.os;const E=[];e.targetChanges.forEach((z,U)=>{const H=h.get(U);if(!H)return;E.push(r.Ur.removeMatchingKeys(p,z.removedDocuments,U).next(()=>r.Ur.addMatchingKeys(p,z.addedDocuments,U)));let Y=H.withSequenceNumber(p.currentSequenceNumber);e.targetMismatches.get(U)!==null?Y=Y.withResumeToken(Pa.EMPTY_BYTE_STRING,Yn.min()).withLastLimboFreeSnapshotVersion(Yn.min()):z.resumeToken.approximateByteSize()>0&&(Y=Y.withResumeToken(z.resumeToken,s)),h=h.insert(U,Y),function(ge,ye,ke){return ge.resumeToken.approximateByteSize()===0||ye.snapshotVersion.toMicroseconds()-ge.snapshotVersion.toMicroseconds()>=3e8?!0:ke.addedDocuments.size+ke.modifiedDocuments.size+ke.removedDocuments.size>0}(H,Y,z)&&E.push(r.Ur.updateTargetData(p,Y))});let o=mh(),O=Mi();if(e.documentUpdates.forEach(z=>{e.resolvedLimboDocuments.has(z)&&E.push(r.persistence.referenceDelegate.updateLimboDocument(p,z))}),E.push(MW(p,b,e.documentUpdates).next(z=>{o=z.Ps,O=z.Is})),!s.isEqual(Yn.min())){const z=r.Ur.getLastRemoteSnapshotVersion(p).next(U=>r.Ur.setTargetsMetadata(p,p.currentSequenceNumber,s));E.push(z)}return Cr.waitFor(E).next(()=>b.apply(p)).next(()=>r.localDocuments.getLocalViewOfDocuments(p,o,O)).next(()=>o)}).then(p=>(r.os=h,p))}function MW(t,e,r){let s=Mi(),h=Mi();return r.forEach(p=>s=s.add(p)),e.getEntries(t,s).next(p=>{let b=mh();return r.forEach((E,o)=>{const O=p.get(E);o.isFoundDocument()!==O.isFoundDocument()&&(h=h.add(E)),o.isNoDocument()&&o.version.isEqual(Yn.min())?(e.removeEntry(E,o.readTime),b=b.insert(E,o)):!O.isValidDocument()||o.version.compareTo(O.version)>0||o.version.compareTo(O.version)===0&&O.hasPendingWrites?(e.addEntry(o),b=b.insert(E,o)):dn("LocalStore","Ignoring outdated watch update for ",E,". Current version:",O.version," Watch version:",o.version)}),{Ps:b,Is:h}})}function kW(t,e){const r=Jn(t);return r.persistence.runTransaction("Get next mutation batch","readonly",s=>(e===void 0&&(e=-1),r.mutationQueue.getNextMutationBatchAfterBatchId(s,e)))}function OW(t,e){const r=Jn(t);return r.persistence.runTransaction("Allocate target","readwrite",s=>{let h;return r.Ur.getTargetData(s,e).next(p=>p?(h=p,Cr.resolve(h)):r.Ur.allocateTargetId(s).next(b=>(h=new Id(e,b,"TargetPurposeListen",s.currentSequenceNumber),r.Ur.addTargetData(s,h).next(()=>h))))}).then(s=>{const h=r.os.get(s.targetId);return(h===null||s.snapshotVersion.compareTo(h.snapshotVersion)>0)&&(r.os=r.os.insert(s.targetId,s),r._s.set(e,s.targetId)),s})}async function lT(t,e,r){const s=Jn(t),h=s.os.get(e),p=r?"readwrite":"readwrite-primary";try{r||await s.persistence.runTransaction("Release target",p,b=>s.persistence.referenceDelegate.removeTarget(b,h))}catch(b){if(!Py(b))throw b;dn("LocalStore",`Failed to update sequence numbers for target ${e}: ${b}`)}s.os=s.os.remove(e),s._s.delete(h.target)}function $P(t,e,r){const s=Jn(t);let h=Yn.min(),p=Mi();return s.persistence.runTransaction("Execute query","readwrite",b=>function(o,O,z){const U=Jn(o),H=U._s.get(z);return H!==void 0?Cr.resolve(U.os.get(H)):U.Ur.getTargetData(O,z)}(s,b,mu(e)).next(E=>{if(E)return h=E.lastLimboFreeSnapshotVersion,s.Ur.getMatchingKeysForTargetId(b,E.targetId).next(o=>{p=o})}).next(()=>s.ss.getDocumentsMatchingQuery(b,e,r?h:Yn.min(),r?p:Mi())).next(E=>(DW(s,E7(e),E),{documents:E,Ts:p})))}function DW(t,e,r){let s=t.us.get(e)||Yn.min();r.forEach((h,p)=>{p.readTime.compareTo(s)>0&&(s=p.readTime)}),t.us.set(e,s)}class GP{constructor(){this.activeTargetIds=P7()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class LW{constructor(){this.so=new GP,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,r,s){}addLocalQueryTarget(e){return this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,r,s){this.oo[e]=r}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new GP,Promise.resolve()}handleUserChange(e,r,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BW{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){dn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){dn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let a0=null;function ew(){return a0===null?a0=function(){return 268435456+Math.round(2147483648*Math.random())}():a0++,"0x"+a0.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zW={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NW{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Na="WebChannelConnection";class FW extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const s=r.ssl?"https":"http",h=encodeURIComponent(this.databaseId.projectId),p=encodeURIComponent(this.databaseId.database);this.Do=s+"://"+r.host,this.vo=`projects/${h}/databases/${p}`,this.Co=this.databaseId.database==="(default)"?`project_id=${h}`:`project_id=${h}&database_id=${p}`}get Fo(){return!1}Mo(r,s,h,p,b){const E=ew(),o=this.xo(r,s.toUriEncodedString());dn("RestConnection",`Sending RPC '${r}' ${E}:`,o,h);const O={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(O,p,b),this.No(r,o,O,h).then(z=>(dn("RestConnection",`Received RPC '${r}' ${E}: `,z),z),z=>{throw Fm("RestConnection",`RPC '${r}' ${E} failed with error: `,z,"url: ",o,"request:",h),z})}Lo(r,s,h,p,b,E){return this.Mo(r,s,h,p,b)}Oo(r,s,h){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+tg}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((p,b)=>r[b]=p),h&&h.headers.forEach((p,b)=>r[b]=p)}xo(r,s){const h=zW[r];return`${this.Do}/v1/${s}:${h}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,r,s,h){const p=ew();return new Promise((b,E)=>{const o=new LL;o.setWithCredentials(!0),o.listenOnce(zL.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case y0.NO_ERROR:const z=o.getResponseJson();dn(Na,`XHR for RPC '${e}' ${p} received:`,JSON.stringify(z)),b(z);break;case y0.TIMEOUT:dn(Na,`RPC '${e}' ${p} timed out`),E(new nn(Er.DEADLINE_EXCEEDED,"Request time out"));break;case y0.HTTP_ERROR:const U=o.getStatus();if(dn(Na,`RPC '${e}' ${p} failed with status:`,U,"response text:",o.getResponseText()),U>0){let H=o.getResponseJson();Array.isArray(H)&&(H=H[0]);const Y=H==null?void 0:H.error;if(Y&&Y.status&&Y.message){const Q=function(ye){const ke=ye.toLowerCase().replace(/_/g,"-");return Object.values(Er).indexOf(ke)>=0?ke:Er.UNKNOWN}(Y.status);E(new nn(Q,Y.message))}else E(new nn(Er.UNKNOWN,"Server responded with status "+o.getStatus()))}else E(new nn(Er.UNAVAILABLE,"Connection failed."));break;default:Gn()}}finally{dn(Na,`RPC '${e}' ${p} completed.`)}});const O=JSON.stringify(h);dn(Na,`RPC '${e}' ${p} sending request:`,h),o.send(r,"POST",O,s,15)})}Bo(e,r,s){const h=ew(),p=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],b=VL(),E=FL(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},O=this.longPollingOptions.timeoutSeconds;O!==void 0&&(o.longPollingTimeout=Math.round(1e3*O)),this.useFetchStreams&&(o.xmlHttpFactory=new BL({})),this.Oo(o.initMessageHeaders,r,s),o.encodeInitMessageHeaders=!0;const z=p.join("");dn(Na,`Creating RPC '${e}' stream ${h}: ${z}`,o);const U=b.createWebChannel(z,o);let H=!1,Y=!1;const Q=new NW({Io:ye=>{Y?dn(Na,`Not sending because RPC '${e}' stream ${h} is closed:`,ye):(H||(dn(Na,`Opening RPC '${e}' stream ${h} transport.`),U.open(),H=!0),dn(Na,`RPC '${e}' stream ${h} sending:`,ye),U.send(ye))},To:()=>U.close()}),ge=(ye,ke,he)=>{ye.listen(ke,oe=>{try{he(oe)}catch(ve){setTimeout(()=>{throw ve},0)}})};return ge(U,S_.EventType.OPEN,()=>{Y||(dn(Na,`RPC '${e}' stream ${h} transport opened.`),Q.yo())}),ge(U,S_.EventType.CLOSE,()=>{Y||(Y=!0,dn(Na,`RPC '${e}' stream ${h} transport closed`),Q.So())}),ge(U,S_.EventType.ERROR,ye=>{Y||(Y=!0,Fm(Na,`RPC '${e}' stream ${h} transport errored:`,ye),Q.So(new nn(Er.UNAVAILABLE,"The operation could not be completed")))}),ge(U,S_.EventType.MESSAGE,ye=>{var ke;if(!Y){const he=ye.data[0];Oo(!!he);const oe=he,ve=oe.error||((ke=oe[0])===null||ke===void 0?void 0:ke.error);if(ve){dn(Na,`RPC '${e}' stream ${h} received error:`,ve);const be=ve.status;let ze=function(ne){const te=ks[ne];if(te!==void 0)return dB(te)}(be),Te=ve.message;ze===void 0&&(ze=Er.INTERNAL,Te="Unknown error status: "+be+" with message "+ve.message),Y=!0,Q.So(new nn(ze,Te)),U.close()}else dn(Na,`RPC '${e}' stream ${h} received:`,he),Q.bo(he)}}),ge(E,NL.STAT_EVENT,ye=>{ye.stat===Yw.PROXY?dn(Na,`RPC '${e}' stream ${h} detected buffering proxy`):ye.stat===Yw.NOPROXY&&dn(Na,`RPC '${e}' stream ${h} detected no buffering proxy`)}),setTimeout(()=>{Q.wo()},0),Q}}function tw(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fb(t){return new K7(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(e,r,s=1e3,h=1.5,p=6e4){this.ui=e,this.timerId=r,this.ko=s,this.qo=h,this.Qo=p,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const r=Math.floor(this.Ko+this.zo()),s=Math.max(0,Date.now()-this.Uo),h=Math.max(0,r-s);h>0&&dn("ExponentialBackoff",`Backing off for ${h} ms (base delay: ${this.Ko} ms, delay with jitter: ${r} ms, last attempt: ${s} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,h,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SB{constructor(e,r,s,h,p,b,E,o){this.ui=e,this.Ho=s,this.Jo=h,this.connection=p,this.authCredentialsProvider=b,this.appCheckCredentialsProvider=E,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new EB(e,r)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,r){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():r&&r.code===Er.RESOURCE_EXHAUSTED?(ph(r.toString()),ph("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):r&&r.code===Er.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(r)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),r=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([s,h])=>{this.Yo===r&&this.P_(s,h)},s=>{e(()=>{const h=new nn(Er.UNKNOWN,"Fetching auth token failed: "+s.message);return this.I_(h)})})}P_(e,r){const s=this.h_(this.Yo);this.stream=this.T_(e,r),this.stream.Eo(()=>{s(()=>this.listener.Eo())}),this.stream.Ro(()=>{s(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(h=>{s(()=>this.I_(h))}),this.stream.onMessage(h=>{s(()=>++this.e_==1?this.E_(h):this.onNext(h))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return dn("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return r=>{this.ui.enqueueAndForget(()=>this.Yo===e?r():(dn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class VW extends SB{constructor(e,r,s,h,p,b){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,s,h,b),this.serializer=p}T_(e,r){return this.connection.Bo("Listen",e,r)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const r=J7(this.serializer,e),s=function(p){if(!("targetChange"in p))return Yn.min();const b=p.targetChange;return b.targetIds&&b.targetIds.length?Yn.min():b.readTime?_u(b.readTime):Yn.min()}(e);return this.listener.d_(r,s)}A_(e){const r={};r.database=aT(this.serializer),r.addTarget=function(p,b){let E;const o=b.target;if(E=tT(o)?{documents:tW(p,o)}:{query:rW(p,o)._t},E.targetId=b.targetId,b.resumeToken.approximateByteSize()>0){E.resumeToken=mB(p,b.resumeToken);const O=iT(p,b.expectedCount);O!==null&&(E.expectedCount=O)}else if(b.snapshotVersion.compareTo(Yn.min())>0){E.readTime=tb(p,b.snapshotVersion.toTimestamp());const O=iT(p,b.expectedCount);O!==null&&(E.expectedCount=O)}return E}(this.serializer,e);const s=iW(this.serializer,e);s&&(r.labels=s),this.a_(r)}R_(e){const r={};r.database=aT(this.serializer),r.removeTarget=e,this.a_(r)}}class UW extends SB{constructor(e,r,s,h,p,b){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,s,h,b),this.serializer=p}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,r){return this.connection.Bo("Write",e,r)}E_(e){return Oo(!!e.streamToken),this.lastStreamToken=e.streamToken,Oo(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){Oo(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const r=eW(e.writeResults,e.commitTime),s=_u(e.commitTime);return this.listener.g_(s,r)}p_(){const e={};e.database=aT(this.serializer),this.a_(e)}m_(e){const r={streamToken:this.lastStreamToken,writes:e.map(s=>Q7(this.serializer,s))};this.a_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jW extends class{}{constructor(e,r,s,h){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=s,this.serializer=h,this.y_=!1}w_(){if(this.y_)throw new nn(Er.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,r,s,h){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([p,b])=>this.connection.Mo(e,oT(r,s),h,p,b)).catch(p=>{throw p.name==="FirebaseError"?(p.code===Er.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),p):new nn(Er.UNKNOWN,p.toString())})}Lo(e,r,s,h,p){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([b,E])=>this.connection.Lo(e,oT(r,s),h,b,E,p)).catch(b=>{throw b.name==="FirebaseError"?(b.code===Er.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),b):new nn(Er.UNKNOWN,b.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class $W{constructor(e,r){this.asyncQueue=e,this.onlineStateHandler=r,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const r=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(ph(r),this.D_=!1):dn("OnlineStateTracker",r)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GW{constructor(e,r,s,h,p){this.localStore=e,this.datastore=r,this.asyncQueue=s,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=p,this.k_._o(b=>{s.enqueueAndForget(async()=>{fp(this)&&(dn("RemoteStore","Restarting streams for network reachability change."),await async function(o){const O=Jn(o);O.L_.add(4),await Dy(O),O.q_.set("Unknown"),O.L_.delete(4),await Vb(O)}(this))})}),this.q_=new $W(s,h)}}async function Vb(t){if(fp(t))for(const e of t.B_)await e(!0)}async function Dy(t){for(const e of t.B_)await e(!1)}function IB(t,e){const r=Jn(t);r.N_.has(e.targetId)||(r.N_.set(e.targetId,e),DE(r)?OE(r):ng(r).r_()&&kE(r,e))}function ME(t,e){const r=Jn(t),s=ng(r);r.N_.delete(e),s.r_()&&AB(r,e),r.N_.size===0&&(s.r_()?s.o_():fp(r)&&r.q_.set("Unknown"))}function kE(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Yn.min())>0){const r=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(r)}ng(t).A_(e)}function AB(t,e){t.Q_.xe(e),ng(t).R_(e)}function OE(t){t.Q_=new q7({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),ng(t).start(),t.q_.v_()}function DE(t){return fp(t)&&!ng(t).n_()&&t.N_.size>0}function fp(t){return Jn(t).L_.size===0}function CB(t){t.Q_=void 0}async function qW(t){t.q_.set("Online")}async function HW(t){t.N_.forEach((e,r)=>{kE(t,e)})}async function WW(t,e){CB(t),DE(t)?(t.q_.M_(e),OE(t)):t.q_.set("Unknown")}async function ZW(t,e,r){if(t.q_.set("Online"),e instanceof pB&&e.state===2&&e.cause)try{await async function(h,p){const b=p.cause;for(const E of p.targetIds)h.N_.has(E)&&(await h.remoteSyncer.rejectListen(E,b),h.N_.delete(E),h.Q_.removeTarget(E))}(t,e)}catch(s){dn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),s),await rb(t,s)}else if(e instanceof x0?t.Q_.Ke(e):e instanceof fB?t.Q_.He(e):t.Q_.We(e),!r.isEqual(Yn.min()))try{const s=await TB(t.localStore);r.compareTo(s)>=0&&await function(p,b){const E=p.Q_.rt(b);return E.targetChanges.forEach((o,O)=>{if(o.resumeToken.approximateByteSize()>0){const z=p.N_.get(O);z&&p.N_.set(O,z.withResumeToken(o.resumeToken,b))}}),E.targetMismatches.forEach((o,O)=>{const z=p.N_.get(o);if(!z)return;p.N_.set(o,z.withResumeToken(Pa.EMPTY_BYTE_STRING,z.snapshotVersion)),AB(p,o);const U=new Id(z.target,o,O,z.sequenceNumber);kE(p,U)}),p.remoteSyncer.applyRemoteEvent(E)}(t,r)}catch(s){dn("RemoteStore","Failed to raise snapshot:",s),await rb(t,s)}}async function rb(t,e,r){if(!Py(e))throw e;t.L_.add(1),await Dy(t),t.q_.set("Offline"),r||(r=()=>TB(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{dn("RemoteStore","Retrying IndexedDB access"),await r(),t.L_.delete(1),await Vb(t)})}function RB(t,e){return e().catch(r=>rb(t,r,e))}async function Ub(t){const e=Jn(t),r=$d(e);let s=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;KW(e);)try{const h=await kW(e.localStore,s);if(h===null){e.O_.length===0&&r.o_();break}s=h.batchId,XW(e,h)}catch(h){await rb(e,h)}PB(e)&&MB(e)}function KW(t){return fp(t)&&t.O_.length<10}function XW(t,e){t.O_.push(e);const r=$d(t);r.r_()&&r.V_&&r.m_(e.mutations)}function PB(t){return fp(t)&&!$d(t).n_()&&t.O_.length>0}function MB(t){$d(t).start()}async function YW(t){$d(t).p_()}async function JW(t){const e=$d(t);for(const r of t.O_)e.m_(r.mutations)}async function QW(t,e,r){const s=t.O_.shift(),h=SE.from(s,e,r);await RB(t,()=>t.remoteSyncer.applySuccessfulWrite(h)),await Ub(t)}async function eZ(t,e){e&&$d(t).V_&&await async function(s,h){if(function(b){return j7(b)&&b!==Er.ABORTED}(h.code)){const p=s.O_.shift();$d(s).s_(),await RB(s,()=>s.remoteSyncer.rejectFailedWrite(p.batchId,h)),await Ub(s)}}(t,e),PB(t)&&MB(t)}async function HP(t,e){const r=Jn(t);r.asyncQueue.verifyOperationInProgress(),dn("RemoteStore","RemoteStore received new credentials");const s=fp(r);r.L_.add(3),await Dy(r),s&&r.q_.set("Unknown"),await r.remoteSyncer.handleCredentialChange(e),r.L_.delete(3),await Vb(r)}async function tZ(t,e){const r=Jn(t);e?(r.L_.delete(2),await Vb(r)):e||(r.L_.add(2),await Dy(r),r.q_.set("Unknown"))}function ng(t){return t.K_||(t.K_=function(r,s,h){const p=Jn(r);return p.w_(),new VW(s,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,h)}(t.datastore,t.asyncQueue,{Eo:qW.bind(null,t),Ro:HW.bind(null,t),mo:WW.bind(null,t),d_:ZW.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),DE(t)?OE(t):t.q_.set("Unknown")):(await t.K_.stop(),CB(t))})),t.K_}function $d(t){return t.U_||(t.U_=function(r,s,h){const p=Jn(r);return p.w_(),new UW(s,p.connection,p.authCredentials,p.appCheckCredentials,p.serializer,h)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:YW.bind(null,t),mo:eZ.bind(null,t),f_:JW.bind(null,t),g_:QW.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Ub(t)):(await t.U_.stop(),t.O_.length>0&&(dn("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LE{constructor(e,r,s,h,p){this.asyncQueue=e,this.timerId=r,this.targetTimeMs=s,this.op=h,this.removalCallback=p,this.deferred=new hh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(b=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,r,s,h,p){const b=Date.now()+s,E=new LE(e,r,b,h,p);return E.start(s),E}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new nn(Er.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function BE(t,e){if(ph("AsyncQueue",`${e}: ${t}`),Py(t))return new nn(Er.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e){this.comparator=e?(r,s)=>e(r,s)||In.comparator(r.key,s.key):(r,s)=>In.comparator(r.key,s.key),this.keyedMap=I_(),this.sortedSet=new ms(this.comparator)}static emptySet(e){return new Pm(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const r=this.keyedMap.get(e);return r?this.sortedSet.indexOf(r):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((r,s)=>(e(r),!1))}add(e){const r=this.delete(e.key);return r.copy(r.keyedMap.insert(e.key,e),r.sortedSet.insert(e,null))}delete(e){const r=this.get(e);return r?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(r)):this}isEqual(e){if(!(e instanceof Pm)||this.size!==e.size)return!1;const r=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;r.hasNext();){const h=r.getNext().key,p=s.getNext().key;if(!h.isEqual(p))return!1}return!0}toString(){const e=[];return this.forEach(r=>{e.push(r.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,r){const s=new Pm;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=r,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(){this.W_=new ms(In.comparator)}track(e){const r=e.doc.key,s=this.W_.get(r);s?e.type!==0&&s.type===3?this.W_=this.W_.insert(r,e):e.type===3&&s.type!==1?this.W_=this.W_.insert(r,{type:s.type,doc:e.doc}):e.type===2&&s.type===2?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):e.type===2&&s.type===0?this.W_=this.W_.insert(r,{type:0,doc:e.doc}):e.type===1&&s.type===0?this.W_=this.W_.remove(r):e.type===1&&s.type===2?this.W_=this.W_.insert(r,{type:1,doc:s.doc}):e.type===0&&s.type===1?this.W_=this.W_.insert(r,{type:2,doc:e.doc}):Gn():this.W_=this.W_.insert(r,e)}G_(){const e=[];return this.W_.inorderTraversal((r,s)=>{e.push(s)}),e}}class Gm{constructor(e,r,s,h,p,b,E,o,O){this.query=e,this.docs=r,this.oldDocs=s,this.docChanges=h,this.mutatedKeys=p,this.fromCache=b,this.syncStateChanged=E,this.excludesMetadataChanges=o,this.hasCachedResults=O}static fromInitialDocuments(e,r,s,h,p){const b=[];return r.forEach(E=>{b.push({type:0,doc:E})}),new Gm(e,r,Pm.emptySet(r),b,s,h,!0,!1,p)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Db(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const r=this.docChanges,s=e.docChanges;if(r.length!==s.length)return!1;for(let h=0;h<r.length;h++)if(r[h].type!==s[h].type||!r[h].doc.isEqual(s[h].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rZ{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class nZ{constructor(){this.queries=ZP(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(r,s){const h=Jn(r),p=h.queries;h.queries=ZP(),p.forEach((b,E)=>{for(const o of E.j_)o.onError(s)})})(this,new nn(Er.ABORTED,"Firestore shutting down"))}}function ZP(){return new rg(t=>QL(t),Db)}async function kB(t,e){const r=Jn(t);let s=3;const h=e.query;let p=r.queries.get(h);p?!p.H_()&&e.J_()&&(s=2):(p=new rZ,s=e.J_()?0:1);try{switch(s){case 0:p.z_=await r.onListen(h,!0);break;case 1:p.z_=await r.onListen(h,!1);break;case 2:await r.onFirstRemoteStoreListen(h)}}catch(b){const E=BE(b,`Initialization of query '${dm(e.query)}' failed`);return void e.onError(E)}r.queries.set(h,p),p.j_.push(e),e.Z_(r.onlineState),p.z_&&e.X_(p.z_)&&zE(r)}async function OB(t,e){const r=Jn(t),s=e.query;let h=3;const p=r.queries.get(s);if(p){const b=p.j_.indexOf(e);b>=0&&(p.j_.splice(b,1),p.j_.length===0?h=e.J_()?0:1:!p.H_()&&e.J_()&&(h=2))}switch(h){case 0:return r.queries.delete(s),r.onUnlisten(s,!0);case 1:return r.queries.delete(s),r.onUnlisten(s,!1);case 2:return r.onLastRemoteStoreUnlisten(s);default:return}}function iZ(t,e){const r=Jn(t);let s=!1;for(const h of e){const p=h.query,b=r.queries.get(p);if(b){for(const E of b.j_)E.X_(h)&&(s=!0);b.z_=h}}s&&zE(r)}function oZ(t,e,r){const s=Jn(t),h=s.queries.get(e);if(h)for(const p of h.j_)p.onError(r);s.queries.delete(e)}function zE(t){t.Y_.forEach(e=>{e.next()})}var cT,KP;(KP=cT||(cT={})).ea="default",KP.Cache="cache";class DB{constructor(e,r,s){this.query=e,this.ta=r,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=s||{}}X_(e){if(!this.options.includeMetadataChanges){const s=[];for(const h of e.docChanges)h.type!==3&&s.push(h);e=new Gm(e.query,e.docs,e.oldDocs,s,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let r=!1;return this.na?this.ia(e)&&(this.ta.next(e),r=!0):this.sa(e,this.onlineState)&&(this.oa(e),r=!0),this.ra=e,r}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let r=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),r=!0),r}sa(e,r){if(!e.fromCache||!this.J_())return!0;const s=r!=="Offline";return(!this.options._a||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||r==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const r=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!r)&&this.options.includeMetadataChanges===!0}oa(e){e=Gm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==cT.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LB{constructor(e){this.key=e}}class BB{constructor(e){this.key=e}}class sZ{constructor(e,r){this.query=e,this.Ta=r,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Mi(),this.mutatedKeys=Mi(),this.Aa=eB(e),this.Ra=new Pm(this.Aa)}get Va(){return this.Ta}ma(e,r){const s=r?r.fa:new WP,h=r?r.Ra:this.Ra;let p=r?r.mutatedKeys:this.mutatedKeys,b=h,E=!1;const o=this.query.limitType==="F"&&h.size===this.query.limit?h.last():null,O=this.query.limitType==="L"&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal((z,U)=>{const H=h.get(z),Y=Lb(this.query,U)?U:null,Q=!!H&&this.mutatedKeys.has(H.key),ge=!!Y&&(Y.hasLocalMutations||this.mutatedKeys.has(Y.key)&&Y.hasCommittedMutations);let ye=!1;H&&Y?H.data.isEqual(Y.data)?Q!==ge&&(s.track({type:3,doc:Y}),ye=!0):this.ga(H,Y)||(s.track({type:2,doc:Y}),ye=!0,(o&&this.Aa(Y,o)>0||O&&this.Aa(Y,O)<0)&&(E=!0)):!H&&Y?(s.track({type:0,doc:Y}),ye=!0):H&&!Y&&(s.track({type:1,doc:H}),ye=!0,(o||O)&&(E=!0)),ye&&(Y?(b=b.add(Y),p=ge?p.add(z):p.delete(z)):(b=b.delete(z),p=p.delete(z)))}),this.query.limit!==null)for(;b.size>this.query.limit;){const z=this.query.limitType==="F"?b.last():b.first();b=b.delete(z.key),p=p.delete(z.key),s.track({type:1,doc:z})}return{Ra:b,fa:s,ns:E,mutatedKeys:p}}ga(e,r){return e.hasLocalMutations&&r.hasCommittedMutations&&!r.hasLocalMutations}applyChanges(e,r,s,h){const p=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const b=e.fa.G_();b.sort((z,U)=>function(Y,Q){const ge=ye=>{switch(ye){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Gn()}};return ge(Y)-ge(Q)}(z.type,U.type)||this.Aa(z.doc,U.doc)),this.pa(s),h=h!=null&&h;const E=r&&!h?this.ya():[],o=this.da.size===0&&this.current&&!h?1:0,O=o!==this.Ea;return this.Ea=o,b.length!==0||O?{snapshot:new Gm(this.query,e.Ra,p,b,e.mutatedKeys,o===0,O,!1,!!s&&s.resumeToken.approximateByteSize()>0),wa:E}:{wa:E}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new WP,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(r=>this.Ta=this.Ta.add(r)),e.modifiedDocuments.forEach(r=>{}),e.removedDocuments.forEach(r=>this.Ta=this.Ta.delete(r)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Mi(),this.Ra.forEach(s=>{this.Sa(s.key)&&(this.da=this.da.add(s.key))});const r=[];return e.forEach(s=>{this.da.has(s)||r.push(new BB(s))}),this.da.forEach(s=>{e.has(s)||r.push(new LB(s))}),r}ba(e){this.Ta=e.Ts,this.da=Mi();const r=this.ma(e.documents);return this.applyChanges(r,!0)}Da(){return Gm.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class aZ{constructor(e,r,s){this.query=e,this.targetId=r,this.view=s}}class lZ{constructor(e){this.key=e,this.va=!1}}class cZ{constructor(e,r,s,h,p,b){this.localStore=e,this.remoteStore=r,this.eventManager=s,this.sharedClientState=h,this.currentUser=p,this.maxConcurrentLimboResolutions=b,this.Ca={},this.Fa=new rg(E=>QL(E),Db),this.Ma=new Map,this.xa=new Set,this.Oa=new ms(In.comparator),this.Na=new Map,this.La=new CE,this.Ba={},this.ka=new Map,this.qa=$m.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function uZ(t,e,r=!0){const s=jB(t);let h;const p=s.Fa.get(e);return p?(s.sharedClientState.addLocalQueryTarget(p.targetId),h=p.view.Da()):h=await zB(s,e,r,!0),h}async function hZ(t,e){const r=jB(t);await zB(r,e,!0,!1)}async function zB(t,e,r,s){const h=await OW(t.localStore,mu(e)),p=h.targetId,b=r?t.sharedClientState.addLocalQueryTarget(p):"not-current";let E;return s&&(E=await dZ(t,e,p,b==="current",h.resumeToken)),t.isPrimaryClient&&r&&IB(t.remoteStore,h),E}async function dZ(t,e,r,s,h){t.Ka=(U,H,Y)=>async function(ge,ye,ke,he){let oe=ye.view.ma(ke);oe.ns&&(oe=await $P(ge.localStore,ye.query,!1).then(({documents:Te})=>ye.view.ma(Te,oe)));const ve=he&&he.targetChanges.get(ye.targetId),be=he&&he.targetMismatches.get(ye.targetId)!=null,ze=ye.view.applyChanges(oe,ge.isPrimaryClient,ve,be);return YP(ge,ye.targetId,ze.wa),ze.snapshot}(t,U,H,Y);const p=await $P(t.localStore,e,!0),b=new sZ(e,p.Ts),E=b.ma(p.documents),o=Oy.createSynthesizedTargetChangeForCurrentChange(r,s&&t.onlineState!=="Offline",h),O=b.applyChanges(E,t.isPrimaryClient,o);YP(t,r,O.wa);const z=new aZ(e,r,b);return t.Fa.set(e,z),t.Ma.has(r)?t.Ma.get(r).push(e):t.Ma.set(r,[e]),O.snapshot}async function fZ(t,e,r){const s=Jn(t),h=s.Fa.get(e),p=s.Ma.get(h.targetId);if(p.length>1)return s.Ma.set(h.targetId,p.filter(b=>!Db(b,e))),void s.Fa.delete(e);s.isPrimaryClient?(s.sharedClientState.removeLocalQueryTarget(h.targetId),s.sharedClientState.isActiveQueryTarget(h.targetId)||await lT(s.localStore,h.targetId,!1).then(()=>{s.sharedClientState.clearQueryState(h.targetId),r&&ME(s.remoteStore,h.targetId),uT(s,h.targetId)}).catch(Ry)):(uT(s,h.targetId),await lT(s.localStore,h.targetId,!0))}async function pZ(t,e){const r=Jn(t),s=r.Fa.get(e),h=r.Ma.get(s.targetId);r.isPrimaryClient&&h.length===1&&(r.sharedClientState.removeLocalQueryTarget(s.targetId),ME(r.remoteStore,s.targetId))}async function mZ(t,e,r){const s=wZ(t);try{const h=await function(b,E){const o=Jn(b),O=Zs.now(),z=E.reduce((Y,Q)=>Y.add(Q.key),Mi());let U,H;return o.persistence.runTransaction("Locally write mutations","readwrite",Y=>{let Q=mh(),ge=Mi();return o.cs.getEntries(Y,z).next(ye=>{Q=ye,Q.forEach((ke,he)=>{he.isValidDocument()||(ge=ge.add(ke))})}).next(()=>o.localDocuments.getOverlayedDocuments(Y,Q)).next(ye=>{U=ye;const ke=[];for(const he of E){const oe=z7(he,U.get(he.key).overlayedDocument);oe!=null&&ke.push(new Xd(he.key,oe,qL(oe.value.mapValue),gu.exists(!0)))}return o.mutationQueue.addMutationBatch(Y,O,ke,E)}).next(ye=>{H=ye;const ke=ye.applyToLocalDocumentSet(U,ge);return o.documentOverlayCache.saveOverlays(Y,ye.batchId,ke)})}).then(()=>({batchId:H.batchId,changes:rB(U)}))}(s.localStore,e);s.sharedClientState.addPendingMutation(h.batchId),function(b,E,o){let O=b.Ba[b.currentUser.toKey()];O||(O=new ms(no)),O=O.insert(E,o),b.Ba[b.currentUser.toKey()]=O}(s,h.batchId,r),await Ly(s,h.changes),await Ub(s.remoteStore)}catch(h){const p=BE(h,"Failed to persist write");r.reject(p)}}async function NB(t,e){const r=Jn(t);try{const s=await PW(r.localStore,e);e.targetChanges.forEach((h,p)=>{const b=r.Na.get(p);b&&(Oo(h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size<=1),h.addedDocuments.size>0?b.va=!0:h.modifiedDocuments.size>0?Oo(b.va):h.removedDocuments.size>0&&(Oo(b.va),b.va=!1))}),await Ly(r,s,e)}catch(s){await Ry(s)}}function XP(t,e,r){const s=Jn(t);if(s.isPrimaryClient&&r===0||!s.isPrimaryClient&&r===1){const h=[];s.Fa.forEach((p,b)=>{const E=b.view.Z_(e);E.snapshot&&h.push(E.snapshot)}),function(b,E){const o=Jn(b);o.onlineState=E;let O=!1;o.queries.forEach((z,U)=>{for(const H of U.j_)H.Z_(E)&&(O=!0)}),O&&zE(o)}(s.eventManager,e),h.length&&s.Ca.d_(h),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function gZ(t,e,r){const s=Jn(t);s.sharedClientState.updateQueryState(e,"rejected",r);const h=s.Na.get(e),p=h&&h.key;if(p){let b=new ms(In.comparator);b=b.insert(p,$a.newNoDocument(p,Yn.min()));const E=Mi().add(p),o=new Nb(Yn.min(),new Map,new ms(no),b,E);await NB(s,o),s.Oa=s.Oa.remove(p),s.Na.delete(e),NE(s)}else await lT(s.localStore,e,!1).then(()=>uT(s,e,r)).catch(Ry)}async function _Z(t,e){const r=Jn(t),s=e.batch.batchId;try{const h=await RW(r.localStore,e);VB(r,s,null),FB(r,s),r.sharedClientState.updateMutationState(s,"acknowledged"),await Ly(r,h)}catch(h){await Ry(h)}}async function yZ(t,e,r){const s=Jn(t);try{const h=await function(b,E){const o=Jn(b);return o.persistence.runTransaction("Reject batch","readwrite-primary",O=>{let z;return o.mutationQueue.lookupMutationBatch(O,E).next(U=>(Oo(U!==null),z=U.keys(),o.mutationQueue.removeMutationBatch(O,U))).next(()=>o.mutationQueue.performConsistencyCheck(O)).next(()=>o.documentOverlayCache.removeOverlaysForBatchId(O,z,E)).next(()=>o.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(O,z)).next(()=>o.localDocuments.getDocuments(O,z))})}(s.localStore,e);VB(s,e,r),FB(s,e),s.sharedClientState.updateMutationState(e,"rejected",r),await Ly(s,h)}catch(h){await Ry(h)}}function FB(t,e){(t.ka.get(e)||[]).forEach(r=>{r.resolve()}),t.ka.delete(e)}function VB(t,e,r){const s=Jn(t);let h=s.Ba[s.currentUser.toKey()];if(h){const p=h.get(e);p&&(r?p.reject(r):p.resolve(),h=h.remove(e)),s.Ba[s.currentUser.toKey()]=h}}function uT(t,e,r=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Ma.get(e))t.Fa.delete(s),r&&t.Ca.$a(s,r);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(s=>{t.La.containsKey(s)||UB(t,s)})}function UB(t,e){t.xa.delete(e.path.canonicalString());const r=t.Oa.get(e);r!==null&&(ME(t.remoteStore,r),t.Oa=t.Oa.remove(e),t.Na.delete(r),NE(t))}function YP(t,e,r){for(const s of r)s instanceof LB?(t.La.addReference(s.key,e),vZ(t,s)):s instanceof BB?(dn("SyncEngine","Document no longer in limbo: "+s.key),t.La.removeReference(s.key,e),t.La.containsKey(s.key)||UB(t,s.key)):Gn()}function vZ(t,e){const r=e.key,s=r.path.canonicalString();t.Oa.get(r)||t.xa.has(s)||(dn("SyncEngine","New document in limbo: "+r),t.xa.add(s),NE(t))}function NE(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const r=new In(Wo.fromString(e)),s=t.qa.next();t.Na.set(s,new lZ(r)),t.Oa=t.Oa.insert(r,s),IB(t.remoteStore,new Id(mu(TE(r.path)),s,"TargetPurposeLimboResolution",_E.oe))}}async function Ly(t,e,r){const s=Jn(t),h=[],p=[],b=[];s.Fa.isEmpty()||(s.Fa.forEach((E,o)=>{b.push(s.Ka(o,e,r).then(O=>{var z;if((O||r)&&s.isPrimaryClient){const U=O?!O.fromCache:(z=r==null?void 0:r.targetChanges.get(o.targetId))===null||z===void 0?void 0:z.current;s.sharedClientState.updateQueryState(o.targetId,U?"current":"not-current")}if(O){h.push(O);const U=PE.Wi(o.targetId,O);p.push(U)}}))}),await Promise.all(b),s.Ca.d_(h),await async function(o,O){const z=Jn(o);try{await z.persistence.runTransaction("notifyLocalViewChanges","readwrite",U=>Cr.forEach(O,H=>Cr.forEach(H.$i,Y=>z.persistence.referenceDelegate.addReference(U,H.targetId,Y)).next(()=>Cr.forEach(H.Ui,Y=>z.persistence.referenceDelegate.removeReference(U,H.targetId,Y)))))}catch(U){if(!Py(U))throw U;dn("LocalStore","Failed to update sequence numbers: "+U)}for(const U of O){const H=U.targetId;if(!U.fromCache){const Y=z.os.get(H),Q=Y.snapshotVersion,ge=Y.withLastLimboFreeSnapshotVersion(Q);z.os=z.os.insert(H,ge)}}}(s.localStore,p))}async function bZ(t,e){const r=Jn(t);if(!r.currentUser.isEqual(e)){dn("SyncEngine","User change. New user:",e.toKey());const s=await wB(r.localStore,e);r.currentUser=e,function(p,b){p.ka.forEach(E=>{E.forEach(o=>{o.reject(new nn(Er.CANCELLED,b))})}),p.ka.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(e,s.removedBatchIds,s.addedBatchIds),await Ly(r,s.hs)}}function xZ(t,e){const r=Jn(t),s=r.Na.get(e);if(s&&s.va)return Mi().add(s.key);{let h=Mi();const p=r.Ma.get(e);if(!p)return h;for(const b of p){const E=r.Fa.get(b);h=h.unionWith(E.view.Va)}return h}}function jB(t){const e=Jn(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=NB.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xZ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=gZ.bind(null,e),e.Ca.d_=iZ.bind(null,e.eventManager),e.Ca.$a=oZ.bind(null,e.eventManager),e}function wZ(t){const e=Jn(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=_Z.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yZ.bind(null,e),e}class JP{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Fb(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,r){return null}createIndexBackfillerScheduler(e,r){return null}createLocalStore(e){return CW(this.persistence,new IW,e.initialUser,this.serializer)}createPersistence(e){return new TW(RE.Zr,this.serializer)}createSharedClientState(e){return new LW}async terminate(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class TZ{async initialize(e,r){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=s=>XP(this.syncEngine,s,1),this.remoteStore.remoteSyncer.handleCredentialChange=bZ.bind(null,this.syncEngine),await tZ(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new nZ}()}createDatastore(e){const r=Fb(e.databaseInfo.databaseId),s=function(p){return new FW(p)}(e.databaseInfo);return function(p,b,E,o){return new jW(p,b,E,o)}(e.authCredentials,e.appCheckCredentials,s,r)}createRemoteStore(e){return function(s,h,p,b,E){return new GW(s,h,p,b,E)}(this.localStore,this.datastore,e.asyncQueue,r=>XP(this.syncEngine,r,0),function(){return qP.D()?new qP:new BW}())}createSyncEngine(e,r){return function(h,p,b,E,o,O,z){const U=new cZ(h,p,b,E,o,O);return z&&(U.Qa=!0),U}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}async terminate(){var e,r;await async function(h){const p=Jn(h);dn("RemoteStore","RemoteStore shutting down."),p.L_.add(5),await Dy(p),p.k_.shutdown(),p.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $B{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ga(this.observer.next,e)}error(e){this.observer.error?this.Ga(this.observer.error,e):ph("Uncaught Error in snapshot listener:",e.toString())}za(){this.muted=!0}Ga(e,r){this.muted||setTimeout(()=>{this.muted||e(r)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EZ{constructor(e,r,s,h){this.authCredentials=e,this.appCheckCredentials=r,this.asyncQueue=s,this.databaseInfo=h,this.user=Ua.UNAUTHENTICATED,this.clientId=jL.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(s,async p=>{dn("FirestoreClient","Received user=",p.uid),await this.authCredentialListener(p),this.user=p}),this.appCheckCredentials.start(s,p=>(dn("FirestoreClient","Received new app check token=",p),this.appCheckCredentialListener(p,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new nn(Er.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new hh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){const s=BE(r,"Failed to shutdown persistence");e.reject(s)}}),e.promise}}async function rw(t,e){t.asyncQueue.verifyOperationInProgress(),dn("FirestoreClient","Initializing OfflineComponentProvider");const r=t.configuration;await e.initialize(r);let s=r.initialUser;t.setCredentialChangeListener(async h=>{s.isEqual(h)||(await wB(e.localStore,h),s=h)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function QP(t,e){t.asyncQueue.verifyOperationInProgress();const r=await IZ(t);dn("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(r,t.configuration),t.setCredentialChangeListener(s=>HP(e.remoteStore,s)),t.setAppCheckTokenChangeListener((s,h)=>HP(e.remoteStore,h)),t._onlineComponents=e}function SZ(t){return t.name==="FirebaseError"?t.code===Er.FAILED_PRECONDITION||t.code===Er.UNIMPLEMENTED:!(typeof DOMException<"u"&&t instanceof DOMException)||t.code===22||t.code===20||t.code===11}async function IZ(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){dn("FirestoreClient","Using user provided OfflineComponentProvider");try{await rw(t,t._uninitializedComponentsProvider._offline)}catch(e){const r=e;if(!SZ(r))throw r;Fm("Error using user provided cache. Falling back to memory cache: "+r),await rw(t,new JP)}}else dn("FirestoreClient","Using default OfflineComponentProvider"),await rw(t,new JP);return t._offlineComponents}async function GB(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(dn("FirestoreClient","Using user provided OnlineComponentProvider"),await QP(t,t._uninitializedComponentsProvider._online)):(dn("FirestoreClient","Using default OnlineComponentProvider"),await QP(t,new TZ))),t._onlineComponents}function AZ(t){return GB(t).then(e=>e.syncEngine)}async function qB(t){const e=await GB(t),r=e.eventManager;return r.onListen=uZ.bind(null,e.syncEngine),r.onUnlisten=fZ.bind(null,e.syncEngine),r.onFirstRemoteStoreListen=hZ.bind(null,e.syncEngine),r.onLastRemoteStoreUnlisten=pZ.bind(null,e.syncEngine),r}function CZ(t,e,r={}){const s=new hh;return t.asyncQueue.enqueueAndForget(async()=>function(p,b,E,o,O){const z=new $B({next:H=>{b.enqueueAndForget(()=>OB(p,U));const Y=H.docs.has(E);!Y&&H.fromCache?O.reject(new nn(Er.UNAVAILABLE,"Failed to get document because the client is offline.")):Y&&H.fromCache&&o&&o.source==="server"?O.reject(new nn(Er.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):O.resolve(H)},error:H=>O.reject(H)}),U=new DB(TE(E.path),z,{includeMetadataChanges:!0,_a:!0});return kB(p,U)}(await qB(t),t.asyncQueue,e,r,s)),s.promise}function RZ(t,e,r={}){const s=new hh;return t.asyncQueue.enqueueAndForget(async()=>function(p,b,E,o,O){const z=new $B({next:H=>{b.enqueueAndForget(()=>OB(p,U)),H.fromCache&&o.source==="server"?O.reject(new nn(Er.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):O.resolve(H)},error:H=>O.reject(H)}),U=new DB(E,z,{includeMetadataChanges:!0,_a:!0});return kB(p,U)}(await qB(t),t.asyncQueue,e,r,s)),s.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HB(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eM=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WB(t,e,r){if(!r)throw new nn(Er.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function PZ(t,e,r,s){if(e===!0&&s===!0)throw new nn(Er.INVALID_ARGUMENT,`${t} and ${r} cannot be used together.`)}function tM(t){if(!In.isDocumentKey(t))throw new nn(Er.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function rM(t){if(In.isDocumentKey(t))throw new nn(Er.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function jb(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(s){return s.constructor?s.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Gn()}function Gd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new nn(Er.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=jb(t);throw new nn(Er.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${r}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(e){var r,s;if(e.host===void 0){if(e.ssl!==void 0)throw new nn(Er.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new nn(Er.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}PZ("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=HB((s=e.experimentalLongPollingOptions)!==null&&s!==void 0?s:{}),function(p){if(p.timeoutSeconds!==void 0){if(isNaN(p.timeoutSeconds))throw new nn(Er.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (must not be NaN)`);if(p.timeoutSeconds<5)throw new nn(Er.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (minimum allowed value is 5)`);if(p.timeoutSeconds>30)throw new nn(Er.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(s,h){return s.timeoutSeconds===h.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $b{constructor(e,r,s,h){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=s,this._app=h,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nM({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new nn(Er.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new nn(Er.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nM(e),e.credentials!==void 0&&(this._authCredentials=function(s){if(!s)return new HH;switch(s.type){case"firstParty":return new XH(s.sessionIndex||"0",s.iamToken||null,s.authTokenFactory||null);case"provider":return s.client;default:throw new nn(Er.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const s=eM.get(r);s&&(dn("ComponentProvider","Removing Datastore"),eM.delete(r),s.terminate())}(this),Promise.resolve()}}function MZ(t,e,r,s={}){var h;const p=(t=Gd(t,$b))._getSettings(),b=`${e}:${r}`;if(p.host!=="firestore.googleapis.com"&&p.host!==b&&Fm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},p),{host:b,ssl:!1})),s.mockUserToken){let E,o;if(typeof s.mockUserToken=="string")E=s.mockUserToken,o=Ua.MOCK_USER;else{E=hG(s.mockUserToken,(h=t._app)===null||h===void 0?void 0:h.options.projectId);const O=s.mockUserToken.sub||s.mockUserToken.user_id;if(!O)throw new nn(Er.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new Ua(O)}t._authCredentials=new WH(new UL(E,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(e,r,s){this.converter=r,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new ig(this.firestore,e,this._query)}}class Tl{constructor(e,r,s){this.converter=r,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Tl(this.firestore,e,this._key)}}class kd extends ig{constructor(e,r,s){super(e,r,TE(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Tl(this.firestore,null,new In(e))}withConverter(e){return new kd(this.firestore,e,this._path)}}function Yd(t,e,...r){if(t=Ra(t),WB("collection","path",e),t instanceof $b){const s=Wo.fromString(e,...r);return rM(s),new kd(t,null,s)}{if(!(t instanceof Tl||t instanceof kd))throw new nn(Er.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Wo.fromString(e,...r));return rM(s),new kd(t.firestore,null,s)}}function By(t,e,...r){if(t=Ra(t),arguments.length===1&&(e=jL.newId()),WB("doc","path",e),t instanceof $b){const s=Wo.fromString(e,...r);return tM(s),new Tl(t,null,new In(s))}{if(!(t instanceof Tl||t instanceof kd))throw new nn(Er.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(Wo.fromString(e,...r));return tM(s),new Tl(t.firestore,t instanceof kd?t.converter:null,new In(s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kZ{constructor(){this.au=Promise.resolve(),this.uu=[],this.cu=!1,this.lu=[],this.hu=null,this.Pu=!1,this.Iu=!1,this.Tu=[],this.t_=new EB(this,"async_queue_retry"),this.Eu=()=>{const r=tw();r&&dn("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()};const e=tw();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Eu)}get isShuttingDown(){return this.cu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.du(),this.Au(e)}enterRestrictedMode(e){if(!this.cu){this.cu=!0,this.Iu=e||!1;const r=tw();r&&typeof r.removeEventListener=="function"&&r.removeEventListener("visibilitychange",this.Eu)}}enqueue(e){if(this.du(),this.cu)return new Promise(()=>{});const r=new hh;return this.Au(()=>this.cu&&this.Iu?Promise.resolve():(e().then(r.resolve,r.reject),r.promise)).then(()=>r.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.uu.push(e),this.Ru()))}async Ru(){if(this.uu.length!==0){try{await this.uu[0](),this.uu.shift(),this.t_.reset()}catch(e){if(!Py(e))throw e;dn("AsyncQueue","Operation failed with retryable error: "+e)}this.uu.length>0&&this.t_.Go(()=>this.Ru())}}Au(e){const r=this.au.then(()=>(this.Pu=!0,e().catch(s=>{this.hu=s,this.Pu=!1;const h=function(b){let E=b.message||"";return b.stack&&(E=b.stack.includes(b.message)?b.stack:b.message+`
`+b.stack),E}(s);throw ph("INTERNAL UNHANDLED ERROR: ",h),s}).then(s=>(this.Pu=!1,s))));return this.au=r,r}enqueueAfterDelay(e,r,s){this.du(),this.Tu.indexOf(e)>-1&&(r=0);const h=LE.createAndSchedule(this,e,r,s,p=>this.Vu(p));return this.lu.push(h),h}du(){this.hu&&Gn()}verifyOperationInProgress(){}async mu(){let e;do e=this.au,await e;while(e!==this.au)}fu(e){for(const r of this.lu)if(r.timerId===e)return!0;return!1}gu(e){return this.mu().then(()=>{this.lu.sort((r,s)=>r.targetTimeMs-s.targetTimeMs);for(const r of this.lu)if(r.skipDelay(),e!=="all"&&r.timerId===e)break;return this.mu()})}pu(e){this.Tu.push(e)}Vu(e){const r=this.lu.indexOf(e);this.lu.splice(r,1)}}class zy extends $b{constructor(e,r,s,h){super(e,r,s,h),this.type="firestore",this._queue=function(){return new kZ}(),this._persistenceKey=(h==null?void 0:h.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ZB(this),this._firestoreClient.terminate()}}function OZ(t,e){const r=typeof t=="object"?t:XD(),s=typeof t=="string"?t:"(default)",h=sE(r,"firestore").getImmediate({identifier:s});if(!h._initialized){const p=cG("firestore");p&&MZ(h,...p)}return h}function FE(t){return t._firestoreClient||ZB(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function ZB(t){var e,r,s;const h=t._freezeSettings(),p=function(E,o,O,z){return new c7(E,o,O,z.host,z.ssl,z.experimentalForceLongPolling,z.experimentalAutoDetectLongPolling,HB(z.experimentalLongPollingOptions),z.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,h);t._firestoreClient=new EZ(t._authCredentials,t._appCheckCredentials,t._queue,p),!((r=h.localCache)===null||r===void 0)&&r._offlineComponentProvider&&(!((s=h.localCache)===null||s===void 0)&&s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:h.localCache.kind,_offline:h.localCache._offlineComponentProvider,_online:h.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{constructor(e){this._byteString=e}static fromBase64String(e){try{return new qm(Pa.fromBase64String(e))}catch(r){throw new nn(Er.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new qm(Pa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new nn(Er.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ia(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VE{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UE{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new nn(Er.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new nn(Er.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return no(this._lat,e._lat)||no(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e){this._values=(e||[]).map(r=>r)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(s,h){if(s.length!==h.length)return!1;for(let p=0;p<s.length;++p)if(s[p]!==h[p])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DZ=/^__.*__$/;class LZ{constructor(e,r,s){this.data=e,this.fieldMask=r,this.fieldTransforms=s}toMutation(e,r){return this.fieldMask!==null?new Xd(e,this.data,this.fieldMask,r,this.fieldTransforms):new ky(e,this.data,r,this.fieldTransforms)}}class KB{constructor(e,r,s){this.data=e,this.fieldMask=r,this.fieldTransforms=s}toMutation(e,r){return new Xd(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function XB(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Gn()}}class $E{constructor(e,r,s,h,p,b){this.settings=e,this.databaseId=r,this.serializer=s,this.ignoreUndefinedProperties=h,p===void 0&&this.yu(),this.fieldTransforms=p||[],this.fieldMask=b||[]}get path(){return this.settings.path}get wu(){return this.settings.wu}Su(e){return new $E(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}bu(e){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(e),h=this.Su({path:s,Du:!1});return h.vu(e),h}Cu(e){var r;const s=(r=this.path)===null||r===void 0?void 0:r.child(e),h=this.Su({path:s,Du:!1});return h.yu(),h}Fu(e){return this.Su({path:void 0,Du:!0})}Mu(e){return nb(e,this.settings.methodName,this.settings.xu||!1,this.path,this.settings.Ou)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}yu(){if(this.path)for(let e=0;e<this.path.length;e++)this.vu(this.path.get(e))}vu(e){if(e.length===0)throw this.Mu("Document fields must not be empty");if(XB(this.wu)&&DZ.test(e))throw this.Mu('Document fields cannot begin and end with "__"')}}class BZ{constructor(e,r,s){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=s||Fb(e)}Nu(e,r,s,h=!1){return new $E({wu:e,methodName:r,Ou:s,path:Ia.emptyPath(),Du:!1,xu:h},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function GE(t){const e=t._freezeSettings(),r=Fb(t._databaseId);return new BZ(t._databaseId,!!e.ignoreUndefinedProperties,r)}function zZ(t,e,r,s,h,p={}){const b=t.Nu(p.merge||p.mergeFields?2:0,e,r,h);qE("Data must be an object, but it was:",b,s);const E=YB(s,b);let o,O;if(p.merge)o=new Ul(b.fieldMask),O=b.fieldTransforms;else if(p.mergeFields){const z=[];for(const U of p.mergeFields){const H=hT(e,U,r);if(!b.contains(H))throw new nn(Er.INVALID_ARGUMENT,`Field '${H}' is specified in your field mask but missing from your input data.`);QB(z,H)||z.push(H)}o=new Ul(z),O=b.fieldTransforms.filter(U=>o.covers(U.field))}else o=null,O=b.fieldTransforms;return new LZ(new xl(E),o,O)}class qb extends VE{_toFieldTransform(e){if(e.wu!==2)throw e.wu===1?e.Mu(`${this._methodName}() can only appear at the top level of your update data`):e.Mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof qb}}function NZ(t,e,r,s){const h=t.Nu(1,e,r);qE("Data must be an object, but it was:",h,s);const p=[],b=xl.empty();dp(s,(o,O)=>{const z=HE(e,o,r);O=Ra(O);const U=h.Cu(z);if(O instanceof qb)p.push(z);else{const H=Ny(O,U);H!=null&&(p.push(z),b.set(z,H))}});const E=new Ul(p);return new KB(b,E,h.fieldTransforms)}function FZ(t,e,r,s,h,p){const b=t.Nu(1,e,r),E=[hT(e,s,r)],o=[h];if(p.length%2!=0)throw new nn(Er.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let H=0;H<p.length;H+=2)E.push(hT(e,p[H])),o.push(p[H+1]);const O=[],z=xl.empty();for(let H=E.length-1;H>=0;--H)if(!QB(O,E[H])){const Y=E[H];let Q=o[H];Q=Ra(Q);const ge=b.Cu(Y);if(Q instanceof qb)O.push(Y);else{const ye=Ny(Q,ge);ye!=null&&(O.push(Y),z.set(Y,ye))}}const U=new Ul(O);return new KB(z,U,b.fieldTransforms)}function VZ(t,e,r,s=!1){return Ny(r,t.Nu(s?4:3,e))}function Ny(t,e){if(JB(t=Ra(t)))return qE("Unsupported field value:",e,t),YB(t,e);if(t instanceof VE)return function(s,h){if(!XB(h.wu))throw h.Mu(`${s._methodName}() can only be used with update() and set()`);if(!h.path)throw h.Mu(`${s._methodName}() is not currently supported inside arrays`);const p=s._toFieldTransform(h);p&&h.fieldTransforms.push(p)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Du&&e.wu!==4)throw e.Mu("Nested arrays are not supported");return function(s,h){const p=[];let b=0;for(const E of s){let o=Ny(E,h.Fu(b));o==null&&(o={nullValue:"NULL_VALUE"}),p.push(o),b++}return{arrayValue:{values:p}}}(t,e)}return function(s,h){if((s=Ra(s))===null)return{nullValue:"NULL_VALUE"};if(typeof s=="number")return M7(h.serializer,s);if(typeof s=="boolean")return{booleanValue:s};if(typeof s=="string")return{stringValue:s};if(s instanceof Date){const p=Zs.fromDate(s);return{timestampValue:tb(h.serializer,p)}}if(s instanceof Zs){const p=new Zs(s.seconds,1e3*Math.floor(s.nanoseconds/1e3));return{timestampValue:tb(h.serializer,p)}}if(s instanceof UE)return{geoPointValue:{latitude:s.latitude,longitude:s.longitude}};if(s instanceof qm)return{bytesValue:mB(h.serializer,s._byteString)};if(s instanceof Tl){const p=h.databaseId,b=s.firestore._databaseId;if(!b.isEqual(p))throw h.Mu(`Document reference is for database ${b.projectId}/${b.database} but should be for database ${p.projectId}/${p.database}`);return{referenceValue:AE(s.firestore._databaseId||h.databaseId,s._key.path)}}if(s instanceof jE)return function(b,E){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:b.toArray().map(o=>{if(typeof o!="number")throw E.Mu("VectorValues must only contain numeric values.");return EE(E.serializer,o)})}}}}}}(s,h);throw h.Mu(`Unsupported field value: ${jb(s)}`)}(t,e)}function YB(t,e){const r={};return $L(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dp(t,(s,h)=>{const p=Ny(h,e.bu(s));p!=null&&(r[s]=p)}),{mapValue:{fields:r}}}function JB(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Zs||t instanceof UE||t instanceof qm||t instanceof Tl||t instanceof VE||t instanceof jE)}function qE(t,e,r){if(!JB(r)||!function(h){return typeof h=="object"&&h!==null&&(Object.getPrototypeOf(h)===Object.prototype||Object.getPrototypeOf(h)===null)}(r)){const s=jb(r);throw s==="an object"?e.Mu(t+" a custom object"):e.Mu(t+" "+s)}}function hT(t,e,r){if((e=Ra(e))instanceof Gb)return e._internalPath;if(typeof e=="string")return HE(t,e);throw nb("Field path arguments must be of type string or ",t,!1,void 0,r)}const UZ=new RegExp("[~\\*/\\[\\]]");function HE(t,e,r){if(e.search(UZ)>=0)throw nb(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new Gb(...e.split("."))._internalPath}catch{throw nb(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function nb(t,e,r,s,h){const p=s&&!s.isEmpty(),b=h!==void 0;let E=`Function ${e}() called with invalid data`;r&&(E+=" (via `toFirestore()`)"),E+=". ";let o="";return(p||b)&&(o+=" (found",p&&(o+=` in field ${s}`),b&&(o+=` in document ${h}`),o+=")"),new nn(Er.INVALID_ARGUMENT,E+t+o)}function QB(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ez{constructor(e,r,s,h,p){this._firestore=e,this._userDataWriter=r,this._key=s,this._document=h,this._converter=p}get id(){return this._key.path.lastSegment()}get ref(){return new Tl(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new jZ(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(WE("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class jZ extends ez{data(){return super.data()}}function WE(t,e){return typeof e=="string"?HE(t,e):e instanceof Gb?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $Z(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new nn(Er.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ZE{}class GZ extends ZE{}function KE(t,e,...r){let s=[];e instanceof ZE&&s.push(e),s=s.concat(r),function(p){const b=p.filter(o=>o instanceof XE).length,E=p.filter(o=>o instanceof Hb).length;if(b>1||b>0&&E>0)throw new nn(Er.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const h of s)t=h._apply(t);return t}class Hb extends GZ{constructor(e,r,s){super(),this._field=e,this._op=r,this._value=s,this.type="where"}static _create(e,r,s){return new Hb(e,r,s)}_apply(e){const r=this._parse(e);return tz(e._query,r),new ig(e.firestore,e.converter,rT(e._query,r))}_parse(e){const r=GE(e.firestore);return function(p,b,E,o,O,z,U){let H;if(O.isKeyField()){if(z==="array-contains"||z==="array-contains-any")throw new nn(Er.INVALID_ARGUMENT,`Invalid Query. You can't perform '${z}' queries on documentId().`);if(z==="in"||z==="not-in"){oM(U,z);const Y=[];for(const Q of U)Y.push(iM(o,p,Q));H={arrayValue:{values:Y}}}else H=iM(o,p,U)}else z!=="in"&&z!=="not-in"&&z!=="array-contains-any"||oM(U,z),H=VZ(E,b,U,z==="in"||z==="not-in");return Ls.create(O,z,H)}(e._query,"where",r,e.firestore._databaseId,this._field,this._op,this._value)}}function ib(t,e,r){const s=e,h=WE("where",t);return Hb._create(h,s,r)}class XE extends ZE{constructor(e,r){super(),this.type=e,this._queryConstraints=r}static _create(e,r){return new XE(e,r)}_parse(e){const r=this._queryConstraints.map(s=>s._parse(e)).filter(s=>s.getFilters().length>0);return r.length===1?r[0]:Nc.create(r,this._getOperator())}_apply(e){const r=this._parse(e);return r.getFilters().length===0?e:(function(h,p){let b=h;const E=p.getFlattenedFilters();for(const o of E)tz(b,o),b=rT(b,o)}(e._query,r),new ig(e.firestore,e.converter,rT(e._query,r)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function iM(t,e,r){if(typeof(r=Ra(r))=="string"){if(r==="")throw new nn(Er.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!JL(e)&&r.indexOf("/")!==-1)throw new nn(Er.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);const s=e.path.child(Wo.fromString(r));if(!In.isDocumentKey(s))throw new nn(Er.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return IP(t,new In(s))}if(r instanceof Tl)return IP(t,r._key);throw new nn(Er.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${jb(r)}.`)}function oM(t,e){if(!Array.isArray(t)||t.length===0)throw new nn(Er.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function tz(t,e){const r=function(h,p){for(const b of h)for(const E of b.getFlattenedFilters())if(p.indexOf(E.op)>=0)return E.op;return null}(t.filters,function(h){switch(h){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(r!==null)throw r===e.op?new nn(Er.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new nn(Er.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}class qZ{convertValue(e,r="none"){switch(op(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ss(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,r);case 5:return e.stringValue;case 6:return this.convertBytes(ip(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,r);case 11:return this.convertObject(e.mapValue,r);case 10:return this.convertVectorValue(e.mapValue);default:throw Gn()}}convertObject(e,r){return this.convertObjectMap(e.fields,r)}convertObjectMap(e,r="none"){const s={};return dp(e,(h,p)=>{s[h]=this.convertValue(p,r)}),s}convertVectorValue(e){var r,s,h;const p=(h=(s=(r=e.fields)===null||r===void 0?void 0:r.value.arrayValue)===null||s===void 0?void 0:s.values)===null||h===void 0?void 0:h.map(b=>Ss(b.doubleValue));return new jE(p)}convertGeoPoint(e){return new UE(Ss(e.latitude),Ss(e.longitude))}convertArray(e,r){return(e.values||[]).map(s=>this.convertValue(s,r))}convertServerTimestamp(e,r){switch(r){case"previous":const s=vE(e);return s==null?null:this.convertValue(s,r);case"estimate":return this.convertTimestamp(ny(e));default:return null}}convertTimestamp(e){const r=jd(e);return new Zs(r.seconds,r.nanos)}convertDocumentKey(e,r){const s=Wo.fromString(e);Oo(xB(s));const h=new iy(s.get(1),s.get(3)),p=new In(s.popFirst(5));return h.isEqual(r)||ph(`Document ${p} contains a document reference within a different database (${h.projectId}/${h.database}) which is not supported. It will be treated as a reference in the current database (${r.projectId}/${r.database}) instead.`),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HZ(t,e,r){let s;return s=t?t.toFirestore(e):e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C_{constructor(e,r){this.hasPendingWrites=e,this.fromCache=r}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class rz extends ez{constructor(e,r,s,h,p,b){super(e,r,s,h,b),this._firestore=e,this._firestoreImpl=e,this.metadata=p}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const r=new w0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,r={}){if(this._document){const s=this._document.data.field(WE("DocumentSnapshot.get",e));if(s!==null)return this._userDataWriter.convertValue(s,r.serverTimestamps)}}}class w0 extends rz{data(e={}){return super.data(e)}}class WZ{constructor(e,r,s,h){this._firestore=e,this._userDataWriter=r,this._snapshot=h,this.metadata=new C_(h.hasPendingWrites,h.fromCache),this.query=s}get docs(){const e=[];return this.forEach(r=>e.push(r)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,r){this._snapshot.docs.forEach(s=>{e.call(r,new w0(this._firestore,this._userDataWriter,s.key,s,new C_(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const r=!!e.includeMetadataChanges;if(r&&this._snapshot.excludesMetadataChanges)throw new nn(Er.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===r||(this._cachedChanges=function(h,p){if(h._snapshot.oldDocs.isEmpty()){let b=0;return h._snapshot.docChanges.map(E=>{const o=new w0(h._firestore,h._userDataWriter,E.doc.key,E.doc,new C_(h._snapshot.mutatedKeys.has(E.doc.key),h._snapshot.fromCache),h.query.converter);return E.doc,{type:"added",doc:o,oldIndex:-1,newIndex:b++}})}{let b=h._snapshot.oldDocs;return h._snapshot.docChanges.filter(E=>p||E.type!==3).map(E=>{const o=new w0(h._firestore,h._userDataWriter,E.doc.key,E.doc,new C_(h._snapshot.mutatedKeys.has(E.doc.key),h._snapshot.fromCache),h.query.converter);let O=-1,z=-1;return E.type!==0&&(O=b.indexOf(E.doc.key),b=b.delete(E.doc.key)),E.type!==1&&(b=b.add(E.doc),z=b.indexOf(E.doc.key)),{type:ZZ(E.type),doc:o,oldIndex:O,newIndex:z}})}}(this,r),this._cachedChangesIncludeMetadataChanges=r),this._cachedChanges}}function ZZ(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Gn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YE(t){t=Gd(t,Tl);const e=Gd(t.firestore,zy);return CZ(FE(e),t._key).then(r=>KZ(e,t,r))}class nz extends qZ{constructor(e){super(),this.firestore=e}convertBytes(e){return new qm(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new Tl(this.firestore,null,r)}}function og(t){t=Gd(t,ig);const e=Gd(t.firestore,zy),r=FE(e),s=new nz(e);return $Z(t._query),RZ(r,t._query).then(h=>new WZ(e,s,t,h))}function iz(t,e,r,...s){t=Gd(t,Tl);const h=Gd(t.firestore,zy),p=GE(h);let b;return b=typeof(e=Ra(e))=="string"||e instanceof Gb?FZ(p,"updateDoc",t._key,e,r,s):NZ(p,"updateDoc",t._key,e),sz(h,[b.toMutation(t._key,gu.exists(!0))])}function oz(t,e){const r=Gd(t.firestore,zy),s=By(t),h=HZ(t.converter,e);return sz(r,[zZ(GE(t.firestore),"addDoc",s._key,h,t.converter!==null,{}).toMutation(s._key,gu.exists(!1))]).then(()=>s)}function sz(t,e){return function(s,h){const p=new hh;return s.asyncQueue.enqueueAndForget(async()=>mZ(await AZ(s),h,p)),p.promise}(FE(t),e)}function KZ(t,e,r){const s=r.docs.get(e._key),h=new nz(t);return new rz(t,h,e._key,s,new C_(r.hasPendingWrites,r.fromCache),e.converter)}(function(e,r=!0){(function(h){tg=h})(Qm),Nm(new ep("firestore",(s,{instanceIdentifier:h,options:p})=>{const b=s.getProvider("app").getImmediate(),E=new zy(new ZH(s.getProvider("auth-internal")),new JH(s.getProvider("app-check-internal")),function(O,z){if(!Object.prototype.hasOwnProperty.apply(O.options,["projectId"]))throw new nn(Er.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iy(O.options.projectId,z)}(b,h),b);return p=Object.assign({useFetchStreams:r},p),E._setSettings(p),E},"PUBLIC").setMultipleInstances(!0)),Md(xP,"4.7.1",e),Md(xP,"4.7.1","esm2017")})();const XZ={apiKey:"AIzaSyBToxyfT4YABMNZs4Eb_X_x9DH5IOU8QiY",authDomain:"soulcalm-1ff43.firebaseapp.com",projectId:"soulcalm-1ff43",storageBucket:"soulcalm-1ff43.appspot.com",messagingSenderId:"71234916179",appId:"1:71234916179:web:7dc1f155710adfdd9f9ba6",measurementId:"G-TFLN19XGE9"},az=KD(XZ),JE=OL(az),oc=OZ(az),YZ=async t=>{try{const e=Yd(oc,"users"),r=KE(e,ib("uid","==",t)),s=await og(r);return s.empty?(console.log("No user found with the given UID"),null):s.docs[0].data()}catch(e){throw console.error("Error fetching user info:",e),e}},JZ=async(t,e)=>{try{const r=await oz(Yd(oc,"users"),{uid:t.uid,email:t.email,role:e,creationTime:t.metadata.creationTime});console.log("Document written with ID: ",r.id)}catch(r){console.error("Error adding document: ",r)}},QZ=async(t,e)=>{try{const r=KE(Yd(oc,"users"),ib("uid","==",t)),s=await og(r);s.empty?console.log("No document found with the specified UID!"):s.forEach(h=>{const p=h.data();e.value=p.role,console.log(`Role for UID ${t}: ${e.value}`)})}catch(r){console.error("Error getting user role from Firestore:",r)}},eK=async()=>{try{const t=await og(Yd(oc,"coaches"));console.log("Query snapshot:",t);const e=[];return console.log("Query snapshot:",t),t.forEach(r=>{const s=r.data();s.id=r.id,e.push(s)}),e}catch(t){throw console.error("Error fetching coaches:",t),t}},tK=async(t,e,r,s)=>{try{const h=By(oc,"coaches",t),p=await YE(h);if(!p.exists())throw new Error("Coach not found");const E=p.data().allRatings||{};E[e]={rating:r,comment:s,timestamp:new Date};const o=Object.keys(E).length,z=Object.values(E).reduce((U,H)=>U+H,0)/o;await iz(h,{allRatings:E,totalRatings:o,averageRating:z}),console.log("Rating updated successfully in Firestore")}catch(h){throw console.error("Error updating coach rating:",h),h}},rK=async(t,e)=>{try{const r=Yd(oc,"appointments"),s=KE(r,ib("coachId","==",t),ib("appointmentDate","==",e)),h=await og(s),p=[];return h.forEach(b=>{const E=b.data();E.timeSlot&&p.push(E.timeSlot)}),p}catch(r){return console.error("Error fetching appointments:",r),[]}},nK=async t=>{try{const e=Yd(oc,"appointments"),r=await oz(e,{coachId:t.coachId,coachName:t.coachName,userName:t.userName,userId:t.userId,email:t.email,phone:t.phone,appointmentDate:t.appointmentDate,timeSlot:t.timeSlot,notes:t.notes,createdAt:new Date});return console.log("Appointment successfully created with ID: ",r.id),r.id}catch(e){throw console.error("Error adding appointment: ",e),new Error("Failed to add appointment")}},iK=async(t,e)=>{try{const r=By(oc,"appointments",t);await iz(r,{pdfAttachment:e}),console.log("PDF saved to Firestore successfully")}catch(r){throw console.error("Error saving PDF to Firestore:",r),new Error("Failed to save PDF to Firestore")}},oK=async t=>{try{const e=By(oc,"appointments",t),r=await YE(e);return r.exists()?r.data().pdfAttachment:(console.log("No such appointment document!"),null)}catch(e){throw console.error("Error getting PDF from Firestore:",e),new Error("Failed to get PDF from Firestore")}},sK=async t=>{try{const e=By(oc,"coaches",t),r=await YE(e);if(r.exists()){const h=r.data().allRatings||{};return Object.entries(h).map(([p,b],E)=>({user:`User ${E+1}`,rating:b.rating,comment:b.comment,timestamp:b.timestamp.toDate()}))}else return console.log("No such coach document!"),[]}catch(e){throw console.error("Error getting coach reviews:",e),new Error("Failed to get coach reviews")}},aK=async()=>{try{const t=Yd(oc,"appointments");return(await og(t)).docs.map(r=>({id:r.id,...r.data(),createdAt:r.data().createdAt.toDate()}))}catch(t){throw console.error("Error fetching appointments:",t),t}},lK=async()=>{try{const e=(await og(Yd(oc,"coaches"))).docs.map(r=>r.data().name);return[...new Set(e)]}catch(t){throw console.error("Error fetching unique coaches:",t),t}},uu={saveUserToDatabase:JZ,getAndSetCurrentUserRole:QZ,getAllCoaches:eK,updateCoachRating:tK,getAppointmentsTimeSlotByDate:rK,addAppointment:nK,savePdfToFirestore:iK,getConfirmationLetterPdf:oK,getCoachReviews:sK,getAllAppointments:aK,getUniqueCoachNames:lK,getUserInfo:YZ},ly=Qr(!1),ob=Qr(""),sb=Qr(""),cK=(t,e,r)=>P9(JE,t,e).then(async s=>{const h=s.user;return console.log("User ID (uid):",h.uid),console.log("User Email:",h.email),console.log("Creation Time:",h.metadata.creationTime),console.log("Last Sign In Time:",h.metadata.lastSignInTime),ly.value=!0,await uu.saveUserToDatabase(h,r),console.log("User signed up:",h),h}).catch(s=>{const h=s.code,p=s.message;throw console.error("Signup error:",h,p),alert(p),s}),uK=(t,e)=>M9(JE,t,e).then(async r=>{const s=r.user;return ly.value=!0,sb.value=s.uid,console.log("User logged in:",s),await uu.getAndSetCurrentUserRole(s.uid,ob),ug.push("/"),s}).catch(r=>{throw console.error("Login error:",r),alert(r.message),r}),hK=()=>D9(JE).then(()=>{ly.value=!1,ob.value="",sb.value="",console.log("User logged out"),console.log("isAuthenticated:",ly.value),console.log("currentRole:",ob.value),console.log("currentUserUid:",sb.value)}).catch(t=>{console.error("Logout error:",t)});function sg(){return{isAuthenticated:ly,signup:cK,login:uK,logout:hK,currentRole:ob,currentUserUid:sb}}const dK=t=>(xu("data-v-f46ff142"),t=t(),wu(),t),fK={key:0,class:"loading-overlay"},pK={class:"loading-content"},mK=dK(()=>ct("div",{class:"loading-spinner"},null,-1)),gK={__name:"LoadingModal",props:{show:Boolean,message:{type:String,default:"Processing your booking..."}},setup(t){return(e,r)=>t.show?(sn(),Sn("div",fK,[ct("div",pK,[mK,ct("p",null,Ii(t.message),1)])])):aa("",!0)}},cy=Cl(gK,[["__scopeId","data-v-f46ff142"]]),ag=t=>(xu("data-v-d46c3e71"),t=t(),wu(),t),_K={class:"container"},yK={key:0,class:"loading-overlay"},vK=ag(()=>ct("div",{class:"loading-content"},[ct("h3",null,"Success!"),ct("div",{class:"checkmark"},"✅")],-1)),bK=[vK],xK={class:"row justify-content-center"},wK={class:"col"},TK=ag(()=>ct("h1",{class:"text-center"},"Login",-1)),EK=ag(()=>ct("p",{class:"text-center mb-3"},"Welcome!",-1)),SK={class:"mb-3 form-item"},IK=ag(()=>ct("label",{for:"username",class:"form-label"},"Username",-1)),AK={key:0,class:"text-danger"},CK={class:"mb-3 form-item"},RK=ag(()=>ct("label",{for:"password",class:"form-label"},"Password",-1)),PK={key:0,class:"text-danger"},MK=ag(()=>ct("div",{class:"text-center"},[ct("button",{type:"submit",class:"btn btn-primary me-2"},"Log in")],-1)),kK={__name:"LoginView",setup(t){const{isAuthenticated:e,login:r}=sg(),s=Qr(!1),h=Qr(!1),p=Qr({username:"",password:""}),b=Qr({username:null,password:null}),E=()=>{o(!0),O(!0),!b.value.username&&!b.value.password&&(s.value=!0,r(p.value.username,p.value.password).then(z=>{console.log("Login successful:",z),console.log("isAuthenticated value is:",e.value),s.value=!1,h.value=!0,setTimeout(()=>{h.value=!1,document.body.style.overflow="",ug.push("/")},2e3)}).catch(z=>{console.log("Login failed:",z.message),console.log("isAuthenticated value is:",e.value),s.value=!1,b.value.general=z.message}))},o=z=>{p.value.username.length<3?z&&(b.value.username="Name must be at least 3 characters"):b.value.username=null},O=z=>{p.value.password.length<6?z&&(b.value.password="Password must be at least 6 characters long."):b.value.password=null};return ll(h,z=>{z?document.body.style.overflow="hidden":document.body.style.overflow=""}),(z,U)=>(sn(),Sn("div",_K,[Un(cy,{show:s.value,message:"Processing..."},null,8,["show"]),h.value?(sn(),Sn("div",yK,bK)):aa("",!0),ct("div",xK,[ct("div",wK,[TK,EK,ct("form",{onSubmit:zf(E,["prevent"])},[ct("div",SK,[IK,ds(ct("input",{type:"text",id:"username",class:"form-control",onInput:U[0]||(U[0]=()=>o(!1)),"onUpdate:modelValue":U[1]||(U[1]=H=>p.value.username=H)},null,544),[[fs,p.value.username]]),b.value.username?(sn(),Sn("div",AK,Ii(b.value.username),1)):aa("",!0)]),ct("div",CK,[RK,ds(ct("input",{type:"password",id:"password",class:"form-control",onInput:U[2]||(U[2]=()=>O(!1)),"onUpdate:modelValue":U[3]||(U[3]=H=>p.value.password=H)},null,544),[[fs,p.value.password]]),b.value.password?(sn(),Sn("div",PK,Ii(b.value.password),1)):aa("",!0)]),MK],32)])])]))}},OK=Cl(kK,[["__scopeId","data-v-d46c3e71"]]),Fc=t=>(xu("data-v-5fa66478"),t=t(),wu(),t),DK={class:"container"},LK={key:0,class:"loading-overlay"},BK=Fc(()=>ct("div",{class:"loading-content"},[ct("h3",null,"Success!"),ct("div",{class:"checkmark"},"✅")],-1)),zK=[BK],NK={class:"row justify-content-center"},FK={class:"col"},VK=Fc(()=>ct("h1",{class:"text-center"},"Welcome !",-1)),UK=Fc(()=>ct("p",{class:"text-center mb-3"},"Let's create your account",-1)),jK={class:"mb-3 form-item"},$K=Fc(()=>ct("label",{for:"username",class:"form-label"},"Username",-1)),GK={key:0,class:"text-danger"},qK={class:"mb-3 form-item"},HK=Fc(()=>ct("label",{for:"email",class:"form-label"},"Email address",-1)),WK={key:0,class:"text-danger"},ZK={class:"mb-3 form-item"},KK=Fc(()=>ct("label",{for:"password",class:"form-label"},"Password",-1)),XK={key:0,class:"text-danger"},YK={class:"mb-3 form-item"},JK=Fc(()=>ct("label",{for:"confirm-password",class:"form-label"},"Confirm password",-1)),QK={key:0,class:"text-danger"},eX={class:"mb-3 form-item"},tX=Fc(()=>ct("label",{for:"role",class:"form-label"},"Role",-1)),rX=Fc(()=>ct("option",{value:"user"},"User",-1)),nX=Fc(()=>ct("option",{value:"admin"},"Admin",-1)),iX=[rX,nX],oX=Fc(()=>ct("div",{class:"text-center"},[ct("button",{type:"submit",class:"btn btn-primary"},"Register")],-1)),sX={__name:"RegisterView",setup(t){const{signup:e}=sg(),r=Qr(!1),s=Qr(!1),h=Qr({username:"",email:"",password:"",confirmPassword:"",role:""});Qr([]);const p=()=>{o(!0),O(!0),z(!0),U(),!E.value.username&&!E.value.email&&!E.value.password&&!E.value.confirmPassword&&h.value.role!==""&&(r.value=!0,e(h.value.email,h.value.password,h.value.role).then(H=>{console.log("Registration successful:",H),r.value=!1,s.value=!0,setTimeout(()=>{s.value=!1,b(),ug.push("/login")},2e3)}).catch(H=>{console.error("Registration failed:",H),r.value=!1,E.value.email=H.message}))},b=()=>{h.value={username:"",email:"",password:"",confirmPassword:""},E.value={username:null,email:null,password:null,confirmPassword:null}},E=Qr({username:null,email:null,password:null,confirmPassword:null}),o=H=>{h.value.username.length<3?H&&(E.value.username="Name must be at least 3 characters"):E.value.username=null},O=H=>{const Y=h.value.email;/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Y)?E.value.email=null:H&&(E.value.email="Invalid email address")},z=H=>{const Y=h.value.password,Q=8,ge=/[A-Z]/.test(Y),ye=/[a-z]/.test(Y),ke=/\d/.test(Y),he=/[!@#$%^&*(),.?":{}|<>]/.test(Y);Y.length<Q?H&&(E.value.password=`Password must be at least ${Q} characters long.`):ge?ye?ke?he?E.value.password=null:H&&(E.value.password="Password must contain at least one special character."):H&&(E.value.password="Password must contain at least one number."):H&&(E.value.password="Password must contain at least one lowercase letter."):H&&(E.value.password="Password must contain at least one uppercase letter.")},U=H=>{h.value.confirmPassword!==h.value.password?E.value.confirmPassword="Passwords do not match":E.value.confirmPassword=null};return ll(s,H=>{H?document.body.style.overflow="hidden":document.body.style.overflow=""}),(H,Y)=>(sn(),Sn("div",DK,[Un(cy,{show:r.value,message:"Processing..."},null,8,["show"]),s.value?(sn(),Sn("div",LK,zK)):aa("",!0),ct("div",NK,[ct("div",FK,[VK,UK,ct("form",{onSubmit:zf(p,["prevent"])},[ct("div",jK,[$K,ds(ct("input",{type:"text",class:"form-control",id:"username",onBlur:Y[0]||(Y[0]=()=>o(!0)),onInput:Y[1]||(Y[1]=()=>o(!1)),"onUpdate:modelValue":Y[2]||(Y[2]=Q=>h.value.username=Q)},null,544),[[fs,h.value.username]]),E.value.username?(sn(),Sn("div",GK,Ii(E.value.username),1)):aa("",!0)]),ct("div",qK,[HK,ds(ct("input",{type:"text",class:"form-control",id:"email",onBlur:Y[3]||(Y[3]=()=>O(!0)),onInput:Y[4]||(Y[4]=()=>O(!1)),"onUpdate:modelValue":Y[5]||(Y[5]=Q=>h.value.email=Q)},null,544),[[fs,h.value.email]]),E.value.email?(sn(),Sn("div",WK,Ii(E.value.email),1)):aa("",!0)]),ct("div",ZK,[KK,ds(ct("input",{type:"password",class:"form-control",id:"password",onBlur:Y[6]||(Y[6]=()=>z(!0)),onInput:Y[7]||(Y[7]=()=>z(!1)),"onUpdate:modelValue":Y[8]||(Y[8]=Q=>h.value.password=Q)},null,544),[[fs,h.value.password]]),E.value.password?(sn(),Sn("div",XK,Ii(E.value.password),1)):aa("",!0)]),ct("div",YK,[JK,ds(ct("input",{type:"password",class:"form-control",id:"confirm-password",onBlur:Y[9]||(Y[9]=()=>U()),"onUpdate:modelValue":Y[10]||(Y[10]=Q=>h.value.confirmPassword=Q)},null,544),[[fs,h.value.confirmPassword]]),E.value.confirmPassword?(sn(),Sn("div",QK,Ii(E.value.confirmPassword),1)):aa("",!0)]),ct("div",eX,[tX,ds(ct("select",{class:"form-control",id:"role","onUpdate:modelValue":Y[11]||(Y[11]=Q=>h.value.role=Q)},iX,512),[[wy,h.value.role]])]),oX],32)])])]))}},aX=Cl(sX,[["__scopeId","data-v-5fa66478"]]),lX={class:"container"},cX={key:0},uX=ct("h1",{class:"text-center"},"Access Denied",-1),hX=ct("p",{class:"text-center"}," You do not have permission to view this page. Please log in first. ",-1),dX=[uX,hX],fX={key:1},pX=ct("h1",{class:"text-center"},"Access Denied",-1),mX=ct("p",{class:"text-center"},"You do not have permission to view this page.",-1),gX=[pX,mX],_X={key:2},yX=ct("h1",{class:"text-center"},"Community",-1),vX=ct("p",{class:"text-center"},"Welcome to the community page!",-1),bX=[yX,vX],xX={__name:"AccessDeniedView",setup(t){const{isAuthenticated:e,currentRole:r}=sg();return(s,h)=>(sn(),Sn("div",lX,[ct("div",null,[Ws(e)?Ws(r)=="user"?(sn(),Sn("div",fX,gX)):Ws(r)=="admin"?(sn(),Sn("div",_X,bX)):aa("",!0):(sn(),Sn("div",cX,dX))])]))}};var lz={exports:{}};const wX=DM(G2);(function(t){t.exports=function(e){var r={};function s(h){if(r[h])return r[h].exports;var p=r[h]={i:h,l:!1,exports:{}};return e[h].call(p.exports,p,p.exports,s),p.l=!0,p.exports}return s.m=e,s.c=r,s.d=function(h,p,b){s.o(h,p)||Object.defineProperty(h,p,{enumerable:!0,get:b})},s.r=function(h){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(h,"__esModule",{value:!0})},s.t=function(h,p){if(p&1&&(h=s(h)),p&8||p&4&&typeof h=="object"&&h&&h.__esModule)return h;var b=Object.create(null);if(s.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:h}),p&2&&typeof h!="string")for(var E in h)s.d(b,E,(function(o){return h[o]}).bind(null,E));return b},s.n=function(h){var p=h&&h.__esModule?function(){return h.default}:function(){return h};return s.d(p,"a",p),p},s.o=function(h,p){return Object.prototype.hasOwnProperty.call(h,p)},s.p="",s(s.s="fb15")}({"0a04":function(e,r,s){var h=s("4bad");r=h(!1),r.push([e.i,".vue-star-rating-star[data-v-f675a548]{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.vue-star-rating-pointer[data-v-f675a548]{cursor:pointer}.vue-star-rating[data-v-f675a548]{display:flex;align-items:center}.vue-star-rating-inline[data-v-f675a548]{display:inline-flex}.vue-star-rating-rating-text[data-v-f675a548]{margin-left:7px}.vue-star-rating-rtl[data-v-f675a548]{direction:rtl}.vue-star-rating-rtl .vue-star-rating-rating-text[data-v-f675a548]{margin-right:10px;direction:rtl}.sr-only[data-v-f675a548]{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}",""]),e.exports=r},"0fde":function(e,r,s){var h=s("4bad");r=h(!1),r.push([e.i,".vue-star-rating-star[data-v-11edf2d6]{overflow:visible!important}.vue-star-rating-star-rotate[data-v-11edf2d6]{transition:all .25s}.vue-star-rating-star-rotate[data-v-11edf2d6]:hover{transition:transform .25s;transform:rotate(-15deg) scale(1.3)}",""]),e.exports=r},"499e":function(e,r,s){s.r(r),s.d(r,"default",function(){return ge});function h(ze,Te){for(var ie=[],ne={},te=0;te<Te.length;te++){var re=Te[te],me=re[0],we=re[1],tt=re[2],Et=re[3],ft={id:ze+":"+te,css:we,media:tt,sourceMap:Et};ne[me]?ne[me].parts.push(ft):ie.push(ne[me]={id:me,parts:[ft]})}return ie}var p=typeof document<"u";if(typeof DEBUG<"u"&&DEBUG&&!p)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var b={},E=p&&(document.head||document.getElementsByTagName("head")[0]),o=null,O=0,z=!1,U=function(){},H=null,Y="data-vue-ssr-id",Q=typeof navigator<"u"&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function ge(ze,Te,ie,ne){z=ie,H=ne||{};var te=h(ze,Te);return ye(te),function(me){for(var we=[],tt=0;tt<te.length;tt++){var Et=te[tt],ft=b[Et.id];ft.refs--,we.push(ft)}me?(te=h(ze,me),ye(te)):te=[];for(var tt=0;tt<we.length;tt++){var ft=we[tt];if(ft.refs===0){for(var rr=0;rr<ft.parts.length;rr++)ft.parts[rr]();delete b[ft.id]}}}}function ye(ze){for(var Te=0;Te<ze.length;Te++){var ie=ze[Te],ne=b[ie.id];if(ne){ne.refs++;for(var te=0;te<ne.parts.length;te++)ne.parts[te](ie.parts[te]);for(;te<ie.parts.length;te++)ne.parts.push(he(ie.parts[te]));ne.parts.length>ie.parts.length&&(ne.parts.length=ie.parts.length)}else{for(var re=[],te=0;te<ie.parts.length;te++)re.push(he(ie.parts[te]));b[ie.id]={id:ie.id,refs:1,parts:re}}}}function ke(){var ze=document.createElement("style");return ze.type="text/css",E.appendChild(ze),ze}function he(ze){var Te,ie,ne=document.querySelector("style["+Y+'~="'+ze.id+'"]');if(ne){if(z)return U;ne.parentNode.removeChild(ne)}if(Q){var te=O++;ne=o||(o=ke()),Te=ve.bind(null,ne,te,!1),ie=ve.bind(null,ne,te,!0)}else ne=ke(),Te=be.bind(null,ne),ie=function(){ne.parentNode.removeChild(ne)};return Te(ze),function(me){if(me){if(me.css===ze.css&&me.media===ze.media&&me.sourceMap===ze.sourceMap)return;Te(ze=me)}else ie()}}var oe=function(){var ze=[];return function(Te,ie){return ze[Te]=ie,ze.filter(Boolean).join(`
`)}}();function ve(ze,Te,ie,ne){var te=ie?"":ne.css;if(ze.styleSheet)ze.styleSheet.cssText=oe(Te,te);else{var re=document.createTextNode(te),me=ze.childNodes;me[Te]&&ze.removeChild(me[Te]),me.length?ze.insertBefore(re,me[Te]):ze.appendChild(re)}}function be(ze,Te){var ie=Te.css,ne=Te.media,te=Te.sourceMap;if(ne&&ze.setAttribute("media",ne),H.ssrId&&ze.setAttribute(Y,Te.id),te&&(ie+=`
/*# sourceURL=`+te.sources[0]+" */",ie+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(te))))+" */"),ze.styleSheet)ze.styleSheet.cssText=ie;else{for(;ze.firstChild;)ze.removeChild(ze.firstChild);ze.appendChild(document.createTextNode(ie))}}},"4bad":function(e,r,s){e.exports=function(b){var E=[];return E.toString=function(){return this.map(function(O){var z=h(O,b);return O[2]?"@media ".concat(O[2]," {").concat(z,"}"):z}).join("")},E.i=function(o,O,z){typeof o=="string"&&(o=[[null,o,""]]);var U={};if(z)for(var H=0;H<this.length;H++){var Y=this[H][0];Y!=null&&(U[Y]=!0)}for(var Q=0;Q<o.length;Q++){var ge=[].concat(o[Q]);z&&U[ge[0]]||(O&&(ge[2]?ge[2]="".concat(O," and ").concat(ge[2]):ge[2]=O),E.push(ge))}},E};function h(b,E){var o=b[1]||"",O=b[3];if(!O)return o;if(E&&typeof btoa=="function"){var z=p(O),U=O.sources.map(function(H){return"/*# sourceURL=".concat(O.sourceRoot||"").concat(H," */")});return[o].concat(U).concat([z]).join(`
`)}return[o].join(`
`)}function p(b){var E=btoa(unescape(encodeURIComponent(JSON.stringify(b)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(E);return"/*# ".concat(o," */")}},"5bef":function(e,r,s){var h=s("0fde");typeof h=="string"&&(h=[[e.i,h,""]]),h.locals&&(e.exports=h.locals);var p=s("499e").default;p("f426be92",h,!0,{sourceMap:!1,shadowMode:!1})},8875:function(e,r,s){var h,p,b;(function(E,o){p=[],h=o,b=typeof h=="function"?h.apply(r,p):h,b!==void 0&&(e.exports=b)})(typeof self<"u"?self:this,function(){function E(){var o=Object.getOwnPropertyDescriptor(document,"currentScript");if(!o&&"currentScript"in document&&document.currentScript||o&&o.get!==E&&document.currentScript)return document.currentScript;try{throw new Error}catch(ve){var O=/.*at [^(]*\((.*):(.+):(.+)\)$/ig,z=/@([^@]*):(\d+):(\d+)\s*$/ig,U=O.exec(ve.stack)||z.exec(ve.stack),H=U&&U[1]||!1,Y=U&&U[2]||!1,Q=document.location.href.replace(document.location.hash,""),ge,ye,ke,he=document.getElementsByTagName("script");H===Q&&(ge=document.documentElement.outerHTML,ye=new RegExp("(?:[^\\n]+?\\n){0,"+(Y-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),ke=ge.replace(ye,"$1").trim());for(var oe=0;oe<he.length;oe++)if(he[oe].readyState==="interactive"||he[oe].src===H||H===Q&&he[oe].innerHTML&&he[oe].innerHTML.trim()===ke)return he[oe];return null}}return E})},"8bbf":function(e,r){e.exports=wX},"9ff5":function(e,r,s){s("eed3")},d1b1:function(e,r,s){s("5bef")},d4aa:function(e,r){class s{constructor(p){this.color=p}parseAlphaColor(){return/^rgba\((\d{1,3}%?\s*,\s*){3}(\d*(?:\.\d+)?)\)$/.test(this.color)?this.parseRgba():/^hsla\(\d+\s*,\s*([\d.]+%\s*,\s*){2}(\d*(?:\.\d+)?)\)$/.test(this.color)?this.parseHsla():/^#([0-9A-Fa-f]{4}|[0-9A-Fa-f]{8})$/.test(this.color)?this.parseAlphaHex():/^transparent$/.test(this.color)?this.parseTransparent():{color:this.color,opacity:"1"}}parseRgba(){return{color:this.color.replace(/,(?!.*,).*(?=\))|a/g,""),opacity:this.color.match(/\.\d+|[01](?=\))/)[0]}}parseHsla(){return{color:this.color.replace(/,(?!.*,).*(?=\))|a/g,""),opacity:this.color.match(/\.\d+|[01](?=\))/)[0]}}parseAlphaHex(){return{color:this.color.length===5?this.color.substring(0,4):this.color.substring(0,7),opacity:this.color.length===5?(parseInt(this.color.substring(4,5)+this.color.substring(4,5),16)/255).toFixed(2):(parseInt(this.color.substring(7,9),16)/255).toFixed(2)}}parseTransparent(){return{color:"#fff",opacity:0}}}e.exports=s},eed3:function(e,r,s){var h=s("0a04");typeof h=="string"&&(h=[[e.i,h,""]]),h.locals&&(e.exports=h.locals);var p=s("499e").default;p("87bea518",h,!0,{sourceMap:!1,shadowMode:!1})},fb15:function(e,r,s){if(s.r(r),typeof window<"u"){var h=window.document.currentScript;{var p=s("8875");h=p(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:p})}var b=h&&h.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);b&&(s.p=b[1])}var E=s("8bbf");const o=Object(E.withScopeId)("data-v-f675a548");Object(E.pushScopeId)("data-v-f675a548");const O={class:"sr-only"};Object(E.popScopeId)();const z=o(function(ze,Te,ie,ne,te,re){const me=Object(E.resolveComponent)("star");return Object(E.openBlock)(),Object(E.createBlock)("div",{class:["vue-star-rating",{"vue-star-rating-rtl":ie.rtl},{"vue-star-rating-inline":ie.inline}]},[Object(E.createVNode)("div",O,[Object(E.renderSlot)(ze.$slots,"screen-reader",{rating:te.selectedRating,stars:ie.maxRating},()=>[Object(E.createVNode)("span",null,"Rated "+Object(E.toDisplayString)(te.selectedRating)+" stars out of "+Object(E.toDisplayString)(ie.maxRating),1)])]),Object(E.createVNode)("div",{class:"vue-star-rating",onMouseleave:Te[2]||(Te[2]=(...we)=>re.resetRating(...we))},[(Object(E.openBlock)(!0),Object(E.createBlock)(E.Fragment,null,Object(E.renderList)(ie.maxRating,we=>(Object(E.openBlock)(),Object(E.createBlock)("span",{key:we,class:[{"vue-star-rating-pointer":!ie.readOnly},"vue-star-rating-star"],style:{"margin-right":re.margin+"px"}},[Object(E.createVNode)(me,{fill:te.fillLevel[we-1],size:ie.starSize,points:ie.starPoints,"star-id":we,step:te.step,"active-color":re.currentActiveColor,"inactive-color":ie.inactiveColor,"border-color":ie.borderColor,"active-border-color":re.currentActiveBorderColor,"border-width":ie.borderWidth,"rounded-corners":ie.roundedCorners,rtl:ie.rtl,glow:ie.glow,"glow-color":ie.glowColor,animate:ie.animate,"onStar-selected":Te[1]||(Te[1]=tt=>re.setRating(tt,!0)),"onStar-mouse-move":re.setRating},null,8,["fill","size","points","star-id","step","active-color","inactive-color","border-color","active-border-color","border-width","rounded-corners","rtl","glow","glow-color","animate","onStar-mouse-move"])],6))),128)),ie.showRating?(Object(E.openBlock)(),Object(E.createBlock)("span",{key:0,class:["vue-star-rating-rating-text",ie.textClass]},Object(E.toDisplayString)(re.formattedRating),3)):Object(E.createCommentVNode)("",!0)],32)],2)}),U=Object(E.withScopeId)("data-v-11edf2d6");Object(E.pushScopeId)("data-v-11edf2d6");const H=Object(E.createVNode)("feMerge",null,[Object(E.createVNode)("feMergeNode",{in:"coloredBlur"}),Object(E.createVNode)("feMergeNode",{in:"SourceGraphic"})],-1);Object(E.popScopeId)();const Y=U(function(ze,Te,ie,ne,te,re){return Object(E.openBlock)(),Object(E.createBlock)("svg",{class:["vue-star-rating-star",{"vue-star-rating-star-rotate":re.shouldAnimate}],height:re.starSize,width:re.starSize,viewBox:re.viewBox,onMousemove:Te[1]||(Te[1]=(...me)=>re.mouseMoving(...me)),onClick:Te[2]||(Te[2]=(...me)=>re.selected(...me)),onTouchstart:Te[3]||(Te[3]=(...me)=>re.touchStart(...me)),onTouchend:Te[4]||(Te[4]=(...me)=>re.touchEnd(...me))},[Object(E.createVNode)("linearGradient",{id:te.grad,x1:"0",x2:"100%",y1:"0",y2:"0"},[Object(E.createVNode)("stop",{offset:re.starFill,"stop-color":ie.rtl?re.getColor(ie.inactiveColor):re.getColor(ie.activeColor),"stop-opacity":ie.rtl?re.getOpacity(ie.inactiveColor):re.getOpacity(ie.activeColor)},null,8,["offset","stop-color","stop-opacity"]),Object(E.createVNode)("stop",{offset:re.starFill,"stop-color":ie.rtl?re.getColor(ie.activeColor):re.getColor(ie.inactiveColor),"stop-opacity":ie.rtl?re.getOpacity(ie.activeColor):re.getOpacity(ie.inactiveColor)},null,8,["offset","stop-color","stop-opacity"])],8,["id"]),Object(E.createVNode)("filter",{id:te.glowId,height:"130%",width:"130%",filterUnits:"userSpaceOnUse"},[Object(E.createVNode)("feGaussianBlur",{stdDeviation:ie.glow,result:"coloredBlur"},null,8,["stdDeviation"]),H],8,["id"]),Object(E.withDirectives)(Object(E.createVNode)("polygon",{points:re.starPointsToString,fill:re.gradId,stroke:ie.glowColor,filter:"url(#"+te.glowId+")","stroke-width":re.border},null,8,["points","fill","stroke","filter","stroke-width"]),[[E.vShow,ie.glowColor&&ie.glow>0&&ie.fill>0]]),Object(E.createVNode)("polygon",{points:re.starPointsToString,fill:re.gradId,stroke:re.getBorderColor,"stroke-width":re.border,"stroke-linejoin":re.strokeLinejoin},null,8,["points","fill","stroke","stroke-width","stroke-linejoin"]),Object(E.createVNode)("polygon",{points:re.starPointsToString,fill:re.gradId},null,8,["points","fill"])],42,["height","width","viewBox"])});var Q=s("d4aa"),ge=s.n(Q),ye={name:"Star",props:{fill:{type:Number,default:0},points:{type:Array,default(){return[]}},size:{type:Number,default:50},starId:{type:Number,required:!0},activeColor:{type:String,required:!0},inactiveColor:{type:String,required:!0},borderColor:{type:String,default:"#000"},activeBorderColor:{type:String,default:"#000"},borderWidth:{type:Number,default:0},roundedCorners:{type:Boolean,default:!1},rtl:{type:Boolean,default:!1},glow:{type:Number,default:0},glowColor:{type:String,default:null,required:!1},animate:{type:Boolean,default:!1}},emits:["star-mouse-move","star-selected"],data(){return{starPoints:[19.8,2.2,6.6,43.56,39.6,17.16,0,17.16,33,43.56],grad:"",glowId:"",isStarActive:!0}},computed:{starPointsToString(){return this.starPoints.join(",")},gradId(){return"url(#"+this.grad+")"},starSize(){const be=this.roundedCorners&&this.borderWidth<=0?parseInt(this.size)-parseInt(this.border):this.size;return parseInt(be)+parseInt(this.border)},starFill(){return this.rtl?100-this.fill+"%":this.fill+"%"},border(){return this.roundedCorners&&this.borderWidth<=0?6:this.borderWidth},getBorderColor(){return this.roundedCorners&&this.borderWidth<=0?this.fill<=0?this.inactiveColor:this.activeColor:this.fill<=0?this.borderColor:this.activeBorderColor},maxSize(){return this.starPoints.reduce(function(be,ze){return Math.max(be,ze)})},viewBox(){return"0 0 "+this.maxSize+" "+this.maxSize},shouldAnimate(){return this.animate&&this.isStarActive},strokeLinejoin(){return this.roundedCorners?"round":"miter"}},created(){this.starPoints=this.points.length?this.points:this.starPoints,this.calculatePoints(),this.grad=this.getRandomId(),this.glowId=this.getRandomId()},methods:{mouseMoving(be){be.touchAction!=="undefined"&&this.$emit("star-mouse-move",{event:be,position:this.getPosition(be),id:this.starId})},touchStart(){this.$nextTick(()=>{this.isStarActive=!0})},touchEnd(){this.$nextTick(()=>{this.isStarActive=!1})},getPosition(be){var ze=.92*this.size;const Te=this.rtl?Math.min(be.offsetX,45):Math.max(be.offsetX,1);var ie=Math.round(100/ze*Te);return Math.min(ie,100)},selected(be){this.$emit("star-selected",{id:this.starId,position:this.getPosition(be)})},getRandomId(){return Math.random().toString(36).substring(7)},calculatePoints(){this.starPoints=this.starPoints.map((be,ze)=>{const Te=ze%2===0?this.border*1.5:0;return this.size/this.maxSize*be+Te})},getColor(be){return new ge.a(be).parseAlphaColor().color},getOpacity(be){return new ge.a(be).parseAlphaColor().opacity}}};s("d1b1"),ye.render=Y,ye.__scopeId="data-v-11edf2d6";var ke=ye,he={name:"VueStarRating",components:{Star:ke},props:{increment:{type:Number,default:1},rating:{type:Number,default:0},roundStartRating:{type:Boolean,default:!0},activeColor:{type:[String,Array],default:"#ffd055"},inactiveColor:{type:String,default:"#d8d8d8"},maxRating:{type:Number,default:5},starPoints:{type:Array,default(){return[]}},starSize:{type:Number,default:50},showRating:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1},textClass:{type:String,default:""},inline:{type:Boolean,default:!1},borderColor:{type:String,default:"#999"},activeBorderColor:{type:[String,Array],default:null},borderWidth:{type:Number,default:0},roundedCorners:{type:Boolean,default:!1},padding:{type:Number,default:0},rtl:{type:Boolean,default:!1},fixedPoints:{type:Number,default:null},glow:{type:Number,default:0},glowColor:{type:String,default:"#fff"},clearable:{type:Boolean,default:!1},activeOnClick:{type:Boolean,default:!1},animate:{type:Boolean,default:!1}},emits:["update:rating","hover:rating"],data(){return{step:0,fillLevel:[],currentRating:0,selectedRating:0,ratingSelected:!1}},computed:{formattedRating(){return this.fixedPoints===null?this.currentRating:this.currentRating.toFixed(this.fixedPoints)},shouldRound(){return this.ratingSelected||this.roundStartRating},margin(){return this.padding+this.borderWidth},activeColors(){return Array.isArray(this.activeColor)?this.padColors(this.activeColor,this.maxRating,this.activeColor.slice(-1)[0]):new Array(this.maxRating).fill(this.activeColor)},currentActiveColor(){return this.activeOnClick?this.selectedRating>0?this.activeColors[Math.ceil(this.selectedRating)-1]:this.inactiveColor:this.currentRating>0?this.activeColors[Math.ceil(this.currentRating)-1]:this.inactiveColor},activeBorderColors(){if(Array.isArray(this.activeBorderColor))return this.padColors(this.activeBorderColor,this.maxRating,this.activeBorderColor.slice(-1)[0]);let be=this.activeBorderColor?this.activeBorderColor:this.borderColor;return new Array(this.maxRating).fill(be)},currentActiveBorderColor(){return this.activeOnClick?this.selectedRating>0?this.activeBorderColors[Math.ceil(this.selectedRating)-1]:this.borderColor:this.currentRating>0?this.activeBorderColors[Math.ceil(this.currentRating)-1]:this.borderColor}},watch:{rating(be){this.currentRating=be,this.selectedRating=be,this.createStars(this.shouldRound)}},created(){this.step=this.increment*100,this.currentRating=this.rating,this.selectedRating=this.currentRating,this.createStars(this.roundStartRating)},methods:{setRating(be,ze){if(!this.readOnly){const Te=this.rtl?(100-be.position)/100:be.position/100;this.currentRating=(be.id+Te-1).toFixed(2),this.currentRating=this.currentRating>this.maxRating?this.maxRating:this.currentRating,ze?(this.createStars(!0,!0),this.clearable&&this.currentRating===this.selectedRating?this.selectedRating=0:this.selectedRating=this.currentRating,this.$emit("update:rating",this.selectedRating),this.ratingSelected=!0):(this.createStars(!0,!this.activeOnClick),this.$emit("hover:rating",this.currentRating))}},resetRating(){this.readOnly||(this.currentRating=this.selectedRating,this.createStars(this.shouldRound))},createStars(be=!0,ze=!0){be&&this.round();for(var Te=0;Te<this.maxRating;Te++){let ie=0;Te<this.currentRating&&(ie=this.currentRating-Te>1?100:(this.currentRating-Te)*100),ze&&(this.fillLevel[Te]=Math.round(ie))}},round(){var be=1/this.increment;this.currentRating=Math.min(this.maxRating,Math.ceil(this.currentRating*be)/be)},padColors(be,ze,Te){return Object.assign(new Array(ze).fill(Te),be)}}};s("9ff5"),he.render=z,he.__scopeId="data-v-f675a548";var oe=he,ve=oe;r.default=ve}})})(lz);var TX=lz.exports;const nw=ub(TX);function cz(t,e){return function(){return t.apply(e,arguments)}}const{toString:EX}=Object.prototype,{getPrototypeOf:QE}=Object,Wb=(t=>e=>{const r=EX.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Vc=t=>(t=t.toLowerCase(),e=>Wb(e)===t),Zb=t=>e=>typeof e===t,{isArray:lg}=Array,uy=Zb("undefined");function SX(t){return t!==null&&!uy(t)&&t.constructor!==null&&!uy(t.constructor)&&$l(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const uz=Vc("ArrayBuffer");function IX(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&uz(t.buffer),e}const AX=Zb("string"),$l=Zb("function"),hz=Zb("number"),Kb=t=>t!==null&&typeof t=="object",CX=t=>t===!0||t===!1,T0=t=>{if(Wb(t)!=="object")return!1;const e=QE(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},RX=Vc("Date"),PX=Vc("File"),MX=Vc("Blob"),kX=Vc("FileList"),OX=t=>Kb(t)&&$l(t.pipe),DX=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||$l(t.append)&&((e=Wb(t))==="formdata"||e==="object"&&$l(t.toString)&&t.toString()==="[object FormData]"))},LX=Vc("URLSearchParams"),[BX,zX,NX,FX]=["ReadableStream","Request","Response","Headers"].map(Vc),VX=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Fy(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let s,h;if(typeof t!="object"&&(t=[t]),lg(t))for(s=0,h=t.length;s<h;s++)e.call(null,t[s],s,t);else{const p=r?Object.getOwnPropertyNames(t):Object.keys(t),b=p.length;let E;for(s=0;s<b;s++)E=p[s],e.call(null,t[E],E,t)}}function dz(t,e){e=e.toLowerCase();const r=Object.keys(t);let s=r.length,h;for(;s-- >0;)if(h=r[s],e===h.toLowerCase())return h;return null}const Ff=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,fz=t=>!uy(t)&&t!==Ff;function dT(){const{caseless:t}=fz(this)&&this||{},e={},r=(s,h)=>{const p=t&&dz(e,h)||h;T0(e[p])&&T0(s)?e[p]=dT(e[p],s):T0(s)?e[p]=dT({},s):lg(s)?e[p]=s.slice():e[p]=s};for(let s=0,h=arguments.length;s<h;s++)arguments[s]&&Fy(arguments[s],r);return e}const UX=(t,e,r,{allOwnKeys:s}={})=>(Fy(e,(h,p)=>{r&&$l(h)?t[p]=cz(h,r):t[p]=h},{allOwnKeys:s}),t),jX=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),$X=(t,e,r,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},GX=(t,e,r,s)=>{let h,p,b;const E={};if(e=e||{},t==null)return e;do{for(h=Object.getOwnPropertyNames(t),p=h.length;p-- >0;)b=h[p],(!s||s(b,t,e))&&!E[b]&&(e[b]=t[b],E[b]=!0);t=r!==!1&&QE(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},qX=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const s=t.indexOf(e,r);return s!==-1&&s===r},HX=t=>{if(!t)return null;if(lg(t))return t;let e=t.length;if(!hz(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},WX=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&QE(Uint8Array)),ZX=(t,e)=>{const s=(t&&t[Symbol.iterator]).call(t);let h;for(;(h=s.next())&&!h.done;){const p=h.value;e.call(t,p[0],p[1])}},KX=(t,e)=>{let r;const s=[];for(;(r=t.exec(e))!==null;)s.push(r);return s},XX=Vc("HTMLFormElement"),YX=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,h){return s.toUpperCase()+h}),sM=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),JX=Vc("RegExp"),pz=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),s={};Fy(r,(h,p)=>{let b;(b=e(h,p,t))!==!1&&(s[p]=b||h)}),Object.defineProperties(t,s)},QX=t=>{pz(t,(e,r)=>{if($l(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const s=t[r];if($l(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},eY=(t,e)=>{const r={},s=h=>{h.forEach(p=>{r[p]=!0})};return lg(t)?s(t):s(String(t).split(e)),r},tY=()=>{},rY=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,iw="abcdefghijklmnopqrstuvwxyz",aM="0123456789",mz={DIGIT:aM,ALPHA:iw,ALPHA_DIGIT:iw+iw.toUpperCase()+aM},nY=(t=16,e=mz.ALPHA_DIGIT)=>{let r="";const{length:s}=e;for(;t--;)r+=e[Math.random()*s|0];return r};function iY(t){return!!(t&&$l(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const oY=t=>{const e=new Array(10),r=(s,h)=>{if(Kb(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[h]=s;const p=lg(s)?[]:{};return Fy(s,(b,E)=>{const o=r(b,h+1);!uy(o)&&(p[E]=o)}),e[h]=void 0,p}}return s};return r(t,0)},sY=Vc("AsyncFunction"),aY=t=>t&&(Kb(t)||$l(t))&&$l(t.then)&&$l(t.catch),gz=((t,e)=>t?setImmediate:e?((r,s)=>(Ff.addEventListener("message",({source:h,data:p})=>{h===Ff&&p===r&&s.length&&s.shift()()},!1),h=>{s.push(h),Ff.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",$l(Ff.postMessage)),lY=typeof queueMicrotask<"u"?queueMicrotask.bind(Ff):typeof process<"u"&&process.nextTick||gz,sr={isArray:lg,isArrayBuffer:uz,isBuffer:SX,isFormData:DX,isArrayBufferView:IX,isString:AX,isNumber:hz,isBoolean:CX,isObject:Kb,isPlainObject:T0,isReadableStream:BX,isRequest:zX,isResponse:NX,isHeaders:FX,isUndefined:uy,isDate:RX,isFile:PX,isBlob:MX,isRegExp:JX,isFunction:$l,isStream:OX,isURLSearchParams:LX,isTypedArray:WX,isFileList:kX,forEach:Fy,merge:dT,extend:UX,trim:VX,stripBOM:jX,inherits:$X,toFlatObject:GX,kindOf:Wb,kindOfTest:Vc,endsWith:qX,toArray:HX,forEachEntry:ZX,matchAll:KX,isHTMLForm:XX,hasOwnProperty:sM,hasOwnProp:sM,reduceDescriptors:pz,freezeMethods:QX,toObjectSet:eY,toCamelCase:YX,noop:tY,toFiniteNumber:rY,findKey:dz,global:Ff,isContextDefined:fz,ALPHABET:mz,generateString:nY,isSpecCompliantForm:iY,toJSONObject:oY,isAsyncFn:sY,isThenable:aY,setImmediate:gz,asap:lY};function si(t,e,r,s,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),s&&(this.request=s),h&&(this.response=h,this.status=h.status?h.status:null)}sr.inherits(si,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:sr.toJSONObject(this.config),code:this.code,status:this.status}}});const _z=si.prototype,yz={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{yz[t]={value:t}});Object.defineProperties(si,yz);Object.defineProperty(_z,"isAxiosError",{value:!0});si.from=(t,e,r,s,h,p)=>{const b=Object.create(_z);return sr.toFlatObject(t,b,function(o){return o!==Error.prototype},E=>E!=="isAxiosError"),si.call(b,t.message,e,r,s,h),b.cause=t,b.name=t.name,p&&Object.assign(b,p),b};const cY=null;function fT(t){return sr.isPlainObject(t)||sr.isArray(t)}function vz(t){return sr.endsWith(t,"[]")?t.slice(0,-2):t}function lM(t,e,r){return t?t.concat(e).map(function(h,p){return h=vz(h),!r&&p?"["+h+"]":h}).join(r?".":""):e}function uY(t){return sr.isArray(t)&&!t.some(fT)}const hY=sr.toFlatObject(sr,{},null,function(e){return/^is[A-Z]/.test(e)});function Xb(t,e,r){if(!sr.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=sr.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ge,ye){return!sr.isUndefined(ye[ge])});const s=r.metaTokens,h=r.visitor||z,p=r.dots,b=r.indexes,o=(r.Blob||typeof Blob<"u"&&Blob)&&sr.isSpecCompliantForm(e);if(!sr.isFunction(h))throw new TypeError("visitor must be a function");function O(Q){if(Q===null)return"";if(sr.isDate(Q))return Q.toISOString();if(!o&&sr.isBlob(Q))throw new si("Blob is not supported. Use a Buffer instead.");return sr.isArrayBuffer(Q)||sr.isTypedArray(Q)?o&&typeof Blob=="function"?new Blob([Q]):Buffer.from(Q):Q}function z(Q,ge,ye){let ke=Q;if(Q&&!ye&&typeof Q=="object"){if(sr.endsWith(ge,"{}"))ge=s?ge:ge.slice(0,-2),Q=JSON.stringify(Q);else if(sr.isArray(Q)&&uY(Q)||(sr.isFileList(Q)||sr.endsWith(ge,"[]"))&&(ke=sr.toArray(Q)))return ge=vz(ge),ke.forEach(function(oe,ve){!(sr.isUndefined(oe)||oe===null)&&e.append(b===!0?lM([ge],ve,p):b===null?ge:ge+"[]",O(oe))}),!1}return fT(Q)?!0:(e.append(lM(ye,ge,p),O(Q)),!1)}const U=[],H=Object.assign(hY,{defaultVisitor:z,convertValue:O,isVisitable:fT});function Y(Q,ge){if(!sr.isUndefined(Q)){if(U.indexOf(Q)!==-1)throw Error("Circular reference detected in "+ge.join("."));U.push(Q),sr.forEach(Q,function(ke,he){(!(sr.isUndefined(ke)||ke===null)&&h.call(e,ke,sr.isString(he)?he.trim():he,ge,H))===!0&&Y(ke,ge?ge.concat(he):[he])}),U.pop()}}if(!sr.isObject(t))throw new TypeError("data must be an object");return Y(t),e}function cM(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function eS(t,e){this._pairs=[],t&&Xb(t,this,e)}const bz=eS.prototype;bz.append=function(e,r){this._pairs.push([e,r])};bz.toString=function(e){const r=e?function(s){return e.call(this,s,cM)}:cM;return this._pairs.map(function(h){return r(h[0])+"="+r(h[1])},"").join("&")};function dY(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function xz(t,e,r){if(!e)return t;const s=r&&r.encode||dY,h=r&&r.serialize;let p;if(h?p=h(e,r):p=sr.isURLSearchParams(e)?e.toString():new eS(e,r).toString(s),p){const b=t.indexOf("#");b!==-1&&(t=t.slice(0,b)),t+=(t.indexOf("?")===-1?"?":"&")+p}return t}class uM{constructor(){this.handlers=[]}use(e,r,s){return this.handlers.push({fulfilled:e,rejected:r,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){sr.forEach(this.handlers,function(s){s!==null&&e(s)})}}const wz={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fY=typeof URLSearchParams<"u"?URLSearchParams:eS,pY=typeof FormData<"u"?FormData:null,mY=typeof Blob<"u"?Blob:null,gY={isBrowser:!0,classes:{URLSearchParams:fY,FormData:pY,Blob:mY},protocols:["http","https","file","blob","url","data"]},tS=typeof window<"u"&&typeof document<"u",pT=typeof navigator=="object"&&navigator||void 0,_Y=tS&&(!pT||["ReactNative","NativeScript","NS"].indexOf(pT.product)<0),yY=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",vY=tS&&window.location.href||"http://localhost",bY=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:tS,hasStandardBrowserEnv:_Y,hasStandardBrowserWebWorkerEnv:yY,navigator:pT,origin:vY},Symbol.toStringTag,{value:"Module"})),El={...bY,...gY};function xY(t,e){return Xb(t,new El.classes.URLSearchParams,Object.assign({visitor:function(r,s,h,p){return El.isNode&&sr.isBuffer(r)?(this.append(s,r.toString("base64")),!1):p.defaultVisitor.apply(this,arguments)}},e))}function wY(t){return sr.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function TY(t){const e={},r=Object.keys(t);let s;const h=r.length;let p;for(s=0;s<h;s++)p=r[s],e[p]=t[p];return e}function Tz(t){function e(r,s,h,p){let b=r[p++];if(b==="__proto__")return!0;const E=Number.isFinite(+b),o=p>=r.length;return b=!b&&sr.isArray(h)?h.length:b,o?(sr.hasOwnProp(h,b)?h[b]=[h[b],s]:h[b]=s,!E):((!h[b]||!sr.isObject(h[b]))&&(h[b]=[]),e(r,s,h[b],p)&&sr.isArray(h[b])&&(h[b]=TY(h[b])),!E)}if(sr.isFormData(t)&&sr.isFunction(t.entries)){const r={};return sr.forEachEntry(t,(s,h)=>{e(wY(s),h,r,0)}),r}return null}function EY(t,e,r){if(sr.isString(t))try{return(e||JSON.parse)(t),sr.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(0,JSON.stringify)(t)}const Vy={transitional:wz,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const s=r.getContentType()||"",h=s.indexOf("application/json")>-1,p=sr.isObject(e);if(p&&sr.isHTMLForm(e)&&(e=new FormData(e)),sr.isFormData(e))return h?JSON.stringify(Tz(e)):e;if(sr.isArrayBuffer(e)||sr.isBuffer(e)||sr.isStream(e)||sr.isFile(e)||sr.isBlob(e)||sr.isReadableStream(e))return e;if(sr.isArrayBufferView(e))return e.buffer;if(sr.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let E;if(p){if(s.indexOf("application/x-www-form-urlencoded")>-1)return xY(e,this.formSerializer).toString();if((E=sr.isFileList(e))||s.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return Xb(E?{"files[]":e}:e,o&&new o,this.formSerializer)}}return p||h?(r.setContentType("application/json",!1),EY(e)):e}],transformResponse:[function(e){const r=this.transitional||Vy.transitional,s=r&&r.forcedJSONParsing,h=this.responseType==="json";if(sr.isResponse(e)||sr.isReadableStream(e))return e;if(e&&sr.isString(e)&&(s&&!this.responseType||h)){const b=!(r&&r.silentJSONParsing)&&h;try{return JSON.parse(e)}catch(E){if(b)throw E.name==="SyntaxError"?si.from(E,si.ERR_BAD_RESPONSE,this,null,this.response):E}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:El.classes.FormData,Blob:El.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};sr.forEach(["delete","get","head","post","put","patch"],t=>{Vy.headers[t]={}});const SY=sr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),IY=t=>{const e={};let r,s,h;return t&&t.split(`
`).forEach(function(b){h=b.indexOf(":"),r=b.substring(0,h).trim().toLowerCase(),s=b.substring(h+1).trim(),!(!r||e[r]&&SY[r])&&(r==="set-cookie"?e[r]?e[r].push(s):e[r]=[s]:e[r]=e[r]?e[r]+", "+s:s)}),e},hM=Symbol("internals");function __(t){return t&&String(t).trim().toLowerCase()}function E0(t){return t===!1||t==null?t:sr.isArray(t)?t.map(E0):String(t)}function AY(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=r.exec(t);)e[s[1]]=s[2];return e}const CY=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ow(t,e,r,s,h){if(sr.isFunction(s))return s.call(this,e,r);if(h&&(e=r),!!sr.isString(e)){if(sr.isString(s))return e.indexOf(s)!==-1;if(sr.isRegExp(s))return s.test(e)}}function RY(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,s)=>r.toUpperCase()+s)}function PY(t,e){const r=sr.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+r,{value:function(h,p,b){return this[s].call(this,e,h,p,b)},configurable:!0})})}class Sl{constructor(e){e&&this.set(e)}set(e,r,s){const h=this;function p(E,o,O){const z=__(o);if(!z)throw new Error("header name must be a non-empty string");const U=sr.findKey(h,z);(!U||h[U]===void 0||O===!0||O===void 0&&h[U]!==!1)&&(h[U||o]=E0(E))}const b=(E,o)=>sr.forEach(E,(O,z)=>p(O,z,o));if(sr.isPlainObject(e)||e instanceof this.constructor)b(e,r);else if(sr.isString(e)&&(e=e.trim())&&!CY(e))b(IY(e),r);else if(sr.isHeaders(e))for(const[E,o]of e.entries())p(o,E,s);else e!=null&&p(r,e,s);return this}get(e,r){if(e=__(e),e){const s=sr.findKey(this,e);if(s){const h=this[s];if(!r)return h;if(r===!0)return AY(h);if(sr.isFunction(r))return r.call(this,h,s);if(sr.isRegExp(r))return r.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=__(e),e){const s=sr.findKey(this,e);return!!(s&&this[s]!==void 0&&(!r||ow(this,this[s],s,r)))}return!1}delete(e,r){const s=this;let h=!1;function p(b){if(b=__(b),b){const E=sr.findKey(s,b);E&&(!r||ow(s,s[E],E,r))&&(delete s[E],h=!0)}}return sr.isArray(e)?e.forEach(p):p(e),h}clear(e){const r=Object.keys(this);let s=r.length,h=!1;for(;s--;){const p=r[s];(!e||ow(this,this[p],p,e,!0))&&(delete this[p],h=!0)}return h}normalize(e){const r=this,s={};return sr.forEach(this,(h,p)=>{const b=sr.findKey(s,p);if(b){r[b]=E0(h),delete r[p];return}const E=e?RY(p):String(p).trim();E!==p&&delete r[p],r[E]=E0(h),s[E]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return sr.forEach(this,(s,h)=>{s!=null&&s!==!1&&(r[h]=e&&sr.isArray(s)?s.join(", "):s)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const s=new this(e);return r.forEach(h=>s.set(h)),s}static accessor(e){const s=(this[hM]=this[hM]={accessors:{}}).accessors,h=this.prototype;function p(b){const E=__(b);s[E]||(PY(h,b),s[E]=!0)}return sr.isArray(e)?e.forEach(p):p(e),this}}Sl.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);sr.reduceDescriptors(Sl.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[r]=s}}});sr.freezeMethods(Sl);function sw(t,e){const r=this||Vy,s=e||r,h=Sl.from(s.headers);let p=s.data;return sr.forEach(t,function(E){p=E.call(r,p,h.normalize(),e?e.status:void 0)}),h.normalize(),p}function Ez(t){return!!(t&&t.__CANCEL__)}function cg(t,e,r){si.call(this,t??"canceled",si.ERR_CANCELED,e,r),this.name="CanceledError"}sr.inherits(cg,si,{__CANCEL__:!0});function Sz(t,e,r){const s=r.config.validateStatus;!r.status||!s||s(r.status)?t(r):e(new si("Request failed with status code "+r.status,[si.ERR_BAD_REQUEST,si.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function MY(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function kY(t,e){t=t||10;const r=new Array(t),s=new Array(t);let h=0,p=0,b;return e=e!==void 0?e:1e3,function(o){const O=Date.now(),z=s[p];b||(b=O),r[h]=o,s[h]=O;let U=p,H=0;for(;U!==h;)H+=r[U++],U=U%t;if(h=(h+1)%t,h===p&&(p=(p+1)%t),O-b<e)return;const Y=z&&O-z;return Y?Math.round(H*1e3/Y):void 0}}function OY(t,e){let r=0,s=1e3/e,h,p;const b=(O,z=Date.now())=>{r=z,h=null,p&&(clearTimeout(p),p=null),t.apply(null,O)};return[(...O)=>{const z=Date.now(),U=z-r;U>=s?b(O,z):(h=O,p||(p=setTimeout(()=>{p=null,b(h)},s-U)))},()=>h&&b(h)]}const ab=(t,e,r=3)=>{let s=0;const h=kY(50,250);return OY(p=>{const b=p.loaded,E=p.lengthComputable?p.total:void 0,o=b-s,O=h(o),z=b<=E;s=b;const U={loaded:b,total:E,progress:E?b/E:void 0,bytes:o,rate:O||void 0,estimated:O&&E&&z?(E-b)/O:void 0,event:p,lengthComputable:E!=null,[e?"download":"upload"]:!0};t(U)},r)},dM=(t,e)=>{const r=t!=null;return[s=>e[0]({lengthComputable:r,total:t,loaded:s}),e[1]]},fM=t=>(...e)=>sr.asap(()=>t(...e)),DY=El.hasStandardBrowserEnv?function(){const e=El.navigator&&/(msie|trident)/i.test(El.navigator.userAgent),r=document.createElement("a");let s;function h(p){let b=p;return e&&(r.setAttribute("href",b),b=r.href),r.setAttribute("href",b),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return s=h(window.location.href),function(b){const E=sr.isString(b)?h(b):b;return E.protocol===s.protocol&&E.host===s.host}}():function(){return function(){return!0}}(),LY=El.hasStandardBrowserEnv?{write(t,e,r,s,h,p){const b=[t+"="+encodeURIComponent(e)];sr.isNumber(r)&&b.push("expires="+new Date(r).toGMTString()),sr.isString(s)&&b.push("path="+s),sr.isString(h)&&b.push("domain="+h),p===!0&&b.push("secure"),document.cookie=b.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function BY(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function zY(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Iz(t,e){return t&&!BY(e)?zY(t,e):e}const pM=t=>t instanceof Sl?{...t}:t;function sp(t,e){e=e||{};const r={};function s(O,z,U){return sr.isPlainObject(O)&&sr.isPlainObject(z)?sr.merge.call({caseless:U},O,z):sr.isPlainObject(z)?sr.merge({},z):sr.isArray(z)?z.slice():z}function h(O,z,U){if(sr.isUndefined(z)){if(!sr.isUndefined(O))return s(void 0,O,U)}else return s(O,z,U)}function p(O,z){if(!sr.isUndefined(z))return s(void 0,z)}function b(O,z){if(sr.isUndefined(z)){if(!sr.isUndefined(O))return s(void 0,O)}else return s(void 0,z)}function E(O,z,U){if(U in e)return s(O,z);if(U in t)return s(void 0,O)}const o={url:p,method:p,data:p,baseURL:b,transformRequest:b,transformResponse:b,paramsSerializer:b,timeout:b,timeoutMessage:b,withCredentials:b,withXSRFToken:b,adapter:b,responseType:b,xsrfCookieName:b,xsrfHeaderName:b,onUploadProgress:b,onDownloadProgress:b,decompress:b,maxContentLength:b,maxBodyLength:b,beforeRedirect:b,transport:b,httpAgent:b,httpsAgent:b,cancelToken:b,socketPath:b,responseEncoding:b,validateStatus:E,headers:(O,z)=>h(pM(O),pM(z),!0)};return sr.forEach(Object.keys(Object.assign({},t,e)),function(z){const U=o[z]||h,H=U(t[z],e[z],z);sr.isUndefined(H)&&U!==E||(r[z]=H)}),r}const Az=t=>{const e=sp({},t);let{data:r,withXSRFToken:s,xsrfHeaderName:h,xsrfCookieName:p,headers:b,auth:E}=e;e.headers=b=Sl.from(b),e.url=xz(Iz(e.baseURL,e.url),t.params,t.paramsSerializer),E&&b.set("Authorization","Basic "+btoa((E.username||"")+":"+(E.password?unescape(encodeURIComponent(E.password)):"")));let o;if(sr.isFormData(r)){if(El.hasStandardBrowserEnv||El.hasStandardBrowserWebWorkerEnv)b.setContentType(void 0);else if((o=b.getContentType())!==!1){const[O,...z]=o?o.split(";").map(U=>U.trim()).filter(Boolean):[];b.setContentType([O||"multipart/form-data",...z].join("; "))}}if(El.hasStandardBrowserEnv&&(s&&sr.isFunction(s)&&(s=s(e)),s||s!==!1&&DY(e.url))){const O=h&&p&&LY.read(p);O&&b.set(h,O)}return e},NY=typeof XMLHttpRequest<"u",FY=NY&&function(t){return new Promise(function(r,s){const h=Az(t);let p=h.data;const b=Sl.from(h.headers).normalize();let{responseType:E,onUploadProgress:o,onDownloadProgress:O}=h,z,U,H,Y,Q;function ge(){Y&&Y(),Q&&Q(),h.cancelToken&&h.cancelToken.unsubscribe(z),h.signal&&h.signal.removeEventListener("abort",z)}let ye=new XMLHttpRequest;ye.open(h.method.toUpperCase(),h.url,!0),ye.timeout=h.timeout;function ke(){if(!ye)return;const oe=Sl.from("getAllResponseHeaders"in ye&&ye.getAllResponseHeaders()),be={data:!E||E==="text"||E==="json"?ye.responseText:ye.response,status:ye.status,statusText:ye.statusText,headers:oe,config:t,request:ye};Sz(function(Te){r(Te),ge()},function(Te){s(Te),ge()},be),ye=null}"onloadend"in ye?ye.onloadend=ke:ye.onreadystatechange=function(){!ye||ye.readyState!==4||ye.status===0&&!(ye.responseURL&&ye.responseURL.indexOf("file:")===0)||setTimeout(ke)},ye.onabort=function(){ye&&(s(new si("Request aborted",si.ECONNABORTED,t,ye)),ye=null)},ye.onerror=function(){s(new si("Network Error",si.ERR_NETWORK,t,ye)),ye=null},ye.ontimeout=function(){let ve=h.timeout?"timeout of "+h.timeout+"ms exceeded":"timeout exceeded";const be=h.transitional||wz;h.timeoutErrorMessage&&(ve=h.timeoutErrorMessage),s(new si(ve,be.clarifyTimeoutError?si.ETIMEDOUT:si.ECONNABORTED,t,ye)),ye=null},p===void 0&&b.setContentType(null),"setRequestHeader"in ye&&sr.forEach(b.toJSON(),function(ve,be){ye.setRequestHeader(be,ve)}),sr.isUndefined(h.withCredentials)||(ye.withCredentials=!!h.withCredentials),E&&E!=="json"&&(ye.responseType=h.responseType),O&&([H,Q]=ab(O,!0),ye.addEventListener("progress",H)),o&&ye.upload&&([U,Y]=ab(o),ye.upload.addEventListener("progress",U),ye.upload.addEventListener("loadend",Y)),(h.cancelToken||h.signal)&&(z=oe=>{ye&&(s(!oe||oe.type?new cg(null,t,ye):oe),ye.abort(),ye=null)},h.cancelToken&&h.cancelToken.subscribe(z),h.signal&&(h.signal.aborted?z():h.signal.addEventListener("abort",z)));const he=MY(h.url);if(he&&El.protocols.indexOf(he)===-1){s(new si("Unsupported protocol "+he+":",si.ERR_BAD_REQUEST,t));return}ye.send(p||null)})},VY=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let s=new AbortController,h;const p=function(O){if(!h){h=!0,E();const z=O instanceof Error?O:this.reason;s.abort(z instanceof si?z:new cg(z instanceof Error?z.message:z))}};let b=e&&setTimeout(()=>{b=null,p(new si(`timeout ${e} of ms exceeded`,si.ETIMEDOUT))},e);const E=()=>{t&&(b&&clearTimeout(b),b=null,t.forEach(O=>{O.unsubscribe?O.unsubscribe(p):O.removeEventListener("abort",p)}),t=null)};t.forEach(O=>O.addEventListener("abort",p));const{signal:o}=s;return o.unsubscribe=()=>sr.asap(E),o}},UY=function*(t,e){let r=t.byteLength;if(r<e){yield t;return}let s=0,h;for(;s<r;)h=s+e,yield t.slice(s,h),s=h},jY=async function*(t,e){for await(const r of $Y(t))yield*UY(r,e)},$Y=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:r,value:s}=await e.read();if(r)break;yield s}}finally{await e.cancel()}},mM=(t,e,r,s)=>{const h=jY(t,e);let p=0,b,E=o=>{b||(b=!0,s&&s(o))};return new ReadableStream({async pull(o){try{const{done:O,value:z}=await h.next();if(O){E(),o.close();return}let U=z.byteLength;if(r){let H=p+=U;r(H)}o.enqueue(new Uint8Array(z))}catch(O){throw E(O),O}},cancel(o){return E(o),h.return()}},{highWaterMark:2})},Yb=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Cz=Yb&&typeof ReadableStream=="function",GY=Yb&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Rz=(t,...e)=>{try{return!!t(...e)}catch{return!1}},qY=Cz&&Rz(()=>{let t=!1;const e=new Request(El.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),gM=64*1024,mT=Cz&&Rz(()=>sr.isReadableStream(new Response("").body)),lb={stream:mT&&(t=>t.body)};Yb&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!lb[e]&&(lb[e]=sr.isFunction(t[e])?r=>r[e]():(r,s)=>{throw new si(`Response type '${e}' is not supported`,si.ERR_NOT_SUPPORT,s)})})})(new Response);const HY=async t=>{if(t==null)return 0;if(sr.isBlob(t))return t.size;if(sr.isSpecCompliantForm(t))return(await new Request(El.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(sr.isArrayBufferView(t)||sr.isArrayBuffer(t))return t.byteLength;if(sr.isURLSearchParams(t)&&(t=t+""),sr.isString(t))return(await GY(t)).byteLength},WY=async(t,e)=>{const r=sr.toFiniteNumber(t.getContentLength());return r??HY(e)},ZY=Yb&&(async t=>{let{url:e,method:r,data:s,signal:h,cancelToken:p,timeout:b,onDownloadProgress:E,onUploadProgress:o,responseType:O,headers:z,withCredentials:U="same-origin",fetchOptions:H}=Az(t);O=O?(O+"").toLowerCase():"text";let Y=VY([h,p&&p.toAbortSignal()],b),Q;const ge=Y&&Y.unsubscribe&&(()=>{Y.unsubscribe()});let ye;try{if(o&&qY&&r!=="get"&&r!=="head"&&(ye=await WY(z,s))!==0){let be=new Request(e,{method:"POST",body:s,duplex:"half"}),ze;if(sr.isFormData(s)&&(ze=be.headers.get("content-type"))&&z.setContentType(ze),be.body){const[Te,ie]=dM(ye,ab(fM(o)));s=mM(be.body,gM,Te,ie)}}sr.isString(U)||(U=U?"include":"omit");const ke="credentials"in Request.prototype;Q=new Request(e,{...H,signal:Y,method:r.toUpperCase(),headers:z.normalize().toJSON(),body:s,duplex:"half",credentials:ke?U:void 0});let he=await fetch(Q);const oe=mT&&(O==="stream"||O==="response");if(mT&&(E||oe&&ge)){const be={};["status","statusText","headers"].forEach(ne=>{be[ne]=he[ne]});const ze=sr.toFiniteNumber(he.headers.get("content-length")),[Te,ie]=E&&dM(ze,ab(fM(E),!0))||[];he=new Response(mM(he.body,gM,Te,()=>{ie&&ie(),ge&&ge()}),be)}O=O||"text";let ve=await lb[sr.findKey(lb,O)||"text"](he,t);return!oe&&ge&&ge(),await new Promise((be,ze)=>{Sz(be,ze,{data:ve,headers:Sl.from(he.headers),status:he.status,statusText:he.statusText,config:t,request:Q})})}catch(ke){throw ge&&ge(),ke&&ke.name==="TypeError"&&/fetch/i.test(ke.message)?Object.assign(new si("Network Error",si.ERR_NETWORK,t,Q),{cause:ke.cause||ke}):si.from(ke,ke&&ke.code,t,Q)}}),gT={http:cY,xhr:FY,fetch:ZY};sr.forEach(gT,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const _M=t=>`- ${t}`,KY=t=>sr.isFunction(t)||t===null||t===!1,Pz={getAdapter:t=>{t=sr.isArray(t)?t:[t];const{length:e}=t;let r,s;const h={};for(let p=0;p<e;p++){r=t[p];let b;if(s=r,!KY(r)&&(s=gT[(b=String(r)).toLowerCase()],s===void 0))throw new si(`Unknown adapter '${b}'`);if(s)break;h[b||"#"+p]=s}if(!s){const p=Object.entries(h).map(([E,o])=>`adapter ${E} `+(o===!1?"is not supported by the environment":"is not available in the build"));let b=e?p.length>1?`since :
`+p.map(_M).join(`
`):" "+_M(p[0]):"as no adapter specified";throw new si("There is no suitable adapter to dispatch the request "+b,"ERR_NOT_SUPPORT")}return s},adapters:gT};function aw(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new cg(null,t)}function yM(t){return aw(t),t.headers=Sl.from(t.headers),t.data=sw.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Pz.getAdapter(t.adapter||Vy.adapter)(t).then(function(s){return aw(t),s.data=sw.call(t,t.transformResponse,s),s.headers=Sl.from(s.headers),s},function(s){return Ez(s)||(aw(t),s&&s.response&&(s.response.data=sw.call(t,t.transformResponse,s.response),s.response.headers=Sl.from(s.response.headers))),Promise.reject(s)})}const Mz="1.7.7",rS={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{rS[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const vM={};rS.transitional=function(e,r,s){function h(p,b){return"[Axios v"+Mz+"] Transitional option '"+p+"'"+b+(s?". "+s:"")}return(p,b,E)=>{if(e===!1)throw new si(h(b," has been removed"+(r?" in "+r:"")),si.ERR_DEPRECATED);return r&&!vM[b]&&(vM[b]=!0,console.warn(h(b," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(p,b,E):!0}};function XY(t,e,r){if(typeof t!="object")throw new si("options must be an object",si.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let h=s.length;for(;h-- >0;){const p=s[h],b=e[p];if(b){const E=t[p],o=E===void 0||b(E,p,t);if(o!==!0)throw new si("option "+p+" must be "+o,si.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new si("Unknown option "+p,si.ERR_BAD_OPTION)}}const _T={assertOptions:XY,validators:rS},fd=_T.validators;class Kf{constructor(e){this.defaults=e,this.interceptors={request:new uM,response:new uM}}async request(e,r){try{return await this._request(e,r)}catch(s){if(s instanceof Error){let h;Error.captureStackTrace?Error.captureStackTrace(h={}):h=new Error;const p=h.stack?h.stack.replace(/^.+\n/,""):"";try{s.stack?p&&!String(s.stack).endsWith(p.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+p):s.stack=p}catch{}}throw s}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=sp(this.defaults,r);const{transitional:s,paramsSerializer:h,headers:p}=r;s!==void 0&&_T.assertOptions(s,{silentJSONParsing:fd.transitional(fd.boolean),forcedJSONParsing:fd.transitional(fd.boolean),clarifyTimeoutError:fd.transitional(fd.boolean)},!1),h!=null&&(sr.isFunction(h)?r.paramsSerializer={serialize:h}:_T.assertOptions(h,{encode:fd.function,serialize:fd.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let b=p&&sr.merge(p.common,p[r.method]);p&&sr.forEach(["delete","get","head","post","put","patch","common"],Q=>{delete p[Q]}),r.headers=Sl.concat(b,p);const E=[];let o=!0;this.interceptors.request.forEach(function(ge){typeof ge.runWhen=="function"&&ge.runWhen(r)===!1||(o=o&&ge.synchronous,E.unshift(ge.fulfilled,ge.rejected))});const O=[];this.interceptors.response.forEach(function(ge){O.push(ge.fulfilled,ge.rejected)});let z,U=0,H;if(!o){const Q=[yM.bind(this),void 0];for(Q.unshift.apply(Q,E),Q.push.apply(Q,O),H=Q.length,z=Promise.resolve(r);U<H;)z=z.then(Q[U++],Q[U++]);return z}H=E.length;let Y=r;for(U=0;U<H;){const Q=E[U++],ge=E[U++];try{Y=Q(Y)}catch(ye){ge.call(this,ye);break}}try{z=yM.call(this,Y)}catch(Q){return Promise.reject(Q)}for(U=0,H=O.length;U<H;)z=z.then(O[U++],O[U++]);return z}getUri(e){e=sp(this.defaults,e);const r=Iz(e.baseURL,e.url);return xz(r,e.params,e.paramsSerializer)}}sr.forEach(["delete","get","head","options"],function(e){Kf.prototype[e]=function(r,s){return this.request(sp(s||{},{method:e,url:r,data:(s||{}).data}))}});sr.forEach(["post","put","patch"],function(e){function r(s){return function(p,b,E){return this.request(sp(E||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:p,data:b}))}}Kf.prototype[e]=r(),Kf.prototype[e+"Form"]=r(!0)});class nS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(p){r=p});const s=this;this.promise.then(h=>{if(!s._listeners)return;let p=s._listeners.length;for(;p-- >0;)s._listeners[p](h);s._listeners=null}),this.promise.then=h=>{let p;const b=new Promise(E=>{s.subscribe(E),p=E}).then(h);return b.cancel=function(){s.unsubscribe(p)},b},e(function(p,b,E){s.reason||(s.reason=new cg(p,b,E),r(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=s=>{e.abort(s)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new nS(function(h){e=h}),cancel:e}}}function YY(t){return function(r){return t.apply(null,r)}}function JY(t){return sr.isObject(t)&&t.isAxiosError===!0}const yT={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yT).forEach(([t,e])=>{yT[e]=t});function kz(t){const e=new Kf(t),r=cz(Kf.prototype.request,e);return sr.extend(r,Kf.prototype,e,{allOwnKeys:!0}),sr.extend(r,e,null,{allOwnKeys:!0}),r.create=function(h){return kz(sp(t,h))},r}const gs=kz(Vy);gs.Axios=Kf;gs.CanceledError=cg;gs.CancelToken=nS;gs.isCancel=Ez;gs.VERSION=Mz;gs.toFormData=Xb;gs.AxiosError=si;gs.Cancel=gs.CanceledError;gs.all=function(e){return Promise.all(e)};gs.spread=YY;gs.isAxiosError=JY;gs.mergeConfig=sp;gs.AxiosHeaders=Sl;gs.formToJSON=t=>Tz(sr.isHTMLForm(t)?new FormData(t):t);gs.getAdapter=Pz.getAdapter;gs.HttpStatusCode=yT;gs.default=gs;const QY={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},eJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 268l144 144l144-144"},null,-1),tJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 392V100"},null,-1),rJ=[eJ,tJ],Oz=Wd({name:"ArrowDownOutline",render:function(e,r){return sn(),Sn("svg",QY,rJ)}}),nJ={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},iJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 244l144-144l144 144"},null,-1),oJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M256 120v292"},null,-1),sJ=[iJ,oJ],Dz=Wd({name:"ArrowUpOutline",render:function(e,r){return sn(),Sn("svg",nJ,sJ)}}),aJ={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},lJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M464 208L352 96L240 208"},null,-1),cJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M352 113.13V416"},null,-1),uJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M48 304l112 112l112-112"},null,-1),hJ=ct("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M160 398V96"},null,-1),dJ=[lJ,cJ,uJ,hJ],Lz=Wd({name:"SwapVerticalOutline",render:function(e,r){return sn(),Sn("svg",aJ,dJ)}}),pp=t=>(xu("data-v-51448dc4"),t=t(),wu(),t),fJ={class:"coach-container"},pJ={class:"coach-info"},mJ={key:0},gJ=["onClick"],_J={key:1},yJ=["onClick"],vJ={key:0,class:"overlay"},bJ={class:"rating-section"},xJ=pp(()=>ct("label",{for:"rating"},"Your Rating:",-1)),wJ={class:"comment-section"},TJ=pp(()=>ct("label",{for:"comment"},"Your Comment:",-1)),EJ={class:"char-count"},SJ={class:"button-group"},IJ=["disabled"],AJ={key:1,class:"overlay"},CJ=pp(()=>ct("option",{value:"",disabled:""},"Please select available time",-1)),RJ=["value","disabled"],PJ=pp(()=>ct("button",{type:"submit",class:"primary-button"},"Submit Booking",-1)),MJ=pp(()=>ct("h3",null,"Booking Successful!",-1)),kJ={key:3,class:"overlay"},OJ={class:"modal-content reviews-modal"},DJ={class:"search-section"},LJ={class:"reviews-table"},BJ=pp(()=>ct("th",null,"User",-1)),zJ=pp(()=>ct("th",null,"Comment",-1)),NJ={class:"pagination"},FJ=["disabled"],VJ=["disabled"],lw=10,UJ={__name:"CoachView",setup(t){const{isAuthenticated:e,currentUserUid:r}=sg(),s=Dd([]),h=Qr(!1),p=Qr({}),b=Qr(0),E=Qr([]),o=Qr(""),O=Qr({key:"",order:"asc"}),z=Qr(""),U=Ds(()=>b.value>0),H=Qr(!1),Y=Qr(!1),Q=Qr(!1),ge=Qr(!1),ye=Qr(1),ke=Dd({name:"",email:"",phone:"",appointmentDate:"",notes:""}),he=Qr([]),oe=Qr([]),ve=Qr(!1),be=Qr("");ll(e,(Se,Kt)=>{Kt&&!Se&&Fr()});const ze=()=>{Y.value=!1},Te=()=>{ve.value=!1},ie=Se=>{if(!e.value){alert("Please log in to book an appointment.");return}p.value=Se,H.value=!0},ne=()=>{H.value=!1,Object.keys(ke).forEach(Se=>ke[Se]="")},te=()=>{const Fe=[];for(let $e=9;$e<17;$e++){const We=`${$e.toString().padStart(2,"0")}:00`,zt=`${($e+1).toString().padStart(2,"0")}:00`;Fe.push(`${We}-${zt}`)}return Fe},re=Se=>oe.value.includes(Se),me=async()=>{if(console.log("Selected date:",ke.appointmentDate),ke.appointmentDate){const Se=await uu.getAppointmentsTimeSlotByDate(p.value.id,ke.appointmentDate);oe.value=Se,he.value=te().filter(Kt=>!Se.includes(Kt))}},we=async()=>{try{Q.value=!0;const Se=r.value,Kt={coachId:p.value.id,coachName:p.value.name,userName:ke.name,userId:Se,email:ke.email,phone:ke.phone,appointmentDate:ke.appointmentDate,timeSlot:ke.timeSlot,notes:ke.notes},Fe=await uu.addAppointment(Kt);be.value=Fe,console.log("Appointment created with ID:",Fe),console.log("Appointment data:",Kt),await tt(Fe,Kt),Q.value=!1,ne(),ve.value=!0}catch(Se){Q.value=!1,console.error("Failed to submit booking:",Se),alert("Failed to submit booking. Please try again.")}},tt=async(Se,Kt)=>{try{console.log("================testing-start==========================="),console.log("Starting post-booking tasks for appointment:",Se),console.log("Appointment data:",Kt),console.log("================testing-end===========================");const Fe=await gs.post("https://generatepdf-t5kfcvh67q-uc.a.run.app",Kt);console.log("=================testing-start=========================="),console.log("PDF generation response:",Fe.data),console.log("=================testing-end==========================");const $e=Fe.data.pdfBase64;await uu.savePdfToFirestore(Se,$e),console.log("PDF saved to Firestore successfully");const We=await gs.post("https://sendconfirmationemail-t5kfcvh67q-uc.a.run.app",{email:Kt.email,name:Kt.userName,coachName:Kt.coachName,appointmentDate:Kt.appointmentDate,timeSlot:Kt.timeSlot,notes:Kt.notes,pdfBase64:$e});console.log("================testing-start==========================="),console.log("Email response:",We.data),console.log("================testing-end==========================="),console.log("Confirmation email sent successfully"),console.log("Post-booking tasks completed successfully")}catch(Fe){console.error("Error in post-booking tasks:",Fe),Fe.response&&Fe.response.status===500?alert("Your booking was successful, but we couldn't send a confirmation email. Please check your booking details in your account."):alert("Your booking was successful, but we encountered an issue with some additional processes. Your booking is confirmed, and you can view the details in your account.")}},Et=async()=>{try{console.log("================testing-start==========================="),console.log("Attempting to download appointment letter for ID:",be.value),console.log("================testing-end===========================");const Se=await uu.getConfirmationLetterPdf(be.value);if(Se){console.log("================testing-start==========================="),console.log("PDF data retrieved successfully"),console.log("pdfBase64:",Se),console.log("================testing-end===========================");const Kt=atob(Se),Fe=new Array(Kt.length);for(let $t=0;$t<Kt.length;$t++)Fe[$t]=Kt.charCodeAt($t);const $e=new Uint8Array(Fe),We=new Blob([$e],{type:"application/pdf"}),zt=document.createElement("a");zt.href=window.URL.createObjectURL(We),zt.download="appointment_confirmation.pdf",zt.click(),window.URL.revokeObjectURL(zt.href),console.log("================testing-start==========================="),console.log("PDF download initiated"),console.log("================testing-end===========================")}else throw new Error("PDF not found")}catch(Se){console.error("Error downloading appointment letter:",Se),alert("Failed to download appointment letter. Please try again.")}},ft=Se=>{if(!e.value){alert("Please log in to rate the coach.");return}rr(Se)},rr=Se=>{p.value=Se,h.value=!0},or=()=>{h.value=!1,b.value=0},Fr=async()=>{try{const Se=await uu.getAllCoaches();s.length=0,Se.forEach(Kt=>{let Fe=!1,$e=0,We=0,zt=0;Object.entries(Kt.allRatings).forEach(([_r,Wt])=>{We+=Wt.rating,zt++,e.value&&_r===r.value&&(Fe=!0,$e=Wt.rating)});const $t=zt>0?We/zt:0;s.push({...Kt,userHasRated:Fe,userRating:$e,averageRating:$t,totalRatings:zt})}),console.log("Fetched coaches:",s)}catch(Se){console.error("Error fetching coaches from Firestore:",Se)}},gt=async()=>{if(b.value>0){ge.value=!0;const Se=p.value,Kt=r.value;try{await uu.updateCoachRating(Se.id,Kt,b.value,z.value),Se.allRatings[Kt]={rating:b.value,comment:z.value,timestamp:new Date};let Fe=0,$e=0;Object.values(Se.allRatings).forEach(We=>{Fe+=We.rating,$e++}),Se.averageRating=Fe/$e,Se.totalRatings=$e,Se.userHasRated=!0,Se.userRating=b.value,console.log(`Submitted rating: ${b.value} for ${Se.name}`),or()}catch(Fe){console.error("Failed to update rating in Firestore:",Fe),alert("Failed to submit rating. Please try again.")}finally{ge.value=!1}}else alert("Please select a rating before submitting.")},jr=Ds(()=>{let Se=E.value;if(o.value){const Kt=o.value.toLowerCase();Se=Se.filter(Fe=>Fe.comment.toLowerCase().includes(Kt))}return O.value.key&&(Se=[...Se].sort((Kt,Fe)=>{let $e=Kt[O.value.key],We=Fe[O.value.key];return O.value.key==="timestamp"&&($e=new Date($e),We=new Date(We)),$e<We?O.value.order==="asc"?-1:1:$e>We?O.value.order==="asc"?1:-1:0})),Se}),Ur=Se=>{O.value.key===Se?O.value.order=O.value.order==="asc"?"desc":"asc":(O.value.key=Se,O.value.order="asc")},Xr=async Se=>{p.value=Se,Y.value=!0;try{E.value=await uu.getCoachReviews(Se.id)}catch(Kt){console.error("Failed to fetch reviews:",Kt),alert("Failed to load reviews. Please try again.")}},pr=Ds(()=>{const Se=(ye.value-1)*lw,Kt=Se+lw;return jr.value.slice(Se,Kt)}),Dt=Ds(()=>Math.ceil(jr.value.length/lw)),ar=()=>{ye.value>1&&ye.value--},vt=()=>{ye.value<Dt.value&&ye.value++},Pt=Se=>O.value.key!==Se?Lz:O.value.order==="asc"?Dz:Oz,Ot=Qr(""),lr=()=>{Ot.value=o.value.trim(),ye.value=1};return ic(Fr),(Se,Kt)=>{const Fe=Z_("v-btn");return sn(),Sn("div",fJ,[Un(cy,{show:Q.value,message:"Processing your booking..."},null,8,["show"]),Un(cy,{show:ge.value,message:"Processing your rating..."},null,8,["show"]),(sn(!0),Sn(ts,null,Gf(s,$e=>(sn(),Sn("div",{key:$e.id,class:"coach-card"},[ct("div",pJ,[ct("h2",null,Ii($e.name),1),ct("p",null,"Average Rating: "+Ii($e.averageRating.toFixed(1)),1),Un(Ws(nw),{rating:Math.floor($e.averageRating),"star-size":20,"read-only":!0,"show-rating":!1},null,8,["rating"]),Un(Fe,{onClick:We=>Xr($e),color:"primary"},{default:sl(()=>[Es("View Reviews")]),_:2},1032,["onClick"]),$e.userHasRated?(sn(),Sn("div",_J,[ct("p",null,"Your Rating: "+Ii($e.userRating),1)])):(sn(),Sn("div",mJ,[ct("button",{class:"action-button",onClick:We=>ft($e)},"Rate Coach",8,gJ)])),ct("div",null,[ct("button",{class:"action-button",onClick:We=>ie($e)},"Booking",8,yJ)])])]))),128)),h.value?(sn(),Sn("div",vJ,[ct("div",{class:"modal-content",onClick:Kt[2]||(Kt[2]=zf(()=>{},["stop"]))},[ct("h3",null,"Rate "+Ii(p.value.name),1),ct("div",bJ,[xJ,Un(Ws(nw),{rating:b.value,"onUpdate:rating":Kt[0]||(Kt[0]=$e=>b.value=$e),"star-size":30,"show-rating":!1,id:"rating"},null,8,["rating"])]),ct("div",wJ,[TJ,ds(ct("textarea",{"onUpdate:modelValue":Kt[1]||(Kt[1]=$e=>z.value=$e),id:"comment",rows:"4",placeholder:"Please share your experience with this coach (optional)",maxlength:"100"},null,512),[[fs,z.value]]),ct("div",EJ,Ii(z.value.length)+"/100",1)]),ct("div",SJ,[ct("button",{onClick:gt,disabled:!U.value,class:"primary-button"},"Submit Rating",8,IJ),ct("button",{onClick:or,class:"secondary-button"},"Cancel")])])])):aa("",!0),H.value?(sn(),Sn("div",AJ,[ct("div",{class:"modal-content",onClick:Kt[9]||(Kt[9]=zf(()=>{},["stop"]))},[ct("h3",null,"Book Appointment with "+Ii(p.value.name),1),ct("form",{onSubmit:zf(we,["prevent"])},[ds(ct("input",{"onUpdate:modelValue":Kt[3]||(Kt[3]=$e=>ke.name=$e),placeholder:"Your Name",required:""},null,512),[[fs,ke.name]]),ds(ct("input",{"onUpdate:modelValue":Kt[4]||(Kt[4]=$e=>ke.email=$e),type:"email",placeholder:"Your Email",required:""},null,512),[[fs,ke.email]]),ds(ct("input",{"onUpdate:modelValue":Kt[5]||(Kt[5]=$e=>ke.phone=$e),type:"tel",placeholder:"Your Phone",required:""},null,512),[[fs,ke.phone]]),ds(ct("input",{type:"date","onUpdate:modelValue":Kt[6]||(Kt[6]=$e=>ke.appointmentDate=$e),onChange:me,required:""},null,544),[[fs,ke.appointmentDate]]),ke.appointmentDate?ds((sn(),Sn("select",{key:0,"onUpdate:modelValue":Kt[7]||(Kt[7]=$e=>ke.timeSlot=$e),required:""},[CJ,(sn(!0),Sn(ts,null,Gf(he.value,$e=>(sn(),Sn("option",{key:$e,value:$e,disabled:re($e)},Ii($e),9,RJ))),128))],512)),[[wy,ke.timeSlot]]):aa("",!0),ds(ct("textarea",{"onUpdate:modelValue":Kt[8]||(Kt[8]=$e=>ke.notes=$e),placeholder:"Any notes or questions?"},null,512),[[fs,ke.notes]]),PJ,ct("button",{onClick:ne,class:"secondary-button"},"Cancel")],32)])])):aa("",!0),ve.value?(sn(),Sn("div",{key:2,class:"overlay",onClick:Te},[ct("div",{class:"modal-content",onClick:Kt[10]||(Kt[10]=zf(()=>{},["stop"]))},[MJ,ct("button",{onClick:Et,class:"primary-button"},"Download Appointment Letter"),ct("button",{onClick:Te,class:"secondary-button"},"Close")])])):aa("",!0),Y.value?(sn(),Sn("div",kJ,[ct("div",OJ,[ct("h3",null,"Reviews for "+Ii(p.value.name),1),ct("div",DJ,[ds(ct("input",{"onUpdate:modelValue":Kt[11]||(Kt[11]=$e=>o.value=$e),placeholder:"Search By Comments",class:"search-input",onKeyup:IO(lr,["enter"]),maxlength:"20"},null,544),[[fs,o.value]])]),ct("div",LJ,[ct("table",null,[ct("thead",null,[ct("tr",null,[BJ,ct("th",null,[Es(" Rating "),ct("span",{onClick:Kt[12]||(Kt[12]=$e=>Ur("rating")),class:"sort-icon"},[(sn(),Oc(vd(Pt("rating"))))])]),zJ,ct("th",null,[Es(" Date "),ct("span",{onClick:Kt[13]||(Kt[13]=$e=>Ur("timestamp")),class:"sort-icon"},[(sn(),Oc(vd(Pt("timestamp"))))])])])]),ct("tbody",null,[(sn(!0),Sn(ts,null,Gf(pr.value,$e=>(sn(),Sn("tr",{key:$e.user},[ct("td",null,Ii($e.user),1),ct("td",null,[Un(Ws(nw),{rating:$e.rating,"star-size":14,"read-only":!0,"show-rating":!1},null,8,["rating"])]),ct("td",null,Ii($e.comment),1),ct("td",null,Ii(new Date($e.timestamp).toLocaleDateString()),1)]))),128))])])]),ct("div",NJ,[ct("button",{onClick:ar,disabled:ye.value===1},"Previous",8,FJ),ct("span",null,"Page "+Ii(ye.value)+" of "+Ii(Dt.value),1),ct("button",{onClick:vt,disabled:ye.value===Dt.value},"Next",8,VJ)]),ct("button",{onClick:ze,class:"close-button"},"Close")])])):aa("",!0)])}}},jJ=Cl(UJ,[["__scopeId","data-v-51448dc4"]]),$J={},GJ=ct("h1",null,"Professional Help",-1),qJ=[GJ];function HJ(t,e){return sn(),Sn("div",null,qJ)}const WJ=Cl($J,[["render",HJ]]),yh=t=>(xu("data-v-6de847ca"),t=t(),wu(),t),ZJ={class:"dashboard"},KJ=yh(()=>ct("h1",null,"Admin Dashboard",-1)),XJ=yh(()=>ct("h2",null,"Users' Appointments Information:",-1)),YJ={class:"appointment-table"},JJ={class:"filters"},QJ={class:"date-filter"},eQ=yh(()=>ct("label",null,"Booking Date Range:",-1)),tQ={class:"coach-filter"},rQ=yh(()=>ct("label",null,"Coach:",-1)),nQ=yh(()=>ct("option",{value:""},"All Coaches",-1)),iQ=["value"],oQ={class:"user-name-filter"},sQ=yh(()=>ct("label",null,"User Name:",-1)),aQ={class:"date-filter"},lQ=yh(()=>ct("label",null,"Create Date Range:",-1)),cQ={class:"notes-filter"},uQ=yh(()=>ct("label",null,"Notes:",-1)),hQ={class:"sort-icon"},dQ={class:"sort-icon"},fQ={class:"sort-icon"},pQ={class:"sort-icon"},mQ={class:"sort-icon"},gQ=yh(()=>ct("th",null,"Notes",-1)),_Q={class:"pagination"},yQ=["disabled"],vQ=["disabled"],bM=10,bQ={__name:"DashboardView",setup(t){const e=OL(),r=Qr([]),s=Qr([]),h=Qr(1),p=Qr(0),b=Qr(!1),E=Qr({bookingDateStart:"",bookingDateEnd:"",coachName:"",userName:"",createDateStart:"",createDateEnd:"",notes:""}),o=Qr({key:"createdAt",order:"desc"}),O=async(oe=!1)=>{b.value=!0;try{const ve=await e.currentUser.getIdToken(),be=await gs.post("https://getfilteredappointments-t5kfcvh67q-uc.a.run.app",{filters:E.value,sortCriteria:o.value,itemsPerPage:bM,currentPage:h.value},{headers:{Authorization:`Bearer ${ve}`}}),{appointments:ze,total:Te}=be.data;r.value=ze,p.value=Te}catch(ve){console.error("Error fetching filtered appointments:",ve)}finally{b.value=!1}},z=async()=>{h.value=1,await O(!0)},U=async()=>{b.value=!0;try{const oe=await e.currentUser.getIdToken(),ve=await gs.get("https://getuniquecoachnames-t5kfcvh67q-uc.a.run.app",{headers:{Authorization:`Bearer ${oe}`}});s.value=ve.data}catch(oe){console.error("Error fetching unique coaches:",oe)}finally{b.value=!1}},H=Ds(()=>r.value),Y=Ds(()=>Math.ceil(p.value/bM)),Q=async()=>{h.value<Y.value&&(h.value++,await O())},ge=async()=>{h.value>1&&(h.value--,await O())},ye=oe=>{o.value.key===oe?o.value.order=o.value.order==="asc"?"desc":"asc":(o.value.key=oe,o.value.order="asc"),h.value=1,z()},ke=oe=>o.value.key!==oe?Lz:o.value.order==="asc"?Dz:Oz,he=oe=>typeof oe=="string"?oe:oe instanceof Date||typeof oe=="number"?new Date(oe).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1}):"Invalid Date";return ic(async()=>{await U(),await O(!0)}),(oe,ve)=>(sn(),Sn("div",ZJ,[Un(cy,{show:b.value,message:"Loading data..."},null,8,["show"]),KJ,XJ,ct("div",YJ,[ct("div",JJ,[ct("div",QJ,[eQ,ds(ct("input",{type:"date","onUpdate:modelValue":ve[0]||(ve[0]=be=>E.value.bookingDateStart=be)},null,512),[[fs,E.value.bookingDateStart]]),ds(ct("input",{type:"date","onUpdate:modelValue":ve[1]||(ve[1]=be=>E.value.bookingDateEnd=be)},null,512),[[fs,E.value.bookingDateEnd]])]),ct("div",tQ,[rQ,ds(ct("select",{"onUpdate:modelValue":ve[2]||(ve[2]=be=>E.value.coachName=be)},[nQ,(sn(!0),Sn(ts,null,Gf(s.value,be=>(sn(),Sn("option",{key:be,value:be},Ii(be),9,iQ))),128))],512),[[wy,E.value.coachName]])]),ct("div",oQ,[sQ,ds(ct("input",{"onUpdate:modelValue":ve[3]||(ve[3]=be=>E.value.userName=be),placeholder:"Enter User Name"},null,512),[[fs,E.value.userName]])]),ct("div",aQ,[lQ,ds(ct("input",{type:"date","onUpdate:modelValue":ve[4]||(ve[4]=be=>E.value.createDateStart=be)},null,512),[[fs,E.value.createDateStart]]),ds(ct("input",{type:"date","onUpdate:modelValue":ve[5]||(ve[5]=be=>E.value.createDateEnd=be)},null,512),[[fs,E.value.createDateEnd]])]),ct("div",cQ,[uQ,ds(ct("input",{"onUpdate:modelValue":ve[6]||(ve[6]=be=>E.value.notes=be),placeholder:"Search in Notes"},null,512),[[fs,E.value.notes]])]),ct("button",{onClick:z,class:"filter-button"},"Apply Filters")]),ct("table",null,[ct("thead",null,[ct("tr",null,[ct("th",{onClick:ve[7]||(ve[7]=be=>ye("appointmentDate"))},[Es(" Booking Date "),ct("span",hQ,[(sn(),Oc(vd(ke("appointmentDate"))))])]),ct("th",{onClick:ve[8]||(ve[8]=be=>ye("coachName"))},[Es(" Coach Name "),ct("span",dQ,[(sn(),Oc(vd(ke("coachName"))))])]),ct("th",{onClick:ve[9]||(ve[9]=be=>ye("userName"))},[Es(" User Name "),ct("span",fQ,[(sn(),Oc(vd(ke("userName"))))])]),ct("th",{onClick:ve[10]||(ve[10]=be=>ye("userId"))},[Es(" User ID "),ct("span",pQ,[(sn(),Oc(vd(ke("userId"))))])]),ct("th",{onClick:ve[11]||(ve[11]=be=>ye("createdAt"))},[Es(" Create Date "),ct("span",mQ,[(sn(),Oc(vd(ke("createdAt"))))])]),gQ])]),ct("tbody",null,[(sn(!0),Sn(ts,null,Gf(H.value,be=>(sn(),Sn("tr",{key:be.id},[ct("td",null,Ii(he(be.appointmentDate)),1),ct("td",null,Ii(be.coachName),1),ct("td",null,Ii(be.userName),1),ct("td",null,Ii(be.userId),1),ct("td",null,Ii(he(be.createdAt)),1),ct("td",null,Ii(be.notes),1)]))),128))])]),ct("div",_Q,[ct("button",{onClick:ge,disabled:h.value===1},"Previous",8,yQ),ct("span",null,"Page "+Ii(h.value)+" of "+Ii(Y.value),1),ct("button",{onClick:Q,disabled:h.value===Y.value},"Next",8,vQ)])])]))}},xQ=Cl(bQ,[["__scopeId","data-v-6de847ca"]]),{isAuthenticated:xM,login:kre,currentRole:wQ}=sg(),TQ=[{path:"/dashboard",name:"Dashboard",component:xQ,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/",name:"Home",component:e8},{path:"/about",name:"About",component:_8},{path:"/community",name:"Community",component:w8},{path:"/help",name:"Help",component:z8},{path:"/involved",name:"Involved",component:$8},{path:"/learn",name:"Learn",component:K8},{path:"/news-and-events",name:"NewsAndEvents",component:tG},{path:"/login",name:"Login",component:OK},{path:"/register",name:"Register",component:aX},{path:"/access-denied",name:"AccessDenied",component:xX},{path:"/help/get-mental-health-coach",name:"GetMentalHealthCoach",component:jJ},{path:"/help/get-mental-health-professional",name:"GetMentalHealthProfessional",component:WJ}],ug=W6({history:x6(),routes:TQ});ug.beforeEach((t,e,r)=>{t.meta.requiresAuth&&!xM.value?(console.log("Access denied: Please log in."),r("/access-denied")):t.name==="Community"&&xM.value&&wQ.value!=="user"?(console.log("Access denied: You do not have the required permissions."),r("/access-denied")):r()});const EQ="/FIT5032-SoulClam/assets/logo-DUe4Avwl.png",hg=t=>(xu("data-v-16802f6c"),t=t(),wu(),t),SQ={class:"navbar navbar-expand-md navbar-light bg-light nav-header"},IQ=hg(()=>ct("img",{src:EQ,alt:"SoulCalm Logo",width:"50",height:"50"},null,-1)),AQ=hg(()=>ct("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},[ct("span",{class:"navbar-toggler-icon"})],-1)),CQ={class:"collapse navbar-collapse",id:"navbarNav"},RQ={class:"navbar-nav mx-auto"},PQ={class:"nav-item"},MQ={class:"nav-item"},kQ={class:"nav-item"},OQ={class:"nav-item"},DQ={class:"nav-item"},LQ={class:"nav-item"},BQ={class:"nav-item"},zQ={key:0,class:"nav-item"},NQ={class:"d-flex align-items-center"},FQ={key:0,class:"dropdown"},VQ=hg(()=>ct("div",{id:"userMenu","data-bs-toggle":"dropdown","aria-expanded":"false",style:{cursor:"pointer"}},[ct("i",{class:"bi bi-person-circle user-icon"})],-1)),UQ={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"userMenu"},jQ={key:1},$Q={key:0,class:"profile-overlay"},GQ={class:"profile-content"},qQ=hg(()=>ct("h2",null,"User Profile",-1)),HQ=hg(()=>ct("strong",null,"Email:",-1)),WQ=hg(()=>ct("strong",null,"Role:",-1)),ZQ={__name:"NavHeaderView",setup(t){const{isAuthenticated:e,logout:r,currentRole:s,currentUserUid:h}=sg(),p=H=>{ug.push(H)},b=Ds(()=>e.value&&s.value==="admin"),E=Qr(!1);Qr("");const o=Qr(""),O=Qr(""),z=async()=>{try{const H=await uu.getUserInfo(h.value);H?(o.value=H.email||"N/A",O.value=s.value||"N/A",E.value=!0):console.error("User info not found")}catch(H){console.error("Error fetching user info:",H)}},U=()=>{E.value=!1};return(H,Y)=>{const Q=Z_("b-navbar-brand"),ge=Z_("router-link");return sn(),Sn("header",SQ,[Un(Q,{href:"/",class:"logo"},{default:sl(()=>[IQ]),_:1}),AQ,ct("div",CQ,[ct("ul",RQ,[ct("li",PQ,[Un(ge,{to:"/",class:"nav-link"},{default:sl(()=>[Es("Home")]),_:1})]),ct("li",MQ,[Un(ge,{to:"/learn",class:"nav-link"},{default:sl(()=>[Es("Learn")]),_:1})]),ct("li",kQ,[Un(ge,{to:"/news-and-events",class:"nav-link"},{default:sl(()=>[Es("News")]),_:1})]),ct("li",OQ,[Un(ge,{to:"/community",class:"nav-link"},{default:sl(()=>[Es("Community")]),_:1})]),ct("li",DQ,[Un(ge,{to:"/help",class:"nav-link"},{default:sl(()=>[Es("Help")]),_:1})]),ct("li",LQ,[Un(ge,{to:"/involved",class:"nav-link"},{default:sl(()=>[Es("Involved")]),_:1})]),ct("li",BQ,[Un(ge,{to:"/about",class:"nav-link"},{default:sl(()=>[Es("About")]),_:1})]),b.value?(sn(),Sn("li",zQ,[Un(ge,{to:"/dashboard",class:"nav-link"},{default:sl(()=>[Es("Dashboard")]),_:1})])):aa("",!0)]),ct("div",NQ,[Ws(e)?(sn(),Sn("div",FQ,[VQ,ct("ul",UQ,[ct("li",null,[ct("button",{class:"dropdown-item",onClick:z},"Profile")]),ct("li",null,[ct("button",{class:"dropdown-item",onClick:Y[0]||(Y[0]=(...ye)=>Ws(r)&&Ws(r)(...ye))},"Logout")])])])):(sn(),Sn("div",jQ,[ct("button",{onClick:Y[1]||(Y[1]=ye=>p("/login")),class:"btn btn-outline-primary me-2"},"Login"),ct("button",{onClick:Y[2]||(Y[2]=ye=>p("/register")),class:"btn btn-primary"},"Register")]))])]),E.value?(sn(),Sn("div",$Q,[ct("div",GQ,[qQ,ct("p",null,[HQ,Es(" "+Ii(o.value),1)]),ct("p",null,[WQ,Es(" "+Ii(O.value),1)]),ct("button",{onClick:U,class:"btn btn-primary"},"Close")])])):aa("",!0)])}}},KQ=Cl(ZQ,[["__scopeId","data-v-16802f6c"]]),XQ={},YQ={class:"footer"},JQ=nO('<div class="footer-content" data-v-4053ddb3><p class="text-center" data-v-4053ddb3>© 2024 SoulCalm. All rights reserved.</p><p class="text-center" data-v-4053ddb3><a href="/privacy-policy" data-v-4053ddb3>Privacy Policy</a> | <a href="/terms-of-service" data-v-4053ddb3>Terms of Service</a></p></div>',1),QQ=[JQ];function eee(t,e){return sn(),Sn("footer",YQ,QQ)}const tee=Cl(XQ,[["render",eee],["__scopeId","data-v-4053ddb3"]]),ree={id:"app"},nee={class:"main-content"},iee={__name:"App",setup(t){return(e,r)=>{const s=Z_("router-view");return sn(),Sn(ts,null,[ct("div",ree,[ct("div",null,[Un(KQ)]),ct("div",nee,[Un(s)])]),Un(tee)],64)}}};var oee=Object.defineProperty,wM=Object.getOwnPropertySymbols,see=Object.prototype.hasOwnProperty,aee=Object.prototype.propertyIsEnumerable,TM=(t,e,r)=>e in t?oee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lee=(t,e)=>{for(var r in e||(e={}))see.call(e,r)&&TM(t,r,e[r]);if(wM)for(var r of wM(e))aee.call(e,r)&&TM(t,r,e[r]);return t};function Bz(t){return t==null||t===""||Array.isArray(t)&&t.length===0||!(t instanceof Date)&&typeof t=="object"&&Object.keys(t).length===0}function cee(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Nl(t){return!Bz(t)}function ap(t,e=!0){return t instanceof Object&&t.constructor===Object&&(e||Object.keys(t).length!==0)}function j_(t,...e){return cee(t)?t(...e):t}function Hm(t,e=!0){return typeof t=="string"&&(e||t!=="")}function uee(t,e=!0){return Array.isArray(t)&&(e||t.length!==0)}function zz(t){return Nl(t)&&!isNaN(t)}function ah(t,e){if(e){const r=e.test(t);return e.lastIndex=0,r}return!1}function hee(...t){const e=(r={},s={})=>{const h=lee({},r);return Object.keys(s).forEach(p=>{ap(s[p])&&p in r&&ap(r[p])?h[p]=e(r[p],s[p]):h[p]=s[p]}),h};return t.reduce((r,s,h)=>h===0?s:e(r,s),{})}function $_(t){return t&&t.replace(/\/\*(?:(?!\*\/)[\s\S])*\*\/|[\r\n\t]+/g,"").replace(/ {2,}/g," ").replace(/ ([{:}]) /g,"$1").replace(/([;,]) /g,"$1").replace(/ !/g,"!").replace(/: /g,":")}function Nz(t){return Hm(t)?t.replace(/(_)/g,"-").replace(/[A-Z]/g,(e,r)=>r===0?e:"-"+e.toLowerCase()).toLowerCase():t}function EM(t){return Hm(t)?t.replace(/[A-Z]/g,(e,r)=>r===0?e:"."+e.toLowerCase()).toLowerCase():t}function Fz(){const t=new Map;return{on(e,r){let s=t.get(e);return s?s.push(r):s=[r],t.set(e,s),this},off(e,r){let s=t.get(e);return s&&s.splice(s.indexOf(r)>>>0,1),this},emit(e,r){let s=t.get(e);s&&s.slice().map(h=>{h(r)})},clear(){t.clear()}}}var dee=Object.defineProperty,fee=Object.defineProperties,pee=Object.getOwnPropertyDescriptors,cb=Object.getOwnPropertySymbols,Vz=Object.prototype.hasOwnProperty,Uz=Object.prototype.propertyIsEnumerable,SM=(t,e,r)=>e in t?dee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y_=(t,e)=>{for(var r in e||(e={}))Vz.call(e,r)&&SM(t,r,e[r]);if(cb)for(var r of cb(e))Uz.call(e,r)&&SM(t,r,e[r]);return t},cw=(t,e)=>fee(t,pee(e)),v_=(t,e)=>{var r={};for(var s in t)Vz.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&cb)for(var s of cb(t))e.indexOf(s)<0&&Uz.call(t,s)&&(r[s]=t[s]);return r},mee=Fz(),th=mee;function IM(t,e){uee(t)?t.push(...e||[]):ap(t)&&Object.assign(t,e)}function gee(t){return ap(t)&&t.hasOwnProperty("value")&&t.hasOwnProperty("type")?t.value:t}function AM(t,e=""){return["opacity","z-index","line-height","font-weight","flex","flex-grow","flex-shrink","order"].some(s=>e.endsWith(s))?t:`${t}`.trim().split(" ").map(p=>zz(p)?`${p}px`:p).join(" ")}function _ee(t){return t.replaceAll(/ /g,"").replace(/[^\w]/g,"-")}function vT(t="",e=""){return _ee(`${Hm(t,!1)&&Hm(e,!1)?`${t}-`:t}${e}`)}function jz(t="",e=""){return`--${vT(t,e)}`}function $z(t,e="",r="",s=[],h){if(Hm(t)){const p=/{([^}]*)}/g,b=t.trim();if(ah(b,p)){const E=b.replaceAll(p,z=>{const H=z.replace(/{|}/g,"").split(".").filter(Y=>!s.some(Q=>ah(Y,Q)));return`var(${jz(r,Nz(H.join("-")))}${Nl(h)?`, ${h}`:""})`}),o=/(\d+\s+[\+\-\*\/]\s+\d+)/g,O=/var\([^)]+\)/g;return ah(E.replace(O,"0"),o)?`calc(${E})`:E}return AM(b,e)}else if(zz(t))return AM(t,e)}function yee(t,e,r){Hm(e,!1)&&t.push(`${e}:${r};`)}function R_(t,e){return t?`${t}{${e}}`:""}var uw=(...t)=>vee(Va.getTheme(),...t),vee=(t={},e,r,s="variable")=>{if(e){const{variable:h,options:p}=Va.defaults||{},{prefix:b,transform:E}=(t==null?void 0:t.options)||p||{},O=ah(e,/{([^}]*)}/g)?e:`{${e}}`;return s==="value"||E==="strict"?Va.getTokenValue(e):$z(O,void 0,b,[h.excludedKeyRegex],r)}return""};function bee(t,e={}){const r=Va.defaults.variable,{prefix:s=r.prefix,selector:h=r.selector,excludedKeyRegex:p=r.excludedKeyRegex}=e,b=(O,z="")=>Object.entries(O).reduce((U,[H,Y])=>{const Q=ah(H,p)?vT(z):vT(z,Nz(H)),ge=gee(Y);if(ap(ge)){const{variables:ye,tokens:ke}=b(ge,Q);IM(U.tokens,ke),IM(U.variables,ye)}else U.tokens.push((s?Q.replace(`${s}-`,""):Q).replaceAll("-",".")),yee(U.variables,jz(Q),$z(ge,Q,s,[p]));return U},{variables:[],tokens:[]}),{variables:E,tokens:o}=b(t,s);return{value:E,tokens:o,declarations:E.join(""),css:R_(h,E.join(""))}}var kc={regex:{rules:{class:{pattern:/^\.([a-zA-Z][\w-]*)$/,resolve(t){return{type:"class",selector:t,matched:this.pattern.test(t.trim())}}},attr:{pattern:/^\[(.*)\]$/,resolve(t){return{type:"attr",selector:`:root${t}`,matched:this.pattern.test(t.trim())}}},media:{pattern:/^@media (.*)$/,resolve(t){return{type:"media",selector:`${t}{:root{[CSS]}}`,matched:this.pattern.test(t.trim())}}},system:{pattern:/^system$/,resolve(t){return{type:"system",selector:"@media (prefers-color-scheme: dark){:root{[CSS]}}",matched:this.pattern.test(t.trim())}}},custom:{resolve(t){return{type:"custom",selector:t,matched:!0}}}},resolve(t){const e=Object.keys(this.rules).filter(r=>r!=="custom").map(r=>this.rules[r]);return[t].flat().map(r=>{var s;return(s=e.map(h=>h.resolve(r)).find(h=>h.matched))!=null?s:this.rules.custom.resolve(r)})}},_toVariables(t,e){return bee(t,{prefix:e==null?void 0:e.prefix})},getCommon({name:t="",theme:e={},params:r,set:s,defaults:h}){var p,b,E,o;const{preset:O,options:z}=e;let U,H,Y,Q;if(Nl(O)){const{primitive:ge,semantic:ye}=O,ke=ye||{},{colorScheme:he}=ke,oe=v_(ke,["colorScheme"]),ve=he||{},{dark:be}=ve,ze=v_(ve,["dark"]),Te=Nl(ge)?this._toVariables({primitive:ge},z):{},ie=Nl(oe)?this._toVariables({semantic:oe},z):{},ne=Nl(ze)?this._toVariables({light:ze},z):{},te=Nl(be)?this._toVariables({dark:be},z):{},[re,me]=[(p=Te.declarations)!=null?p:"",Te.tokens],[we,tt]=[(b=ie.declarations)!=null?b:"",ie.tokens||[]],[Et,ft]=[(E=ne.declarations)!=null?E:"",ne.tokens||[]],[rr,or]=[(o=te.declarations)!=null?o:"",te.tokens||[]];U=this.transformCSS(t,re,"light","variable",z,s,h),H=me;const Fr=this.transformCSS(t,`${we}${Et}color-scheme:light`,"light","variable",z,s,h),gt=this.transformCSS(t,`${rr}color-scheme:dark`,"dark","variable",z,s,h);Y=`${Fr}${gt}`,Q=[...new Set([...tt,...ft,...or])]}return{primitive:{css:U,tokens:H},semantic:{css:Y,tokens:Q}}},getPreset({name:t="",preset:e={},options:r,params:s,set:h,defaults:p,selector:b}){var E,o,O;const z=t.replace("-directive",""),U=e,{colorScheme:H}=U,Y=v_(U,["colorScheme"]),Q=H||{},{dark:ge}=Q,ye=v_(Q,["dark"]),ke=Nl(Y)?this._toVariables({[z]:Y},r):{},he=Nl(ye)?this._toVariables({[z]:ye},r):{},oe=Nl(ge)?this._toVariables({[z]:ge},r):{},[ve,be]=[(E=ke.declarations)!=null?E:"",ke.tokens||[]],[ze,Te]=[(o=he.declarations)!=null?o:"",he.tokens||[]],[ie,ne]=[(O=oe.declarations)!=null?O:"",oe.tokens||[]],te=[...new Set([...be,...Te,...ne])],re=this.transformCSS(z,`${ve}${ze}`,"light","variable",r,h,p,b),me=this.transformCSS(z,ie,"dark","variable",r,h,p,b);return{css:`${re}${me}`,tokens:te}},getPresetC({name:t="",theme:e={},params:r,set:s,defaults:h}){var p;const{preset:b,options:E}=e,o=(p=b==null?void 0:b.components)==null?void 0:p[t];return this.getPreset({name:t,preset:o,options:E,params:r,set:s,defaults:h})},getPresetD({name:t="",theme:e={},params:r,set:s,defaults:h}){var p;const b=t.replace("-directive",""),{preset:E,options:o}=e,O=(p=E==null?void 0:E.directives)==null?void 0:p[b];return this.getPreset({name:b,preset:O,options:o,params:r,set:s,defaults:h})},getColorSchemeOption(t,e){var r;return this.regex.resolve((r=t.darkModeSelector)!=null?r:e.options.darkModeSelector)},getLayerOrder(t,e={},r,s){const{cssLayer:h}=e;return h?`@layer ${j_(h.order||"primeui",r)}`:""},getCommonStyleSheet({name:t="",theme:e={},params:r,props:s={},set:h,defaults:p}){const b=this.getCommon({name:t,theme:e,params:r,set:h,defaults:p}),E=Object.entries(s).reduce((o,[O,z])=>o.push(`${O}="${z}"`)&&o,[]).join(" ");return Object.entries(b||{}).reduce((o,[O,z])=>{if(z!=null&&z.css){const U=$_(z==null?void 0:z.css),H=`${O}-variables`;o.push(`<style type="text/css" data-primevue-style-id="${H}" ${E}>${U}</style>`)}return o},[]).join("")},getStyleSheet({name:t="",theme:e={},params:r,props:s={},set:h,defaults:p}){var b;const E={name:t,theme:e,params:r,set:h,defaults:p},o=(b=t.includes("-directive")?this.getPresetD(E):this.getPresetC(E))==null?void 0:b.css,O=Object.entries(s).reduce((z,[U,H])=>z.push(`${U}="${H}"`)&&z,[]).join(" ");return o?`<style type="text/css" data-primevue-style-id="${t}-variables" ${O}>${$_(o)}</style>`:""},createTokens(t={},e,r="",s="",h={}){return Object.entries(t).forEach(([p,b])=>{const E=ah(p,e.variable.excludedKeyRegex)?r:r?`${r}.${EM(p)}`:EM(p),o=s?`${s}.${p}`:p;ap(b)?this.createTokens(b,e,E,o,h):(h[E]||(h[E]={paths:[],computed(O,z={}){if(O){const U=this.paths.find(H=>H.scheme===O)||this.paths.find(H=>H.scheme==="none");return U==null?void 0:U.computed(O,z.binding)}return this.paths.map(U=>U.computed(U.scheme,z[U.scheme]))}}),h[E].paths.push({path:o,value:b,scheme:o.includes("colorScheme.light")?"light":o.includes("colorScheme.dark")?"dark":"none",computed(O,z={}){const U=/{([^}]*)}/g;let H=b;if(z.name=this.path,z.binding||(z.binding={}),ah(b,U)){const Q=b.trim().replaceAll(U,ke=>{var he,oe;const ve=ke.replace(/{|}/g,"");return(oe=(he=h[ve])==null?void 0:he.computed(O,z))==null?void 0:oe.value}),ge=/(\d+\w*\s+[\+\-\*\/]\s+\d+\w*)/g,ye=/var\([^)]+\)/g;H=ah(Q.replace(ye,"0"),ge)?`calc(${Q})`:Q}return Bz(z.binding)&&delete z.binding,{colorScheme:O,path:this.path,paths:z,value:H.includes("undefined")?void 0:H}}}))}),h},getTokenValue(t,e,r){var s;const p=(o=>o.split(".").filter(z=>!ah(z.toLowerCase(),r.variable.excludedKeyRegex)).join("."))(e),b=e.includes("colorScheme.light")?"light":e.includes("colorScheme.dark")?"dark":void 0,E=[(s=t[p])==null?void 0:s.computed(b)].flat().filter(o=>o);return E.length===1?E[0].value:E.reduce((o={},O)=>{const z=O,{colorScheme:U}=z,H=v_(z,["colorScheme"]);return o[U]=H,o},void 0)},transformCSS(t,e,r,s,h={},p,b,E){if(Nl(e)){const{cssLayer:o}=h;if(s!=="style"){const O=this.getColorSchemeOption(h,b),z=E?R_(E,e):e;e=r==="dark"?O.reduce((U,{selector:H})=>(Nl(H)&&(U+=H.includes("[CSS]")?H.replace("[CSS]",z):R_(H,z)),U),""):R_(E??":root",e)}if(o){const O={name:"primeui",order:"primeui"};ap(o)&&(O.name=j_(o.name,{name:t,type:s})),Nl(O.name)&&(e=R_(`@layer ${O.name}`,e),p==null||p.layerNames(O.name))}return e}return""}},Va={defaults:{variable:{prefix:"p",selector:":root",excludedKeyRegex:/^(primitive|semantic|components|directives|variables|colorscheme|light|dark|common|root|states)$/gi},options:{prefix:"p",darkModeSelector:"system",cssLayer:!1}},_theme:void 0,_layerNames:new Set,_loadedStyleNames:new Set,_loadingStyles:new Set,_tokens:{},update(t={}){const{theme:e}=t;e&&(this._theme=cw(y_({},e),{options:y_(y_({},this.defaults.options),e.options)}),this._tokens=kc.createTokens(this.preset,this.defaults),this.clearLoadedStyleNames())},get theme(){return this._theme},get preset(){var t;return((t=this.theme)==null?void 0:t.preset)||{}},get options(){var t;return((t=this.theme)==null?void 0:t.options)||{}},get tokens(){return this._tokens},getTheme(){return this.theme},setTheme(t){this.update({theme:t}),th.emit("theme:change",t)},getPreset(){return this.preset},setPreset(t){this._theme=cw(y_({},this.theme),{preset:t}),this._tokens=kc.createTokens(t,this.defaults),this.clearLoadedStyleNames(),th.emit("preset:change",t),th.emit("theme:change",this.theme)},getOptions(){return this.options},setOptions(t){this._theme=cw(y_({},this.theme),{options:t}),this.clearLoadedStyleNames(),th.emit("options:change",t),th.emit("theme:change",this.theme)},getLayerNames(){return[...this._layerNames]},setLayerNames(t){this._layerNames.add(t)},getLoadedStyleNames(){return this._loadedStyleNames},isStyleNameLoaded(t){return this._loadedStyleNames.has(t)},setLoadedStyleName(t){this._loadedStyleNames.add(t)},deleteLoadedStyleName(t){this._loadedStyleNames.delete(t)},clearLoadedStyleNames(){this._loadedStyleNames.clear()},getTokenValue(t){return kc.getTokenValue(this.tokens,t,this.defaults)},getCommon(t="",e){return kc.getCommon({name:t,theme:this.theme,params:e,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},getComponent(t="",e){const r={name:t,theme:this.theme,params:e,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return kc.getPresetC(r)},getDirective(t="",e){const r={name:t,theme:this.theme,params:e,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return kc.getPresetD(r)},getCustomPreset(t="",e,r,s){const h={name:t,preset:e,options:this.options,selector:r,params:s,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}};return kc.getPreset(h)},getLayerOrderCSS(t=""){return kc.getLayerOrder(t,this.options,{names:this.getLayerNames()},this.defaults)},transformCSS(t="",e,r="style",s){return kc.transformCSS(t,e,s,r,this.options,{layerNames:this.setLayerNames.bind(this)},this.defaults)},getCommonStyleSheet(t="",e,r={}){return kc.getCommonStyleSheet({name:t,theme:this.theme,params:e,props:r,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},getStyleSheet(t,e,r={}){return kc.getStyleSheet({name:t,theme:this.theme,params:e,props:r,defaults:this.defaults,set:{layerNames:this.setLayerNames.bind(this)}})},onStyleMounted(t){this._loadingStyles.add(t)},onStyleUpdated(t){this._loadingStyles.add(t)},onStyleLoaded(t,{name:e}){this._loadingStyles.size&&(this._loadingStyles.delete(e),th.emit(`theme:${e}:load`,t),!this._loadingStyles.size&&th.emit("theme:load"))}},Fa={STARTS_WITH:"startsWith",CONTAINS:"contains",NOT_CONTAINS:"notContains",ENDS_WITH:"endsWith",EQUALS:"equals",NOT_EQUALS:"notEquals",IN:"in",LESS_THAN:"lt",LESS_THAN_OR_EQUAL_TO:"lte",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL_TO:"gte",BETWEEN:"between",DATE_IS:"dateIs",DATE_IS_NOT:"dateIsNot",DATE_BEFORE:"dateBefore",DATE_AFTER:"dateAfter"};function Gz(t){return typeof HTMLElement=="object"?t instanceof HTMLElement:t&&typeof t=="object"&&t!==null&&t.nodeType===1&&typeof t.nodeName=="string"}function bT(t,e={}){if(Gz(t)){const r=(s,h)=>{var p,b;const E=(p=t==null?void 0:t.$attrs)!=null&&p[s]?[(b=t==null?void 0:t.$attrs)==null?void 0:b[s]]:[];return[h].flat().reduce((o,O)=>{if(O!=null){const z=typeof O;if(z==="string"||z==="number")o.push(O);else if(z==="object"){const U=Array.isArray(O)?r(s,O):Object.entries(O).map(([H,Y])=>s==="style"&&(Y||Y===0)?`${H.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}:${Y}`:Y?H:void 0);o=U.length?o.concat(U.filter(H=>!!H)):o}}return o},E)};Object.entries(e).forEach(([s,h])=>{if(h!=null){const p=s.match(/^on(.+)/);p?t.addEventListener(p[1].toLowerCase(),h):s==="p-bind"?bT(t,h):(h=s==="class"?[...new Set(r("class",h))].join(" ").trim():s==="style"?r("style",h).join(";").trim():h,(t.$attrs=t.$attrs||{})&&(t.$attrs[s]=h),t.setAttribute(s,h))}})}}function xee(t){if(t){let e=t.parentNode;return e&&e instanceof ShadowRoot&&e.host&&(e=e.host),e}return null}function wee(t){return!!(t!==null&&typeof t<"u"&&t.nodeName&&xee(t))}function Tee(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}function Eee(t,e="",r){Gz(t)&&r!==null&&r!==void 0&&t.setAttribute(e,r)}function hy(t){"@babel/helpers - typeof";return hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hy(t)}function CM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable})),r.push.apply(r,s)}return r}function RM(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?CM(Object(r),!0).forEach(function(s){See(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):CM(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function See(t,e,r){return(e=Iee(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Iee(t){var e=Aee(t,"string");return hy(e)=="symbol"?e:e+""}function Aee(t,e){if(hy(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e||"default");if(hy(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Cee(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;Tu()?ic(t):e?t():up(t)}var Ree=0;function Pee(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Qr(!1),s=Qr(t),h=Qr(null),p=Tee()?window.document:void 0,b=e.document,E=b===void 0?p:b,o=e.immediate,O=o===void 0?!0:o,z=e.manual,U=z===void 0?!1:z,H=e.name,Y=H===void 0?"style_".concat(++Ree):H,Q=e.id,ge=Q===void 0?void 0:Q,ye=e.media,ke=ye===void 0?void 0:ye,he=e.nonce,oe=he===void 0?void 0:he,ve=e.first,be=ve===void 0?!1:ve,ze=e.onMounted,Te=ze===void 0?void 0:ze,ie=e.onUpdated,ne=ie===void 0?void 0:ie,te=e.onLoad,re=te===void 0?void 0:te,me=e.props,we=me===void 0?{}:me,tt=function(){},Et=function(or){var Fr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(E){var gt=RM(RM({},we),Fr),jr=gt.name||Y,Ur=gt.id||ge,Xr=gt.nonce||oe;h.value=E.querySelector('style[data-primevue-style-id="'.concat(jr,'"]'))||E.getElementById(Ur)||E.createElement("style"),h.value.isConnected||(s.value=or||t,bT(h.value,{type:"text/css",id:Ur,media:ke,nonce:Xr}),be?E.head.prepend(h.value):E.head.appendChild(h.value),Eee(h.value,"data-primevue-style-id",jr),bT(h.value,gt),h.value.onload=function(pr){return re==null?void 0:re(pr,{name:jr})},Te==null||Te(jr)),!r.value&&(tt=ll(s,function(pr){h.value.textContent=pr,ne==null||ne(jr)},{immediate:!0}),r.value=!0)}},ft=function(){!E||!r.value||(tt(),wee(h.value)&&E.head.removeChild(h.value),r.value=!1)};return O&&!U&&Cee(Et),{id:ge,name:Y,el:h,css:s,unload:ft,load:Et,isLoaded:gb(r)}}function dy(t){"@babel/helpers - typeof";return dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dy(t)}function PM(t,e){return Dee(t)||Oee(t,e)||kee(t,e)||Mee()}function Mee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kee(t,e){if(t){if(typeof t=="string")return MM(t,e);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?MM(t,e):void 0}}function MM(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,s=Array(e);r<e;r++)s[r]=t[r];return s}function Oee(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var s,h,p,b,E=[],o=!0,O=!1;try{if(p=(r=r.call(t)).next,e!==0)for(;!(o=(s=p.call(r)).done)&&(E.push(s.value),E.length!==e);o=!0);}catch(z){O=!0,h=z}finally{try{if(!o&&r.return!=null&&(b=r.return(),Object(b)!==b))return}finally{if(O)throw h}}return E}}function Dee(t){if(Array.isArray(t))return t}function kM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable})),r.push.apply(r,s)}return r}function hw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?kM(Object(r),!0).forEach(function(s){Lee(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):kM(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function Lee(t,e,r){return(e=Bee(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Bee(t){var e=zee(t,"string");return dy(e)=="symbol"?e:e+""}function zee(t,e){if(dy(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e||"default");if(dy(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Nee=function(e){var r=e.dt;return`
* {
    box-sizing: border-box;
}

/* Non vue overlay animations */
.p-connected-overlay {
    opacity: 0;
    transform: scaleY(0.8);
    transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1),
        opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
}

.p-connected-overlay-visible {
    opacity: 1;
    transform: scaleY(1);
}

.p-connected-overlay-hidden {
    opacity: 0;
    transform: scaleY(1);
    transition: opacity 0.1s linear;
}

/* Vue based overlay animations */
.p-connected-overlay-enter-from {
    opacity: 0;
    transform: scaleY(0.8);
}

.p-connected-overlay-leave-to {
    opacity: 0;
}

.p-connected-overlay-enter-active {
    transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1),
        opacity 0.12s cubic-bezier(0, 0, 0.2, 1);
}

.p-connected-overlay-leave-active {
    transition: opacity 0.1s linear;
}

/* Toggleable Content */
.p-toggleable-content-enter-from,
.p-toggleable-content-leave-to {
    max-height: 0;
}

.p-toggleable-content-enter-to,
.p-toggleable-content-leave-from {
    max-height: 1000px;
}

.p-toggleable-content-leave-active {
    overflow: hidden;
    transition: max-height 0.45s cubic-bezier(0, 1, 0, 1);
}

.p-toggleable-content-enter-active {
    overflow: hidden;
    transition: max-height 1s ease-in-out;
}

.p-disabled,
.p-disabled * {
    cursor: default;
    pointer-events: none;
    user-select: none;
}

.p-disabled,
.p-component:disabled {
    opacity: `.concat(r("disabled.opacity"),`;
}

.pi {
    font-size: `).concat(r("icon.size"),`;
}

.p-icon {
    width: `).concat(r("icon.size"),`;
    height: `).concat(r("icon.size"),`;
}

.p-overlay-mask {
    background: `).concat(r("mask.background"),`;
    color: `).concat(r("mask.color"),`;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

.p-overlay-mask-enter {
    animation: p-overlay-mask-enter-animation `).concat(r("mask.transition.duration"),` forwards;
}

.p-overlay-mask-leave {
    animation: p-overlay-mask-leave-animation `).concat(r("mask.transition.duration"),` forwards;
}

@keyframes p-overlay-mask-enter-animation {
    from {
        background: transparent;
    }
    to {
        background: `).concat(r("mask.background"),`;
    }
}
@keyframes p-overlay-mask-leave-animation {
    from {
        background: `).concat(r("mask.background"),`;
    }
    to {
        background: transparent;
    }
}
`)},Fee=function(e){var r=e.dt;return`
.p-hidden-accessible {
    border: 0;
    clip: rect(0 0 0 0);
    height: 1px;
    margin: -1px;
    overflow: hidden;
    padding: 0;
    position: absolute;
    width: 1px;
}

.p-hidden-accessible input,
.p-hidden-accessible select {
    transform: scale(0);
}

.p-overflow-hidden {
    overflow: hidden;
    padding-right: `.concat(r("scrollbar.width"),`;
}
`)},Vee={},Uee={},b_={name:"base",css:Fee,theme:Nee,classes:Vee,inlineStyles:Uee,load:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(p){return p},h=s(j_(e,{dt:uw}));return h?Pee($_(h),hw({name:this.name},r)):{}},loadCSS:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.load(this.css,e)},loadTheme:function(){var e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.load(this.theme,r,function(s){return Va.transformCSS(r.name||e.name,s)})},getCommonTheme:function(e){return Va.getCommon(this.name,e)},getComponentTheme:function(e){return Va.getComponent(this.name,e)},getDirectiveTheme:function(e){return Va.getDirective(this.name,e)},getPresetTheme:function(e,r,s){return Va.getCustomPreset(this.name,e,r,s)},getLayerOrderThemeCSS:function(){return Va.getLayerOrderCSS(this.name)},getStyleSheet:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.css){var s=j_(this.css,{dt:uw}),h=$_("".concat(s).concat(e)),p=Object.entries(r).reduce(function(b,E){var o=PM(E,2),O=o[0],z=o[1];return b.push("".concat(O,'="').concat(z,'"'))&&b},[]).join(" ");return'<style type="text/css" data-primevue-style-id="'.concat(this.name,'" ').concat(p,">").concat(h,"</style>")}return""},getCommonThemeStyleSheet:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Va.getCommonStyleSheet(this.name,e,r)},getThemeStyleSheet:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=[Va.getStyleSheet(this.name,e,r)];if(this.theme){var h=this.name==="base"?"global-style":"".concat(this.name,"-style"),p=j_(this.theme,{dt:uw}),b=$_(Va.transformCSS(h,p)),E=Object.entries(r).reduce(function(o,O){var z=PM(O,2),U=z[0],H=z[1];return o.push("".concat(U,'="').concat(H,'"'))&&o},[]).join(" ");s.push('<style type="text/css" data-primevue-style-id="'.concat(h,'" ').concat(E,">").concat(b,"</style>"))}return s.join("")},extend:function(e){return hw(hw({},this),{},{css:void 0,theme:void 0},e)}},l0=Fz();function fy(t){"@babel/helpers - typeof";return fy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fy(t)}function OM(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(h){return Object.getOwnPropertyDescriptor(t,h).enumerable})),r.push.apply(r,s)}return r}function dw(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?OM(Object(r),!0).forEach(function(s){jee(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):OM(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function jee(t,e,r){return(e=$ee(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function $ee(t){var e=Gee(t,"string");return fy(e)=="symbol"?e:e+""}function Gee(t,e){if(fy(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var s=r.call(t,e||"default");if(fy(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var qee={ripple:!1,inputStyle:null,inputVariant:null,locale:{startsWith:"Starts with",contains:"Contains",notContains:"Not contains",endsWith:"Ends with",equals:"Equals",notEquals:"Not equals",noFilter:"No Filter",lt:"Less than",lte:"Less than or equal to",gt:"Greater than",gte:"Greater than or equal to",dateIs:"Date is",dateIsNot:"Date is not",dateBefore:"Date is before",dateAfter:"Date is after",clear:"Clear",apply:"Apply",matchAll:"Match All",matchAny:"Match Any",addRule:"Add Rule",removeRule:"Remove Rule",accept:"Yes",reject:"No",choose:"Choose",upload:"Upload",cancel:"Cancel",completed:"Completed",pending:"Pending",fileSizeTypes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],chooseYear:"Choose Year",chooseMonth:"Choose Month",chooseDate:"Choose Date",prevDecade:"Previous Decade",nextDecade:"Next Decade",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",prevHour:"Previous Hour",nextHour:"Next Hour",prevMinute:"Previous Minute",nextMinute:"Next Minute",prevSecond:"Previous Second",nextSecond:"Next Second",am:"am",pm:"pm",today:"Today",weekHeader:"Wk",firstDayOfWeek:0,showMonthAfterYear:!1,dateFormat:"mm/dd/yy",weak:"Weak",medium:"Medium",strong:"Strong",passwordPrompt:"Enter a password",emptyFilterMessage:"No results found",searchMessage:"{0} results are available",selectionMessage:"{0} items selected",emptySelectionMessage:"No selected item",emptySearchMessage:"No results found",fileChosenMessage:"{0} files",noFileChosenMessage:"No file chosen",emptyMessage:"No available options",aria:{trueLabel:"True",falseLabel:"False",nullLabel:"Not Selected",star:"1 star",stars:"{star} stars",selectAll:"All items selected",unselectAll:"All items unselected",close:"Close",previous:"Previous",next:"Next",navigation:"Navigation",scrollTop:"Scroll Top",moveTop:"Move Top",moveUp:"Move Up",moveDown:"Move Down",moveBottom:"Move Bottom",moveToTarget:"Move to Target",moveToSource:"Move to Source",moveAllToTarget:"Move All to Target",moveAllToSource:"Move All to Source",pageLabel:"Page {page}",firstPageLabel:"First Page",lastPageLabel:"Last Page",nextPageLabel:"Next Page",prevPageLabel:"Previous Page",rowsPerPageLabel:"Rows per page",jumpToPageDropdownLabel:"Jump to Page Dropdown",jumpToPageInputLabel:"Jump to Page Input",selectRow:"Row Selected",unselectRow:"Row Unselected",expandRow:"Row Expanded",collapseRow:"Row Collapsed",showFilterMenu:"Show Filter Menu",hideFilterMenu:"Hide Filter Menu",filterOperator:"Filter Operator",filterConstraint:"Filter Constraint",editRow:"Row Edit",saveEdit:"Save Edit",cancelEdit:"Cancel Edit",listView:"List View",gridView:"Grid View",slide:"Slide",slideNumber:"{slideNumber}",zoomImage:"Zoom Image",zoomIn:"Zoom In",zoomOut:"Zoom Out",rotateRight:"Rotate Right",rotateLeft:"Rotate Left",listLabel:"Option List"}},filterMatchModeOptions:{text:[Fa.STARTS_WITH,Fa.CONTAINS,Fa.NOT_CONTAINS,Fa.ENDS_WITH,Fa.EQUALS,Fa.NOT_EQUALS],numeric:[Fa.EQUALS,Fa.NOT_EQUALS,Fa.LESS_THAN,Fa.LESS_THAN_OR_EQUAL_TO,Fa.GREATER_THAN,Fa.GREATER_THAN_OR_EQUAL_TO],date:[Fa.DATE_IS,Fa.DATE_IS_NOT,Fa.DATE_BEFORE,Fa.DATE_AFTER]},zIndex:{modal:1100,overlay:1e3,menu:1e3,tooltip:1100},theme:void 0,unstyled:!1,pt:void 0,ptOptions:{mergeSections:!0,mergeProps:!1},csp:{nonce:void 0}},Hee=Symbol();function Wee(t,e){var r={config:Dd(e)};return t.config.globalProperties.$primevue=r,t.provide(Hee,r),Zee(),Kee(t,r),r}var gm=[];function Zee(){th.clear(),gm.forEach(function(t){return t==null?void 0:t()}),gm=[]}function Kee(t,e){var r=Qr(!1),s=function(){if(!Va.isStyleNameLoaded("common")){var O,z,U=((O=b_.getCommonTheme)===null||O===void 0?void 0:O.call(b_))||{},H=U.primitive,Y=U.semantic,Q={nonce:(z=e.config)===null||z===void 0||(z=z.csp)===null||z===void 0?void 0:z.nonce};b_.load(H==null?void 0:H.css,dw({name:"primitive-variables"},Q)),b_.load(Y==null?void 0:Y.css,dw({name:"semantic-variables"},Q)),b_.loadTheme(dw({name:"global-style"},Q)),Va.setLoadedStyleName("common")}};th.on("theme:change",function(o){r.value||(t.config.globalProperties.$primevue.config.theme=o,r.value=!0)});var h=ll(e.config,function(o,O){l0.emit("config:change",{newValue:o,oldValue:O})},{immediate:!0,deep:!0}),p=ll(function(){return e.config.ripple},function(o,O){l0.emit("config:ripple:change",{newValue:o,oldValue:O})},{immediate:!0,deep:!0}),b=ll(function(){return e.config.theme},function(o,O){r.value||Va.setTheme(o),e.config.unstyled||s(),r.value=!1,l0.emit("config:theme:change",{newValue:o,oldValue:O})},{immediate:!0,deep:!0}),E=ll(function(){return e.config.unstyled},function(o,O){!o&&e.config.theme&&s(),l0.emit("config:unstyled:change",{newValue:o,oldValue:O})},{immediate:!0,deep:!0});gm.push(h),gm.push(p),gm.push(b),gm.push(E)}var Xee={install:function(e,r){var s=hee(qee,r);Wee(e,s)}},Yee={root:{transitionDuration:"{transition.duration}"},panel:{borderWidth:"0 0 1px 0",borderColor:"{content.border.color}"},header:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{text.color}",padding:"1.125rem",fontWeight:"600",borderRadius:"0",borderWidth:"0",borderColor:"{content.border.color}",background:"{content.background}",hoverBackground:"{content.background}",activeBackground:"{content.background}",activeHoverBackground:"{content.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},toggleIcon:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{text.color}",activeHoverColor:"{text.color}"},first:{topBorderRadius:"{content.border.radius}",borderWidth:"0"},last:{bottomBorderRadius:"{content.border.radius}",activeBottomBorderRadius:"0"}},content:{borderWidth:"0",borderColor:"{content.border.color}",background:"{content.background}",color:"{text.color}",padding:"0 1.125rem 1.125rem 1.125rem"}},Jee={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}"},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},dropdown:{width:"2.5rem",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},chip:{borderRadius:"{border.radius.sm}"},emptyMessage:{padding:"{list.option.padding}"},colorScheme:{light:{dropdown:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}"}},dark:{dropdown:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}"}}}},Qee={root:{width:"2rem",height:"2rem",fontSize:"1rem",background:"{content.border.color}",borderRadius:"{content.border.radius}"},group:{borderColor:"{content.background}",offset:"-1rem"},lg:{width:"3rem",height:"3rem",fontSize:"1.5rem"},xl:{width:"4rem",height:"4rem",fontSize:"2rem"}},ete={root:{borderRadius:"{border.radius.md}",padding:"0 0.5rem",fontSize:"0.75rem",fontWeight:"700",minWidth:"1.5rem",height:"1.5rem"},dot:{size:"0.5rem"},sm:{fontSize:"0.625rem",minWidth:"1.25rem",height:"1.25rem"},lg:{fontSize:"0.875rem",minWidth:"1.75rem",height:"1.75rem"},xl:{fontSize:"1rem",minWidth:"2rem",height:"2rem"},colorScheme:{light:{primary:{background:"{primary.color}",color:"{primary.contrast.color}"},secondary:{background:"{surface.100}",color:"{surface.600}"},success:{background:"{green.500}",color:"{surface.0}"},info:{background:"{sky.500}",color:"{surface.0}"},warn:{background:"{orange.500}",color:"{surface.0}"},danger:{background:"{red.500}",color:"{surface.0}"},contrast:{background:"{surface.950}",color:"{surface.0}"}},dark:{primary:{background:"{primary.color}",color:"{primary.contrast.color}"},secondary:{background:"{surface.800}",color:"{surface.300}"},success:{background:"{green.400}",color:"{green.950}"},info:{background:"{sky.400}",color:"{sky.950}"},warn:{background:"{orange.400}",color:"{orange.950}"},danger:{background:"{red.400}",color:"{red.950}"},contrast:{background:"{surface.0}",color:"{surface.950}"}}}},tte={root:{borderRadius:"{content.border.radius}"}},rte={root:{padding:"1rem",background:"{content.background}",gap:"0.5rem",transitionDuration:"{transition.duration}"},item:{color:"{text.muted.color}",hoverColor:"{text.color}",borderRadius:"{content.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",hoverColor:"{navigation.item.icon.focus.color}"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},separator:{color:"{navigation.item.icon.color}"}},nte={root:{borderRadius:"{form.field.border.radius}",roundedBorderRadius:"2rem",gap:"0.5rem",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",iconOnlyWidth:"2.5rem",sm:{fontSize:"0.875rem",paddingX:"0.625rem",paddingY:"0.375rem"},lg:{fontSize:"1.125rem",paddingX:"0.875rem",paddingY:"0.625rem"},label:{fontWeight:"500"},raisedShadow:"0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"},badgeSize:"1rem",transitionDuration:"{form.field.transition.duration}"},colorScheme:{light:{root:{primary:{background:"{primary.color}",hoverBackground:"{primary.hover.color}",activeBackground:"{primary.active.color}",borderColor:"{primary.color}",hoverBorderColor:"{primary.hover.color}",activeBorderColor:"{primary.active.color}",color:"{primary.contrast.color}",hoverColor:"{primary.contrast.color}",activeColor:"{primary.contrast.color}",focusRing:{color:"{primary.color}",shadow:"none"}},secondary:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",borderColor:"{surface.100}",hoverBorderColor:"{surface.200}",activeBorderColor:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}",focusRing:{color:"{surface.600}",shadow:"none"}},info:{background:"{sky.500}",hoverBackground:"{sky.600}",activeBackground:"{sky.700}",borderColor:"{sky.500}",hoverBorderColor:"{sky.600}",activeBorderColor:"{sky.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{sky.500}",shadow:"none"}},success:{background:"{green.500}",hoverBackground:"{green.600}",activeBackground:"{green.700}",borderColor:"{green.500}",hoverBorderColor:"{green.600}",activeBorderColor:"{green.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{green.500}",shadow:"none"}},warn:{background:"{orange.500}",hoverBackground:"{orange.600}",activeBackground:"{orange.700}",borderColor:"{orange.500}",hoverBorderColor:"{orange.600}",activeBorderColor:"{orange.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{orange.500}",shadow:"none"}},help:{background:"{purple.500}",hoverBackground:"{purple.600}",activeBackground:"{purple.700}",borderColor:"{purple.500}",hoverBorderColor:"{purple.600}",activeBorderColor:"{purple.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{purple.500}",shadow:"none"}},danger:{background:"{red.500}",hoverBackground:"{red.600}",activeBackground:"{red.700}",borderColor:"{red.500}",hoverBorderColor:"{red.600}",activeBorderColor:"{red.700}",color:"#ffffff",hoverColor:"#ffffff",activeColor:"#ffffff",focusRing:{color:"{red.500}",shadow:"none"}},contrast:{background:"{surface.950}",hoverBackground:"{surface.900}",activeBackground:"{surface.800}",borderColor:"{surface.950}",hoverBorderColor:"{surface.900}",activeBorderColor:"{surface.800}",color:"{surface.0}",hoverColor:"{surface.0}",activeColor:"{surface.0}",focusRing:{color:"{surface.950}",shadow:"none"}}},outlined:{primary:{hoverBackground:"{primary.50}",activeBackground:"{primary.100}",borderColor:"{primary.200}",color:"{primary.color}"},secondary:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.200}",color:"{surface.500}"},success:{hoverBackground:"{green.50}",activeBackground:"{green.100}",borderColor:"{green.200}",color:"{green.500}"},info:{hoverBackground:"{sky.50}",activeBackground:"{sky.100}",borderColor:"{sky.200}",color:"{sky.500}"},warn:{hoverBackground:"{orange.50}",activeBackground:"{orange.100}",borderColor:"{orange.200}",color:"{orange.500}"},help:{hoverBackground:"{purple.50}",activeBackground:"{purple.100}",borderColor:"{purple.200}",color:"{purple.500}"},danger:{hoverBackground:"{red.50}",activeBackground:"{red.100}",borderColor:"{red.200}",color:"{red.500}"},contrast:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.700}",color:"{surface.950}"},plain:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",borderColor:"{surface.200}",color:"{surface.700}"}},text:{primary:{hoverBackground:"{primary.50}",activeBackground:"{primary.100}",color:"{primary.color}"},secondary:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.500}"},success:{hoverBackground:"{green.50}",activeBackground:"{green.100}",color:"{green.500}"},info:{hoverBackground:"{sky.50}",activeBackground:"{sky.100}",color:"{sky.500}"},warn:{hoverBackground:"{orange.50}",activeBackground:"{orange.100}",color:"{orange.500}"},help:{hoverBackground:"{purple.50}",activeBackground:"{purple.100}",color:"{purple.500}"},danger:{hoverBackground:"{red.50}",activeBackground:"{red.100}",color:"{red.500}"},plain:{hoverBackground:"{surface.50}",activeBackground:"{surface.100}",color:"{surface.700}"}},link:{color:"{primary.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}},dark:{root:{primary:{background:"{primary.color}",hoverBackground:"{primary.hover.color}",activeBackground:"{primary.active.color}",borderColor:"{primary.color}",hoverBorderColor:"{primary.hover.color}",activeBorderColor:"{primary.active.color}",color:"{primary.contrast.color}",hoverColor:"{primary.contrast.color}",activeColor:"{primary.contrast.color}",focusRing:{color:"{primary.color}",shadow:"none"}},secondary:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",borderColor:"{surface.800}",hoverBorderColor:"{surface.700}",activeBorderColor:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}",focusRing:{color:"{surface.300}",shadow:"none"}},info:{background:"{sky.400}",hoverBackground:"{sky.300}",activeBackground:"{sky.200}",borderColor:"{sky.400}",hoverBorderColor:"{sky.300}",activeBorderColor:"{sky.200}",color:"{sky.950}",hoverColor:"{sky.950}",activeColor:"{sky.950}",focusRing:{color:"{sky.400}",shadow:"none"}},success:{background:"{green.400}",hoverBackground:"{green.300}",activeBackground:"{green.200}",borderColor:"{green.400}",hoverBorderColor:"{green.300}",activeBorderColor:"{green.200}",color:"{green.950}",hoverColor:"{green.950}",activeColor:"{green.950}",focusRing:{color:"{green.400}",shadow:"none"}},warn:{background:"{orange.400}",hoverBackground:"{orange.300}",activeBackground:"{orange.200}",borderColor:"{orange.400}",hoverBorderColor:"{orange.300}",activeBorderColor:"{orange.200}",color:"{orange.950}",hoverColor:"{orange.950}",activeColor:"{orange.950}",focusRing:{color:"{orange.400}",shadow:"none"}},help:{background:"{purple.400}",hoverBackground:"{purple.300}",activeBackground:"{purple.200}",borderColor:"{purple.400}",hoverBorderColor:"{purple.300}",activeBorderColor:"{purple.200}",color:"{purple.950}",hoverColor:"{purple.950}",activeColor:"{purple.950}",focusRing:{color:"{purple.400}",shadow:"none"}},danger:{background:"{red.400}",hoverBackground:"{red.300}",activeBackground:"{red.200}",borderColor:"{red.400}",hoverBorderColor:"{red.300}",activeBorderColor:"{red.200}",color:"{red.950}",hoverColor:"{red.950}",activeColor:"{red.950}",focusRing:{color:"{red.400}",shadow:"none"}},contrast:{background:"{surface.0}",hoverBackground:"{surface.100}",activeBackground:"{surface.200}",borderColor:"{surface.0}",hoverBorderColor:"{surface.100}",activeBorderColor:"{surface.200}",color:"{surface.950}",hoverColor:"{surface.950}",activeColor:"{surface.950}",focusRing:{color:"{surface.0}",shadow:"none"}}},outlined:{primary:{hoverBackground:"color-mix(in srgb, {primary.color}, transparent 96%)",activeBackground:"color-mix(in srgb, {primary.color}, transparent 84%)",borderColor:"{primary.700}",color:"{primary.color}"},secondary:{hoverBackground:"rgba(255,255,255,0.04)",activeBackground:"rgba(255,255,255,0.16)",borderColor:"{surface.700}",color:"{surface.400}"},success:{hoverBackground:"color-mix(in srgb, {green.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {green.400}, transparent 84%)",borderColor:"{green.700}",color:"{green.400}"},info:{hoverBackground:"color-mix(in srgb, {sky.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {sky.400}, transparent 84%)",borderColor:"{sky.700}",color:"{sky.400}"},warn:{hoverBackground:"color-mix(in srgb, {orange.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {orange.400}, transparent 84%)",borderColor:"{orange.700}",color:"{orange.400}"},help:{hoverBackground:"color-mix(in srgb, {purple.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {purple.400}, transparent 84%)",borderColor:"{purple.700}",color:"{purple.400}"},danger:{hoverBackground:"color-mix(in srgb, {red.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {red.400}, transparent 84%)",borderColor:"{red.700}",color:"{red.400}"},contrast:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{surface.500}",color:"{surface.0}"},plain:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{surface.600}",color:"{surface.0}"}},text:{primary:{hoverBackground:"color-mix(in srgb, {primary.color}, transparent 96%)",activeBackground:"color-mix(in srgb, {primary.color}, transparent 84%)",color:"{primary.color}"},secondary:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.400}"},success:{hoverBackground:"color-mix(in srgb, {green.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {green.400}, transparent 84%)",color:"{green.400}"},info:{hoverBackground:"color-mix(in srgb, {sky.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {sky.400}, transparent 84%)",color:"{sky.400}"},warn:{hoverBackground:"color-mix(in srgb, {orange.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {orange.400}, transparent 84%)",color:"{orange.400}"},help:{hoverBackground:"color-mix(in srgb, {purple.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {purple.400}, transparent 84%)",color:"{purple.400}"},danger:{hoverBackground:"color-mix(in srgb, {red.400}, transparent 96%)",activeBackground:"color-mix(in srgb, {red.400}, transparent 84%)",color:"{red.400}"},plain:{hoverBackground:"{surface.800}",activeBackground:"{surface.700}",color:"{surface.0}"}},link:{color:"{primary.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}}}},ite={root:{background:"{content.background}",borderRadius:"{border.radius.xl}",color:"{content.color}",shadow:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1)"},body:{padding:"1.25rem",gap:"0.5rem"},caption:{gap:"0.5rem"},title:{fontSize:"1.25rem",fontWeight:"500"},subtitle:{color:"{text.muted.color}"}},ote={root:{transitionDuration:"{transition.duration}"},content:{gap:"0.25rem"},indicatorList:{padding:"1rem",gap:"0.5rem"},indicator:{width:"2rem",height:"0.5rem",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},colorScheme:{light:{indicator:{background:"{surface.200}",hoverBackground:"{surface.300}",activeBackground:"{primary.color}"}},dark:{indicator:{background:"{surface.700}",hoverBackground:"{surface.600}",activeBackground:"{primary.color}"}}}},ste={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}"},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}",icon:{color:"{list.option.icon.color}",focusColor:"{list.option.icon.focus.color}",size:"0.875rem"}}},ate={root:{borderRadius:"{border.radius.sm}",width:"1.25rem",height:"1.25rem",background:"{form.field.background}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.border.color}",checkedBorderColor:"{primary.color}",checkedHoverBorderColor:"{primary.hover.color}",checkedFocusBorderColor:"{primary.color}",checkedDisabledBorderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},icon:{size:"0.875rem",color:"{form.field.color}",checkedColor:"{primary.contrast.color}",checkedHoverColor:"{primary.contrast.color}",disabledColor:"{form.field.disabled.color}"}},lte={root:{borderRadius:"16px",paddingX:"0.75rem",paddingY:"0.5rem",gap:"0.5rem",transitionDuration:"{transition.duration}"},image:{width:"2rem",height:"2rem"},icon:{size:"1rem"},removeIcon:{size:"1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"}},colorScheme:{light:{root:{background:"{surface.100}",color:"{surface.800}"},icon:{color:"{surface.800}"},removeIcon:{color:"{surface.800}"}},dark:{root:{background:"{surface.800}",color:"{surface.0}"},icon:{color:"{surface.0}"},removeIcon:{color:"{surface.0}"}}}},cte={root:{transitionDuration:"{transition.duration}"},preview:{width:"1.5rem",height:"1.5rem",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},panel:{shadow:"{overlay.popover.shadow}",borderRadius:"{overlay.popover.borderRadius}"},colorScheme:{light:{panel:{background:"{surface.800}",borderColor:"{surface.900}"},handle:{color:"{surface.0}"}},dark:{panel:{background:"{surface.900}",borderColor:"{surface.700}"},handle:{color:"{surface.0}"}}}},ute={icon:{size:"2rem",color:"{overlay.modal.color}"},content:{gap:"1rem"}},hte={root:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",color:"{overlay.popover.color}",borderRadius:"{overlay.popover.border.radius}",shadow:"{overlay.popover.shadow}",gutter:"10px",arrowOffset:"1.25rem"},content:{padding:"{overlay.popover.padding}",gap:"1rem"},icon:{size:"1.5rem",color:"{overlay.popover.color}"},footer:{gap:"0.5rem",padding:"0 {overlay.popover.padding} {overlay.popover.padding} {overlay.popover.padding}"}},dte={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},list:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"}},fte={root:{transitionDuration:"{transition.duration}"},header:{background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},headerCell:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{datatable.border.color}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",gap:"0.5rem",padding:"0.75rem 1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},columnTitle:{fontWeight:"600"},row:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},bodyCell:{borderColor:"{datatable.border.color}",padding:"0.75rem 1rem"},footerCell:{background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",padding:"0.75rem 1rem"},columnFooter:{fontWeight:"600"},footer:{background:"{content.background}",borderColor:"{datatable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},dropPointColor:"{primary.color}",columnResizerWidth:"0.5rem",resizeIndicator:{width:"1px",color:"{primary.color}"},sortIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},loadingIcon:{size:"2rem"},rowToggleButton:{hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",selectedHoverColor:"{primary.color}",size:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},filter:{inlineGap:"0.5rem",overlaySelect:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},overlayPopover:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",borderRadius:"{overlay.popover.border.radius}",color:"{overlay.popover.color}",shadow:"{overlay.popover.shadow}",padding:"{overlay.popover.padding}",gap:"0.5rem"},rule:{borderColor:"{content.border.color}"},constraintList:{padding:"{list.padding}",gap:"{list.gap}"},constraint:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",separator:{borderColor:"{content.border.color}"},padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"}},paginatorTop:{borderColor:"{datatable.border.color}",borderWidth:"0 0 1px 0"},paginatorBottom:{borderColor:"{datatable.border.color}",borderWidth:"0 0 1px 0"},colorScheme:{light:{root:{borderColor:"{content.border.color}"},row:{stripedBackground:"{surface.50}"},bodyCell:{selectedBorderColor:"{primary.100}"}},dark:{root:{borderColor:"{surface.800}"},row:{stripedBackground:"{surface.950}"},bodyCell:{selectedBorderColor:"{primary.900}"}}}},pte={root:{borderColor:"transparent",borderWidth:"0",borderRadius:"0",padding:"0"},header:{background:"{content.background}",color:"{content.color}",borderColor:"{content.border.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem",borderRadius:"0"},content:{background:"{content.background}",color:"{content.color}",borderColor:"transparent",borderWidth:"0",padding:"0",borderRadius:"0"},footer:{background:"{content.background}",color:"{content.color}",borderColor:"{content.border.color}",borderWidth:"1px 0 0 0",padding:"0.75rem 1rem",borderRadius:"0"},paginatorTop:{borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},paginatorBottom:{borderColor:"{content.border.color}",borderWidth:"1px 0 0 0"}},mte={root:{transitionDuration:"{transition.duration}"},panel:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.popover.shadow}",padding:"{overlay.popover.padding}"},header:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",padding:"0 0 0.5rem 0",fontWeight:"500",gap:"0.5rem"},title:{gap:"0.5rem",fontWeight:"500"},dropdown:{width:"2.5rem",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},inputIcon:{color:"{form.field.icon.color}"},selectMonth:{hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}"},selectYear:{hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}"},group:{borderColor:"{content.border.color}",gap:"{overlay.popover.padding}"},dayView:{margin:"0.5rem 0 0 0"},weekDay:{padding:"0.25rem",fontWeight:"500",color:"{content.color}"},date:{hoverBackground:"{content.hover.background}",selectedBackground:"{primary.color}",rangeSelectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{primary.contrast.color}",rangeSelectedColor:"{highlight.color}",width:"2rem",height:"2rem",borderRadius:"50%",padding:"0.25rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},monthView:{margin:"0.5rem 0 0 0"},month:{borderRadius:"{content.border.radius}"},yearView:{margin:"0.5rem 0 0 0"},year:{borderRadius:"{content.border.radius}"},buttonbar:{padding:"0.5rem 0 0 0",borderColor:"{content.border.color}"},timePicker:{padding:"0.5rem 0 0 0",borderColor:"{content.border.color}",gap:"0.5rem",buttonGap:"0.25rem"},colorScheme:{light:{dropdown:{background:"{surface.100}",hoverBackground:"{surface.200}",activeBackground:"{surface.300}",color:"{surface.600}",hoverColor:"{surface.700}",activeColor:"{surface.800}"},today:{background:"{surface.200}",color:"{surface.900}"}},dark:{dropdown:{background:"{surface.800}",hoverBackground:"{surface.700}",activeBackground:"{surface.600}",color:"{surface.300}",hoverColor:"{surface.200}",activeColor:"{surface.100}"},today:{background:"{surface.700}",color:"{surface.0}"}}}},gte={root:{background:"{overlay.modal.background}",borderColor:"{overlay.modal.border.color}",color:"{overlay.modal.color}",borderRadius:"{overlay.modal.border.radius}",shadow:"{overlay.modal.shadow}"},header:{padding:"{overlay.modal.padding}",gap:"0.5rem"},title:{fontSize:"1.25rem",fontWeight:"600"},content:{padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}"},footer:{padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}",gap:"0.5rem"}},_te={root:{borderColor:"{content.border.color}"},content:{background:"{content.background}",color:"{text.color}"},horizontal:{margin:"1rem 0",padding:"0 1rem",content:{padding:"0 0.5rem"}},vertical:{margin:"0 1rem",padding:"0.5rem 0",content:{padding:"0.5rem 0"}}},yte={root:{background:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.2)",padding:"0.5rem",borderRadius:"{border.radius.xl}"},item:{borderRadius:"{content.border.radius}",padding:"0.5rem",size:"3rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},vte={root:{background:"{overlay.modal.background}",borderColor:"{overlay.modal.border.color}",color:"{overlay.modal.color}",borderRadius:"{overlay.modal.border.radius}",shadow:"{overlay.modal.shadow}"},header:{padding:"{overlay.modal.padding}"},title:{fontSize:"1.5rem",fontWeight:"600"},content:{padding:"0 {overlay.modal.padding} {overlay.modal.padding} {overlay.modal.padding}"}},bte={toolbar:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}"},toolbarItem:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}",padding:"{list.padding}"},overlayOption:{focusBackground:"{list.option.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},content:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"}},xte={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",padding:"0 1.125rem 1.125rem 1.125rem",transitionDuration:"{transition.duration}"},legend:{background:"{content.background}",hoverBackground:"{content.hover.background}",color:"{content.color}",hoverColor:"{content.hover.color}",borderRadius:"{content.border.radius}",borderWidth:"1px",borderColor:"transparent",padding:"0.5rem 0.75rem",gap:"0.5rem",fontWeight:"600",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},toggleIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},content:{padding:"0"}},wte={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",transitionDuration:"{transition.duration}"},header:{background:"transparent",color:"{text.color}",padding:"1.125rem",borderWidth:"0",borderRadius:"0",gap:"0.5rem"},content:{highlightBorderColor:"{primary.color}",padding:"0 1.125rem 1.125rem 1.125rem"},file:{padding:"1rem",gap:"1rem",borderColor:"{content.border.color}",info:{gap:"0.5rem"}},progressbar:{height:"0.25rem"},basic:{gap:"0.5rem"}},Tte={root:{color:"{form.field.float.label.color}",focusColor:"{form.field.float.label.focus.color}",invalidColor:"{form.field.float.label.invalid.color}",transitionDuration:"0.2s"}},Ete={root:{borderWidth:"1px",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",transitionDuration:"{transition.duration}"},navButton:{background:"rgba(255, 255, 255, 0.1)",hoverBackground:"rgba(255, 255, 255, 0.2)",color:"{surface.100}",hoverColor:"{surface.0}",size:"3rem",gutter:"0.5rem",prev:{borderRadius:"50%"},next:{borderRadius:"50%"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},navIcon:{size:"1.5rem"},thumbnailsContent:{background:"{content.background}",padding:"1rem 0.25rem"},thumbnailNavButton:{size:"2rem",borderRadius:"{content.border.radius}",gutter:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},thumbnailNavButtonIcon:{size:"1rem"},caption:{background:"rgba(0, 0, 0, 0.5)",color:"{surface.100}",padding:"1rem"},indicatorList:{gap:"0.5rem",padding:"1rem"},indicatorButton:{width:"1rem",height:"1rem",activeBackground:"{primary.color}",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},insetIndicatorList:{background:"rgba(0, 0, 0, 0.5)"},insetIndicatorButton:{background:"rgba(255, 255, 255, 0.4)",hoverBackground:"rgba(255, 255, 255, 0.6)",activeBackground:"rgba(255, 255, 255, 0.9)"},mask:{background:"{mask.background}",color:"{mask.color}"},closeButton:{size:"3rem",gutter:"0.5rem",background:"rgba(255, 255, 255, 0.1)",hoverBackground:"rgba(255, 255, 255, 0.2)",color:"{surface.50}",hoverColor:"{surface.0}",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},closeButtonIcon:{size:"1.5rem"},colorScheme:{light:{thumbnailNavButton:{hoverBackground:"{surface.100}",color:"{surface.600}",hoverColor:"{surface.700}"},indicatorButton:{background:"{surface.200}",hoverBackground:"{surface.300}"}},dark:{thumbnailNavButton:{hoverBackground:"{surface.700}",color:"{surface.400}",hoverColor:"{surface.0}"},indicatorButton:{background:"{surface.700}",hoverBackground:"{surface.600}"}}}},Ste={icon:{color:"{form.field.icon.color}"}},Ite={root:{transitionDuration:"{transition.duration}"},preview:{icon:{size:"1.5rem"},mask:{background:"{mask.background}",color:"{mask.color}"}},toolbar:{position:{left:"auto",right:"1rem",top:"1rem",bottom:"auto"},blur:"8px",background:"rgba(255,255,255,0.1)",borderColor:"rgba(255,255,255,0.2)",borderWidth:"1px",borderRadius:"30px",padding:".5rem",gap:"0.5rem"},action:{hoverBackground:"rgba(255,255,255,0.1)",color:"{surface.50}",hoverColor:"{surface.0}",size:"3rem",iconSize:"1.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},Ate={root:{padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{content.border.radius}",gap:"0.5rem"},text:{fontWeight:"500"},icon:{size:"1rem"},colorScheme:{light:{info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)"},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)"},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)"},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)"},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)"},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)"}},dark:{info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)"},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)"},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)"},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)"},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)"},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)"}}}},Cte={root:{padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{transition.duration}"},display:{hoverBackground:"{content.hover.background}",hoverColor:"{content.hover.color}"}},Rte={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},chip:{borderRadius:"{border.radius.sm}"},colorScheme:{light:{chip:{focusBackground:"{surface.200}",color:"{surface.800}"}},dark:{chip:{focusBackground:"{surface.700}",color:"{surface.0}"}}}},Pte={addon:{background:"{form.field.background}",borderColor:"{form.field.border.color}",color:"{form.field.icon.color}",borderRadius:"{form.field.border.radius}"}},Mte={root:{transitionDuration:"{transition.duration}"},button:{width:"2.5rem",borderRadius:"{form.field.border.radius}",verticalPadding:"{form.field.padding.y}"},colorScheme:{light:{button:{background:"transparent",hoverBackground:"{surface.100}",activeBackground:"{surface.200}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",color:"{surface.400}",hoverColor:"{surface.500}",activeColor:"{surface.600}"}},dark:{button:{background:"transparent",hoverBackground:"{surface.800}",activeBackground:"{surface.700}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.border.color}",activeBorderColor:"{form.field.border.color}",color:"{surface.400}",hoverColor:"{surface.300}",activeColor:"{surface.200}"}}}},kte={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}",sm:{fontSize:"0.875rem",paddingX:"0.625rem",paddingY:"0.375rem"},lg:{fontSize:"1.125rem",paddingX:"0.875rem",paddingY:"0.625rem"}}},Ote={root:{transitionDuration:"{transition.duration}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},value:{background:"{primary.color}"},range:{background:"{content.border.color}"},text:{color:"{text.muted.color}"}},Dte={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",shadow:"{form.field.shadow}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},list:{padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},checkmark:{color:"{list.option.color}",gutterStart:"-0.375rem",gutterEnd:"0.375rem"},emptyMessage:{padding:"{list.option.padding}"},colorScheme:{light:{option:{stripedBackground:"{surface.50}"}},dark:{option:{stripedBackground:"{surface.900}"}}}},Lte={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",verticalOrientation:{padding:"{navigation.list.padding}",gap:"0"},horizontalOrientation:{padding:"0.5rem 0.75rem"},transitionDuration:"{transition.duration}"},baseItem:{borderRadius:"{content.border.radius}",padding:"{navigation.item.padding}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},overlay:{padding:"0",background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",shadow:"{overlay.navigation.shadow}",gap:"0.5rem"},submenu:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},submenuLabel:{padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background.}",color:"{navigation.submenu.label.color}"},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"},mobileButton:{borderRadius:"50%",size:"1.75rem",color:"{text.muted.color}",hoverColor:"{text.muted.hover.color}",hoverBackground:"{content.hover.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},Bte={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},list:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},item:{focusBackground:"{navigation.item.focus.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}"}},submenuLabel:{padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background}",color:"{navigation.submenu.label.color}"},separator:{borderColor:"{content.border.color}"}},zte={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",padding:"0.5rem 0.75rem",transitionDuration:"{transition.duration}"},baseItem:{borderRadius:"{content.border.radius}",padding:"{navigation.item.padding}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},submenu:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}",background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",mobileIndent:"1rem"},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"},mobileButton:{borderRadius:"50%",size:"1.75rem",color:"{text.muted.color}",hoverColor:"{text.muted.hover.color}",hoverBackground:"{content.hover.background}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},Nte={root:{borderRadius:"{content.border.radius}",borderWidth:"1px",transitionDuration:"{transition.duration}"},content:{padding:"0.5rem 0.75rem",gap:"0.5rem"},text:{fontSize:"1rem",fontWeight:"500"},icon:{size:"1.125rem"},closeButton:{width:"1.75rem",height:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"}},closeIcon:{size:"1rem"},colorScheme:{light:{info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"{blue.100}",focusRing:{color:"{blue.600}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"{green.100}",focusRing:{color:"{green.600}",shadow:"none"}}},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"{yellow.100}",focusRing:{color:"{yellow.600}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"{red.100}",focusRing:{color:"{red.600}",shadow:"none"}}},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.200}",focusRing:{color:"{surface.600}",shadow:"none"}}},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.800}",focusRing:{color:"{surface.50}",shadow:"none"}}}},dark:{info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{blue.500}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{green.500}",shadow:"none"}}},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{yellow.500}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{red.500}",shadow:"none"}}},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.700}",focusRing:{color:"{surface.300}",shadow:"none"}}},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.100}",focusRing:{color:"{surface.950}",shadow:"none"}}}}}},Fte={root:{borderRadius:"{content.border.radius}",gap:"1rem"},meters:{background:"{content.border.color}",size:"0.5rem"},label:{gap:"0.5rem"},labelMarker:{size:"0.5rem"},labelIcon:{size:"1rem"},labelList:{verticalGap:"0.5rem",horizontalGap:"1rem"}},Vte={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}",gap:"0.5rem"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},chip:{borderRadius:"{border.radius.sm}"},emptyMessage:{padding:"{list.option.padding}"}},Ute={root:{gap:"1.125rem"},controls:{gap:"0.5rem"}},jte={root:{gutter:"0.75rem",transitionDuration:"{transition.duration}"},node:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{content.border.color}",color:"{content.color}",selectedColor:"{highlight.color}",hoverColor:"{content.hover.color}",padding:"0.75rem 1rem",toggleablePadding:"0.75rem 1rem 1.25rem 1rem",borderRadius:"{content.border.radius}"},nodeToggleButton:{background:"{content.background}",hoverBackground:"{content.hover.background}",borderColor:"{content.border.color}",color:"{text.muted.color}",hoverColor:"{text.color}",size:"1.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},connector:{color:"{content.border.color}",borderRadius:"{content.border.radius}",height:"24px"}},$te={root:{outline:{width:"2px",color:"{content.background}"}}},Gte={root:{padding:"0.5rem 1rem",gap:"0.25rem",borderRadius:"{content.border.radius}",background:"{content.background}",color:"{content.color}",transitionDuration:"{transition.duration}"},navButton:{background:"transparent",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedColor:"{highlight.color}",width:"2.5rem",height:"2.5rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},currentPageReport:{color:"{text.muted.color}"},jumpToPageInput:{maxWidth:"2.5rem"}},qte={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}"},header:{background:"transparent",color:"{text.color}",padding:"1.125rem",borderColor:"{content.border.color}",borderWidth:"0",borderRadius:"0"},toggleableHeader:{padding:"0.375rem 1.125rem"},title:{fontWeight:"600"},content:{padding:"0 1.125rem 1.125rem 1.125rem"},footer:{padding:"0 1.125rem 1.125rem 1.125rem"}},Hte={root:{gap:"0.5rem",transitionDuration:"{transition.duration}"},panel:{background:"{content.background}",borderColor:"{content.border.color}",borderWidth:"1px",color:"{content.color}",padding:"0.25rem 0.25rem",borderRadius:"{content.border.radius}",first:{borderWidth:"1px",topBorderRadius:"{content.border.radius}"},last:{borderWidth:"1px",bottomBorderRadius:"{content.border.radius}"}},item:{focusBackground:"{navigation.item.focus.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",gap:"0.5rem",padding:"{navigation.item.padding}",borderRadius:"{content.border.radius}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}"}},submenu:{indent:"1rem"},submenuIcon:{color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}"}},Wte={meter:{background:"{content.border.color}",borderRadius:"{content.border.radius}",height:".75rem"},icon:{color:"{form.field.icon.color}"},overlay:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",borderRadius:"{overlay.popover.border.radius}",color:"{overlay.popover.color}",padding:"{overlay.popover.padding}",shadow:"{overlay.popover.shadow}"},content:{gap:"0.5rem"},colorScheme:{light:{strength:{weakBackground:"{red.500}",mediumBackground:"{amber.500}",strongBackground:"{green.500}"}},dark:{strength:{weakBackground:"{red.400}",mediumBackground:"{amber.400}",strongBackground:"{green.400}"}}}},Zte={root:{gap:"1.125rem"},controls:{gap:"0.5rem"}},Kte={root:{background:"{overlay.popover.background}",borderColor:"{overlay.popover.border.color}",color:"{overlay.popover.color}",borderRadius:"{overlay.popover.border.radius}",shadow:"{overlay.popover.shadow}",gutter:"10px",arrowOffset:"1.25rem"},content:{padding:"{overlay.popover.padding}"}},Xte={root:{background:"{content.border.color}",borderRadius:"{content.border.radius}",height:"1.25rem"},value:{background:"{primary.color}"},label:{color:"{primary.contrast.color}",fontSize:"0.75rem",fontWeight:"600"}},Yte={colorScheme:{light:{root:{"color.1":"{red.500}","color.2":"{blue.500}","color.3":"{green.500}","color.4":"{yellow.500}"}},dark:{root:{"color.1":"{red.400}","color.2":"{blue.400}","color.3":"{green.400}","color.4":"{yellow.400}"}}}},Jte={root:{width:"1.25rem",height:"1.25rem",background:"{form.field.background}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.border.color}",checkedBorderColor:"{primary.color}",checkedHoverBorderColor:"{primary.hover.color}",checkedFocusBorderColor:"{primary.color}",checkedDisabledBorderColor:"{form.field.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},icon:{size:"0.75rem",checkedColor:"{primary.contrast.color}",checkedHoverColor:"{primary.contrast.color}",disabledColor:"{form.field.disabled.color}"}},Qte={root:{gap:"0.25rem",transitionDuration:"{transition.duration}"},icon:{size:"1rem",color:"{text.muted.color}",hoverColor:"{primary.color}",activeColor:"{primary.color}"}},ere={colorScheme:{light:{root:{background:"rgba(0,0,0,0.1)"}},dark:{root:{background:"rgba(255,255,255,0.3)"}}}},tre={root:{transitionDuration:"{transition.duration}"},bar:{size:"9px",borderRadius:"{border.radius.sm}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},colorScheme:{light:{bar:{background:"{surface.100}"}},dark:{bar:{background:"{surface.800}"}}}},rre={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},list:{padding:"{list.padding}",gap:"{list.gap}",header:{padding:"{list.header.padding}"}},option:{focusBackground:"{list.option.focus.background}",selectedBackground:"{list.option.selected.background}",selectedFocusBackground:"{list.option.selected.focus.background}",color:"{list.option.color}",focusColor:"{list.option.focus.color}",selectedColor:"{list.option.selected.color}",selectedFocusColor:"{list.option.selected.focus.color}",padding:"{list.option.padding}",borderRadius:"{list.option.border.radius}"},optionGroup:{background:"{list.option.group.background}",color:"{list.option.group.color}",fontWeight:"{list.option.group.font.weight}",padding:"{list.option.group.padding}"},clearIcon:{color:"{form.field.icon.color}"},checkmark:{color:"{list.option.color}",gutterStart:"-0.375rem",gutterEnd:"0.375rem"},emptyMessage:{padding:"{list.option.padding}"}},nre={root:{borderRadius:"{form.field.border.radius}"},colorScheme:{light:{root:{invalidBorderColor:"{form.field.invalid.border.color}"}},dark:{root:{invalidBorderColor:"{form.field.invalid.border.color}"}}}},ire={root:{borderRadius:"{content.border.radius}"},colorScheme:{light:{root:{background:"{surface.200}",animationBackground:"rgba(255,255,255,0.4)"}},dark:{root:{background:"rgba(255, 255, 255, 0.06)",animationBackground:"rgba(255, 255, 255, 0.04)"}}}},ore={root:{transitionDuration:"{transition.duration}"},track:{background:"{content.border.color}",borderRadius:"{content.border.radius}",size:"3px"},range:{background:"{primary.color}"},handle:{width:"20px",height:"20px",borderRadius:"50%",background:"{content.border.color}",hoverBackground:"{content.border.color}",content:{borderRadius:"50%",hoverBackground:"{content.background}",width:"16px",height:"16px",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.08), 0px 1px 1px 0px rgba(0, 0, 0, 0.14)"},focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},colorScheme:{light:{handle:{contentBackground:"{surface.0}"}},dark:{handle:{contentBackground:"{surface.950}"}}}},sre={root:{gap:"0.5rem",transitionDuration:"{transition.duration}"}},are={root:{borderRadius:"{form.field.border.radius}",roundedBorderRadius:"2rem",raisedShadow:"0 3px 1px -2px rgba(0, 0, 0, 0.2), 0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12)"}},lre={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",transitionDuration:"{transition.duration}"},gutter:{background:"{content.border.color}"},handle:{size:"24px",background:"transparent",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}}},cre={root:{transitionDuration:"{transition.duration}"},separator:{background:"{content.border.color}",activeBackground:"{primary.color}",margin:"0 0 0 1.625rem",size:"2px"},step:{padding:"0.5rem",gap:"1rem"},stepHeader:{padding:"0",borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},gap:"0.5rem"},stepTitle:{color:"{text.muted.color}",activeColor:"{primary.color}",fontWeight:"500"},stepNumber:{background:"{content.background}",activeBackground:"{content.background}",borderColor:"{content.border.color}",activeBorderColor:"{content.border.color}",color:"{text.muted.color}",activeColor:"{primary.color}",size:"2rem",fontSize:"1.143rem",fontWeight:"500",borderRadius:"50%",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"},steppanels:{padding:"0.875rem 0.5rem 1.125rem 0.5rem"},steppanel:{background:"{content.background}",color:"{content.color}",padding:"0 0 0 1rem"}},ure={root:{transitionDuration:"{transition.duration}"},separator:{background:"{content.border.color}"},itemLink:{borderRadius:"{content.border.radius}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},gap:"0.5rem"},itemLabel:{color:"{text.muted.color}",activeColor:"{primary.color}",fontWeight:"500"},itemNumber:{background:"{content.background}",activeBackground:"{content.background}",borderColor:"{content.border.color}",activeBorderColor:"{content.border.color}",color:"{text.muted.color}",activeColor:"{primary.color}",size:"2rem",fontSize:"1.143rem",fontWeight:"500",borderRadius:"50%",shadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"}},hre={root:{transitionDuration:"{transition.duration}"},tablist:{borderWidth:"0 0 1px 0",background:"{content.background}",borderColor:"{content.border.color}"},item:{background:"transparent",hoverBackground:"transparent",activeBackground:"transparent",borderWidth:"0 0 1px 0",borderColor:"{content.border.color}",hoverBorderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}",padding:"1rem 1.125rem",fontWeight:"600",margin:"0 0 -1px 0",gap:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},itemIcon:{color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},activeBar:{height:"1px",bottom:"-1px",background:"{primary.color}"}},dre={root:{transitionDuration:"{transition.duration}"},tablist:{borderWidth:"0 0 1px 0",background:"{content.background}",borderColor:"{content.border.color}"},tab:{background:"transparent",hoverBackground:"transparent",activeBackground:"transparent",borderWidth:"0 0 1px 0",borderColor:"{content.border.color}",hoverBorderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}",padding:"1rem 1.125rem",fontWeight:"600",margin:"0 0 -1px 0",gap:"0.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},tabpanel:{background:"{content.background}",color:"{content.color}",padding:"0.875rem 1.125rem 1.125rem 1.125rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"inset {focus.ring.shadow}"}},navButton:{background:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",width:"2.5rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},activeBar:{height:"1px",bottom:"-1px",background:"{primary.color}"},colorScheme:{light:{navButton:{shadow:"0px 0px 10px 50px rgba(255, 255, 255, 0.6)"}},dark:{navButton:{shadow:"0px 0px 10px 50px color-mix(in srgb, {content.background}, transparent 50%)"}}}},fre={root:{transitionDuration:"{transition.duration}"},tabList:{background:"{content.background}",borderColor:"{content.border.color}"},tab:{borderColor:"{content.border.color}",activeBorderColor:"{primary.color}",color:"{text.muted.color}",hoverColor:"{text.color}",activeColor:"{primary.color}"},tabPanel:{background:"{content.background}",color:"{content.color}"},navButton:{background:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}"},colorScheme:{light:{navButton:{shadow:"0px 0px 10px 50px rgba(255, 255, 255, 0.6)"}},dark:{navButton:{shadow:"0px 0px 10px 50px color-mix(in srgb, {content.background}, transparent 50%)"}}}},pre={root:{fontSize:"0.875rem",fontWeight:"700",padding:"0.25rem 0.5rem",gap:"0.25rem",borderRadius:"{content.border.radius}",roundedBorderRadius:"{border.radius.xl}"},icon:{size:"0.75rem"},colorScheme:{light:{primary:{background:"{primary.100}",color:"{primary.700}"},secondary:{background:"{surface.100}",color:"{surface.600}"},success:{background:"{green.100}",color:"{green.700}"},info:{background:"{sky.100}",color:"{sky.700}"},warn:{background:"{orange.100}",color:"{orange.700}"},danger:{background:"{red.100}",color:"{red.700}"},contrast:{background:"{surface.950}",color:"{surface.0}"}},dark:{primary:{background:"color-mix(in srgb, {primary.500}, transparent 84%)",color:"{primary.300}"},secondary:{background:"{surface.800}",color:"{surface.300}"},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",color:"{green.300}"},info:{background:"color-mix(in srgb, {sky.500}, transparent 84%)",color:"{sky.300}"},warn:{background:"color-mix(in srgb, {orange.500}, transparent 84%)",color:"{orange.300}"},danger:{background:"color-mix(in srgb, {red.500}, transparent 84%)",color:"{red.300}"},contrast:{background:"{surface.0}",color:"{surface.950}"}}}},mre={root:{background:"{form.field.background}",borderColor:"{form.field.border.color}",color:"{form.field.color}",height:"18rem",padding:"{form.field.padding.y} {form.field.padding.x}",borderRadius:"{form.field.border.radius}"},prompt:{gap:"0.25rem"},commandResponse:{margin:"2px 0"}},gre={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"}},_re={root:{background:"{content.background}",borderColor:"{content.border.color}",color:"{content.color}",borderRadius:"{content.border.radius}",shadow:"{overlay.navigation.shadow}",transitionDuration:"{transition.duration}"},list:{padding:"{navigation.list.padding}",gap:"{navigation.list.gap}"},item:{focusBackground:"{navigation.item.focus.background}",activeBackground:"{navigation.item.active.background}",color:"{navigation.item.color}",focusColor:"{navigation.item.focus.color}",activeColor:"{navigation.item.active.color}",padding:"{navigation.item.padding}",borderRadius:"{navigation.item.border.radius}",gap:"{navigation.item.gap}",icon:{color:"{navigation.item.icon.color}",focusColor:"{navigation.item.icon.focus.color}",activeColor:"{navigation.item.icon.active.color}"}},submenuLabel:{padding:"{navigation.submenu.label.padding}",fontWeight:"{navigation.submenu.label.font.weight}",background:"{navigation.submenu.label.background.}",color:"{navigation.submenu.label.color}"},submenuIcon:{size:"{navigation.submenu.icon.size}",color:"{navigation.submenu.icon.color}",focusColor:"{navigation.submenu.icon.focus.color}",activeColor:"{navigation.submenu.icon.active.color}"},separator:{borderColor:"{content.border.color}"}},yre={event:{minHeight:"5rem"},horizontal:{eventContent:{padding:"1rem 0"}},vertical:{eventContent:{padding:"0 1rem"}},eventMarker:{size:"1.125rem",borderRadius:"50%",borderWidth:"2px",background:"{content.background}",borderColor:"{content.border.color}",content:{borderRadius:"50%",size:"0.375rem",background:"{primary.color}",insetShadow:"0px 0.5px 0px 0px rgba(0, 0, 0, 0.06), 0px 1px 1px 0px rgba(0, 0, 0, 0.12)"}},eventConnector:{color:"{content.border.color}",size:"2px"}},vre={root:{width:"25rem",borderRadius:"{content.border.radius}",borderWidth:"1px",transitionDuration:"{transition.duration}"},icon:{size:"1.125rem"},content:{padding:"{overlay.popover.padding}",gap:"0.5rem"},text:{gap:"0.5rem"},summary:{fontWeight:"500",fontSize:"1rem"},detail:{fontWeight:"500",fontSize:"0.875rem"},closeButton:{width:"1.75rem",height:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",offset:"{focus.ring.offset}"}},closeIcon:{size:"1rem"},colorScheme:{light:{blur:"1.5px",info:{background:"color-mix(in srgb, {blue.50}, transparent 5%)",borderColor:"{blue.200}",color:"{blue.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"{blue.100}",focusRing:{color:"{blue.600}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.50}, transparent 5%)",borderColor:"{green.200}",color:"{green.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"{green.100}",focusRing:{color:"{green.600}",shadow:"none"}}},warn:{background:"color-mix(in srgb,{yellow.50}, transparent 5%)",borderColor:"{yellow.200}",color:"{yellow.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"{yellow.100}",focusRing:{color:"{yellow.600}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.50}, transparent 5%)",borderColor:"{red.200}",color:"{red.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"{red.100}",focusRing:{color:"{red.600}",shadow:"none"}}},secondary:{background:"{surface.100}",borderColor:"{surface.200}",color:"{surface.600}",detailColor:"{surface.700}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.200}",focusRing:{color:"{surface.600}",shadow:"none"}}},contrast:{background:"{surface.900}",borderColor:"{surface.950}",color:"{surface.50}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.800}",focusRing:{color:"{surface.50}",shadow:"none"}}}},dark:{blur:"10px",info:{background:"color-mix(in srgb, {blue.500}, transparent 84%)",borderColor:"color-mix(in srgb, {blue.700}, transparent 64%)",color:"{blue.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {blue.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{blue.500}",shadow:"none"}}},success:{background:"color-mix(in srgb, {green.500}, transparent 84%)",borderColor:"color-mix(in srgb, {green.700}, transparent 64%)",color:"{green.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {green.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{green.500}",shadow:"none"}}},warn:{background:"color-mix(in srgb, {yellow.500}, transparent 84%)",borderColor:"color-mix(in srgb, {yellow.700}, transparent 64%)",color:"{yellow.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {yellow.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{yellow.500}",shadow:"none"}}},error:{background:"color-mix(in srgb, {red.500}, transparent 84%)",borderColor:"color-mix(in srgb, {red.700}, transparent 64%)",color:"{red.500}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {red.500}, transparent 96%)",closeButton:{hoverBackground:"rgba(255, 255, 255, 0.05)",focusRing:{color:"{red.500}",shadow:"none"}}},secondary:{background:"{surface.800}",borderColor:"{surface.700}",color:"{surface.300}",detailColor:"{surface.0}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.500}, transparent 96%)",closeButton:{hoverBackground:"{surface.700}",focusRing:{color:"{surface.300}",shadow:"none"}}},contrast:{background:"{surface.0}",borderColor:"{surface.100}",color:"{surface.950}",detailColor:"{surface.950}",shadow:"0px 4px 8px 0px color-mix(in srgb, {surface.950}, transparent 96%)",closeButton:{hoverBackground:"{surface.100}",focusRing:{color:"{surface.950}",shadow:"none"}}}}}},bre={root:{padding:"0.5rem 1rem",borderRadius:"{content.border.radius}",gap:"0.5rem",fontWeight:"500",disabledBackground:"{form.field.disabled.background}",disabledBorderColor:"{form.field.disabled.background}",disabledColor:"{form.field.disabled.color}",invalidBorderColor:"{form.field.invalid.border.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},icon:{disabledColor:"{form.field.disabled.color}"},content:{left:"0.25rem",top:"0.25rem",checkedShadow:"0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 1px 2px 0px rgba(0, 0, 0, 0.04)"},colorScheme:{light:{root:{background:"{surface.100}",checkedBackground:"{surface.100}",hoverBackground:"{surface.100}",borderColor:"{surface.100}",color:"{surface.500}",hoverColor:"{surface.700}",checkedColor:"{surface.900}",checkedBorderColor:"{surface.100}"},content:{checkedBackground:"{surface.0}"},icon:{color:"{surface.500}",hoverColor:"{surface.700}",checkedColor:"{surface.900}"}},dark:{root:{background:"{surface.950}",checkedBackground:"{surface.950}",hoverBackground:"{surface.950}",borderColor:"{surface.950}",color:"{surface.400}",hoverColor:"{surface.300}",checkedColor:"{surface.0}",checkedBorderColor:"{surface.950}"},content:{checkedBackground:"{surface.800}"},icon:{color:"{surface.400}",hoverColor:"{surface.300}",checkedColor:"{surface.0}"}}}},xre={root:{width:"2.5rem",height:"1.5rem",borderRadius:"30px",gap:"0.25rem",shadow:"{form.field.shadow}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"},borderWidth:"1px",borderColor:"transparent",hoverBorderColor:"transparent",checkedBorderColor:"transparent",checkedHoverBorderColor:"transparent",invalidBorderColor:"{form.field.invalid.border.color}",transitionDuration:"{form.field.transition.duration}",slideDuration:"0.2s",disabledBackground:"{form.field.disabled.background}"},handle:{borderRadius:"50%",size:"1rem",disabledBackground:"{form.field.disabled.color}"},colorScheme:{light:{root:{background:"{surface.300}",hoverBackground:"{surface.400}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}"},handle:{background:"{surface.0}",hoverBackground:"{surface.0}",checkedBackground:"{surface.0}",checkedHoverBackground:"{surface.0}"}},dark:{root:{background:"{surface.700}",hoverBackground:"{surface.600}",checkedBackground:"{primary.color}",checkedHoverBackground:"{primary.hover.color}"},handle:{background:"{surface.400}",hoverBackground:"{surface.300}",checkedBackground:"{surface.900}",checkedHoverBackground:"{surface.900}"}}}},wre={root:{background:"{content.background}",borderColor:"{content.border.color}",borderRadius:"{content.border.radius}",color:"{content.color}",gap:"0.5rem",padding:"0.75rem"}},Tre={root:{maxWidth:"12.5rem",gutter:"0.25rem",shadow:"{overlay.popover.shadow}",padding:"0.5rem 0.75rem",borderRadius:"{overlay.popover.border.radius}"},colorScheme:{light:{root:{background:"{surface.700}",color:"{surface.0}"}},dark:{root:{background:"{surface.700}",color:"{surface.0}"}}}},Ere={root:{background:"{content.background}",color:"{content.color}",padding:"1rem",gap:"2px",indent:"1rem",transitionDuration:"{transition.duration}"},node:{padding:"0.25rem 0.5rem",borderRadius:"{content.border.radius}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{text.color}",hoverColor:"{text.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"},gap:"0.25rem"},nodeIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedColor:"{highlight.color}"},nodeToggleButton:{borderRadius:"50%",size:"1.75rem",hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}",selectedHoverColor:"{primary.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},loadingIcon:{size:"2rem"}},Sre={root:{background:"{form.field.background}",disabledBackground:"{form.field.disabled.background}",filledBackground:"{form.field.filled.background}",filledFocusBackground:"{form.field.filled.focus.background}",borderColor:"{form.field.border.color}",hoverBorderColor:"{form.field.hover.border.color}",focusBorderColor:"{form.field.focus.border.color}",invalidBorderColor:"{form.field.invalid.border.color}",color:"{form.field.color}",disabledColor:"{form.field.disabled.color}",placeholderColor:"{form.field.placeholder.color}",shadow:"{form.field.shadow}",paddingX:"{form.field.padding.x}",paddingY:"{form.field.padding.y}",borderRadius:"{form.field.border.radius}",focusRing:{width:"{form.field.focus.ring.width}",style:"{form.field.focus.ring.style}",color:"{form.field.focus.ring.color}",offset:"{form.field.focus.ring.offset}",shadow:"{form.field.focus.ring.shadow}"},transitionDuration:"{form.field.transition.duration}"},dropdown:{width:"2.5rem",color:"{form.field.icon.color}"},overlay:{background:"{overlay.select.background}",borderColor:"{overlay.select.border.color}",borderRadius:"{overlay.select.border.radius}",color:"{overlay.select.color}",shadow:"{overlay.select.shadow}"},tree:{padding:"{list.padding}"},emptyMessage:{padding:"{list.option.padding}"},chip:{borderRadius:"{border.radius.sm}"}},Ire={root:{transitionDuration:"{transition.duration}"},header:{background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},headerCell:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",borderColor:"{treetable.border.color}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",gap:"0.5rem",padding:"0.75rem 1rem",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},columnTitle:{fontWeight:"600"},row:{background:"{content.background}",hoverBackground:"{content.hover.background}",selectedBackground:"{highlight.background}",color:"{content.color}",hoverColor:"{content.hover.color}",selectedColor:"{highlight.color}",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"-1px",shadow:"{focus.ring.shadow}"}},bodyCell:{borderColor:"{treetable.border.color}",padding:"0.75rem 1rem",gap:"0.5rem"},footerCell:{background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",padding:"0.75rem 1rem"},columnFooter:{fontWeight:"600"},footer:{background:"{content.background}",borderColor:"{treetable.border.color}",color:"{content.color}",borderWidth:"0 0 1px 0",padding:"0.75rem 1rem"},columnResizerWidth:"0.5rem",resizeIndicator:{width:"1px",color:"{primary.color}"},sortIcon:{color:"{text.muted.color}",hoverColor:"{text.hover.muted.color}"},loadingIcon:{size:"2rem"},nodeToggleButton:{hoverBackground:"{content.hover.background}",selectedHoverBackground:"{content.background}",color:"{text.muted.color}",hoverColor:"{text.color}",selectedHoverColor:"{primary.color}",size:"1.75rem",borderRadius:"50%",focusRing:{width:"{focus.ring.width}",style:"{focus.ring.style}",color:"{focus.ring.color}",offset:"{focus.ring.offset}",shadow:"{focus.ring.shadow}"}},paginatorTop:{borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},paginatorBottom:{borderColor:"{content.border.color}",borderWidth:"0 0 1px 0"},colorScheme:{light:{root:{borderColor:"{content.border.color}"},bodyCell:{selectedBorderColor:"{primary.100}"}},dark:{root:{borderColor:"{surface.800}"},bodyCell:{selectedBorderColor:"{primary.900}"}}}},Are={loader:{mask:{background:"{content.background}",color:"{text.muted.color}"},icon:{size:"2rem"}}},Cre={primitive:{borderRadius:{none:"0",xs:"2px",sm:"4px",md:"6px",lg:"8px",xl:"12px"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b",950:"#022c22"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d",950:"#052e16"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314",950:"#1a2e05"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d",950:"#450a0a"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12",950:"#431407"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f",950:"#451a03"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a",950:"#042f2e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63",950:"#083344"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e",950:"#082f49"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81",950:"#1e1b4b"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95",950:"#2e1065"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87",950:"#3b0764"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75",950:"#4a044e"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843",950:"#500724"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337",950:"#4c0519"},slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",950:"#020617"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827",950:"#030712"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b",950:"#09090b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717",950:"#0a0a0a"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917",950:"#0c0a09"}},semantic:{transitionDuration:"0.2s",focusRing:{width:"1px",style:"solid",color:"{primary.color}",offset:"2px",shadow:"none"},disabledOpacity:"0.6",iconSize:"1rem",anchorGutter:"2px",primary:{50:"{emerald.50}",100:"{emerald.100}",200:"{emerald.200}",300:"{emerald.300}",400:"{emerald.400}",500:"{emerald.500}",600:"{emerald.600}",700:"{emerald.700}",800:"{emerald.800}",900:"{emerald.900}",950:"{emerald.950}"},formField:{paddingX:"0.75rem",paddingY:"0.5rem",borderRadius:"{border.radius.md}",focusRing:{width:"0",style:"none",color:"transparent",offset:"0",shadow:"none"},transitionDuration:"{transition.duration}"},list:{padding:"0.25rem 0.25rem",gap:"2px",header:{padding:"0.5rem 1rem 0.25rem 1rem"},option:{padding:"0.5rem 0.75rem",borderRadius:"{border.radius.sm}"},optionGroup:{padding:"0.5rem 0.75rem",fontWeight:"600"}},content:{borderRadius:"{border.radius.md}"},mask:{transitionDuration:"0.15s"},navigation:{list:{padding:"0.25rem 0.25rem",gap:"2px"},item:{padding:"0.5rem 0.75rem",borderRadius:"{border.radius.sm}",gap:"0.5rem"},submenuLabel:{padding:"0.5rem 0.75rem",fontWeight:"600"},submenuIcon:{size:"0.875rem"}},overlay:{select:{borderRadius:"{border.radius.md}",shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"},popover:{borderRadius:"{border.radius.md}",padding:"0.75rem",shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"},modal:{borderRadius:"{border.radius.xl}",padding:"1.25rem",shadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1)"},navigation:{shadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1)"}},colorScheme:{light:{surface:{0:"#ffffff",50:"{slate.50}",100:"{slate.100}",200:"{slate.200}",300:"{slate.300}",400:"{slate.400}",500:"{slate.500}",600:"{slate.600}",700:"{slate.700}",800:"{slate.800}",900:"{slate.900}",950:"{slate.950}"},primary:{color:"{primary.500}",contrastColor:"#ffffff",hoverColor:"{primary.600}",activeColor:"{primary.700}"},highlight:{background:"{primary.50}",focusBackground:"{primary.100}",color:"{primary.700}",focusColor:"{primary.800}"},mask:{background:"rgba(0,0,0,0.4)",color:"{surface.200}"},formField:{background:"{surface.0}",disabledBackground:"{surface.200}",filledBackground:"{surface.50}",filledFocusBackground:"{surface.50}",borderColor:"{surface.300}",hoverBorderColor:"{surface.400}",focusBorderColor:"{primary.color}",invalidBorderColor:"{red.400}",color:"{surface.700}",disabledColor:"{surface.500}",placeholderColor:"{surface.500}",floatLabelColor:"{surface.500}",floatLabelFocusColor:"{surface.500}",floatLabelInvalidColor:"{red.400}",iconColor:"{surface.400}",shadow:"0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgba(18, 18, 23, 0.05)"},text:{color:"{surface.700}",hoverColor:"{surface.800}",mutedColor:"{surface.500}",hoverMutedColor:"{surface.600}"},content:{background:"{surface.0}",hoverBackground:"{surface.100}",borderColor:"{surface.200}",color:"{text.color}",hoverColor:"{text.hover.color}"},overlay:{select:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"},popover:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"},modal:{background:"{surface.0}",borderColor:"{surface.200}",color:"{text.color}"}},list:{option:{focusBackground:"{surface.100}",selectedBackground:"{highlight.background}",selectedFocusBackground:"{highlight.focus.background}",color:"{text.color}",focusColor:"{text.hover.color}",selectedColor:"{highlight.color}",selectedFocusColor:"{highlight.focus.color}",icon:{color:"{surface.400}",focusColor:"{surface.500}"}},optionGroup:{background:"transparent",color:"{text.muted.color}"}},navigation:{item:{focusBackground:"{surface.100}",activeBackground:"{surface.100}",color:"{text.color}",focusColor:"{text.hover.color}",activeColor:"{text.hover.color}",icon:{color:"{surface.400}",focusColor:"{surface.500}",activeColor:"{surface.500}"}},submenuLabel:{background:"transparent",color:"{text.muted.color}"},submenuIcon:{color:"{surface.400}",focusColor:"{surface.500}",activeColor:"{surface.500}"}}},dark:{surface:{0:"#ffffff",50:"{zinc.50}",100:"{zinc.100}",200:"{zinc.200}",300:"{zinc.300}",400:"{zinc.400}",500:"{zinc.500}",600:"{zinc.600}",700:"{zinc.700}",800:"{zinc.800}",900:"{zinc.900}",950:"{zinc.950}"},primary:{color:"{primary.400}",contrastColor:"{surface.900}",hoverColor:"{primary.300}",activeColor:"{primary.200}"},highlight:{background:"color-mix(in srgb, {primary.400}, transparent 84%)",focusBackground:"color-mix(in srgb, {primary.400}, transparent 76%)",color:"rgba(255,255,255,.87)",focusColor:"rgba(255,255,255,.87)"},mask:{background:"rgba(0,0,0,0.6)",color:"{surface.200}"},formField:{background:"{surface.950}",disabledBackground:"{surface.700}",filledBackground:"{surface.800}",filledFocusBackground:"{surface.800}",borderColor:"{surface.700}",hoverBorderColor:"{surface.600}",focusBorderColor:"{primary.color}",invalidBorderColor:"{red.300}",color:"{surface.0}",disabledColor:"{surface.400}",placeholderColor:"{surface.400}",floatLabelColor:"{surface.400}",floatLabelFocusColor:"{surface.400}",floatLabelInvalidColor:"{red.300}",iconColor:"{surface.400}",shadow:"0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgba(18, 18, 23, 0.05)"},text:{color:"{surface.0}",hoverColor:"{surface.0}",mutedColor:"{surface.400}",hoverMutedColor:"{surface.300}"},content:{background:"{surface.900}",hoverBackground:"{surface.800}",borderColor:"{surface.700}",color:"{text.color}",hoverColor:"{text.hover.color}"},overlay:{select:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"},popover:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"},modal:{background:"{surface.900}",borderColor:"{surface.700}",color:"{text.color}"}},list:{option:{focusBackground:"{surface.800}",selectedBackground:"{highlight.background}",selectedFocusBackground:"{highlight.focus.background}",color:"{text.color}",focusColor:"{text.hover.color}",selectedColor:"{highlight.color}",selectedFocusColor:"{highlight.focus.color}",icon:{color:"{surface.500}",focusColor:"{surface.400}"}},optionGroup:{background:"transparent",color:"{text.muted.color}"}},navigation:{item:{focusBackground:"{surface.800}",activeBackground:"{surface.800}",color:"{text.color}",focusColor:"{text.hover.color}",activeColor:"{text.hover.color}",icon:{color:"{surface.500}",focusColor:"{surface.400}",activeColor:"{surface.400}"}},submenuLabel:{background:"transparent",color:"{text.muted.color}"},submenuIcon:{color:"{surface.500}",focusColor:"{surface.400}",activeColor:"{surface.400}"}}}}},components:{accordion:Yee,autocomplete:Jee,avatar:Qee,badge:ete,blockui:tte,breadcrumb:rte,button:nte,datepicker:mte,card:ite,carousel:ote,cascadeselect:ste,checkbox:ate,chip:lte,colorpicker:cte,confirmdialog:ute,confirmpopup:hte,contextmenu:dte,dataview:pte,datatable:fte,dialog:gte,divider:_te,dock:yte,drawer:vte,editor:bte,fieldset:xte,fileupload:wte,floatlabel:Tte,galleria:Ete,iconfield:Ste,image:Ite,inlinemessage:Ate,inplace:Cte,inputchips:Rte,inputgroup:Pte,inputnumber:Mte,inputtext:kte,knob:Ote,listbox:Dte,megamenu:Lte,menu:Bte,menubar:zte,message:Nte,metergroup:Fte,multiselect:Vte,orderlist:Ute,organizationchart:jte,overlaybadge:$te,popover:Kte,paginator:Gte,password:Wte,panel:qte,panelmenu:Hte,picklist:Zte,progressbar:Xte,progressspinner:Yte,radiobutton:Jte,rating:Qte,scrollpanel:tre,select:rre,selectbutton:nre,skeleton:ire,slider:ore,speeddial:sre,splitter:lre,splitbutton:are,stepper:cre,steps:ure,tabmenu:hre,tabs:dre,tabview:fre,textarea:gre,tieredmenu:_re,tag:pre,terminal:mre,timeline:yre,togglebutton:bre,toggleswitch:xre,tree:Ere,treeselect:Sre,treetable:Ire,toast:vre,toolbar:wre,virtualscroller:Are},directives:{tooltip:Tre,ripple:ere}};const iS=MO(iee);iS.use(Xee,{theme:{preset:Cre}});iS.use(ug);iS.mount("#app");
